{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/electron-sandbox/parts/titlebar/menubarControl.ts"],"names":[],"mappings":"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","file":"menubarControl.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IAction, Separator } from 'vs/base/common/actions';\nimport { IMenuService, SubmenuItemAction, MenuItemAction } from 'vs/platform/actions/common/actions';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IWorkspacesService } from 'vs/platform/workspaces/common/workspaces';\nimport { isMacintosh } from 'vs/base/common/platform';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { INativeWorkbenchEnvironmentService } from 'vs/workbench/services/environment/electron-sandbox/environmentService';\nimport { IAccessibilityService } from 'vs/platform/accessibility/common/accessibility';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { IUpdateService } from 'vs/platform/update/common/update';\nimport { IOpenRecentAction, MenubarControl } from 'vs/workbench/browser/parts/titlebar/menubarControl';\nimport { IStorageService } from 'vs/platform/storage/common/storage';\nimport { IMenubarData, IMenubarMenu, IMenubarKeybinding, IMenubarMenuItemSubmenu, IMenubarMenuItemAction, MenubarMenuItem } from 'vs/platform/menubar/common/menubar';\nimport { IMenubarService } from 'vs/platform/menubar/electron-sandbox/menubar';\nimport { INativeHostService } from 'vs/platform/native/common/native';\nimport { IHostService } from 'vs/workbench/services/host/browser/host';\nimport { IPreferencesService } from 'vs/workbench/services/preferences/common/preferences';\nimport { ICommandService } from 'vs/platform/commands/common/commands';\nimport { OpenRecentAction } from 'vs/workbench/browser/actions/windowActions';\nimport { isICommandActionToggleInfo } from 'vs/platform/action/common/action';\nimport { createAndFillInContextMenuActions } from 'vs/platform/actions/browser/menuEntryActionViewItem';\n\nexport class NativeMenubarControl extends MenubarControl {\n\n\tconstructor(\n\t\t@IMenuService menuService: IMenuService,\n\t\t@IWorkspacesService workspacesService: IWorkspacesService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@IUpdateService updateService: IUpdateService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IPreferencesService preferencesService: IPreferencesService,\n\t\t@INativeWorkbenchEnvironmentService environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t\t@IMenubarService private readonly menubarService: IMenubarService,\n\t\t@IHostService hostService: IHostService,\n\t\t@INativeHostService private readonly nativeHostService: INativeHostService,\n\t\t@ICommandService commandService: ICommandService,\n\t) {\n\t\tsuper(menuService, workspacesService, contextKeyService, keybindingService, configurationService, labelService, updateService, storageService, notificationService, preferencesService, environmentService, accessibilityService, hostService, commandService);\n\n\t\t(async () => {\n\t\t\tthis.recentlyOpened = await this.workspacesService.getRecentlyOpened();\n\n\t\t\tthis.doUpdateMenubar();\n\t\t})();\n\n\t\tthis.registerListeners();\n\t}\n\n\tprotected override setupMainMenu(): void {\n\t\tsuper.setupMainMenu();\n\n\t\tfor (const topLevelMenuName of Object.keys(this.topLevelTitles)) {\n\t\t\tconst menu = this.menus[topLevelMenuName];\n\t\t\tif (menu) {\n\t\t\t\tthis.mainMenuDisposables.add(menu.onDidChange(() => this.updateMenubar()));\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected doUpdateMenubar(): void {\n\t\t// Since the native menubar is shared between windows (main process)\n\t\t// only allow the focused window to update the menubar\n\t\tif (!this.hostService.hasFocus) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Send menus to main process to be rendered by Electron\n\t\tconst menubarData = { menus: {}, keybindings: {} };\n\t\tif (this.getMenubarMenus(menubarData)) {\n\t\t\tthis.menubarService.updateMenubar(this.nativeHostService.windowId, menubarData);\n\t\t}\n\t}\n\n\tprivate getMenubarMenus(menubarData: IMenubarData): boolean {\n\t\tif (!menubarData) {\n\t\t\treturn false;\n\t\t}\n\n\t\tmenubarData.keybindings = this.getAdditionalKeybindings();\n\t\tfor (const topLevelMenuName of Object.keys(this.topLevelTitles)) {\n\t\t\tconst menu = this.menus[topLevelMenuName];\n\t\t\tif (menu) {\n\t\t\t\tconst menubarMenu: IMenubarMenu = { items: [] };\n\t\t\t\tconst menuActions: IAction[] = [];\n\t\t\t\tcreateAndFillInContextMenuActions(menu, { shouldForwardArgs: true }, menuActions);\n\t\t\t\tthis.populateMenuItems(menuActions, menubarMenu, menubarData.keybindings);\n\t\t\t\tif (menubarMenu.items.length === 0) {\n\t\t\t\t\treturn false; // Menus are incomplete\n\t\t\t\t}\n\t\t\t\tmenubarData.menus[topLevelMenuName] = menubarMenu;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate populateMenuItems(menuActions: readonly IAction[], menuToPopulate: IMenubarMenu, keybindings: { [id: string]: IMenubarKeybinding | undefined }) {\n\t\tfor (const menuItem of menuActions) {\n\t\t\tif (menuItem instanceof Separator) {\n\t\t\t\tmenuToPopulate.items.push({ id: 'vscode.menubar.separator' });\n\t\t\t} else if (menuItem instanceof MenuItemAction || menuItem instanceof SubmenuItemAction) {\n\n\t\t\t\t// use mnemonicTitle whenever possible\n\t\t\t\tconst title = typeof menuItem.item.title === 'string'\n\t\t\t\t\t? menuItem.item.title\n\t\t\t\t\t: menuItem.item.title.mnemonicTitle ?? menuItem.item.title.value;\n\n\t\t\t\tif (menuItem instanceof SubmenuItemAction) {\n\t\t\t\t\tconst submenu = { items: [] };\n\n\t\t\t\t\tthis.populateMenuItems(menuItem.actions, submenu, keybindings);\n\n\t\t\t\t\tif (submenu.items.length > 0) {\n\t\t\t\t\t\tconst menubarSubmenuItem: IMenubarMenuItemSubmenu = {\n\t\t\t\t\t\t\tid: menuItem.id,\n\t\t\t\t\t\t\tlabel: title,\n\t\t\t\t\t\t\tsubmenu: submenu\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tmenuToPopulate.items.push(menubarSubmenuItem);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (menuItem.id === OpenRecentAction.ID) {\n\t\t\t\t\t\tconst actions = this.getOpenRecentActions().map(this.transformOpenRecentAction);\n\t\t\t\t\t\tmenuToPopulate.items.push(...actions);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst menubarMenuItem: IMenubarMenuItemAction = {\n\t\t\t\t\t\tid: menuItem.id,\n\t\t\t\t\t\tlabel: title\n\t\t\t\t\t};\n\n\t\t\t\t\tif (isICommandActionToggleInfo(menuItem.item.toggled)) {\n\t\t\t\t\t\tmenubarMenuItem.label = menuItem.item.toggled.mnemonicTitle ?? menuItem.item.toggled.title ?? title;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (menuItem.checked) {\n\t\t\t\t\t\tmenubarMenuItem.checked = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!menuItem.enabled) {\n\t\t\t\t\t\tmenubarMenuItem.enabled = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tkeybindings[menuItem.id] = this.getMenubarKeybinding(menuItem.id);\n\t\t\t\t\tmenuToPopulate.items.push(menubarMenuItem);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate transformOpenRecentAction(action: Separator | IOpenRecentAction): MenubarMenuItem {\n\t\tif (action instanceof Separator) {\n\t\t\treturn { id: 'vscode.menubar.separator' };\n\t\t}\n\n\t\treturn {\n\t\t\tid: action.id,\n\t\t\turi: action.uri,\n\t\t\tremoteAuthority: action.remoteAuthority,\n\t\t\tenabled: action.enabled,\n\t\t\tlabel: action.label\n\t\t};\n\t}\n\n\tprivate getAdditionalKeybindings(): { [id: string]: IMenubarKeybinding } {\n\t\tconst keybindings: { [id: string]: IMenubarKeybinding } = {};\n\t\tif (isMacintosh) {\n\t\t\tconst keybinding = this.getMenubarKeybinding('workbench.action.quit');\n\t\t\tif (keybinding) {\n\t\t\t\tkeybindings['workbench.action.quit'] = keybinding;\n\t\t\t}\n\t\t}\n\n\t\treturn keybindings;\n\t}\n\n\tprivate getMenubarKeybinding(id: string): IMenubarKeybinding | undefined {\n\t\tconst binding = this.keybindingService.lookupKeybinding(id);\n\t\tif (!binding) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// first try to resolve a native accelerator\n\t\tconst electronAccelerator = binding.getElectronAccelerator();\n\t\tif (electronAccelerator) {\n\t\t\treturn { label: electronAccelerator, userSettingsLabel: binding.getUserSettingsLabel() ?? undefined };\n\t\t}\n\n\t\t// we need this fallback to support keybindings that cannot show in electron menus (e.g. chords)\n\t\tconst acceleratorLabel = binding.getLabel();\n\t\tif (acceleratorLabel) {\n\t\t\treturn { label: acceleratorLabel, isNative: false, userSettingsLabel: binding.getUserSettingsLabel() ?? undefined };\n\t\t}\n\n\t\treturn undefined;\n\t}\n}\n"]}