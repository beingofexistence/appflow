{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/api/common/extHostWebviewView.ts"],"names":[],"mappings":"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","file":"extHostWebviewView.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { Emitter } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { ExtHostWebview, ExtHostWebviews, toExtensionData, shouldSerializeBuffersForPostMessage } from 'vs/workbench/api/common/extHostWebview';\nimport { ViewBadge } from 'vs/workbench/api/common/extHostTypeConverters';\nimport type * as vscode from 'vscode';\nimport * as extHostProtocol from './extHost.protocol';\nimport * as extHostTypes from './extHostTypes';\n\n/* eslint-disable local/code-no-native-private */\n\nclass ExtHostWebviewView extends Disposable implements vscode.WebviewView {\n\n\treadonly #handle: extHostProtocol.WebviewHandle;\n\treadonly #proxy: extHostProtocol.MainThreadWebviewViewsShape;\n\n\treadonly #viewType: string;\n\treadonly #webview: ExtHostWebview;\n\n\t#isDisposed = false;\n\t#isVisible: boolean;\n\t#title: string | undefined;\n\t#description: string | undefined;\n\t#badge: vscode.ViewBadge | undefined;\n\n\tconstructor(\n\t\thandle: extHostProtocol.WebviewHandle,\n\t\tproxy: extHostProtocol.MainThreadWebviewViewsShape,\n\t\tviewType: string,\n\t\ttitle: string | undefined,\n\t\twebview: ExtHostWebview,\n\t\tisVisible: boolean,\n\t) {\n\t\tsuper();\n\n\t\tthis.#viewType = viewType;\n\t\tthis.#title = title;\n\t\tthis.#handle = handle;\n\t\tthis.#proxy = proxy;\n\t\tthis.#webview = webview;\n\t\tthis.#isVisible = isVisible;\n\t}\n\n\tpublic override dispose() {\n\t\tif (this.#isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isDisposed = true;\n\t\tthis.#onDidDispose.fire();\n\n\t\tthis.#webview.dispose();\n\n\t\tsuper.dispose();\n\t}\n\n\treadonly #onDidChangeVisibility = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeVisibility = this.#onDidChangeVisibility.event;\n\n\treadonly #onDidDispose = this._register(new Emitter<void>());\n\tpublic readonly onDidDispose = this.#onDidDispose.event;\n\n\tpublic get title(): string | undefined {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#title;\n\t}\n\n\tpublic set title(value: string | undefined) {\n\t\tthis.assertNotDisposed();\n\t\tif (this.#title !== value) {\n\t\t\tthis.#title = value;\n\t\t\tthis.#proxy.$setWebviewViewTitle(this.#handle, value);\n\t\t}\n\t}\n\n\tpublic get description(): string | undefined {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#description;\n\t}\n\n\tpublic set description(value: string | undefined) {\n\t\tthis.assertNotDisposed();\n\t\tif (this.#description !== value) {\n\t\t\tthis.#description = value;\n\t\t\tthis.#proxy.$setWebviewViewDescription(this.#handle, value);\n\t\t}\n\t}\n\n\tpublic get visible(): boolean { return this.#isVisible; }\n\n\tpublic get webview(): vscode.Webview { return this.#webview; }\n\n\tpublic get viewType(): string { return this.#viewType; }\n\n\t/* internal */ _setVisible(visible: boolean) {\n\t\tif (visible === this.#isVisible || this.#isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isVisible = visible;\n\t\tthis.#onDidChangeVisibility.fire();\n\t}\n\n\tpublic get badge(): vscode.ViewBadge | undefined {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#badge;\n\t}\n\n\tpublic set badge(badge: vscode.ViewBadge | undefined) {\n\t\tthis.assertNotDisposed();\n\n\t\tif (badge?.value === this.#badge?.value &&\n\t\t\tbadge?.tooltip === this.#badge?.tooltip) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#badge = ViewBadge.from(badge);\n\t\tthis.#proxy.$setWebviewViewBadge(this.#handle, badge);\n\t}\n\n\tpublic show(preserveFocus?: boolean): void {\n\t\tthis.assertNotDisposed();\n\t\tthis.#proxy.$show(this.#handle, !!preserveFocus);\n\t}\n\n\tprivate assertNotDisposed() {\n\t\tif (this.#isDisposed) {\n\t\t\tthrow new Error('Webview is disposed');\n\t\t}\n\t}\n}\n\nexport class ExtHostWebviewViews implements extHostProtocol.ExtHostWebviewViewsShape {\n\n\tprivate readonly _proxy: extHostProtocol.MainThreadWebviewViewsShape;\n\n\tprivate readonly _viewProviders = new Map<string, {\n\t\treadonly provider: vscode.WebviewViewProvider;\n\t\treadonly extension: IExtensionDescription;\n\t}>();\n\n\tprivate readonly _webviewViews = new Map<extHostProtocol.WebviewHandle, ExtHostWebviewView>();\n\n\tconstructor(\n\t\tmainContext: extHostProtocol.IMainContext,\n\t\tprivate readonly _extHostWebview: ExtHostWebviews,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(extHostProtocol.MainContext.MainThreadWebviewViews);\n\t}\n\n\tpublic registerWebviewViewProvider(\n\t\textension: IExtensionDescription,\n\t\tviewType: string,\n\t\tprovider: vscode.WebviewViewProvider,\n\t\twebviewOptions?: {\n\t\t\tretainContextWhenHidden?: boolean;\n\t\t},\n\t): vscode.Disposable {\n\t\tif (this._viewProviders.has(viewType)) {\n\t\t\tthrow new Error(`View provider for '${viewType}' already registered`);\n\t\t}\n\n\t\tthis._viewProviders.set(viewType, { provider, extension });\n\t\tthis._proxy.$registerWebviewViewProvider(toExtensionData(extension), viewType, {\n\t\t\tretainContextWhenHidden: webviewOptions?.retainContextWhenHidden,\n\t\t\tserializeBuffersForPostMessage: shouldSerializeBuffersForPostMessage(extension),\n\t\t});\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tthis._viewProviders.delete(viewType);\n\t\t\tthis._proxy.$unregisterWebviewViewProvider(viewType);\n\t\t});\n\t}\n\n\tasync $resolveWebviewView(\n\t\twebviewHandle: string,\n\t\tviewType: string,\n\t\ttitle: string | undefined,\n\t\tstate: any,\n\t\tcancellation: CancellationToken,\n\t): Promise<void> {\n\t\tconst entry = this._viewProviders.get(viewType);\n\t\tif (!entry) {\n\t\t\tthrow new Error(`No view provider found for '${viewType}'`);\n\t\t}\n\n\t\tconst { provider, extension } = entry;\n\n\t\tconst webview = this._extHostWebview.createNewWebview(webviewHandle, { /* todo */ }, extension);\n\t\tconst revivedView = new ExtHostWebviewView(webviewHandle, this._proxy, viewType, title, webview, true);\n\n\t\tthis._webviewViews.set(webviewHandle, revivedView);\n\n\t\tawait provider.resolveWebviewView(revivedView, { state }, cancellation);\n\t}\n\n\tasync $onDidChangeWebviewViewVisibility(\n\t\twebviewHandle: string,\n\t\tvisible: boolean\n\t) {\n\t\tconst webviewView = this.getWebviewView(webviewHandle);\n\t\twebviewView._setVisible(visible);\n\t}\n\n\tasync $disposeWebviewView(webviewHandle: string) {\n\t\tconst webviewView = this.getWebviewView(webviewHandle);\n\t\tthis._webviewViews.delete(webviewHandle);\n\t\twebviewView.dispose();\n\n\t\tthis._extHostWebview.deleteWebview(webviewHandle);\n\t}\n\n\tprivate getWebviewView(handle: string): ExtHostWebviewView {\n\t\tconst entry = this._webviewViews.get(handle);\n\t\tif (!entry) {\n\t\t\tthrow new Error('No webview found');\n\t\t}\n\t\treturn entry;\n\t}\n}\n"]}