{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/api/common/extHostLanguages.ts"],"names":[],"mappings":"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","file":"extHostLanguages.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MainContext, MainThreadLanguagesShape, IMainContext, ExtHostLanguagesShape } from './extHost.protocol';\nimport type * as vscode from 'vscode';\nimport { ExtHostDocuments } from 'vs/workbench/api/common/extHostDocuments';\nimport * as typeConvert from 'vs/workbench/api/common/extHostTypeConverters';\nimport { StandardTokenType, Range, Position, LanguageStatusSeverity } from 'vs/workbench/api/common/extHostTypes';\nimport Severity from 'vs/base/common/severity';\nimport { disposableTimeout } from 'vs/base/common/async';\nimport { DisposableStore, IDisposable } from 'vs/base/common/lifecycle';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { CommandsConverter } from 'vs/workbench/api/common/extHostCommands';\nimport { IURITransformer } from 'vs/base/common/uriIpc';\n\nexport class ExtHostLanguages implements ExtHostLanguagesShape {\n\n\tprivate readonly _proxy: MainThreadLanguagesShape;\n\n\tprivate _languageIds: string[] = [];\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _commands: CommandsConverter,\n\t\tprivate readonly _uriTransformer: IURITransformer | undefined\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadLanguages);\n\t}\n\n\t$acceptLanguageIds(ids: string[]): void {\n\t\tthis._languageIds = ids;\n\t}\n\n\tasync getLanguages(): Promise<string[]> {\n\t\treturn this._languageIds.slice(0);\n\t}\n\n\tasync changeLanguage(uri: vscode.Uri, languageId: string): Promise<vscode.TextDocument> {\n\t\tawait this._proxy.$changeLanguage(uri, languageId);\n\t\tconst data = this._documents.getDocumentData(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error(`document '${uri.toString()}' NOT found`);\n\t\t}\n\t\treturn data.document;\n\t}\n\n\tasync tokenAtPosition(document: vscode.TextDocument, position: vscode.Position): Promise<vscode.TokenInformation> {\n\t\tconst versionNow = document.version;\n\t\tconst pos = typeConvert.Position.from(position);\n\t\tconst info = await this._proxy.$tokensAtPosition(document.uri, pos);\n\t\tconst defaultRange = {\n\t\t\ttype: StandardTokenType.Other,\n\t\t\trange: document.getWordRangeAtPosition(position) ?? new Range(position.line, position.character, position.line, position.character)\n\t\t};\n\t\tif (!info) {\n\t\t\t// no result\n\t\t\treturn defaultRange;\n\t\t}\n\t\tconst result = {\n\t\t\trange: typeConvert.Range.to(info.range),\n\t\t\ttype: typeConvert.TokenType.to(info.type)\n\t\t};\n\t\tif (!result.range.contains(<Position>position)) {\n\t\t\t// bogous result\n\t\t\treturn defaultRange;\n\t\t}\n\t\tif (versionNow !== document.version) {\n\t\t\t// concurrent change\n\t\t\treturn defaultRange;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate _handlePool: number = 0;\n\tprivate _ids = new Set<string>();\n\n\tcreateLanguageStatusItem(extension: IExtensionDescription, id: string, selector: vscode.DocumentSelector): vscode.LanguageStatusItem {\n\n\t\tconst handle = this._handlePool++;\n\t\tconst proxy = this._proxy;\n\t\tconst ids = this._ids;\n\n\t\t// enforce extension unique identifier\n\t\tconst fullyQualifiedId = `${extension.identifier.value}/${id}`;\n\t\tif (ids.has(fullyQualifiedId)) {\n\t\t\tthrow new Error(`LanguageStatusItem with id '${id}' ALREADY exists`);\n\t\t}\n\t\tids.add(fullyQualifiedId);\n\n\t\tconst data: Omit<vscode.LanguageStatusItem, 'dispose'> = {\n\t\t\tselector,\n\t\t\tid,\n\t\t\tname: extension.displayName ?? extension.name,\n\t\t\tseverity: LanguageStatusSeverity.Information,\n\t\t\tcommand: undefined,\n\t\t\ttext: '',\n\t\t\tdetail: '',\n\t\t\tbusy: false\n\t\t};\n\n\n\t\tlet soonHandle: IDisposable | undefined;\n\t\tconst commandDisposables = new DisposableStore();\n\t\tconst updateAsync = () => {\n\t\t\tsoonHandle?.dispose();\n\n\t\t\tif (!ids.has(fullyQualifiedId)) {\n\t\t\t\tconsole.warn(`LanguageStatusItem (${id}) from ${extension.identifier.value} has been disposed and CANNOT be updated anymore`);\n\t\t\t\treturn; // disposed in the meantime\n\t\t\t}\n\n\t\t\tsoonHandle = disposableTimeout(() => {\n\t\t\t\tcommandDisposables.clear();\n\t\t\t\tthis._proxy.$setLanguageStatus(handle, {\n\t\t\t\t\tid: fullyQualifiedId,\n\t\t\t\t\tname: data.name ?? extension.displayName ?? extension.name,\n\t\t\t\t\tsource: extension.displayName ?? extension.name,\n\t\t\t\t\tselector: typeConvert.DocumentSelector.from(data.selector, this._uriTransformer),\n\t\t\t\t\tlabel: data.text,\n\t\t\t\t\tdetail: data.detail ?? '',\n\t\t\t\t\tseverity: data.severity === LanguageStatusSeverity.Error ? Severity.Error : data.severity === LanguageStatusSeverity.Warning ? Severity.Warning : Severity.Info,\n\t\t\t\t\tcommand: data.command && this._commands.toInternal(data.command, commandDisposables),\n\t\t\t\t\taccessibilityInfo: data.accessibilityInformation,\n\t\t\t\t\tbusy: data.busy\n\t\t\t\t});\n\t\t\t}, 0);\n\t\t};\n\n\t\tconst result: vscode.LanguageStatusItem = {\n\t\t\tdispose() {\n\t\t\t\tcommandDisposables.dispose();\n\t\t\t\tsoonHandle?.dispose();\n\t\t\t\tproxy.$removeLanguageStatus(handle);\n\t\t\t\tids.delete(fullyQualifiedId);\n\t\t\t},\n\t\t\tget id() {\n\t\t\t\treturn data.id;\n\t\t\t},\n\t\t\tget name() {\n\t\t\t\treturn data.name;\n\t\t\t},\n\t\t\tset name(value) {\n\t\t\t\tdata.name = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget selector() {\n\t\t\t\treturn data.selector;\n\t\t\t},\n\t\t\tset selector(value) {\n\t\t\t\tdata.selector = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget text() {\n\t\t\t\treturn data.text;\n\t\t\t},\n\t\t\tset text(value) {\n\t\t\t\tdata.text = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget detail() {\n\t\t\t\treturn data.detail;\n\t\t\t},\n\t\t\tset detail(value) {\n\t\t\t\tdata.detail = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget severity() {\n\t\t\t\treturn data.severity;\n\t\t\t},\n\t\t\tset severity(value) {\n\t\t\t\tdata.severity = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget accessibilityInformation() {\n\t\t\t\treturn data.accessibilityInformation;\n\t\t\t},\n\t\t\tset accessibilityInformation(value) {\n\t\t\t\tdata.accessibilityInformation = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget command() {\n\t\t\t\treturn data.command;\n\t\t\t},\n\t\t\tset command(value) {\n\t\t\t\tdata.command = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget busy() {\n\t\t\t\treturn data.busy;\n\t\t\t},\n\t\t\tset busy(value: boolean) {\n\t\t\t\tdata.busy = value;\n\t\t\t\tupdateAsync();\n\t\t\t}\n\t\t};\n\t\tupdateAsync();\n\t\treturn result;\n\t}\n}\n"]}