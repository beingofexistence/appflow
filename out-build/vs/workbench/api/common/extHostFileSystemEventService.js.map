{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/api/common/extHostFileSystemEventService.ts"],"names":[],"mappings":"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","file":"extHostFileSystemEventService.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event, AsyncEmitter, IWaitUntil, IWaitUntilData } from 'vs/base/common/event';\nimport { GLOBSTAR, GLOB_SPLIT, parse } from 'vs/base/common/glob';\nimport { URI } from 'vs/base/common/uri';\nimport { ExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport type * as vscode from 'vscode';\nimport { ExtHostFileSystemEventServiceShape, FileSystemEvents, IMainContext, SourceTargetPair, IWorkspaceEditDto, IWillRunFileOperationParticipation, MainContext, IRelativePatternDto } from './extHost.protocol';\nimport * as typeConverter from './extHostTypeConverters';\nimport { Disposable, WorkspaceEdit } from './extHostTypes';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { FileOperation } from 'vs/platform/files/common/files';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IExtHostWorkspace } from 'vs/workbench/api/common/extHostWorkspace';\n\nclass FileSystemWatcher implements vscode.FileSystemWatcher {\n\n\tprivate readonly _onDidCreate = new Emitter<vscode.Uri>();\n\tprivate readonly _onDidChange = new Emitter<vscode.Uri>();\n\tprivate readonly _onDidDelete = new Emitter<vscode.Uri>();\n\n\tprivate _disposable: Disposable;\n\tprivate _config: number;\n\n\tget ignoreCreateEvents(): boolean {\n\t\treturn Boolean(this._config & 0b001);\n\t}\n\n\tget ignoreChangeEvents(): boolean {\n\t\treturn Boolean(this._config & 0b010);\n\t}\n\n\tget ignoreDeleteEvents(): boolean {\n\t\treturn Boolean(this._config & 0b100);\n\t}\n\n\tconstructor(mainContext: IMainContext, workspace: IExtHostWorkspace, extension: IExtensionDescription, dispatcher: Event<FileSystemEvents>, globPattern: string | IRelativePatternDto, ignoreCreateEvents?: boolean, ignoreChangeEvents?: boolean, ignoreDeleteEvents?: boolean) {\n\t\tconst watcherDisposable = this.ensureWatching(mainContext, extension, globPattern);\n\n\t\tthis._config = 0;\n\t\tif (ignoreCreateEvents) {\n\t\t\tthis._config += 0b001;\n\t\t}\n\t\tif (ignoreChangeEvents) {\n\t\t\tthis._config += 0b010;\n\t\t}\n\t\tif (ignoreDeleteEvents) {\n\t\t\tthis._config += 0b100;\n\t\t}\n\n\t\tconst parsedPattern = parse(globPattern);\n\n\t\t// 1.64.x behaviour change: given the new support to watch any folder\n\t\t// we start to ignore events outside the workspace when only a string\n\t\t// pattern is provided to avoid sending events to extensions that are\n\t\t// unexpected.\n\t\t// https://github.com/microsoft/vscode/issues/3025\n\t\tconst excludeOutOfWorkspaceEvents = typeof globPattern === 'string';\n\n\t\tconst subscription = dispatcher(events => {\n\t\t\tif (!ignoreCreateEvents) {\n\t\t\t\tfor (const created of events.created) {\n\t\t\t\t\tconst uri = URI.revive(created);\n\t\t\t\t\tif (parsedPattern(uri.fsPath) && (!excludeOutOfWorkspaceEvents || workspace.getWorkspaceFolder(uri))) {\n\t\t\t\t\t\tthis._onDidCreate.fire(uri);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!ignoreChangeEvents) {\n\t\t\t\tfor (const changed of events.changed) {\n\t\t\t\t\tconst uri = URI.revive(changed);\n\t\t\t\t\tif (parsedPattern(uri.fsPath) && (!excludeOutOfWorkspaceEvents || workspace.getWorkspaceFolder(uri))) {\n\t\t\t\t\t\tthis._onDidChange.fire(uri);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!ignoreDeleteEvents) {\n\t\t\t\tfor (const deleted of events.deleted) {\n\t\t\t\t\tconst uri = URI.revive(deleted);\n\t\t\t\t\tif (parsedPattern(uri.fsPath) && (!excludeOutOfWorkspaceEvents || workspace.getWorkspaceFolder(uri))) {\n\t\t\t\t\t\tthis._onDidDelete.fire(uri);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis._disposable = Disposable.from(watcherDisposable, this._onDidCreate, this._onDidChange, this._onDidDelete, subscription);\n\t}\n\n\tprivate ensureWatching(mainContext: IMainContext, extension: IExtensionDescription, globPattern: string | IRelativePatternDto): Disposable {\n\t\tconst disposable = Disposable.from();\n\n\t\tif (typeof globPattern === 'string') {\n\t\t\treturn disposable; // a pattern alone does not carry sufficient information to start watching anything\n\t\t}\n\n\t\tconst proxy = mainContext.getProxy(MainContext.MainThreadFileSystem);\n\n\t\tlet recursive = false;\n\t\tif (globPattern.pattern.includes(GLOBSTAR) || globPattern.pattern.includes(GLOB_SPLIT)) {\n\t\t\trecursive = true; // only watch recursively if pattern indicates the need for it\n\t\t}\n\n\t\tconst session = Math.random();\n\t\tproxy.$watch(extension.identifier.value, session, globPattern.baseUri, { recursive, excludes: [] /* excludes are not yet surfaced in the API */ });\n\n\t\treturn Disposable.from({ dispose: () => proxy.$unwatch(session) });\n\t}\n\n\tdispose() {\n\t\tthis._disposable.dispose();\n\t}\n\n\tget onDidCreate(): Event<vscode.Uri> {\n\t\treturn this._onDidCreate.event;\n\t}\n\n\tget onDidChange(): Event<vscode.Uri> {\n\t\treturn this._onDidChange.event;\n\t}\n\n\tget onDidDelete(): Event<vscode.Uri> {\n\t\treturn this._onDidDelete.event;\n\t}\n}\n\ninterface IExtensionListener<E> {\n\textension: IExtensionDescription;\n\t(e: E): any;\n}\n\nexport class ExtHostFileSystemEventService implements ExtHostFileSystemEventServiceShape {\n\n\tprivate readonly _onFileSystemEvent = new Emitter<FileSystemEvents>();\n\n\tprivate readonly _onDidRenameFile = new Emitter<vscode.FileRenameEvent>();\n\tprivate readonly _onDidCreateFile = new Emitter<vscode.FileCreateEvent>();\n\tprivate readonly _onDidDeleteFile = new Emitter<vscode.FileDeleteEvent>();\n\tprivate readonly _onWillRenameFile = new AsyncEmitter<vscode.FileWillRenameEvent>();\n\tprivate readonly _onWillCreateFile = new AsyncEmitter<vscode.FileWillCreateEvent>();\n\tprivate readonly _onWillDeleteFile = new AsyncEmitter<vscode.FileWillDeleteEvent>();\n\n\treadonly onDidRenameFile: Event<vscode.FileRenameEvent> = this._onDidRenameFile.event;\n\treadonly onDidCreateFile: Event<vscode.FileCreateEvent> = this._onDidCreateFile.event;\n\treadonly onDidDeleteFile: Event<vscode.FileDeleteEvent> = this._onDidDeleteFile.event;\n\n\tconstructor(\n\t\tprivate readonly _mainContext: IMainContext,\n\t\tprivate readonly _logService: ILogService,\n\t\tprivate readonly _extHostDocumentsAndEditors: ExtHostDocumentsAndEditors\n\t) {\n\t\t//\n\t}\n\n\t//--- file events\n\n\tcreateFileSystemWatcher(workspace: IExtHostWorkspace, extension: IExtensionDescription, globPattern: vscode.GlobPattern, ignoreCreateEvents?: boolean, ignoreChangeEvents?: boolean, ignoreDeleteEvents?: boolean): vscode.FileSystemWatcher {\n\t\treturn new FileSystemWatcher(this._mainContext, workspace, extension, this._onFileSystemEvent.event, typeConverter.GlobPattern.from(globPattern), ignoreCreateEvents, ignoreChangeEvents, ignoreDeleteEvents);\n\t}\n\n\t$onFileEvent(events: FileSystemEvents) {\n\t\tthis._onFileSystemEvent.fire(events);\n\t}\n\n\n\t//--- file operations\n\n\t$onDidRunFileOperation(operation: FileOperation, files: SourceTargetPair[]): void {\n\t\tswitch (operation) {\n\t\t\tcase FileOperation.MOVE:\n\t\t\t\tthis._onDidRenameFile.fire(Object.freeze({ files: files.map(f => ({ oldUri: URI.revive(f.source!), newUri: URI.revive(f.target) })) }));\n\t\t\t\tbreak;\n\t\t\tcase FileOperation.DELETE:\n\t\t\t\tthis._onDidDeleteFile.fire(Object.freeze({ files: files.map(f => URI.revive(f.target)) }));\n\t\t\t\tbreak;\n\t\t\tcase FileOperation.CREATE:\n\t\t\tcase FileOperation.COPY:\n\t\t\t\tthis._onDidCreateFile.fire(Object.freeze({ files: files.map(f => URI.revive(f.target)) }));\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t//ignore, dont send\n\t\t}\n\t}\n\n\n\tgetOnWillRenameFileEvent(extension: IExtensionDescription): Event<vscode.FileWillRenameEvent> {\n\t\treturn this._createWillExecuteEvent(extension, this._onWillRenameFile);\n\t}\n\n\tgetOnWillCreateFileEvent(extension: IExtensionDescription): Event<vscode.FileWillCreateEvent> {\n\t\treturn this._createWillExecuteEvent(extension, this._onWillCreateFile);\n\t}\n\n\tgetOnWillDeleteFileEvent(extension: IExtensionDescription): Event<vscode.FileWillDeleteEvent> {\n\t\treturn this._createWillExecuteEvent(extension, this._onWillDeleteFile);\n\t}\n\n\tprivate _createWillExecuteEvent<E extends IWaitUntil>(extension: IExtensionDescription, emitter: AsyncEmitter<E>): Event<E> {\n\t\treturn (listener, thisArg, disposables) => {\n\t\t\tconst wrappedListener: IExtensionListener<E> = function wrapped(e: E) { listener.call(thisArg, e); };\n\t\t\twrappedListener.extension = extension;\n\t\t\treturn emitter.event(wrappedListener, undefined, disposables);\n\t\t};\n\t}\n\n\tasync $onWillRunFileOperation(operation: FileOperation, files: SourceTargetPair[], timeout: number, token: CancellationToken): Promise<IWillRunFileOperationParticipation | undefined> {\n\t\tswitch (operation) {\n\t\t\tcase FileOperation.MOVE:\n\t\t\t\treturn await this._fireWillEvent(this._onWillRenameFile, { files: files.map(f => ({ oldUri: URI.revive(f.source!), newUri: URI.revive(f.target) })) }, timeout, token);\n\t\t\tcase FileOperation.DELETE:\n\t\t\t\treturn await this._fireWillEvent(this._onWillDeleteFile, { files: files.map(f => URI.revive(f.target)) }, timeout, token);\n\t\t\tcase FileOperation.CREATE:\n\t\t\tcase FileOperation.COPY:\n\t\t\t\treturn await this._fireWillEvent(this._onWillCreateFile, { files: files.map(f => URI.revive(f.target)) }, timeout, token);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async _fireWillEvent<E extends IWaitUntil>(emitter: AsyncEmitter<E>, data: IWaitUntilData<E>, timeout: number, token: CancellationToken): Promise<IWillRunFileOperationParticipation | undefined> {\n\n\t\tconst extensionNames = new Set<string>();\n\t\tconst edits: [IExtensionDescription, WorkspaceEdit][] = [];\n\n\t\tawait emitter.fireAsync(data, token, async (thenable: Promise<unknown>, listener) => {\n\t\t\t// ignore all results except for WorkspaceEdits. Those are stored in an array.\n\t\t\tconst now = Date.now();\n\t\t\tconst result = await Promise.resolve(thenable);\n\t\t\tif (result instanceof WorkspaceEdit) {\n\t\t\t\tedits.push([(<IExtensionListener<E>>listener).extension, result]);\n\t\t\t\textensionNames.add((<IExtensionListener<E>>listener).extension.displayName ?? (<IExtensionListener<E>>listener).extension.identifier.value);\n\t\t\t}\n\n\t\t\tif (Date.now() - now > timeout) {\n\t\t\t\tthis._logService.warn('SLOW file-participant', (<IExtensionListener<E>>listener).extension.identifier);\n\t\t\t}\n\t\t});\n\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (edits.length === 0) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// concat all WorkspaceEdits collected via waitUntil-call and send them over to the renderer\n\t\tconst dto: IWorkspaceEditDto = { edits: [] };\n\t\tfor (const [, edit] of edits) {\n\t\t\tconst { edits } = typeConverter.WorkspaceEdit.from(edit, {\n\t\t\t\tgetTextDocumentVersion: uri => this._extHostDocumentsAndEditors.getDocument(uri)?.version,\n\t\t\t\tgetNotebookDocumentVersion: () => undefined,\n\t\t\t});\n\t\t\tdto.edits = dto.edits.concat(edits);\n\t\t}\n\t\treturn { edit: dto, extensionNames: Array.from(extensionNames) };\n\t}\n}\n"]}