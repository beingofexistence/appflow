{"version":3,"sources":["vs/workbench/api/common/extHostNotebook.ts"],"names":[],"mappings":"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","file":"extHostNotebook.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from 'vs/nls';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IRelativePattern } from 'vs/base/common/glob';\nimport { DisposableStore, IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { ResourceMap } from 'vs/base/common/map';\nimport { MarshalledId } from 'vs/base/common/marshallingIds';\nimport { isFalsyOrWhitespace } from 'vs/base/common/strings';\nimport { assertIsDefined } from 'vs/base/common/types';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport * as files from 'vs/platform/files/common/files';\nimport { Cache } from 'vs/workbench/api/common/cache';\nimport { ExtHostNotebookShape, IMainContext, IModelAddedData, INotebookCellStatusBarListDto, INotebookDocumentsAndEditorsDelta, INotebookDocumentShowOptions, INotebookEditorAddData, INotebookPartialFileStatsWithMetadata, MainContext, MainThreadNotebookDocumentsShape, MainThreadNotebookEditorsShape, MainThreadNotebookShape, NotebookDataDto } from 'vs/workbench/api/common/extHost.protocol';\nimport { ApiCommand, ApiCommandArgument, ApiCommandResult, CommandsConverter, ExtHostCommands } from 'vs/workbench/api/common/extHostCommands';\nimport { ExtHostDocuments } from 'vs/workbench/api/common/extHostDocuments';\nimport { ExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport * as typeConverters from 'vs/workbench/api/common/extHostTypeConverters';\nimport * as extHostTypes from 'vs/workbench/api/common/extHostTypes';\nimport { INotebookExclusiveDocumentFilter, INotebookContributionData } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { SerializableObjectWithBuffers } from 'vs/workbench/services/extensions/common/proxyIdentifier';\nimport type * as vscode from 'vscode';\nimport { ExtHostCell, ExtHostNotebookDocument } from './extHostNotebookDocument';\nimport { ExtHostNotebookEditor } from './extHostNotebookEditor';\nimport { onUnexpectedExternalError } from 'vs/base/common/errors';\nimport { IExtHostConsumerFileSystem } from 'vs/workbench/api/common/extHostFileSystemConsumer';\nimport { filter } from 'vs/base/common/objects';\nimport { Schemas } from 'vs/base/common/network';\n\n\n\nexport class ExtHostNotebookController implements ExtHostNotebookShape {\n\tprivate static _notebookStatusBarItemProviderHandlePool: number = 0;\n\n\tprivate readonly _notebookProxy: MainThreadNotebookShape;\n\tprivate readonly _notebookDocumentsProxy: MainThreadNotebookDocumentsShape;\n\tprivate readonly _notebookEditorsProxy: MainThreadNotebookEditorsShape;\n\n\tprivate readonly _notebookStatusBarItemProviders = new Map<number, vscode.NotebookCellStatusBarItemProvider>();\n\tprivate readonly _documents = new ResourceMap<ExtHostNotebookDocument>();\n\tprivate readonly _editors = new Map<string, ExtHostNotebookEditor>();\n\tprivate readonly _commandsConverter: CommandsConverter;\n\n\tprivate readonly _onDidChangeActiveNotebookEditor = new Emitter<vscode.NotebookEditor | undefined>({ onListenerError: onUnexpectedExternalError });\n\treadonly onDidChangeActiveNotebookEditor = this._onDidChangeActiveNotebookEditor.event;\n\n\tprivate _activeNotebookEditor: ExtHostNotebookEditor | undefined;\n\tget activeNotebookEditor(): vscode.NotebookEditor | undefined {\n\t\treturn this._activeNotebookEditor?.apiEditor;\n\t}\n\tprivate _visibleNotebookEditors: ExtHostNotebookEditor[] = [];\n\tget visibleNotebookEditors(): vscode.NotebookEditor[] {\n\t\treturn this._visibleNotebookEditors.map(editor => editor.apiEditor);\n\t}\n\n\tprivate _onDidOpenNotebookDocument = new Emitter<vscode.NotebookDocument>({ onListenerError: onUnexpectedExternalError });\n\tonDidOpenNotebookDocument: Event<vscode.NotebookDocument> = this._onDidOpenNotebookDocument.event;\n\tprivate _onDidCloseNotebookDocument = new Emitter<vscode.NotebookDocument>({ onListenerError: onUnexpectedExternalError });\n\tonDidCloseNotebookDocument: Event<vscode.NotebookDocument> = this._onDidCloseNotebookDocument.event;\n\n\tprivate _onDidChangeVisibleNotebookEditors = new Emitter<vscode.NotebookEditor[]>({ onListenerError: onUnexpectedExternalError });\n\tonDidChangeVisibleNotebookEditors = this._onDidChangeVisibleNotebookEditors.event;\n\n\tprivate _statusBarCache = new Cache<IDisposable>('NotebookCellStatusBarCache');\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tcommands: ExtHostCommands,\n\t\tprivate _textDocumentsAndEditors: ExtHostDocumentsAndEditors,\n\t\tprivate _textDocuments: ExtHostDocuments,\n\t\tprivate _extHostFileSystem: IExtHostConsumerFileSystem\n\t) {\n\t\tthis._notebookProxy = mainContext.getProxy(MainContext.MainThreadNotebook);\n\t\tthis._notebookDocumentsProxy = mainContext.getProxy(MainContext.MainThreadNotebookDocuments);\n\t\tthis._notebookEditorsProxy = mainContext.getProxy(MainContext.MainThreadNotebookEditors);\n\t\tthis._commandsConverter = commands.converter;\n\n\t\tcommands.registerArgumentProcessor({\n\t\t\t// Serialized INotebookCellActionContext\n\t\t\tprocessArgument: (arg) => {\n\t\t\t\tif (arg && arg.$mid === MarshalledId.NotebookCellActionContext) {\n\t\t\t\t\tconst notebookUri = arg.notebookEditor?.notebookUri;\n\t\t\t\t\tconst cellHandle = arg.cell.handle;\n\n\t\t\t\t\tconst data = this._documents.get(notebookUri);\n\t\t\t\t\tconst cell = data?.getCell(cellHandle);\n\t\t\t\t\tif (cell) {\n\t\t\t\t\t\treturn cell.apiCell;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (arg && arg.$mid === MarshalledId.NotebookActionContext) {\n\t\t\t\t\tconst notebookUri = arg.uri;\n\t\t\t\t\tconst data = this._documents.get(notebookUri);\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\treturn data.apiNotebook;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn arg;\n\t\t\t}\n\t\t});\n\n\t\tExtHostNotebookController._registerApiCommands(commands);\n\t}\n\n\tgetEditorById(editorId: string): ExtHostNotebookEditor {\n\t\tconst editor = this._editors.get(editorId);\n\t\tif (!editor) {\n\t\t\tthrow new Error(`unknown text editor: ${editorId}. known editors: ${[...this._editors.keys()]} `);\n\t\t}\n\t\treturn editor;\n\t}\n\n\tgetIdByEditor(editor: vscode.NotebookEditor): string | undefined {\n\t\tfor (const [id, candidate] of this._editors) {\n\t\t\tif (candidate.apiEditor === editor) {\n\t\t\t\treturn id;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tget notebookDocuments() {\n\t\treturn [...this._documents.values()];\n\t}\n\n\tgetNotebookDocument(uri: URI, relaxed: true): ExtHostNotebookDocument | undefined;\n\tgetNotebookDocument(uri: URI): ExtHostNotebookDocument;\n\tgetNotebookDocument(uri: URI, relaxed?: true): ExtHostNotebookDocument | undefined {\n\t\tconst result = this._documents.get(uri);\n\t\tif (!result && !relaxed) {\n\t\t\tthrow new Error(`NO notebook document for '${uri}'`);\n\t\t}\n\t\treturn result;\n\t}\n\n\n\n\tprivate static _convertNotebookRegistrationData(extension: IExtensionDescription, registration: vscode.NotebookRegistrationData | undefined): INotebookContributionData | undefined {\n\t\tif (!registration) {\n\t\t\treturn;\n\t\t}\n\t\tconst viewOptionsFilenamePattern = registration.filenamePattern\n\t\t\t.map(pattern => typeConverters.NotebookExclusiveDocumentPattern.from(pattern))\n\t\t\t.filter(pattern => pattern !== undefined) as (string | IRelativePattern | INotebookExclusiveDocumentFilter)[];\n\t\tif (registration.filenamePattern && !viewOptionsFilenamePattern) {\n\t\t\tconsole.warn(`Notebook content provider view options file name pattern is invalid ${registration.filenamePattern}`);\n\t\t\treturn undefined;\n\t\t}\n\t\treturn {\n\t\t\textension: extension.identifier,\n\t\t\tproviderDisplayName: extension.displayName || extension.name,\n\t\t\tdisplayName: registration.displayName,\n\t\t\tfilenamePattern: viewOptionsFilenamePattern,\n\t\t\texclusive: registration.exclusive || false\n\t\t};\n\t}\n\n\tregisterNotebookCellStatusBarItemProvider(extension: IExtensionDescription, notebookType: string, provider: vscode.NotebookCellStatusBarItemProvider) {\n\n\t\tconst handle = ExtHostNotebookController._notebookStatusBarItemProviderHandlePool++;\n\t\tconst eventHandle = typeof provider.onDidChangeCellStatusBarItems === 'function' ? ExtHostNotebookController._notebookStatusBarItemProviderHandlePool++ : undefined;\n\n\t\tthis._notebookStatusBarItemProviders.set(handle, provider);\n\t\tthis._notebookProxy.$registerNotebookCellStatusBarItemProvider(handle, eventHandle, notebookType);\n\n\t\tlet subscription: vscode.Disposable | undefined;\n\t\tif (eventHandle !== undefined) {\n\t\t\tsubscription = provider.onDidChangeCellStatusBarItems!(_ => this._notebookProxy.$emitCellStatusBarEvent(eventHandle));\n\t\t}\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tthis._notebookStatusBarItemProviders.delete(handle);\n\t\t\tthis._notebookProxy.$unregisterNotebookCellStatusBarItemProvider(handle, eventHandle);\n\t\t\tsubscription?.dispose();\n\t\t});\n\t}\n\n\tasync createNotebookDocument(options: { viewType: string; content?: vscode.NotebookData }): Promise<URI> {\n\t\tconst canonicalUri = await this._notebookDocumentsProxy.$tryCreateNotebook({\n\t\t\tviewType: options.viewType,\n\t\t\tcontent: options.content && typeConverters.NotebookData.from(options.content)\n\t\t});\n\t\treturn URI.revive(canonicalUri);\n\t}\n\n\tasync openNotebookDocument(uri: URI): Promise<vscode.NotebookDocument> {\n\t\tconst cached = this._documents.get(uri);\n\t\tif (cached) {\n\t\t\treturn cached.apiNotebook;\n\t\t}\n\t\tconst canonicalUri = await this._notebookDocumentsProxy.$tryOpenNotebook(uri);\n\t\tconst document = this._documents.get(URI.revive(canonicalUri));\n\t\treturn assertIsDefined(document?.apiNotebook);\n\t}\n\n\n\tasync showNotebookDocument(notebookOrUri: vscode.NotebookDocument | URI, options?: vscode.NotebookDocumentShowOptions): Promise<vscode.NotebookEditor> {\n\n\t\tif (URI.isUri(notebookOrUri)) {\n\t\t\tnotebookOrUri = await this.openNotebookDocument(notebookOrUri);\n\t\t}\n\n\t\tlet resolvedOptions: INotebookDocumentShowOptions;\n\t\tif (typeof options === 'object') {\n\t\t\tresolvedOptions = {\n\t\t\t\tposition: typeConverters.ViewColumn.from(options.viewColumn),\n\t\t\t\tpreserveFocus: options.preserveFocus,\n\t\t\t\tselections: options.selections && options.selections.map(typeConverters.NotebookRange.from),\n\t\t\t\tpinned: typeof options.preview === 'boolean' ? !options.preview : undefined\n\t\t\t};\n\t\t} else {\n\t\t\tresolvedOptions = {\n\t\t\t\tpreserveFocus: false\n\t\t\t};\n\t\t}\n\n\t\tconst editorId = await this._notebookEditorsProxy.$tryShowNotebookDocument(notebookOrUri.uri, notebookOrUri.notebookType, resolvedOptions);\n\t\tconst editor = editorId && this._editors.get(editorId)?.apiEditor;\n\n\t\tif (editor) {\n\t\t\treturn editor;\n\t\t}\n\n\t\tif (editorId) {\n\t\t\tthrow new Error(`Could NOT open editor for \"${notebookOrUri.uri.toString()}\" because another editor opened in the meantime.`);\n\t\t} else {\n\t\t\tthrow new Error(`Could NOT open editor for \"${notebookOrUri.uri.toString()}\".`);\n\t\t}\n\t}\n\n\tasync $provideNotebookCellStatusBarItems(handle: number, uri: UriComponents, index: number, token: CancellationToken): Promise<INotebookCellStatusBarListDto | undefined> {\n\t\tconst provider = this._notebookStatusBarItemProviders.get(handle);\n\t\tconst revivedUri = URI.revive(uri);\n\t\tconst document = this._documents.get(revivedUri);\n\t\tif (!document || !provider) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cell = document.getCellFromIndex(index);\n\t\tif (!cell) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst result = await provider.provideCellStatusBarItems(cell.apiCell, token);\n\t\tif (!result) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst disposables = new DisposableStore();\n\t\tconst cacheId = this._statusBarCache.add([disposables]);\n\t\tconst resultArr = Array.isArray(result) ? result : [result];\n\t\tconst items = resultArr.map(item => typeConverters.NotebookStatusBarItem.from(item, this._commandsConverter, disposables));\n\t\treturn {\n\t\t\tcacheId,\n\t\t\titems\n\t\t};\n\t}\n\n\t$releaseNotebookCellStatusBarItems(cacheId: number): void {\n\t\tthis._statusBarCache.delete(cacheId);\n\t}\n\n\t// --- serialize/deserialize\n\n\tprivate _handlePool = 0;\n\tprivate readonly _notebookSerializer = new Map<number, { viewType: string; serializer: vscode.NotebookSerializer; options: vscode.NotebookDocumentContentOptions | undefined }>();\n\n\tregisterNotebookSerializer(extension: IExtensionDescription, viewType: string, serializer: vscode.NotebookSerializer, options?: vscode.NotebookDocumentContentOptions, registration?: vscode.NotebookRegistrationData): vscode.Disposable {\n\t\tif (isFalsyOrWhitespace(viewType)) {\n\t\t\tthrow new Error(`viewType cannot be empty or just whitespace`);\n\t\t}\n\t\tconst handle = this._handlePool++;\n\t\tthis._notebookSerializer.set(handle, { viewType, serializer, options });\n\t\tthis._notebookProxy.$registerNotebookSerializer(\n\t\t\thandle,\n\t\t\t{ id: extension.identifier, location: extension.extensionLocation },\n\t\t\tviewType,\n\t\t\ttypeConverters.NotebookDocumentContentOptions.from(options),\n\t\t\tExtHostNotebookController._convertNotebookRegistrationData(extension, registration)\n\t\t);\n\t\treturn toDisposable(() => {\n\t\t\tthis._notebookProxy.$unregisterNotebookSerializer(handle);\n\t\t});\n\t}\n\n\tasync $dataToNotebook(handle: number, bytes: VSBuffer, token: CancellationToken): Promise<SerializableObjectWithBuffers<NotebookDataDto>> {\n\t\tconst serializer = this._notebookSerializer.get(handle);\n\t\tif (!serializer) {\n\t\t\tthrow new Error('NO serializer found');\n\t\t}\n\t\tconst data = await serializer.serializer.deserializeNotebook(bytes.buffer, token);\n\t\treturn new SerializableObjectWithBuffers(typeConverters.NotebookData.from(data));\n\t}\n\n\tasync $notebookToData(handle: number, data: SerializableObjectWithBuffers<NotebookDataDto>, token: CancellationToken): Promise<VSBuffer> {\n\t\tconst serializer = this._notebookSerializer.get(handle);\n\t\tif (!serializer) {\n\t\t\tthrow new Error('NO serializer found');\n\t\t}\n\t\tconst bytes = await serializer.serializer.serializeNotebook(typeConverters.NotebookData.to(data.value), token);\n\t\treturn VSBuffer.wrap(bytes);\n\t}\n\n\tasync $saveNotebook(handle: number, uriComponents: UriComponents, versionId: number, options: files.IWriteFileOptions, token: CancellationToken): Promise<INotebookPartialFileStatsWithMetadata> {\n\t\tconst uri = URI.revive(uriComponents);\n\t\tconst serializer = this._notebookSerializer.get(handle);\n\t\tif (!serializer) {\n\t\t\tthrow new Error('NO serializer found');\n\t\t}\n\n\t\tconst document = this._documents.get(uri);\n\t\tif (!document) {\n\t\t\tthrow new Error('Document NOT found');\n\t\t}\n\n\t\tif (document.versionId !== versionId) {\n\t\t\tthrow new Error('Document version mismatch');\n\t\t}\n\n\t\tif (!this._extHostFileSystem.value.isWritableFileSystem(uri.scheme)) {\n\t\t\tthrow new files.FileOperationError(localize('err.readonly', \"Unable to modify read-only file '{0}'\", this._resourceForError(uri)), files.FileOperationResult.FILE_PERMISSION_DENIED);\n\t\t}\n\n\t\t// validate write\n\t\tawait this._validateWriteFile(uri, options);\n\n\t\tconst data: vscode.NotebookData = {\n\t\t\tmetadata: filter(document.apiNotebook.metadata, key => !(serializer.options?.transientDocumentMetadata ?? {})[key]),\n\t\t\tcells: [],\n\t\t};\n\n\t\tfor (const cell of document.apiNotebook.getCells()) {\n\t\t\tconst cellData = new extHostTypes.NotebookCellData(\n\t\t\t\tcell.kind,\n\t\t\t\tcell.document.getText(),\n\t\t\t\tcell.document.languageId,\n\t\t\t\tcell.mime,\n\t\t\t\t!(serializer.options?.transientOutputs) ? [...cell.outputs] : [],\n\t\t\t\tcell.metadata,\n\t\t\t\tcell.executionSummary\n\t\t\t);\n\n\t\t\tcellData.metadata = filter(cell.metadata, key => !(serializer.options?.transientCellMetadata ?? {})[key]);\n\t\t\tdata.cells.push(cellData);\n\t\t}\n\n\t\tconst bytes = await serializer.serializer.serializeNotebook(data, token);\n\t\tawait this._extHostFileSystem.value.writeFile(uri, bytes);\n\t\tconst providerExtUri = this._extHostFileSystem.getFileSystemProviderExtUri(uri.scheme);\n\t\tconst stat = await this._extHostFileSystem.value.stat(uri);\n\n\t\tconst fileStats = {\n\t\t\tname: providerExtUri.basename(uri),\n\t\t\tisFile: (stat.type & files.FileType.File) !== 0,\n\t\t\tisDirectory: (stat.type & files.FileType.Directory) !== 0,\n\t\t\tisSymbolicLink: (stat.type & files.FileType.SymbolicLink) !== 0,\n\t\t\tmtime: stat.mtime,\n\t\t\tctime: stat.ctime,\n\t\t\tsize: stat.size,\n\t\t\treadonly: Boolean((stat.permissions ?? 0) & files.FilePermission.Readonly) || !this._extHostFileSystem.value.isWritableFileSystem(uri.scheme),\n\t\t\tlocked: Boolean((stat.permissions ?? 0) & files.FilePermission.Locked),\n\t\t\tetag: files.etag({ mtime: stat.mtime, size: stat.size }),\n\t\t\tchildren: undefined\n\t\t};\n\n\t\treturn fileStats;\n\t}\n\n\tprivate async _validateWriteFile(uri: URI, options: files.IWriteFileOptions) {\n\t\tconst stat = await this._extHostFileSystem.value.stat(uri);\n\t\t// Dirty write prevention\n\t\tif (\n\t\t\ttypeof options?.mtime === 'number' && typeof options.etag === 'string' && options.etag !== files.ETAG_DISABLED &&\n\t\t\ttypeof stat.mtime === 'number' && typeof stat.size === 'number' &&\n\t\t\toptions.mtime < stat.mtime && options.etag !== files.etag({ mtime: options.mtime /* not using stat.mtime for a reason, see above */, size: stat.size })\n\t\t) {\n\t\t\tthrow new files.FileOperationError(localize('fileModifiedError', \"File Modified Since\"), files.FileOperationResult.FILE_MODIFIED_SINCE, options);\n\t\t}\n\n\t\treturn;\n\t}\n\n\tprivate _resourceForError(uri: URI): string {\n\t\treturn uri.scheme === Schemas.file ? uri.fsPath : uri.toString();\n\t}\n\n\t// --- open, save, saveAs, backup\n\n\n\tprivate _createExtHostEditor(document: ExtHostNotebookDocument, editorId: string, data: INotebookEditorAddData) {\n\n\t\tif (this._editors.has(editorId)) {\n\t\t\tthrow new Error(`editor with id ALREADY EXSIST: ${editorId}`);\n\t\t}\n\n\t\tconst editor = new ExtHostNotebookEditor(\n\t\t\teditorId,\n\t\t\tthis._notebookEditorsProxy,\n\t\t\tdocument,\n\t\t\tdata.visibleRanges.map(typeConverters.NotebookRange.to),\n\t\t\tdata.selections.map(typeConverters.NotebookRange.to),\n\t\t\ttypeof data.viewColumn === 'number' ? typeConverters.ViewColumn.to(data.viewColumn) : undefined\n\t\t);\n\n\t\tthis._editors.set(editorId, editor);\n\t}\n\n\t$acceptDocumentAndEditorsDelta(delta: SerializableObjectWithBuffers<INotebookDocumentsAndEditorsDelta>): void {\n\n\t\tif (delta.value.removedDocuments) {\n\t\t\tfor (const uri of delta.value.removedDocuments) {\n\t\t\t\tconst revivedUri = URI.revive(uri);\n\t\t\t\tconst document = this._documents.get(revivedUri);\n\n\t\t\t\tif (document) {\n\t\t\t\t\tdocument.dispose();\n\t\t\t\t\tthis._documents.delete(revivedUri);\n\t\t\t\t\tthis._textDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({ removedDocuments: document.apiNotebook.getCells().map(cell => cell.document.uri) });\n\t\t\t\t\tthis._onDidCloseNotebookDocument.fire(document.apiNotebook);\n\t\t\t\t}\n\n\t\t\t\tfor (const editor of this._editors.values()) {\n\t\t\t\t\tif (editor.notebookData.uri.toString() === revivedUri.toString()) {\n\t\t\t\t\t\tthis._editors.delete(editor.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (delta.value.addedDocuments) {\n\n\t\t\tconst addedCellDocuments: IModelAddedData[] = [];\n\n\t\t\tfor (const modelData of delta.value.addedDocuments) {\n\t\t\t\tconst uri = URI.revive(modelData.uri);\n\n\t\t\t\tif (this._documents.has(uri)) {\n\t\t\t\t\tthrow new Error(`adding EXISTING notebook ${uri} `);\n\t\t\t\t}\n\n\t\t\t\tconst document = new ExtHostNotebookDocument(\n\t\t\t\t\tthis._notebookDocumentsProxy,\n\t\t\t\t\tthis._textDocumentsAndEditors,\n\t\t\t\t\tthis._textDocuments,\n\t\t\t\t\turi,\n\t\t\t\t\tmodelData\n\t\t\t\t);\n\n\t\t\t\t// add cell document as vscode.TextDocument\n\t\t\t\taddedCellDocuments.push(...modelData.cells.map(cell => ExtHostCell.asModelAddData(document.apiNotebook, cell)));\n\n\t\t\t\tthis._documents.get(uri)?.dispose();\n\t\t\t\tthis._documents.set(uri, document);\n\t\t\t\tthis._textDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({ addedDocuments: addedCellDocuments });\n\n\t\t\t\tthis._onDidOpenNotebookDocument.fire(document.apiNotebook);\n\t\t\t}\n\t\t}\n\n\t\tif (delta.value.addedEditors) {\n\t\t\tfor (const editorModelData of delta.value.addedEditors) {\n\t\t\t\tif (this._editors.has(editorModelData.id)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst revivedUri = URI.revive(editorModelData.documentUri);\n\t\t\t\tconst document = this._documents.get(revivedUri);\n\n\t\t\t\tif (document) {\n\t\t\t\t\tthis._createExtHostEditor(document, editorModelData.id, editorModelData);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst removedEditors: ExtHostNotebookEditor[] = [];\n\n\t\tif (delta.value.removedEditors) {\n\t\t\tfor (const editorid of delta.value.removedEditors) {\n\t\t\t\tconst editor = this._editors.get(editorid);\n\n\t\t\t\tif (editor) {\n\t\t\t\t\tthis._editors.delete(editorid);\n\n\t\t\t\t\tif (this._activeNotebookEditor?.id === editor.id) {\n\t\t\t\t\t\tthis._activeNotebookEditor = undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\tremovedEditors.push(editor);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (delta.value.visibleEditors) {\n\t\t\tthis._visibleNotebookEditors = delta.value.visibleEditors.map(id => this._editors.get(id)!).filter(editor => !!editor) as ExtHostNotebookEditor[];\n\t\t\tconst visibleEditorsSet = new Set<string>();\n\t\t\tthis._visibleNotebookEditors.forEach(editor => visibleEditorsSet.add(editor.id));\n\n\t\t\tfor (const editor of this._editors.values()) {\n\t\t\t\tconst newValue = visibleEditorsSet.has(editor.id);\n\t\t\t\teditor._acceptVisibility(newValue);\n\t\t\t}\n\n\t\t\tthis._visibleNotebookEditors = [...this._editors.values()].map(e => e).filter(e => e.visible);\n\t\t\tthis._onDidChangeVisibleNotebookEditors.fire(this.visibleNotebookEditors);\n\t\t}\n\n\t\tif (delta.value.newActiveEditor === null) {\n\t\t\t// clear active notebook as current active editor is non-notebook editor\n\t\t\tthis._activeNotebookEditor = undefined;\n\t\t} else if (delta.value.newActiveEditor) {\n\t\t\tconst activeEditor = this._editors.get(delta.value.newActiveEditor);\n\t\t\tif (!activeEditor) {\n\t\t\t\tconsole.error(`FAILED to find active notebook editor ${delta.value.newActiveEditor}`);\n\t\t\t}\n\t\t\tthis._activeNotebookEditor = this._editors.get(delta.value.newActiveEditor);\n\t\t}\n\t\tif (delta.value.newActiveEditor !== undefined) {\n\t\t\tthis._onDidChangeActiveNotebookEditor.fire(this._activeNotebookEditor?.apiEditor);\n\t\t}\n\t}\n\n\tprivate static _registerApiCommands(extHostCommands: ExtHostCommands) {\n\n\t\tconst notebookTypeArg = ApiCommandArgument.String.with('notebookType', 'A notebook type');\n\n\t\tconst commandDataToNotebook = new ApiCommand(\n\t\t\t'vscode.executeDataToNotebook', '_executeDataToNotebook', 'Invoke notebook serializer',\n\t\t\t[notebookTypeArg, new ApiCommandArgument<Uint8Array, VSBuffer>('data', 'Bytes to convert to data', v => v instanceof Uint8Array, v => VSBuffer.wrap(v))],\n\t\t\tnew ApiCommandResult<SerializableObjectWithBuffers<NotebookDataDto>, vscode.NotebookData>('Notebook Data', data => typeConverters.NotebookData.to(data.value))\n\t\t);\n\n\t\tconst commandNotebookToData = new ApiCommand(\n\t\t\t'vscode.executeNotebookToData', '_executeNotebookToData', 'Invoke notebook serializer',\n\t\t\t[notebookTypeArg, new ApiCommandArgument<vscode.NotebookData, SerializableObjectWithBuffers<NotebookDataDto>>('NotebookData', 'Notebook data to convert to bytes', v => true, v => new SerializableObjectWithBuffers(typeConverters.NotebookData.from(v)))],\n\t\t\tnew ApiCommandResult<VSBuffer, Uint8Array>('Bytes', dto => dto.buffer)\n\t\t);\n\n\t\textHostCommands.registerApiCommand(commandDataToNotebook);\n\t\textHostCommands.registerApiCommand(commandNotebookToData);\n\t}\n}\n"]}