{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/api/browser/mainThreadDiagnostics.ts"],"names":[],"mappings":"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","file":"mainThreadDiagnostics.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IMarkerService, IMarkerData } from 'vs/platform/markers/common/markers';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { MainThreadDiagnosticsShape, MainContext, ExtHostDiagnosticsShape, ExtHostContext } from '../common/extHost.protocol';\nimport { extHostNamedCustomer, IExtHostContext } from 'vs/workbench/services/extensions/common/extHostCustomers';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { IUriIdentityService } from 'vs/platform/uriIdentity/common/uriIdentity';\n\n@extHostNamedCustomer(MainContext.MainThreadDiagnostics)\nexport class MainThreadDiagnostics implements MainThreadDiagnosticsShape {\n\n\tprivate readonly _activeOwners = new Set<string>();\n\n\tprivate readonly _proxy: ExtHostDiagnosticsShape;\n\tprivate readonly _markerListener: IDisposable;\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IMarkerService private readonly _markerService: IMarkerService,\n\t\t@IUriIdentityService private readonly _uriIdentService: IUriIdentityService,\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostDiagnostics);\n\n\t\tthis._markerListener = this._markerService.onMarkerChanged(this._forwardMarkers, this);\n\t}\n\n\tdispose(): void {\n\t\tthis._markerListener.dispose();\n\t\tthis._activeOwners.forEach(owner => this._markerService.changeAll(owner, []));\n\t\tthis._activeOwners.clear();\n\t}\n\n\tprivate _forwardMarkers(resources: readonly URI[]): void {\n\t\tconst data: [UriComponents, IMarkerData[]][] = [];\n\t\tfor (const resource of resources) {\n\t\t\tconst allMarkerData = this._markerService.read({ resource });\n\t\t\tif (allMarkerData.length === 0) {\n\t\t\t\tdata.push([resource, []]);\n\t\t\t} else {\n\t\t\t\tconst forgeinMarkerData = allMarkerData.filter(marker => !this._activeOwners.has(marker.owner));\n\t\t\t\tif (forgeinMarkerData.length > 0) {\n\t\t\t\t\tdata.push([resource, forgeinMarkerData]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (data.length > 0) {\n\t\t\tthis._proxy.$acceptMarkersChange(data);\n\t\t}\n\t}\n\n\t$changeMany(owner: string, entries: [UriComponents, IMarkerData[]][]): void {\n\t\tfor (const entry of entries) {\n\t\t\tconst [uri, markers] = entry;\n\t\t\tif (markers) {\n\t\t\t\tfor (const marker of markers) {\n\t\t\t\t\tif (marker.relatedInformation) {\n\t\t\t\t\t\tfor (const relatedInformation of marker.relatedInformation) {\n\t\t\t\t\t\t\trelatedInformation.resource = URI.revive(relatedInformation.resource);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (marker.code && typeof marker.code !== 'string') {\n\t\t\t\t\t\tmarker.code.target = URI.revive(marker.code.target);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._markerService.changeOne(owner, this._uriIdentService.asCanonicalUri(URI.revive(uri)), markers);\n\t\t}\n\t\tthis._activeOwners.add(owner);\n\t}\n\n\t$clear(owner: string): void {\n\t\tthis._markerService.changeAll(owner, []);\n\t\tthis._activeOwners.delete(owner);\n\t}\n}\n"]}