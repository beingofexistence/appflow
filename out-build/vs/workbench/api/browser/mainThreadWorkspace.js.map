{"version":3,"sources":["vs/workbench/api/browser/mainThreadWorkspace.ts"],"names":[],"mappings":"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","file":"mainThreadWorkspace.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { isCancellationError } from 'vs/base/common/errors';\nimport { DisposableStore, IDisposable } from 'vs/base/common/lifecycle';\nimport { isNative } from 'vs/base/common/platform';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { localize } from 'vs/nls';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { IRequestService } from 'vs/platform/request/common/request';\nimport { WorkspaceTrustRequestOptions, IWorkspaceTrustManagementService, IWorkspaceTrustRequestService } from 'vs/platform/workspace/common/workspaceTrust';\nimport { IWorkspace, IWorkspaceContextService, WorkbenchState, isUntitledWorkspace, WorkspaceFolder } from 'vs/platform/workspace/common/workspace';\nimport { extHostNamedCustomer, IExtHostContext } from 'vs/workbench/services/extensions/common/extHostCustomers';\nimport { checkGlobFileExists } from 'vs/workbench/services/extensions/common/workspaceContains';\nimport { ITextQueryBuilderOptions, QueryBuilder } from 'vs/workbench/services/search/common/queryBuilder';\nimport { IEditorService, ISaveEditorsResult } from 'vs/workbench/services/editor/common/editorService';\nimport { IFileMatch, IPatternInfo, ISearchProgressItem, ISearchService } from 'vs/workbench/services/search/common/search';\nimport { IWorkspaceEditingService } from 'vs/workbench/services/workspaces/common/workspaceEditing';\nimport { ExtHostContext, ExtHostWorkspaceShape, ITextSearchComplete, IWorkspaceData, MainContext, MainThreadWorkspaceShape } from '../common/extHost.protocol';\nimport { IEditSessionIdentityService } from 'vs/platform/workspace/common/editSessions';\nimport { EditorResourceAccessor, SaveReason, SideBySideEditor } from 'vs/workbench/common/editor';\nimport { coalesce, firstOrDefault } from 'vs/base/common/arrays';\nimport { ICanonicalUriService } from 'vs/platform/workspace/common/canonicalUri';\n\n@extHostNamedCustomer(MainContext.MainThreadWorkspace)\nexport class MainThreadWorkspace implements MainThreadWorkspaceShape {\n\n\tprivate readonly _toDispose = new DisposableStore();\n\tprivate readonly _activeCancelTokens: { [id: number]: CancellationTokenSource } = Object.create(null);\n\tprivate readonly _proxy: ExtHostWorkspaceShape;\n\tprivate readonly _queryBuilder = this._instantiationService.createInstance(QueryBuilder);\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ISearchService private readonly _searchService: ISearchService,\n\t\t@IWorkspaceContextService private readonly _contextService: IWorkspaceContextService,\n\t\t@IEditSessionIdentityService private readonly _editSessionIdentityService: IEditSessionIdentityService,\n\t\t@ICanonicalUriService private readonly _canonicalUriService: ICanonicalUriService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IWorkspaceEditingService private readonly _workspaceEditingService: IWorkspaceEditingService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@IRequestService private readonly _requestService: IRequestService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ILabelService private readonly _labelService: ILabelService,\n\t\t@IEnvironmentService private readonly _environmentService: IEnvironmentService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IWorkspaceTrustManagementService private readonly _workspaceTrustManagementService: IWorkspaceTrustManagementService,\n\t\t@IWorkspaceTrustRequestService private readonly _workspaceTrustRequestService: IWorkspaceTrustRequestService\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostWorkspace);\n\t\tconst workspace = this._contextService.getWorkspace();\n\t\t// The workspace file is provided be a unknown file system provider. It might come\n\t\t// from the extension host. So initialize now knowing that `rootPath` is undefined.\n\t\tif (workspace.configuration && !isNative && !fileService.hasProvider(workspace.configuration)) {\n\t\t\tthis._proxy.$initializeWorkspace(this.getWorkspaceData(workspace), this.isWorkspaceTrusted());\n\t\t} else {\n\t\t\tthis._contextService.getCompleteWorkspace().then(workspace => this._proxy.$initializeWorkspace(this.getWorkspaceData(workspace), this.isWorkspaceTrusted()));\n\t\t}\n\t\tthis._contextService.onDidChangeWorkspaceFolders(this._onDidChangeWorkspace, this, this._toDispose);\n\t\tthis._contextService.onDidChangeWorkbenchState(this._onDidChangeWorkspace, this, this._toDispose);\n\t\tthis._workspaceTrustManagementService.onDidChangeTrust(this._onDidGrantWorkspaceTrust, this, this._toDispose);\n\t}\n\n\tdispose(): void {\n\t\tthis._toDispose.dispose();\n\n\t\tfor (const requestId in this._activeCancelTokens) {\n\t\t\tconst tokenSource = this._activeCancelTokens[requestId];\n\t\t\ttokenSource.cancel();\n\t\t}\n\t}\n\n\t// --- workspace ---\n\n\t$updateWorkspaceFolders(extensionName: string, index: number, deleteCount: number, foldersToAdd: { uri: UriComponents; name?: string }[]): Promise<void> {\n\t\tconst workspaceFoldersToAdd = foldersToAdd.map(f => ({ uri: URI.revive(f.uri), name: f.name }));\n\n\t\t// Indicate in status message\n\t\tthis._notificationService.status(this.getStatusMessage(extensionName, workspaceFoldersToAdd.length, deleteCount), { hideAfter: 10 * 1000 /* 10s */ });\n\n\t\treturn this._workspaceEditingService.updateFolders(index, deleteCount, workspaceFoldersToAdd, true);\n\t}\n\n\tprivate getStatusMessage(extensionName: string, addCount: number, removeCount: number): string {\n\t\tlet message: string;\n\n\t\tconst wantsToAdd = addCount > 0;\n\t\tconst wantsToDelete = removeCount > 0;\n\n\t\t// Add Folders\n\t\tif (wantsToAdd && !wantsToDelete) {\n\t\t\tif (addCount === 1) {\n\t\t\t\tmessage = localize('folderStatusMessageAddSingleFolder', \"Extension '{0}' added 1 folder to the workspace\", extensionName);\n\t\t\t} else {\n\t\t\t\tmessage = localize('folderStatusMessageAddMultipleFolders', \"Extension '{0}' added {1} folders to the workspace\", extensionName, addCount);\n\t\t\t}\n\t\t}\n\n\t\t// Delete Folders\n\t\telse if (wantsToDelete && !wantsToAdd) {\n\t\t\tif (removeCount === 1) {\n\t\t\t\tmessage = localize('folderStatusMessageRemoveSingleFolder', \"Extension '{0}' removed 1 folder from the workspace\", extensionName);\n\t\t\t} else {\n\t\t\t\tmessage = localize('folderStatusMessageRemoveMultipleFolders', \"Extension '{0}' removed {1} folders from the workspace\", extensionName, removeCount);\n\t\t\t}\n\t\t}\n\n\t\t// Change Folders\n\t\telse {\n\t\t\tmessage = localize('folderStatusChangeFolder', \"Extension '{0}' changed folders of the workspace\", extensionName);\n\t\t}\n\n\t\treturn message;\n\t}\n\n\tprivate _onDidChangeWorkspace(): void {\n\t\tthis._proxy.$acceptWorkspaceData(this.getWorkspaceData(this._contextService.getWorkspace()));\n\t}\n\n\tprivate getWorkspaceData(workspace: IWorkspace): IWorkspaceData | null {\n\t\tif (this._contextService.getWorkbenchState() === WorkbenchState.EMPTY) {\n\t\t\treturn null;\n\t\t}\n\t\treturn {\n\t\t\tconfiguration: workspace.configuration || undefined,\n\t\t\tisUntitled: workspace.configuration ? isUntitledWorkspace(workspace.configuration, this._environmentService) : false,\n\t\t\tfolders: workspace.folders,\n\t\t\tid: workspace.id,\n\t\t\tname: this._labelService.getWorkspaceLabel(workspace),\n\t\t\ttransient: workspace.transient\n\t\t};\n\t}\n\n\t// --- search ---\n\n\t$startFileSearch(includePattern: string | null, _includeFolder: UriComponents | null, excludePatternOrDisregardExcludes: string | false | null, maxResults: number | null, token: CancellationToken): Promise<UriComponents[] | null> {\n\t\tconst includeFolder = URI.revive(_includeFolder);\n\t\tconst workspace = this._contextService.getWorkspace();\n\n\t\tconst query = this._queryBuilder.file(\n\t\t\tincludeFolder ? [includeFolder] : workspace.folders,\n\t\t\t{\n\t\t\t\tmaxResults: maxResults ?? undefined,\n\t\t\t\tdisregardExcludeSettings: (excludePatternOrDisregardExcludes === false) || undefined,\n\t\t\t\tdisregardSearchExcludeSettings: true,\n\t\t\t\tdisregardIgnoreFiles: true,\n\t\t\t\tincludePattern: includePattern ?? undefined,\n\t\t\t\texcludePattern: typeof excludePatternOrDisregardExcludes === 'string' ? excludePatternOrDisregardExcludes : undefined,\n\t\t\t\t_reason: 'startFileSearch'\n\t\t\t});\n\n\t\treturn this._searchService.fileSearch(query, token).then(result => {\n\t\t\treturn result.results.map(m => m.resource);\n\t\t}, err => {\n\t\t\tif (!isCancellationError(err)) {\n\t\t\t\treturn Promise.reject(err);\n\t\t\t}\n\t\t\treturn null;\n\t\t});\n\t}\n\n\t$startTextSearch(pattern: IPatternInfo, _folder: UriComponents | null, options: ITextQueryBuilderOptions, requestId: number, token: CancellationToken): Promise<ITextSearchComplete | null> {\n\t\tconst folder = URI.revive(_folder);\n\t\tconst workspace = this._contextService.getWorkspace();\n\t\tconst folders = folder ? [folder] : workspace.folders.map(folder => folder.uri);\n\n\t\tconst query = this._queryBuilder.text(pattern, folders, options);\n\t\tquery._reason = 'startTextSearch';\n\n\t\tconst onProgress = (p: ISearchProgressItem) => {\n\t\t\tif ((<IFileMatch>p).results) {\n\t\t\t\tthis._proxy.$handleTextSearchResult(<IFileMatch>p, requestId);\n\t\t\t}\n\t\t};\n\n\t\tconst search = this._searchService.textSearch(query, token, onProgress).then(\n\t\t\tresult => {\n\t\t\t\treturn { limitHit: result.limitHit };\n\t\t\t},\n\t\t\terr => {\n\t\t\t\tif (!isCancellationError(err)) {\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\treturn search;\n\t}\n\n\t$checkExists(folders: readonly UriComponents[], includes: string[], token: CancellationToken): Promise<boolean> {\n\t\treturn this._instantiationService.invokeFunction((accessor) => checkGlobFileExists(accessor, folders, includes, token));\n\t}\n\n\t// --- save & edit resources ---\n\n\tasync $save(uriComponents: UriComponents, options: { saveAs: boolean }): Promise<UriComponents | undefined> {\n\t\tconst uri = URI.revive(uriComponents);\n\n\t\tconst editors = [...this._editorService.findEditors(uri, { supportSideBySide: SideBySideEditor.PRIMARY })];\n\t\tconst result = await this._editorService.save(editors, {\n\t\t\treason: SaveReason.EXPLICIT,\n\t\t\tsaveAs: options.saveAs,\n\t\t\tforce: !options.saveAs\n\t\t});\n\n\t\treturn firstOrDefault(this._saveResultToUris(result));\n\t}\n\n\tprivate _saveResultToUris(result: ISaveEditorsResult): URI[] {\n\t\tif (!result.success) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn coalesce(result.editors.map(editor => EditorResourceAccessor.getCanonicalUri(editor, { supportSideBySide: SideBySideEditor.PRIMARY })));\n\t}\n\n\t$saveAll(includeUntitled?: boolean): Promise<boolean> {\n\t\treturn this._editorService.saveAll({ includeUntitled }).then(res => res.success);\n\t}\n\n\t$resolveProxy(url: string): Promise<string | undefined> {\n\t\treturn this._requestService.resolveProxy(url);\n\t}\n\n\t// --- trust ---\n\n\t$requestWorkspaceTrust(options?: WorkspaceTrustRequestOptions): Promise<boolean | undefined> {\n\t\treturn this._workspaceTrustRequestService.requestWorkspaceTrust(options);\n\t}\n\n\tprivate isWorkspaceTrusted(): boolean {\n\t\treturn this._workspaceTrustManagementService.isWorkspaceTrusted();\n\t}\n\n\tprivate _onDidGrantWorkspaceTrust(): void {\n\t\tthis._proxy.$onDidGrantWorkspaceTrust();\n\t}\n\n\t// --- edit sessions ---\n\tprivate registeredEditSessionProviders = new Map<number, IDisposable>();\n\n\t$registerEditSessionIdentityProvider(handle: number, scheme: string) {\n\t\tconst disposable = this._editSessionIdentityService.registerEditSessionIdentityProvider({\n\t\t\tscheme: scheme,\n\t\t\tgetEditSessionIdentifier: async (workspaceFolder: WorkspaceFolder, token: CancellationToken) => {\n\t\t\t\treturn this._proxy.$getEditSessionIdentifier(workspaceFolder.uri, token);\n\t\t\t},\n\t\t\tprovideEditSessionIdentityMatch: async (workspaceFolder: WorkspaceFolder, identity1: string, identity2: string, token: CancellationToken) => {\n\t\t\t\treturn this._proxy.$provideEditSessionIdentityMatch(workspaceFolder.uri, identity1, identity2, token);\n\t\t\t}\n\t\t});\n\n\t\tthis.registeredEditSessionProviders.set(handle, disposable);\n\t\tthis._toDispose.add(disposable);\n\t}\n\n\t$unregisterEditSessionIdentityProvider(handle: number) {\n\t\tconst disposable = this.registeredEditSessionProviders.get(handle);\n\t\tdisposable?.dispose();\n\t\tthis.registeredEditSessionProviders.delete(handle);\n\t}\n\n\t// --- canonical uri identities ---\n\tprivate registeredCanonicalUriProviders = new Map<number, IDisposable>();\n\n\t$registerCanonicalUriProvider(handle: number, scheme: string) {\n\t\tconst disposable = this._canonicalUriService.registerCanonicalUriProvider({\n\t\t\tscheme: scheme,\n\t\t\tprovideCanonicalUri: async (uri: UriComponents, targetScheme: string, token: CancellationToken) => {\n\t\t\t\tconst result = await this._proxy.$provideCanonicalUri(uri, targetScheme, token);\n\t\t\t\tif (result) {\n\t\t\t\t\treturn URI.revive(result);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t}\n\t\t});\n\n\t\tthis.registeredCanonicalUriProviders.set(handle, disposable);\n\t\tthis._toDispose.add(disposable);\n\t}\n\n\t$unregisterCanonicalUriProvider(handle: number) {\n\t\tconst disposable = this.registeredCanonicalUriProviders.get(handle);\n\t\tdisposable?.dispose();\n\t\tthis.registeredCanonicalUriProviders.delete(handle);\n\t}\n}\n"]}