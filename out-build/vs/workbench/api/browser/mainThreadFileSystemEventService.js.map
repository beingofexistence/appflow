{"version":3,"sources":["vs/workbench/api/browser/mainThreadFileSystemEventService.ts"],"names":[],"mappings":"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","file":"mainThreadFileSystemEventService.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { FileOperation, IFileService } from 'vs/platform/files/common/files';\nimport { extHostCustomer, IExtHostContext } from 'vs/workbench/services/extensions/common/extHostCustomers';\nimport { ExtHostContext } from '../common/extHost.protocol';\nimport { localize } from 'vs/nls';\nimport { IWorkingCopyFileOperationParticipant, IWorkingCopyFileService, SourceTargetPair, IFileOperationUndoRedoInfo } from 'vs/workbench/services/workingCopy/common/workingCopyFileService';\nimport { IBulkEditService } from 'vs/editor/browser/services/bulkEditService';\nimport { IProgressService, ProgressLocation } from 'vs/platform/progress/common/progress';\nimport { raceCancellation } from 'vs/base/common/async';\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { IDialogService } from 'vs/platform/dialogs/common/dialogs';\nimport Severity from 'vs/base/common/severity';\nimport { IStorageService, StorageScope, StorageTarget } from 'vs/platform/storage/common/storage';\nimport { Action2, registerAction2 } from 'vs/platform/actions/common/actions';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { IUriIdentityService } from 'vs/platform/uriIdentity/common/uriIdentity';\nimport { reviveWorkspaceEditDto } from 'vs/workbench/api/browser/mainThreadBulkEdits';\n\n@extHostCustomer\nexport class MainThreadFileSystemEventService {\n\n\tstatic readonly MementoKeyAdditionalEdits = `file.particpants.additionalEdits`;\n\n\tprivate readonly _listener = new DisposableStore();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IFileService fileService: IFileService,\n\t\t@IWorkingCopyFileService workingCopyFileService: IWorkingCopyFileService,\n\t\t@IBulkEditService bulkEditService: IBulkEditService,\n\t\t@IProgressService progressService: IProgressService,\n\t\t@IDialogService dialogService: IDialogService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@ILogService logService: ILogService,\n\t\t@IEnvironmentService envService: IEnvironmentService,\n\t\t@IUriIdentityService uriIdentService: IUriIdentityService\n\t) {\n\n\t\tconst proxy = extHostContext.getProxy(ExtHostContext.ExtHostFileSystemEventService);\n\n\t\tthis._listener.add(fileService.onDidFilesChange(event => {\n\t\t\tproxy.$onFileEvent({\n\t\t\t\tcreated: event.rawAdded,\n\t\t\t\tchanged: event.rawUpdated,\n\t\t\t\tdeleted: event.rawDeleted\n\t\t\t});\n\t\t}));\n\n\t\tconst fileOperationParticipant = new class implements IWorkingCopyFileOperationParticipant {\n\t\t\tasync participate(files: SourceTargetPair[], operation: FileOperation, undoInfo: IFileOperationUndoRedoInfo | undefined, timeout: number, token: CancellationToken) {\n\t\t\t\tif (undoInfo?.isUndoing) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst cts = new CancellationTokenSource(token);\n\t\t\t\tconst timer = setTimeout(() => cts.cancel(), timeout);\n\n\t\t\t\tconst data = await progressService.withProgress({\n\t\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\t\ttitle: this._progressLabel(operation),\n\t\t\t\t\tcancellable: true,\n\t\t\t\t\tdelay: Math.min(timeout / 2, 3000)\n\t\t\t\t}, () => {\n\t\t\t\t\t// race extension host event delivery against timeout AND user-cancel\n\t\t\t\t\tconst onWillEvent = proxy.$onWillRunFileOperation(operation, files, timeout, cts.token);\n\t\t\t\t\treturn raceCancellation(onWillEvent, cts.token);\n\t\t\t\t}, () => {\n\t\t\t\t\t// user-cancel\n\t\t\t\t\tcts.cancel();\n\n\t\t\t\t}).finally(() => {\n\t\t\t\t\tcts.dispose();\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t});\n\n\t\t\t\tif (!data || data.edit.edits.length === 0) {\n\t\t\t\t\t// cancelled, no reply, or no edits\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst needsConfirmation = data.edit.edits.some(edit => edit.metadata?.needsConfirmation);\n\t\t\t\tlet showPreview = storageService.getBoolean(MainThreadFileSystemEventService.MementoKeyAdditionalEdits, StorageScope.PROFILE);\n\n\t\t\t\tif (envService.extensionTestsLocationURI) {\n\t\t\t\t\t// don't show dialog in tests\n\t\t\t\t\tshowPreview = false;\n\t\t\t\t}\n\n\t\t\t\tif (showPreview === undefined) {\n\t\t\t\t\t// show a user facing message\n\n\t\t\t\t\tlet message: string;\n\t\t\t\t\tif (data.extensionNames.length === 1) {\n\t\t\t\t\t\tif (operation === FileOperation.CREATE) {\n\t\t\t\t\t\t\tmessage = localize('ask.1.create', \"Extension '{0}' wants to make refactoring changes with this file creation\", data.extensionNames[0]);\n\t\t\t\t\t\t} else if (operation === FileOperation.COPY) {\n\t\t\t\t\t\t\tmessage = localize('ask.1.copy', \"Extension '{0}' wants to make refactoring changes with this file copy\", data.extensionNames[0]);\n\t\t\t\t\t\t} else if (operation === FileOperation.MOVE) {\n\t\t\t\t\t\t\tmessage = localize('ask.1.move', \"Extension '{0}' wants to make refactoring changes with this file move\", data.extensionNames[0]);\n\t\t\t\t\t\t} else /* if (operation === FileOperation.DELETE) */ {\n\t\t\t\t\t\t\tmessage = localize('ask.1.delete', \"Extension '{0}' wants to make refactoring changes with this file deletion\", data.extensionNames[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (operation === FileOperation.CREATE) {\n\t\t\t\t\t\t\tmessage = localize({ key: 'ask.N.create', comment: ['{0} is a number, e.g \"3 extensions want...\"'] }, \"{0} extensions want to make refactoring changes with this file creation\", data.extensionNames.length);\n\t\t\t\t\t\t} else if (operation === FileOperation.COPY) {\n\t\t\t\t\t\t\tmessage = localize({ key: 'ask.N.copy', comment: ['{0} is a number, e.g \"3 extensions want...\"'] }, \"{0} extensions want to make refactoring changes with this file copy\", data.extensionNames.length);\n\t\t\t\t\t\t} else if (operation === FileOperation.MOVE) {\n\t\t\t\t\t\t\tmessage = localize({ key: 'ask.N.move', comment: ['{0} is a number, e.g \"3 extensions want...\"'] }, \"{0} extensions want to make refactoring changes with this file move\", data.extensionNames.length);\n\t\t\t\t\t\t} else /* if (operation === FileOperation.DELETE) */ {\n\t\t\t\t\t\t\tmessage = localize({ key: 'ask.N.delete', comment: ['{0} is a number, e.g \"3 extensions want...\"'] }, \"{0} extensions want to make refactoring changes with this file deletion\", data.extensionNames.length);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (needsConfirmation) {\n\t\t\t\t\t\t// edit which needs confirmation -> always show dialog\n\t\t\t\t\t\tconst { confirmed } = await dialogService.confirm({\n\t\t\t\t\t\t\ttype: Severity.Info,\n\t\t\t\t\t\t\tmessage,\n\t\t\t\t\t\t\tprimaryButton: localize('preview', \"Show &&Preview\"),\n\t\t\t\t\t\t\tcancelButton: localize('cancel', \"Skip Changes\")\n\t\t\t\t\t\t});\n\t\t\t\t\t\tshowPreview = true;\n\t\t\t\t\t\tif (!confirmed) {\n\t\t\t\t\t\t\t// no changes wanted\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// choice\n\t\t\t\t\t\tenum Choice {\n\t\t\t\t\t\t\tOK = 0,\n\t\t\t\t\t\t\tPreview = 1,\n\t\t\t\t\t\t\tCancel = 2\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst { result, checkboxChecked } = await dialogService.prompt<Choice>({\n\t\t\t\t\t\t\ttype: Severity.Info,\n\t\t\t\t\t\t\tmessage,\n\t\t\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlabel: localize({ key: 'ok', comment: ['&& denotes a mnemonic'] }, \"&&OK\"),\n\t\t\t\t\t\t\t\t\trun: () => Choice.OK\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlabel: localize({ key: 'preview', comment: ['&& denotes a mnemonic'] }, \"Show &&Preview\"),\n\t\t\t\t\t\t\t\t\trun: () => Choice.Preview\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tcancelButton: {\n\t\t\t\t\t\t\t\tlabel: localize('cancel', \"Skip Changes\"),\n\t\t\t\t\t\t\t\trun: () => Choice.Cancel\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcheckbox: { label: localize('again', \"Don't ask again\") }\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (result === Choice.Cancel) {\n\t\t\t\t\t\t\t// no changes wanted, don't persist cancel option\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tshowPreview = result === Choice.Preview;\n\t\t\t\t\t\tif (checkboxChecked) {\n\t\t\t\t\t\t\tstorageService.store(MainThreadFileSystemEventService.MementoKeyAdditionalEdits, showPreview, StorageScope.PROFILE, StorageTarget.USER);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlogService.info('[onWill-handler] applying additional workspace edit from extensions', data.extensionNames);\n\n\t\t\t\tawait bulkEditService.apply(\n\t\t\t\t\treviveWorkspaceEditDto(data.edit, uriIdentService),\n\t\t\t\t\t{ undoRedoGroupId: undoInfo?.undoRedoGroupId, showPreview }\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tprivate _progressLabel(operation: FileOperation): string {\n\t\t\t\tswitch (operation) {\n\t\t\t\t\tcase FileOperation.CREATE:\n\t\t\t\t\t\treturn localize('msg-create', \"Running 'File Create' participants...\");\n\t\t\t\t\tcase FileOperation.MOVE:\n\t\t\t\t\t\treturn localize('msg-rename', \"Running 'File Rename' participants...\");\n\t\t\t\t\tcase FileOperation.COPY:\n\t\t\t\t\t\treturn localize('msg-copy', \"Running 'File Copy' participants...\");\n\t\t\t\t\tcase FileOperation.DELETE:\n\t\t\t\t\t\treturn localize('msg-delete', \"Running 'File Delete' participants...\");\n\t\t\t\t\tcase FileOperation.WRITE:\n\t\t\t\t\t\treturn localize('msg-write', \"Running 'File Write' participants...\");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// BEFORE file operation\n\t\tthis._listener.add(workingCopyFileService.addFileOperationParticipant(fileOperationParticipant));\n\n\t\t// AFTER file operation\n\t\tthis._listener.add(workingCopyFileService.onDidRunWorkingCopyFileOperation(e => proxy.$onDidRunFileOperation(e.operation, e.files)));\n\t}\n\n\tdispose(): void {\n\t\tthis._listener.dispose();\n\t}\n}\n\nregisterAction2(class ResetMemento extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'files.participants.resetChoice',\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('label', \"Reset choice for 'File operation needs preview'\"),\n\t\t\t\toriginal: `Reset choice for 'File operation needs preview'`\n\t\t\t},\n\t\t\tf1: true\n\t\t});\n\t}\n\trun(accessor: ServicesAccessor) {\n\t\taccessor.get(IStorageService).remove(MainThreadFileSystemEventService.MementoKeyAdditionalEdits, StorageScope.PROFILE);\n\t}\n});\n"]}