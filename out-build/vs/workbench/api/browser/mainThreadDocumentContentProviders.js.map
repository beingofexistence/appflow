{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/api/browser/mainThreadDocumentContentProviders.ts"],"names":[],"mappings":"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","file":"mainThreadDocumentContentProviders.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { dispose, DisposableMap } from 'vs/base/common/lifecycle';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { EditOperation } from 'vs/editor/common/core/editOperation';\nimport { Range } from 'vs/editor/common/core/range';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { IEditorWorkerService } from 'vs/editor/common/services/editorWorker';\nimport { IModelService } from 'vs/editor/common/services/model';\nimport { ILanguageService } from 'vs/editor/common/languages/language';\nimport { ITextModelService } from 'vs/editor/common/services/resolverService';\nimport { extHostNamedCustomer, IExtHostContext } from 'vs/workbench/services/extensions/common/extHostCustomers';\nimport { ExtHostContext, ExtHostDocumentContentProvidersShape, MainContext, MainThreadDocumentContentProvidersShape } from '../common/extHost.protocol';\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\n\n@extHostNamedCustomer(MainContext.MainThreadDocumentContentProviders)\nexport class MainThreadDocumentContentProviders implements MainThreadDocumentContentProvidersShape {\n\n\tprivate readonly _resourceContentProvider = new DisposableMap<number>();\n\tprivate readonly _pendingUpdate = new Map<string, CancellationTokenSource>();\n\tprivate readonly _proxy: ExtHostDocumentContentProvidersShape;\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ITextModelService private readonly _textModelResolverService: ITextModelService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@IEditorWorkerService private readonly _editorWorkerService: IEditorWorkerService\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostDocumentContentProviders);\n\t}\n\n\tdispose(): void {\n\t\tthis._resourceContentProvider.dispose();\n\t\tdispose(this._pendingUpdate.values());\n\t}\n\n\t$registerTextContentProvider(handle: number, scheme: string): void {\n\t\tconst registration = this._textModelResolverService.registerTextModelContentProvider(scheme, {\n\t\t\tprovideTextContent: (uri: URI): Promise<ITextModel | null> => {\n\t\t\t\treturn this._proxy.$provideTextDocumentContent(handle, uri).then(value => {\n\t\t\t\t\tif (typeof value === 'string') {\n\t\t\t\t\t\tconst firstLineText = value.substr(0, 1 + value.search(/\\r?\\n/));\n\t\t\t\t\t\tconst languageSelection = this._languageService.createByFilepathOrFirstLine(uri, firstLineText);\n\t\t\t\t\t\treturn this._modelService.createModel(value, languageSelection, uri);\n\t\t\t\t\t}\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis._resourceContentProvider.set(handle, registration);\n\t}\n\n\t$unregisterTextContentProvider(handle: number): void {\n\t\tthis._resourceContentProvider.deleteAndDispose(handle);\n\t}\n\n\t$onVirtualDocumentChange(uri: UriComponents, value: string): void {\n\t\tconst model = this._modelService.getModel(URI.revive(uri));\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\t// cancel and dispose an existing update\n\t\tconst pending = this._pendingUpdate.get(model.id);\n\t\tpending?.cancel();\n\n\t\t// create and keep update token\n\t\tconst myToken = new CancellationTokenSource();\n\t\tthis._pendingUpdate.set(model.id, myToken);\n\n\t\tthis._editorWorkerService.computeMoreMinimalEdits(model.uri, [{ text: value, range: model.getFullModelRange() }]).then(edits => {\n\t\t\t// remove token\n\t\t\tthis._pendingUpdate.delete(model.id);\n\n\t\t\tif (myToken.token.isCancellationRequested) {\n\t\t\t\t// ignore this\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (edits && edits.length > 0) {\n\t\t\t\t// use the evil-edit as these models show in readonly-editor only\n\t\t\t\tmodel.applyEdits(edits.map(edit => EditOperation.replace(Range.lift(edit.range), edit.text)));\n\t\t\t}\n\t\t}).catch(onUnexpectedError);\n\t}\n}\n"]}