{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/api/test/common/extHostExtensionActivator.test.ts"],"names":[],"mappings":"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","file":"extHostExtensionActivator.test.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { timeout } from 'vs/base/common/async';\nimport { URI } from 'vs/base/common/uri';\nimport { ExtensionIdentifier, IExtensionDescription, IRelaxedExtensionDescription, TargetPlatform } from 'vs/platform/extensions/common/extensions';\nimport { NullLogService } from 'vs/platform/log/common/log';\nimport { ActivatedExtension, EmptyExtension, ExtensionActivationTimes, ExtensionsActivator, IExtensionsActivatorHost } from 'vs/workbench/api/common/extHostExtensionActivator';\nimport { ExtensionDescriptionRegistry, basicActivationEventsReader } from 'vs/workbench/services/extensions/common/extensionDescriptionRegistry';\nimport { ExtensionActivationReason, MissingExtensionDependency } from 'vs/workbench/services/extensions/common/extensions';\n\nsuite('ExtensionsActivator', () => {\n\n\tconst idA = new ExtensionIdentifier(`a`);\n\tconst idB = new ExtensionIdentifier(`b`);\n\tconst idC = new ExtensionIdentifier(`c`);\n\n\ttest('calls activate only once with sequential activations', async () => {\n\t\tconst host = new SimpleExtensionsActivatorHost();\n\t\tconst activator = createActivator(host, [\n\t\t\tdesc(idA)\n\t\t]);\n\n\t\tawait activator.activateByEvent('*', false);\n\t\tassert.deepStrictEqual(host.activateCalls, [idA]);\n\n\t\tawait activator.activateByEvent('*', false);\n\t\tassert.deepStrictEqual(host.activateCalls, [idA]);\n\t});\n\n\ttest('calls activate only once with parallel activations', async () => {\n\t\tconst extActivation = new ExtensionActivationPromiseSource();\n\t\tconst host = new PromiseExtensionsActivatorHost([\n\t\t\t[idA, extActivation]\n\t\t]);\n\t\tconst activator = createActivator(host, [\n\t\t\tdesc(idA, [], ['evt1', 'evt2'])\n\t\t]);\n\n\t\tconst activate1 = activator.activateByEvent('evt1', false);\n\t\tconst activate2 = activator.activateByEvent('evt2', false);\n\n\t\textActivation.resolve();\n\n\t\tawait activate1;\n\t\tawait activate2;\n\n\t\tassert.deepStrictEqual(host.activateCalls, [idA]);\n\t});\n\n\ttest('activates dependencies first', async () => {\n\t\tconst extActivationA = new ExtensionActivationPromiseSource();\n\t\tconst extActivationB = new ExtensionActivationPromiseSource();\n\t\tconst host = new PromiseExtensionsActivatorHost([\n\t\t\t[idA, extActivationA],\n\t\t\t[idB, extActivationB]\n\t\t]);\n\t\tconst activator = createActivator(host, [\n\t\t\tdesc(idA, [idB], ['evt1']),\n\t\t\tdesc(idB, [], ['evt1']),\n\t\t]);\n\n\t\tconst activate = activator.activateByEvent('evt1', false);\n\n\t\tawait timeout(0);\n\t\tassert.deepStrictEqual(host.activateCalls, [idB]);\n\t\textActivationB.resolve();\n\n\t\tawait timeout(0);\n\t\tassert.deepStrictEqual(host.activateCalls, [idB, idA]);\n\t\textActivationA.resolve();\n\n\t\tawait timeout(0);\n\t\tawait activate;\n\n\t\tassert.deepStrictEqual(host.activateCalls, [idB, idA]);\n\t});\n\n\ttest('Supports having resolved extensions', async () => {\n\t\tconst host = new SimpleExtensionsActivatorHost();\n\t\tconst bExt = desc(idB);\n\t\tdelete (<IRelaxedExtensionDescription>bExt).main;\n\t\tdelete (<IRelaxedExtensionDescription>bExt).browser;\n\t\tconst activator = createActivator(host, [\n\t\t\tdesc(idA, [idB])\n\t\t], [bExt]);\n\n\t\tawait activator.activateByEvent('*', false);\n\t\tassert.deepStrictEqual(host.activateCalls, [idA]);\n\t});\n\n\ttest('Supports having external extensions', async () => {\n\t\tconst extActivationA = new ExtensionActivationPromiseSource();\n\t\tconst extActivationB = new ExtensionActivationPromiseSource();\n\t\tconst host = new PromiseExtensionsActivatorHost([\n\t\t\t[idA, extActivationA],\n\t\t\t[idB, extActivationB]\n\t\t]);\n\t\tconst bExt = desc(idB);\n\t\t(<IRelaxedExtensionDescription>bExt).api = 'none';\n\t\tconst activator = createActivator(host, [\n\t\t\tdesc(idA, [idB])\n\t\t], [bExt]);\n\n\t\tconst activate = activator.activateByEvent('*', false);\n\n\t\tawait timeout(0);\n\t\tassert.deepStrictEqual(host.activateCalls, [idB]);\n\t\textActivationB.resolve();\n\n\t\tawait timeout(0);\n\t\tassert.deepStrictEqual(host.activateCalls, [idB, idA]);\n\t\textActivationA.resolve();\n\n\t\tawait activate;\n\t\tassert.deepStrictEqual(host.activateCalls, [idB, idA]);\n\t});\n\n\ttest('Error: activateById with missing extension', async () => {\n\t\tconst host = new SimpleExtensionsActivatorHost();\n\t\tconst activator = createActivator(host, [\n\t\t\tdesc(idA),\n\t\t\tdesc(idB),\n\t\t]);\n\n\t\tlet error: Error | undefined = undefined;\n\t\ttry {\n\t\t\tawait activator.activateById(idC, { startup: false, extensionId: idC, activationEvent: 'none' });\n\t\t} catch (err) {\n\t\t\terror = err;\n\t\t}\n\n\t\tassert.strictEqual(typeof error === 'undefined', false);\n\t});\n\n\ttest('Error: dependency missing', async () => {\n\t\tconst host = new SimpleExtensionsActivatorHost();\n\t\tconst activator = createActivator(host, [\n\t\t\tdesc(idA, [idB]),\n\t\t]);\n\n\t\tawait activator.activateByEvent('*', false);\n\n\t\tassert.deepStrictEqual(host.errors.length, 1);\n\t\tassert.deepStrictEqual(host.errors[0][0], idA);\n\t});\n\n\ttest('Error: dependency activation failed', async () => {\n\t\tconst extActivationA = new ExtensionActivationPromiseSource();\n\t\tconst extActivationB = new ExtensionActivationPromiseSource();\n\t\tconst host = new PromiseExtensionsActivatorHost([\n\t\t\t[idA, extActivationA],\n\t\t\t[idB, extActivationB]\n\t\t]);\n\t\tconst activator = createActivator(host, [\n\t\t\tdesc(idA, [idB]),\n\t\t\tdesc(idB)\n\t\t]);\n\n\t\tconst activate = activator.activateByEvent('*', false);\n\t\textActivationB.reject(new Error(`b fails!`));\n\n\t\tawait activate;\n\t\tassert.deepStrictEqual(host.errors.length, 2);\n\t\tassert.deepStrictEqual(host.errors[0][0], idB);\n\t\tassert.deepStrictEqual(host.errors[1][0], idA);\n\t});\n\n\ttest('issue #144518: Problem with git extension and vscode-icons', async () => {\n\t\tconst extActivationA = new ExtensionActivationPromiseSource();\n\t\tconst extActivationB = new ExtensionActivationPromiseSource();\n\t\tconst extActivationC = new ExtensionActivationPromiseSource();\n\t\tconst host = new PromiseExtensionsActivatorHost([\n\t\t\t[idA, extActivationA],\n\t\t\t[idB, extActivationB],\n\t\t\t[idC, extActivationC]\n\t\t]);\n\t\tconst activator = createActivator(host, [\n\t\t\tdesc(idA, [idB]),\n\t\t\tdesc(idB),\n\t\t\tdesc(idC),\n\t\t]);\n\n\t\tactivator.activateByEvent('*', false);\n\t\tassert.deepStrictEqual(host.activateCalls, [idB, idC]);\n\n\t\textActivationB.resolve();\n\t\tawait timeout(0);\n\n\t\tassert.deepStrictEqual(host.activateCalls, [idB, idC, idA]);\n\t\textActivationA.resolve();\n\t});\n\n\tclass SimpleExtensionsActivatorHost implements IExtensionsActivatorHost {\n\t\tpublic readonly activateCalls: ExtensionIdentifier[] = [];\n\t\tpublic readonly errors: [ExtensionIdentifier, Error | null, MissingExtensionDependency | null][] = [];\n\n\t\tonExtensionActivationError(extensionId: ExtensionIdentifier, error: Error | null, missingExtensionDependency: MissingExtensionDependency | null): void {\n\t\t\tthis.errors.push([extensionId, error, missingExtensionDependency]);\n\t\t}\n\n\t\tactualActivateExtension(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<ActivatedExtension> {\n\t\t\tthis.activateCalls.push(extensionId);\n\t\t\treturn Promise.resolve(new EmptyExtension(ExtensionActivationTimes.NONE));\n\t\t}\n\t}\n\n\tclass PromiseExtensionsActivatorHost extends SimpleExtensionsActivatorHost {\n\n\t\tconstructor(\n\t\t\tprivate readonly _promises: [ExtensionIdentifier, ExtensionActivationPromiseSource][]\n\t\t) {\n\t\t\tsuper();\n\t\t}\n\n\t\toverride actualActivateExtension(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<ActivatedExtension> {\n\t\t\tthis.activateCalls.push(extensionId);\n\t\t\tfor (const [id, promiseSource] of this._promises) {\n\t\t\t\tif (id.value === extensionId.value) {\n\t\t\t\t\treturn promiseSource.promise;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthrow new Error(`Unexpected!`);\n\t\t}\n\t}\n\n\tclass ExtensionActivationPromiseSource {\n\t\tprivate _resolve!: (value: ActivatedExtension) => void;\n\t\tprivate _reject!: (err: Error) => void;\n\t\tpublic readonly promise: Promise<ActivatedExtension>;\n\n\t\tconstructor() {\n\t\t\tthis.promise = new Promise<ActivatedExtension>((resolve, reject) => {\n\t\t\t\tthis._resolve = resolve;\n\t\t\t\tthis._reject = reject;\n\t\t\t});\n\t\t}\n\n\t\tpublic resolve(): void {\n\t\t\tthis._resolve(new EmptyExtension(ExtensionActivationTimes.NONE));\n\t\t}\n\n\t\tpublic reject(err: Error): void {\n\t\t\tthis._reject(err);\n\t\t}\n\t}\n\n\tfunction createActivator(host: IExtensionsActivatorHost, extensionDescriptions: IExtensionDescription[], otherHostExtensionDescriptions: IExtensionDescription[] = []): ExtensionsActivator {\n\t\tconst registry = new ExtensionDescriptionRegistry(basicActivationEventsReader, extensionDescriptions);\n\t\tconst globalRegistry = new ExtensionDescriptionRegistry(basicActivationEventsReader, extensionDescriptions.concat(otherHostExtensionDescriptions));\n\t\treturn new ExtensionsActivator(registry, globalRegistry, host, new NullLogService());\n\t}\n\n\tfunction desc(id: ExtensionIdentifier, deps: ExtensionIdentifier[] = [], activationEvents: string[] = ['*']): IExtensionDescription {\n\t\treturn {\n\t\t\tname: id.value,\n\t\t\tpublisher: 'test',\n\t\t\tversion: '0.0.0',\n\t\t\tengines: { vscode: '^1.0.0' },\n\t\t\tidentifier: id,\n\t\t\textensionLocation: URI.parse(`nothing://nowhere`),\n\t\t\tisBuiltin: false,\n\t\t\tisUnderDevelopment: false,\n\t\t\tisUserBuiltin: false,\n\t\t\tactivationEvents,\n\t\t\tmain: 'index.js',\n\t\t\ttargetPlatform: TargetPlatform.UNDEFINED,\n\t\t\textensionDependencies: deps.map(d => d.value)\n\t\t};\n\t}\n\n});\n"]}