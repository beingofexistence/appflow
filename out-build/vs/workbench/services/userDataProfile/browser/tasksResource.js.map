{"version":3,"sources":["vs/workbench/services/userDataProfile/browser/tasksResource.ts"],"names":[],"mappings":"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","file":"tasksResource.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { localize } from 'vs/nls';\nimport { FileOperationError, FileOperationResult, IFileService } from 'vs/platform/files/common/files';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IUriIdentityService } from 'vs/platform/uriIdentity/common/uriIdentity';\nimport { IUserDataProfile, ProfileResourceType } from 'vs/platform/userDataProfile/common/userDataProfile';\nimport { API_OPEN_EDITOR_COMMAND_ID } from 'vs/workbench/browser/parts/editor/editorCommands';\nimport { ITreeItemCheckboxState, TreeItemCollapsibleState } from 'vs/workbench/common/views';\nimport { IProfileResource, IProfileResourceChildTreeItem, IProfileResourceInitializer, IProfileResourceTreeItem, IUserDataProfileService } from 'vs/workbench/services/userDataProfile/common/userDataProfile';\n\ninterface ITasksResourceContent {\n\ttasks: string | null;\n}\n\nexport class TasksResourceInitializer implements IProfileResourceInitializer {\n\n\tconstructor(\n\t\t@IUserDataProfileService private readonly userDataProfileService: IUserDataProfileService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ILogService private readonly logService: ILogService,\n\t) {\n\t}\n\n\tasync initialize(content: string): Promise<void> {\n\t\tconst tasksContent: ITasksResourceContent = JSON.parse(content);\n\t\tif (!tasksContent.tasks) {\n\t\t\tthis.logService.info(`Initializing Profile: No tasks to apply...`);\n\t\t\treturn;\n\t\t}\n\t\tawait this.fileService.writeFile(this.userDataProfileService.currentProfile.tasksResource, VSBuffer.fromString(tasksContent.tasks));\n\t}\n}\n\nexport class TasksResource implements IProfileResource {\n\n\tconstructor(\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ILogService private readonly logService: ILogService,\n\t) {\n\t}\n\n\tasync getContent(profile: IUserDataProfile): Promise<string> {\n\t\tconst tasksContent = await this.getTasksResourceContent(profile);\n\t\treturn JSON.stringify(tasksContent);\n\t}\n\n\tasync getTasksResourceContent(profile: IUserDataProfile): Promise<ITasksResourceContent> {\n\t\tconst tasksContent = await this.getTasksContent(profile);\n\t\treturn { tasks: tasksContent };\n\t}\n\n\tasync apply(content: string, profile: IUserDataProfile): Promise<void> {\n\t\tconst tasksContent: ITasksResourceContent = JSON.parse(content);\n\t\tif (!tasksContent.tasks) {\n\t\t\tthis.logService.info(`Importing Profile (${profile.name}): No tasks to apply...`);\n\t\t\treturn;\n\t\t}\n\t\tawait this.fileService.writeFile(profile.tasksResource, VSBuffer.fromString(tasksContent.tasks));\n\t}\n\n\tprivate async getTasksContent(profile: IUserDataProfile): Promise<string | null> {\n\t\ttry {\n\t\t\tconst content = await this.fileService.readFile(profile.tasksResource);\n\t\t\treturn content.value.toString();\n\t\t} catch (error) {\n\t\t\t// File not found\n\t\t\tif (error instanceof FileOperationError && error.fileOperationResult === FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\treturn null;\n\t\t\t} else {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t}\n\n}\n\nexport class TasksResourceTreeItem implements IProfileResourceTreeItem {\n\n\treadonly type = ProfileResourceType.Tasks;\n\treadonly handle = ProfileResourceType.Tasks;\n\treadonly label = { label: localize('tasks', \"User Tasks\") };\n\treadonly collapsibleState = TreeItemCollapsibleState.Expanded;\n\tcheckbox: ITreeItemCheckboxState | undefined;\n\n\tconstructor(\n\t\tprivate readonly profile: IUserDataProfile,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService\n\t) { }\n\n\tasync getChildren(): Promise<IProfileResourceChildTreeItem[]> {\n\t\treturn [{\n\t\t\thandle: this.profile.tasksResource.toString(),\n\t\t\tresourceUri: this.profile.tasksResource,\n\t\t\tcollapsibleState: TreeItemCollapsibleState.None,\n\t\t\tparent: this,\n\t\t\taccessibilityInformation: {\n\t\t\t\tlabel: this.uriIdentityService.extUri.basename(this.profile.settingsResource)\n\t\t\t},\n\t\t\tcommand: {\n\t\t\t\tid: API_OPEN_EDITOR_COMMAND_ID,\n\t\t\t\ttitle: '',\n\t\t\t\targuments: [this.profile.tasksResource, undefined, undefined]\n\t\t\t}\n\t\t}];\n\t}\n\n\tasync hasContent(): Promise<boolean> {\n\t\tconst tasksContent = await this.instantiationService.createInstance(TasksResource).getTasksResourceContent(this.profile);\n\t\treturn tasksContent.tasks !== null;\n\t}\n\n\tasync getContent(): Promise<string> {\n\t\treturn this.instantiationService.createInstance(TasksResource).getContent(this.profile);\n\t}\n\n\tisFromDefaultProfile(): boolean {\n\t\treturn !this.profile.isDefault && !!this.profile.useDefaultFlags?.tasks;\n\t}\n\n\n}\n"]}