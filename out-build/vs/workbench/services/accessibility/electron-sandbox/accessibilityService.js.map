{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/services/accessibility/electron-sandbox/accessibilityService.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IA0BzF,IAAM,IAAI,GAAV,MAAM,IAA2B,SAAQ,2BAAI;QAKnD,YACqC,kBAAwB,EACxC,iBAAsB,EACnB,oBAAyB,EAChC,cAAmB,EAChB,CAAuC,EACtC,CAAwC;YAE5D,KAAK,CAAC,iBAAiB,EAAE,cAAc,EAAE,oBAAoB,CAAC,CAAC;YAH3B,MAAC,GAAD,CAAC,CAAqB;YACrB,MAAC,GAAD,CAAC,CAAsB;YATrD,MAAC,GAAkB,KAAK,CAAC;YACzB,MAAC,GAAsD,SAAS,CAAC;YAWxE,IAAI,CAAC,uBAAuB,CAAC,kBAAkB,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC,sCAA8B,CAAC,sCAA8B,CAAC,CAAC;QAC7I,CAAC;QAEQ,KAAK,CAAC,yBAAyB;YACvC,IAAI,CAAC,aAAE,EAAS;gBACf,OAAO,KAAK,CAAC;aACb;YAED,IAAI,OAAO,IAAI,CAAC,CAAC,KAAmC,SAAS,EAAE;gBAC9D,MAAM,4BAA4B,GAAG,MAAM,IAAI,CAAC,CAAC,CAAiB,sBAAsB,CAAC,mBAAmB,EAAE,mDAAmD,EAAE,IAAI,CAAC,CAAC;gBACzK,IAAI,CAAC,CAAC,GAAiC,CAAC,4BAA4B,KAAK,GAAG,CAAC,CAAC;aAC9E;YAED,OAAO,IAAI,CAAC,CAAC,CAA+B;QAC7C,CAAC;QAEQ,uBAAuB,CAAC,oBAA0C;YAC1E,KAAK,CAAC,uBAAuB,CAAC,oBAAoB,CAAC,CAAC;YAEpD,IAAI,CAAC,IAAI,CAAC,CAAC,IAAmB,oBAAoB,yCAAiC,EAAE;gBACpF,IAAI,CAAC,CAAC,CAAiB,UAAU,CAA2D,eAAe,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;gBAChI,IAAI,CAAC,CAAC,GAAkB,IAAI,CAAC;aAC7B;QACF,CAAC;KACD,CAAA;IAtCY,oBAAI;mBAAJ,IAAI;QAMd,WAAA,yBAAI,CAAA;QACJ,WAAA,gBAAG,CAAA;QACH,WAAA,mBAAG,CAAA;QACH,WAAA,mBAAG,CAAA;QACH,WAAA,eAAG,CAAA;QACH,WAAA,aAAI,CAAA;OAXM,IAAI,CAsChB;IAED,IAAA,gBAAG,EAAe,mBAAG,EAAoB,IAAI,oCAAkD,CAAC;IAEhG,uLAAuL;IACvL,IAAM,8BAA8B,GAApC,MAAM,8BAA8B;QACnC,YACsB,kBAAwB,EACtB,oBAAyB,EACZ,kBAAwB;YAE5D,MAAM,0BAA0B,GAAG,GAAG,EAAE;gBACvC,IAAI,oBAAoB,CAAC,uBAAuB,EAAE,EAAE;oBACnD,kBAAkB,CAAC,KAAK,CAAC,kBAAkB,CAAC,YAAY,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,8BAA8B,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;iBAC3H;YACF,CAAC,CAAC;YACF,0BAA0B,EAAE,CAAC;YAC7B,oBAAoB,CAAC,gCAAgC,CAAC,0BAA0B,CAAC,CAAC;QACnF,CAAC;KACD,CAAA;IAdK,8BAA8B;QAEjC,WAAA,kBAAI,CAAA;QACJ,WAAA,mBAAG,CAAA;QACH,WAAA,yBAAI,CAAA;OAJD,8BAA8B,CAcnC;IAED,IAAI,aAAE,EAAO;QACZ,cAAG,CAAM,EAAE,CAAkC,0BAAmB,CAAC,SAAS,CAAC,CAAC,6BAA6B,CAAC,8BAA8B,+BAAuB,CAAC;KAChK","file":"accessibilityService.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IAccessibilityService, AccessibilitySupport } from 'vs/platform/accessibility/common/accessibility';\nimport { isWindows, isLinux } from 'vs/base/common/platform';\nimport { INativeWorkbenchEnvironmentService } from 'vs/workbench/services/environment/electron-sandbox/environmentService';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { AccessibilityService } from 'vs/platform/accessibility/browser/accessibilityService';\nimport { InstantiationType, registerSingleton } from 'vs/platform/instantiation/common/extensions';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { IJSONEditingService } from 'vs/workbench/services/configuration/common/jsonEditing';\nimport { IWorkbenchContribution, IWorkbenchContributionsRegistry, Extensions as WorkbenchExtensions } from 'vs/workbench/common/contributions';\nimport { LifecyclePhase } from 'vs/workbench/services/lifecycle/common/lifecycle';\nimport { INativeHostService } from 'vs/platform/native/common/native';\nimport { ILayoutService } from 'vs/platform/layout/browser/layoutService';\n\ninterface AccessibilityMetrics {\n\tenabled: boolean;\n}\ntype AccessibilityMetricsClassification = {\n\towner: 'isidorn';\n\tcomment: 'Helps gain an understanding of when accessibility features are being used';\n\tenabled: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether or not accessibility features are enabled' };\n};\n\nexport class NativeAccessibilityService extends AccessibilityService implements IAccessibilityService {\n\n\tprivate didSendTelemetry = false;\n\tprivate shouldAlwaysUnderlineAccessKeys: boolean | undefined = undefined;\n\n\tconstructor(\n\t\t@INativeWorkbenchEnvironmentService environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@ILayoutService _layoutService: ILayoutService,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@INativeHostService private readonly nativeHostService: INativeHostService\n\t) {\n\t\tsuper(contextKeyService, _layoutService, configurationService);\n\t\tthis.setAccessibilitySupport(environmentService.window.accessibilitySupport ? AccessibilitySupport.Enabled : AccessibilitySupport.Disabled);\n\t}\n\n\toverride async alwaysUnderlineAccessKeys(): Promise<boolean> {\n\t\tif (!isWindows) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof this.shouldAlwaysUnderlineAccessKeys !== 'boolean') {\n\t\t\tconst windowsKeyboardAccessibility = await this.nativeHostService.windowsGetStringRegKey('HKEY_CURRENT_USER', 'Control Panel\\\\Accessibility\\\\Keyboard Preference', 'On');\n\t\t\tthis.shouldAlwaysUnderlineAccessKeys = (windowsKeyboardAccessibility === '1');\n\t\t}\n\n\t\treturn this.shouldAlwaysUnderlineAccessKeys;\n\t}\n\n\toverride setAccessibilitySupport(accessibilitySupport: AccessibilitySupport): void {\n\t\tsuper.setAccessibilitySupport(accessibilitySupport);\n\n\t\tif (!this.didSendTelemetry && accessibilitySupport === AccessibilitySupport.Enabled) {\n\t\t\tthis._telemetryService.publicLog2<AccessibilityMetrics, AccessibilityMetricsClassification>('accessibility', { enabled: true });\n\t\t\tthis.didSendTelemetry = true;\n\t\t}\n\t}\n}\n\nregisterSingleton(IAccessibilityService, NativeAccessibilityService, InstantiationType.Delayed);\n\n// On linux we do not automatically detect that a screen reader is detected, thus we have to implicitly notify the renderer to enable accessibility when user configures it in settings\nclass LinuxAccessibilityContribution implements IWorkbenchContribution {\n\tconstructor(\n\t\t@IJSONEditingService jsonEditingService: IJSONEditingService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t\t@INativeWorkbenchEnvironmentService environmentService: INativeWorkbenchEnvironmentService\n\t) {\n\t\tconst forceRendererAccessibility = () => {\n\t\t\tif (accessibilityService.isScreenReaderOptimized()) {\n\t\t\t\tjsonEditingService.write(environmentService.argvResource, [{ path: ['force-renderer-accessibility'], value: true }], true);\n\t\t\t}\n\t\t};\n\t\tforceRendererAccessibility();\n\t\taccessibilityService.onDidChangeScreenReaderOptimized(forceRendererAccessibility);\n\t}\n}\n\nif (isLinux) {\n\tRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(LinuxAccessibilityContribution, LifecyclePhase.Ready);\n}\n"]}