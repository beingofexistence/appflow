{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/services/contextmenu/electron-sandbox/contextmenuService.ts"],"names":[],"mappings":"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","file":"contextmenuService.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IAction, IActionRunner, ActionRunner, WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification, Separator, SubmenuAction } from 'vs/base/common/actions';\nimport * as dom from 'vs/base/browser/dom';\nimport { IContextMenuMenuDelegate, IContextMenuService, IContextViewService } from 'vs/platform/contextview/browser/contextView';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { getZoomFactor } from 'vs/base/browser/browser';\nimport { unmnemonicLabel } from 'vs/base/common/labels';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { IContextMenuDelegate, IContextMenuEvent } from 'vs/base/browser/contextmenu';\nimport { once } from 'vs/base/common/functional';\nimport { IContextMenuItem } from 'vs/base/parts/contextmenu/common/contextmenu';\nimport { popup } from 'vs/base/parts/contextmenu/electron-sandbox/contextmenu';\nimport { getTitleBarStyle } from 'vs/platform/window/common/window';\nimport { isMacintosh, isWindows } from 'vs/base/common/platform';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { ContextMenuMenuDelegate, ContextMenuService as HTMLContextMenuService } from 'vs/platform/contextview/browser/contextMenuService';\nimport { InstantiationType, registerSingleton } from 'vs/platform/instantiation/common/extensions';\nimport { stripIcons } from 'vs/base/common/iconLabels';\nimport { coalesce } from 'vs/base/common/arrays';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { AnchorAlignment, AnchorAxisAlignment, isAnchor } from 'vs/base/browser/ui/contextview/contextview';\nimport { IMenuService } from 'vs/platform/actions/common/actions';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { Disposable } from 'vs/base/common/lifecycle';\n\nexport class ContextMenuService implements IContextMenuService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate impl: HTMLContextMenuService | NativeContextMenuService;\n\n\tget onDidShowContextMenu(): Event<void> { return this.impl.onDidShowContextMenu; }\n\tget onDidHideContextMenu(): Event<void> { return this.impl.onDidHideContextMenu; }\n\n\tconstructor(\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IContextViewService contextViewService: IContextViewService,\n\t\t@IMenuService menuService: IMenuService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t) {\n\n\t\t// Custom context menu: Linux/Windows if custom title is enabled\n\t\tif (!isMacintosh && getTitleBarStyle(configurationService) === 'custom') {\n\t\t\tthis.impl = new HTMLContextMenuService(telemetryService, notificationService, contextViewService, keybindingService, menuService, contextKeyService);\n\t\t}\n\n\t\t// Native context menu: otherwise\n\t\telse {\n\t\t\tthis.impl = new NativeContextMenuService(notificationService, telemetryService, keybindingService, menuService, contextKeyService);\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis.impl.dispose();\n\t}\n\n\tshowContextMenu(delegate: IContextMenuDelegate | IContextMenuMenuDelegate): void {\n\t\tthis.impl.showContextMenu(delegate);\n\t}\n}\n\nclass NativeContextMenuService extends Disposable implements IContextMenuService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidShowContextMenu = this._store.add(new Emitter<void>());\n\treadonly onDidShowContextMenu = this._onDidShowContextMenu.event;\n\n\tprivate readonly _onDidHideContextMenu = this._store.add(new Emitter<void>());\n\treadonly onDidHideContextMenu = this._onDidHideContextMenu.event;\n\n\tconstructor(\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@IMenuService private readonly menuService: IMenuService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService\n\t) {\n\t\tsuper();\n\t}\n\n\tshowContextMenu(delegate: IContextMenuDelegate | IContextMenuMenuDelegate): void {\n\n\t\tdelegate = ContextMenuMenuDelegate.transform(delegate, this.menuService, this.contextKeyService);\n\n\t\tconst actions = delegate.getActions();\n\t\tif (actions.length) {\n\t\t\tconst onHide = once(() => {\n\t\t\t\tdelegate.onHide?.(false);\n\n\t\t\t\tdom.ModifierKeyEmitter.getInstance().resetKeyStatus();\n\t\t\t\tthis._onDidHideContextMenu.fire();\n\t\t\t});\n\n\t\t\tconst menu = this.createMenu(delegate, actions, onHide);\n\t\t\tconst anchor = delegate.getAnchor();\n\n\t\t\tlet x: number | undefined;\n\t\t\tlet y: number | undefined;\n\n\t\t\tlet zoom = getZoomFactor();\n\t\t\tif (dom.isHTMLElement(anchor)) {\n\t\t\t\tconst elementPosition = dom.getDomNodePagePosition(anchor);\n\n\t\t\t\t// When drawing context menus, we adjust the pixel position for native menus using zoom level\n\t\t\t\t// In areas where zoom is applied to the element or its ancestors, we need to adjust accordingly\n\t\t\t\t// e.g. The title bar has counter zoom behavior meaning it applies the inverse of zoom level.\n\t\t\t\t// Window Zoom Level: 1.5, Title Bar Zoom: 1/1.5, Coordinate Multiplier: 1.5 * 1.0 / 1.5 = 1.0\n\t\t\t\tzoom *= dom.getDomNodeZoomLevel(anchor);\n\n\t\t\t\t// Position according to the axis alignment and the anchor alignment:\n\t\t\t\t// `HORIZONTAL` aligns at the top left or right of the anchor and\n\t\t\t\t//  `VERTICAL` aligns at the bottom left of the anchor.\n\t\t\t\tif (delegate.anchorAxisAlignment === AnchorAxisAlignment.HORIZONTAL) {\n\t\t\t\t\tif (delegate.anchorAlignment === AnchorAlignment.LEFT) {\n\t\t\t\t\t\tx = elementPosition.left;\n\t\t\t\t\t\ty = elementPosition.top;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tx = elementPosition.left + elementPosition.width;\n\t\t\t\t\t\ty = elementPosition.top;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!isMacintosh) {\n\t\t\t\t\t\tconst availableHeightForMenu = window.screen.height - y;\n\t\t\t\t\t\tif (availableHeightForMenu < actions.length * (isWindows ? 45 : 32) /* guess of 1 menu item height */) {\n\t\t\t\t\t\t\t// this is a guess to detect whether the context menu would\n\t\t\t\t\t\t\t// open to the bottom from this point or to the top. If the\n\t\t\t\t\t\t\t// menu opens to the top, make sure to align it to the bottom\n\t\t\t\t\t\t\t// of the anchor and not to the top.\n\t\t\t\t\t\t\t// this seems to be only necessary for Windows and Linux.\n\t\t\t\t\t\t\ty += elementPosition.height;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (delegate.anchorAlignment === AnchorAlignment.LEFT) {\n\t\t\t\t\t\tx = elementPosition.left;\n\t\t\t\t\t\ty = elementPosition.top + elementPosition.height;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tx = elementPosition.left + elementPosition.width;\n\t\t\t\t\t\ty = elementPosition.top + elementPosition.height;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Shift macOS menus by a few pixels below elements\n\t\t\t\t// to account for extra padding on top of native menu\n\t\t\t\t// https://github.com/microsoft/vscode/issues/84231\n\t\t\t\tif (isMacintosh) {\n\t\t\t\t\ty += 4 / zoom;\n\t\t\t\t}\n\t\t\t} else if (isAnchor(anchor)) {\n\t\t\t\tx = anchor.x;\n\t\t\t\ty = anchor.y;\n\t\t\t} else {\n\t\t\t\t// We leave x/y undefined in this case which will result in\n\t\t\t\t// Electron taking care of opening the menu at the cursor position.\n\t\t\t}\n\n\t\t\tif (typeof x === 'number') {\n\t\t\t\tx = Math.floor(x * zoom);\n\t\t\t}\n\n\t\t\tif (typeof y === 'number') {\n\t\t\t\ty = Math.floor(y * zoom);\n\t\t\t}\n\n\t\t\tpopup(menu, { x, y, positioningItem: delegate.autoSelectFirstItem ? 0 : undefined, }, () => onHide());\n\n\t\t\tthis._onDidShowContextMenu.fire();\n\t\t}\n\t}\n\n\tprivate createMenu(delegate: IContextMenuDelegate, entries: readonly IAction[], onHide: () => void, submenuIds = new Set<string>()): IContextMenuItem[] {\n\t\tconst actionRunner = delegate.actionRunner || new ActionRunner();\n\t\treturn coalesce(entries.map(entry => this.createMenuItem(delegate, entry, actionRunner, onHide, submenuIds)));\n\t}\n\n\tprivate createMenuItem(delegate: IContextMenuDelegate, entry: IAction, actionRunner: IActionRunner, onHide: () => void, submenuIds: Set<string>): IContextMenuItem | undefined {\n\t\t// Separator\n\t\tif (entry instanceof Separator) {\n\t\t\treturn { type: 'separator' };\n\t\t}\n\n\t\t// Submenu\n\t\tif (entry instanceof SubmenuAction) {\n\t\t\tif (submenuIds.has(entry.id)) {\n\t\t\t\tconsole.warn(`Found submenu cycle: ${entry.id}`);\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tlabel: unmnemonicLabel(stripIcons(entry.label)).trim(),\n\t\t\t\tsubmenu: this.createMenu(delegate, entry.actions, onHide, new Set([...submenuIds, entry.id]))\n\t\t\t};\n\t\t}\n\n\t\t// Normal Menu Item\n\t\telse {\n\t\t\tlet type: 'radio' | 'checkbox' | undefined = undefined;\n\t\t\tif (!!entry.checked) {\n\t\t\t\tif (typeof delegate.getCheckedActionsRepresentation === 'function') {\n\t\t\t\t\ttype = delegate.getCheckedActionsRepresentation(entry);\n\t\t\t\t} else {\n\t\t\t\t\ttype = 'checkbox';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst item: IContextMenuItem = {\n\t\t\t\tlabel: unmnemonicLabel(stripIcons(entry.label)).trim(),\n\t\t\t\tchecked: !!entry.checked,\n\t\t\t\ttype,\n\t\t\t\tenabled: !!entry.enabled,\n\t\t\t\tclick: event => {\n\n\t\t\t\t\t// To preserve pre-electron-2.x behaviour, we first trigger\n\t\t\t\t\t// the onHide callback and then the action.\n\t\t\t\t\t// Fixes https://github.com/microsoft/vscode/issues/45601\n\t\t\t\t\tonHide();\n\n\t\t\t\t\t// Run action which will close the menu\n\t\t\t\t\tthis.runAction(actionRunner, entry, delegate, event);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst keybinding = !!delegate.getKeyBinding ? delegate.getKeyBinding(entry) : this.keybindingService.lookupKeybinding(entry.id);\n\t\t\tif (keybinding) {\n\t\t\t\tconst electronAccelerator = keybinding.getElectronAccelerator();\n\t\t\t\tif (electronAccelerator) {\n\t\t\t\t\titem.accelerator = electronAccelerator;\n\t\t\t\t} else {\n\t\t\t\t\tconst label = keybinding.getLabel();\n\t\t\t\t\tif (label) {\n\t\t\t\t\t\titem.label = `${item.label} [${label}]`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn item;\n\t\t}\n\t}\n\n\tprivate async runAction(actionRunner: IActionRunner, actionToRun: IAction, delegate: IContextMenuDelegate, event: IContextMenuEvent): Promise<void> {\n\t\tif (!delegate.skipTelemetry) {\n\t\t\tthis.telemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>('workbenchActionExecuted', { id: actionToRun.id, from: 'contextMenu' });\n\t\t}\n\n\t\tconst context = delegate.getActionsContext ? delegate.getActionsContext(event) : undefined;\n\n\t\tconst runnable = actionRunner.run(actionToRun, context);\n\t\ttry {\n\t\t\tawait runnable;\n\t\t} catch (error) {\n\t\t\tthis.notificationService.error(error);\n\t\t}\n\t}\n}\n\nregisterSingleton(IContextMenuService, ContextMenuService, InstantiationType.Delayed);\n"]}