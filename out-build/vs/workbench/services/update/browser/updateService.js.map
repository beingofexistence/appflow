{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/services/update/browser/updateService.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IAuBzF,IAAM,GAAG,GAAT,MAAM,GAAqB,SAAQ,eAAG;QAQ5C,IAAI,KAAK,KAAY,OAAO,IAAI,CAAC,CAAC,CAAM,CAAC,CAAC;QAC1C,IAAI,KAAK,CAAC,KAAU;YACnB,IAAI,CAAC,CAAC,GAAQ,KAAK,CAAC;YACpB,IAAI,CAAC,CAAC,CAAc,IAAI,CAAC,KAAK,CAAC,CAAC;QACjC,CAAC;QAED,YACsC,CAAwC,EAC/D,CAAiC;YAE/C,KAAK,EAAE,CAAC;YAH8C,MAAC,GAAD,CAAC,CAAsB;YAC9C,MAAC,GAAD,CAAC,CAAe;YAZxC,MAAC,GAAgB,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAa,CAAC,CAAC;YACrD,kBAAa,GAAiB,IAAI,CAAC,CAAC,CAAc,KAAK,CAAC;YAEzD,MAAC,GAAe,YAAG,CAAG,aAAa,CAAC;YAa3C,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;QAC7B,CAAC;QAED,KAAK,CAAC,eAAe;YACpB,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,CAAC,CAAiB,KAAK,CAAC,CAAC;YACnD,IAAI,MAAM,KAAK,SAAS,EAAE;gBACzB,OAAO,SAAS,CAAC,CAAC,qBAAqB;aACvC;YAED,OAAO,CAAC,CAAC,MAAM,CAAC;QACjB,CAAC;QAED,KAAK,CAAC,eAAe,CAAC,QAAiB;YACtC,MAAM,IAAI,CAAC,CAAC,CAAiB,QAAQ,CAAC,CAAC;QACxC,CAAC;QAEO,KAAK,CAAC,CAAC,CAAiB,QAAiB;YAChD,IAAI,IAAI,CAAC,CAAC,CAAkB,OAAO,IAAI,IAAI,CAAC,CAAC,CAAkB,OAAO,CAAC,cAAc,EAAE;gBACtF,MAAM,cAAc,GAAG,IAAI,CAAC,CAAC,CAAkB,OAAO,CAAC,cAAc,CAAC;gBAEtE,gCAAgC;gBAChC,IAAI,CAAC,KAAK,GAAG,YAAG,CAAG,kBAAkB,CAAC,QAAQ,CAAC,CAAC;gBAEhD,MAAM,MAAM,GAAG,MAAM,cAAc,CAAC,cAAc,EAAE,CAAC;gBACrD,IAAI,MAAM,EAAE;oBACX,sBAAsB;oBACtB,IAAI,CAAC,KAAK,GAAG,YAAG,CAAG,KAAK,CAAC,EAAE,OAAO,EAAE,MAAM,CAAC,OAAO,EAAE,cAAc,EAAE,MAAM,CAAC,OAAO,EAAE,CAAC,CAAC;iBACtF;qBAAM;oBACN,gBAAgB;oBAChB,IAAI,CAAC,KAAK,GAAG,YAAG,CAAG,IAAI,4BAAoB,CAAC;iBAC5C;gBAED,OAAO,MAAM,CAAC;aACd;YAED,OAAO,SAAS,CAAC,CAAC,4BAA4B;QAC/C,CAAC;QAED,KAAK,CAAC,cAAc;YACnB,QAAQ;QACT,CAAC;QAED,KAAK,CAAC,WAAW;YAChB,IAAI,CAAC,CAAC,CAAW,MAAM,EAAE,CAAC;QAC3B,CAAC;QAED,KAAK,CAAC,cAAc;YACnB,IAAI,CAAC,CAAC,CAAW,MAAM,EAAE,CAAC;QAC3B,CAAC;QAED,KAAK,CAAC,oBAAoB,CAAC,WAAmB;YAC7C,OAAO;QACR,CAAC;KACD,CAAA;IAzEY,kBAAG;kBAAH,GAAG;QAeb,WAAA,wBAAG,CAAA;QACH,WAAA,UAAG,CAAA;OAhBO,GAAG,CAyEf;IAED,IAAA,gBAAG,EAAe,YAAG,EAAa,GAAG,kCAA2C,CAAC","file":"updateService.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { IUpdateService, State, UpdateType } from 'vs/platform/update/common/update';\nimport { InstantiationType, registerSingleton } from 'vs/platform/instantiation/common/extensions';\nimport { IBrowserWorkbenchEnvironmentService } from 'vs/workbench/services/environment/browser/environmentService';\nimport { IHostService } from 'vs/workbench/services/host/browser/host';\nimport { Disposable } from 'vs/base/common/lifecycle';\n\nexport interface IUpdate {\n\tversion: string;\n}\n\nexport interface IUpdateProvider {\n\n\t/**\n\t * Should return with the `IUpdate` object if an update is\n\t * available or `null` otherwise to signal that there are\n\t * no updates.\n\t */\n\tcheckForUpdate(): Promise<IUpdate | null>;\n}\n\nexport class BrowserUpdateService extends Disposable implements IUpdateService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate _onStateChange = this._register(new Emitter<State>());\n\treadonly onStateChange: Event<State> = this._onStateChange.event;\n\n\tprivate _state: State = State.Uninitialized;\n\tget state(): State { return this._state; }\n\tset state(state: State) {\n\t\tthis._state = state;\n\t\tthis._onStateChange.fire(state);\n\t}\n\n\tconstructor(\n\t\t@IBrowserWorkbenchEnvironmentService private readonly environmentService: IBrowserWorkbenchEnvironmentService,\n\t\t@IHostService private readonly hostService: IHostService\n\t) {\n\t\tsuper();\n\n\t\tthis.checkForUpdates(false);\n\t}\n\n\tasync isLatestVersion(): Promise<boolean | undefined> {\n\t\tconst update = await this.doCheckForUpdates(false);\n\t\tif (update === undefined) {\n\t\t\treturn undefined; // no update provider\n\t\t}\n\n\t\treturn !!update;\n\t}\n\n\tasync checkForUpdates(explicit: boolean): Promise<void> {\n\t\tawait this.doCheckForUpdates(explicit);\n\t}\n\n\tprivate async doCheckForUpdates(explicit: boolean): Promise<IUpdate | null /* no update available */ | undefined /* no update provider */> {\n\t\tif (this.environmentService.options && this.environmentService.options.updateProvider) {\n\t\t\tconst updateProvider = this.environmentService.options.updateProvider;\n\n\t\t\t// State -> Checking for Updates\n\t\t\tthis.state = State.CheckingForUpdates(explicit);\n\n\t\t\tconst update = await updateProvider.checkForUpdate();\n\t\t\tif (update) {\n\t\t\t\t// State -> Downloaded\n\t\t\t\tthis.state = State.Ready({ version: update.version, productVersion: update.version });\n\t\t\t} else {\n\t\t\t\t// State -> Idle\n\t\t\t\tthis.state = State.Idle(UpdateType.Archive);\n\t\t\t}\n\n\t\t\treturn update;\n\t\t}\n\n\t\treturn undefined; // no update provider to ask\n\t}\n\n\tasync downloadUpdate(): Promise<void> {\n\t\t// no-op\n\t}\n\n\tasync applyUpdate(): Promise<void> {\n\t\tthis.hostService.reload();\n\t}\n\n\tasync quitAndInstall(): Promise<void> {\n\t\tthis.hostService.reload();\n\t}\n\n\tasync _applySpecificUpdate(packagePath: string): Promise<void> {\n\t\t// noop\n\t}\n}\n\nregisterSingleton(IUpdateService, BrowserUpdateService, InstantiationType.Eager);\n"]}