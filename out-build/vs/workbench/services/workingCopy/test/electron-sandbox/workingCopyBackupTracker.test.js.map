{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/services/workingCopy/test/electron-sandbox/workingCopyBackupTracker.test.ts"],"names":[],"mappings":"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","file":"workingCopyBackupTracker.test.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { isMacintosh, isWindows } from 'vs/base/common/platform';\nimport { join } from 'vs/base/common/path';\nimport { URI } from 'vs/base/common/uri';\nimport { hash } from 'vs/base/common/hash';\nimport { NativeWorkingCopyBackupTracker } from 'vs/workbench/services/workingCopy/electron-sandbox/workingCopyBackupTracker';\nimport { TextFileEditorModelManager } from 'vs/workbench/services/textfile/common/textFileEditorModelManager';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { EditorPart } from 'vs/workbench/browser/parts/editor/editorPart';\nimport { IEditorGroupsService } from 'vs/workbench/services/editor/common/editorGroupsService';\nimport { EditorService } from 'vs/workbench/services/editor/browser/editorService';\nimport { IWorkingCopyBackupService } from 'vs/workbench/services/workingCopy/common/workingCopyBackup';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { ensureNoDisposablesAreLeakedInTestSuite, toResource } from 'vs/base/test/common/utils';\nimport { IFilesConfigurationService } from 'vs/workbench/services/filesConfiguration/common/filesConfigurationService';\nimport { IWorkingCopyService } from 'vs/workbench/services/workingCopy/common/workingCopyService';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { HotExitConfiguration } from 'vs/platform/files/common/files';\nimport { ShutdownReason, ILifecycleService } from 'vs/workbench/services/lifecycle/common/lifecycle';\nimport { IFileDialogService, ConfirmResult, IDialogService } from 'vs/platform/dialogs/common/dialogs';\nimport { IWorkspaceContextService } from 'vs/platform/workspace/common/workspace';\nimport { INativeHostService } from 'vs/platform/native/common/native';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { TestConfigurationService } from 'vs/platform/configuration/test/common/testConfigurationService';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { createEditorPart, registerTestFileEditor, TestBeforeShutdownEvent, TestEnvironmentService, TestFilesConfigurationService, TestFileService, workbenchTeardown } from 'vs/workbench/test/browser/workbenchTestServices';\nimport { MockContextKeyService } from 'vs/platform/keybinding/test/common/mockKeybindingService';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { TestWorkspace, Workspace } from 'vs/platform/workspace/test/common/testWorkspace';\nimport { IProgressService } from 'vs/platform/progress/common/progress';\nimport { IWorkingCopyEditorService } from 'vs/workbench/services/workingCopy/common/workingCopyEditorService';\nimport { TestContextService, TestWorkingCopy } from 'vs/workbench/test/common/workbenchTestServices';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { IWorkingCopyBackup, WorkingCopyCapabilities } from 'vs/workbench/services/workingCopy/common/workingCopy';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { Schemas } from 'vs/base/common/network';\nimport { joinPath } from 'vs/base/common/resources';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { TestServiceAccessor, workbenchInstantiationService } from 'vs/workbench/test/electron-sandbox/workbenchTestServices';\nimport { UriIdentityService } from 'vs/platform/uriIdentity/common/uriIdentityService';\n\nsuite('WorkingCopyBackupTracker (native)', function () {\n\n\tclass TestWorkingCopyBackupTracker extends NativeWorkingCopyBackupTracker {\n\n\t\tconstructor(\n\t\t\t@IWorkingCopyBackupService workingCopyBackupService: IWorkingCopyBackupService,\n\t\t\t@IFilesConfigurationService filesConfigurationService: IFilesConfigurationService,\n\t\t\t@IWorkingCopyService workingCopyService: IWorkingCopyService,\n\t\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t\t@IFileDialogService fileDialogService: IFileDialogService,\n\t\t\t@IDialogService dialogService: IDialogService,\n\t\t\t@IWorkspaceContextService contextService: IWorkspaceContextService,\n\t\t\t@INativeHostService nativeHostService: INativeHostService,\n\t\t\t@ILogService logService: ILogService,\n\t\t\t@IEditorService editorService: IEditorService,\n\t\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t\t@IProgressService progressService: IProgressService,\n\t\t\t@IWorkingCopyEditorService workingCopyEditorService: IWorkingCopyEditorService,\n\t\t\t@IEditorGroupsService editorGroupService: IEditorGroupsService\n\t\t) {\n\t\t\tsuper(workingCopyBackupService, filesConfigurationService, workingCopyService, lifecycleService, fileDialogService, dialogService, contextService, nativeHostService, logService, environmentService, progressService, workingCopyEditorService, editorService, editorGroupService);\n\t\t}\n\n\t\tprotected override getBackupScheduleDelay(): number {\n\t\t\treturn 10; // Reduce timeout for tests\n\t\t}\n\n\t\twaitForReady(): Promise<void> {\n\t\t\treturn super.whenReady;\n\t\t}\n\n\t\tget pendingBackupOperationCount(): number { return this.pendingBackupOperations.size; }\n\n\t\toverride dispose() {\n\t\t\tsuper.dispose();\n\n\t\t\tfor (const [_, pending] of this.pendingBackupOperations) {\n\t\t\t\tpending.cancel();\n\t\t\t\tpending.disposable.dispose();\n\t\t\t}\n\t\t}\n\n\t\tprivate readonly _onDidResume = this._register(new Emitter<void>());\n\t\treadonly onDidResume = this._onDidResume.event;\n\n\t\tprivate readonly _onDidSuspend = this._register(new Emitter<void>());\n\t\treadonly onDidSuspend = this._onDidSuspend.event;\n\n\t\tprotected override suspendBackupOperations(): { resume: () => void } {\n\t\t\tconst { resume } = super.suspendBackupOperations();\n\n\t\t\tthis._onDidSuspend.fire();\n\n\t\t\treturn {\n\t\t\t\tresume: () => {\n\t\t\t\t\tresume();\n\n\t\t\t\t\tthis._onDidResume.fire();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\tlet testDir: URI;\n\tlet backupHome: URI;\n\tlet workspaceBackupPath: URI;\n\n\tlet accessor: TestServiceAccessor;\n\n\tconst disposables = new DisposableStore();\n\n\tsetup(async () => {\n\t\ttestDir = URI.file(join(generateUuid(), 'vsctests', 'workingcopybackuptracker')).with({ scheme: Schemas.inMemory });\n\t\tbackupHome = joinPath(testDir, 'Backups');\n\t\tconst workspacesJsonPath = joinPath(backupHome, 'workspaces.json');\n\n\t\tconst workspaceResource = URI.file(isWindows ? 'c:\\\\workspace' : '/workspace').with({ scheme: Schemas.inMemory });\n\t\tworkspaceBackupPath = joinPath(backupHome, hash(workspaceResource.toString()).toString(16));\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\t\tdisposables.add((<TextFileEditorModelManager>accessor.textFileService.files));\n\n\t\tdisposables.add(registerTestFileEditor());\n\n\t\tawait accessor.fileService.createFolder(backupHome);\n\t\tawait accessor.fileService.createFolder(workspaceBackupPath);\n\n\t\treturn accessor.fileService.writeFile(workspacesJsonPath, VSBuffer.fromString(''));\n\t});\n\n\tteardown(() => {\n\t\tdisposables.clear();\n\t});\n\n\tasync function createTracker(autoSaveEnabled = false): Promise<{ accessor: TestServiceAccessor; part: EditorPart; tracker: TestWorkingCopyBackupTracker; instantiationService: IInstantiationService; cleanup: () => Promise<void> }> {\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\n\t\tconst configurationService = new TestConfigurationService();\n\t\tif (autoSaveEnabled) {\n\t\t\tconfigurationService.setUserConfiguration('files', { autoSave: 'afterDelay', autoSaveDelay: 1 });\n\t\t}\n\t\tinstantiationService.stub(IConfigurationService, configurationService);\n\n\t\tinstantiationService.stub(IFilesConfigurationService, disposables.add(new TestFilesConfigurationService(\n\t\t\t<IContextKeyService>instantiationService.createInstance(MockContextKeyService),\n\t\t\tconfigurationService,\n\t\t\tnew TestContextService(TestWorkspace),\n\t\t\tTestEnvironmentService,\n\t\t\tdisposables.add(new UriIdentityService(disposables.add(new TestFileService()))),\n\t\t\tdisposables.add(new TestFileService())\n\t\t)));\n\n\t\tconst part = await createEditorPart(instantiationService, disposables);\n\t\tinstantiationService.stub(IEditorGroupsService, part);\n\n\t\tconst editorService: EditorService = disposables.add(instantiationService.createInstance(EditorService));\n\t\tinstantiationService.stub(IEditorService, editorService);\n\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\n\t\tconst tracker = instantiationService.createInstance(TestWorkingCopyBackupTracker);\n\n\t\tconst cleanup = async () => {\n\t\t\tawait accessor.workingCopyBackupService.waitForAllBackups(); // File changes could also schedule some backup operations so we need to wait for them before finishing the test\n\n\t\t\tawait workbenchTeardown(instantiationService);\n\n\t\t\tpart.dispose();\n\t\t\ttracker.dispose();\n\t\t};\n\n\t\treturn { accessor, part, tracker, instantiationService, cleanup };\n\t}\n\n\ttest('Track backups (file, auto save off)', function () {\n\t\treturn trackBackupsTest(toResource.call(this, '/path/index.txt'), false);\n\t});\n\n\ttest('Track backups (file, auto save on)', function () {\n\t\treturn trackBackupsTest(toResource.call(this, '/path/index.txt'), true);\n\t});\n\n\tasync function trackBackupsTest(resource: URI, autoSave: boolean) {\n\t\tconst { accessor, cleanup } = await createTracker(autoSave);\n\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst fileModel = accessor.textFileService.files.get(resource);\n\t\tassert.ok(fileModel);\n\t\tfileModel.textEditorModel?.setValue('Super Good');\n\n\t\tawait accessor.workingCopyBackupService.joinBackupResource();\n\n\t\tassert.strictEqual(accessor.workingCopyBackupService.hasBackupSync(fileModel), true);\n\n\t\tfileModel.dispose();\n\n\t\tawait accessor.workingCopyBackupService.joinDiscardBackup();\n\n\t\tassert.strictEqual(accessor.workingCopyBackupService.hasBackupSync(fileModel), false);\n\n\t\tawait cleanup();\n\t}\n\n\ttest('onWillShutdown - no veto if no dirty files', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - veto if user cancels (hot.exit: off)', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.CANCEL);\n\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: 'off' } });\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(veto);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - no veto if auto save is on', async function () {\n\t\tconst { accessor, cleanup } = await createTracker(true /* auto save enabled */);\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 0);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - no veto and backups cleaned up if user does not want to save (hot.exit: off)', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.DONT_SAVE);\n\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: 'off' } });\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(accessor.workingCopyBackupService.discardedBackups.length > 0);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - no backups discarded when shutdown without dirty but tracker not ready', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(!accessor.workingCopyBackupService.discardedAllBackups);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - backups discarded when shutdown without dirty', async function () {\n\t\tconst { accessor, tracker, cleanup } = await createTracker();\n\n\t\tawait tracker.waitForReady();\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(accessor.workingCopyBackupService.discardedAllBackups);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - save (hot.exit: off)', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.SAVE);\n\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: 'off' } });\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(!model?.isDirty());\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - veto if backup fails', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tclass TestBackupWorkingCopy extends TestWorkingCopy {\n\n\t\t\tconstructor(resource: URI) {\n\t\t\t\tsuper(resource);\n\n\t\t\t\tthis._register(accessor.workingCopyService.registerWorkingCopy(this));\n\t\t\t}\n\n\t\t\toverride async backup(token: CancellationToken): Promise<IWorkingCopyBackup> {\n\t\t\t\tthrow new Error('unable to backup');\n\t\t\t}\n\t\t}\n\n\t\tconst resource = toResource.call(this, '/path/custom.txt');\n\t\tconst customWorkingCopy = disposables.add(new TestBackupWorkingCopy(resource));\n\t\tcustomWorkingCopy.setDirty(true);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\tevent.reason = ShutdownReason.QUIT;\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(veto);\n\n\t\tconst finalVeto = await event.finalValue?.();\n\t\tassert.ok(finalVeto); // assert the tracker uses the internal finalVeto API\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - scratchpads - veto if backup fails', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tclass TestBackupWorkingCopy extends TestWorkingCopy {\n\n\t\t\tconstructor(resource: URI) {\n\t\t\t\tsuper(resource);\n\n\t\t\t\tthis._register(accessor.workingCopyService.registerWorkingCopy(this));\n\t\t\t}\n\n\t\t\toverride capabilities = WorkingCopyCapabilities.Untitled | WorkingCopyCapabilities.Scratchpad;\n\n\t\t\toverride async backup(token: CancellationToken): Promise<IWorkingCopyBackup> {\n\t\t\t\tthrow new Error('unable to backup');\n\t\t\t}\n\n\t\t\toverride isDirty(): boolean {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\toverride isModified(): boolean {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tconst resource = toResource.call(this, '/path/custom.txt');\n\t\tdisposables.add(new TestBackupWorkingCopy(resource));\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\tevent.reason = ShutdownReason.QUIT;\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(veto);\n\n\t\tconst finalVeto = await event.finalValue?.();\n\t\tassert.ok(finalVeto); // assert the tracker uses the internal finalVeto API\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - pending backup operations canceled and tracker suspended/resumsed', async function () {\n\t\tconst { accessor, tracker, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 1);\n\n\t\tconst onSuspend = Event.toPromise(tracker.onDidSuspend);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\tevent.reason = ShutdownReason.QUIT;\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tawait onSuspend;\n\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 0);\n\n\t\t// Ops are suspended during shutdown!\n\t\tmodel?.textEditorModel?.setValue('bar');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 0);\n\n\t\tconst onResume = Event.toPromise(tracker.onDidResume);\n\t\tawait event.value;\n\n\t\t// Ops are resumed after shutdown!\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tawait onResume;\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 1);\n\n\t\tawait cleanup();\n\t});\n\n\tsuite('Hot Exit', () => {\n\t\tsuite('\"onExit\" setting', () => {\n\t\t\ttest('should hot exit on non-Mac (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, true, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit on non-Mac (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, true, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, true, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, true, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\t\tsuite('\"onExitAndWindowClose\" setting', () => {\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\t\tsuite('\"onExit\" setting - scratchpad', () => {\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\t\tsuite('\"onExitAndWindowClose\" setting - scratchpad', () => {\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\n\t\tasync function hotExitTest(this: any, setting: string, shutdownReason: ShutdownReason, multipleWindows: boolean, workspace: boolean, shouldVeto: boolean): Promise<void> {\n\t\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\t\t// Set hot exit config\n\t\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: setting } });\n\n\t\t\t// Set empty workspace if required\n\t\t\tif (!workspace) {\n\t\t\t\taccessor.contextService.setWorkspace(new Workspace('empty:1508317022751'));\n\t\t\t}\n\n\t\t\t// Set multiple windows if required\n\t\t\tif (multipleWindows) {\n\t\t\t\taccessor.nativeHostService.windowCount = Promise.resolve(2);\n\t\t\t}\n\n\t\t\t// Set cancel to force a veto if hot exit does not trigger\n\t\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.CANCEL);\n\n\t\t\tawait model?.resolve();\n\t\t\tmodel?.textEditorModel?.setValue('foo');\n\t\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\n\t\t\tconst event = new TestBeforeShutdownEvent();\n\t\t\tevent.reason = shutdownReason;\n\t\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\t\tconst veto = await event.value;\n\t\t\tassert.ok(typeof event.finalValue === 'function'); // assert the tracker uses the internal finalVeto API\n\t\t\tassert.strictEqual(accessor.workingCopyBackupService.discardedBackups.length, 0); // When hot exit is set, backups should never be cleaned since the confirm result is cancel\n\t\t\tassert.strictEqual(veto, shouldVeto);\n\n\t\t\tawait cleanup();\n\t\t}\n\n\t\tasync function scratchpadHotExitTest(this: any, setting: string, shutdownReason: ShutdownReason, multipleWindows: boolean, workspace: boolean, shouldVeto: boolean): Promise<void> {\n\t\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\t\tclass TestBackupWorkingCopy extends TestWorkingCopy {\n\n\t\t\t\tconstructor(resource: URI) {\n\t\t\t\t\tsuper(resource);\n\n\t\t\t\t\tthis._register(accessor.workingCopyService.registerWorkingCopy(this));\n\t\t\t\t}\n\n\t\t\t\toverride capabilities = WorkingCopyCapabilities.Untitled | WorkingCopyCapabilities.Scratchpad;\n\n\t\t\t\toverride isDirty(): boolean {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\toverride isModified(): boolean {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Set hot exit config\n\t\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: setting } });\n\n\t\t\t// Set empty workspace if required\n\t\t\tif (!workspace) {\n\t\t\t\taccessor.contextService.setWorkspace(new Workspace('empty:1508317022751'));\n\t\t\t}\n\n\t\t\t// Set multiple windows if required\n\t\t\tif (multipleWindows) {\n\t\t\t\taccessor.nativeHostService.windowCount = Promise.resolve(2);\n\t\t\t}\n\n\t\t\t// Set cancel to force a veto if hot exit does not trigger\n\t\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.CANCEL);\n\n\t\t\tconst resource = toResource.call(this, '/path/custom.txt');\n\t\t\tdisposables.add(new TestBackupWorkingCopy(resource));\n\n\t\t\tconst event = new TestBeforeShutdownEvent();\n\t\t\tevent.reason = shutdownReason;\n\t\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\t\tconst veto = await event.value;\n\t\t\tassert.ok(typeof event.finalValue === 'function'); // assert the tracker uses the internal finalVeto API\n\t\t\tassert.strictEqual(accessor.workingCopyBackupService.discardedBackups.length, 0); // When hot exit is set, backups should never be cleaned since the confirm result is cancel\n\t\t\tassert.strictEqual(veto, shouldVeto);\n\n\t\t\tawait cleanup();\n\t\t}\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n"]}