{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/services/workingCopy/test/browser/workingCopyBackupTracker.test.ts"],"names":[],"mappings":"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","file":"workingCopyBackupTracker.test.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { URI } from 'vs/base/common/uri';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { EditorPart } from 'vs/workbench/browser/parts/editor/editorPart';\nimport { IEditorGroupsService } from 'vs/workbench/services/editor/common/editorGroupsService';\nimport { EditorService } from 'vs/workbench/services/editor/browser/editorService';\nimport { IUntitledTextResourceEditorInput } from 'vs/workbench/common/editor';\nimport { IWorkingCopyBackupService } from 'vs/workbench/services/workingCopy/common/workingCopyBackup';\nimport { ensureNoDisposablesAreLeakedInTestSuite, toResource } from 'vs/base/test/common/utils';\nimport { IFilesConfigurationService } from 'vs/workbench/services/filesConfiguration/common/filesConfigurationService';\nimport { IWorkingCopyService } from 'vs/workbench/services/workingCopy/common/workingCopyService';\nimport { IWorkingCopyBackup } from 'vs/workbench/services/workingCopy/common/workingCopy';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { ILifecycleService, LifecyclePhase } from 'vs/workbench/services/lifecycle/common/lifecycle';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { UntitledTextEditorInput } from 'vs/workbench/services/untitled/common/untitledTextEditorInput';\nimport { createEditorPart, InMemoryTestWorkingCopyBackupService, registerTestResourceEditor, TestServiceAccessor, toTypedWorkingCopyId, toUntypedWorkingCopyId, workbenchInstantiationService, workbenchTeardown } from 'vs/workbench/test/browser/workbenchTestServices';\nimport { TestWorkingCopy } from 'vs/workbench/test/common/workbenchTestServices';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { timeout } from 'vs/base/common/async';\nimport { BrowserWorkingCopyBackupTracker } from 'vs/workbench/services/workingCopy/browser/workingCopyBackupTracker';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { IWorkingCopyEditorHandler, IWorkingCopyEditorService } from 'vs/workbench/services/workingCopy/common/workingCopyEditorService';\nimport { bufferToReadable, VSBuffer } from 'vs/base/common/buffer';\nimport { isWindows } from 'vs/base/common/platform';\nimport { Schemas } from 'vs/base/common/network';\n\nsuite('WorkingCopyBackupTracker (browser)', function () {\n\tlet accessor: TestServiceAccessor;\n\tconst disposables = new DisposableStore();\n\n\tsetup(() => {\n\t\tdisposables.add(registerTestResourceEditor());\n\t});\n\n\tteardown(async () => {\n\t\tawait workbenchTeardown(accessor.instantiationService);\n\n\t\tdisposables.clear();\n\t});\n\n\tclass TestWorkingCopyBackupTracker extends BrowserWorkingCopyBackupTracker {\n\n\t\tconstructor(\n\t\t\t@IWorkingCopyBackupService workingCopyBackupService: IWorkingCopyBackupService,\n\t\t\t@IFilesConfigurationService filesConfigurationService: IFilesConfigurationService,\n\t\t\t@IWorkingCopyService workingCopyService: IWorkingCopyService,\n\t\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t\t@ILogService logService: ILogService,\n\t\t\t@IWorkingCopyEditorService workingCopyEditorService: IWorkingCopyEditorService,\n\t\t\t@IEditorService editorService: IEditorService,\n\t\t\t@IEditorGroupsService editorGroupService: IEditorGroupsService\n\t\t) {\n\t\t\tsuper(workingCopyBackupService, filesConfigurationService, workingCopyService, lifecycleService, logService, workingCopyEditorService, editorService, editorGroupService);\n\t\t}\n\n\t\tprotected override getBackupScheduleDelay(): number {\n\t\t\treturn 10; // Reduce timeout for tests\n\t\t}\n\n\t\tget pendingBackupOperationCount(): number { return this.pendingBackupOperations.size; }\n\n\t\tgetUnrestoredBackups() {\n\t\t\treturn this.unrestoredBackups;\n\t\t}\n\n\t\tasync testRestoreBackups(handler: IWorkingCopyEditorHandler): Promise<void> {\n\t\t\treturn super.restoreBackups(handler);\n\t\t}\n\t}\n\n\tclass TestUntitledTextEditorInput extends UntitledTextEditorInput {\n\n\t\tresolved = false;\n\n\t\toverride resolve() {\n\t\t\tthis.resolved = true;\n\n\t\t\treturn super.resolve();\n\t\t}\n\t}\n\n\tasync function createTracker(): Promise<{ accessor: TestServiceAccessor; part: EditorPart; tracker: TestWorkingCopyBackupTracker; workingCopyBackupService: InMemoryTestWorkingCopyBackupService; instantiationService: IInstantiationService }> {\n\t\tconst workingCopyBackupService = disposables.add(new InMemoryTestWorkingCopyBackupService());\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\tinstantiationService.stub(IWorkingCopyBackupService, workingCopyBackupService);\n\n\t\tconst part = await createEditorPart(instantiationService, disposables);\n\t\tinstantiationService.stub(IEditorGroupsService, part);\n\n\t\tdisposables.add(registerTestResourceEditor());\n\n\t\tconst editorService: EditorService = disposables.add(instantiationService.createInstance(EditorService));\n\t\tinstantiationService.stub(IEditorService, editorService);\n\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\n\t\tconst tracker = disposables.add(instantiationService.createInstance(TestWorkingCopyBackupTracker));\n\n\t\treturn { accessor, part, tracker, workingCopyBackupService: workingCopyBackupService, instantiationService };\n\t}\n\n\tasync function untitledBackupTest(untitled: IUntitledTextResourceEditorInput = { resource: undefined }): Promise<void> {\n\t\tconst { accessor, workingCopyBackupService } = await createTracker();\n\n\t\tconst untitledTextEditor = disposables.add((await accessor.editorService.openEditor(untitled))?.input as UntitledTextEditorInput);\n\t\tconst untitledTextModel = disposables.add(await untitledTextEditor.resolve());\n\n\t\tif (!untitled?.contents) {\n\t\t\tuntitledTextModel.textEditorModel?.setValue('Super Good');\n\t\t}\n\n\t\tawait workingCopyBackupService.joinBackupResource();\n\n\t\tassert.strictEqual(workingCopyBackupService.hasBackupSync(untitledTextModel), true);\n\n\t\tuntitledTextModel.dispose();\n\n\t\tawait workingCopyBackupService.joinDiscardBackup();\n\n\t\tassert.strictEqual(workingCopyBackupService.hasBackupSync(untitledTextModel), false);\n\t}\n\n\ttest('Track backups (untitled)', function () {\n\t\treturn untitledBackupTest();\n\t});\n\n\ttest('Track backups (untitled with initial contents)', function () {\n\t\treturn untitledBackupTest({ resource: undefined, contents: 'Foo Bar' });\n\t});\n\n\ttest('Track backups (custom)', async function () {\n\t\tconst { accessor, tracker, workingCopyBackupService } = await createTracker();\n\n\t\tclass TestBackupWorkingCopy extends TestWorkingCopy {\n\n\t\t\tconstructor(resource: URI) {\n\t\t\t\tsuper(resource);\n\n\t\t\t\tdisposables.add(accessor.workingCopyService.registerWorkingCopy(this));\n\t\t\t}\n\n\t\t\treadonly backupDelay = 10;\n\n\t\t\toverride async backup(token: CancellationToken): Promise<IWorkingCopyBackup> {\n\t\t\t\tawait timeout(0);\n\n\t\t\t\treturn {};\n\t\t\t}\n\t\t}\n\n\t\tconst resource = toResource.call(this, '/path/custom.txt');\n\t\tconst customWorkingCopy = disposables.add(new TestBackupWorkingCopy(resource));\n\n\t\t// Normal\n\t\tcustomWorkingCopy.setDirty(true);\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 1);\n\t\tawait workingCopyBackupService.joinBackupResource();\n\t\tassert.strictEqual(workingCopyBackupService.hasBackupSync(customWorkingCopy), true);\n\n\t\tcustomWorkingCopy.setDirty(false);\n\t\tcustomWorkingCopy.setDirty(true);\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 1);\n\t\tawait workingCopyBackupService.joinBackupResource();\n\t\tassert.strictEqual(workingCopyBackupService.hasBackupSync(customWorkingCopy), true);\n\n\t\tcustomWorkingCopy.setDirty(false);\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 1);\n\t\tawait workingCopyBackupService.joinDiscardBackup();\n\t\tassert.strictEqual(workingCopyBackupService.hasBackupSync(customWorkingCopy), false);\n\n\t\t// Cancellation\n\t\tcustomWorkingCopy.setDirty(true);\n\t\tawait timeout(0);\n\t\tcustomWorkingCopy.setDirty(false);\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 1);\n\t\tawait workingCopyBackupService.joinDiscardBackup();\n\t\tassert.strictEqual(workingCopyBackupService.hasBackupSync(customWorkingCopy), false);\n\t});\n\n\tasync function restoreBackupsInit(): Promise<[TestWorkingCopyBackupTracker, TestServiceAccessor]> {\n\t\tconst fooFile = URI.file(isWindows ? 'c:\\\\Foo' : '/Foo');\n\t\tconst barFile = URI.file(isWindows ? 'c:\\\\Bar' : '/Bar');\n\t\tconst untitledFile1 = URI.from({ scheme: Schemas.untitled, path: 'Untitled-1' });\n\t\tconst untitledFile2 = URI.from({ scheme: Schemas.untitled, path: 'Untitled-2' });\n\n\t\tconst workingCopyBackupService = disposables.add(new InMemoryTestWorkingCopyBackupService());\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\tinstantiationService.stub(IWorkingCopyBackupService, workingCopyBackupService);\n\n\t\tconst part = await createEditorPart(instantiationService, disposables);\n\t\tinstantiationService.stub(IEditorGroupsService, part);\n\n\t\tconst editorService: EditorService = disposables.add(instantiationService.createInstance(EditorService));\n\t\tinstantiationService.stub(IEditorService, editorService);\n\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\n\t\t// Backup 2 normal files and 2 untitled files\n\t\tconst untitledFile1WorkingCopyId = toUntypedWorkingCopyId(untitledFile1);\n\t\tconst untitledFile2WorkingCopyId = toTypedWorkingCopyId(untitledFile2);\n\t\tawait workingCopyBackupService.backup(untitledFile1WorkingCopyId, bufferToReadable(VSBuffer.fromString('untitled-1')));\n\t\tawait workingCopyBackupService.backup(untitledFile2WorkingCopyId, bufferToReadable(VSBuffer.fromString('untitled-2')));\n\n\t\tconst fooFileWorkingCopyId = toUntypedWorkingCopyId(fooFile);\n\t\tconst barFileWorkingCopyId = toTypedWorkingCopyId(barFile);\n\t\tawait workingCopyBackupService.backup(fooFileWorkingCopyId, bufferToReadable(VSBuffer.fromString('fooFile')));\n\t\tawait workingCopyBackupService.backup(barFileWorkingCopyId, bufferToReadable(VSBuffer.fromString('barFile')));\n\n\t\tconst tracker = disposables.add(instantiationService.createInstance(TestWorkingCopyBackupTracker));\n\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Restored;\n\n\t\treturn [tracker, accessor];\n\t}\n\n\ttest('Restore backups (basics, some handled)', async function () {\n\t\tconst [tracker, accessor] = await restoreBackupsInit();\n\n\t\tassert.strictEqual(tracker.getUnrestoredBackups().size, 0);\n\n\t\tlet handlesCounter = 0;\n\t\tlet isOpenCounter = 0;\n\t\tlet createEditorCounter = 0;\n\n\t\tawait tracker.testRestoreBackups({\n\t\t\thandles: workingCopy => {\n\t\t\t\thandlesCounter++;\n\n\t\t\t\treturn workingCopy.typeId === 'testBackupTypeId';\n\t\t\t},\n\t\t\tisOpen: (workingCopy, editor) => {\n\t\t\t\tisOpenCounter++;\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tcreateEditor: workingCopy => {\n\t\t\t\tcreateEditorCounter++;\n\n\t\t\t\treturn disposables.add(accessor.instantiationService.createInstance(TestUntitledTextEditorInput, accessor.untitledTextEditorService.create({ initialValue: 'foo' })));\n\t\t\t}\n\t\t});\n\n\t\tassert.strictEqual(handlesCounter, 4);\n\t\tassert.strictEqual(isOpenCounter, 0);\n\t\tassert.strictEqual(createEditorCounter, 2);\n\n\t\tassert.strictEqual(accessor.editorService.count, 2);\n\t\tassert.ok(accessor.editorService.editors.every(editor => editor.isDirty()));\n\t\tassert.strictEqual(tracker.getUnrestoredBackups().size, 2);\n\n\t\tfor (const editor of accessor.editorService.editors) {\n\t\t\tassert.ok(editor instanceof TestUntitledTextEditorInput);\n\t\t\tassert.strictEqual(editor.resolved, true);\n\t\t}\n\t});\n\n\ttest('Restore backups (basics, none handled)', async function () {\n\t\tconst [tracker, accessor] = await restoreBackupsInit();\n\n\t\tawait tracker.testRestoreBackups({\n\t\t\thandles: workingCopy => false,\n\t\t\tisOpen: (workingCopy, editor) => { throw new Error('unexpected'); },\n\t\t\tcreateEditor: workingCopy => { throw new Error('unexpected'); }\n\t\t});\n\n\t\tassert.strictEqual(accessor.editorService.count, 0);\n\t\tassert.strictEqual(tracker.getUnrestoredBackups().size, 4);\n\t});\n\n\ttest('Restore backups (basics, error case)', async function () {\n\t\tconst [tracker] = await restoreBackupsInit();\n\n\t\ttry {\n\t\t\tawait tracker.testRestoreBackups({\n\t\t\t\thandles: workingCopy => true,\n\t\t\t\tisOpen: (workingCopy, editor) => { throw new Error('unexpected'); },\n\t\t\t\tcreateEditor: workingCopy => { throw new Error('unexpected'); }\n\t\t\t});\n\t\t} catch (error) {\n\t\t\t// ignore\n\t\t}\n\n\t\tassert.strictEqual(tracker.getUnrestoredBackups().size, 4);\n\t});\n\n\ttest('Restore backups (multiple handlers)', async function () {\n\t\tconst [tracker, accessor] = await restoreBackupsInit();\n\n\t\tconst firstHandler = tracker.testRestoreBackups({\n\t\t\thandles: workingCopy => {\n\t\t\t\treturn workingCopy.typeId === 'testBackupTypeId';\n\t\t\t},\n\t\t\tisOpen: (workingCopy, editor) => {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tcreateEditor: workingCopy => {\n\t\t\t\treturn disposables.add(accessor.instantiationService.createInstance(TestUntitledTextEditorInput, accessor.untitledTextEditorService.create({ initialValue: 'foo' })));\n\t\t\t}\n\t\t});\n\n\t\tconst secondHandler = tracker.testRestoreBackups({\n\t\t\thandles: workingCopy => {\n\t\t\t\treturn workingCopy.typeId.length === 0;\n\t\t\t},\n\t\t\tisOpen: (workingCopy, editor) => {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tcreateEditor: workingCopy => {\n\t\t\t\treturn disposables.add(accessor.instantiationService.createInstance(TestUntitledTextEditorInput, accessor.untitledTextEditorService.create({ initialValue: 'foo' })));\n\t\t\t}\n\t\t});\n\n\t\tawait Promise.all([firstHandler, secondHandler]);\n\n\t\tassert.strictEqual(accessor.editorService.count, 4);\n\t\tassert.ok(accessor.editorService.editors.every(editor => editor.isDirty()));\n\t\tassert.strictEqual(tracker.getUnrestoredBackups().size, 0);\n\n\t\tfor (const editor of accessor.editorService.editors) {\n\t\t\tassert.ok(editor instanceof TestUntitledTextEditorInput);\n\t\t\tassert.strictEqual(editor.resolved, true);\n\t\t}\n\t});\n\n\ttest('Restore backups (editors already opened)', async function () {\n\t\tconst [tracker, accessor] = await restoreBackupsInit();\n\n\t\tassert.strictEqual(tracker.getUnrestoredBackups().size, 0);\n\n\t\tlet handlesCounter = 0;\n\t\tlet isOpenCounter = 0;\n\n\t\tconst editor1 = disposables.add(accessor.instantiationService.createInstance(TestUntitledTextEditorInput, accessor.untitledTextEditorService.create({ initialValue: 'foo' })));\n\t\tconst editor2 = disposables.add(accessor.instantiationService.createInstance(TestUntitledTextEditorInput, accessor.untitledTextEditorService.create({ initialValue: 'foo' })));\n\n\t\tawait accessor.editorService.openEditors([{ editor: editor1 }, { editor: editor2 }]);\n\n\t\teditor1.resolved = false;\n\t\teditor2.resolved = false;\n\n\t\tawait tracker.testRestoreBackups({\n\t\t\thandles: workingCopy => {\n\t\t\t\thandlesCounter++;\n\n\t\t\t\treturn workingCopy.typeId === 'testBackupTypeId';\n\t\t\t},\n\t\t\tisOpen: (workingCopy, editor) => {\n\t\t\t\tisOpenCounter++;\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tcreateEditor: workingCopy => { throw new Error('unexpected'); }\n\t\t});\n\n\t\tassert.strictEqual(handlesCounter, 4);\n\t\tassert.strictEqual(isOpenCounter, 4);\n\n\t\tassert.strictEqual(accessor.editorService.count, 2);\n\t\tassert.strictEqual(tracker.getUnrestoredBackups().size, 2);\n\n\t\tfor (const editor of accessor.editorService.editors) {\n\t\t\tassert.ok(editor instanceof TestUntitledTextEditorInput);\n\n\t\t\t// assert that we only call `resolve` on inactive editors\n\t\t\tif (accessor.editorService.isVisible(editor)) {\n\t\t\t\tassert.strictEqual(editor.resolved, false);\n\t\t\t} else {\n\t\t\t\tassert.strictEqual(editor.resolved, true);\n\t\t\t}\n\t\t}\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n"]}