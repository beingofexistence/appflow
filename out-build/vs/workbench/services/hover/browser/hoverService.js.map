{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/services/hover/browser/hoverService.ts"],"names":[],"mappings":"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","file":"hoverService.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./media/hover';\nimport { InstantiationType, registerSingleton } from 'vs/platform/instantiation/common/extensions';\nimport { registerThemingParticipant } from 'vs/platform/theme/common/themeService';\nimport { editorHoverBorder } from 'vs/platform/theme/common/colorRegistry';\nimport { IHoverService, IHoverOptions, IHoverWidget } from 'vs/workbench/services/hover/browser/hover';\nimport { IContextMenuService, IContextViewService } from 'vs/platform/contextview/browser/contextView';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { HoverWidget } from 'vs/workbench/services/hover/browser/hoverWidget';\nimport { IContextViewProvider, IDelegate } from 'vs/base/browser/ui/contextview/contextview';\nimport { DisposableStore, IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { addDisposableListener, EventType } from 'vs/base/browser/dom';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { StandardKeyboardEvent } from 'vs/base/browser/keyboardEvent';\nimport { ResultKind } from 'vs/platform/keybinding/common/keybindingResolver';\nimport { IAccessibilityService } from 'vs/platform/accessibility/common/accessibility';\n\nexport class HoverService implements IHoverService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate _currentHoverOptions: IHoverOptions | undefined;\n\tprivate _currentHover: HoverWidget | undefined;\n\tprivate _lastHoverOptions: IHoverOptions | undefined;\n\n\tprivate _lastFocusedElementBeforeOpen: HTMLElement | undefined;\n\n\tconstructor(\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IContextViewService private readonly _contextViewService: IContextViewService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t\t@IAccessibilityService private readonly _accessibilityService: IAccessibilityService\n\t) {\n\t\tcontextMenuService.onDidShowContextMenu(() => this.hideHover());\n\t}\n\n\tshowHover(options: Readonly<IHoverOptions>, focus?: boolean, skipLastFocusedUpdate?: boolean): IHoverWidget | undefined {\n\t\tif (getHoverOptionsIdentity(this._currentHoverOptions) === getHoverOptionsIdentity(options)) {\n\t\t\treturn undefined;\n\t\t}\n\t\tthis._currentHoverOptions = options;\n\t\tthis._lastHoverOptions = options;\n\t\tconst trapFocus = options.trapFocus || this._accessibilityService.isScreenReaderOptimized();\n\t\t// HACK, remove this check when #189076 is fixed\n\t\tif (!skipLastFocusedUpdate) {\n\t\t\tif (trapFocus && document.activeElement) {\n\t\t\t\tthis._lastFocusedElementBeforeOpen = document.activeElement as HTMLElement;\n\t\t\t} else {\n\t\t\t\tthis._lastFocusedElementBeforeOpen = undefined;\n\t\t\t}\n\t\t}\n\t\tconst hoverDisposables = new DisposableStore();\n\t\tconst hover = this._instantiationService.createInstance(HoverWidget, options);\n\t\thover.onDispose(() => {\n\t\t\t// Required to handle cases such as closing the hover with the escape key\n\t\t\tthis._lastFocusedElementBeforeOpen?.focus();\n\n\t\t\t// Only clear the current options if it's the current hover, the current options help\n\t\t\t// reduce flickering when the same hover is shown multiple times\n\t\t\tif (this._currentHoverOptions === options) {\n\t\t\t\tthis._currentHoverOptions = undefined;\n\t\t\t}\n\t\t\thoverDisposables.dispose();\n\t\t});\n\t\tconst provider = this._contextViewService as IContextViewProvider;\n\t\tprovider.showContextView(\n\t\t\tnew HoverContextViewDelegate(hover, focus),\n\t\t\toptions.container\n\t\t);\n\t\thover.onRequestLayout(() => provider.layout());\n\t\tif ('targetElements' in options.target) {\n\t\t\tfor (const element of options.target.targetElements) {\n\t\t\t\thoverDisposables.add(addDisposableListener(element, EventType.CLICK, () => this.hideHover()));\n\t\t\t}\n\t\t} else {\n\t\t\thoverDisposables.add(addDisposableListener(options.target, EventType.CLICK, () => this.hideHover()));\n\t\t}\n\t\tconst focusedElement = <HTMLElement | null>document.activeElement;\n\t\tif (focusedElement) {\n\t\t\thoverDisposables.add(addDisposableListener(focusedElement, EventType.KEY_DOWN, e => this._keyDown(e, hover, !!options.hideOnKeyDown)));\n\t\t\thoverDisposables.add(addDisposableListener(document, EventType.KEY_DOWN, e => this._keyDown(e, hover, !!options.hideOnKeyDown)));\n\t\t\thoverDisposables.add(addDisposableListener(focusedElement, EventType.KEY_UP, e => this._keyUp(e, hover)));\n\t\t\thoverDisposables.add(addDisposableListener(document, EventType.KEY_UP, e => this._keyUp(e, hover)));\n\t\t}\n\n\t\tif ('IntersectionObserver' in window) {\n\t\t\tconst observer = new IntersectionObserver(e => this._intersectionChange(e, hover), { threshold: 0 });\n\t\t\tconst firstTargetElement = 'targetElements' in options.target ? options.target.targetElements[0] : options.target;\n\t\t\tobserver.observe(firstTargetElement);\n\t\t\thoverDisposables.add(toDisposable(() => observer.disconnect()));\n\t\t}\n\n\t\tthis._currentHover = hover;\n\n\t\treturn hover;\n\t}\n\n\thideHover(): void {\n\t\tif (this._currentHover?.isLocked || !this._currentHoverOptions) {\n\t\t\treturn;\n\t\t}\n\t\tthis._currentHover = undefined;\n\t\tthis._currentHoverOptions = undefined;\n\t\tthis._contextViewService.hideContextView();\n\t}\n\n\tprivate _intersectionChange(entries: IntersectionObserverEntry[], hover: IDisposable): void {\n\t\tconst entry = entries[entries.length - 1];\n\t\tif (!entry.isIntersecting) {\n\t\t\thover.dispose();\n\t\t}\n\t}\n\n\tshowAndFocusLastHover(): void {\n\t\tif (!this._lastHoverOptions) {\n\t\t\treturn;\n\t\t}\n\t\tthis.showHover(this._lastHoverOptions, true, true);\n\t}\n\n\tprivate _keyDown(e: KeyboardEvent, hover: HoverWidget, hideOnKeyDown: boolean) {\n\t\tif (e.key === 'Alt') {\n\t\t\thover.isLocked = true;\n\t\t\treturn;\n\t\t}\n\t\tconst event = new StandardKeyboardEvent(e);\n\t\tconst keybinding = this._keybindingService.resolveKeyboardEvent(event);\n\t\tif (keybinding.getSingleModifierDispatchChords().some(value => !!value) || this._keybindingService.softDispatch(event, event.target).kind !== ResultKind.NoMatchingKb) {\n\t\t\treturn;\n\t\t}\n\t\tif (hideOnKeyDown && (!this._currentHoverOptions?.trapFocus || e.key !== 'Tab')) {\n\t\t\tthis.hideHover();\n\t\t\tthis._lastFocusedElementBeforeOpen?.focus();\n\t\t}\n\t}\n\n\tprivate _keyUp(e: KeyboardEvent, hover: HoverWidget) {\n\t\tif (e.key === 'Alt') {\n\t\t\thover.isLocked = false;\n\t\t\t// Hide if alt is released while the mouse is not over hover/target\n\t\t\tif (!hover.isMouseIn) {\n\t\t\t\tthis.hideHover();\n\t\t\t\tthis._lastFocusedElementBeforeOpen?.focus();\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction getHoverOptionsIdentity(options: IHoverOptions | undefined): IHoverOptions | number | string | undefined {\n\tif (options === undefined) {\n\t\treturn undefined;\n\t}\n\treturn options?.id ?? options;\n}\n\nclass HoverContextViewDelegate implements IDelegate {\n\n\tget anchorPosition() {\n\t\treturn this._hover.anchor;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _hover: HoverWidget,\n\t\tprivate readonly _focus: boolean = false\n\t) {\n\t}\n\n\trender(container: HTMLElement) {\n\t\tthis._hover.render(container);\n\t\tif (this._focus) {\n\t\t\tthis._hover.focus();\n\t\t}\n\t\treturn this._hover;\n\t}\n\n\tgetAnchor() {\n\t\treturn {\n\t\t\tx: this._hover.x,\n\t\t\ty: this._hover.y\n\t\t};\n\t}\n\n\tlayout() {\n\t\tthis._hover.layout();\n\t}\n}\n\nregisterSingleton(IHoverService, HoverService, InstantiationType.Delayed);\n\nregisterThemingParticipant((theme, collector) => {\n\tconst hoverBorder = theme.getColor(editorHoverBorder);\n\tif (hoverBorder) {\n\t\tcollector.addRule(`.monaco-workbench .workbench-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${hoverBorder.transparent(0.5)}; }`);\n\t\tcollector.addRule(`.monaco-workbench .workbench-hover hr { border-top: 1px solid ${hoverBorder.transparent(0.5)}; }`);\n\t}\n});\n"]}