{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/services/textfile/test/browser/textFileEditorModelManager.test.ts"],"names":[],"mappings":"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","file":"textFileEditorModelManager.test.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { URI } from 'vs/base/common/uri';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { workbenchInstantiationService, TestServiceAccessor, ITestTextFileEditorModelManager } from 'vs/workbench/test/browser/workbenchTestServices';\nimport { TextFileEditorModel } from 'vs/workbench/services/textfile/common/textFileEditorModel';\nimport { FileChangesEvent, FileChangeType, FileOperationError, FileOperationResult } from 'vs/platform/files/common/files';\nimport { ensureNoDisposablesAreLeakedInTestSuite, toResource } from 'vs/base/test/common/utils';\nimport { PLAINTEXT_LANGUAGE_ID } from 'vs/editor/common/languages/modesRegistry';\nimport { ITextFileEditorModel } from 'vs/workbench/services/textfile/common/textfiles';\nimport { createTextBufferFactory } from 'vs/editor/common/model/textModel';\nimport { timeout } from 'vs/base/common/async';\nimport { DisposableStore, toDisposable } from 'vs/base/common/lifecycle';\n\nsuite('Files - TextFileEditorModelManager', () => {\n\n\tconst disposables = new DisposableStore();\n\tlet instantiationService: IInstantiationService;\n\tlet accessor: TestServiceAccessor;\n\n\tsetup(() => {\n\t\tinstantiationService = workbenchInstantiationService(undefined, disposables);\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\t\tdisposables.add(toDisposable(() => accessor.textFileService.files as ITestTextFileEditorModelManager));\n\t});\n\n\tteardown(() => {\n\t\tdisposables.clear();\n\t});\n\n\ttest('add, remove, clear, get, getAll', function () {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\n\t\tconst model1: TextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/random1.txt'), 'utf8', undefined));\n\t\tconst model2: TextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/random2.txt'), 'utf8', undefined));\n\t\tconst model3: TextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/random3.txt'), 'utf8', undefined));\n\n\t\tmanager.add(URI.file('/test.html'), model1);\n\t\tmanager.add(URI.file('/some/other.html'), model2);\n\t\tmanager.add(URI.file('/some/this.txt'), model3);\n\n\t\tconst fileUpper = URI.file('/TEST.html');\n\n\t\tassert(!manager.get(URI.file('foo')));\n\t\tassert.strictEqual(manager.get(URI.file('/test.html')), model1);\n\n\t\tassert.ok(!manager.get(fileUpper));\n\n\t\tlet results = manager.models;\n\t\tassert.strictEqual(3, results.length);\n\n\t\tlet result = manager.get(URI.file('/yes'));\n\t\tassert.ok(!result);\n\n\t\tresult = manager.get(URI.file('/some/other.txt'));\n\t\tassert.ok(!result);\n\n\t\tresult = manager.get(URI.file('/some/other.html'));\n\t\tassert.ok(result);\n\n\t\tresult = manager.get(fileUpper);\n\t\tassert.ok(!result);\n\n\t\tmanager.remove(URI.file(''));\n\n\t\tresults = manager.models;\n\t\tassert.strictEqual(3, results.length);\n\n\t\tmanager.remove(URI.file('/some/other.html'));\n\t\tresults = manager.models;\n\t\tassert.strictEqual(2, results.length);\n\n\t\tmanager.remove(fileUpper);\n\t\tresults = manager.models;\n\t\tassert.strictEqual(2, results.length);\n\n\t\tmanager.dispose();\n\t\tresults = manager.models;\n\t\tassert.strictEqual(0, results.length);\n\t});\n\n\ttest('resolve', async () => {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\t\tconst resource = URI.file('/test.html');\n\t\tconst encoding = 'utf8';\n\n\t\tconst events: ITextFileEditorModel[] = [];\n\t\tdisposables.add(manager.onDidCreate(model => {\n\t\t\tevents.push(model);\n\t\t}));\n\n\t\tconst modelPromise = manager.resolve(resource, { encoding });\n\t\tassert.ok(manager.get(resource)); // model known even before resolved()\n\n\t\tconst model1 = await modelPromise;\n\t\tassert.ok(model1);\n\t\tassert.strictEqual(model1.getEncoding(), encoding);\n\t\tassert.strictEqual(manager.get(resource), model1);\n\n\t\tconst model2 = await manager.resolve(resource, { encoding });\n\t\tassert.strictEqual(model2, model1);\n\t\tmodel1.dispose();\n\n\t\tconst model3 = await manager.resolve(resource, { encoding });\n\t\tassert.notStrictEqual(model3, model2);\n\t\tassert.strictEqual(manager.get(resource), model3);\n\t\tmodel3.dispose();\n\n\t\tassert.strictEqual(events.length, 2);\n\t\tassert.strictEqual(events[0].resource.toString(), model1.resource.toString());\n\t\tassert.strictEqual(events[1].resource.toString(), model2.resource.toString());\n\t});\n\n\ttest('resolve (async)', async () => {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\t\tconst resource = URI.file('/path/index.txt');\n\n\t\tdisposables.add(await manager.resolve(resource));\n\n\t\tlet didResolve = false;\n\t\tconst onDidResolve = new Promise<void>(resolve => {\n\t\t\tdisposables.add(manager.onDidResolve(({ model }) => {\n\t\t\t\tif (model.resource.toString() === resource.toString()) {\n\t\t\t\t\tdidResolve = true;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t}));\n\t\t});\n\n\t\tmanager.resolve(resource, { reload: { async: true } });\n\n\t\tawait onDidResolve;\n\n\t\tassert.strictEqual(didResolve, true);\n\t});\n\n\ttest('resolve (sync)', async () => {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\t\tconst resource = URI.file('/path/index.txt');\n\n\t\tdisposables.add(await manager.resolve(resource));\n\n\t\tlet didResolve = false;\n\t\tdisposables.add(manager.onDidResolve(({ model }) => {\n\t\t\tif (model.resource.toString() === resource.toString()) {\n\t\t\t\tdidResolve = true;\n\t\t\t}\n\t\t}));\n\n\t\tawait manager.resolve(resource, { reload: { async: false } });\n\t\tassert.strictEqual(didResolve, true);\n\t});\n\n\ttest('resolve (sync) - model disposed when error and first call to resolve', async () => {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\t\tconst resource = URI.file('/path/index.txt');\n\n\t\taccessor.textFileService.setReadStreamErrorOnce(new FileOperationError('fail', FileOperationResult.FILE_OTHER_ERROR));\n\n\t\tlet error: Error | undefined = undefined;\n\t\ttry {\n\t\t\tdisposables.add(await manager.resolve(resource));\n\t\t} catch (e) {\n\t\t\terror = e;\n\t\t}\n\n\t\tassert.ok(error);\n\t\tassert.strictEqual(manager.models.length, 0);\n\t});\n\n\ttest('resolve (sync) - model not disposed when error and model existed before', async () => {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\t\tconst resource = URI.file('/path/index.txt');\n\n\t\tdisposables.add(await manager.resolve(resource));\n\n\t\taccessor.textFileService.setReadStreamErrorOnce(new FileOperationError('fail', FileOperationResult.FILE_OTHER_ERROR));\n\n\t\tlet error: Error | undefined = undefined;\n\t\ttry {\n\t\t\tdisposables.add(await manager.resolve(resource, { reload: { async: false } }));\n\t\t} catch (e) {\n\t\t\terror = e;\n\t\t}\n\n\t\tassert.ok(error);\n\t\tassert.strictEqual(manager.models.length, 1);\n\t});\n\n\ttest('resolve with initial contents', async () => {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\t\tconst resource = URI.file('/test.html');\n\n\t\tconst model = disposables.add(await manager.resolve(resource, { contents: createTextBufferFactory('Hello World') }));\n\t\tassert.strictEqual(model.textEditorModel?.getValue(), 'Hello World');\n\t\tassert.strictEqual(model.isDirty(), true);\n\n\t\tdisposables.add(await manager.resolve(resource, { contents: createTextBufferFactory('More Changes') }));\n\t\tassert.strictEqual(model.textEditorModel?.getValue(), 'More Changes');\n\t\tassert.strictEqual(model.isDirty(), true);\n\t});\n\n\ttest('multiple resolves execute in sequence', async () => {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\t\tconst resource = URI.file('/test.html');\n\n\t\tlet resolvedModel: unknown;\n\n\t\tconst contents: string[] = [];\n\t\tdisposables.add(manager.onDidResolve(e => {\n\t\t\tif (e.model.resource.toString() === resource.toString()) {\n\t\t\t\tresolvedModel = disposables.add(e.model as TextFileEditorModel);\n\t\t\t\tcontents.push(e.model.textEditorModel!.getValue());\n\t\t\t}\n\t\t}));\n\n\t\tawait Promise.all([\n\t\t\tmanager.resolve(resource),\n\t\t\tmanager.resolve(resource, { contents: createTextBufferFactory('Hello World') }),\n\t\t\tmanager.resolve(resource, { reload: { async: false } }),\n\t\t\tmanager.resolve(resource, { contents: createTextBufferFactory('More Changes') })\n\t\t]);\n\n\t\tassert.ok(resolvedModel instanceof TextFileEditorModel);\n\n\t\tassert.strictEqual(resolvedModel.textEditorModel?.getValue(), 'More Changes');\n\t\tassert.strictEqual(resolvedModel.isDirty(), true);\n\n\t\tassert.strictEqual(contents[0], 'Hello Html');\n\t\tassert.strictEqual(contents[1], 'Hello World');\n\t\tassert.strictEqual(contents[2], 'More Changes');\n\t});\n\n\ttest('removed from cache when model disposed', function () {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\n\t\tconst model1: TextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/random1.txt'), 'utf8', undefined));\n\t\tconst model2: TextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/random2.txt'), 'utf8', undefined));\n\t\tconst model3: TextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/random3.txt'), 'utf8', undefined));\n\n\t\tmanager.add(URI.file('/test.html'), model1);\n\t\tmanager.add(URI.file('/some/other.html'), model2);\n\t\tmanager.add(URI.file('/some/this.txt'), model3);\n\n\t\tassert.strictEqual(manager.get(URI.file('/test.html')), model1);\n\n\t\tmodel1.dispose();\n\t\tassert(!manager.get(URI.file('/test.html')));\n\t});\n\n\ttest('events', async function () {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\n\t\tconst resource1 = toResource.call(this, '/path/index.txt');\n\t\tconst resource2 = toResource.call(this, '/path/other.txt');\n\n\t\tlet resolvedCounter = 0;\n\t\tlet removedCounter = 0;\n\t\tlet gotDirtyCounter = 0;\n\t\tlet gotNonDirtyCounter = 0;\n\t\tlet revertedCounter = 0;\n\t\tlet savedCounter = 0;\n\t\tlet encodingCounter = 0;\n\n\t\tdisposables.add(manager.onDidResolve(({ model }) => {\n\t\t\tif (model.resource.toString() === resource1.toString()) {\n\t\t\t\tresolvedCounter++;\n\t\t\t}\n\t\t}));\n\n\t\tdisposables.add(manager.onDidRemove(resource => {\n\t\t\tif (resource.toString() === resource1.toString() || resource.toString() === resource2.toString()) {\n\t\t\t\tremovedCounter++;\n\t\t\t}\n\t\t}));\n\n\t\tdisposables.add(manager.onDidChangeDirty(model => {\n\t\t\tif (model.resource.toString() === resource1.toString()) {\n\t\t\t\tif (model.isDirty()) {\n\t\t\t\t\tgotDirtyCounter++;\n\t\t\t\t} else {\n\t\t\t\t\tgotNonDirtyCounter++;\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tdisposables.add(manager.onDidRevert(model => {\n\t\t\tif (model.resource.toString() === resource1.toString()) {\n\t\t\t\trevertedCounter++;\n\t\t\t}\n\t\t}));\n\n\t\tdisposables.add(manager.onDidSave(({ model }) => {\n\t\t\tif (model.resource.toString() === resource1.toString()) {\n\t\t\t\tsavedCounter++;\n\t\t\t}\n\t\t}));\n\n\t\tdisposables.add(manager.onDidChangeEncoding(model => {\n\t\t\tif (model.resource.toString() === resource1.toString()) {\n\t\t\t\tencodingCounter++;\n\t\t\t}\n\t\t}));\n\n\t\tconst model1 = await manager.resolve(resource1, { encoding: 'utf8' });\n\t\tassert.strictEqual(resolvedCounter, 1);\n\n\t\taccessor.fileService.fireFileChanges(new FileChangesEvent([{ resource: resource1, type: FileChangeType.DELETED }], false));\n\t\taccessor.fileService.fireFileChanges(new FileChangesEvent([{ resource: resource1, type: FileChangeType.ADDED }], false));\n\n\t\tconst model2 = await manager.resolve(resource2, { encoding: 'utf8' });\n\t\tassert.strictEqual(resolvedCounter, 2);\n\n\t\t(model1 as TextFileEditorModel).updateTextEditorModel(createTextBufferFactory('changed'));\n\t\tmodel1.updatePreferredEncoding('utf16');\n\n\t\tawait model1.revert();\n\t\t(model1 as TextFileEditorModel).updateTextEditorModel(createTextBufferFactory('changed again'));\n\n\t\tawait model1.save();\n\t\tmodel1.dispose();\n\t\tmodel2.dispose();\n\n\t\tawait model1.revert();\n\t\tassert.strictEqual(removedCounter, 2);\n\t\tassert.strictEqual(gotDirtyCounter, 2);\n\t\tassert.strictEqual(gotNonDirtyCounter, 2);\n\t\tassert.strictEqual(revertedCounter, 1);\n\t\tassert.strictEqual(savedCounter, 1);\n\t\tassert.strictEqual(encodingCounter, 2);\n\n\t\tmodel1.dispose();\n\t\tmodel2.dispose();\n\t\tassert.ok(!accessor.modelService.getModel(resource1));\n\t\tassert.ok(!accessor.modelService.getModel(resource2));\n\t});\n\n\ttest('disposing model takes it out of the manager', async function () {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\n\t\tconst resource = toResource.call(this, '/path/index_something.txt');\n\n\t\tconst model = await manager.resolve(resource, { encoding: 'utf8' });\n\t\tmodel.dispose();\n\t\tassert.ok(!manager.get(resource));\n\t\tassert.ok(!accessor.modelService.getModel(model.resource));\n\t});\n\n\ttest('canDispose with dirty model', async function () {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\n\t\tconst resource = toResource.call(this, '/path/index_something.txt');\n\n\t\tconst model = disposables.add(await manager.resolve(resource, { encoding: 'utf8' }));\n\t\t(model as TextFileEditorModel).updateTextEditorModel(createTextBufferFactory('make dirty'));\n\n\t\tconst canDisposePromise = manager.canDispose(model as TextFileEditorModel);\n\t\tassert.ok(canDisposePromise instanceof Promise);\n\n\t\tlet canDispose = false;\n\t\t(async () => {\n\t\t\tcanDispose = await canDisposePromise;\n\t\t})();\n\n\t\tassert.strictEqual(canDispose, false);\n\t\tmodel.revert({ soft: true });\n\n\t\tawait timeout(0);\n\n\t\tassert.strictEqual(canDispose, true);\n\n\t\tconst canDispose2 = manager.canDispose(model as TextFileEditorModel);\n\t\tassert.strictEqual(canDispose2, true);\n\t});\n\n\ttest('language', async function () {\n\n\t\tconst languageId = 'text-file-model-manager-test';\n\t\tdisposables.add(accessor.languageService.registerLanguage({\n\t\t\tid: languageId,\n\t\t}));\n\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\n\t\tconst resource: URI = toResource.call(this, '/path/index_something.txt');\n\n\t\tlet model = disposables.add(await manager.resolve(resource, { languageId: languageId }));\n\t\tassert.strictEqual(model.textEditorModel!.getLanguageId(), languageId);\n\n\t\tmodel = await manager.resolve(resource, { languageId: 'text' });\n\t\tassert.strictEqual(model.textEditorModel!.getLanguageId(), PLAINTEXT_LANGUAGE_ID);\n\t});\n\n\ttest('file change events trigger reload (on a resolved model)', async () => {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\t\tconst resource = URI.file('/path/index.txt');\n\n\t\tdisposables.add(await manager.resolve(resource));\n\n\t\tlet didResolve = false;\n\t\tconst onDidResolve = new Promise<void>(resolve => {\n\t\t\tdisposables.add(manager.onDidResolve(({ model }) => {\n\t\t\t\tif (model.resource.toString() === resource.toString()) {\n\t\t\t\t\tdidResolve = true;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t}));\n\t\t});\n\n\t\taccessor.fileService.fireFileChanges(new FileChangesEvent([{ resource, type: FileChangeType.UPDATED }], false));\n\n\t\tawait onDidResolve;\n\t\tassert.strictEqual(didResolve, true);\n\t});\n\n\ttest('file change events trigger reload (after a model is resolved: https://github.com/microsoft/vscode/issues/132765)', async () => {\n\t\tconst manager = accessor.textFileService.files as ITestTextFileEditorModelManager;\n\t\tconst resource = URI.file('/path/index.txt');\n\n\t\tmanager.resolve(resource);\n\n\t\tlet didResolve = false;\n\t\tlet resolvedCounter = 0;\n\t\tconst onDidResolve = new Promise<void>(resolve => {\n\t\t\tdisposables.add(manager.onDidResolve(({ model }) => {\n\t\t\t\tdisposables.add(model);\n\t\t\t\tif (model.resource.toString() === resource.toString()) {\n\t\t\t\t\tresolvedCounter++;\n\t\t\t\t\tif (resolvedCounter === 2) {\n\t\t\t\t\t\tdidResolve = true;\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t});\n\n\t\taccessor.fileService.fireFileChanges(new FileChangesEvent([{ resource, type: FileChangeType.UPDATED }], false));\n\n\t\tawait onDidResolve;\n\t\tassert.strictEqual(didResolve, true);\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n"]}