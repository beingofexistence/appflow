{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/inlineChat/browser/inlineChatLivePreviewWidget.ts"],"names":[],"mappings":"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","file":"inlineChatLivePreviewWidget.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Dimension, h } from 'vs/base/browser/dom';\nimport { DisposableStore, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { assertType } from 'vs/base/common/types';\nimport { ICodeEditor, IDiffEditor } from 'vs/editor/browser/editorBrowser';\nimport { EmbeddedCodeEditorWidget, EmbeddedDiffEditorWidget } from 'vs/editor/browser/widget/embeddedCodeEditorWidget';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { Range } from 'vs/editor/common/core/range';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { ZoneWidget } from 'vs/editor/contrib/zoneWidget/browser/zoneWidget';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport * as colorRegistry from 'vs/platform/theme/common/colorRegistry';\nimport * as editorColorRegistry from 'vs/editor/common/core/editorColorRegistry';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { INLINE_CHAT_ID, inlineChatDiffInserted, inlineChatDiffRemoved, inlineChatRegionHighlight } from 'vs/workbench/contrib/inlineChat/common/inlineChat';\nimport { LineRange } from 'vs/editor/common/core/lineRange';\nimport { DetailedLineRangeMapping } from 'vs/editor/common/diff/rangeMapping';\nimport { Position } from 'vs/editor/common/core/position';\nimport { EditorExtensionsRegistry } from 'vs/editor/browser/editorExtensions';\nimport { ScrollType } from 'vs/editor/common/editorCommon';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { lineRangeAsRange, invertLineRange } from 'vs/workbench/contrib/inlineChat/browser/utils';\nimport { ResourceLabel } from 'vs/workbench/browser/labels';\nimport { URI } from 'vs/base/common/uri';\nimport { TextEdit } from 'vs/editor/common/languages';\nimport { FileKind } from 'vs/platform/files/common/files';\nimport { IModelService } from 'vs/editor/common/services/model';\nimport { EditOperation } from 'vs/editor/common/core/editOperation';\nimport { Session } from 'vs/workbench/contrib/inlineChat/browser/inlineChatSession';\nimport { ILanguageService } from 'vs/editor/common/languages/language';\nimport { FoldingController } from 'vs/editor/contrib/folding/browser/folding';\nimport { WordHighlighterContribution } from 'vs/editor/contrib/wordHighlighter/browser/wordHighlighter';\nimport { IAccessibilityService } from 'vs/platform/accessibility/common/accessibility';\n\nexport class InlineChatLivePreviewWidget extends ZoneWidget {\n\n\tprivate static readonly _hideId = 'overlayDiff';\n\n\tprivate readonly _elements = h('div.inline-chat-diff-widget@domNode');\n\n\tprivate readonly _sessionStore = this._disposables.add(new DisposableStore());\n\tprivate readonly _diffEditor: IDiffEditor;\n\tprivate _dim: Dimension | undefined;\n\tprivate _isVisible: boolean = false;\n\tprivate _isDiffLocked: boolean = false;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\tprivate readonly _session: Session,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@IAccessibilityService private readonly accessibilityService: IAccessibilityService,\n\t) {\n\t\tsuper(editor, { showArrow: false, showFrame: false, isResizeable: false, isAccessible: true, allowUnlimitedHeight: true, showInHiddenAreas: true, ordinal: 10000 + 1 });\n\t\tsuper.create();\n\t\tassertType(editor.hasModel());\n\n\t\tconst diffContributions = EditorExtensionsRegistry\n\t\t\t.getEditorContributions()\n\t\t\t.filter(c => c.id !== INLINE_CHAT_ID && c.id !== FoldingController.ID);\n\n\t\tthis._diffEditor = instantiationService.createInstance(EmbeddedDiffEditorWidget, this._elements.domNode, {\n\t\t\tscrollbar: { useShadows: false, alwaysConsumeMouseWheel: false },\n\t\t\tscrollBeyondLastLine: false,\n\t\t\trenderMarginRevertIcon: true,\n\t\t\trenderOverviewRuler: false,\n\t\t\trulers: undefined,\n\t\t\toverviewRulerBorder: undefined,\n\t\t\toverviewRulerLanes: 0,\n\t\t\tdiffAlgorithm: 'advanced',\n\t\t\tsplitViewDefaultRatio: 0.35,\n\t\t\tpadding: { top: 0, bottom: 0 },\n\t\t\tfolding: false,\n\t\t\tdiffCodeLens: false,\n\t\t\tstickyScroll: { enabled: false },\n\t\t\tminimap: { enabled: false },\n\t\t\tisInEmbeddedEditor: true,\n\t\t\toverflowWidgetsDomNode: editor.getOverflowWidgetsDomNode(),\n\t\t\tonlyShowAccessibleDiffViewer: this.accessibilityService.isScreenReaderOptimized(),\n\t\t}, {\n\t\t\toriginalEditor: { contributions: diffContributions },\n\t\t\tmodifiedEditor: { contributions: diffContributions }\n\t\t}, editor);\n\n\t\tthis._disposables.add(this._diffEditor);\n\t\tthis._diffEditor.setModel({ original: this._session.textModel0, modified: editor.getModel() });\n\t\tthis._diffEditor.updateOptions({\n\t\t\tlineDecorationsWidth: editor.getLayoutInfo().decorationsWidth\n\t\t});\n\n\t\tconst highlighter = WordHighlighterContribution.get(editor);\n\t\tif (highlighter) {\n\t\t\tthis._disposables.add(highlighter.linkWordHighlighters(this._diffEditor.getModifiedEditor()));\n\t\t}\n\n\t\tconst doStyle = () => {\n\t\t\tconst theme = themeService.getColorTheme();\n\t\t\tconst overrides: [target: string, source: string][] = [\n\t\t\t\t[colorRegistry.editorBackground, inlineChatRegionHighlight],\n\t\t\t\t[editorColorRegistry.editorGutter, inlineChatRegionHighlight],\n\t\t\t\t[colorRegistry.diffInsertedLine, inlineChatDiffInserted],\n\t\t\t\t[colorRegistry.diffInserted, inlineChatDiffInserted],\n\t\t\t\t[colorRegistry.diffRemovedLine, inlineChatDiffRemoved],\n\t\t\t\t[colorRegistry.diffRemoved, inlineChatDiffRemoved],\n\t\t\t];\n\n\t\t\tfor (const [target, source] of overrides) {\n\t\t\t\tconst value = theme.getColor(source);\n\t\t\t\tif (value) {\n\t\t\t\t\tthis._elements.domNode.style.setProperty(colorRegistry.asCssVariableName(target), String(value));\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tdoStyle();\n\t\tthis._disposables.add(themeService.onDidColorThemeChange(doStyle));\n\t}\n\n\n\tprotected override _fillContainer(container: HTMLElement): void {\n\t\tcontainer.appendChild(this._elements.domNode);\n\t}\n\n\t// --- show / hide --------------------\n\n\tget isVisible(): boolean {\n\t\treturn this._isVisible;\n\t}\n\n\toverride hide(): void {\n\t\tthis._cleanupFullDiff();\n\t\tthis._sessionStore.clear();\n\t\tsuper.hide();\n\t\tthis._isVisible = false;\n\t}\n\n\toverride show(): void {\n\t\tassertType(this.editor.hasModel());\n\t\tthis._sessionStore.clear();\n\t\tthis._isDiffLocked = false;\n\t\tthis._isVisible = true;\n\n\t\tthis._sessionStore.add(this._diffEditor.onDidUpdateDiff(() => {\n\t\t\tconst result = this._diffEditor.getDiffComputationResult();\n\t\t\tconst hasFocus = this._diffEditor.hasTextFocus();\n\t\t\tthis._updateFromChanges(this._session.wholeRange.value, result?.changes2 ?? []);\n\t\t\t// TODO@jrieken find a better fix for this. this is the challenge:\n\t\t\t// the _doShowForChanges method invokes show of the zone widget which removes and adds the\n\t\t\t// zone and overlay parts. this dettaches and reattaches the dom nodes which means they lose\n\t\t\t// focus\n\t\t\tif (hasFocus) {\n\t\t\t\tthis._diffEditor.focus();\n\t\t\t}\n\t\t}));\n\t\tthis._updateFromChanges(this._session.wholeRange.value, this._session.lastTextModelChanges);\n\t}\n\n\tlockToDiff(): void {\n\t\tthis._isDiffLocked = true;\n\t}\n\n\tprivate _updateFromChanges(range: Range, changes: readonly DetailedLineRangeMapping[]): void {\n\t\tassertType(this.editor.hasModel());\n\n\t\tif (this._isDiffLocked) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (changes.length === 0 || this._session.textModel0.getValueLength() === 0) {\n\t\t\t// no change or changes to an empty file\n\t\t\tthis._logService.debug('[IE] livePreview-mode: no diff');\n\t\t\tthis._cleanupFullDiff();\n\t\t} else {\n\t\t\t// complex changes\n\t\t\tthis._logService.debug('[IE] livePreview-mode: full diff');\n\t\t\tthis._renderChangesWithFullDiff(changes, range);\n\t\t}\n\t}\n\n\t// --- full diff\n\n\tprivate _renderChangesWithFullDiff(changes: readonly DetailedLineRangeMapping[], range: Range) {\n\n\t\tconst modified = this.editor.getModel()!;\n\t\tconst ranges = this._computeHiddenRanges(modified, range, changes);\n\n\t\tthis._hideEditorRanges(this.editor, [ranges.modifiedHidden]);\n\t\tthis._hideEditorRanges(this._diffEditor.getOriginalEditor(), ranges.originalDiffHidden);\n\t\tthis._hideEditorRanges(this._diffEditor.getModifiedEditor(), ranges.modifiedDiffHidden);\n\n\t\tthis._diffEditor.revealLine(ranges.modifiedHidden.startLineNumber, ScrollType.Immediate);\n\n\t\tconst lineCountModified = ranges.modifiedHidden.length;\n\t\tconst lineCountOriginal = ranges.originalHidden.length;\n\n\t\tconst lineHeightDiff = Math.max(lineCountModified, lineCountOriginal);\n\t\tconst lineHeightPadding = (this.editor.getOption(EditorOption.lineHeight) / 12) /* padding-top/bottom*/;\n\t\tconst heightInLines = lineHeightDiff + lineHeightPadding;\n\n\t\tsuper.show(ranges.anchor, heightInLines);\n\t\tthis._logService.debug(`[IE] diff SHOWING at ${ranges.anchor} with ${heightInLines} lines height`);\n\t}\n\n\tprivate _cleanupFullDiff() {\n\t\tthis.editor.setHiddenAreas([], InlineChatLivePreviewWidget._hideId);\n\t\tthis._diffEditor.getOriginalEditor().setHiddenAreas([], InlineChatLivePreviewWidget._hideId);\n\t\tthis._diffEditor.getModifiedEditor().setHiddenAreas([], InlineChatLivePreviewWidget._hideId);\n\t\tsuper.hide();\n\t}\n\n\tprivate _computeHiddenRanges(model: ITextModel, range: Range, changes: readonly DetailedLineRangeMapping[]) {\n\t\tif (changes.length === 0) {\n\t\t\tchanges = [new DetailedLineRangeMapping(LineRange.fromRange(range), LineRange.fromRange(range), undefined)];\n\t\t}\n\n\t\tlet originalLineRange = changes[0].original;\n\t\tlet modifiedLineRange = changes[0].modified;\n\t\tfor (let i = 1; i < changes.length; i++) {\n\t\t\toriginalLineRange = originalLineRange.join(changes[i].original);\n\t\t\tmodifiedLineRange = modifiedLineRange.join(changes[i].modified);\n\t\t}\n\n\t\tconst startDelta = modifiedLineRange.startLineNumber - range.startLineNumber;\n\t\tif (startDelta > 0) {\n\t\t\tmodifiedLineRange = new LineRange(modifiedLineRange.startLineNumber - startDelta, modifiedLineRange.endLineNumberExclusive);\n\t\t\toriginalLineRange = new LineRange(originalLineRange.startLineNumber - startDelta, originalLineRange.endLineNumberExclusive);\n\t\t}\n\n\t\tconst endDelta = range.endLineNumber - (modifiedLineRange.endLineNumberExclusive - 1);\n\t\tif (endDelta > 0) {\n\t\t\tmodifiedLineRange = new LineRange(modifiedLineRange.startLineNumber, modifiedLineRange.endLineNumberExclusive + endDelta);\n\t\t\toriginalLineRange = new LineRange(originalLineRange.startLineNumber, originalLineRange.endLineNumberExclusive + endDelta);\n\t\t}\n\n\t\tconst originalDiffHidden = invertLineRange(originalLineRange, this._session.textModel0);\n\t\tconst modifiedDiffHidden = invertLineRange(modifiedLineRange, model);\n\n\t\treturn {\n\t\t\toriginalHidden: originalLineRange,\n\t\t\toriginalDiffHidden,\n\t\t\tmodifiedHidden: modifiedLineRange,\n\t\t\tmodifiedDiffHidden,\n\t\t\tanchor: new Position(modifiedLineRange.endLineNumberExclusive - 1, Number.MAX_SAFE_INTEGER)\n\t\t};\n\t}\n\n\tprivate _hideEditorRanges(editor: ICodeEditor, lineRanges: LineRange[]): void {\n\t\tassertType(editor.hasModel());\n\n\t\tlineRanges = lineRanges.filter(range => !range.isEmpty);\n\t\tif (lineRanges.length === 0) {\n\t\t\t// todo?\n\t\t\tthis._logService.debug(`[IE] diff NOTHING to hide for ${editor.getId()} with ${String(editor.getModel()?.uri)}`);\n\t\t\treturn;\n\t\t}\n\n\t\tlet hiddenRanges: Range[];\n\t\tconst hiddenLinesCount = lineRanges.reduce((p, c) => p + c.length, 0); // assumes no overlap\n\t\tif (hiddenLinesCount >= editor.getModel().getLineCount()) {\n\t\t\t// TODO: not every line can be hidden, keep the first line around\n\t\t\thiddenRanges = [editor.getModel().getFullModelRange().delta(1)];\n\t\t} else {\n\t\t\thiddenRanges = lineRanges.map(lineRangeAsRange);\n\t\t}\n\t\teditor.setHiddenAreas(hiddenRanges, InlineChatLivePreviewWidget._hideId);\n\t\tthis._logService.debug(`[IE] diff HIDING ${hiddenRanges} for ${editor.getId()} with ${String(editor.getModel()?.uri)}`);\n\t}\n\n\tprotected override revealRange(range: Range, isLastLine: boolean): void {\n\t\t// ignore\n\t}\n\n\t// --- layout -------------------------\n\n\tprotected override _onWidth(widthInPixel: number): void {\n\t\tif (this._dim) {\n\t\t\tthis._doLayout(this._dim.height, widthInPixel);\n\t\t}\n\t}\n\n\tprotected override _doLayout(heightInPixel: number, widthInPixel: number): void {\n\t\tconst newDim = new Dimension(widthInPixel, heightInPixel);\n\t\tif (!Dimension.equals(this._dim, newDim)) {\n\t\t\tthis._dim = newDim;\n\t\t\tthis._diffEditor.layout(this._dim.with(undefined, this._dim.height - 12 /* padding */));\n\t\t\tthis._logService.debug('[IE] diff LAYOUT', this._dim);\n\t\t}\n\t}\n}\n\n\nexport class InlineChatFileCreatePreviewWidget extends ZoneWidget {\n\n\tprivate readonly _elements = h('div.inline-chat-newfile-widget@domNode', [\n\t\th('div.title@title', [\n\t\t\th('span.name.show-file-icons@name'),\n\t\t\th('span.detail@detail'),\n\t\t]),\n\t\th('div.editor@editor'),\n\t]);\n\n\tprivate readonly _name: ResourceLabel;\n\tprivate readonly _previewEditor: ICodeEditor;\n\tprivate readonly _previewModel = new MutableDisposable();\n\tprivate _dim: Dimension | undefined;\n\n\tconstructor(\n\t\tparentEditor: ICodeEditor,\n\t\t@IInstantiationService instaService: IInstantiationService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@IThemeService themeService: IThemeService,\n\n\t) {\n\t\tsuper(parentEditor, { showArrow: false, showFrame: false, isResizeable: false, isAccessible: true, showInHiddenAreas: true, ordinal: 10000 + 2 });\n\t\tsuper.create();\n\n\t\tthis._name = instaService.createInstance(ResourceLabel, this._elements.name, { supportIcons: true });\n\n\t\tconst contributions = EditorExtensionsRegistry\n\t\t\t.getEditorContributions()\n\t\t\t.filter(c => c.id !== INLINE_CHAT_ID);\n\n\t\tthis._previewEditor = instaService.createInstance(EmbeddedCodeEditorWidget, this._elements.editor, {\n\t\t\tscrollBeyondLastLine: false,\n\t\t\tstickyScroll: { enabled: false },\n\t\t\treadOnly: true,\n\t\t\tminimap: { enabled: false },\n\t\t\tscrollbar: { alwaysConsumeMouseWheel: false, useShadows: true },\n\t\t}, { isSimpleWidget: true, contributions }, parentEditor);\n\n\t\tconst doStyle = () => {\n\t\t\tconst theme = themeService.getColorTheme();\n\t\t\tconst overrides: [target: string, source: string][] = [\n\t\t\t\t[colorRegistry.editorBackground, inlineChatRegionHighlight],\n\t\t\t\t[editorColorRegistry.editorGutter, inlineChatRegionHighlight],\n\t\t\t];\n\n\t\t\tfor (const [target, source] of overrides) {\n\t\t\t\tconst value = theme.getColor(source);\n\t\t\t\tif (value) {\n\t\t\t\t\tthis._elements.domNode.style.setProperty(colorRegistry.asCssVariableName(target), String(value));\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tdoStyle();\n\t\tthis._disposables.add(themeService.onDidColorThemeChange(doStyle));\n\t}\n\n\toverride dispose(): void {\n\t\tthis._name.dispose();\n\t\tthis._previewEditor.dispose();\n\t\tthis._previewModel.dispose();\n\t\tsuper.dispose();\n\t}\n\n\tprotected override _fillContainer(container: HTMLElement): void {\n\t\tcontainer.appendChild(this._elements.domNode);\n\t}\n\n\toverride show(): void {\n\t\tthrow new Error('Use showFileCreation');\n\t}\n\n\tshowCreation(where: Range, uri: URI, edits: TextEdit[]): void {\n\n\t\tthis._name.element.setFile(uri, { fileKind: FileKind.FILE });\n\n\t\tconst langSelection = this._languageService.createByFilepathOrFirstLine(uri, undefined);\n\t\tconst model = this._modelService.createModel('', langSelection, undefined, true);\n\t\tmodel.applyEdits(edits.map(edit => EditOperation.replace(Range.lift(edit.range), edit.text)));\n\t\tthis._previewModel.value = model;\n\t\tthis._previewEditor.setModel(model);\n\n\t\tconst lineHeight = this.editor.getOption(EditorOption.lineHeight);\n\t\tthis._elements.title.style.height = `${lineHeight}px`;\n\t\tconst maxLines = Math.max(4, Math.floor((this.editor.getLayoutInfo().height / lineHeight) / .33));\n\n\t\tconst lines = Math.min(maxLines, model.getLineCount());\n\t\tconst lineHeightPadding = (lineHeight / 12) /* padding-top/bottom*/;\n\n\n\t\tsuper.show(where, lines + 1 + lineHeightPadding);\n\t}\n\n\t// --- layout\n\n\tprotected override revealRange(range: Range, isLastLine: boolean): void {\n\t\t// ignore\n\t}\n\n\tprotected override _onWidth(widthInPixel: number): void {\n\t\tif (this._dim) {\n\t\t\tthis._doLayout(this._dim.height, widthInPixel);\n\t\t}\n\t}\n\n\tprotected override _doLayout(heightInPixel: number, widthInPixel: number): void {\n\n\t\tconst { lineNumbersLeft } = this.editor.getLayoutInfo();\n\t\tthis._elements.title.style.marginLeft = `${lineNumbersLeft}px`;\n\n\t\tconst newDim = new Dimension(widthInPixel, heightInPixel);\n\t\tif (!Dimension.equals(this._dim, newDim)) {\n\t\t\tthis._dim = newDim;\n\t\t\tconst oneLineHeightInPx = this.editor.getOption(EditorOption.lineHeight);\n\t\t\tthis._previewEditor.layout(this._dim.with(undefined, this._dim.height - oneLineHeightInPx /* title */));\n\t\t}\n\t}\n}\n"]}