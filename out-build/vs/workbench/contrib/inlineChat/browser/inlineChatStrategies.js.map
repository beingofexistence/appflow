{"version":3,"sources":["vs/workbench/contrib/inlineChat/browser/inlineChatStrategies.ts"],"names":[],"mappings":"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","file":"inlineChatStrategies.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from 'vs/base/common/event';\nimport { Lazy } from 'vs/base/common/lazy';\nimport { DisposableStore, IDisposable } from 'vs/base/common/lifecycle';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { IBulkEditService } from 'vs/editor/browser/services/bulkEditService';\nimport { StableEditorScrollState } from 'vs/editor/browser/stableEditorScroll';\nimport { ISingleEditOperation } from 'vs/editor/common/core/editOperation';\nimport { Position } from 'vs/editor/common/core/position';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { IEditorDecorationsCollection } from 'vs/editor/common/editorCommon';\nimport { TextEdit } from 'vs/editor/common/languages';\nimport { ICursorStateComputer, IModelDecorationOptions, IModelDeltaDecoration, ITextModel, IValidEditOperation } from 'vs/editor/common/model';\nimport { IEditorWorkerService } from 'vs/editor/common/services/editorWorker';\nimport { localize } from 'vs/nls';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IContextKey, IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IInstantiationService, ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { IStorageService } from 'vs/platform/storage/common/storage';\nimport { InlineChatFileCreatePreviewWidget, InlineChatLivePreviewWidget } from 'vs/workbench/contrib/inlineChat/browser/inlineChatLivePreviewWidget';\nimport { EditResponse, Session } from 'vs/workbench/contrib/inlineChat/browser/inlineChatSession';\nimport { InlineChatWidget } from 'vs/workbench/contrib/inlineChat/browser/inlineChatWidget';\nimport { CTX_INLINE_CHAT_DOCUMENT_CHANGED } from 'vs/workbench/contrib/inlineChat/common/inlineChat';\nimport { IEditorService, SIDE_GROUP } from 'vs/workbench/services/editor/common/editorService';\n\nexport abstract class EditModeStrategy {\n\n\tabstract dispose(): void;\n\n\tabstract checkChanges(response: EditResponse): boolean;\n\n\tabstract apply(): Promise<void>;\n\n\tabstract cancel(): Promise<void>;\n\n\tabstract makeChanges(edits: ISingleEditOperation[]): Promise<void>;\n\n\tabstract undoChanges(response: EditResponse): Promise<void>;\n\n\tabstract renderChanges(response: EditResponse): Promise<void>;\n\n\tabstract hasFocus(): boolean;\n\n\tabstract getWidgetPosition(): Position | undefined;\n\n\tabstract needsMargin(): boolean;\n}\n\nexport class PreviewStrategy extends EditModeStrategy {\n\n\tprivate readonly _ctxDocumentChanged: IContextKey<boolean>;\n\tprivate readonly _listener: IDisposable;\n\n\tconstructor(\n\t\tprivate readonly _session: Session,\n\t\tprivate readonly _widget: InlineChatWidget,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IBulkEditService private readonly _bulkEditService: IBulkEditService,\n\t\t@IInstantiationService private readonly _instaService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._ctxDocumentChanged = CTX_INLINE_CHAT_DOCUMENT_CHANGED.bindTo(contextKeyService);\n\t\tthis._listener = Event.debounce(_session.textModelN.onDidChangeContent.bind(_session.textModelN), () => { }, 350)(_ => {\n\t\t\tif (!_session.textModelN.isDisposed() && !_session.textModel0.isDisposed()) {\n\t\t\t\tthis._ctxDocumentChanged.set(_session.hasChangedText);\n\t\t\t}\n\t\t});\n\t}\n\n\toverride dispose(): void {\n\t\tthis._listener.dispose();\n\t\tthis._ctxDocumentChanged.reset();\n\t}\n\n\tcheckChanges(response: EditResponse): boolean {\n\t\tif (!response.workspaceEdits || response.singleCreateFileEdit) {\n\t\t\t// preview stategy can handle simple workspace edit (single file create)\n\t\t\treturn true;\n\t\t}\n\t\tthis._bulkEditService.apply(response.workspaceEdits, { showPreview: true });\n\t\treturn false;\n\t}\n\n\tasync apply() {\n\n\t\tif (!(this._session.lastExchange?.response instanceof EditResponse)) {\n\t\t\treturn;\n\t\t}\n\t\tconst editResponse = this._session.lastExchange?.response;\n\t\tif (editResponse.workspaceEdits) {\n\t\t\tawait this._bulkEditService.apply(editResponse.workspaceEdits);\n\t\t\tthis._instaService.invokeFunction(showSingleCreateFile, editResponse);\n\n\n\t\t} else if (!editResponse.workspaceEditsIncludeLocalEdits) {\n\n\t\t\tconst { textModelN: modelN } = this._session;\n\n\t\t\tif (modelN.equalsTextBuffer(this._session.textModel0.getTextBuffer())) {\n\t\t\t\tmodelN.pushStackElement();\n\t\t\t\tfor (const edits of editResponse.allLocalEdits) {\n\t\t\t\t\tmodelN.pushEditOperations(null, edits.map(TextEdit.asEditOperation), () => null);\n\t\t\t\t}\n\t\t\t\tmodelN.pushStackElement();\n\t\t\t}\n\t\t}\n\t}\n\n\tasync cancel(): Promise<void> {\n\t\t// nothing to do\n\t}\n\n\toverride async makeChanges(_edits: ISingleEditOperation[]): Promise<void> {\n\t\t// nothing to do\n\t}\n\n\toverride async undoChanges(_response: EditResponse): Promise<void> {\n\t\t// nothing to do\n\t}\n\n\toverride async renderChanges(response: EditResponse): Promise<void> {\n\t\tif (response.allLocalEdits.length > 0) {\n\t\t\tconst allEditOperation = response.allLocalEdits.map(edits => edits.map(TextEdit.asEditOperation));\n\t\t\tthis._widget.showEditsPreview(this._session.textModel0, allEditOperation, this._session.lastTextModelChanges);\n\t\t} else {\n\t\t\tthis._widget.hideEditsPreview();\n\t\t}\n\n\t\tif (response.singleCreateFileEdit) {\n\t\t\tthis._widget.showCreatePreview(response.singleCreateFileEdit.uri, await Promise.all(response.singleCreateFileEdit.edits));\n\t\t} else {\n\t\t\tthis._widget.hideCreatePreview();\n\t\t}\n\t}\n\n\tgetWidgetPosition(): Position | undefined {\n\t\treturn;\n\t}\n\n\thasFocus(): boolean {\n\t\treturn this._widget.hasFocus();\n\t}\n\n\tneedsMargin(): boolean {\n\t\treturn true;\n\t}\n}\n\nclass InlineDiffDecorations {\n\n\tprivate readonly _collection: IEditorDecorationsCollection;\n\n\tprivate _data: { tracking: IModelDeltaDecoration; decorating: IModelDecorationOptions }[] = [];\n\tprivate _visible: boolean = false;\n\n\tconstructor(editor: ICodeEditor, visible: boolean = false) {\n\t\tthis._collection = editor.createDecorationsCollection();\n\t\tthis._visible = visible;\n\t}\n\n\tget visible() {\n\t\treturn this._visible;\n\t}\n\n\tset visible(value: boolean) {\n\t\tthis._visible = value;\n\t\tthis.update();\n\t}\n\n\tclear() {\n\t\tthis._collection.clear();\n\t\tthis._data.length = 0;\n\t}\n\n\tcollectEditOperation(op: IValidEditOperation) {\n\t\tthis._data.push(InlineDiffDecorations._asDecorationData(op));\n\t}\n\n\tupdate() {\n\t\tthis._collection.set(this._data.map(d => {\n\t\t\tconst res = { ...d.tracking };\n\t\t\tif (this._visible) {\n\t\t\t\tres.options = { ...res.options, ...d.decorating };\n\t\t\t}\n\t\t\treturn res;\n\t\t}));\n\t}\n\n\tprivate static _asDecorationData(edit: IValidEditOperation): { tracking: IModelDeltaDecoration; decorating: IModelDecorationOptions } {\n\t\tlet content = edit.text;\n\t\tif (content.length > 12) {\n\t\t\tcontent = content.substring(0, 12) + '…';\n\t\t}\n\t\tconst tracking: IModelDeltaDecoration = {\n\t\t\trange: edit.range,\n\t\t\toptions: {\n\t\t\t\tdescription: 'inline-chat-inline-diff',\n\t\t\t}\n\t\t};\n\n\t\tconst decorating: IModelDecorationOptions = {\n\t\t\tdescription: 'inline-chat-inline-diff',\n\t\t\tclassName: !edit.range.isEmpty() ? 'inline-chat-lines-inserted-range' : undefined,\n\t\t\tshowIfCollapsed: true,\n\t\t\tbefore: {\n\t\t\t\tcontent,\n\t\t\t\tinlineClassName: 'inline-chat-lines-deleted-range-inline',\n\t\t\t\tattachedData: edit,\n\t\t\t}\n\t\t};\n\n\t\treturn { tracking, decorating };\n\t}\n}\n\nexport class LiveStrategy extends EditModeStrategy {\n\n\tprotected _diffEnabled: boolean = false;\n\n\tprivate readonly _inlineDiffDecorations: InlineDiffDecorations;\n\tprivate readonly _store: DisposableStore = new DisposableStore();\n\n\tprivate _lastResponse?: EditResponse;\n\tprivate _editCount: number = 0;\n\n\tconstructor(\n\t\tprotected readonly _session: Session,\n\t\tprotected readonly _editor: ICodeEditor,\n\t\tprotected readonly _widget: InlineChatWidget,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IConfigurationService configService: IConfigurationService,\n\t\t@IStorageService protected _storageService: IStorageService,\n\t\t@IBulkEditService protected readonly _bulkEditService: IBulkEditService,\n\t\t@IEditorWorkerService protected readonly _editorWorkerService: IEditorWorkerService,\n\t\t@IInstantiationService private readonly _instaService: IInstantiationService,\n\t) {\n\t\tsuper();\n\t\tthis._diffEnabled = configService.getValue<boolean>('inlineChat.showDiff');\n\n\t\tthis._inlineDiffDecorations = new InlineDiffDecorations(this._editor, this._diffEnabled);\n\t\tthis._inlineDiffDecorations.visible = this._diffEnabled;\n\n\t\tthis._store.add(configService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration('inlineChat.showDiff')) {\n\t\t\t\tthis._diffEnabled = !this._diffEnabled;\n\t\t\t\tthis._doToggleDiff();\n\t\t\t}\n\t\t}));\n\t}\n\n\toverride dispose(): void {\n\t\tthis._inlineDiffDecorations.clear();\n\t\tthis._store.dispose();\n\t}\n\n\tprotected _doToggleDiff(): void {\n\t\tthis._inlineDiffDecorations.visible = this._diffEnabled;\n\t}\n\n\tcheckChanges(response: EditResponse): boolean {\n\t\tthis._lastResponse = response;\n\t\tif (response.singleCreateFileEdit) {\n\t\t\t// preview stategy can handle simple workspace edit (single file create)\n\t\t\treturn true;\n\t\t}\n\t\tif (response.workspaceEdits) {\n\t\t\tthis._bulkEditService.apply(response.workspaceEdits, { showPreview: true });\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tasync apply() {\n\t\tif (this._editCount > 0) {\n\t\t\tthis._editor.pushUndoStop();\n\t\t}\n\t\tif (this._lastResponse?.workspaceEdits) {\n\t\t\tawait this._bulkEditService.apply(this._lastResponse.workspaceEdits);\n\t\t\tthis._instaService.invokeFunction(showSingleCreateFile, this._lastResponse);\n\t\t}\n\t}\n\n\tasync cancel() {\n\t\tconst { textModelN: modelN, textModelNAltVersion, textModelNSnapshotAltVersion } = this._session;\n\t\tif (modelN.isDisposed()) {\n\t\t\treturn;\n\t\t}\n\t\tconst targetAltVersion = textModelNSnapshotAltVersion ?? textModelNAltVersion;\n\t\tLiveStrategy._undoModelUntil(modelN, targetAltVersion);\n\t}\n\n\toverride async makeChanges(edits: ISingleEditOperation[]): Promise<void> {\n\t\tconst cursorStateComputerAndInlineDiffCollection: ICursorStateComputer = (undoEdits) => {\n\t\t\tlet last: Position | null = null;\n\t\t\tfor (const edit of undoEdits) {\n\t\t\t\tlast = !last || last.isBefore(edit.range.getEndPosition()) ? edit.range.getEndPosition() : last;\n\t\t\t\tthis._inlineDiffDecorations.collectEditOperation(edit);\n\t\t\t}\n\t\t\treturn last && [Selection.fromPositions(last)];\n\t\t};\n\n\t\t// push undo stop before first edit\n\t\tif (++this._editCount === 1) {\n\t\t\tthis._editor.pushUndoStop();\n\t\t}\n\t\tthis._editor.executeEdits('inline-chat-live', edits, cursorStateComputerAndInlineDiffCollection);\n\t}\n\n\toverride async undoChanges(response: EditResponse): Promise<void> {\n\t\tconst { textModelN } = this._session;\n\t\tLiveStrategy._undoModelUntil(textModelN, response.modelAltVersionId);\n\t}\n\n\toverride async renderChanges(response: EditResponse) {\n\n\t\tthis._inlineDiffDecorations.update();\n\t\tthis._updateSummaryMessage();\n\n\t\tif (response.singleCreateFileEdit) {\n\t\t\tthis._widget.showCreatePreview(response.singleCreateFileEdit.uri, await Promise.all(response.singleCreateFileEdit.edits));\n\t\t} else {\n\t\t\tthis._widget.hideCreatePreview();\n\t\t}\n\t}\n\n\tprivate static _undoModelUntil(model: ITextModel, targetAltVersion: number): void {\n\t\twhile (targetAltVersion < model.getAlternativeVersionId() && model.canUndo()) {\n\t\t\tmodel.undo();\n\t\t}\n\t}\n\n\tprotected _updateSummaryMessage() {\n\t\tlet linesChanged = 0;\n\t\tfor (const change of this._session.lastTextModelChanges) {\n\t\t\tlinesChanged += change.changedLineCount;\n\t\t}\n\t\tlet message: string;\n\t\tif (linesChanged === 0) {\n\t\t\tmessage = localize('lines.0', \"Nothing changed\");\n\t\t} else if (linesChanged === 1) {\n\t\t\tmessage = localize('lines.1', \"Changed 1 line\");\n\t\t} else {\n\t\t\tmessage = localize('lines.N', \"Changed {0} lines\", linesChanged);\n\t\t}\n\t\tthis._widget.updateStatus(message);\n\t}\n\n\toverride getWidgetPosition(): Position | undefined {\n\t\tconst lastTextModelChanges = this._session.lastTextModelChanges;\n\t\tlet lastLineOfLocalEdits: number | undefined;\n\t\tfor (const change of lastTextModelChanges) {\n\t\t\tconst changeEndLineNumber = change.modified.endLineNumberExclusive - 1;\n\t\t\tif (typeof lastLineOfLocalEdits === 'undefined' || lastLineOfLocalEdits < changeEndLineNumber) {\n\t\t\t\tlastLineOfLocalEdits = changeEndLineNumber;\n\t\t\t}\n\t\t}\n\t\treturn lastLineOfLocalEdits ? new Position(lastLineOfLocalEdits, 1) : undefined;\n\t}\n\n\toverride needsMargin(): boolean {\n\t\treturn !Boolean(this._session.lastTextModelChanges.length);\n\t}\n\n\thasFocus(): boolean {\n\t\treturn this._widget.hasFocus();\n\t}\n}\n\nexport class LivePreviewStrategy extends LiveStrategy {\n\n\tprivate readonly _diffZone: Lazy<InlineChatLivePreviewWidget>;\n\tprivate readonly _previewZone: Lazy<InlineChatFileCreatePreviewWidget>;\n\n\tconstructor(\n\t\tsession: Session,\n\t\teditor: ICodeEditor,\n\t\twidget: InlineChatWidget,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IConfigurationService configService: IConfigurationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IBulkEditService bulkEditService: IBulkEditService,\n\t\t@IEditorWorkerService editorWorkerService: IEditorWorkerService,\n\t\t@IInstantiationService instaService: IInstantiationService,\n\t) {\n\t\tsuper(session, editor, widget, contextKeyService, configService, storageService, bulkEditService, editorWorkerService, instaService);\n\n\t\tthis._diffZone = new Lazy(() => instaService.createInstance(InlineChatLivePreviewWidget, editor, session));\n\t\tthis._previewZone = new Lazy(() => instaService.createInstance(InlineChatFileCreatePreviewWidget, editor));\n\t}\n\n\toverride dispose(): void {\n\t\tthis._diffZone.rawValue?.hide();\n\t\tthis._diffZone.rawValue?.dispose();\n\t\tthis._previewZone.rawValue?.hide();\n\t\tthis._previewZone.rawValue?.dispose();\n\t\tsuper.dispose();\n\t}\n\n\toverride async renderChanges(response: EditResponse) {\n\n\t\tthis._updateSummaryMessage();\n\t\tif (this._diffEnabled) {\n\t\t\tthis._diffZone.value.show();\n\t\t}\n\n\t\tif (response.singleCreateFileEdit) {\n\t\t\tthis._previewZone.value.showCreation(this._session.wholeRange.value.collapseToEnd(), response.singleCreateFileEdit.uri, await Promise.all(response.singleCreateFileEdit.edits));\n\t\t} else {\n\t\t\tthis._previewZone.value.hide();\n\t\t}\n\t}\n\n\toverride async undoChanges(response: EditResponse): Promise<void> {\n\t\tthis._diffZone.value.lockToDiff();\n\t\tsuper.undoChanges(response);\n\t}\n\n\tprotected override _doToggleDiff(): void {\n\t\tconst scrollState = StableEditorScrollState.capture(this._editor);\n\t\tif (this._diffEnabled) {\n\t\t\tthis._diffZone.value.show();\n\t\t} else {\n\t\t\tthis._diffZone.value.hide();\n\t\t}\n\t\tscrollState.restore(this._editor);\n\t}\n\n\toverride hasFocus(): boolean {\n\t\treturn super.hasFocus() || this._diffZone.value.hasFocus() || this._previewZone.value.hasFocus();\n\t}\n\n\toverride getWidgetPosition(): Position | undefined {\n\t\tif (this._session.lastTextModelChanges.length) {\n\t\t\treturn this._session.wholeRange.value.getEndPosition();\n\t\t}\n\t\treturn;\n\t}\n}\n\nfunction showSingleCreateFile(accessor: ServicesAccessor, edit: EditResponse) {\n\tconst editorService = accessor.get(IEditorService);\n\tif (edit.singleCreateFileEdit) {\n\t\teditorService.openEditor({ resource: edit.singleCreateFileEdit.uri }, SIDE_GROUP);\n\t}\n}\n"]}