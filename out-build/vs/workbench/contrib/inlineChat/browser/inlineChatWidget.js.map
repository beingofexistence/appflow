{"version":3,"sources":["vs/workbench/contrib/inlineChat/browser/inlineChatWidget.ts"],"names":[],"mappings":"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","file":"inlineChatWidget.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./inlineChat';\nimport { DisposableStore, MutableDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { IActiveCodeEditor, ICodeEditor, IDiffEditorConstructionOptions } from 'vs/editor/browser/editorBrowser';\nimport { EditorLayoutInfo, EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { IRange, Range } from 'vs/editor/common/core/range';\nimport { localize } from 'vs/nls';\nimport { IContextKey, IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ZoneWidget } from 'vs/editor/contrib/zoneWidget/browser/zoneWidget';\nimport { CTX_INLINE_CHAT_FOCUSED, CTX_INLINE_CHAT_EMPTY, CTX_INLINE_CHAT_OUTER_CURSOR_POSITION, CTX_INLINE_CHAT_VISIBLE, MENU_INLINE_CHAT_WIDGET, MENU_INLINE_CHAT_WIDGET_STATUS, MENU_INLINE_CHAT_WIDGET_MARKDOWN_MESSAGE, CTX_INLINE_CHAT_MESSAGE_CROP_STATE, IInlineChatSlashCommand, MENU_INLINE_CHAT_WIDGET_FEEDBACK, ACTION_REGENERATE_RESPONSE, ACTION_VIEW_IN_CHAT, MENU_INLINE_CHAT_WIDGET_TOGGLE, CTX_INLINE_CHAT_INNER_CURSOR_FIRST, CTX_INLINE_CHAT_INNER_CURSOR_LAST, CTX_INLINE_CHAT_INNER_CURSOR_START, CTX_INLINE_CHAT_INNER_CURSOR_END, CTX_INLINE_CHAT_RESPONSE_FOCUSED } from 'vs/workbench/contrib/inlineChat/common/inlineChat';\nimport { IModelDeltaDecoration, ITextModel } from 'vs/editor/common/model';\nimport { EventType, Dimension, addDisposableListener, getActiveElement, getTotalHeight, getTotalWidth, h, reset } from 'vs/base/browser/dom';\nimport { Emitter, Event, MicrotaskEmitter } from 'vs/base/common/event';\nimport { IEditorConstructionOptions } from 'vs/editor/browser/config/editorConfiguration';\nimport { ICodeEditorWidgetOptions } from 'vs/editor/browser/widget/codeEditorWidget';\nimport { EditorExtensionsRegistry } from 'vs/editor/browser/editorExtensions';\nimport { SnippetController2 } from 'vs/editor/contrib/snippet/browser/snippetController2';\nimport { IModelService } from 'vs/editor/common/services/model';\nimport { URI } from 'vs/base/common/uri';\nimport { EmbeddedCodeEditorWidget, EmbeddedDiffEditorWidget } from 'vs/editor/browser/widget/embeddedCodeEditorWidget';\nimport { HiddenItemStrategy, MenuWorkbenchToolBar } from 'vs/platform/actions/browser/toolbar';\nimport { ProgressBar } from 'vs/base/browser/ui/progressbar/progressbar';\nimport { SuggestController } from 'vs/editor/contrib/suggest/browser/suggestController';\nimport { Position } from 'vs/editor/common/core/position';\nimport { DEFAULT_FONT_FAMILY } from 'vs/workbench/browser/style';\nimport { CompletionItem, CompletionItemInsertTextRule, CompletionItemKind, CompletionItemProvider, CompletionList, ProviderResult, TextEdit } from 'vs/editor/common/languages';\nimport { EditOperation, ISingleEditOperation } from 'vs/editor/common/core/editOperation';\nimport { ILanguageSelection, ILanguageService } from 'vs/editor/common/languages/language';\nimport { ResourceLabel } from 'vs/workbench/browser/labels';\nimport { FileKind } from 'vs/platform/files/common/files';\nimport { ILanguageFeaturesService } from 'vs/editor/common/services/languageFeatures';\nimport { LanguageSelector } from 'vs/editor/common/languageSelector';\nimport { createTextBufferFactoryFromSnapshot } from 'vs/editor/common/model/textModel';\nimport { DetailedLineRangeMapping } from 'vs/editor/common/diff/rangeMapping';\nimport { invertLineRange, lineRangeAsRange } from 'vs/workbench/contrib/inlineChat/browser/utils';\nimport { ICodeEditorViewState, ScrollType } from 'vs/editor/common/editorCommon';\nimport { LineRange } from 'vs/editor/common/core/lineRange';\nimport { IAccessibilityService } from 'vs/platform/accessibility/common/accessibility';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { AccessibilityVerbositySettingId } from 'vs/workbench/contrib/accessibility/browser/accessibilityConfiguration';\nimport { renderLabelWithIcons } from 'vs/base/browser/ui/iconLabel/iconLabels';\nimport { ExpansionState } from 'vs/workbench/contrib/inlineChat/browser/inlineChatSession';\nimport { IdleValue } from 'vs/base/common/async';\nimport * as aria from 'vs/base/browser/ui/aria/aria';\nimport { IMenuWorkbenchButtonBarOptions, MenuWorkbenchButtonBar } from 'vs/platform/actions/browser/buttonbar';\nimport { SlashCommandContentWidget } from 'vs/workbench/contrib/chat/browser/chatSlashCommandContentWidget';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { IAccessibleViewService } from 'vs/workbench/contrib/accessibility/browser/accessibleView';\nimport { StandardMouseEvent } from 'vs/base/browser/mouseEvent';\nimport { AccessibilityCommandId } from 'vs/workbench/contrib/accessibility/common/accessibilityCommands';\n\nconst defaultAriaLabel = localize('aria-label', \"Inline Chat Input\");\n\nconst _inputEditorOptions: IEditorConstructionOptions = {\n\tpadding: { top: 2, bottom: 2 },\n\toverviewRulerLanes: 0,\n\tglyphMargin: false,\n\tlineNumbers: 'off',\n\tfolding: false,\n\thideCursorInOverviewRuler: true,\n\tselectOnLineNumbers: false,\n\tselectionHighlight: false,\n\tscrollbar: {\n\t\tuseShadows: false,\n\t\tvertical: 'hidden',\n\t\thorizontal: 'auto',\n\t\talwaysConsumeMouseWheel: false\n\t},\n\tlineDecorationsWidth: 0,\n\toverviewRulerBorder: false,\n\tscrollBeyondLastLine: false,\n\trenderLineHighlight: 'none',\n\tfixedOverflowWidgets: true,\n\tdragAndDrop: false,\n\trevealHorizontalRightPadding: 5,\n\tminimap: { enabled: false },\n\tguides: { indentation: false },\n\trulers: [],\n\tcursorWidth: 1,\n\tcursorStyle: 'line',\n\tcursorBlinking: 'blink',\n\twrappingStrategy: 'advanced',\n\twrappingIndent: 'none',\n\trenderWhitespace: 'none',\n\tdropIntoEditor: { enabled: true },\n\tquickSuggestions: false,\n\tsuggest: {\n\t\tshowIcons: false,\n\t\tshowSnippets: false,\n\t\tshowStatusBar: false,\n\t},\n\twordWrap: 'on',\n\tariaLabel: defaultAriaLabel,\n\tfontFamily: DEFAULT_FONT_FAMILY,\n\tfontSize: 13,\n\tlineHeight: 20\n};\n\nconst _previewEditorEditorOptions: IDiffEditorConstructionOptions = {\n\tscrollbar: { useShadows: false, alwaysConsumeMouseWheel: false },\n\trenderMarginRevertIcon: false,\n\tdiffCodeLens: false,\n\tscrollBeyondLastLine: false,\n\tstickyScroll: { enabled: false },\n\toriginalAriaLabel: localize('original', 'Original'),\n\tmodifiedAriaLabel: localize('modified', 'Modified'),\n\tdiffAlgorithm: 'advanced',\n\treadOnly: true,\n\tisInEmbeddedEditor: true\n};\n\nexport interface InlineChatWidgetViewState {\n\teditorViewState: ICodeEditorViewState;\n\tinput: string;\n\tplaceholder: string;\n}\n\nexport class InlineChatWidget {\n\n\tprivate static _modelPool: number = 1;\n\n\tprivate readonly _elements = h(\n\t\t'div.inline-chat@root',\n\t\t[\n\t\t\th('div.body', [\n\t\t\t\th('div.content@content', [\n\t\t\t\t\th('div.input@input', [\n\t\t\t\t\t\th('div.editor-placeholder@placeholder'),\n\t\t\t\t\t\th('div.editor-container@editor'),\n\t\t\t\t\t]),\n\t\t\t\t\th('div.toolbar@editorToolbar'),\n\t\t\t\t]),\n\t\t\t]),\n\t\t\th('div.progress@progress'),\n\t\t\th('div.previewDiff.hidden@previewDiff'),\n\t\t\th('div.previewCreateTitle.show-file-icons@previewCreateTitle'),\n\t\t\th('div.previewCreate.hidden@previewCreate'),\n\t\t\th('div.markdownMessage.hidden@markdownMessage', [\n\t\t\t\th('div.message@message'),\n\t\t\t\th('div.messageActions@messageActions')\n\t\t\t]),\n\t\t\th('div.status@status', [\n\t\t\t\th('div.label.info.hidden@infoLabel'),\n\t\t\t\th('div.actions.hidden@statusToolbar'),\n\t\t\t\th('div.label.status.hidden@statusLabel'),\n\t\t\t\th('div.actions.hidden@feedbackToolbar'),\n\t\t\t]),\n\t\t]\n\t);\n\n\tprivate readonly _store = new DisposableStore();\n\tprivate readonly _slashCommands = this._store.add(new DisposableStore());\n\n\tprivate readonly _inputEditor: IActiveCodeEditor;\n\tprivate readonly _inputModel: ITextModel;\n\tprivate readonly _ctxInputEmpty: IContextKey<boolean>;\n\tprivate readonly _ctxMessageCropState: IContextKey<'cropped' | 'not_cropped' | 'expanded'>;\n\tprivate readonly _ctxInnerCursorFirst: IContextKey<boolean>;\n\tprivate readonly _ctxInnerCursorLast: IContextKey<boolean>;\n\tprivate readonly _ctxInnerCursorStart: IContextKey<boolean>;\n\tprivate readonly _ctxInnerCursorEnd: IContextKey<boolean>;\n\tprivate readonly _ctxInputEditorFocused: IContextKey<boolean>;\n\tprivate readonly _ctxResponseFocused: IContextKey<boolean>;\n\n\tprivate readonly _progressBar: ProgressBar;\n\n\tprivate readonly _previewDiffEditor: IdleValue<EmbeddedDiffEditorWidget>;\n\tprivate readonly _previewDiffModel = this._store.add(new MutableDisposable());\n\n\tprivate readonly _previewCreateTitle: ResourceLabel;\n\tprivate readonly _previewCreateEditor: IdleValue<ICodeEditor>;\n\tprivate readonly _previewCreateModel = this._store.add(new MutableDisposable());\n\n\tprivate readonly _onDidChangeHeight = new MicrotaskEmitter<void>();\n\treadonly onDidChangeHeight: Event<void> = Event.filter(this._onDidChangeHeight.event, _ => !this._isLayouting);\n\n\tprivate readonly _onDidChangeInput = new Emitter<this>();\n\treadonly onDidChangeInput: Event<this> = this._onDidChangeInput.event;\n\n\tprivate _lastDim: Dimension | undefined;\n\tprivate _isLayouting: boolean = false;\n\tprivate _preferredExpansionState: ExpansionState | undefined;\n\tprivate _expansionState: ExpansionState = ExpansionState.NOT_CROPPED;\n\tprivate _slashCommandDetails: { command: string; detail: string }[] = [];\n\n\tprivate _slashCommandContentWidget: SlashCommandContentWidget;\n\n\tconstructor(\n\t\tprivate readonly parentEditor: ICodeEditor,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@ILanguageFeaturesService private readonly _languageFeaturesService: ILanguageFeaturesService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IAccessibilityService private readonly _accessibilityService: IAccessibilityService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IContextMenuService private readonly _contextMenuService: IContextMenuService,\n\t\t@IAccessibleViewService private readonly _accessibleViewService: IAccessibleViewService\n\t) {\n\n\t\t// input editor logic\n\t\tconst codeEditorWidgetOptions: ICodeEditorWidgetOptions = {\n\t\t\tisSimpleWidget: true,\n\t\t\tcontributions: EditorExtensionsRegistry.getSomeEditorContributions([\n\t\t\t\tSnippetController2.ID,\n\t\t\t\tSuggestController.ID\n\t\t\t])\n\t\t};\n\n\t\tthis._inputEditor = <IActiveCodeEditor>this._instantiationService.createInstance(EmbeddedCodeEditorWidget, this._elements.editor, _inputEditorOptions, codeEditorWidgetOptions, this.parentEditor);\n\t\tthis._updateAriaLabel();\n\t\tthis._store.add(this._inputEditor);\n\t\tthis._store.add(this._inputEditor.onDidChangeModelContent(() => this._onDidChangeInput.fire(this)));\n\t\tthis._store.add(this._inputEditor.onDidLayoutChange(() => this._onDidChangeHeight.fire()));\n\t\tthis._store.add(this._inputEditor.onDidContentSizeChange(() => this._onDidChangeHeight.fire()));\n\t\tthis._store.add(addDisposableListener(this._elements.message, 'focus', () => this._ctxResponseFocused.set(true)));\n\t\tthis._store.add(addDisposableListener(this._elements.message, 'blur', () => this._ctxResponseFocused.reset()));\n\n\t\tthis._store.add(this._configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(AccessibilityVerbositySettingId.InlineChat)) {\n\t\t\t\tthis._updateAriaLabel();\n\t\t\t}\n\t\t}));\n\n\t\tconst uri = URI.from({ scheme: 'vscode', authority: 'inline-chat', path: `/inline-chat/model${InlineChatWidget._modelPool++}.txt` });\n\t\tthis._inputModel = this._store.add(this._modelService.getModel(uri) ?? this._modelService.createModel('', null, uri));\n\t\tthis._inputEditor.setModel(this._inputModel);\n\n\t\t// --- context keys\n\n\t\tthis._ctxMessageCropState = CTX_INLINE_CHAT_MESSAGE_CROP_STATE.bindTo(this._contextKeyService);\n\t\tthis._ctxInputEmpty = CTX_INLINE_CHAT_EMPTY.bindTo(this._contextKeyService);\n\n\t\tthis._ctxInnerCursorFirst = CTX_INLINE_CHAT_INNER_CURSOR_FIRST.bindTo(this._contextKeyService);\n\t\tthis._ctxInnerCursorLast = CTX_INLINE_CHAT_INNER_CURSOR_LAST.bindTo(this._contextKeyService);\n\t\tthis._ctxInnerCursorStart = CTX_INLINE_CHAT_INNER_CURSOR_START.bindTo(this._contextKeyService);\n\t\tthis._ctxInnerCursorEnd = CTX_INLINE_CHAT_INNER_CURSOR_END.bindTo(this._contextKeyService);\n\t\tthis._ctxInputEditorFocused = CTX_INLINE_CHAT_FOCUSED.bindTo(this._contextKeyService);\n\t\tthis._ctxResponseFocused = CTX_INLINE_CHAT_RESPONSE_FOCUSED.bindTo(this._contextKeyService);\n\n\t\t// (1) inner cursor position (last/first line selected)\n\t\tconst updateInnerCursorFirstLast = () => {\n\t\t\tconst selection = this._inputEditor.getSelection();\n\t\t\tconst fullRange = this._inputModel.getFullModelRange();\n\t\t\tlet onFirst = false;\n\t\t\tlet onLast = false;\n\t\t\tif (selection.isEmpty()) {\n\t\t\t\tconst selectionTop = this._inputEditor.getTopForPosition(selection.startLineNumber, selection.startColumn);\n\t\t\t\tconst firstViewLineTop = this._inputEditor.getTopForPosition(fullRange.startLineNumber, fullRange.startColumn);\n\t\t\t\tconst lastViewLineTop = this._inputEditor.getTopForPosition(fullRange.endLineNumber, fullRange.endColumn);\n\n\t\t\t\tif (selectionTop === firstViewLineTop) {\n\t\t\t\t\tonFirst = true;\n\t\t\t\t}\n\t\t\t\tif (selectionTop === lastViewLineTop) {\n\t\t\t\t\tonLast = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._ctxInnerCursorFirst.set(onFirst);\n\t\t\tthis._ctxInnerCursorLast.set(onLast);\n\t\t\tthis._ctxInnerCursorStart.set(fullRange.getStartPosition().equals(selection.getStartPosition()));\n\t\t\tthis._ctxInnerCursorEnd.set(fullRange.getEndPosition().equals(selection.getEndPosition()));\n\t\t};\n\t\tthis._store.add(this._inputEditor.onDidChangeCursorPosition(updateInnerCursorFirstLast));\n\t\tupdateInnerCursorFirstLast();\n\n\t\t// (2) input editor focused or not\n\t\tconst updateFocused = () => {\n\t\t\tconst hasFocus = this._inputEditor.hasWidgetFocus();\n\t\t\tthis._ctxInputEditorFocused.set(hasFocus);\n\t\t\tthis._elements.content.classList.toggle('synthetic-focus', hasFocus);\n\t\t\tthis.readPlaceholder();\n\t\t};\n\t\tthis._store.add(this._inputEditor.onDidFocusEditorWidget(updateFocused));\n\t\tthis._store.add(this._inputEditor.onDidBlurEditorWidget(updateFocused));\n\t\tthis._store.add(toDisposable(() => {\n\t\t\tthis._ctxInnerCursorFirst.reset();\n\t\t\tthis._ctxInnerCursorLast.reset();\n\t\t\tthis._ctxInputEditorFocused.reset();\n\t\t}));\n\t\tupdateFocused();\n\n\t\t// placeholder\n\n\t\tthis._elements.placeholder.style.fontSize = `${this._inputEditor.getOption(EditorOption.fontSize)}px`;\n\t\tthis._elements.placeholder.style.lineHeight = `${this._inputEditor.getOption(EditorOption.lineHeight)}px`;\n\t\tthis._store.add(addDisposableListener(this._elements.placeholder, 'click', () => this._inputEditor.focus()));\n\n\t\t// show/hide placeholder depending on text model being empty\n\t\t// content height\n\n\t\tconst currentContentHeight = 0;\n\n\t\tconst togglePlaceholder = () => {\n\t\t\tconst hasText = this._inputModel.getValueLength() > 0;\n\t\t\tthis._elements.placeholder.classList.toggle('hidden', hasText);\n\t\t\tthis._ctxInputEmpty.set(!hasText);\n\t\t\tthis.readPlaceholder();\n\n\t\t\tconst contentHeight = this._inputEditor.getContentHeight();\n\t\t\tif (contentHeight !== currentContentHeight && this._lastDim) {\n\t\t\t\tthis._lastDim = this._lastDim.with(undefined, contentHeight);\n\t\t\t\tthis._inputEditor.layout(this._lastDim);\n\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t}\n\t\t};\n\t\tthis._store.add(this._inputModel.onDidChangeContent(togglePlaceholder));\n\t\ttogglePlaceholder();\n\n\t\t// slash command content widget\n\n\t\tthis._slashCommandContentWidget = new SlashCommandContentWidget(this._inputEditor);\n\t\tthis._store.add(this._slashCommandContentWidget);\n\n\t\t// toolbars\n\n\t\tconst toolbar = this._instantiationService.createInstance(MenuWorkbenchToolBar, this._elements.editorToolbar, MENU_INLINE_CHAT_WIDGET, {\n\t\t\ttelemetrySource: 'interactiveEditorWidget-toolbar',\n\t\t\ttoolbarOptions: { primaryGroup: 'main' }\n\t\t});\n\t\tthis._store.add(toolbar);\n\n\t\tthis._progressBar = new ProgressBar(this._elements.progress);\n\t\tthis._store.add(this._progressBar);\n\n\t\tconst workbenchMenubarOptions: IMenuWorkbenchButtonBarOptions = {\n\t\t\ttelemetrySource: 'interactiveEditorWidget-toolbar',\n\t\t\tbuttonConfigProvider: action => {\n\t\t\t\tif (action.id === ACTION_REGENERATE_RESPONSE) {\n\t\t\t\t\treturn { showIcon: true, showLabel: false };\n\t\t\t\t} else if (action.id === ACTION_VIEW_IN_CHAT) {\n\t\t\t\t\treturn { isSecondary: false };\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t};\n\t\tconst statusButtonBar = this._instantiationService.createInstance(MenuWorkbenchButtonBar, this._elements.statusToolbar, MENU_INLINE_CHAT_WIDGET_STATUS, workbenchMenubarOptions);\n\t\tthis._store.add(statusButtonBar.onDidChangeMenuItems(() => this._onDidChangeHeight.fire()));\n\t\tthis._store.add(statusButtonBar);\n\n\n\t\tconst workbenchToolbarOptions = {\n\t\t\thiddenItemStrategy: HiddenItemStrategy.NoHide,\n\t\t\ttoolbarOptions: {\n\t\t\t\tprimaryGroup: () => true,\n\t\t\t\tuseSeparatorsInPrimaryActions: true\n\t\t\t}\n\t\t};\n\n\t\tconst feedbackToolbar = this._instantiationService.createInstance(MenuWorkbenchToolBar, this._elements.feedbackToolbar, MENU_INLINE_CHAT_WIDGET_FEEDBACK, { ...workbenchToolbarOptions, hiddenItemStrategy: HiddenItemStrategy.Ignore });\n\t\tthis._store.add(feedbackToolbar.onDidChangeMenuItems(() => this._onDidChangeHeight.fire()));\n\t\tthis._store.add(feedbackToolbar);\n\n\t\t// preview editors\n\t\tthis._previewDiffEditor = this._store.add(new IdleValue(() => this._store.add(_instantiationService.createInstance(EmbeddedDiffEditorWidget, this._elements.previewDiff, {\n\t\t\t..._previewEditorEditorOptions,\n\t\t\tonlyShowAccessibleDiffViewer: this._accessibilityService.isScreenReaderOptimized(),\n\t\t}, { modifiedEditor: codeEditorWidgetOptions, originalEditor: codeEditorWidgetOptions }, parentEditor))));\n\n\t\tthis._previewCreateTitle = this._store.add(_instantiationService.createInstance(ResourceLabel, this._elements.previewCreateTitle, { supportIcons: true }));\n\t\tthis._previewCreateEditor = this._store.add(new IdleValue(() => this._store.add(_instantiationService.createInstance(EmbeddedCodeEditorWidget, this._elements.previewCreate, _previewEditorEditorOptions, codeEditorWidgetOptions, parentEditor))));\n\n\t\tthis._elements.message.tabIndex = 0;\n\t\tthis._elements.message.ariaLabel = this._accessibleViewService.getOpenAriaHint(AccessibilityVerbositySettingId.InlineChat);\n\t\tthis._elements.statusLabel.tabIndex = 0;\n\t\tconst markdownMessageToolbar = this._instantiationService.createInstance(MenuWorkbenchToolBar, this._elements.messageActions, MENU_INLINE_CHAT_WIDGET_MARKDOWN_MESSAGE, workbenchToolbarOptions);\n\t\tthis._store.add(markdownMessageToolbar.onDidChangeMenuItems(() => this._onDidChangeHeight.fire()));\n\t\tthis._store.add(markdownMessageToolbar);\n\n\t\tthis._store.add(addDisposableListener(this._elements.root, EventType.CONTEXT_MENU, async (event: MouseEvent) => {\n\t\t\tthis._onContextMenu(event);\n\t\t}));\n\t\tthis._store.add(this._configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(AccessibilityVerbositySettingId.InlineChat)) {\n\t\t\t\tthis._elements.message.ariaLabel = this._accessibleViewService.getOpenAriaHint(AccessibilityVerbositySettingId.InlineChat);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _onContextMenu(e: MouseEvent) {\n\t\tconst event = new StandardMouseEvent(e);\n\t\tthis._contextMenuService.showContextMenu({\n\t\t\tmenuId: MENU_INLINE_CHAT_WIDGET_TOGGLE,\n\t\t\tgetAnchor: () => event,\n\t\t});\n\t}\n\n\tprivate _updateAriaLabel(): void {\n\t\tif (!this._accessibilityService.isScreenReaderOptimized()) {\n\t\t\treturn;\n\t\t}\n\t\tlet label = defaultAriaLabel;\n\t\tif (this._configurationService.getValue<boolean>(AccessibilityVerbositySettingId.InlineChat)) {\n\t\t\tconst kbLabel = this._keybindingService.lookupKeybinding(AccessibilityCommandId.OpenAccessibilityHelp)?.getLabel();\n\t\t\tlabel = kbLabel ? localize('inlineChat.accessibilityHelp', \"Inline Chat Input, Use {0} for Inline Chat Accessibility Help.\", kbLabel) : localize('inlineChat.accessibilityHelpNoKb', \"Inline Chat Input, Run the Inline Chat Accessibility Help command for more information.\");\n\t\t}\n\t\t_inputEditorOptions.ariaLabel = label;\n\t\tthis._inputEditor.updateOptions({ ariaLabel: label });\n\t}\n\n\tdispose(): void {\n\t\tthis._store.dispose();\n\t\tthis._ctxInputEmpty.reset();\n\t\tthis._ctxMessageCropState.reset();\n\t}\n\n\tget domNode(): HTMLElement {\n\t\treturn this._elements.root;\n\t}\n\n\tlayout(dim: Dimension) {\n\t\tthis._isLayouting = true;\n\t\ttry {\n\t\t\tconst innerEditorWidth = dim.width - (getTotalWidth(this._elements.editorToolbar) + 8 /* L/R-padding */);\n\t\t\tdim = new Dimension(innerEditorWidth, dim.height);\n\t\t\tif (!this._lastDim || !Dimension.equals(this._lastDim, dim)) {\n\t\t\t\tthis._lastDim = dim;\n\t\t\t\tthis._inputEditor.layout(new Dimension(innerEditorWidth, this._inputEditor.getContentHeight()));\n\t\t\t\tthis._elements.placeholder.style.width = `${innerEditorWidth  /* input-padding*/}px`;\n\n\t\t\t\tconst previewDiffDim = new Dimension(dim.width, Math.min(300, Math.max(0, this._previewDiffEditor.value.getContentHeight())));\n\t\t\t\tthis._previewDiffEditor.value.layout(previewDiffDim);\n\t\t\t\tthis._elements.previewDiff.style.height = `${previewDiffDim.height}px`;\n\n\t\t\t\tconst previewCreateDim = new Dimension(dim.width, Math.min(300, Math.max(0, this._previewCreateEditor.value.getContentHeight())));\n\t\t\t\tthis._previewCreateEditor.value.layout(previewCreateDim);\n\t\t\t\tthis._elements.previewCreate.style.height = `${previewCreateDim.height}px`;\n\n\t\t\t\tconst lineHeight = this.parentEditor.getOption(EditorOption.lineHeight);\n\t\t\t\tconst editorHeight = this.parentEditor.getLayoutInfo().height;\n\t\t\t\tconst editorHeightInLines = Math.floor(editorHeight / lineHeight);\n\t\t\t\tthis._elements.root.style.setProperty('--vscode-inline-chat-cropped', String(Math.floor(editorHeightInLines / 5)));\n\t\t\t\tthis._elements.root.style.setProperty('--vscode-inline-chat-expanded', String(Math.floor(editorHeightInLines / 3)));\n\t\t\t}\n\t\t} finally {\n\t\t\tthis._isLayouting = false;\n\t\t}\n\t}\n\n\tgetHeight(): number {\n\t\tconst base = getTotalHeight(this._elements.progress) + getTotalHeight(this._elements.status);\n\t\tconst editorHeight = this._inputEditor.getContentHeight() + 12 /* padding and border */;\n\t\tconst markdownMessageHeight = getTotalHeight(this._elements.markdownMessage);\n\t\tconst previewDiffHeight = this._previewDiffEditor.value.getModel() ? 12 + Math.min(300, Math.max(0, this._previewDiffEditor.value.getContentHeight())) : 0;\n\t\tconst previewCreateTitleHeight = getTotalHeight(this._elements.previewCreateTitle);\n\t\tconst previewCreateHeight = this._previewCreateEditor.value.getModel() ? 18 + Math.min(300, Math.max(0, this._previewCreateEditor.value.getContentHeight())) : 0;\n\t\treturn base + editorHeight + markdownMessageHeight + previewDiffHeight + previewCreateTitleHeight + previewCreateHeight + 18 /* padding */ + 8 /*shadow*/;\n\t}\n\n\tupdateProgress(show: boolean) {\n\t\tif (show) {\n\t\t\tthis._progressBar.infinite();\n\t\t} else {\n\t\t\tthis._progressBar.stop();\n\t\t}\n\t}\n\n\tget value(): string {\n\t\treturn this._inputModel.getValue();\n\t}\n\n\tset value(value: string) {\n\t\tthis._inputModel.setValue(value);\n\t\tthis._inputEditor.setPosition(this._inputModel.getFullModelRange().getEndPosition());\n\t}\n\n\tselectAll(includeSlashCommand: boolean = true) {\n\t\tlet selection = this._inputModel.getFullModelRange();\n\n\t\tif (!includeSlashCommand) {\n\t\t\tconst firstLine = this._inputModel.getLineContent(1);\n\t\t\tconst slashCommand = this._slashCommandDetails.find(c => firstLine.startsWith(`/${c.command} `));\n\t\t\tselection = slashCommand ? new Range(1, slashCommand.command.length + 3, selection.endLineNumber, selection.endColumn) : selection;\n\t\t}\n\n\t\tthis._inputEditor.setSelection(selection);\n\t}\n\n\tset placeholder(value: string) {\n\t\tthis._elements.placeholder.innerText = value;\n\t}\n\n\treadPlaceholder(): void {\n\t\tconst slashCommand = this._slashCommandDetails.find(c => `${c.command} ` === this._inputModel.getValue().substring(1));\n\t\tconst hasText = this._inputModel.getValueLength() > 0;\n\t\tif (!hasText) {\n\t\t\taria.status(this._elements.placeholder.innerText);\n\t\t} else if (slashCommand) {\n\t\t\taria.status(slashCommand.detail);\n\t\t}\n\t}\n\n\tupdateToolbar(show: boolean) {\n\t\tthis._elements.statusToolbar.classList.toggle('hidden', !show);\n\t\tthis._elements.feedbackToolbar.classList.toggle('hidden', !show);\n\t\tthis._elements.status.classList.toggle('actions', show);\n\t\tthis._elements.infoLabel.classList.toggle('hidden', show);\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tget expansionState(): ExpansionState {\n\t\treturn this._expansionState;\n\t}\n\n\tset preferredExpansionState(expansionState: ExpansionState | undefined) {\n\t\tthis._preferredExpansionState = expansionState;\n\t}\n\n\tget responseContent(): string | undefined {\n\t\treturn this._elements.markdownMessage.textContent ?? undefined;\n\t}\n\n\tupdateMarkdownMessage(message: Node | undefined) {\n\t\tthis._elements.markdownMessage.classList.toggle('hidden', !message);\n\t\tlet expansionState: ExpansionState;\n\t\tif (!message) {\n\t\t\treset(this._elements.message);\n\t\t\tthis._ctxMessageCropState.reset();\n\t\t\texpansionState = ExpansionState.NOT_CROPPED;\n\n\t\t} else {\n\t\t\tif (this._preferredExpansionState) {\n\t\t\t\treset(this._elements.message, message);\n\t\t\t\texpansionState = this._preferredExpansionState;\n\t\t\t\tthis._preferredExpansionState = undefined;\n\t\t\t} else {\n\t\t\t\tthis._updateLineClamp(ExpansionState.CROPPED);\n\t\t\t\treset(this._elements.message, message);\n\t\t\t\texpansionState = this._elements.message.scrollHeight > this._elements.message.clientHeight ? ExpansionState.CROPPED : ExpansionState.NOT_CROPPED;\n\t\t\t}\n\t\t\tthis._ctxMessageCropState.set(expansionState);\n\t\t\tthis._updateLineClamp(expansionState);\n\t\t}\n\t\tthis._expansionState = expansionState;\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tupdateMarkdownMessageExpansionState(expansionState: ExpansionState) {\n\t\tthis._ctxMessageCropState.set(expansionState);\n\t\tconst heightBefore = this._elements.markdownMessage.scrollHeight;\n\t\tthis._updateLineClamp(expansionState);\n\t\tconst heightAfter = this._elements.markdownMessage.scrollHeight;\n\t\tif (heightBefore === heightAfter) {\n\t\t\tthis._ctxMessageCropState.set(ExpansionState.NOT_CROPPED);\n\t\t}\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tprivate _updateLineClamp(expansionState: ExpansionState) {\n\t\tthis._elements.message.setAttribute('state', expansionState);\n\t}\n\n\tupdateInfo(message: string): void {\n\t\tthis._elements.infoLabel.classList.toggle('hidden', !message);\n\t\tconst renderedMessage = renderLabelWithIcons(message);\n\t\treset(this._elements.infoLabel, ...renderedMessage);\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tupdateStatus(message: string, ops: { classes?: string[]; resetAfter?: number; keepMessage?: boolean } = {}) {\n\t\tconst isTempMessage = typeof ops.resetAfter === 'number';\n\t\tif (isTempMessage && !this._elements.statusLabel.dataset['state']) {\n\t\t\tconst statusLabel = this._elements.statusLabel.innerText;\n\t\t\tconst classes = Array.from(this._elements.statusLabel.classList.values());\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.updateStatus(statusLabel, { classes, keepMessage: true });\n\t\t\t}, ops.resetAfter);\n\t\t}\n\t\treset(this._elements.statusLabel, message);\n\t\tthis._elements.statusLabel.className = `label status ${(ops.classes ?? []).join(' ')}`;\n\t\tthis._elements.statusLabel.classList.toggle('hidden', !message);\n\t\tif (isTempMessage) {\n\t\t\tthis._elements.statusLabel.dataset['state'] = 'temp';\n\t\t} else {\n\t\t\tdelete this._elements.statusLabel.dataset['state'];\n\t\t}\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\treset() {\n\t\tthis._ctxInputEmpty.reset();\n\t\tthis._ctxInnerCursorFirst.reset();\n\t\tthis._ctxInnerCursorLast.reset();\n\t\tthis._ctxInputEditorFocused.reset();\n\n\t\tthis.value = '';\n\t\tthis.updateMarkdownMessage(undefined);\n\n\t\treset(this._elements.statusLabel);\n\t\tthis._elements.statusLabel.classList.toggle('hidden', true);\n\t\tthis._elements.statusToolbar.classList.add('hidden');\n\t\tthis._elements.feedbackToolbar.classList.add('hidden');\n\t\tthis.hideCreatePreview();\n\t\tthis.hideEditsPreview();\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tfocus() {\n\t\tthis._inputEditor.focus();\n\t}\n\n\thasFocus() {\n\t\treturn this.domNode.contains(getActiveElement());\n\t}\n\n\t// --- preview\n\n\tshowEditsPreview(textModelv0: ITextModel, allEdits: ISingleEditOperation[][], changes: readonly DetailedLineRangeMapping[]) {\n\t\tif (changes.length === 0) {\n\t\t\tthis.hideEditsPreview();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._elements.previewDiff.classList.remove('hidden');\n\n\t\tconst languageSelection: ILanguageSelection = { languageId: textModelv0.getLanguageId(), onDidChange: Event.None };\n\t\tconst modified = this._modelService.createModel(createTextBufferFactoryFromSnapshot(textModelv0.createSnapshot()), languageSelection, undefined, true);\n\t\tfor (const edits of allEdits) {\n\t\t\tmodified.applyEdits(edits, false);\n\t\t}\n\t\tthis._previewDiffEditor.value.setModel({ original: textModelv0, modified });\n\n\t\t// joined ranges\n\t\tlet originalLineRange = changes[0].original;\n\t\tlet modifiedLineRange = changes[0].modified;\n\t\tfor (let i = 1; i < changes.length; i++) {\n\t\t\toriginalLineRange = originalLineRange.join(changes[i].original);\n\t\t\tmodifiedLineRange = modifiedLineRange.join(changes[i].modified);\n\t\t}\n\n\t\t// apply extra padding\n\t\tconst pad = 3;\n\t\tconst newStartLine = Math.max(1, originalLineRange.startLineNumber - pad);\n\t\tmodifiedLineRange = new LineRange(newStartLine, modifiedLineRange.endLineNumberExclusive);\n\t\toriginalLineRange = new LineRange(newStartLine, originalLineRange.endLineNumberExclusive);\n\n\t\tconst newEndLineModified = Math.min(modifiedLineRange.endLineNumberExclusive + pad, modified.getLineCount());\n\t\tmodifiedLineRange = new LineRange(modifiedLineRange.startLineNumber, newEndLineModified);\n\t\tconst newEndLineOriginal = Math.min(originalLineRange.endLineNumberExclusive + pad, textModelv0.getLineCount());\n\t\toriginalLineRange = new LineRange(originalLineRange.startLineNumber, newEndLineOriginal);\n\n\t\tconst hiddenOriginal = invertLineRange(originalLineRange, textModelv0);\n\t\tconst hiddenModified = invertLineRange(modifiedLineRange, modified);\n\t\tthis._previewDiffEditor.value.getOriginalEditor().setHiddenAreas(hiddenOriginal.map(lineRangeAsRange), 'diff-hidden');\n\t\tthis._previewDiffEditor.value.getModifiedEditor().setHiddenAreas(hiddenModified.map(lineRangeAsRange), 'diff-hidden');\n\t\tthis._previewDiffEditor.value.revealLine(modifiedLineRange.startLineNumber, ScrollType.Immediate);\n\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\thideEditsPreview() {\n\t\tthis._elements.previewDiff.classList.add('hidden');\n\t\tthis._previewDiffEditor.value.setModel(null);\n\t\tthis._previewDiffModel.clear();\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tshowCreatePreview(uri: URI, edits: TextEdit[]): void {\n\t\tthis._elements.previewCreateTitle.classList.remove('hidden');\n\t\tthis._elements.previewCreate.classList.remove('hidden');\n\n\t\tthis._previewCreateTitle.element.setFile(uri, { fileKind: FileKind.FILE });\n\n\t\tconst langSelection = this._languageService.createByFilepathOrFirstLine(uri, undefined);\n\t\tconst model = this._modelService.createModel('', langSelection, undefined, true);\n\t\tmodel.applyEdits(edits.map(edit => EditOperation.replace(Range.lift(edit.range), edit.text)));\n\t\tthis._previewCreateModel.value = model;\n\t\tthis._previewCreateEditor.value.setModel(model);\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\thideCreatePreview() {\n\t\tthis._elements.previewCreateTitle.classList.add('hidden');\n\t\tthis._elements.previewCreate.classList.add('hidden');\n\t\tthis._previewCreateEditor.value.setModel(null);\n\t\tthis._previewCreateTitle.element.clear();\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tshowsAnyPreview() {\n\t\treturn !this._elements.previewDiff.classList.contains('hidden') ||\n\t\t\t!this._elements.previewCreate.classList.contains('hidden');\n\t}\n\n\t// --- slash commands\n\n\tupdateSlashCommands(commands: IInlineChatSlashCommand[]) {\n\n\t\tthis._slashCommands.clear();\n\n\t\tif (commands.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tthis._slashCommandDetails = commands.filter(c => c.command && c.detail).map(c => { return { command: c.command!, detail: c.detail! }; });\n\n\t\tconst selector: LanguageSelector = { scheme: this._inputModel.uri.scheme, pattern: this._inputModel.uri.path, language: this._inputModel.getLanguageId() };\n\t\tthis._slashCommands.add(this._languageFeaturesService.completionProvider.register(selector, new class implements CompletionItemProvider {\n\n\t\t\t_debugDisplayName: string = 'InlineChatSlashCommandProvider';\n\n\t\t\treadonly triggerCharacters?: string[] = ['/'];\n\n\t\t\tprovideCompletionItems(_model: ITextModel, position: Position): ProviderResult<CompletionList> {\n\t\t\t\tif (position.lineNumber !== 1 && position.column !== 1) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst suggestions: CompletionItem[] = commands.map(command => {\n\n\t\t\t\t\tconst withSlash = `/${command.command}`;\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tlabel: { label: withSlash, description: command.detail },\n\t\t\t\t\t\tinsertText: `${withSlash} $0`,\n\t\t\t\t\t\tinsertTextRules: CompletionItemInsertTextRule.InsertAsSnippet,\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\trange: new Range(1, 1, 1, 1),\n\t\t\t\t\t\tcommand: command.executeImmediately ? { id: 'inlineChat.accept', title: withSlash } : undefined\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\treturn { suggestions };\n\t\t\t}\n\t\t}));\n\n\t\tconst decorations = this._inputEditor.createDecorationsCollection();\n\n\t\tconst updateSlashDecorations = () => {\n\t\t\tthis._slashCommandContentWidget.hide();\n\n\t\t\tconst newDecorations: IModelDeltaDecoration[] = [];\n\t\t\tfor (const command of commands) {\n\t\t\t\tconst withSlash = `/${command.command}`;\n\t\t\t\tconst firstLine = this._inputModel.getLineContent(1);\n\t\t\t\tif (firstLine.startsWith(withSlash)) {\n\t\t\t\t\tnewDecorations.push({\n\t\t\t\t\t\trange: new Range(1, 1, 1, withSlash.length + 1),\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tdescription: 'inline-chat-slash-command',\n\t\t\t\t\t\t\tinlineClassName: 'inline-chat-slash-command',\n\t\t\t\t\t\t\tafter: {\n\t\t\t\t\t\t\t\t// Force some space between slash command and placeholder\n\t\t\t\t\t\t\t\tcontent: ' '\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis._slashCommandContentWidget.setCommandText(command.command);\n\t\t\t\t\tthis._slashCommandContentWidget.show();\n\n\t\t\t\t\t// inject detail when otherwise empty\n\t\t\t\t\tif (firstLine === `/${command.command}`) {\n\t\t\t\t\t\tnewDecorations.push({\n\t\t\t\t\t\t\trange: new Range(1, withSlash.length + 1, 1, withSlash.length + 2),\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tdescription: 'inline-chat-slash-command-detail',\n\t\t\t\t\t\t\t\tafter: {\n\t\t\t\t\t\t\t\t\tcontent: `${command.detail}`,\n\t\t\t\t\t\t\t\t\tinlineClassName: 'inline-chat-slash-command-detail'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tdecorations.set(newDecorations);\n\t\t};\n\n\t\tthis._slashCommands.add(this._inputEditor.onDidChangeModelContent(updateSlashDecorations));\n\t\tupdateSlashDecorations();\n\t}\n}\n\nexport class InlineChatZoneWidget extends ZoneWidget {\n\n\treadonly widget: InlineChatWidget;\n\n\tprivate readonly _ctxVisible: IContextKey<boolean>;\n\tprivate readonly _ctxCursorPosition: IContextKey<'above' | 'below' | ''>;\n\tprivate _dimension?: Dimension;\n\tprivate _indentationWidth: number | undefined;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@IInstantiationService private readonly _instaService: IInstantiationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t) {\n\t\tsuper(editor, { showFrame: false, showArrow: false, isAccessible: true, className: 'inline-chat-widget', keepEditorSelection: true, showInHiddenAreas: true, ordinal: 10000 + 3 });\n\n\t\tthis._ctxVisible = CTX_INLINE_CHAT_VISIBLE.bindTo(contextKeyService);\n\t\tthis._ctxCursorPosition = CTX_INLINE_CHAT_OUTER_CURSOR_POSITION.bindTo(contextKeyService);\n\n\t\tthis._disposables.add(toDisposable(() => {\n\t\t\tthis._ctxVisible.reset();\n\t\t\tthis._ctxCursorPosition.reset();\n\t\t}));\n\n\t\tthis.widget = this._instaService.createInstance(InlineChatWidget, this.editor);\n\t\tthis._disposables.add(this.widget.onDidChangeHeight(() => this._relayout()));\n\t\tthis._disposables.add(this.widget);\n\t\tthis.create();\n\n\n\t\tthis._disposables.add(addDisposableListener(this.domNode, 'click', e => {\n\t\t\tif (!this.widget.hasFocus()) {\n\t\t\t\tthis.widget.focus();\n\t\t\t}\n\t\t}, true));\n\n\t\t// todo@jrieken listen ONLY when showing\n\t\tconst updateCursorIsAboveContextKey = () => {\n\t\t\tif (!this.position || !this.editor.hasModel()) {\n\t\t\t\tthis._ctxCursorPosition.reset();\n\t\t\t} else if (this.position.lineNumber === this.editor.getPosition().lineNumber) {\n\t\t\t\tthis._ctxCursorPosition.set('above');\n\t\t\t} else if (this.position.lineNumber + 1 === this.editor.getPosition().lineNumber) {\n\t\t\t\tthis._ctxCursorPosition.set('below');\n\t\t\t} else {\n\t\t\t\tthis._ctxCursorPosition.reset();\n\t\t\t}\n\t\t};\n\t\tthis._disposables.add(this.editor.onDidChangeCursorPosition(e => updateCursorIsAboveContextKey()));\n\t\tthis._disposables.add(this.editor.onDidFocusEditorText(e => updateCursorIsAboveContextKey()));\n\t\tupdateCursorIsAboveContextKey();\n\t}\n\n\tprotected override _fillContainer(container: HTMLElement): void {\n\t\tcontainer.appendChild(this.widget.domNode);\n\t}\n\n\n\tprotected override _doLayout(heightInPixel: number): void {\n\n\t\tconst maxWidth = !this.widget.showsAnyPreview() ? 640 : Number.MAX_SAFE_INTEGER;\n\t\tconst width = Math.min(maxWidth, this._availableSpaceGivenIndentation(this._indentationWidth));\n\t\tthis._dimension = new Dimension(width, heightInPixel);\n\t\tthis.widget.domNode.style.width = `${width}px`;\n\t\tthis.widget.layout(this._dimension);\n\t}\n\n\tprivate _availableSpaceGivenIndentation(indentationWidth: number | undefined): number {\n\t\tconst info = this.editor.getLayoutInfo();\n\t\treturn info.contentWidth - (info.glyphMarginWidth + info.decorationsWidth + (indentationWidth ?? 0));\n\t}\n\n\tprivate _computeHeightInLines(): number {\n\t\tconst lineHeight = this.editor.getOption(EditorOption.lineHeight);\n\t\treturn this.widget.getHeight() / lineHeight;\n\t}\n\n\tprotected override _relayout() {\n\t\tif (this._dimension) {\n\t\t\tthis._doLayout(this._dimension.height);\n\t\t}\n\t\tsuper._relayout(this._computeHeightInLines());\n\t}\n\n\toverride show(position: Position): void {\n\t\tsuper.show(position, this._computeHeightInLines());\n\t\tthis.widget.focus();\n\t\tthis._ctxVisible.set(true);\n\t}\n\n\tprotected override _getWidth(info: EditorLayoutInfo): number {\n\t\treturn info.width - info.minimap.minimapWidth;\n\t}\n\n\tupdateBackgroundColor(position: Position, selection: IRange) {\n\t\tif (!this.container) {\n\t\t\treturn;\n\t\t}\n\t\tconst widgetLineNumber = position.lineNumber;\n\t\tthis.container.classList.toggle('inside-selection', widgetLineNumber >= selection.startLineNumber && widgetLineNumber < selection.endLineNumber);\n\t}\n\n\tprivate _calculateIndentationWidth(position: Position): number {\n\t\tconst viewModel = this.editor._getViewModel();\n\t\tif (!viewModel) {\n\t\t\treturn 0;\n\t\t}\n\t\tconst visibleRange = viewModel.getCompletelyVisibleViewRange();\n\t\tconst startLineVisibleRange = visibleRange.startLineNumber;\n\t\tconst positionLine = position.lineNumber;\n\t\tlet indentationLineNumber: number | undefined;\n\t\tlet indentationLevel: number | undefined;\n\t\tfor (let lineNumber = positionLine; lineNumber >= startLineVisibleRange; lineNumber--) {\n\t\t\tconst currentIndentationLevel = viewModel.getLineFirstNonWhitespaceColumn(lineNumber);\n\t\t\tif (currentIndentationLevel !== 0) {\n\t\t\t\tindentationLineNumber = lineNumber;\n\t\t\t\tindentationLevel = currentIndentationLevel;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn this.editor.getOffsetForColumn(indentationLineNumber ?? positionLine, indentationLevel ?? viewModel.getLineFirstNonWhitespaceColumn(positionLine));\n\t}\n\n\tsetContainerMargins(): void {\n\t\tif (!this.container) {\n\t\t\treturn;\n\t\t}\n\t\tconst info = this.editor.getLayoutInfo();\n\t\tconst marginWithoutIndentation = info.glyphMarginWidth + info.decorationsWidth + info.lineNumbersWidth;\n\t\tthis.container.style.marginLeft = `${marginWithoutIndentation}px`;\n\t}\n\n\tsetWidgetMargins(position: Position, indentationWidth?: number): void {\n\t\tif (indentationWidth === undefined) {\n\t\t\tindentationWidth = this._calculateIndentationWidth(position);\n\t\t}\n\t\tif (this._indentationWidth === indentationWidth) {\n\t\t\treturn;\n\t\t}\n\t\tthis._indentationWidth = this._availableSpaceGivenIndentation(indentationWidth) > 400 ? indentationWidth : 0;\n\t\tthis.widget.domNode.style.marginLeft = `${this._indentationWidth}px`;\n\t\tthis.widget.domNode.style.marginRight = `${this.editor.getLayoutInfo().minimap.minimapWidth}px`;\n\t}\n\n\toverride hide(): void {\n\t\tthis.container!.classList.remove('inside-selection');\n\t\tthis._ctxVisible.reset();\n\t\tthis._ctxCursorPosition.reset();\n\t\tthis.widget.reset();\n\t\tsuper.hide();\n\t\taria.status(localize('inlineChatClosed', 'Closed inline chat widget'));\n\t}\n}\n"]}