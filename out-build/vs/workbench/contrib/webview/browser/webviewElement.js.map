{"version":3,"sources":["vs/workbench/contrib/webview/browser/webviewElement.ts"],"names":[],"mappings":"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","file":"webviewElement.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isFirefox } from 'vs/base/browser/browser';\nimport { addDisposableListener, EventType } from 'vs/base/browser/dom';\nimport { IMouseWheelEvent } from 'vs/base/browser/mouseEvent';\nimport { ThrottledDelayer } from 'vs/base/common/async';\nimport { streamToBuffer, VSBufferReadableStream } from 'vs/base/common/buffer';\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { Disposable, IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { COI } from 'vs/base/common/network';\nimport { URI } from 'vs/base/common/uri';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { localize } from 'vs/nls';\nimport { IAccessibilityService } from 'vs/platform/accessibility/common/accessibility';\nimport { MenuId } from 'vs/platform/actions/common/actions';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { IRemoteAuthorityResolverService } from 'vs/platform/remote/common/remoteAuthorityResolver';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { ITunnelService } from 'vs/platform/tunnel/common/tunnel';\nimport { WebviewPortMappingManager } from 'vs/platform/webview/common/webviewPortMapping';\nimport { parentOriginHash } from 'vs/base/browser/iframe';\nimport { loadLocalResource, WebviewResourceResponse } from 'vs/workbench/contrib/webview/browser/resourceLoading';\nimport { WebviewThemeDataProvider } from 'vs/workbench/contrib/webview/browser/themeing';\nimport { areWebviewContentOptionsEqual, IWebview, WebviewContentOptions, WebviewExtensionDescription, WebviewInitInfo, WebviewMessageReceivedEvent, WebviewOptions } from 'vs/workbench/contrib/webview/browser/webview';\nimport { WebviewFindDelegate, WebviewFindWidget } from 'vs/workbench/contrib/webview/browser/webviewFindWidget';\nimport { FromWebviewMessage, KeyEvent, ToWebviewMessage } from 'vs/workbench/contrib/webview/browser/webviewMessages';\nimport { decodeAuthority, webviewGenericCspSource, webviewRootResourceAuthority } from 'vs/workbench/contrib/webview/common/webview';\nimport { IWorkbenchEnvironmentService } from 'vs/workbench/services/environment/common/environmentService';\n\ninterface WebviewContent {\n\treadonly html: string;\n\treadonly title: string | undefined;\n\treadonly options: WebviewContentOptions;\n\treadonly state: string | undefined;\n}\n\nnamespace WebviewState {\n\texport const enum Type { Initializing, Ready }\n\n\texport class Initializing {\n\t\treadonly type = Type.Initializing;\n\n\t\tconstructor(\n\t\t\tpublic pendingMessages: Array<{\n\t\t\t\treadonly channel: string;\n\t\t\t\treadonly data?: any;\n\t\t\t\treadonly transferable: Transferable[];\n\t\t\t\treadonly resolve: (posted: boolean) => void;\n\t\t\t}>\n\t\t) { }\n\t}\n\n\texport const Ready = { type: Type.Ready } as const;\n\n\texport type State = typeof Ready | Initializing;\n}\n\ninterface WebviewActionContext {\n\treadonly webview?: string;\n\treadonly [key: string]: unknown;\n}\n\nconst webviewIdContext = 'webviewId';\n\nexport class WebviewElement extends Disposable implements IWebview, WebviewFindDelegate {\n\n\tprotected readonly id = generateUuid();\n\n\t/**\n\t * The provided identifier of this webview.\n\t */\n\tpublic readonly providedViewType?: string;\n\n\t/**\n\t * The origin this webview itself is loaded from. May not be unique\n\t */\n\tpublic readonly origin: string;\n\n\tprivate readonly _encodedWebviewOriginPromise: Promise<string>;\n\tprivate _encodedWebviewOrigin: string | undefined;\n\n\tprotected get platform(): string { return 'browser'; }\n\n\tprivate readonly _expectedServiceWorkerVersion = 4; // Keep this in sync with the version in service-worker.js\n\n\tprivate _element: HTMLIFrameElement | undefined;\n\tprotected get element(): HTMLIFrameElement | undefined { return this._element; }\n\n\tprivate _focused: boolean | undefined;\n\tpublic get isFocused(): boolean {\n\t\tif (!this._focused) {\n\t\t\treturn false;\n\t\t}\n\t\tif (document.activeElement && document.activeElement !== this.element) {\n\t\t\t// looks like https://github.com/microsoft/vscode/issues/132641\n\t\t\t// where the focus is actually not in the `<iframe>`\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate _state: WebviewState.State = new WebviewState.Initializing([]);\n\n\tprivate _content: WebviewContent;\n\n\tprivate readonly _portMappingManager: WebviewPortMappingManager;\n\n\tprivate readonly _resourceLoadingCts = this._register(new CancellationTokenSource());\n\n\tprivate _contextKeyService: IContextKeyService | undefined;\n\n\tprivate _confirmBeforeClose: string;\n\n\tprivate readonly _focusDelayer = this._register(new ThrottledDelayer(50));\n\n\tprivate readonly _onDidHtmlChange: Emitter<string> = this._register(new Emitter<string>());\n\tprotected readonly onDidHtmlChange = this._onDidHtmlChange.event;\n\n\tprivate _messagePort?: MessagePort;\n\tprivate readonly _messageHandlers = new Map<string, Set<(data: any, e: MessageEvent) => void>>();\n\n\tprotected readonly _webviewFindWidget: WebviewFindWidget | undefined;\n\tpublic readonly checkImeCompletionState = true;\n\n\tprivate _disposed = false;\n\n\n\tpublic extension: WebviewExtensionDescription | undefined;\n\tprivate readonly _options: WebviewOptions;\n\n\tconstructor(\n\t\tinitInfo: WebviewInitInfo,\n\t\tprotected readonly webviewThemeDataProvider: WebviewThemeDataProvider,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IWorkbenchEnvironmentService private readonly _environmentService: IWorkbenchEnvironmentService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@IRemoteAuthorityResolverService private readonly _remoteAuthorityResolverService: IRemoteAuthorityResolverService,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@ITunnelService private readonly _tunnelService: ITunnelService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IAccessibilityService private readonly _accessibilityService: IAccessibilityService,\n\t) {\n\t\tsuper();\n\n\t\tthis.providedViewType = initInfo.providedViewType;\n\t\tthis.origin = initInfo.origin ?? this.id;\n\n\t\tthis._encodedWebviewOriginPromise = parentOriginHash(window.origin, this.origin).then(id => this._encodedWebviewOrigin = id);\n\n\t\tthis._options = initInfo.options;\n\t\tthis.extension = initInfo.extension;\n\n\t\tthis._content = {\n\t\t\thtml: '',\n\t\t\ttitle: initInfo.title,\n\t\t\toptions: initInfo.contentOptions,\n\t\t\tstate: undefined\n\t\t};\n\n\t\tthis._portMappingManager = this._register(new WebviewPortMappingManager(\n\t\t\t() => this.extension?.location,\n\t\t\t() => this._content.options.portMapping || [],\n\t\t\tthis._tunnelService\n\t\t));\n\n\t\tthis._element = this._createElement(initInfo.options, initInfo.contentOptions);\n\n\n\t\tconst subscription = this._register(addDisposableListener(window, 'message', (e: MessageEvent) => {\n\t\t\tif (!this._encodedWebviewOrigin || e?.data?.target !== this.id) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (e.origin !== this._webviewContentOrigin(this._encodedWebviewOrigin)) {\n\t\t\t\tconsole.log(`Skipped renderer receiving message due to mismatched origins: ${e.origin} ${this._webviewContentOrigin}`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (e.data.channel === 'webview-ready') {\n\t\t\t\tif (this._messagePort) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis._logService.debug(`Webview(${this.id}): webview ready`);\n\n\t\t\t\tthis._messagePort = e.ports[0];\n\t\t\t\tthis._messagePort.onmessage = (e) => {\n\t\t\t\t\tconst handlers = this._messageHandlers.get(e.data.channel);\n\t\t\t\t\tif (!handlers) {\n\t\t\t\t\t\tconsole.log(`No handlers found for '${e.data.channel}'`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\thandlers?.forEach(handler => handler(e.data.data, e));\n\t\t\t\t};\n\n\t\t\t\tthis.element?.classList.add('ready');\n\n\t\t\t\tif (this._state.type === WebviewState.Type.Initializing) {\n\t\t\t\t\tthis._state.pendingMessages.forEach(({ channel, data }) => this.doPostMessage(channel, data));\n\t\t\t\t}\n\t\t\t\tthis._state = WebviewState.Ready;\n\n\t\t\t\tsubscription.dispose();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.on('no-csp-found', () => {\n\t\t\tthis.handleNoCspFound();\n\t\t}));\n\n\t\tthis._register(this.on('did-click-link', ({ uri }) => {\n\t\t\tthis._onDidClickLink.fire(uri);\n\t\t}));\n\n\t\tthis._register(this.on('onmessage', ({ message, transfer }) => {\n\t\t\tthis._onMessage.fire({ message, transfer });\n\t\t}));\n\n\t\tthis._register(this.on('did-scroll', ({ scrollYPercentage }) => {\n\t\t\tthis._onDidScroll.fire({ scrollYPercentage });\n\t\t}));\n\n\t\tthis._register(this.on('do-reload', () => {\n\t\t\tthis.reload();\n\t\t}));\n\n\t\tthis._register(this.on('do-update-state', (state) => {\n\t\t\tthis.state = state;\n\t\t\tthis._onDidUpdateState.fire(state);\n\t\t}));\n\n\t\tthis._register(this.on('did-focus', () => {\n\t\t\tthis.handleFocusChange(true);\n\t\t}));\n\n\t\tthis._register(this.on('did-blur', () => {\n\t\t\tthis.handleFocusChange(false);\n\t\t}));\n\n\t\tthis._register(this.on('did-scroll-wheel', (event) => {\n\t\t\tthis._onDidWheel.fire(event);\n\t\t}));\n\n\t\tthis._register(this.on('did-find', ({ didFind }) => {\n\t\t\tthis._hasFindResult.fire(didFind);\n\t\t}));\n\n\t\tthis._register(this.on('fatal-error', (e) => {\n\t\t\tnotificationService.error(localize('fatalErrorMessage', \"Error loading webview: {0}\", e.message));\n\t\t\tthis._onFatalError.fire({ message: e.message });\n\t\t}));\n\n\t\tthis._register(this.on('did-keydown', (data) => {\n\t\t\t// Electron: workaround for https://github.com/electron/electron/issues/14258\n\t\t\t// We have to detect keyboard events in the <webview> and dispatch them to our\n\t\t\t// keybinding service because these events do not bubble to the parent window anymore.\n\t\t\tthis.handleKeyEvent('keydown', data);\n\t\t}));\n\n\t\tthis._register(this.on('did-keyup', (data) => {\n\t\t\tthis.handleKeyEvent('keyup', data);\n\t\t}));\n\n\t\tthis._register(this.on('did-context-menu', (data) => {\n\t\t\tif (!this.element) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!this._contextKeyService) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst elementBox = this.element.getBoundingClientRect();\n\t\t\tconst contextKeyService = this._contextKeyService!.createOverlay([\n\t\t\t\t...Object.entries(data.context),\n\t\t\t\t[webviewIdContext, this.providedViewType],\n\t\t\t]);\n\t\t\tcontextMenuService.showContextMenu({\n\t\t\t\tmenuId: MenuId.WebviewContext,\n\t\t\t\tmenuActionOptions: { shouldForwardArgs: true },\n\t\t\t\tcontextKeyService,\n\t\t\t\tgetActionsContext: (): WebviewActionContext => ({ ...data.context, webview: this.providedViewType }),\n\t\t\t\tgetAnchor: () => ({\n\t\t\t\t\tx: elementBox.x + data.clientX,\n\t\t\t\t\ty: elementBox.y + data.clientY\n\t\t\t\t})\n\t\t\t});\n\t\t}));\n\n\t\tthis._register(this.on('load-resource', async (entry) => {\n\t\t\ttry {\n\t\t\t\t// Restore the authority we previously encoded\n\t\t\t\tconst authority = decodeAuthority(entry.authority);\n\t\t\t\tconst uri = URI.from({\n\t\t\t\t\tscheme: entry.scheme,\n\t\t\t\t\tauthority: authority,\n\t\t\t\t\tpath: decodeURIComponent(entry.path), // This gets re-encoded\n\t\t\t\t\tquery: entry.query ? decodeURIComponent(entry.query) : entry.query,\n\t\t\t\t});\n\t\t\t\tthis.loadResource(entry.id, uri, entry.ifNoneMatch);\n\t\t\t} catch (e) {\n\t\t\t\tthis._send('did-load-resource', {\n\t\t\t\t\tid: entry.id,\n\t\t\t\t\tstatus: 404,\n\t\t\t\t\tpath: entry.path,\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.on('load-localhost', (entry) => {\n\t\t\tthis.localLocalhost(entry.id, entry.origin);\n\t\t}));\n\n\t\tthis._register(Event.runAndSubscribe(webviewThemeDataProvider.onThemeDataChanged, () => this.style()));\n\t\tthis._register(_accessibilityService.onDidChangeReducedMotion(() => this.style()));\n\t\tthis._register(_accessibilityService.onDidChangeScreenReaderOptimized(() => this.style()));\n\t\tthis._register(contextMenuService.onDidShowContextMenu(() => this._send('set-context-menu-visible', { visible: true })));\n\t\tthis._register(contextMenuService.onDidHideContextMenu(() => this._send('set-context-menu-visible', { visible: false })));\n\n\t\tthis._confirmBeforeClose = configurationService.getValue<string>('window.confirmBeforeClose');\n\n\t\tthis._register(configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration('window.confirmBeforeClose')) {\n\t\t\t\tthis._confirmBeforeClose = configurationService.getValue('window.confirmBeforeClose');\n\t\t\t\tthis._send('set-confirm-before-close', this._confirmBeforeClose);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.on('drag-start', () => {\n\t\t\tthis._startBlockingIframeDragEvents();\n\t\t}));\n\n\t\tif (initInfo.options.enableFindWidget) {\n\t\t\tthis._webviewFindWidget = this._register(instantiationService.createInstance(WebviewFindWidget, this));\n\t\t}\n\n\t\tthis._encodedWebviewOriginPromise.then(encodedWebviewOrigin => {\n\t\t\tif (!this._disposed) {\n\t\t\t\tthis._initElement(encodedWebviewOrigin, this.extension, this._options);\n\t\t\t}\n\t\t});\n\t}\n\n\toverride dispose(): void {\n\t\tthis._disposed = true;\n\n\t\tthis.element?.remove();\n\t\tthis._element = undefined;\n\n\t\tthis._messagePort = undefined;\n\n\t\tif (this._state.type === WebviewState.Type.Initializing) {\n\t\t\tfor (const message of this._state.pendingMessages) {\n\t\t\t\tmessage.resolve(false);\n\t\t\t}\n\t\t\tthis._state.pendingMessages = [];\n\t\t}\n\n\t\tthis._onDidDispose.fire();\n\n\t\tthis._resourceLoadingCts.dispose(true);\n\n\t\tsuper.dispose();\n\t}\n\n\tsetContextKeyService(contextKeyService: IContextKeyService) {\n\t\tthis._contextKeyService = contextKeyService;\n\t}\n\n\tprivate readonly _onMissingCsp = this._register(new Emitter<ExtensionIdentifier>());\n\tpublic readonly onMissingCsp = this._onMissingCsp.event;\n\n\tprivate readonly _onDidClickLink = this._register(new Emitter<string>());\n\tpublic readonly onDidClickLink = this._onDidClickLink.event;\n\n\tprivate readonly _onDidReload = this._register(new Emitter<void>());\n\tpublic readonly onDidReload = this._onDidReload.event;\n\n\tprivate readonly _onMessage = this._register(new Emitter<WebviewMessageReceivedEvent>());\n\tpublic readonly onMessage = this._onMessage.event;\n\n\tprivate readonly _onDidScroll = this._register(new Emitter<{ readonly scrollYPercentage: number }>());\n\tpublic readonly onDidScroll = this._onDidScroll.event;\n\n\tprivate readonly _onDidWheel = this._register(new Emitter<IMouseWheelEvent>());\n\tpublic readonly onDidWheel = this._onDidWheel.event;\n\n\tprivate readonly _onDidUpdateState = this._register(new Emitter<string | undefined>());\n\tpublic readonly onDidUpdateState = this._onDidUpdateState.event;\n\n\tprivate readonly _onDidFocus = this._register(new Emitter<void>());\n\tpublic readonly onDidFocus = this._onDidFocus.event;\n\n\tprivate readonly _onDidBlur = this._register(new Emitter<void>());\n\tpublic readonly onDidBlur = this._onDidBlur.event;\n\n\tprivate readonly _onFatalError = this._register(new Emitter<{ readonly message: string }>());\n\tpublic readonly onFatalError = this._onFatalError.event;\n\n\tprivate readonly _onDidDispose = this._register(new Emitter<void>());\n\tpublic readonly onDidDispose = this._onDidDispose.event;\n\n\tpublic postMessage(message: any, transfer?: ArrayBuffer[]): Promise<boolean> {\n\t\treturn this._send('message', { message, transfer });\n\t}\n\n\tprivate async _send<K extends keyof ToWebviewMessage>(channel: K, data: ToWebviewMessage[K], _createElement: Transferable[] = []): Promise<boolean> {\n\t\tif (this._state.type === WebviewState.Type.Initializing) {\n\t\t\tlet resolve: (x: boolean) => void;\n\t\t\tconst promise = new Promise<boolean>(r => resolve = r);\n\t\t\tthis._state.pendingMessages.push({ channel, data, transferable: _createElement, resolve: resolve! });\n\t\t\treturn promise;\n\t\t} else {\n\t\t\treturn this.doPostMessage(channel, data, _createElement);\n\t\t}\n\t}\n\n\tprivate _createElement(options: WebviewOptions, _contentOptions: WebviewContentOptions) {\n\t\t// Do not start loading the webview yet.\n\t\t// Wait the end of the ctor when all listeners have been hooked up.\n\t\tconst element = document.createElement('iframe');\n\t\telement.name = this.id;\n\t\telement.className = `webview ${options.customClasses || ''}`;\n\t\telement.sandbox.add('allow-scripts', 'allow-same-origin', 'allow-forms', 'allow-pointer-lock', 'allow-downloads');\n\n\t\tconst allowRules = ['cross-origin-isolated', 'autoplay'];\n\t\tif (!isFirefox) {\n\t\t\tallowRules.push('clipboard-read', 'clipboard-write');\n\t\t}\n\t\telement.setAttribute('allow', allowRules.join('; '));\n\n\t\telement.style.border = 'none';\n\t\telement.style.width = '100%';\n\t\telement.style.height = '100%';\n\n\t\telement.focus = () => {\n\t\t\tthis._doFocus();\n\t\t};\n\n\t\treturn element;\n\t}\n\n\tprivate _initElement(encodedWebviewOrigin: string, extension: WebviewExtensionDescription | undefined, options: WebviewOptions) {\n\t\t// The extensionId and purpose in the URL are used for filtering in js-debug:\n\t\tconst params: { [key: string]: string } = {\n\t\t\tid: this.id,\n\t\t\torigin: this.origin,\n\t\t\tswVersion: String(this._expectedServiceWorkerVersion),\n\t\t\textensionId: extension?.id.value ?? '',\n\t\t\tplatform: this.platform,\n\t\t\t'vscode-resource-base-authority': webviewRootResourceAuthority,\n\t\t\tparentOrigin: window.origin,\n\t\t};\n\n\t\tif (this._options.disableServiceWorker) {\n\t\t\tparams.disableServiceWorker = 'true';\n\t\t}\n\n\t\tif (this._environmentService.remoteAuthority) {\n\t\t\tparams.remoteAuthority = this._environmentService.remoteAuthority;\n\t\t}\n\n\t\tif (options.purpose) {\n\t\t\tparams.purpose = options.purpose;\n\t\t}\n\n\t\tCOI.addSearchParam(params, true, true);\n\n\t\tconst queryString = new URLSearchParams(params).toString();\n\n\t\t// Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=1754872\n\t\tconst fileName = isFirefox ? 'index-no-csp.html' : 'index.html';\n\n\t\tthis.element!.setAttribute('src', `${this.webviewContentEndpoint(encodedWebviewOrigin)}/${fileName}?${queryString}`);\n\t}\n\n\tpublic mountTo(element: HTMLElement) {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._webviewFindWidget) {\n\t\t\telement.appendChild(this._webviewFindWidget.getDomNode());\n\t\t}\n\n\t\tfor (const eventName of [EventType.MOUSE_DOWN, EventType.MOUSE_MOVE, EventType.DROP]) {\n\t\t\tthis._register(addDisposableListener(element, eventName, () => {\n\t\t\t\tthis._stopBlockingIframeDragEvents();\n\t\t\t}));\n\t\t}\n\n\t\tfor (const node of [element, window]) {\n\t\t\tthis._register(addDisposableListener(node, EventType.DRAG_END, () => {\n\t\t\t\tthis._stopBlockingIframeDragEvents();\n\t\t\t}));\n\t\t}\n\n\t\telement.id = this.id; // This is used by aria-flow for accessibility order\n\n\t\telement.appendChild(this.element);\n\t}\n\n\tprivate _startBlockingIframeDragEvents() {\n\t\tif (this.element) {\n\t\t\tthis.element.style.pointerEvents = 'none';\n\t\t}\n\t}\n\n\tprivate _stopBlockingIframeDragEvents() {\n\t\tif (this.element) {\n\t\t\tthis.element.style.pointerEvents = 'auto';\n\t\t}\n\t}\n\n\tprotected webviewContentEndpoint(encodedWebviewOrigin: string): string {\n\t\tconst webviewExternalEndpoint = this._environmentService.webviewExternalEndpoint;\n\t\tif (!webviewExternalEndpoint) {\n\t\t\tthrow new Error(`'webviewExternalEndpoint' has not been configured. Webviews will not work!`);\n\t\t}\n\n\t\tconst endpoint = webviewExternalEndpoint.replace('{{uuid}}', encodedWebviewOrigin);\n\t\tif (endpoint[endpoint.length - 1] === '/') {\n\t\t\treturn endpoint.slice(0, endpoint.length - 1);\n\t\t}\n\t\treturn endpoint;\n\t}\n\n\tprivate _webviewContentOrigin(encodedWebviewOrigin: string): string {\n\t\tconst uri = URI.parse(this.webviewContentEndpoint(encodedWebviewOrigin));\n\t\treturn uri.scheme + '://' + uri.authority.toLowerCase();\n\t}\n\n\tprivate doPostMessage(channel: string, data?: any, transferable: Transferable[] = []): boolean {\n\t\tif (this.element && this._messagePort) {\n\t\t\tthis._messagePort.postMessage({ channel, args: data }, transferable);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate on<K extends keyof FromWebviewMessage>(channel: K, handler: (data: FromWebviewMessage[K], e: MessageEvent) => void): IDisposable {\n\t\tlet handlers = this._messageHandlers.get(channel);\n\t\tif (!handlers) {\n\t\t\thandlers = new Set();\n\t\t\tthis._messageHandlers.set(channel, handlers);\n\t\t}\n\n\t\thandlers.add(handler);\n\t\treturn toDisposable(() => {\n\t\t\tthis._messageHandlers.get(channel)?.delete(handler);\n\t\t});\n\t}\n\n\tprivate _hasAlertedAboutMissingCsp = false;\n\tprivate handleNoCspFound(): void {\n\t\tif (this._hasAlertedAboutMissingCsp) {\n\t\t\treturn;\n\t\t}\n\t\tthis._hasAlertedAboutMissingCsp = true;\n\n\t\tif (this.extension?.id) {\n\t\t\tif (this._environmentService.isExtensionDevelopment) {\n\t\t\t\tthis._onMissingCsp.fire(this.extension.id);\n\t\t\t}\n\n\t\t\tconst payload = {\n\t\t\t\textension: this.extension.id.value\n\t\t\t} as const;\n\n\t\t\ttype Classification = {\n\t\t\t\textension: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The id of the extension that created the webview.' };\n\t\t\t\towner: 'mjbz';\n\t\t\t\tcomment: 'Helps find which extensions are contributing webviews with invalid CSPs';\n\t\t\t};\n\n\t\t\tthis._telemetryService.publicLog2<typeof payload, Classification>('webviewMissingCsp', payload);\n\t\t}\n\t}\n\n\tpublic reload(): void {\n\t\tthis.doUpdateContent(this._content);\n\n\t\tconst subscription = this._register(this.on('did-load', () => {\n\t\t\tthis._onDidReload.fire();\n\t\t\tsubscription.dispose();\n\t\t}));\n\t}\n\n\tpublic setHtml(html: string) {\n\t\tthis.doUpdateContent({ ...this._content, html });\n\t\tthis._onDidHtmlChange.fire(html);\n\t}\n\n\tpublic setTitle(title: string) {\n\t\tthis._content = { ...this._content, title };\n\t\tthis._send('set-title', title);\n\t}\n\n\tpublic set contentOptions(options: WebviewContentOptions) {\n\t\tthis._logService.debug(`Webview(${this.id}): will update content options`);\n\n\t\tif (areWebviewContentOptionsEqual(options, this._content.options)) {\n\t\t\tthis._logService.debug(`Webview(${this.id}): skipping content options update`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.doUpdateContent({ ...this._content, options });\n\t}\n\n\tpublic set localResourcesRoot(resources: readonly URI[]) {\n\t\tthis._content = {\n\t\t\t...this._content,\n\t\t\toptions: { ...this._content.options, localResourceRoots: resources }\n\t\t};\n\t}\n\n\tpublic set state(state: string | undefined) {\n\t\tthis._content = { ...this._content, state };\n\t}\n\n\tpublic set initialScrollProgress(value: number) {\n\t\tthis._send('initial-scroll-position', value);\n\t}\n\n\tprivate doUpdateContent(newContent: WebviewContent) {\n\t\tthis._logService.debug(`Webview(${this.id}): will update content`);\n\n\t\tthis._content = newContent;\n\n\t\tconst allowScripts = !!this._content.options.allowScripts;\n\t\tthis._send('content', {\n\t\t\tcontents: this._content.html,\n\t\t\ttitle: this._content.title,\n\t\t\toptions: {\n\t\t\t\tallowMultipleAPIAcquire: !!this._content.options.allowMultipleAPIAcquire,\n\t\t\t\tallowScripts: allowScripts,\n\t\t\t\tallowForms: this._content.options.allowForms ?? allowScripts, // For back compat, we allow forms by default when scripts are enabled\n\t\t\t},\n\t\t\tstate: this._content.state,\n\t\t\tcspSource: webviewGenericCspSource,\n\t\t\tconfirmBeforeClose: this._confirmBeforeClose,\n\t\t});\n\t}\n\n\tprotected style(): void {\n\t\tlet { styles, activeTheme, themeLabel, themeId } = this.webviewThemeDataProvider.getWebviewThemeData();\n\t\tif (this._options.transformCssVariables) {\n\t\t\tstyles = this._options.transformCssVariables(styles);\n\t\t}\n\n\t\tconst reduceMotion = this._accessibilityService.isMotionReduced();\n\t\tconst screenReader = this._accessibilityService.isScreenReaderOptimized();\n\n\t\tthis._send('styles', { styles, activeTheme, themeId, themeLabel, reduceMotion, screenReader });\n\t}\n\n\n\tprotected handleFocusChange(isFocused: boolean): void {\n\t\tthis._focused = isFocused;\n\t\tif (isFocused) {\n\t\t\tthis._onDidFocus.fire();\n\t\t} else {\n\t\t\tthis._onDidBlur.fire();\n\t\t}\n\t}\n\n\tprivate handleKeyEvent(type: 'keydown' | 'keyup', event: KeyEvent) {\n\t\t// Create a fake KeyboardEvent from the data provided\n\t\tconst emulatedKeyboardEvent = new KeyboardEvent(type, event);\n\t\t// Force override the target\n\t\tObject.defineProperty(emulatedKeyboardEvent, 'target', {\n\t\t\tget: () => this.element,\n\t\t});\n\t\t// And re-dispatch\n\t\twindow.dispatchEvent(emulatedKeyboardEvent);\n\t}\n\n\twindowDidDragStart(): void {\n\t\t// Webview break drag and dropping around the main window (no events are generated when you are over them)\n\t\t// Work around this by disabling pointer events during the drag.\n\t\t// https://github.com/electron/electron/issues/18226\n\t\tthis._startBlockingIframeDragEvents();\n\t}\n\n\twindowDidDragEnd(): void {\n\t\tthis._stopBlockingIframeDragEvents();\n\t}\n\n\tpublic selectAll() {\n\t\tthis.execCommand('selectAll');\n\t}\n\n\tpublic copy() {\n\t\tthis.execCommand('copy');\n\t}\n\n\tpublic paste() {\n\t\tthis.execCommand('paste');\n\t}\n\n\tpublic cut() {\n\t\tthis.execCommand('cut');\n\t}\n\n\tpublic undo() {\n\t\tthis.execCommand('undo');\n\t}\n\n\tpublic redo() {\n\t\tthis.execCommand('redo');\n\t}\n\n\tprivate execCommand(command: string) {\n\t\tif (this.element) {\n\t\t\tthis._send('execCommand', command);\n\t\t}\n\t}\n\n\tprivate async loadResource(id: number, uri: URI, ifNoneMatch: string | undefined) {\n\t\ttry {\n\t\t\tconst result = await loadLocalResource(uri, {\n\t\t\t\tifNoneMatch,\n\t\t\t\troots: this._content.options.localResourceRoots || [],\n\t\t\t}, this._fileService, this._logService, this._resourceLoadingCts.token);\n\n\t\t\tswitch (result.type) {\n\t\t\t\tcase WebviewResourceResponse.Type.Success: {\n\t\t\t\t\tconst buffer = await this.streamToBuffer(result.stream);\n\t\t\t\t\treturn this._send('did-load-resource', {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tstatus: 200,\n\t\t\t\t\t\tpath: uri.path,\n\t\t\t\t\t\tmime: result.mimeType,\n\t\t\t\t\t\tdata: buffer,\n\t\t\t\t\t\tetag: result.etag,\n\t\t\t\t\t\tmtime: result.mtime\n\t\t\t\t\t}, [buffer]);\n\t\t\t\t}\n\t\t\t\tcase WebviewResourceResponse.Type.NotModified: {\n\t\t\t\t\treturn this._send('did-load-resource', {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tstatus: 304, // not modified\n\t\t\t\t\t\tpath: uri.path,\n\t\t\t\t\t\tmime: result.mimeType,\n\t\t\t\t\t\tmtime: result.mtime\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tcase WebviewResourceResponse.Type.AccessDenied: {\n\t\t\t\t\treturn this._send('did-load-resource', {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tstatus: 401, // unauthorized\n\t\t\t\t\t\tpath: uri.path,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} catch {\n\t\t\t// noop\n\t\t}\n\n\t\treturn this._send('did-load-resource', {\n\t\t\tid,\n\t\t\tstatus: 404,\n\t\t\tpath: uri.path,\n\t\t});\n\t}\n\n\tprotected async streamToBuffer(stream: VSBufferReadableStream): Promise<ArrayBufferLike> {\n\t\tconst vsBuffer = await streamToBuffer(stream);\n\t\treturn vsBuffer.buffer.buffer;\n\t}\n\n\tprivate async localLocalhost(id: string, origin: string) {\n\t\tconst authority = this._environmentService.remoteAuthority;\n\t\tconst resolveAuthority = authority ? await this._remoteAuthorityResolverService.resolveAuthority(authority) : undefined;\n\t\tconst redirect = resolveAuthority ? await this._portMappingManager.getRedirect(resolveAuthority.authority, origin) : undefined;\n\t\treturn this._send('did-load-localhost', {\n\t\t\tid,\n\t\t\torigin,\n\t\t\tlocation: redirect\n\t\t});\n\t}\n\n\tpublic focus(): void {\n\t\tthis._doFocus();\n\n\t\t// Handle focus change programmatically (do not rely on event from <webview>)\n\t\tthis.handleFocusChange(true);\n\t}\n\n\tprivate _doFocus() {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tthis.element.contentWindow?.focus();\n\t\t} catch {\n\t\t\t// noop\n\t\t}\n\n\t\t// Workaround for https://github.com/microsoft/vscode/issues/75209\n\t\t// Focusing the inner webview is async so for a sequence of actions such as:\n\t\t//\n\t\t// 1. Open webview\n\t\t// 1. Show quick pick from command palette\n\t\t//\n\t\t// We end up focusing the webview after showing the quick pick, which causes\n\t\t// the quick pick to instantly dismiss.\n\t\t//\n\t\t// Workaround this by debouncing the focus and making sure we are not focused on an input\n\t\t// when we try to re-focus.\n\t\tthis._focusDelayer.trigger(async () => {\n\t\t\tif (!this.isFocused || !this.element) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (document.activeElement && document.activeElement !== this.element && document.activeElement?.tagName !== 'BODY') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._send('focus', undefined);\n\t\t});\n\t}\n\n\tprotected readonly _hasFindResult = this._register(new Emitter<boolean>());\n\tpublic readonly hasFindResult: Event<boolean> = this._hasFindResult.event;\n\n\tprotected readonly _onDidStopFind = this._register(new Emitter<void>());\n\tpublic readonly onDidStopFind: Event<void> = this._onDidStopFind.event;\n\n\t/**\n\t * Webviews expose a stateful find API.\n\t * Successive calls to find will move forward or backward through onFindResults\n\t * depending on the supplied options.\n\t *\n\t * @param value The string to search for. Empty strings are ignored.\n\t */\n\tpublic find(value: string, previous: boolean): void {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._send('find', { value, previous });\n\t}\n\n\tpublic updateFind(value: string) {\n\t\tif (!value || !this.element) {\n\t\t\treturn;\n\t\t}\n\t\tthis._send('find', { value });\n\t}\n\n\tpublic stopFind(keepSelection?: boolean): void {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\t\tthis._send('find-stop', { clearSelection: !keepSelection });\n\t\tthis._onDidStopFind.fire();\n\t}\n\n\tpublic showFind(animated = true) {\n\t\tthis._webviewFindWidget?.reveal(undefined, animated);\n\t}\n\n\tpublic hideFind(animated = true) {\n\t\tthis._webviewFindWidget?.hide(animated);\n\t}\n\n\tpublic runFindAction(previous: boolean) {\n\t\tthis._webviewFindWidget?.find(previous);\n\t}\n}\n"]}