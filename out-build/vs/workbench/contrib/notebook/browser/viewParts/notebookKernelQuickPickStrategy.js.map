{"version":3,"sources":["vs/workbench/contrib/notebook/browser/viewParts/notebookKernelQuickPickStrategy.ts"],"names":[],"mappings":"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","file":"notebookKernelQuickPickStrategy.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IAction } from 'vs/base/common/actions';\nimport { groupBy } from 'vs/base/common/arrays';\nimport { createCancelablePromise } from 'vs/base/common/async';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { Codicon } from 'vs/base/common/codicons';\nimport { Event } from 'vs/base/common/event';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { MarshalledId } from 'vs/base/common/marshallingIds';\nimport { uppercaseFirstLetter } from 'vs/base/common/strings';\nimport { Command } from 'vs/editor/common/languages';\nimport { localize } from 'vs/nls';\nimport { ICommandService } from 'vs/platform/commands/common/commands';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IProductService } from 'vs/platform/product/common/productService';\nimport { ProgressLocation } from 'vs/platform/progress/common/progress';\nimport { IQuickInputButton, IQuickInputService, IQuickPick, IQuickPickItem, QuickPickInput } from 'vs/platform/quickinput/common/quickInput';\nimport { ThemeIcon } from 'vs/base/common/themables';\nimport { ViewContainerLocation } from 'vs/workbench/common/views';\nimport { IExtension, IExtensionsViewPaneContainer, IExtensionsWorkbenchService, VIEWLET_ID as EXTENSION_VIEWLET_ID } from 'vs/workbench/contrib/extensions/common/extensions';\nimport { IActiveNotebookEditor, INotebookExtensionRecommendation, JUPYTER_EXTENSION_ID, KERNEL_RECOMMENDATIONS } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { NotebookEditorWidget } from 'vs/workbench/contrib/notebook/browser/notebookEditorWidget';\nimport { executingStateIcon, selectKernelIcon } from 'vs/workbench/contrib/notebook/browser/notebookIcons';\nimport { NotebookTextModel } from 'vs/workbench/contrib/notebook/common/model/notebookTextModel';\nimport { INotebookKernel, INotebookKernelHistoryService, INotebookKernelMatchResult, INotebookKernelService, ISourceAction } from 'vs/workbench/contrib/notebook/common/notebookKernelService';\nimport { IExtensionService } from 'vs/workbench/services/extensions/common/extensions';\nimport { IPaneCompositePartService } from 'vs/workbench/services/panecomposite/browser/panecomposite';\nimport { URI } from 'vs/base/common/uri';\nimport { IOpenerService } from 'vs/platform/opener/common/opener';\nimport { INotebookTextModel } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { SELECT_KERNEL_ID } from 'vs/workbench/contrib/notebook/browser/controller/coreActions';\nimport { EnablementState } from 'vs/workbench/services/extensionManagement/common/extensionManagement';\n\ntype KernelPick = IQuickPickItem & { kernel: INotebookKernel };\nfunction isKernelPick(item: QuickPickInput<IQuickPickItem>): item is KernelPick {\n\treturn 'kernel' in item;\n}\ntype GroupedKernelsPick = IQuickPickItem & { kernels: INotebookKernel[]; source: string };\nfunction isGroupedKernelsPick(item: QuickPickInput<IQuickPickItem>): item is GroupedKernelsPick {\n\treturn 'kernels' in item;\n}\ntype SourcePick = IQuickPickItem & { action: ISourceAction };\nfunction isSourcePick(item: QuickPickInput<IQuickPickItem>): item is SourcePick {\n\treturn 'action' in item;\n}\ntype InstallExtensionPick = IQuickPickItem & { extensionIds: string[] };\nfunction isInstallExtensionPick(item: QuickPickInput<IQuickPickItem>): item is InstallExtensionPick {\n\treturn item.id === 'installSuggested' && 'extensionIds' in item;\n}\ntype SearchMarketplacePick = IQuickPickItem & { id: 'install' };\nfunction isSearchMarketplacePick(item: QuickPickInput<IQuickPickItem>): item is SearchMarketplacePick {\n\treturn item.id === 'install';\n}\n\ntype KernelSourceQuickPickItem = IQuickPickItem & { command: Command; documentation?: string };\nfunction isKernelSourceQuickPickItem(item: IQuickPickItem): item is KernelSourceQuickPickItem {\n\treturn 'command' in item;\n}\n\nfunction supportAutoRun(item: QuickPickInput<IQuickPickItem>): item is IQuickPickItem {\n\treturn 'autoRun' in item && !!item.autoRun;\n}\ntype KernelQuickPickItem = (IQuickPickItem & { autoRun?: boolean }) | SearchMarketplacePick | InstallExtensionPick | KernelPick | GroupedKernelsPick | SourcePick | KernelSourceQuickPickItem;\nconst KERNEL_PICKER_UPDATE_DEBOUNCE = 200;\n\nexport type KernelQuickPickContext =\n\t{ id: string; extension: string } |\n\t{ notebookEditorId: string } |\n\t{ id: string; extension: string; notebookEditorId: string } |\n\t{ ui?: boolean; notebookEditor?: NotebookEditorWidget };\n\nexport interface IKernelPickerStrategy {\n\tshowQuickPick(editor: IActiveNotebookEditor, wantedKernelId?: string): Promise<boolean>;\n}\n\nfunction toKernelQuickPick(kernel: INotebookKernel, selected: INotebookKernel | undefined) {\n\tconst res: KernelPick = {\n\t\tkernel,\n\t\tpicked: kernel.id === selected?.id,\n\t\tlabel: kernel.label,\n\t\tdescription: kernel.description,\n\t\tdetail: kernel.detail\n\t};\n\tif (kernel.id === selected?.id) {\n\t\tif (!res.description) {\n\t\t\tres.description = localize('current1', \"Currently Selected\");\n\t\t} else {\n\t\t\tres.description = localize('current2', \"{0} - Currently Selected\", res.description);\n\t\t}\n\t}\n\treturn res;\n}\n\n\nabstract class KernelPickerStrategyBase implements IKernelPickerStrategy {\n\tconstructor(\n\t\tprotected readonly _notebookKernelService: INotebookKernelService,\n\t\tprotected readonly _productService: IProductService,\n\t\tprotected readonly _quickInputService: IQuickInputService,\n\t\tprotected readonly _labelService: ILabelService,\n\t\tprotected readonly _logService: ILogService,\n\t\tprotected readonly _paneCompositePartService: IPaneCompositePartService,\n\t\tprotected readonly _extensionWorkbenchService: IExtensionsWorkbenchService,\n\t\tprotected readonly _extensionService: IExtensionService,\n\t\tprotected readonly _commandService: ICommandService\n\t) { }\n\n\tasync showQuickPick(editor: IActiveNotebookEditor, wantedId?: string, skipAutoRun?: boolean): Promise<boolean> {\n\t\tconst notebook = editor.textModel;\n\t\tconst scopedContextKeyService = editor.scopedContextKeyService;\n\t\tconst matchResult = this._getMatchingResult(notebook);\n\t\tconst { selected, all } = matchResult;\n\n\t\tlet newKernel: INotebookKernel | undefined;\n\t\tif (wantedId) {\n\t\t\tfor (const candidate of all) {\n\t\t\t\tif (candidate.id === wantedId) {\n\t\t\t\t\tnewKernel = candidate;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!newKernel) {\n\t\t\t\tthis._logService.warn(`wanted kernel DOES NOT EXIST, wanted: ${wantedId}, all: ${all.map(k => k.id)}`);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (newKernel) {\n\t\t\tthis._selecteKernel(notebook, newKernel);\n\t\t\treturn true;\n\t\t}\n\n\t\tconst quickPick = this._quickInputService.createQuickPick<KernelQuickPickItem>();\n\t\tconst quickPickItems = this._getKernelPickerQuickPickItems(notebook, matchResult, this._notebookKernelService, scopedContextKeyService);\n\n\t\tif (quickPickItems.length === 1 && supportAutoRun(quickPickItems[0]) && !skipAutoRun) {\n\t\t\treturn await this._handleQuickPick(editor, quickPickItems[0], quickPickItems as KernelQuickPickItem[]);\n\t\t}\n\n\t\tquickPick.items = quickPickItems;\n\t\tquickPick.canSelectMany = false;\n\t\tquickPick.placeholder = selected\n\t\t\t? localize('prompt.placeholder.change', \"Change kernel for '{0}'\", this._labelService.getUriLabel(notebook.uri, { relative: true }))\n\t\t\t: localize('prompt.placeholder.select', \"Select kernel for '{0}'\", this._labelService.getUriLabel(notebook.uri, { relative: true }));\n\n\t\tquickPick.busy = this._notebookKernelService.getKernelDetectionTasks(notebook).length > 0;\n\n\t\tconst kernelDetectionTaskListener = this._notebookKernelService.onDidChangeKernelDetectionTasks(() => {\n\t\t\tquickPick.busy = this._notebookKernelService.getKernelDetectionTasks(notebook).length > 0;\n\t\t});\n\n\t\t// run extension recommendataion task if quickPickItems is empty\n\t\tconst extensionRecommendataionPromise = quickPickItems.length === 0\n\t\t\t? createCancelablePromise(token => this._showInstallKernelExtensionRecommendation(notebook, quickPick, this._extensionWorkbenchService, token))\n\t\t\t: undefined;\n\n\t\tconst kernelChangeEventListener = Event.debounce<void, void>(\n\t\t\tEvent.any(\n\t\t\t\tthis._notebookKernelService.onDidChangeSourceActions,\n\t\t\t\tthis._notebookKernelService.onDidAddKernel,\n\t\t\t\tthis._notebookKernelService.onDidRemoveKernel,\n\t\t\t\tthis._notebookKernelService.onDidChangeNotebookAffinity\n\t\t\t),\n\t\t\t(last, _current) => last,\n\t\t\tKERNEL_PICKER_UPDATE_DEBOUNCE\n\t\t)(async () => {\n\t\t\t// reset quick pick progress\n\t\t\tquickPick.busy = false;\n\t\t\textensionRecommendataionPromise?.cancel();\n\n\t\t\tconst currentActiveItems = quickPick.activeItems;\n\t\t\tconst matchResult = this._getMatchingResult(notebook);\n\t\t\tconst quickPickItems = this._getKernelPickerQuickPickItems(notebook, matchResult, this._notebookKernelService, scopedContextKeyService);\n\t\t\tquickPick.keepScrollPosition = true;\n\n\t\t\t// recalcuate active items\n\t\t\tconst activeItems: KernelQuickPickItem[] = [];\n\t\t\tfor (const item of currentActiveItems) {\n\t\t\t\tif (isKernelPick(item)) {\n\t\t\t\t\tconst kernelId = item.kernel.id;\n\t\t\t\t\tconst sameItem = quickPickItems.find(pi => isKernelPick(pi) && pi.kernel.id === kernelId) as KernelPick | undefined;\n\t\t\t\t\tif (sameItem) {\n\t\t\t\t\t\tactiveItems.push(sameItem);\n\t\t\t\t\t}\n\t\t\t\t} else if (isSourcePick(item)) {\n\t\t\t\t\tconst sameItem = quickPickItems.find(pi => isSourcePick(pi) && pi.action.action.id === item.action.action.id) as SourcePick | undefined;\n\t\t\t\t\tif (sameItem) {\n\t\t\t\t\t\tactiveItems.push(sameItem);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tquickPick.items = quickPickItems;\n\t\t\tquickPick.activeItems = activeItems;\n\t\t}, this);\n\n\t\tconst pick = await new Promise<{ selected: KernelQuickPickItem | undefined; items: KernelQuickPickItem[] }>((resolve, reject) => {\n\t\t\tquickPick.onDidAccept(() => {\n\t\t\t\tconst item = quickPick.selectedItems[0];\n\t\t\t\tif (item) {\n\t\t\t\t\tresolve({ selected: item, items: quickPick.items as KernelQuickPickItem[] });\n\t\t\t\t} else {\n\t\t\t\t\tresolve({ selected: undefined, items: quickPick.items as KernelQuickPickItem[] });\n\t\t\t\t}\n\n\t\t\t\tquickPick.hide();\n\t\t\t});\n\n\t\t\tquickPick.onDidHide(() => {\n\t\t\t\tkernelDetectionTaskListener.dispose();\n\t\t\t\tkernelChangeEventListener.dispose();\n\t\t\t\tquickPick.dispose();\n\t\t\t\tresolve({ selected: undefined, items: quickPick.items as KernelQuickPickItem[] });\n\t\t\t});\n\t\t\tquickPick.show();\n\t\t});\n\n\t\tif (pick.selected) {\n\t\t\treturn await this._handleQuickPick(editor, pick.selected, pick.items);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprotected _getMatchingResult(notebook: NotebookTextModel) {\n\t\treturn this._notebookKernelService.getMatchingKernel(notebook);\n\t}\n\n\tprotected abstract _getKernelPickerQuickPickItems(\n\t\tnotebookTextModel: NotebookTextModel,\n\t\tmatchResult: INotebookKernelMatchResult,\n\t\tnotebookKernelService: INotebookKernelService,\n\t\tscopedContextKeyService: IContextKeyService\n\t): QuickPickInput<KernelQuickPickItem>[];\n\n\tprotected async _handleQuickPick(editor: IActiveNotebookEditor, pick: KernelQuickPickItem, quickPickItems: KernelQuickPickItem[]): Promise<boolean> {\n\t\tif (isKernelPick(pick)) {\n\t\t\tconst newKernel = pick.kernel;\n\t\t\tthis._selecteKernel(editor.textModel, newKernel);\n\t\t\treturn true;\n\t\t}\n\n\t\t// actions\n\t\tif (isSearchMarketplacePick(pick)) {\n\t\t\tawait this._showKernelExtension(\n\t\t\t\tthis._paneCompositePartService,\n\t\t\t\tthis._extensionWorkbenchService,\n\t\t\t\tthis._extensionService,\n\t\t\t\teditor.textModel.viewType,\n\t\t\t\t[]\n\t\t\t);\n\t\t\t// suggestedExtension must be defined for this option to be shown, but still check to make TS happy\n\t\t} else if (isInstallExtensionPick(pick)) {\n\t\t\tawait this._showKernelExtension(\n\t\t\t\tthis._paneCompositePartService,\n\t\t\t\tthis._extensionWorkbenchService,\n\t\t\t\tthis._extensionService,\n\t\t\t\teditor.textModel.viewType,\n\t\t\t\tpick.extensionIds,\n\t\t\t\tthis._productService.quality !== 'stable'\n\t\t\t);\n\t\t} else if (isSourcePick(pick)) {\n\t\t\t// selected explicilty, it should trigger the execution?\n\t\t\tpick.action.runAction();\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprotected _selecteKernel(notebook: NotebookTextModel, kernel: INotebookKernel) {\n\t\tthis._notebookKernelService.selectKernelForNotebook(kernel, notebook);\n\t}\n\n\tprotected async _showKernelExtension(\n\t\tpaneCompositePartService: IPaneCompositePartService,\n\t\textensionWorkbenchService: IExtensionsWorkbenchService,\n\t\textensionService: IExtensionService,\n\t\tviewType: string,\n\t\textIds: string[],\n\t\tisInsiders?: boolean\n\t) {\n\t\t// If extension id is provided attempt to install the extension as the user has requested the suggested ones be installed\n\t\tconst extensionsToInstall: IExtension[] = [];\n\t\tconst extensionsToEnable: IExtension[] = [];\n\n\t\tfor (const extId of extIds) {\n\t\t\tconst extension = (await extensionWorkbenchService.getExtensions([{ id: extId }], CancellationToken.None))[0];\n\t\t\tif (extension.enablementState === EnablementState.DisabledGlobally || extension.enablementState === EnablementState.DisabledWorkspace || extension.enablementState === EnablementState.DisabledByEnvironment) {\n\t\t\t\textensionsToEnable.push(extension);\n\t\t\t} else {\n\t\t\t\tconst canInstall = await extensionWorkbenchService.canInstall(extension);\n\t\t\t\tif (canInstall) {\n\t\t\t\t\textensionsToInstall.push(extension);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (extensionsToInstall.length || extensionsToEnable.length) {\n\t\t\tawait Promise.all([...extensionsToInstall.map(async extension => {\n\t\t\t\tawait extensionWorkbenchService.install(\n\t\t\t\t\textension,\n\t\t\t\t\t{\n\t\t\t\t\t\tinstallPreReleaseVersion: isInsiders ?? false,\n\t\t\t\t\t\tcontext: { skipWalkthrough: true }\n\t\t\t\t\t},\n\t\t\t\t\tProgressLocation.Notification\n\t\t\t\t);\n\t\t\t}), ...extensionsToEnable.map(async extension => {\n\t\t\t\tswitch (extension.enablementState) {\n\t\t\t\t\tcase EnablementState.DisabledWorkspace:\n\t\t\t\t\t\tawait extensionWorkbenchService.setEnablement([extension], EnablementState.EnabledWorkspace);\n\t\t\t\t\t\treturn;\n\t\t\t\t\tcase EnablementState.DisabledGlobally:\n\t\t\t\t\t\tawait extensionWorkbenchService.setEnablement([extension], EnablementState.EnabledGlobally);\n\t\t\t\t\t\treturn;\n\t\t\t\t\tcase EnablementState.DisabledByEnvironment:\n\t\t\t\t\t\tawait extensionWorkbenchService.setEnablement([extension], EnablementState.EnabledByEnvironment);\n\t\t\t\t\t\treturn;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t})]);\n\n\t\t\tawait extensionService.activateByEvent(`onNotebook:${viewType}`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst viewlet = await paneCompositePartService.openPaneComposite(EXTENSION_VIEWLET_ID, ViewContainerLocation.Sidebar, true);\n\t\tconst view = viewlet?.getViewPaneContainer() as IExtensionsViewPaneContainer | undefined;\n\t\tconst pascalCased = viewType.split(/[^a-z0-9]/ig).map(uppercaseFirstLetter).join('');\n\t\tview?.search(`@tag:notebookKernel${pascalCased}`);\n\t}\n\n\tprivate async _showInstallKernelExtensionRecommendation(\n\t\tnotebookTextModel: NotebookTextModel,\n\t\tquickPick: IQuickPick<KernelQuickPickItem>,\n\t\textensionWorkbenchService: IExtensionsWorkbenchService,\n\t\ttoken: CancellationToken\n\t) {\n\t\tquickPick.busy = true;\n\n\t\tconst newQuickPickItems = await this._getKernelRecommendationsQuickPickItems(notebookTextModel, extensionWorkbenchService);\n\t\tquickPick.busy = false;\n\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (newQuickPickItems && quickPick.items.length === 0) {\n\t\t\tquickPick.items = newQuickPickItems;\n\t\t}\n\t}\n\n\tprotected async _getKernelRecommendationsQuickPickItems(\n\t\tnotebookTextModel: NotebookTextModel,\n\t\textensionWorkbenchService: IExtensionsWorkbenchService,\n\t): Promise<QuickPickInput<SearchMarketplacePick | InstallExtensionPick>[] | undefined> {\n\t\tconst quickPickItems: QuickPickInput<SearchMarketplacePick | InstallExtensionPick>[] = [];\n\n\t\tconst language = this.getSuggestedLanguage(notebookTextModel);\n\t\tconst suggestedExtension: INotebookExtensionRecommendation | undefined = language ? this.getSuggestedKernelFromLanguage(notebookTextModel.viewType, language) : undefined;\n\t\tif (suggestedExtension) {\n\t\t\tawait extensionWorkbenchService.queryLocal();\n\n\t\t\tconst extensions = extensionWorkbenchService.installed.filter(e =>\n\t\t\t\t(e.enablementState === EnablementState.EnabledByEnvironment || e.enablementState === EnablementState.EnabledGlobally || e.enablementState === EnablementState.EnabledWorkspace)\n\t\t\t\t&& suggestedExtension.extensionIds.includes(e.identifier.id)\n\t\t\t);\n\n\t\t\tif (extensions.length === suggestedExtension.extensionIds.length) {\n\t\t\t\t// it's installed but might be detecting kernels\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\t// We have a suggested kernel, show an option to install it\n\t\t\tquickPickItems.push({\n\t\t\t\tid: 'installSuggested',\n\t\t\t\tdescription: suggestedExtension.displayName ?? suggestedExtension.extensionIds.join(', '),\n\t\t\t\tlabel: `$(${Codicon.lightbulb.id}) ` + localize('installSuggestedKernel', 'Install/Enable suggested extensions'),\n\t\t\t\textensionIds: suggestedExtension.extensionIds\n\t\t\t} as InstallExtensionPick);\n\t\t}\n\t\t// there is no kernel, show the install from marketplace\n\t\tquickPickItems.push({\n\t\t\tid: 'install',\n\t\t\tlabel: localize('searchForKernels', \"Browse marketplace for kernel extensions\"),\n\t\t} as SearchMarketplacePick);\n\n\t\treturn quickPickItems;\n\t}\n\n\t/**\n\t * Examine the most common language in the notebook\n\t * @param notebookTextModel The notebook text model\n\t * @returns What the suggested language is for the notebook. Used for kernal installing\n\t */\n\tprivate getSuggestedLanguage(notebookTextModel: NotebookTextModel): string | undefined {\n\t\tconst metaData = notebookTextModel.metadata;\n\t\tlet suggestedKernelLanguage: string | undefined = (metaData.custom as any)?.metadata?.language_info?.name;\n\t\t// TODO how do we suggest multi language notebooks?\n\t\tif (!suggestedKernelLanguage) {\n\t\t\tconst cellLanguages = notebookTextModel.cells.map(cell => cell.language).filter(language => language !== 'markdown');\n\t\t\t// Check if cell languages is all the same\n\t\t\tif (cellLanguages.length > 1) {\n\t\t\t\tconst firstLanguage = cellLanguages[0];\n\t\t\t\tif (cellLanguages.every(language => language === firstLanguage)) {\n\t\t\t\t\tsuggestedKernelLanguage = firstLanguage;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn suggestedKernelLanguage;\n\t}\n\n\t/**\n\t * Given a language and notebook view type suggest a kernel for installation\n\t * @param language The language to find a suggested kernel extension for\n\t * @returns A recommednation object for the recommended extension, else undefined\n\t */\n\tprivate getSuggestedKernelFromLanguage(viewType: string, language: string): INotebookExtensionRecommendation | undefined {\n\t\tconst recommendation = KERNEL_RECOMMENDATIONS.get(viewType)?.get(language);\n\t\treturn recommendation;\n\t}\n}\n\nexport class KernelPickerMRUStrategy extends KernelPickerStrategyBase {\n\tconstructor(\n\t\t@INotebookKernelService _notebookKernelService: INotebookKernelService,\n\t\t@IProductService _productService: IProductService,\n\t\t@IQuickInputService _quickInputService: IQuickInputService,\n\t\t@ILabelService _labelService: ILabelService,\n\t\t@ILogService _logService: ILogService,\n\t\t@IPaneCompositePartService _paneCompositePartService: IPaneCompositePartService,\n\t\t@IExtensionsWorkbenchService _extensionWorkbenchService: IExtensionsWorkbenchService,\n\t\t@IExtensionService _extensionService: IExtensionService,\n\t\t@ICommandService _commandService: ICommandService,\n\t\t@INotebookKernelHistoryService private readonly _notebookKernelHistoryService: INotebookKernelHistoryService,\n\t\t@IOpenerService private readonly _openerService: IOpenerService\n\n\t) {\n\t\tsuper(\n\t\t\t_notebookKernelService,\n\t\t\t_productService,\n\t\t\t_quickInputService,\n\t\t\t_labelService,\n\t\t\t_logService,\n\t\t\t_paneCompositePartService,\n\t\t\t_extensionWorkbenchService,\n\t\t\t_extensionService,\n\t\t\t_commandService,\n\t\t);\n\t}\n\n\tprotected _getKernelPickerQuickPickItems(notebookTextModel: NotebookTextModel, matchResult: INotebookKernelMatchResult, notebookKernelService: INotebookKernelService, scopedContextKeyService: IContextKeyService): QuickPickInput<KernelQuickPickItem>[] {\n\t\tconst quickPickItems: QuickPickInput<KernelQuickPickItem>[] = [];\n\n\t\tif (matchResult.selected) {\n\t\t\tconst kernelItem = toKernelQuickPick(matchResult.selected, matchResult.selected);\n\t\t\tquickPickItems.push(kernelItem);\n\t\t}\n\n\t\tmatchResult.suggestions.filter(kernel => kernel.id !== matchResult.selected?.id).map(kernel => toKernelQuickPick(kernel, matchResult.selected))\n\t\t\t.forEach(kernel => {\n\t\t\t\tquickPickItems.push(kernel);\n\t\t\t});\n\n\t\tconst shouldAutoRun = quickPickItems.length === 0;\n\n\t\tif (quickPickItems.length > 0) {\n\t\t\tquickPickItems.push({\n\t\t\t\ttype: 'separator'\n\t\t\t});\n\t\t}\n\n\t\t// select another kernel quick pick\n\t\tquickPickItems.push({\n\t\t\tid: 'selectAnother',\n\t\t\tlabel: localize('selectAnotherKernel.more', \"Select Another Kernel...\"),\n\t\t\tautoRun: shouldAutoRun\n\t\t});\n\n\t\treturn quickPickItems;\n\t}\n\n\tprotected override _selecteKernel(notebook: NotebookTextModel, kernel: INotebookKernel): void {\n\t\tconst currentInfo = this._notebookKernelService.getMatchingKernel(notebook);\n\t\tif (currentInfo.selected) {\n\t\t\t// there is already a selected kernel\n\t\t\tthis._notebookKernelHistoryService.addMostRecentKernel(currentInfo.selected);\n\t\t}\n\t\tsuper._selecteKernel(notebook, kernel);\n\t\tthis._notebookKernelHistoryService.addMostRecentKernel(kernel);\n\t}\n\n\tprotected override _getMatchingResult(notebook: NotebookTextModel): INotebookKernelMatchResult {\n\t\tconst { selected, all } = this._notebookKernelHistoryService.getKernels(notebook);\n\t\tconst matchingResult = this._notebookKernelService.getMatchingKernel(notebook);\n\t\treturn {\n\t\t\tselected: selected,\n\t\t\tall: matchingResult.all,\n\t\t\tsuggestions: all,\n\t\t\thidden: []\n\t\t};\n\t}\n\n\tprotected override async _handleQuickPick(editor: IActiveNotebookEditor, pick: KernelQuickPickItem, items: KernelQuickPickItem[]): Promise<boolean> {\n\t\tif (pick.id === 'selectAnother') {\n\t\t\treturn this.displaySelectAnotherQuickPick(editor, items.length === 1 && items[0] === pick);\n\t\t}\n\n\t\treturn super._handleQuickPick(editor, pick, items);\n\t}\n\n\tprivate async displaySelectAnotherQuickPick(editor: IActiveNotebookEditor, kernelListEmpty: boolean): Promise<boolean> {\n\t\tconst notebook: NotebookTextModel = editor.textModel;\n\t\tconst disposables = new DisposableStore();\n\t\tconst quickPick = this._quickInputService.createQuickPick<KernelQuickPickItem>();\n\t\tconst quickPickItem = await new Promise<KernelQuickPickItem | IQuickInputButton | undefined>(resolve => {\n\t\t\t// select from kernel sources\n\t\t\tquickPick.title = kernelListEmpty ? localize('select', \"Select Kernel\") : localize('selectAnotherKernel', \"Select Another Kernel\");\n\t\t\tquickPick.placeholder = localize('selectKernel.placeholder', \"Type to choose a kernel source\");\n\t\t\tquickPick.busy = true;\n\t\t\tquickPick.buttons = [this._quickInputService.backButton];\n\t\t\tquickPick.show();\n\n\t\t\tdisposables.add(quickPick.onDidTriggerButton(button => {\n\t\t\t\tif (button === this._quickInputService.backButton) {\n\t\t\t\t\tresolve(button);\n\t\t\t\t}\n\t\t\t}));\n\t\t\tquickPick.onDidTriggerItemButton(async (e) => {\n\n\t\t\t\tif (isKernelSourceQuickPickItem(e.item) && e.item.documentation !== undefined) {\n\t\t\t\t\tconst uri = URI.isUri(e.item.documentation) ? URI.parse(e.item.documentation) : await this._commandService.executeCommand(e.item.documentation);\n\t\t\t\t\tvoid this._openerService.open(uri, { openExternal: true });\n\t\t\t\t}\n\t\t\t});\n\t\t\tdisposables.add(quickPick.onDidAccept(async () => {\n\t\t\t\tresolve(quickPick.selectedItems[0]);\n\t\t\t}));\n\t\t\tdisposables.add(quickPick.onDidHide(() => {\n\t\t\t\tresolve(undefined);\n\t\t\t}));\n\n\t\t\tthis._calculdateKernelSources(editor).then(quickPickItems => {\n\t\t\t\tquickPick.items = quickPickItems;\n\t\t\t\tif (quickPick.items.length > 0) {\n\t\t\t\t\tquickPick.busy = false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdisposables.add(Event.debounce<void, void>(\n\t\t\t\tEvent.any(\n\t\t\t\t\tthis._notebookKernelService.onDidChangeSourceActions,\n\t\t\t\t\tthis._notebookKernelService.onDidAddKernel,\n\t\t\t\t\tthis._notebookKernelService.onDidRemoveKernel\n\t\t\t\t),\n\t\t\t\t(last, _current) => last,\n\t\t\t\tKERNEL_PICKER_UPDATE_DEBOUNCE\n\t\t\t)(async () => {\n\t\t\t\tquickPick.busy = true;\n\t\t\t\tconst quickPickItems = await this._calculdateKernelSources(editor);\n\t\t\t\tquickPick.items = quickPickItems;\n\t\t\t\tquickPick.busy = false;\n\t\t\t}));\n\t\t});\n\n\t\tquickPick.hide();\n\t\tdisposables.dispose();\n\n\t\tif (quickPickItem === this._quickInputService.backButton) {\n\t\t\treturn this.showQuickPick(editor, undefined, true);\n\t\t}\n\n\t\tif (quickPickItem) {\n\t\t\tconst selectedKernelPickItem = quickPickItem as KernelQuickPickItem;\n\t\t\tif (isKernelSourceQuickPickItem(selectedKernelPickItem)) {\n\t\t\t\ttry {\n\t\t\t\t\tconst selectedKernelId = await this._executeCommand<string>(notebook, selectedKernelPickItem.command);\n\t\t\t\t\tif (selectedKernelId) {\n\t\t\t\t\t\tconst { all } = await this._getMatchingResult(notebook);\n\t\t\t\t\t\tconst kernel = all.find(kernel => kernel.id === `ms-toolsai.jupyter/${selectedKernelId}`);\n\t\t\t\t\t\tif (kernel) {\n\t\t\t\t\t\t\tawait this._selecteKernel(notebook, kernel);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn this.displaySelectAnotherQuickPick(editor, false);\n\t\t\t\t\t}\n\t\t\t\t} catch (ex) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else if (isKernelPick(selectedKernelPickItem)) {\n\t\t\t\tawait this._selecteKernel(notebook, selectedKernelPickItem.kernel);\n\t\t\t\treturn true;\n\t\t\t} else if (isGroupedKernelsPick(selectedKernelPickItem)) {\n\t\t\t\tawait this._selectOneKernel(notebook, selectedKernelPickItem.source, selectedKernelPickItem.kernels);\n\t\t\t\treturn true;\n\t\t\t} else if (isSourcePick(selectedKernelPickItem)) {\n\t\t\t\t// selected explicilty, it should trigger the execution?\n\t\t\t\ttry {\n\t\t\t\t\tawait selectedKernelPickItem.action.runAction();\n\t\t\t\t\treturn true;\n\t\t\t\t} catch (ex) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else if (isSearchMarketplacePick(selectedKernelPickItem)) {\n\t\t\t\tawait this._showKernelExtension(\n\t\t\t\t\tthis._paneCompositePartService,\n\t\t\t\t\tthis._extensionWorkbenchService,\n\t\t\t\t\tthis._extensionService,\n\t\t\t\t\teditor.textModel.viewType,\n\t\t\t\t\t[]\n\t\t\t\t);\n\t\t\t\treturn true;\n\t\t\t} else if (isInstallExtensionPick(selectedKernelPickItem)) {\n\t\t\t\tawait this._showKernelExtension(\n\t\t\t\t\tthis._paneCompositePartService,\n\t\t\t\t\tthis._extensionWorkbenchService,\n\t\t\t\t\tthis._extensionService,\n\t\t\t\t\teditor.textModel.viewType,\n\t\t\t\t\tselectedKernelPickItem.extensionIds,\n\t\t\t\t\tthis._productService.quality !== 'stable'\n\t\t\t\t);\n\t\t\t\treturn this.displaySelectAnotherQuickPick(editor, false);\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate async _calculdateKernelSources(editor: IActiveNotebookEditor) {\n\t\tconst notebook: NotebookTextModel = editor.textModel;\n\n\t\tconst sourceActionCommands = this._notebookKernelService.getSourceActions(notebook, editor.scopedContextKeyService);\n\t\tconst actions = await this._notebookKernelService.getKernelSourceActions2(notebook);\n\t\tconst matchResult = this._getMatchingResult(notebook);\n\n\t\tif (sourceActionCommands.length === 0 && matchResult.all.length === 0 && actions.length === 0) {\n\t\t\treturn await this._getKernelRecommendationsQuickPickItems(notebook, this._extensionWorkbenchService) ?? [];\n\t\t}\n\n\t\tconst others = matchResult.all.filter(item => item.extension.value !== JUPYTER_EXTENSION_ID);\n\t\tconst quickPickItems: QuickPickInput<KernelQuickPickItem>[] = [];\n\n\t\t// group controllers by extension\n\t\tfor (const group of groupBy(others, (a, b) => a.extension.value === b.extension.value ? 0 : 1)) {\n\t\t\tconst extension = this._extensionService.extensions.find(extension => extension.identifier.value === group[0].extension.value);\n\t\t\tconst source = extension?.displayName ?? extension?.description ?? group[0].extension.value;\n\t\t\tif (group.length > 1) {\n\t\t\t\tquickPickItems.push({\n\t\t\t\t\tlabel: source,\n\t\t\t\t\tkernels: group\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tquickPickItems.push({\n\t\t\t\t\tlabel: group[0].label,\n\t\t\t\t\tkernel: group[0]\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tconst validActions = actions.filter(action => action.command);\n\n\t\tquickPickItems.push(...validActions.map(action => {\n\t\t\tconst buttons = action.documentation ? [{\n\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.info),\n\t\t\t\ttooltip: localize('learnMoreTooltip', 'Learn More'),\n\t\t\t}] : [];\n\t\t\treturn {\n\t\t\t\tid: typeof action.command! === 'string' ? action.command! : action.command!.id,\n\t\t\t\tlabel: action.label,\n\t\t\t\tdescription: action.description,\n\t\t\t\tcommand: action.command,\n\t\t\t\tdocumentation: action.documentation,\n\t\t\t\tbuttons\n\t\t\t};\n\t\t}));\n\n\t\tfor (const sourceAction of sourceActionCommands) {\n\t\t\tconst res: SourcePick = {\n\t\t\t\taction: sourceAction,\n\t\t\t\tpicked: false,\n\t\t\t\tlabel: sourceAction.action.label,\n\t\t\t\ttooltip: sourceAction.action.tooltip\n\t\t\t};\n\n\t\t\tquickPickItems.push(res);\n\t\t}\n\n\t\treturn quickPickItems;\n\t}\n\n\tprivate async _selectOneKernel(notebook: NotebookTextModel, source: string, kernels: INotebookKernel[]) {\n\t\tconst quickPickItems: QuickPickInput<KernelPick>[] = kernels.map(kernel => toKernelQuickPick(kernel, undefined));\n\t\tconst quickPick = this._quickInputService.createQuickPick<KernelQuickPickItem>();\n\t\tquickPick.items = quickPickItems;\n\t\tquickPick.canSelectMany = false;\n\n\t\tquickPick.title = localize('selectKernelFromExtension', \"Select Kernel from {0}\", source);\n\n\t\tquickPick.onDidAccept(async () => {\n\t\t\tif (quickPick.selectedItems && quickPick.selectedItems.length > 0 && isKernelPick(quickPick.selectedItems[0])) {\n\t\t\t\tawait this._selecteKernel(notebook, quickPick.selectedItems[0].kernel);\n\t\t\t}\n\n\t\t\tquickPick.hide();\n\t\t\tquickPick.dispose();\n\t\t});\n\n\t\tquickPick.onDidHide(() => {\n\t\t\tquickPick.dispose();\n\t\t});\n\n\t\tquickPick.show();\n\t}\n\n\tprivate async _executeCommand<T>(notebook: NotebookTextModel, command: string | Command): Promise<T | undefined | void> {\n\t\tconst id = typeof command === 'string' ? command : command.id;\n\t\tconst args = typeof command === 'string' ? [] : command.arguments ?? [];\n\n\t\tif (typeof command === 'string' || !command.arguments || !Array.isArray(command.arguments) || command.arguments.length === 0) {\n\t\t\targs.unshift({\n\t\t\t\turi: notebook.uri,\n\t\t\t\t$mid: MarshalledId.NotebookActionContext\n\t\t\t});\n\t\t}\n\n\t\tif (typeof command === 'string') {\n\t\t\treturn this._commandService.executeCommand(id);\n\t\t} else {\n\t\t\treturn this._commandService.executeCommand(id, ...args);\n\t\t}\n\t}\n\n\tstatic updateKernelStatusAction(notebook: NotebookTextModel, action: IAction, notebookKernelService: INotebookKernelService, notebookKernelHistoryService: INotebookKernelHistoryService) {\n\t\tconst detectionTasks = notebookKernelService.getKernelDetectionTasks(notebook);\n\t\tif (detectionTasks.length) {\n\t\t\tconst info = notebookKernelService.getMatchingKernel(notebook);\n\t\t\taction.enabled = true;\n\t\t\taction.class = ThemeIcon.asClassName(ThemeIcon.modify(executingStateIcon, 'spin'));\n\n\t\t\tif (info.selected) {\n\t\t\t\taction.label = info.selected.label;\n\t\t\t\tconst kernelInfo = info.selected.description ?? info.selected.detail;\n\t\t\t\taction.tooltip = kernelInfo\n\t\t\t\t\t? localize('kernels.selectedKernelAndKernelDetectionRunning', \"Selected Kernel: {0} (Kernel Detection Tasks Running)\", kernelInfo)\n\t\t\t\t\t: localize('kernels.detecting', \"Detecting Kernels\");\n\t\t\t} else {\n\t\t\t\taction.label = localize('kernels.detecting', \"Detecting Kernels\");\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst runningActions = notebookKernelService.getRunningSourceActions(notebook);\n\n\t\tconst updateActionFromSourceAction = (sourceAction: ISourceAction, running: boolean) => {\n\t\t\tconst sAction = sourceAction.action;\n\t\t\taction.class = running ? ThemeIcon.asClassName(ThemeIcon.modify(executingStateIcon, 'spin')) : ThemeIcon.asClassName(selectKernelIcon);\n\t\t\taction.label = sAction.label;\n\t\t\taction.enabled = true;\n\t\t};\n\n\t\tif (runningActions.length) {\n\t\t\treturn updateActionFromSourceAction(runningActions[0] /** TODO handle multiple actions state */, true);\n\t\t}\n\n\t\tconst { selected } = notebookKernelHistoryService.getKernels(notebook);\n\n\t\tif (selected) {\n\t\t\taction.label = selected.label;\n\t\t\taction.class = ThemeIcon.asClassName(selectKernelIcon);\n\t\t\taction.tooltip = selected.description ?? selected.detail ?? '';\n\t\t} else {\n\t\t\taction.label = localize('select', \"Select Kernel\");\n\t\t\taction.class = ThemeIcon.asClassName(selectKernelIcon);\n\t\t\taction.tooltip = '';\n\t\t}\n\t}\n\n\tstatic async resolveKernel(notebook: INotebookTextModel, notebookKernelService: INotebookKernelService, notebookKernelHistoryService: INotebookKernelHistoryService, commandService: ICommandService): Promise<INotebookKernel | undefined> {\n\t\tconst alreadySelected = notebookKernelHistoryService.getKernels(notebook);\n\n\t\tif (alreadySelected.selected) {\n\t\t\treturn alreadySelected.selected;\n\t\t}\n\n\t\tawait commandService.executeCommand(SELECT_KERNEL_ID);\n\t\tconst { selected } = notebookKernelHistoryService.getKernels(notebook);\n\t\treturn selected;\n\t}\n}\n"]}