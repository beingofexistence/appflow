{"version":3,"sources":["vs/workbench/contrib/notebook/browser/viewParts/notebookKernelView.ts"],"names":[],"mappings":"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","file":"notebookKernelView.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ActionViewItem } from 'vs/base/browser/ui/actionbar/actionViewItems';\nimport { Action, IAction } from 'vs/base/common/actions';\nimport { Event } from 'vs/base/common/event';\nimport { localize } from 'vs/nls';\nimport { Action2, MenuId, registerAction2 } from 'vs/platform/actions/common/actions';\nimport { ContextKeyExpr, IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\nimport { IInstantiationService, ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { ThemeIcon } from 'vs/base/common/themables';\nimport { NOTEBOOK_ACTIONS_CATEGORY, SELECT_KERNEL_ID } from 'vs/workbench/contrib/notebook/browser/controller/coreActions';\nimport { getNotebookEditorFromEditorPane, INotebookEditor } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { selectKernelIcon } from 'vs/workbench/contrib/notebook/browser/notebookIcons';\nimport { KernelPickerMRUStrategy, KernelQuickPickContext } from 'vs/workbench/contrib/notebook/browser/viewParts/notebookKernelQuickPickStrategy';\nimport { NotebookTextModel } from 'vs/workbench/contrib/notebook/common/model/notebookTextModel';\nimport { NOTEBOOK_IS_ACTIVE_EDITOR, NOTEBOOK_KERNEL_COUNT } from 'vs/workbench/contrib/notebook/common/notebookContextKeys';\nimport { INotebookKernelHistoryService, INotebookKernelService } from 'vs/workbench/contrib/notebook/common/notebookKernelService';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\n\nfunction getEditorFromContext(editorService: IEditorService, context?: KernelQuickPickContext): INotebookEditor | undefined {\n\tlet editor: INotebookEditor | undefined;\n\tif (context !== undefined && 'notebookEditorId' in context) {\n\t\tconst editorId = context.notebookEditorId;\n\t\tconst matchingEditor = editorService.visibleEditorPanes.find((editorPane) => {\n\t\t\tconst notebookEditor = getNotebookEditorFromEditorPane(editorPane);\n\t\t\treturn notebookEditor?.getId() === editorId;\n\t\t});\n\t\teditor = getNotebookEditorFromEditorPane(matchingEditor);\n\t} else if (context !== undefined && 'notebookEditor' in context) {\n\t\teditor = context?.notebookEditor;\n\t} else {\n\t\teditor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\t}\n\n\treturn editor;\n}\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: SELECT_KERNEL_ID,\n\t\t\tcategory: NOTEBOOK_ACTIONS_CATEGORY,\n\t\t\ttitle: { value: localize('notebookActions.selectKernel', \"Select Notebook Kernel\"), original: 'Select Notebook Kernel' },\n\t\t\ticon: selectKernelIcon,\n\t\t\tf1: true,\n\t\t\tprecondition: NOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.EditorTitle,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\t\t\tContextKeyExpr.notEquals('config.notebook.globalToolbar', true)\n\t\t\t\t),\n\t\t\t\tgroup: 'navigation',\n\t\t\t\torder: -10\n\t\t\t}, {\n\t\t\t\tid: MenuId.NotebookToolbar,\n\t\t\t\twhen: ContextKeyExpr.equals('config.notebook.globalToolbar', true),\n\t\t\t\tgroup: 'status',\n\t\t\t\torder: -10\n\t\t\t}, {\n\t\t\t\tid: MenuId.InteractiveToolbar,\n\t\t\t\twhen: NOTEBOOK_KERNEL_COUNT.notEqualsTo(0),\n\t\t\t\tgroup: 'status',\n\t\t\t\torder: -10\n\t\t\t}],\n\t\t\tdescription: {\n\t\t\t\tdescription: localize('notebookActions.selectKernel.args', \"Notebook Kernel Args\"),\n\t\t\t\targs: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'kernelInfo',\n\t\t\t\t\t\tdescription: 'The kernel info',\n\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t'type': 'object',\n\t\t\t\t\t\t\t'required': ['id', 'extension'],\n\t\t\t\t\t\t\t'properties': {\n\t\t\t\t\t\t\t\t'id': {\n\t\t\t\t\t\t\t\t\t'type': 'string'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t'extension': {\n\t\t\t\t\t\t\t\t\t'type': 'string'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t'notebookEditorId': {\n\t\t\t\t\t\t\t\t\t'type': 'string'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, context?: KernelQuickPickContext): Promise<boolean> {\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\tconst editorService = accessor.get(IEditorService);\n\n\t\tconst editor = getEditorFromContext(editorService, context);\n\n\t\tif (!editor || !editor.hasModel()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet controllerId = context && 'id' in context ? context.id : undefined;\n\t\tlet extensionId = context && 'extension' in context ? context.extension : undefined;\n\n\t\tif (controllerId && (typeof controllerId !== 'string' || typeof extensionId !== 'string')) {\n\t\t\t// validate context: id & extension MUST be strings\n\t\t\tcontrollerId = undefined;\n\t\t\textensionId = undefined;\n\t\t}\n\n\t\tconst notebook = editor.textModel;\n\t\tconst notebookKernelService = accessor.get(INotebookKernelService);\n\t\tconst matchResult = notebookKernelService.getMatchingKernel(notebook);\n\t\tconst { selected } = matchResult;\n\n\t\tif (selected && controllerId && selected.id === controllerId && ExtensionIdentifier.equals(selected.extension, extensionId)) {\n\t\t\t// current kernel is wanted kernel -> done\n\t\t\treturn true;\n\t\t}\n\n\t\tconst wantedKernelId = controllerId ? `${extensionId}/${controllerId}` : undefined;\n\t\tconst strategy = instantiationService.createInstance(KernelPickerMRUStrategy);\n\t\treturn strategy.showQuickPick(editor, wantedKernelId);\n\t}\n});\n\nexport class NotebooKernelActionViewItem extends ActionViewItem {\n\n\tprivate _kernelLabel?: HTMLAnchorElement;\n\n\tconstructor(\n\t\tactualAction: IAction,\n\t\tprivate readonly _editor: { onDidChangeModel: Event<void>; textModel: NotebookTextModel | undefined; scopedContextKeyService?: IContextKeyService } | INotebookEditor,\n\t\t@INotebookKernelService private readonly _notebookKernelService: INotebookKernelService,\n\t\t@INotebookKernelHistoryService private readonly _notebookKernelHistoryService: INotebookKernelHistoryService,\n\t) {\n\t\tsuper(\n\t\t\tundefined,\n\t\t\tnew Action('fakeAction', undefined, ThemeIcon.asClassName(selectKernelIcon), true, (event) => actualAction.run(event)),\n\t\t\t{ label: false, icon: true }\n\t\t);\n\t\tthis._register(_editor.onDidChangeModel(this._update, this));\n\t\tthis._register(_notebookKernelService.onDidAddKernel(this._update, this));\n\t\tthis._register(_notebookKernelService.onDidRemoveKernel(this._update, this));\n\t\tthis._register(_notebookKernelService.onDidChangeNotebookAffinity(this._update, this));\n\t\tthis._register(_notebookKernelService.onDidChangeSelectedNotebooks(this._update, this));\n\t\tthis._register(_notebookKernelService.onDidChangeSourceActions(this._update, this));\n\t\tthis._register(_notebookKernelService.onDidChangeKernelDetectionTasks(this._update, this));\n\t}\n\n\toverride render(container: HTMLElement): void {\n\t\tthis._update();\n\t\tsuper.render(container);\n\t\tcontainer.classList.add('kernel-action-view-item');\n\t\tthis._kernelLabel = document.createElement('a');\n\t\tcontainer.appendChild(this._kernelLabel);\n\t\tthis.updateLabel();\n\t}\n\n\tprotected override updateLabel() {\n\t\tif (this._kernelLabel) {\n\t\t\tthis._kernelLabel.classList.add('kernel-label');\n\t\t\tthis._kernelLabel.innerText = this._action.label;\n\t\t\tthis._kernelLabel.title = this._action.tooltip;\n\t\t}\n\t}\n\n\tprotected _update(): void {\n\t\tconst notebook = this._editor.textModel;\n\n\t\tif (!notebook) {\n\t\t\tthis._resetAction();\n\t\t\treturn;\n\t\t}\n\n\t\tKernelPickerMRUStrategy.updateKernelStatusAction(notebook, this._action, this._notebookKernelService, this._notebookKernelHistoryService);\n\n\t\tthis.updateClass();\n\t}\n\n\tprivate _resetAction(): void {\n\t\tthis._action.enabled = false;\n\t\tthis._action.label = '';\n\t\tthis._action.class = '';\n\t}\n}\n"]}