{"version":3,"sources":["vs/workbench/contrib/notebook/browser/view/cellParts/codeCellRunToolbar.ts"],"names":[],"mappings":"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","file":"codeCellRunToolbar.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ToolBar } from 'vs/base/browser/ui/toolbar/toolbar';\nimport { Action, IAction } from 'vs/base/common/actions';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { MarshalledId } from 'vs/base/common/marshallingIds';\nimport { EditorContextKeys } from 'vs/editor/common/editorContextKeys';\nimport { localize } from 'vs/nls';\nimport { DropdownWithPrimaryActionViewItem } from 'vs/platform/actions/browser/dropdownWithPrimaryActionViewItem';\nimport { createAndFillInActionBarActions } from 'vs/platform/actions/browser/menuEntryActionViewItem';\nimport { IMenu, IMenuService, MenuItemAction } from 'vs/platform/actions/common/actions';\nimport { IContextKeyService, IScopedContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { InputFocusedContext } from 'vs/platform/contextkey/common/contextkeys';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { INotebookCellActionContext } from 'vs/workbench/contrib/notebook/browser/controller/coreActions';\nimport { ICellViewModel, INotebookEditorDelegate } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { CellContentPart } from 'vs/workbench/contrib/notebook/browser/view/cellPart';\nimport { registerCellToolbarStickyScroll } from 'vs/workbench/contrib/notebook/browser/view/cellParts/cellToolbarStickyScroll';\nimport { NOTEBOOK_CELL_EXECUTION_STATE, NOTEBOOK_CELL_LIST_FOCUSED, NOTEBOOK_CELL_TYPE, NOTEBOOK_EDITOR_FOCUSED } from 'vs/workbench/contrib/notebook/common/notebookContextKeys';\n\nexport class RunToolbar extends CellContentPart {\n\tprivate toolbar!: ToolBar;\n\n\tprivate primaryMenu: IMenu;\n\tprivate secondaryMenu: IMenu;\n\n\tconstructor(\n\t\treadonly notebookEditor: INotebookEditorDelegate,\n\t\treadonly contextKeyService: IContextKeyService,\n\t\treadonly cellContainer: HTMLElement,\n\t\treadonly runButtonContainer: HTMLElement,\n\t\t@IMenuService menuService: IMenuService,\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis.primaryMenu = this._register(menuService.createMenu(this.notebookEditor.creationOptions.menuIds.cellExecutePrimary!, contextKeyService));\n\t\tthis.secondaryMenu = this._register(menuService.createMenu(this.notebookEditor.creationOptions.menuIds.cellExecuteToolbar, contextKeyService));\n\t\tthis.createRunCellToolbar(runButtonContainer, cellContainer, contextKeyService);\n\t\tconst updateActions = () => {\n\t\t\tconst actions = this.getCellToolbarActions(this.primaryMenu);\n\t\t\tconst primary = actions.primary[0]; // Only allow one primary action\n\t\t\tthis.toolbar.setActions(primary ? [primary] : []);\n\t\t};\n\t\tupdateActions();\n\t\tthis._register(this.primaryMenu.onDidChange(updateActions));\n\t\tthis._register(this.secondaryMenu.onDidChange(updateActions));\n\t\tthis._register(this.notebookEditor.notebookOptions.onDidChangeOptions(updateActions));\n\t}\n\n\toverride didRenderCell(element: ICellViewModel): void {\n\t\tthis.cellDisposables.add(registerCellToolbarStickyScroll(this.notebookEditor, element, this.runButtonContainer));\n\n\t\tthis.toolbar.context = <INotebookCellActionContext>{\n\t\t\tui: true,\n\t\t\tcell: element,\n\t\t\tnotebookEditor: this.notebookEditor,\n\t\t\t$mid: MarshalledId.NotebookCellActionContext\n\t\t};\n\t}\n\n\tgetCellToolbarActions(menu: IMenu): { primary: IAction[]; secondary: IAction[] } {\n\t\tconst primary: IAction[] = [];\n\t\tconst secondary: IAction[] = [];\n\t\tconst result = { primary, secondary };\n\n\t\tcreateAndFillInActionBarActions(menu, { shouldForwardArgs: true }, result, g => /^inline/.test(g));\n\n\t\treturn result;\n\t}\n\n\tprivate createRunCellToolbar(container: HTMLElement, cellContainer: HTMLElement, contextKeyService: IContextKeyService) {\n\t\tconst actionViewItemDisposables = this._register(new DisposableStore());\n\t\tconst dropdownAction = this._register(new Action('notebook.moreRunActions', localize('notebook.moreRunActionsLabel', \"More...\"), 'codicon-chevron-down', true));\n\n\t\tconst keybindingProvider = (action: IAction) => this.keybindingService.lookupKeybinding(action.id, executionContextKeyService);\n\t\tconst executionContextKeyService = this._register(getCodeCellExecutionContextKeyService(contextKeyService));\n\t\tthis.toolbar = this._register(new ToolBar(container, this.contextMenuService, {\n\t\t\tgetKeyBinding: keybindingProvider,\n\t\t\tactionViewItemProvider: _action => {\n\t\t\t\tactionViewItemDisposables.clear();\n\n\t\t\t\tconst primary = this.getCellToolbarActions(this.primaryMenu).primary[0];\n\t\t\t\tif (!(primary instanceof MenuItemAction)) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst secondary = this.getCellToolbarActions(this.secondaryMenu).secondary;\n\t\t\t\tif (!secondary.length) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst item = this.instantiationService.createInstance(DropdownWithPrimaryActionViewItem,\n\t\t\t\t\tprimary,\n\t\t\t\t\tdropdownAction,\n\t\t\t\t\tsecondary,\n\t\t\t\t\t'notebook-cell-run-toolbar',\n\t\t\t\t\tthis.contextMenuService,\n\t\t\t\t\t{\n\t\t\t\t\t\tgetKeyBinding: keybindingProvider\n\t\t\t\t\t});\n\t\t\t\tactionViewItemDisposables.add(item.onDidChangeDropdownVisibility(visible => {\n\t\t\t\t\tcellContainer.classList.toggle('cell-run-toolbar-dropdown-active', visible);\n\t\t\t\t}));\n\n\t\t\t\treturn item;\n\t\t\t},\n\t\t\trenderDropdownAsChildElement: true\n\t\t}));\n\t}\n}\n\nexport function getCodeCellExecutionContextKeyService(contextKeyService: IContextKeyService): IScopedContextKeyService {\n\t// Create a fake ContextKeyService, and look up the keybindings within this context.\n\tconst executionContextKeyService = contextKeyService.createScoped(document.createElement('div'));\n\tInputFocusedContext.bindTo(executionContextKeyService).set(true);\n\tEditorContextKeys.editorTextFocus.bindTo(executionContextKeyService).set(true);\n\tEditorContextKeys.focus.bindTo(executionContextKeyService).set(true);\n\tEditorContextKeys.textInputFocus.bindTo(executionContextKeyService).set(true);\n\tNOTEBOOK_CELL_EXECUTION_STATE.bindTo(executionContextKeyService).set('idle');\n\tNOTEBOOK_CELL_LIST_FOCUSED.bindTo(executionContextKeyService).set(true);\n\tNOTEBOOK_EDITOR_FOCUSED.bindTo(executionContextKeyService).set(true);\n\tNOTEBOOK_CELL_TYPE.bindTo(executionContextKeyService).set('code');\n\n\treturn executionContextKeyService;\n}\n"]}