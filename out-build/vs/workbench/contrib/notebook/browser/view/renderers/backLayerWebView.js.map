{"version":3,"sources":["vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;;IAuDhG,MAAM,iBAAiB,GAAG,wBAAwB,CAAC;IACnD,MAAM,cAAc,GAAG,aAAa,CAAC;IA8D9B,IAAM,IAAI,GAAV,MAAM,IAA4C,SAAQ,kBAAG;;QAI3D,MAAM,CAAC,CAAC,CAAc,cAAmB;YAChD,IAAI,CAAC,CAAC,KAAgB,IAAI,cAAI,CAAe,mCAAmC,EAAE,cAAc,CAAC,CAAC;YAClG,OAAO,IAAI,CAAC,CAAC,CAAY;QAC1B,CAAC;QAwBD,YACQ,cAA2C,EACjC,CAAU,EACX,gBAAwB,EACxB,WAAgB,EACxB,CAAgC,EACvB,CAAuD,EACvD,CAAqC,EACtC,CAAmC,EACjC,CAAsC,EAC9B,CAAoC,EAChC,CAAwC,EAClD,CAAuC,EAC7C,CAAiC,EAC1B,CAAwC,EACzC,CAAuC,EACzB,CAAqD,EAChE,CAA0C,EAC/C,CAAqC,EAC7B,CAA6C,EACjD,CAAwC,EAC7C,CAAoC,EACvC,CAAiC,EACtB,EAAyC,EACnD,YAAiB,EACb,EAAsC;YAEzD,KAAK,CAAC,YAAY,CAAC,CAAC;YA1Bb,mBAAc,GAAd,cAAc,CAA6B;YACjC,MAAC,GAAD,CAAC,CAAS;YACX,qBAAgB,GAAhB,gBAAgB,CAAQ;YACxB,gBAAW,GAAX,WAAW,CAAK;YACxB,MAAC,GAAD,CAAC,CAA+B;YACvB,MAAC,GAAD,CAAC,CAAsD;YACtC,MAAC,GAAD,CAAC,CAAmB;YACrB,MAAC,GAAD,CAAC,CAAiB;YAChB,MAAC,GAAD,CAAC,CAAoB;YACb,MAAC,GAAD,CAAC,CAAkB;YACf,MAAC,GAAD,CAAC,CAAsB;YACjC,MAAC,GAAD,CAAC,CAAqB;YAC5B,MAAC,GAAD,CAAC,CAAe;YACT,MAAC,GAAD,CAAC,CAAsB;YACxB,MAAC,GAAD,CAAC,CAAqB;YACR,MAAC,GAAD,CAAC,CAAmC;YAC/C,MAAC,GAAD,CAAC,CAAwB;YAC9B,MAAC,GAAD,CAAC,CAAmB;YACZ,MAAC,GAAD,CAAC,CAA2B;YAChC,MAAC,GAAD,CAAC,CAAsB;YAC5B,MAAC,GAAD,CAAC,CAAkB;YACtB,MAAC,GAAD,CAAC,CAAe;YACL,OAAE,GAAF,EAAE,CAAsB;YAE9B,OAAE,GAAF,EAAE,CAAmB;YA9C1D,YAAO,GAAgC,SAAS,CAAC;YACjD,iBAAY,GAAkD,IAAI,GAAG,EAAE,CAAC;YACxE,sCAAiC,GAA8C,IAAI,GAAG,EAAE,CAAC;YACzF,mCAA8B,GAAkD,IAAI,GAAG,EAAE,CAAC;YAClF,MAAC,GAA8E,IAAI,GAAG,EAAE,CAAC;YAExF,yBAAoB,GAAG,IAAI,GAAG,EAAqC,CAAC;YACrE,MAAC,GAAkD,IAAI,GAAG,EAAE,CAAC;YAC7D,MAAC,GAA4D,IAAI,GAAG,EAAE,CAAC;YACvE,MAAC,GAA4C,SAAS,CAAC;YAC9C,MAAC,GAAY,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAA+B,CAAC,CAAC;YACpE,MAAC,GAAgB,IAAI,GAAG,EAAU,CAAC;YACpC,cAAS,GAAmC,IAAI,CAAC,CAAC,CAAU,KAAK,CAAC;YAC1E,MAAC,GAAW,KAAK,CAAC;YAGlB,MAAC,GAAW,IAAI,CAAC;YAGR,MAAC,GAAO,IAAI,CAAC,GAAG,EAAW,CAAC;YA+B5C,IAAI,CAAC,EAAE,CAAuB,yCAAyC,CAAC,CAAC;YAEzE,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YAE7C,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,QAAQ,CAAC;YACrC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;YAEzC,IAAI,CAAC,EAAkB;gBACtB,IAAI,CAAC,CAAC,CAAS,CAAC,CAAiB,CAAC;gBAClC,CAAC,CAAiB,qBAAqB,GAAG,CAAC,UAAU,EAAE,OAAO,EAAE,EAAE;oBACjE,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,CAAC,EAAU;wBACpC,OAAO,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;qBAC9B;oBAED,IAAI,CAAC,EAAE,CAAoB;wBAC1B,yBAAyB,EAAE,IAAI;wBAC/B,IAAI,EAAE,uBAAuB;wBAC7B,UAAU,EAAE,UAAU;wBACtB,OAAO,EAAE,OAAO;qBAChB,CAAC,CAAC;oBAEH,OAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;gBAC9B,CAAC,CAAC;aACF;YAED,IAAI,CAAC,CAAC,CAAS,CAAC,CAA+B,gBAAgB,CAAC,CAAC,CAAC,EAAE;gBACnE,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,CAAW,IAAI,CAAC,EAAE,EAAkB,EAAE,SAAS,CAAC,CAAC;gBACxE,MAAM,WAAW,GAAG,IAAI,CAAC,EAAE,CAAc,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC;gBAC7D,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC,WAAW,CAAC,CAAC;YACpC,CAAC,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,CAAC,CAAS,eAAG,CAAkB,WAAW,CAAC,GAAG,EAAE;gBACpD,IAAI,CAAC,EAAE,CAAoB;oBAC1B,IAAI,EAAE,wBAAwB;oBAC9B,GAAG,EAAE,kBAAkB,EAAE;iBACzB,CAAC,CAAC;YACJ,CAAC,CAAC,CAAC,CAAC;QACL,CAAC;QAED,aAAa,CAAC,OAAgC;YAC7C,IAAI,CAAC,CAAC,GAAS,OAAO,CAAC;YACvB,IAAI,CAAC,EAAE,EAAa,CAAC;YACrB,IAAI,CAAC,EAAE,EAAc,CAAC;QACvB,CAAC;QAEO,EAAE,CAAuB,GAAW;YAC3C,IAAI,CAAC,EAAE,CAAiB,KAAK,CAAC,kBAAkB,EAAE,GAAG,IAAI,CAAC,WAAW,KAAK,IAAI,CAAC,CAAC,OAAQ,GAAG,EAAE,CAAC,CAAC;QAChG,CAAC;QAEO,EAAE;YACT,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,gBAAgB;gBACtB,MAAM,EAAE,IAAI,CAAC,EAAE,EAAe;aAC9B,CAAC,CAAC;QACJ,CAAC;QAEO,EAAE;YACT,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,iBAAiB;gBACvB,OAAO,EAAE;oBACR,kBAAkB,EAAE,IAAI,CAAC,CAAC,CAAO,kBAAkB;iBACnD;gBACD,aAAa,EAAE;oBACd,SAAS,EAAE,IAAI,CAAC,CAAC,CAAO,eAAe;oBACvC,eAAe,EAAE,IAAI,CAAC,CAAC,CAAO,eAAe;oBAC7C,cAAc,EAAE,IAAI,CAAC,CAAC,CAAO,cAAc;iBAC3C;aACD,CAAC,CAAC;QACJ,CAAC;QAEO,EAAE;YACT,OAAO;gBACN,6BAA6B,EAAE,GAAG,IAAI,CAAC,CAAC,CAAO,UAAU,GAAG,IAAI,CAAC,CAAC,CAAO,SAAS,IAAI;gBACtF,uBAAuB,EAAE,eAAe,IAAI,CAAC,CAAC,CAAO,UAAU,GAAG,IAAI,CAAC,CAAC,CAAO,WAAW,GAAG,IAAI,CAAC,CAAC,CAAO,SAAS,KAAK;gBACxH,8BAA8B,EAAE,GAAG,IAAI,CAAC,CAAC,CAAO,iBAAiB,IAAI;gBACrE,qBAAqB,EAAE,GAAG,IAAI,CAAC,CAAC,CAAO,SAAS,IAAI;gBACpD,+BAA+B,EAAE,GAAG,IAAI,CAAC,CAAC,CAAO,kBAAkB,IAAI;gBACvE,+BAA+B,EAAE,GAAG,IAAI,CAAC,CAAC,CAAO,kBAAkB,IAAI;gBACvE,mCAAmC,EAAE,GAAG,IAAI,CAAC,CAAC,CAAO,qBAAqB,IAAI;gBAC9E,8BAA8B,EAAE,GAAG,IAAI,CAAC,CAAC,CAAO,kBAAkB,GAAG,CAAC,IAAI;gBAC1E,2BAA2B,EAAE,OAAO,IAAI,CAAC,CAAC,CAAO,cAAc,KAAK,QAAQ,IAAI,IAAI,CAAC,CAAC,CAAO,cAAc,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAO,cAAc,IAAI,CAAC,CAAC,CAAC,QAAQ,IAAI,CAAC,CAAC,CAAO,QAAQ,WAAW;gBAC/L,gCAAgC,EAAE,GAAG,IAAI,CAAC,CAAC,CAAO,cAAc,IAAI,IAAI,CAAC,CAAC,CAAO,QAAQ,IAAI;gBAC7F,kCAAkC,EAAE,GAAG,IAAI,CAAC,CAAC,CAAO,gBAAgB,IAAI;gBACxE,iCAAiC,EAAE,GAAG,IAAI,CAAC,CAAC,CAAO,gBAAgB,GAAG,IAAI,CAAC,CAAC,CAAO,eAAe,IAAI;gBACtG,kCAAkC,EAAE,IAAI,CAAC,CAAC,CAAO,gBAAgB,IAAI,IAAI,CAAC,CAAC,CAAO,UAAU;gBAC5F,oCAAoC,EAAE,GAAG,CAAC,QAAQ,CAAC,CAAmC,EAAE,IAA2D,CAAC;gBACpJ,wCAAwC,EAAE,GAAG,CAAC,QAAQ,CAAC;oBACtD,GAAG,EAAE,iCAAiC;oBACtC,OAAO,EAAE,CAAC,uCAAuC,CAAC;wEAClD,EAAE,IAA4B,CAAC;gBAChC,4CAA4C,EAAE,GAAG,CAAC,QAAQ,CAAC;oBAC1D,GAAG,EAAE,2CAA2C;oBAChD,OAAO,EAAE,CAAC,uCAAuC,CAAC;4EAClD,EAAE,IAAmC,CAAC;aACvC,CAAC;QACH,CAAC;QAEO,EAAE,CAAc,OAAe;YACtC,MAAM,aAAa,GAAG,IAAI,CAAC,EAAE,EAAe,CAAC;YAC7C,MAAM,YAAY,GAAG,IAAI,CAAC,EAAE,EAAqB,CAAC;YAClD,MAAM,aAAa,GAAG;gBACrB,SAAS,EAAE,IAAI,CAAC,CAAC,CAAO,eAAe;gBACvC,eAAe,EAAE,IAAI,CAAC,CAAC,CAAO,eAAe;gBAC7C,cAAc,EAAE,IAAI,CAAC,CAAC,CAAO,cAAc;aAC3C,CAAC;YACF,MAAM,aAAa,GAAG,IAAA,sBAAI,EACzB;gBACC,GAAG,IAAI,CAAC,CAAC;gBACT,eAAe,EAAE,kBAAkB,EAAE;aACrC,EACD,EAAE,kBAAkB,EAAE,IAAI,CAAC,CAAC,CAAO,kBAAkB,EAAE,EACvD,aAAa,EACb,aAAa,EACb,YAAY,EACZ,IAAI,CAAC,CAAC,CAA+B,kBAAkB,EAAE,EACzD,IAAI,CAAC,CAAC,CAAK,CAAC;YAEb,MAAM,SAAS,GAAG,IAAI,CAAC,CAAC,CAAoB,QAAQ,CAAC,iCAAiC,CAAC,CAAC;YACxF,MAAM,gBAAgB,GAAG,IAAI,CAAC,CAAC,CAAQ,mBAAG,CAAa,CAAC;YACxD,MAAM,kBAAkB,GAAG,IAAI,CAAC,CAAC,CAAQ,mBAAG,CAAsB,CAAC;YACnE,OAAO,UAAU,CAAA;;;;kBAID,OAAO;MACnB,SAAS,CAAC,CAAC;gBACb;;kBAEc,cAAI;iBACL,cAAI;eACN,cAAI;gBACH,cAAI;;;OAGb,CAAC,CAAC,CAAC,EAAE;oBACQ,IAAI,CAAC,CAAC;;mEAEyC,kBAAkB;;;;4EAIT,gBAAgB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;4BAuIhE,aAAa;;UAE/B,CAAC;QACV,CAAC;QAEO,EAAE;YACT,OAAO,IAAI,CAAC,CAAC,CAAe,YAAY,EAAE,CAAC,GAAG,CAAC,CAAC,QAAQ,EAAoB,EAAE;gBAC7E,MAAM,UAAU,GAAG;oBAClB,OAAO,EAAE,QAAQ,CAAC,UAAU,CAAC,OAAO;oBACpC,IAAI,EAAE,IAAI,CAAC,EAAE,CAAW,QAAQ,CAAC,UAAU,CAAC,IAAI,EAAE,QAAQ,CAAC,iBAAiB,CAAC,CAAC,QAAQ,EAAE;iBACxF,CAAC;gBACF,OAAO;oBACN,EAAE,EAAE,QAAQ,CAAC,EAAE;oBACf,UAAU;oBACV,SAAS,EAAE,QAAQ,CAAC,SAAS;oBAC7B,SAAS,EAAE,QAAQ,CAAC,SAAS,8CAAgC;oBAC7D,SAAS,EAAE,QAAQ,CAAC,SAAS;iBAC7B,CAAC;YACH,CAAC,CAAC,CAAC;QACJ,CAAC;QAEO,EAAE;YACT,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAe,iBAAiB,CAAC,IAAI,CAAC,gBAAgB,CAAC,EAAE,OAAO,CAAC,EAAE;gBAC1F,OAAO,EAAE,UAAU,EAAE,IAAI,CAAC,EAAE,CAAW,OAAO,CAAC,UAAU,EAAE,OAAO,CAAC,iBAAiB,CAAC,CAAC,QAAQ,EAAE,CAAC,QAAQ,EAAE,EAAE,CAAC;YAC/G,CAAC,CAAC,CAAC;QACJ,CAAC;QAEO,EAAE,CAAW,GAAQ,EAAE,aAA8B;YAC5D,OAAO,IAAA,cAAI,EAAS,GAAG,EAAE,aAAa,EAAE,MAAM,KAAK,iBAAO,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,SAAS,EAAE,aAAa,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC;QAC/I,CAAC;QAED,iBAAiB,CAAC,OAAY;YAC7B,IAAI,CAAC,EAAE,CAAoB;gBAC1B,yBAAyB,EAAE,IAAI;gBAC/B,IAAI,EAAE,qBAAqB;gBAC3B,OAAO;aACP,CAAC,CAAC;QACJ,CAAC;QAEO,EAAE,CAAc,EAAU;YACjC,MAAM,MAAM,GAAG,IAAI,CAAC,CAAC,CAAoB,GAAG,CAAC,EAAE,CAAC,CAAC;YACjD,IAAI,CAAC,MAAM,EAAE;gBACZ,OAAO;aACP;YAED,MAAM,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAE,CAAC,QAAQ,CAAC;YACzD,OAAO,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC;QAC7B,CAAC;QAED,UAAU;YACT,OAAO,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;QACvB,CAAC;QAED,aAAa;YACZ,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,CAAW,IAAI,CAAC,EAAE,EAAkB,EAAE,SAAS,CAAC,CAAC;YACxE,MAAM,WAAW,GAAG,IAAI,CAAC,EAAE,CAAc,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC;YAC7D,OAAO,IAAI,CAAC,EAAE,CAAU,WAAW,CAAC,CAAC;QACtC,CAAC;QAEO,EAAE;YACT,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,KAAK,iBAAO,CAAC,QAAQ,EAAE;gBACjD,MAAM,MAAM,GAAG,IAAI,CAAC,CAAC,CAAuB,kBAAkB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;gBACjF,IAAI,MAAM,EAAE;oBACX,OAAO,MAAM,CAAC,GAAG,CAAC;iBAClB;gBAED,MAAM,OAAO,GAAG,IAAI,CAAC,CAAC,CAAuB,YAAY,EAAE,CAAC,OAAO,CAAC;gBACpE,IAAI,OAAO,CAAC,MAAM,EAAE;oBACnB,OAAO,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;iBACtB;aACD;YAED,OAAO,IAAA,eAAG,EAAK,IAAI,CAAC,WAAW,CAAC,CAAC;QAClC,CAAC;QAEO,EAAE;YACT,sDAAsD;YACtD,kEAAkE;YAClE,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;gBAC5D,OAAO,EAAE,CAAC;aACV;YAED,IAAI,aAAE,EAAK;gBACV,OAAO,EAAE,CAAC,CAAC,oBAAoB;aAC/B;YAED,OAAO;gBACN,IAAA,eAAG,EAAK,aAAG,CAAQ,SAAS,CAAC,cAAc,CAAC,CAAC;aAC7C,CAAC;QACH,CAAC;QAEO,EAAE,CAAU,OAAe;YAClC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;gBAC1C,MAAM,IAAI,KAAK,CAAC,+CAA+C,CAAC,CAAC;aACjE;YAED,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,EAAE,CAAW,IAAI,CAAC,CAAC,EAAe,OAAO,CAAC,CAAC;YAC/D,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACnC,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,OAAO,CAAC,CAAC;YAE7B,IAAI,CAAC,CAAC,CAAS,IAAI,+BAAI,CAAqB,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;YAEjE,MAAM,iBAAiB,GAAG,IAAI,WAAG,EAAoB,CAAC;YAEtD,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE;gBAC5C,iBAAiB,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,iCAAiC,CAAC,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC;YACnF,CAAC,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,KAAK,EAAE,OAAO,EAAE,EAAE;gBACvD,MAAM,IAAI,GAA2E,OAAO,CAAC,OAAO,CAAC;gBACrG,IAAI,IAAI,CAAC,CAAC,EAAU;oBACnB,OAAO;iBACP;gBAED,IAAI,CAAC,IAAI,CAAC,yBAAyB,EAAE;oBACpC,OAAO;iBACP;gBAED,QAAQ,IAAI,CAAC,IAAI,EAAE;oBAClB,KAAK,aAAa,CAAC,CAAC;wBACnB,iBAAiB,CAAC,QAAQ,EAAE,CAAC;wBAC7B,IAAI,CAAC,EAAE,EAAsB,CAAC;wBAC9B,MAAM;qBACN;oBACD,KAAK,mBAAmB,CAAC,CAAC;wBACzB,IAAI,IAAI,CAAC,CAAC,EAAwB,SAAS,KAAK,IAAI,CAAC,SAAS,EAAE;4BAC/D,IAAI,CAAC,CAAC,EAAwB,CAAC,CAAC,QAAQ,EAAE,CAAC;4BAC3C,IAAI,CAAC,CAAC,GAAyB,SAAS,CAAC;yBACzC;wBACD,MAAM;qBACN;oBACD,KAAK,WAAW,CAAC,CAAC;wBACjB,KAAK,MAAM,MAAM,IAAI,IAAI,CAAC,OAAO,EAAE;4BAClC,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;4BAC7B,IAAI,MAAM,CAAC,QAAQ,EAAE;gCACpB,MAAM,cAAc,GAAG,IAAI,CAAC,EAAE,CAAc,MAAM,CAAC,EAAE,CAAC,CAAC;gCACvD,IAAI,cAAc,EAAE;oCACnB,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,cAAc,CAAC;oCAC5C,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,mBAAmB,CAAC,CAAC;oCACrG,IAAI,CAAC,cAAc,CAAC,uBAAuB,CAAC,QAAQ,EAAE,MAAM,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;iCACzE;qCAAM,IAAI,MAAM,CAAC,IAAI,EAAE;oCACvB,qCAAqC;oCACrC,MAAM,aAAa,GAAG,IAAI,CAAC,CAAC,CAAsC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;oCACjF,IAAI,aAAa,EAAE;wCAClB,MAAM,KAAK,GAAG,IAAI,CAAC,8BAA8B,CAAC,GAAG,CAAC,aAAa,CAAE,CAAC;wCAEtE,4BAA4B;wCAC5B,IAAI,CAAC,iCAAiC,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;wCAC7D,IAAI,CAAC,iCAAiC,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;wCAE7D,MAAM,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC;wCAChC,IAAI,CAAC,CAAC,CAAoB,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,aAAa,CAAC,CAAC;wCACxD,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;wCAC5C,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC,QAAQ,EAAE,aAAa,EAAE,MAAM,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,mBAAmB,CAAC,CAAC;wCAC5G,IAAI,CAAC,cAAc,CAAC,uBAAuB,CAAC,QAAQ,EAAE,MAAM,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;qCAEzE;oCAED,IAAI,CAAC,CAAC,CAAsC,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;iCAC9D;gCAED;oCACC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE;wCACjB,SAAS;qCACT;oCAED,MAAM,MAAM,GAAG,IAAI,CAAC,CAAC,CAAoB,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;oCAExD,IAAI,CAAC,MAAM,EAAE;wCACZ,SAAS;qCACT;oCAED,MAAM,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAE,CAAC;oCAC7C,KAAK,CAAC,WAAW,GAAG,IAAI,CAAC;iCACzB;6BACD;iCAAM;gCACN,IAAI,CAAC,cAAc,CAAC,sBAAsB,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;6BAC7E;yBACD;wBACD,MAAM;qBACN;oBACD,KAAK,YAAY,CAAC,CAAC;wBAClB,MAAM,cAAc,GAAG,IAAI,CAAC,EAAE,CAAc,IAAI,CAAC,EAAE,CAAC,CAAC;wBACrD,IAAI,cAAc,EAAE;4BACnB,MAAM,UAAU,GAAG,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;4BAC9E,IAAI,UAAU,EAAE;gCACf,UAAU,CAAC,eAAe,GAAG,IAAI,CAAC;6BAClC;yBACD;wBACD,MAAM;qBACN;oBACD,KAAK,YAAY,CAAC,CAAC;wBAClB,MAAM,cAAc,GAAG,IAAI,CAAC,EAAE,CAAc,IAAI,CAAC,EAAE,CAAC,CAAC;wBACrD,IAAI,cAAc,EAAE;4BACnB,MAAM,UAAU,GAAG,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;4BAC9E,IAAI,UAAU,EAAE;gCACf,UAAU,CAAC,eAAe,GAAG,KAAK,CAAC;6BACnC;yBACD;wBACD,MAAM;qBACN;oBACD,KAAK,aAAa,CAAC,CAAC;wBACnB,MAAM,cAAc,GAAG,IAAI,CAAC,EAAE,CAAc,IAAI,CAAC,EAAE,CAAC,CAAC;wBACrD,IAAI,cAAc,EAAE;4BACnB,MAAM,UAAU,GAAG,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;4BAC9E,IAAI,UAAU,EAAE;gCACf,UAAU,CAAC,eAAe,GAAG,IAAI,CAAC;gCAClC,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,UAAU,EAAE,QAAQ,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;6BAClF;yBACD;wBACD,MAAM;qBACN;oBACD,KAAK,YAAY,CAAC,CAAC;wBAClB,MAAM,cAAc,GAAG,IAAI,CAAC,EAAE,CAAc,IAAI,CAAC,EAAE,CAAC,CAAC;wBACrD,IAAI,cAAc,EAAE;4BACnB,MAAM,UAAU,GAAG,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;4BAC9E,IAAI,UAAU,EAAE;gCACf,UAAU,CAAC,eAAe,GAAG,KAAK,CAAC;6BACnC;yBACD;wBACD,MAAM;qBACN;oBACD,KAAK,YAAY,CAAC,CAAC;wBAClB,2BAA2B;wBAC3B,6BAA6B;wBAC7B,+IAA+I;wBAC/I,MAAM;qBACN;oBACD,KAAK,kBAAkB,CAAC,CAAC;wBACxB,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,GAAG,uBAAI,CAAsB,CAAC;wBAC7E,MAAM;qBACN;oBACD,KAAK,kBAAkB,CAAC,CAAC;wBACxB,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC;4BACjC,GAAG,IAAI,CAAC,OAAO;4BACf,cAAc,EAAE,GAAG,EAAE,GAAG,CAAC;4BACzB,eAAe,EAAE,GAAG,EAAE,GAAG,CAAC;yBAC1B,CAAC,CAAC;wBACH,MAAM;qBACN;oBACD,KAAK,cAAc,CAAC,CAAC;wBACpB,MAAM,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBAC1D,IAAI,IAAI,EAAE;4BACT,IAAI,IAAI,CAAC,SAAS,EAAE;gCACnB,IAAI,CAAC,cAAc,CAAC,qBAAqB,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;6BAC1D;iCAAM;gCACN,MAAM,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;6BAC5D;yBACD;wBACD,MAAM;qBACN;oBACD,KAAK,kBAAkB,CAAC,CAAC;wBACxB,IAAI,CAAC,EAAE,CAAkB,IAAI,CAAC,CAAC;wBAC/B,MAAM;qBACN;oBACD,KAAK,cAAc,CAAC,CAAC;wBACpB,IAAI,IAAA,YAAG,EAAW,IAAI,CAAC,IAAI,EAAE,iBAAO,CAAC,OAAO,CAAC,EAAE;4BAC9C,MAAM,GAAG,GAAG,SAAG,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;4BAEjC,IAAI,GAAG,CAAC,IAAI,KAAK,kCAAkC,EAAE;gCACpD,MAAM,QAAQ,GAAG,GAAG,CAAC,KAAK,CAAC;gCAC3B,MAAM,KAAK,GAAG,IAAI,CAAC,CAAC,CAAkB,WAAW,CAAC;gCAClD,IAAI,KAAK,EAAE;oCACV,IAAI,KAAK,CAAC,YAAY,EAAE;wCACvB,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;qCACpC;iCACD;gCAED,IAAI,CAAC,CAAC,CAAa,IAAI,CAAC,wBAAO,CAAC,qBAAqB,CAAC,IAAI,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC,CAAC;gCACnF,OAAO;6BACP;4BACD,IAAI,GAAG,CAAC,IAAI,KAAK,4BAA4B,EAAE;gCAC9C,MAAM,QAAQ,GAAG,GAAG,CAAC,KAAK,CAAC;gCAC3B,MAAM,IAAI,GAAG,IAAI,CAAC,CAAC,CAAoB,GAAG,CAAC,QAAQ,CAAC,CAAC;gCAErD,IAAI,IAAI,EAAE;oCACT,IAAI,CAAC,EAAE,CAAe,UAAU,CAC9B,yBAAyB,EAAE,EAAE,EAAE,EAAE,qCAAqC,EAAE,IAAI,EAAE,YAAY,EAAE,CAAC,CAAC;oCAEhG,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE;wCACnD,IAAI,EAAE,CAAC,KAAK,CAAC,QAAQ,EAAE;4CACtB,EAAE,CAAC,KAAK,CAAC,QAAQ,CAAC,YAAY,CAAC,GAAG,IAAI,CAAC;4CACvC,EAAE,CAAC,aAAa,EAAE,CAAC;yCACnB;oCACF,CAAC,CAAC,CAAC;iCACH;gCAED,OAAO;6BACP;4BAED,0CAA0C;4BAC1C,IAAI,CAAC,CAAC,CAAa,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;gCAClC,eAAe,EAAE,IAAI;gCACrB,aAAa,EAAE,IAAI;gCACnB,aAAa,EAAE;oCACd,uBAAuB;oCACvB,6BAA6B;oCAC7B,+BAA+B;oCAC/B,wBAAwB;oCACxB,8DAA8D;oCAC9D,oBAAoB;iCACpB;6BACD,CAAC,CAAC;4BACH,OAAO;yBACP;wBAED,IAAI,IAAA,YAAG,EAAe,IAAI,CAAC,IAAI,EAAE,iBAAO,CAAC,IAAI,EAAE,iBAAO,CAAC,KAAK,EAAE,iBAAO,CAAC,MAAM,CAAC,EAAE;4BAC9E,IAAI,CAAC,CAAC,CAAa,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,eAAe,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC;yBACnF;6BAAM,IAAI,IAAA,YAAG,EAAW,IAAI,CAAC,IAAI,EAAE,iBAAO,CAAC,kBAAkB,CAAC,EAAE;4BAChE,MAAM,GAAG,GAAG,SAAG,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;4BACjC,IAAI,CAAC,EAAE,CAA0B,GAAG,CAAC,CAAC;yBACtC;6BAAM,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;4BACxC,0CAA0C;4BAC1C,IAAI,CAAC,EAAE,CAAqB,qBAAqB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;yBAC9D;6BAAM;4BACN,kBAAkB;4BAClB,IAAI,MAAM,CAAC,GAAG,CAAQ,IAAI,CAAC,IAAI,CAAC,EAAE;gCACjC,IAAI,CAAC,EAAE,CAAO,SAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;6BACnC;iCAAM;gCACN,IAAI,CAAC,EAAE,CAAO,SAAG,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;6BACpC;yBACD;wBACD,MAAM;qBACN;oBACD,KAAK,qBAAqB,CAAC,CAAC;wBAC3B,IAAI,CAAC,CAAC,CAAU,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;wBAChD,MAAM;qBACN;oBACD,KAAK,uBAAuB,CAAC,CAAC;wBAC7B,IAAI,CAAC,CAAC,EAAkB,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;wBACnE,MAAM;qBACN;oBACD,KAAK,iBAAiB,CAAC,CAAC;wBACvB,MAAM,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBAC1D,IAAI,IAAI,EAAE;4BACT,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,aAAE,CAAU,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;gCACjE,mBAAmB;gCACnB,IAAI,CAAC,cAAc,CAAC,2BAA2B,CAAC,IAAI,EAAE,kBAAkB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;6BACxF;iCAAM;gCACN,eAAe;gCACf,MAAM,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,IAAI,EAAE,WAAW,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;6BACrF;yBACD;wBACD,MAAM;qBACN;oBACD,KAAK,uBAAuB,CAAC,CAAC;wBAC7B,MAAM,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBAC1D,IAAI,IAAI,EAAE;4BACT,uBAAuB;4BACvB,MAAM,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,IAAI,EAAE,WAAW,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;4BAErF,6BAA6B;4BAC7B,MAAM,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,qBAAqB,EAAE,CAAC;4BACzD,IAAI,CAAC,CAAC,CAAkB,eAAe,CAAC;gCACvC,MAAM,EAAE,aAAG,CAAI,iBAAiB;gCAChC,iBAAiB,EAAE,IAAI,CAAC,CAAC;gCACzB,SAAS,EAAE,GAAG,EAAE,CAAC,CAAC;oCACjB,CAAC,EAAE,WAAW,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO;oCAC/B,CAAC,EAAE,WAAW,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO;iCAC/B,CAAC;6BACF,CAAC,CAAC;yBACH;wBACD,MAAM;qBACN;oBACD,KAAK,qBAAqB,CAAC,CAAC;wBAC3B,MAAM,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBAC1D,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,UAAU,EAAE;4BAC5D,IAAI,CAAC,cAAc,CAAC,sBAAsB,CAAC,IAAI,CAAC,MAAM,EAAE,+BAAa,CAAC,OAAO,CAAC,CAAC;4BAC/E,MAAM,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,IAAI,EAAE,QAAQ,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;yBAClF;wBACD,MAAM;qBACN;oBACD,KAAK,sBAAsB,CAAC,CAAC;wBAC5B,MAAM,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBAC1D,IAAI,IAAI,YAAY,0BAAI,EAAiB;4BACxC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;yBAC1B;wBACD,MAAM;qBACN;oBACD,KAAK,sBAAsB,CAAC,CAAC;wBAC5B,MAAM,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBAC1D,IAAI,IAAI,YAAY,0BAAI,EAAiB;4BACxC,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;yBAC3B;wBACD,MAAM;qBACN;oBACD,KAAK,iBAAiB,CAAC,CAAC;wBACvB,IAAI,CAAC,cAAc,CAAC,sBAAsB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;wBAC9D,MAAM;qBACN;oBACD,KAAK,WAAW,CAAC,CAAC;wBACjB,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;wBACzD,MAAM;qBACN;oBACD,KAAK,WAAW,CAAC,CAAC;wBACjB,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,IAAI,CAAC,MAAM,EAAE;4BAClD,WAAW,EAAE,IAAI,CAAC,WAAW;4BAC7B,OAAO,EAAE,IAAI,CAAC,OAAO;4BACrB,MAAM,EAAE,IAAI,CAAC,MAAM;yBACnB,CAAC,CAAC;wBACH,MAAM;qBACN;oBACD,KAAK,eAAe,CAAC,CAAC;wBACrB,IAAI,CAAC,cAAc,CAAC,oBAAoB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBACtD,MAAM;qBACN;oBACD,KAAK,gBAAgB,CAAC,CAAC;wBACtB,MAAM,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBAC1D,IAAI,IAAI,YAAY,0BAAI,EAAiB;4BACxC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,IAAI,CAAC;yBAC9B;wBAED,IAAI,CAAC,EAAE,CAAwB,IAAI,CAAC,UAAU,CAAC,CAAC;wBAChD,MAAM;qBACN;oBACD,KAAK,oBAAoB,CAAC,CAAC;wBAC1B,IAAI,CAAC,EAAE,CAAwB,IAAI,CAAC,UAAU,CAAC,CAAC;wBAChD,MAAM;qBACN;oBACD,KAAK,eAAe,CAAC,CAAC;wBACrB,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBACjD,MAAM;qBACN;oBACD,KAAK,eAAe,CAAC,CAAC;wBACrB,MAAM,cAAc,GAAG,IAAI,CAAC,EAAE,CAAc,IAAI,CAAC,QAAQ,CAAC,CAAC;wBAC3D,MAAM,MAAM,GAAG,cAAc,EAAE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,CAAC,CAAC;wBAE9F,IAAI,CAAC,EAAE,CAAoB;4BAC1B,IAAI,EAAE,kBAAkB;4BACxB,SAAS,EAAE,IAAI,CAAC,SAAS;4BACzB,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,UAAU,EAAE,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,SAAS;yBAClF,CAAC,CAAC;wBACH,MAAM;qBACN;oBACD,KAAK,yBAAyB,CAAC,CAAC;wBAC/B,IAAI,CAAC,EAAE,CAAuB,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;wBAC7G,MAAM;qBACN;oBACD,KAAK,4BAA4B,CAAC,CAAC;wBAClC,IAAI,CAAC,cAAc,CAAC,yBAAyB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;wBAC7G,MAAM;qBACN;oBACD,KAAK,kBAAkB,CAAC,CAAC;wBACxB,IAAI,CAAC,cAAc,CAAC,yBAAyB,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;qBACjE;iBACD;YACF,CAAC,CAAC,CAAC,CAAC;YAEJ,OAAO,iBAAiB,CAAC,CAAC,CAAC;QAC5B,CAAC;QAEO,EAAE,CAA0B,GAAQ;YAC3C,MAAM,SAAS,GAAG,eAAe,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YACrD,IAAI,SAAS,EAAE;gBACd,MAAM,gBAAgB,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;gBACpD,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,EAAE;oBAC7B,MAAM,UAAU,GAAG,gBAAgB,GAAG,CAAC,CAAC;oBACxC,MAAM,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,EAAE,SAAS,CAAC,KAAK,CAAC,CAAC;oBAE5D,8BAA8B;oBAC9B,MAAM,aAAa,GAAuB;wBACzC,SAAS,EAAE,EAAE,eAAe,EAAE,UAAU,EAAE,WAAW,EAAE,CAAC,EAAE,aAAa,EAAE,UAAU,EAAE,SAAS,EAAE,CAAC,EAAE;qBACnG,CAAC;oBACF,IAAI,CAAC,CAAC,CAAa,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,CAAC,EAAE;wBAC/C,eAAe,EAAE,IAAI;wBACrB,aAAa,EAAE,IAAI;wBACnB,aAAa,EAAE,aAAa;qBAC5B,CAAC,CAAC;oBACH,OAAO;iBACP;aACD;YAED,IAAI,CAAC,CAAC,CAAa,IAAI,CAAC,GAAG,EAAE,EAAE,eAAe,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC;YAC7E,OAAO,GAAG,CAAC;QACZ,CAAC;QAEO,EAAE,CAAqB,IAAY;YAC1C,IAAI,UAAU,GAAoB,SAAS,CAAC;YAC5C,IAAI,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE;gBACzB,UAAU,GAAG,SAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;aAC7B;iBAAM,IAAI,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE;gBAChC,MAAM,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAW,gBAAgB,CAAC;gBACnD,IAAI,QAAQ,EAAE;oBACb,UAAU,GAAG,SAAG,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAE,QAAQ,CAAC,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;iBACxE;aACD;iBAAM;gBACN,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,KAAK,iBAAO,CAAC,QAAQ,EAAE;oBACjD,MAAM,OAAO,GAAG,IAAI,CAAC,CAAC,CAAuB,YAAY,EAAE,CAAC,OAAO,CAAC;oBACpE,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;wBACpB,OAAO;qBACP;oBACD,UAAU,GAAG,SAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;iBAChD;qBAAM;oBACN,wCAAwC;oBACxC,UAAU,GAAG,SAAG,CAAC,QAAQ,CAAC,IAAA,eAAG,EAAK,IAAI,CAAC,WAAW,CAAC,EAAE,IAAI,CAAC,CAAC;iBAC3D;aACD;YAED,IAAI,UAAU,EAAE;gBACf,IAAI,CAAC,EAAE,CAAO,UAAU,CAAC,CAAC;aAC1B;QACF,CAAC;QAEO,EAAE,CAAO,GAAQ;YACxB,IAAI,UAAU,GAAuB,SAAS,CAAC;YAC/C,IAAI,MAAM,GAAuB,SAAS,CAAC;YAC3C,MAAM,OAAO,GAAG,iBAAiB,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YACjD,IAAI,OAAO,EAAE;gBACZ,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC;oBACd,IAAI,EAAE,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,OAAO,CAAC,KAAK,CAAC;oBACtC,QAAQ,EAAE,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE;iBACnC,CAAC,CAAC;gBACH,UAAU,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;gBACtC,MAAM,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;aAClC;YAED,oDAAoD;YACpD,MAAM,SAAS,GAAG,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YACjD,IAAI,SAAS,EAAE;gBACd,MAAM,gBAAgB,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;gBACpD,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,EAAE;oBAC7B,UAAU,GAAG,gBAAgB,GAAG,CAAC,CAAC;oBAClC,MAAM,GAAG,CAAC,CAAC;oBACX,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,IAAI,UAAU,EAAE,EAAE,CAAC,CAAC;iBAC/C;aACD;YAED,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC;gBACd,KAAK,EAAE,IAAI;aACX,CAAC,CAAC;YACH,YAAY;YAEZ,IAAI,KAAK,GAA6D,SAAS,CAAC;YAEhF,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,CAAC,CAAkB,MAAM,EAAE;gBACnD,MAAM,WAAW,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,IAAI,IAAA,eAAG,EAAK,MAAM,CAAC,QAAQ,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC,CAAC;gBACzG,IAAI,WAAW,EAAE;oBAChB,KAAK,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,WAAW,EAAE,CAAC;oBACvC,MAAM;iBACN;aACD;YAED,IAAI,KAAK,EAAE;gBACV,KAAK,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK,CAAC,MAAM,EAAE,UAAU,KAAK,SAAS,IAAI,MAAM,KAAK,SAAS,CAAC,CAAC,CAAqB,EAAE,SAAS,EAAE,EAAE,eAAe,EAAE,UAAU,EAAE,WAAW,EAAE,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC;aAC7L;iBAAM;gBACN,IAAI,CAAC,CAAC,CAAa,IAAI,CAAC,GAAG,EAAE,EAAE,eAAe,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC;aAC7E;QACF,CAAC;QAEO,EAAE,CAAwB,UAAqD;YACtF,KAAK,MAAM,EAAE,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,UAAU,EAAE;gBAC7C,2EAA2E;gBAC3E,MAAM,UAAU,GAAG,IAAI,CAAC,CAAC,CAAe,2BAA2B,CAAC,IAAI,CAAC,CAAC;gBAC1E,IAAI,CAAC,UAAU,EAAE;oBAChB,SAAS;iBACT;gBAED,IAAA,yBAAG,EAAc,IAAI,CAAC,CAAC,EAAgB,KAAK,EAAE,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,EAAE;oBACvE,IAAI,IAAI,CAAC,CAAC,EAAU;wBACnB,OAAO;qBACP;oBACD,IAAI,CAAC,EAAE,CAAoB;wBAC1B,IAAI,EAAE,oBAAoB;wBAC1B,IAAI;wBACJ,WAAW,EAAE,EAAE;qBACf,CAAC,CAAC;gBACJ,CAAC,CAAC,CAAC;aACH;QACF,CAAC;QACO,KAAK,CAAC,EAAE,CAAkB,KAA6B;YAC9D,IAAI,OAAO,KAAK,CAAC,IAAI,KAAK,QAAQ,EAAE;gBACnC,OAAO;aACP;YAED,MAAM,CAAC,UAAU,EAAE,SAAS,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;YAC7D,IAAI,CAAC,SAAS,IAAI,CAAC,UAAU,EAAE;gBAC9B,OAAO;aACP;YAED,MAAM,UAAU,GAAG,IAAA,eAAG,EAAK,IAAI,CAAC,WAAW,CAAC,KAAK,cAAc,CAAC,CAAC;gBAChE,IAAI,CAAC,CAAC,CAAuB,YAAY,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,GAAG,IAAI,MAAM,IAAI,CAAC,CAAC,CAAiB,eAAe,EAAE,CAAC,CAAC;gBAC/G,IAAA,eAAG,EAAK,IAAI,CAAC,WAAW,CAAC,CAAC;YAC3B,IAAI,WAAmB,CAAC;YACxB,IAAI,KAAK,CAAC,YAAY,EAAE;gBACvB,WAAW,GAAG,KAAK,CAAC,YAAY,CAAC;aACjC;iBAAM;gBACN,MAAM,QAAQ,GAAG,UAAU,CAAC,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;gBAClD,MAAM,kBAAkB,GAAG,QAAQ,IAAI,IAAA,UAAG,EAAqB,QAAQ,CAAC,CAAC;gBACzE,WAAW,GAAG,kBAAkB,CAAC,CAAC,CAAC,WAAW,kBAAkB,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC;aAChF;YAED,MAAM,UAAU,GAAG,IAAA,eAAG,EAAM,UAAU,EAAE,WAAW,CAAC,CAAC;YACrD,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,CAAC,CAAiB,cAAc,CAAC;gBAC9D,UAAU;aACV,CAAC,CAAC;YACH,IAAI,CAAC,UAAU,EAAE;gBAChB,OAAO;aACP;YAED,MAAM,IAAI,GAAG,IAAA,YAAG,EAAU,SAAS,CAAC,CAAC;YACrC,MAAM,IAAI,CAAC,CAAC,CAAW,SAAS,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;YACnD,MAAM,IAAI,CAAC,CAAC,CAAa,IAAI,CAAC,UAAU,CAAC,CAAC;QAC3C,CAAC;QAEO,EAAE,CAAW,cAAoB,EAAa,OAAe;YACpE,IAAI,CAAC,CAAC,GAAyB,IAAI,CAAC,EAAE,EAAsB,CAAC;YAC7D,MAAM,OAAO,GAAG,cAAc,CAAC,oBAAoB,CAAC;gBACnD,MAAM,EAAE,MAAI,CAAa,CAAC,CAAc,IAAI,CAAC,CAAC,CAAc,CAAC,SAAS,CAAC,IAAI,CAAC,gBAAgB,EAAE,SAAS,CAAC;gBACxG,KAAK,EAAE,GAAG,CAAC,QAAQ,CAAC,CAAe,EAAE,IAA0B,CAAC;gBAChE,OAAO,EAAE;oBACR,OAAO,iEAAwC;oBAC/C,gBAAgB,EAAE,KAAK;oBACvB,qBAAqB,EAAE,0BAAI;iBAC3B;gBACD,cAAc,EAAE;oBACf,uBAAuB,EAAE,IAAI;oBAC7B,YAAY,EAAE,IAAI;oBAClB,kBAAkB,EAAE,IAAI,CAAC,CAAC;iBAC1B;gBACD,SAAS,EAAE,SAAS;gBACpB,gBAAgB,EAAE,iBAAiB;aACnC,CAAC,CAAC;YAEH,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;YACzB,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAiB,CAAC;YACrD,OAAO,OAAO,CAAC;QAChB,CAAC;QAEO,EAAE;YACT,MAAM,gBAAgB,GAAG,IAAI,CAAC,CAAC,CAAc,YAAY,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YACpF,MAAM,WAAW,GAAG,IAAI,CAAC,EAAE,EAAkB,CAAC;YAC9C,OAAO;gBACN,IAAI,CAAC,CAAC,CAAe,gCAAgC,EAAE;gBACvD,IAAI,CAAC,CAAC,CAAe,YAAY,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAA,eAAG,EAAK,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;gBACxE,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAe,iBAAiB,CAAC,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC;oBACjF,IAAA,eAAG,EAAK,CAAC,CAAC,UAAU,CAAC;oBACrB,GAAG,CAAC,CAAC,kBAAkB;iBACvB,CAAC;gBACF,gBAAgB;gBAChB,WAAW;gBACX,IAAI,CAAC,EAAE,EAA4B;aACnC,CAAC,IAAI,EAAE,CAAC;QACV,CAAC;QAEO,EAAE;YACT,IAAI,CAAC,CAAC,CAAc,KAAK,EAAE,CAAC;YAC5B,IAAI,IAAI,CAAC,CAAC,EAAe;gBACxB,IAAI,CAAC,EAAE,CAAwB,IAAI,CAAC,CAAC,CAAc,CAAC;aACpD;YAED,KAAK,MAAM,CAAC,MAAM,EAAE,KAAK,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,EAAE;gBAC1D,IAAI,CAAC,EAAE,CAAoB,EAAE,GAAG,KAAK,CAAC,cAAc,EAAE,eAAe,EAAE,IAAI,CAAC,CAAC,CAAkB,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;aAC9G;YAED,IAAI,IAAI,CAAC,CAAC,EAAwB,WAAW,EAAE;gBAC9C,8FAA8F;gBAC9F,QAAQ;aACR;iBAAM;gBACN,MAAM,OAAO,GAAG,CAAC,GAAG,IAAI,CAAC,oBAAoB,CAAC,MAAM,EAAE,CAAC,CAAC;gBACxD,IAAI,CAAC,oBAAoB,CAAC,KAAK,EAAE,CAAC;gBAClC,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;aAC/B;YAED,IAAI,CAAC,EAAE,EAAa,CAAC;YACrB,IAAI,CAAC,EAAE,EAAc,CAAC;QACvB,CAAC;QAEO,EAAE,CAAgB,IAA2B,EAAE,MAA4B,EAAE,OAAe,EAAE,YAAoB;YACzH,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO,KAAK,CAAC;aACb;YAED,IAAI,mBAAmB,IAAI,IAAI,IAAK,IAAuB,CAAC,iBAAiB,EAAE;gBAC9E,OAAO,KAAK,CAAC;aACb;YAED,IAAI,IAAI,CAAC,CAAC,CAAkB,GAAG,CAAC,MAAM,CAAC,EAAE;gBACxC,OAAO,IAAI,CAAC;aACZ;YAED,MAAM,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YAClD,IAAI,CAAC,WAAW,EAAE;gBACjB,OAAO,KAAK,CAAC;aACb;YAED,IAAI,YAAY,KAAK,WAAW,CAAC,cAAc,CAAC,YAAY,IAAI,OAAO,KAAK,WAAW,CAAC,cAAc,CAAC,OAAO,EAAE;gBAC/G,OAAO,KAAK,CAAC;aACb;YAED,OAAO,IAAI,CAAC;QACb,CAAC;QAED,SAAS,CAAC,OAAoC;YAC7C,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,eAAe;gBACrB,OAAO;aACP,CAAC,CAAC;QACJ,CAAC;QAED,gBAAgB,CAAC,cAAmD,EAAE,cAA6C;YAClH,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,MAAM,OAAO,GAAG,IAAA,YAAG,EAAM,cAAc,CAAC,GAAG,CAAC,CAAC,OAAO,EAAwC,EAAE;gBAC7F,MAAM,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;gBAC1D,IAAI,CAAC,WAAW,EAAE;oBACjB,OAAO;iBACP;gBAED,IAAI,CAAC,OAAO,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,EAAE,CAAgB,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,MAAM,EAAE,OAAO,CAAC,OAAO,EAAE,OAAO,CAAC,YAAY,CAAC,EAAE;oBAC1H,OAAO;iBACP;gBAED,MAAM,EAAE,GAAG,WAAW,CAAC,QAAQ,CAAC;gBAChC,WAAW,CAAC,cAAc,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;gBACrD,WAAW,CAAC,cAAc,CAAC,YAAY,GAAG,OAAO,CAAC,YAAY,CAAC;gBAC/D,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;gBAE/C,OAAO;oBACN,MAAM,EAAE,OAAO,CAAC,IAAI,CAAC,EAAE;oBACvB,QAAQ,EAAE,EAAE;oBACZ,OAAO,EAAE,OAAO,CAAC,OAAO;oBACxB,YAAY,EAAE,OAAO,CAAC,YAAY;oBAClC,YAAY,EAAE,OAAO,CAAC,YAAY;iBAClC,CAAC;YACH,CAAC,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE;gBAC9C,OAAO;aACP;YAED,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,aAAa;gBACnB,OAAO,EAAE,OAAO;gBAChB,WAAW,EAAE,cAAc;aAC3B,CAAC,CAAC;QACJ,CAAC;QAEO,KAAK,CAAC,EAAE,CAAkB,cAAyC;YAC1E,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,IAAI,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,cAAc,CAAC,MAAM,CAAC,EAAE;gBACzD,OAAO,CAAC,KAAK,CAAC,qDAAqD,CAAC,CAAC;gBACrE,OAAO;aACP;YAED,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,cAAc,CAAC,MAAM,EAAE,cAAc,CAAC,CAAC;YACrE,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,kBAAkB;gBACxB,IAAI,EAAE,cAAc;aACpB,CAAC,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,iBAAiB,CAAC,UAAqC;YAC5D,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,MAAM,KAAK,GAAG,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;YAC/D,IAAI,CAAC,KAAK,EAAE;gBACX,OAAO,IAAI,CAAC,EAAE,CAAkB,UAAU,CAAC,CAAC;aAC5C;YAED,MAAM,WAAW,GAAG,UAAU,CAAC,OAAO,KAAK,KAAK,CAAC,OAAO,CAAC;YACzD,MAAM,YAAY,GAAG,CAAC,IAAA,aAAG,EAAI,UAAU,CAAC,QAAQ,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;YACnE,IAAI,CAAC,WAAW,IAAI,CAAC,YAAY,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE;gBACpD,IAAI,CAAC,EAAE,CAAoB;oBAC1B,IAAI,EAAE,gBAAgB;oBACtB,EAAE,EAAE,UAAU,CAAC,MAAM;oBACrB,MAAM,EAAE,UAAU,CAAC,UAAU;oBAC7B,iEAAiE;oBACjE,0DAA0D;oBAC1D,OAAO,EAAE,WAAW,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,UAAU,CAAC,OAAO;oBACrD,GAAG,EAAE,UAAU,CAAC,MAAM;oBACtB,QAAQ,EAAE,YAAY,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,UAAU,CAAC,QAAQ;iBACxD,CAAC,CAAC;aACH;YACD,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC,QAAQ,CAAC;YACrC,KAAK,CAAC,OAAO,GAAG,UAAU,CAAC,OAAO,CAAC;YACnC,KAAK,CAAC,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC;YACjC,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC;QACtB,CAAC;QAED,KAAK,CAAC,kBAAkB,CAAC,OAA0B;YAClD,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,MAAM,WAAW,GAAa,EAAE,CAAC;YACjC,KAAK,MAAM,MAAM,IAAI,OAAO,EAAE;gBAC7B,MAAM,KAAK,GAAG,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;gBACpD,IAAI,KAAK,EAAE;oBACV,IAAI,KAAK,CAAC,OAAO,EAAE;wBAClB,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBACzB,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC;qBACtB;iBACD;aACD;YAED,IAAI,WAAW,CAAC,MAAM,EAAE;gBACvB,IAAI,CAAC,EAAE,CAAoB;oBAC1B,IAAI,EAAE,iBAAiB;oBACvB,GAAG,EAAE,WAAW;iBAChB,CAAC,CAAC;aACH;QACF,CAAC;QAED,KAAK,CAAC,oBAAoB,CAAC,OAA0B;YACpD,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,MAAM,QAAQ,GAAa,EAAE,CAAC;YAC9B,KAAK,MAAM,MAAM,IAAI,OAAO,EAAE;gBAC7B,MAAM,KAAK,GAAG,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;gBACpD,IAAI,KAAK,EAAE;oBACV,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE;wBACnB,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC;wBACrB,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;qBACtB;iBACD;qBAAM;oBACN,OAAO,CAAC,KAAK,CAAC,mDAAmD,MAAM,EAAE,CAAC,CAAC;iBAC3E;aACD;YAED,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,mBAAmB;gBACzB,GAAG,EAAE,QAAQ;aACb,CAAC,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,oBAAoB,CAAC,OAA0B;YACpD,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,KAAK,MAAM,EAAE,IAAI,OAAO,EAAE;gBACzB,IAAI,CAAC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE;oBACvC,OAAO,CAAC,KAAK,CAAC,mDAAmD,EAAE,EAAE,CAAC,CAAC;iBACvE;gBACD,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;aACrC;YAED,IAAI,OAAO,CAAC,MAAM,EAAE;gBACnB,IAAI,CAAC,EAAE,CAAoB;oBAC1B,IAAI,EAAE,kBAAkB;oBACxB,GAAG,EAAE,OAAO;iBACZ,CAAC,CAAC;aACH;QACF,CAAC;QAED,KAAK,CAAC,6BAA6B,CAAC,gBAA0B;YAC7D,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,2BAA2B;gBACjC,eAAe,EAAE,gBAAgB,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;aACjF,CAAC,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,gBAAgB,CAAC,KAA2C;YACjE,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,IAAI,CAAC,CAAC,EAAwB,CAAC,CAAC,QAAQ,EAAE,CAAC;YAC3C,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAW,CAAC;YACtC,IAAI,CAAC,CAAC,GAAyB,EAAE,CAAC,EAAE,IAAI,WAAG,EAAc,EAAE,SAAS,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC,EAAU,CAAC;YAEpG,IAAI,CAAC,CAAC,GAAW,KAAK,CAAC;YAEvB,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;gBACzB,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;aACjD;YAED,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,kBAAkB;gBACxB,KAAK;gBACL,SAAS;aACT,CAAC,CAAC;YAEH,OAAO,IAAI,CAAC,CAAC,CAAuB,CAAC,CAAC,CAAC,CAAC;QACzC,CAAC;QAED;;;WAGG;QACK,EAAE,CAAgB,WAA4B,EAAE,OAA2B;YAClF,IAAI,OAAO,CAAC,IAAI,uCAA+B,EAAE;gBAChD,qBAAqB;gBACrB,OAAO,WAAW,CAAC,QAAQ,EAAE,EAAE,KAAK,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC;aACxD;iBAAM;gBACN,gDAAgD;gBAChD,OAAO,WAAW,CAAC,cAAc,CAAC,IAAI,KAAK,MAAM,CAAC;aAClD;QACF,CAAC;QAED,kCAAkC,CAAC,QAAW,EAAE,OAA2B,EAAE,OAAe,EAAE,MAAc;YAC3G,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,IAAI,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;gBAC1C,OAAO;aACP;YAED,IAAI,IAAI,CAAC,iCAAiC,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;gBAC/D,OAAO;aACP;YAED,IAAI,IAAI,CAAC,8BAA8B,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;gBAC5D,2EAA2E;gBAC3E,OAAO;aACP;YAED,IAAI,CAAC,iCAAiC,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,IAAA,WAAG,EAAS,GAAG,EAAE;gBAC3E,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC,EAAE,CAA2B,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;gBACxI,IAAI,CAAC,EAAE,CAAoB,OAAO,EAAE,YAAY,CAAC,CAAC;gBAClD,IAAI,CAAC,8BAA8B,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,QAAQ,EAAE,OAAO,CAAC,QAAQ,EAAE,SAAS,EAAE,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,cAAc,EAAE,OAAO,EAAE,CAAC,CAAC;gBAC1L,IAAI,CAAC,CAAC,CAAsC,GAAG,CAAC,OAAO,CAAC,QAAQ,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC;gBAClF,IAAI,CAAC,iCAAiC,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAC/D,CAAC,CAAC,CAAC,CAAC;QACL,CAAC;QAED,YAAY,CAAC,QAAW,EAAE,OAA2B,EAAE,OAAe,EAAE,MAAc;YACrF,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,MAAM,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAE1D,wFAAwF;YACxF,+DAA+D;YAC/D,IAAI,CAAC,iCAAiC,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,OAAO,EAAE,CAAC;YACtE,IAAI,CAAC,iCAAiC,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAE9D,mFAAmF;YACnF,IAAI,CAAC,8BAA8B,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAC3D,IAAI,WAAW,EAAE;gBAChB,IAAI,CAAC,CAAC,CAAsC,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;aACzE;YAED,IAAI,WAAW,IAAI,IAAI,CAAC,EAAE,CAAgB,WAAW,EAAE,OAAO,CAAC,EAAE;gBAChE,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;gBAC/C,IAAI,CAAC,EAAE,CAAoB;oBAC1B,IAAI,EAAE,YAAY;oBAClB,MAAM,EAAE,WAAW,CAAC,QAAQ,CAAC,MAAM;oBACnC,QAAQ,EAAE,WAAW,CAAC,QAAQ;oBAC9B,OAAO,EAAE,OAAO;oBAChB,YAAY,EAAE,MAAM;iBACpB,CAAC,CAAC;gBACH,OAAO;aACP;YAED,oBAAoB;YACpB,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC,EAAE,CAA2B,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;YAC1I,IAAI,CAAC,EAAE,CAAoB,OAAO,EAAE,YAAY,CAAC,CAAC;YAClD,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,QAAQ,EAAE,OAAO,CAAC,QAAQ,EAAE,SAAS,EAAE,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,cAAc,EAAE,OAAO,EAAE,CAAC,CAAC;YACxK,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAC/C,IAAI,CAAC,CAAC,CAAoB,GAAG,CAAC,OAAO,CAAC,QAAQ,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC;QACjE,CAAC;QAEO,EAAE,CAAa,MAAmB,EAAE,QAAgB;YAC3D,IAAI,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE;gBACjC,MAAM,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,KAAK,YAAY,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC;gBAClF,IAAI,MAAM,EAAE,MAAM,IAAI,MAAM,EAAE,MAAM,GAAG,CAAC,EAAE;oBACzC,MAAM,OAAO,GAAG,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;oBACjD,OAAO,EAAE,GAAG,MAAM,CAAC,QAAQ,EAAE,cAAc,EAAE,OAAO,EAAE,CAAC;iBACvD;aACD;YACD,OAAO,MAAM,CAAC,QAAQ,CAAC;QACxB,CAAC;QAEO,EAAE,CAA2B,QAAW,EAAE,OAA2B,EAAE,OAAe,EAAE,MAAc,EAAE,YAAqB,EAAE,eAAwB;YAC9J,MAAM,WAAW,GAAG;gBACnB,IAAI,EAAE,MAAM;gBACZ,WAAW,EAAE,QAAQ,CAAC,WAAW;gBACjC,MAAM,EAAE,QAAQ,CAAC,MAAM;gBACvB,OAAO,EAAE,OAAO;gBAChB,YAAY,EAAE,MAAM;gBACpB,IAAI,EAAE,CAAC;gBACP,gBAAgB,EAAE,EAAE;gBACpB,YAAY,EAAE,YAAY;aACjB,CAAC;YAEX,MAAM,QAAQ,GAAkB,EAAE,CAAC;YAEnC,IAAI,OAAgC,CAAC;YACrC,IAAI,QAA2C,CAAC;YAChD,IAAI,OAAO,CAAC,IAAI,uCAA+B,EAAE;gBAChD,MAAM,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC;gBACpC,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;gBAC5B,MAAM,KAAK,GAAG,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,OAAO,CAAC,QAAQ,CAAE,CAAC;gBACvE,MAAM,QAAQ,GAAG,IAAI,CAAC,EAAE,CAAa,MAAM,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;gBAC/D,MAAM,UAAU,GAAG,kBAAkB,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;gBACnE,OAAO,GAAG;oBACT,GAAG,WAAW;oBACd,QAAQ,EAAE,MAAM,CAAC,QAAQ;oBACzB,UAAU,EAAE,OAAO,CAAC,QAAQ,CAAC,EAAE;oBAC/B,OAAO,EAAE;wBACR,IAAI,oCAA4B;wBAChC,QAAQ,EAAE,MAAM,CAAC,QAAQ;wBACzB,QAAQ,EAAE,QAAQ;wBAClB,MAAM,EAAE;4BACP,IAAI,EAAE,KAAK,CAAC,IAAI;4BAChB,UAAU;yBACV;wBACD,UAAU,EAAE,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC;qBACjE;oBACD,eAAe,EAAE,eAAe;iBAChC,CAAC;aACF;iBAAM;gBACN,OAAO,GAAG;oBACT,GAAG,WAAW;oBACd,QAAQ,EAAE,IAAI,CAAC,GAAG,EAAW;oBAC7B,OAAO,EAAE;wBACR,IAAI,EAAE,OAAO,CAAC,IAAI;wBAClB,WAAW,EAAE,OAAO,CAAC,WAAW;qBAChC;oBACD,eAAe,EAAE,eAAe;iBAChC,CAAC;aACF;YAED,OAAO;gBACN,OAAO;gBACP,QAAQ;gBACR,QAAQ;aACR,CAAC;QACH,CAAC;QAED,YAAY,CAAC,QAAW,EAAE,OAA2B,EAAE,OAAe,EAAE,MAAc;YACrF,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;gBAC3C,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;gBACtD,OAAO;aACP;YAED,MAAM,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAE,CAAC;YAE3D,IAAI,WAAW,CAAC,SAAS,KAAK,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE;gBAC7D,mDAAmD;gBACnD,OAAO;aACP;YAED,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAC/C,IAAI,cAAc,GAAiC,SAAS,CAAC;YAE7D,MAAM,QAAQ,GAAkB,EAAE,CAAC;YACnC,IAAI,OAAO,CAAC,IAAI,uCAA+B,EAAE;gBAChD,MAAM,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC;gBACpC,MAAM,WAAW,GAAG,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,OAAO,CAAC,QAAQ,CAAE,CAAC;gBAC7E,MAAM,aAAa,GAAG,MAAM,CAAC,oBAAoB,CAAC,WAAW,CAAC,SAAS,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;gBAC3F,MAAM,QAAQ,GAAG,aAAa,CAAC,CAAC,CAAC,EAAE,UAAU,EAAE,aAAa,CAAC,MAAM,EAAE,eAAe,EAAE,WAAW,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;gBAE1H,MAAM,UAAU,GAAG,kBAAkB,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;gBACzE,cAAc,GAAG;oBAChB,IAAI,oCAA4B;oBAChC,QAAQ,EAAE,WAAW,CAAC,QAAQ;oBAC9B,QAAQ,EAAE,MAAM,CAAC,QAAQ;oBACzB,MAAM,EAAE;wBACP,IAAI,EAAE,OAAO,CAAC,QAAQ;wBACtB,UAAU;wBACV,QAAQ,EAAE,QAAQ;qBAClB;oBACD,UAAU,EAAE,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC;iBACjE,CAAC;aACF;YAED,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,YAAY;gBAClB,MAAM,EAAE,WAAW,CAAC,QAAQ,CAAC,MAAM;gBACnC,QAAQ,EAAE,WAAW,CAAC,QAAQ;gBAC9B,OAAO,EAAE,OAAO;gBAChB,YAAY,EAAE,MAAM;gBACpB,OAAO,EAAE,cAAc;aACvB,EAAE,QAAQ,CAAC,CAAC;YAEb,WAAW,CAAC,SAAS,GAAG,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC;YACvD,OAAO;QACR,CAAC;QAED,KAAK,CAAC,SAAS,CAAC,MAA4B;YAC3C,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,WAAW;gBACjB,QAAQ,EAAE,MAAM,CAAC,KAAK,CAAC,QAAQ;gBAC/B,WAAW,EAAE,MAAM,CAAC,KAAK,CAAC,mBAAmB;aAC7C,CAAC,CAAC;QACJ,CAAC;QAED,YAAY,CAAC,OAAwC;YACpD,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,KAAK,MAAM,MAAM,IAAI,OAAO,EAAE;gBAC7B,MAAM,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;gBAClD,IAAI,CAAC,WAAW,EAAE;oBACjB,SAAS;iBACT;gBAED,MAAM,EAAE,GAAG,WAAW,CAAC,QAAQ,CAAC;gBAEhC,IAAI,CAAC,EAAE,CAAoB;oBAC1B,IAAI,EAAE,aAAa;oBACnB,UAAU,EAAE,WAAW,CAAC,cAAc,CAAC,UAAU;oBACjD,OAAO,EAAE,WAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,EAAE;oBAChD,QAAQ,EAAE,EAAE;oBACZ,MAAM,EAAE,WAAW,CAAC,QAAQ,CAAC,MAAM;iBACnC,CAAC,CAAC;gBACH,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;gBACjC,IAAI,CAAC,iCAAiC,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,OAAO,EAAE,CAAC;gBAC9D,IAAI,CAAC,iCAAiC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;gBACtD,IAAI,CAAC,8BAA8B,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;gBACnD,IAAI,CAAC,CAAC,CAAsC,MAAM,CAAC,EAAE,CAAC,CAAC;gBACvD,IAAI,CAAC,CAAC,CAAoB,MAAM,CAAC,EAAE,CAAC,CAAC;aACrC;QACF,CAAC;QAED,SAAS,CAAC,MAA4B;YACrC,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,MAAM,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YAClD,IAAI,CAAC,WAAW,EAAE;gBACjB,OAAO;aACP;YAED,IAAI,CAAC,CAAC,CAAkB,GAAG,CAAC,MAAM,CAAC,CAAC;YAEpC,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,YAAY;gBAClB,QAAQ,EAAE,WAAW,CAAC,QAAQ;gBAC9B,MAAM,EAAE,WAAW,CAAC,QAAQ,CAAC,MAAM;aACnC,CAAC,CAAC;QACJ,CAAC;QAED,YAAY;YACX,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,IAAI,CAAC,OAAO,EAAE,KAAK,EAAE,CAAC;QACvB,CAAC;QAED,WAAW,CAAC,cAAsB,EAAE,WAA+B,EAAE,WAAoB;YACxF,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,IAAI,CAAC,WAAW,EAAE;gBACjB,IAAI,CAAC,OAAO,EAAE,KAAK,EAAE,CAAC;aACtB;YAED,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,cAAc;gBACpB,cAAc,EAAE,cAAc;gBAC9B,WAAW,EAAE,WAAW;aACxB,CAAC,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,IAAI,CAAC,KAAa,EAAE,OAA+J;YACxL,IAAI,KAAK,KAAK,EAAE,EAAE;gBACjB,IAAI,CAAC,EAAE,CAAoB;oBAC1B,IAAI,EAAE,UAAU;oBAChB,OAAO,EAAE,OAAO,CAAC,OAAO;iBACxB,CAAC,CAAC;gBACH,OAAO,EAAE,CAAC;aACV;YAED,MAAM,CAAC,GAAG,IAAI,OAAO,CAAe,OAAO,CAAC,EAAE;gBAC7C,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC,CAAC,EAAE;oBACvC,IAAI,CAAC,CAAC,OAAO,CAAC,IAAI,KAAK,SAAS,EAAE;wBACjC,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;wBAC3B,GAAG,EAAE,OAAO,EAAE,CAAC;qBACf;gBACF,CAAC,CAAC,CAAC;YACJ,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,MAAM;gBACZ,KAAK,EAAE,KAAK;gBACZ,OAAO;aACP,CAAC,CAAC;YAEH,MAAM,GAAG,GAAG,MAAM,CAAC,CAAC;YACpB,OAAO,GAAG,CAAC;QACZ,CAAC;QAED,QAAQ,CAAC,OAAe;YACvB,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,UAAU;gBAChB,OAAO;aACP,CAAC,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,oBAAoB,CAAC,KAAa,EAAE,OAAe;YACxD,MAAM,CAAC,GAAG,IAAI,OAAO,CAAS,OAAO,CAAC,EAAE;gBACvC,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC,CAAC,EAAE;oBACvC,IAAI,CAAC,CAAC,OAAO,CAAC,IAAI,KAAK,yBAAyB,EAAE;wBACjD,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;wBAC1B,GAAG,EAAE,OAAO,EAAE,CAAC;qBACf;gBACF,CAAC,CAAC,CAAC;YACJ,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,sBAAsB;gBAC5B,KAAK;gBACL,OAAO;aACP,CAAC,CAAC;YAEH,MAAM,GAAG,GAAG,MAAM,CAAC,CAAC;YACpB,OAAO,GAAG,CAAC;QACZ,CAAC;QAED,KAAK,CAAC,sBAAsB,CAAC,KAAa,EAAE,OAAe;YAC1D,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,wBAAwB;gBAC9B,KAAK;gBACL,OAAO;aACP,CAAC,CAAC;QACJ,CAAC;QAGD,4BAA4B,CAAC,MAAc,EAAE,KAAe,EAAE,OAAiB;YAC9E,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,aAAa;gBACnB,MAAM;gBACN,eAAe,EAAE,KAAK;gBACtB,iBAAiB,EAAE,OAAO;aAC1B,CAAC,CAAC;QAEJ,CAAC;QAED,qBAAqB;YACpB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;gBAClB,OAAO;aACP;YAED,MAAM,aAAa,GAAG,IAAI,CAAC,EAAE,EAAe,CAAC;YAC7C,IAAI,CAAC,CAAC,GAAyB,IAAI,CAAC,EAAE,EAAsB,CAAC;YAC7D,MAAM,kBAAkB,GAAG;gBAC1B,GAAG,CAAC,IAAI,CAAC,CAAC,IAA0B,EAAE,CAAC;gBACvC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAc,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAc,iBAAiB,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;aACvE,CAAC;YAEF,IAAI,CAAC,OAAO,CAAC,kBAAkB,GAAG,kBAAkB,CAAC;YACrD,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,iBAAiB;gBACvB,YAAY,EAAE,aAAa;aAC3B,CAAC,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,oBAAoB,CAAC,MAAmC;YAC7D,IAAI,IAAI,CAAC,CAAC,IAAY,MAAM,KAAK,IAAI,CAAC,CAAC,EAAe;gBACrD,OAAO;aACP;YAED,MAAM,cAAc,GAAG,IAAI,CAAC,CAAC,CAAc;YAC3C,IAAI,CAAC,CAAC,GAAgB,MAAM,CAAC;YAE7B,IAAI,cAAc,IAAI,cAAc,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE;gBAC5D,IAAI,CAAC,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC,yCAAyC;aACjE;iBAAM,IAAI,MAAM,EAAE;gBAClB,IAAI,CAAC,EAAE,CAAwB,MAAM,CAAC,CAAC;aACvC;QACF,CAAC;QAEO,EAAE,CAAwB,MAAuB;YACxD,MAAM,SAAS,GAAyB,EAAE,CAAC;YAC3C,KAAK,MAAM,OAAO,IAAI,MAAM,CAAC,WAAW,EAAE;gBACzC,MAAM,GAAG,GAAG,IAAI,CAAC,CAAC,CAAkB,sBAAsB,IAAI,CAAC,OAAO,CAAC,MAAM,KAAK,MAAM,IAAI,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC;oBACtH,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAW,OAAO,EAAE,SAAS,CAAC,CAAC;gBAEnD,IAAI,CAAC,IAAI,CAAC,CAAC,CAAc,GAAG,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,EAAE;oBAC7C,SAAS,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC,QAAQ,EAAE,EAAE,WAAW,EAAE,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;oBACzE,IAAI,CAAC,CAAC,CAAc,GAAG,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC;iBACxC;aACD;YAED,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE;gBACtB,OAAO;aACP;YAED,IAAI,CAAC,EAAE,CAAc,SAAS,CAAC,CAAC;QACjC,CAAC;QAEO,EAAE,CAAc,SAA+B;YACtD,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;gBAClB,OAAO;aACP;YAED,MAAM,kBAAkB,GAAG;gBAC1B,GAAG,CAAC,IAAI,CAAC,CAAC,IAA0B,EAAE,CAAC;gBACvC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAc,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAc,iBAAiB,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;aACvE,CAAC;YAEF,IAAI,CAAC,OAAO,CAAC,kBAAkB,GAAG,kBAAkB,CAAC;YAErD,IAAI,CAAC,EAAE,CAAoB;gBAC1B,IAAI,EAAE,SAAS;gBACf,SAAS,EAAE,SAAS;aACpB,CAAC,CAAC;QACJ,CAAC;QAEO,EAAE,CAAoB,OAAyB,EAAE,QAAiC;YACzF,IAAI,IAAI,CAAC,CAAC,EAAU;gBACnB,OAAO;aACP;YAED,IAAI,CAAC,OAAO,EAAE,WAAW,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;QAC9C,CAAC;QAEQ,OAAO;YACf,IAAI,CAAC,CAAC,GAAW,IAAI,CAAC;YACtB,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE,CAAC;YACxB,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;YACzB,IAAI,CAAC,cAAc,GAAG,IAAK,CAAC;YAC5B,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC;YAC1B,IAAI,CAAC,iCAAiC,CAAC,KAAK,EAAE,CAAC;YAC/C,KAAK,CAAC,OAAO,EAAE,CAAC;QACjB,CAAC;KACD,CAAA;IApoDY,oBAAI;mBAAJ,IAAI;QAsCd,WAAA,cAAI,CAAA;QACJ,WAAA,YAAG,CAAA;QACH,WAAA,sBAAI,CAAA;QACJ,WAAA,eAAG,CAAA;QACH,YAAA,wBAAG,CAAA;QACH,YAAA,aAAG,CAAA;QACH,YAAA,WAAG,CAAA;QACH,YAAA,iBAAG,CAAA;QACH,YAAA,gBAAG,CAAA;QACH,YAAA,oBAAG,CAAA;QACH,YAAA,mBAAG,CAAA;QACH,YAAA,cAAG,CAAA;QACH,YAAA,eAAG,CAAA;QACH,YAAA,yBAAG,CAAA;QACH,YAAA,aAAG,CAAA;QACH,YAAA,iBAAG,CAAA;QACH,YAAA,6BAAI,CAAA;QACJ,YAAA,kBAAG,CAAA;QACH,YAAA,eAAG,CAAA;OAxDO,IAAI,CAooDhB;IAED,SAAS,kBAAkB,CAAC,MAAkB,EAAE,QAAuB;QACtE,IAAI,MAAM,CAAC,UAAU,KAAK,MAAM,CAAC,MAAM,CAAC,UAAU,EAAE;YACnD,8CAA8C;YAC9C,OAAO,MAAM,CAAC;SACd;aAAM;YACN,uDAAuD;YACvD,0DAA0D;YAC1D,MAAM,UAAU,GAAG,IAAI,UAAU,CAAC,MAAM,CAAC,CAAC;YAC1C,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;YACjC,OAAO,UAAU,CAAC;SAClB;IACF,CAAC;IAED,SAAS,kBAAkB;QAC1B,MAAM,QAAQ,GAAG,eAAG,CAAkB,WAAW,EAAE,CAAC;QACpD,MAAM,eAAe,GAAG,QAAQ,CAAC,CAAC,CAAC,IAAA,mBAAI,EAAyB,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;QAC/E,OAAO,eAAe,CAAC;IACxB,CAAC;IAED,SAAS,qBAAqB,CAAC,GAAW;QACzC,IAAI;YACH,OAAO,kBAAkB,CAAC,GAAG,CAAC,CAAC;SAC/B;QAAC,MAAM;YACP,OAAO,GAAG,CAAC;SACX;IACF,CAAC","file":"backLayerWebView.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as osPath from 'vs/base/common/path';\nimport { IMouseWheelEvent } from 'vs/base/browser/mouseEvent';\nimport { coalesce } from 'vs/base/common/arrays';\nimport { DeferredPromise, runWhenIdle } from 'vs/base/common/async';\nimport { decodeBase64 } from 'vs/base/common/buffer';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { getExtensionForMimeType } from 'vs/base/common/mime';\nimport { FileAccess, Schemas } from 'vs/base/common/network';\nimport { equals } from 'vs/base/common/objects';\nimport { isMacintosh, isWeb } from 'vs/base/common/platform';\nimport { dirname, extname, isEqual, joinPath } from 'vs/base/common/resources';\nimport { URI } from 'vs/base/common/uri';\nimport * as UUID from 'vs/base/common/uuid';\nimport { TokenizationRegistry } from 'vs/editor/common/languages';\nimport { ILanguageService } from 'vs/editor/common/languages/language';\nimport { generateTokensCSSForColorMap } from 'vs/editor/common/languages/supports/tokenization';\nimport { tokenizeToString } from 'vs/editor/common/languages/textToHtmlTokenizer';\nimport * as nls from 'vs/nls';\nimport { MenuId } from 'vs/platform/actions/common/actions';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { IFileDialogService } from 'vs/platform/dialogs/common/dialogs';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IOpenerService, matchesScheme, matchesSomeScheme } from 'vs/platform/opener/common/opener';\nimport { IStorageService } from 'vs/platform/storage/common/storage';\nimport { editorFindMatch, editorFindMatchHighlight } from 'vs/platform/theme/common/colorRegistry';\nimport { IThemeService, Themable } from 'vs/platform/theme/common/themeService';\nimport { IWorkspaceContextService } from 'vs/platform/workspace/common/workspace';\nimport { IWorkspaceTrustManagementService } from 'vs/platform/workspace/common/workspaceTrust';\nimport { CellEditState, ICellOutputViewModel, ICellViewModel, ICommonCellInfo, IDisplayOutputLayoutUpdateRequest, IDisplayOutputViewModel, IFocusNotebookCellOptions, IGenericCellViewModel, IInsetRenderOutput, INotebookEditorCreationOptions, INotebookWebviewMessage, RenderOutputType } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { NOTEBOOK_WEBVIEW_BOUNDARY } from 'vs/workbench/contrib/notebook/browser/view/notebookCellList';\nimport { preloadsScriptStr } from 'vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads';\nimport { transformWebviewThemeVars } from 'vs/workbench/contrib/notebook/browser/view/renderers/webviewThemeMapping';\nimport { MarkupCellViewModel } from 'vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel';\nimport { CellUri, ICellOutput, INotebookRendererInfo, RendererMessagingSpec } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { INotebookKernel } from 'vs/workbench/contrib/notebook/common/notebookKernelService';\nimport { IScopedRendererMessaging } from 'vs/workbench/contrib/notebook/common/notebookRendererMessagingService';\nimport { INotebookService } from 'vs/workbench/contrib/notebook/common/notebookService';\nimport { IWebviewElement, IWebviewService, WebviewContentPurpose, WebviewOriginStore } from 'vs/workbench/contrib/webview/browser/webview';\nimport { WebviewWindowDragMonitor } from 'vs/workbench/contrib/webview/browser/webviewWindowDragMonitor';\nimport { asWebviewUri, webviewGenericCspSource } from 'vs/workbench/contrib/webview/common/webview';\nimport { IEditorGroup, IEditorGroupsService } from 'vs/workbench/services/editor/common/editorGroupsService';\nimport { IWorkbenchEnvironmentService } from 'vs/workbench/services/environment/common/environmentService';\nimport { FromWebviewMessage, IAckOutputHeight, IClickedDataUrlMessage, ICodeBlockHighlightRequest, IContentWidgetTopRequest, IControllerPreload, ICreationContent, ICreationRequestMessage, IFindMatch, IMarkupCellInitialization, RendererMetadata, StaticPreloadMetadata, ToWebviewMessage } from './webviewMessages';\nimport { IPathService } from 'vs/workbench/services/path/common/pathService';\nimport { ITextEditorOptions } from 'vs/platform/editor/common/editor';\nimport { EditorInput } from 'vs/workbench/common/editor/editorInput';\nimport { INotebookLoggingService } from 'vs/workbench/contrib/notebook/common/notebookLoggingService';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { WorkbenchActionExecutedClassification, WorkbenchActionExecutedEvent } from 'vs/base/common/actions';\n\nconst LINE_COLUMN_REGEX = /:([\\d]+)(?::([\\d]+))?$/;\nconst LineQueryRegex = /line=(\\d+)$/;\n\n\nexport interface ICachedInset<K extends ICommonCellInfo> {\n\toutputId: string;\n\tversionId: number;\n\tcellInfo: K;\n\trenderer?: INotebookRendererInfo;\n\tcachedCreation: ICreationRequestMessage;\n\tinitialized?: boolean;\n}\n\nexport interface IResolvedBackLayerWebview {\n\twebview: IWebviewElement;\n}\n\n/**\n * Notebook Editor Delegate for back layer webview\n */\nexport interface INotebookDelegateForWebview {\n\treadonly creationOptions: INotebookEditorCreationOptions;\n\tgetCellById(cellId: string): IGenericCellViewModel | undefined;\n\tfocusNotebookCell(cell: IGenericCellViewModel, focus: 'editor' | 'container' | 'output', options?: IFocusNotebookCellOptions): Promise<void>;\n\ttoggleNotebookCellSelection(cell: IGenericCellViewModel, selectFromPrevious: boolean): void;\n\tgetCellByInfo(cellInfo: ICommonCellInfo): IGenericCellViewModel;\n\tfocusNextNotebookCell(cell: IGenericCellViewModel, focus: 'editor' | 'container' | 'output'): Promise<void>;\n\tupdateOutputHeight(cellInfo: ICommonCellInfo, output: IDisplayOutputViewModel, height: number, isInit: boolean, source?: string): void;\n\tscheduleOutputHeightAck(cellInfo: ICommonCellInfo, outputId: string, height: number): void;\n\tupdateMarkupCellHeight(cellId: string, height: number, isInit: boolean): void;\n\tsetMarkupCellEditState(cellId: string, editState: CellEditState): void;\n\tdidStartDragMarkupCell(cellId: string, event: { dragOffsetY: number }): void;\n\tdidDragMarkupCell(cellId: string, event: { dragOffsetY: number }): void;\n\tdidDropMarkupCell(cellId: string, event: { dragOffsetY: number; ctrlKey: boolean; altKey: boolean }): void;\n\tdidEndDragMarkupCell(cellId: string): void;\n\tdidResizeOutput(cellId: string): void;\n\tsetScrollTop(scrollTop: number): void;\n\ttriggerScroll(event: IMouseWheelEvent): void;\n\tupdatePerformanceMetadata(cellId: string, executionId: string, duration: number, rendererId: string): void;\n\tdidFocusOutputInputChange(inputFocused: boolean): void;\n}\n\ninterface BacklayerWebviewOptions {\n\treadonly outputNodePadding: number;\n\treadonly outputNodeLeftPadding: number;\n\treadonly previewNodePadding: number;\n\treadonly markdownLeftMargin: number;\n\treadonly leftMargin: number;\n\treadonly rightMargin: number;\n\treadonly runGutter: number;\n\treadonly dragAndDropEnabled: boolean;\n\treadonly fontSize: number;\n\treadonly outputFontSize: number;\n\treadonly fontFamily: string;\n\treadonly outputFontFamily: string;\n\treadonly markupFontSize: number;\n\treadonly outputLineHeight: number;\n\treadonly outputScrolling: boolean;\n\treadonly outputWordWrap: boolean;\n\treadonly outputLineLimit: number;\n}\n\n\nexport class BackLayerWebView<T extends ICommonCellInfo> extends Themable {\n\n\tprivate static _originStore?: WebviewOriginStore;\n\n\tprivate static getOriginStore(storageService: IStorageService): WebviewOriginStore {\n\t\tthis._originStore ??= new WebviewOriginStore('notebook.backlayerWebview.origins', storageService);\n\t\treturn this._originStore;\n\t}\n\n\telement: HTMLElement;\n\twebview: IWebviewElement | undefined = undefined;\n\tinsetMapping: Map<IDisplayOutputViewModel, ICachedInset<T>> = new Map();\n\tpendingWebviewIdleCreationRequest: Map<IDisplayOutputViewModel, IDisposable> = new Map();\n\tpendingWebviewIdleInsetMapping: Map<IDisplayOutputViewModel, ICachedInset<T>> = new Map();\n\tprivate reversedPendingWebviewIdleInsetMapping: Map<string, IDisplayOutputViewModel> = new Map();\n\n\treadonly markupPreviewMapping = new Map<string, IMarkupCellInitialization>();\n\tprivate hiddenInsetMapping: Set<IDisplayOutputViewModel> = new Set();\n\tprivate reversedInsetMapping: Map<string, IDisplayOutputViewModel> = new Map();\n\tprivate localResourceRootsCache: URI[] | undefined = undefined;\n\tprivate readonly _onMessage = this._register(new Emitter<INotebookWebviewMessage>());\n\tprivate readonly _preloadsCache = new Set<string>();\n\tpublic readonly onMessage: Event<INotebookWebviewMessage> = this._onMessage.event;\n\tprivate _disposed = false;\n\tprivate _currentKernel?: INotebookKernel;\n\n\tprivate firstInit = true;\n\tprivate initializeMarkupPromise?: { readonly requestId: string; readonly p: DeferredPromise<void>; readonly isFirstInit: boolean };\n\n\tprivate readonly nonce = UUID.generateUuid();\n\n\tconstructor(\n\t\tpublic notebookEditor: INotebookDelegateForWebview,\n\t\tprivate readonly id: string,\n\t\tpublic readonly notebookViewType: string,\n\t\tpublic readonly documentUri: URI,\n\t\tprivate options: BacklayerWebviewOptions,\n\t\tprivate readonly rendererMessaging: IScopedRendererMessaging | undefined,\n\t\t@IWebviewService private readonly webviewService: IWebviewService,\n\t\t@IOpenerService private readonly openerService: IOpenerService,\n\t\t@INotebookService private readonly notebookService: INotebookService,\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IFileDialogService private readonly fileDialogService: IFileDialogService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IWorkspaceTrustManagementService private readonly workspaceTrustManagementService: IWorkspaceTrustManagementService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IWorkspaceContextService private readonly workspaceContextService: IWorkspaceContextService,\n\t\t@IEditorGroupsService private readonly editorGroupService: IEditorGroupsService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IPathService private readonly pathService: IPathService,\n\t\t@INotebookLoggingService private readonly notebookLogService: INotebookLoggingService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService\n\t) {\n\t\tsuper(themeService);\n\n\t\tthis._logRendererDebugMessage('Creating backlayer webview for notebook');\n\n\t\tthis.element = document.createElement('div');\n\n\t\tthis.element.style.height = '1400px';\n\t\tthis.element.style.position = 'absolute';\n\n\t\tif (rendererMessaging) {\n\t\t\tthis._register(rendererMessaging);\n\t\t\trendererMessaging.receiveMessageHandler = (rendererId, message) => {\n\t\t\t\tif (!this.webview || this._disposed) {\n\t\t\t\t\treturn Promise.resolve(false);\n\t\t\t\t}\n\n\t\t\t\tthis._sendMessageToWebview({\n\t\t\t\t\t__vscode_notebook_message: true,\n\t\t\t\t\ttype: 'customRendererMessage',\n\t\t\t\t\trendererId: rendererId,\n\t\t\t\t\tmessage: message\n\t\t\t\t});\n\n\t\t\t\treturn Promise.resolve(true);\n\t\t\t};\n\t\t}\n\n\t\tthis._register(workspaceTrustManagementService.onDidChangeTrust(e => {\n\t\t\tconst baseUrl = this.asWebviewUri(this.getNotebookBaseUri(), undefined);\n\t\t\tconst htmlContent = this.generateContent(baseUrl.toString());\n\t\t\tthis.webview?.setHtml(htmlContent);\n\t\t}));\n\n\t\tthis._register(TokenizationRegistry.onDidChange(() => {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'tokenizedStylesChanged',\n\t\t\t\tcss: getTokenizationCss(),\n\t\t\t});\n\t\t}));\n\t}\n\n\tupdateOptions(options: BacklayerWebviewOptions) {\n\t\tthis.options = options;\n\t\tthis._updateStyles();\n\t\tthis._updateOptions();\n\t}\n\n\tprivate _logRendererDebugMessage(msg: string) {\n\t\tthis.notebookLogService.debug('BacklayerWebview', `${this.documentUri} (${this.id}) - ${msg}`);\n\t}\n\n\tprivate _updateStyles() {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'notebookStyles',\n\t\t\tstyles: this._generateStyles()\n\t\t});\n\t}\n\n\tprivate _updateOptions() {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'notebookOptions',\n\t\t\toptions: {\n\t\t\t\tdragAndDropEnabled: this.options.dragAndDropEnabled\n\t\t\t},\n\t\t\trenderOptions: {\n\t\t\t\tlineLimit: this.options.outputLineLimit,\n\t\t\t\toutputScrolling: this.options.outputScrolling,\n\t\t\t\toutputWordWrap: this.options.outputWordWrap\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _generateStyles() {\n\t\treturn {\n\t\t\t'notebook-output-left-margin': `${this.options.leftMargin + this.options.runGutter}px`,\n\t\t\t'notebook-output-width': `calc(100% - ${this.options.leftMargin + this.options.rightMargin + this.options.runGutter}px)`,\n\t\t\t'notebook-output-node-padding': `${this.options.outputNodePadding}px`,\n\t\t\t'notebook-run-gutter': `${this.options.runGutter}px`,\n\t\t\t'notebook-preview-node-padding': `${this.options.previewNodePadding}px`,\n\t\t\t'notebook-markdown-left-margin': `${this.options.markdownLeftMargin}px`,\n\t\t\t'notebook-output-node-left-padding': `${this.options.outputNodeLeftPadding}px`,\n\t\t\t'notebook-markdown-min-height': `${this.options.previewNodePadding * 2}px`,\n\t\t\t'notebook-markup-font-size': typeof this.options.markupFontSize === 'number' && this.options.markupFontSize > 0 ? `${this.options.markupFontSize}px` : `calc(${this.options.fontSize}px * 1.2)`,\n\t\t\t'notebook-cell-output-font-size': `${this.options.outputFontSize || this.options.fontSize}px`,\n\t\t\t'notebook-cell-output-line-height': `${this.options.outputLineHeight}px`,\n\t\t\t'notebook-cell-output-max-height': `${this.options.outputLineHeight * this.options.outputLineLimit}px`,\n\t\t\t'notebook-cell-output-font-family': this.options.outputFontFamily || this.options.fontFamily,\n\t\t\t'notebook-cell-markup-empty-content': nls.localize('notebook.emptyMarkdownPlaceholder', \"Empty markdown cell, double-click or press enter to edit.\"),\n\t\t\t'notebook-cell-renderer-not-found-error': nls.localize({\n\t\t\t\tkey: 'notebook.error.rendererNotFound',\n\t\t\t\tcomment: ['$0 is a placeholder for the mime type']\n\t\t\t}, \"No renderer found for '$0'\"),\n\t\t\t'notebook-cell-renderer-fallbacks-exhausted': nls.localize({\n\t\t\t\tkey: 'notebook.error.rendererFallbacksExhausted',\n\t\t\t\tcomment: ['$0 is a placeholder for the mime type']\n\t\t\t}, \"Could not render content for '$0'\"),\n\t\t};\n\t}\n\n\tprivate generateContent(baseUrl: string) {\n\t\tconst renderersData = this.getRendererData();\n\t\tconst preloadsData = this.getStaticPreloadsData();\n\t\tconst renderOptions = {\n\t\t\tlineLimit: this.options.outputLineLimit,\n\t\t\toutputScrolling: this.options.outputScrolling,\n\t\t\toutputWordWrap: this.options.outputWordWrap\n\t\t};\n\t\tconst preloadScript = preloadsScriptStr(\n\t\t\t{\n\t\t\t\t...this.options,\n\t\t\t\ttokenizationCss: getTokenizationCss(),\n\t\t\t},\n\t\t\t{ dragAndDropEnabled: this.options.dragAndDropEnabled },\n\t\t\trenderOptions,\n\t\t\trenderersData,\n\t\t\tpreloadsData,\n\t\t\tthis.workspaceTrustManagementService.isWorkspaceTrusted(),\n\t\t\tthis.nonce);\n\n\t\tconst enableCsp = this.configurationService.getValue('notebook.experimental.enableCsp');\n\t\tconst currentHighlight = this.getColor(editorFindMatch);\n\t\tconst findMatchHighlight = this.getColor(editorFindMatchHighlight);\n\t\treturn /* html */`\n\t\t<html lang=\"en\">\n\t\t\t<head>\n\t\t\t\t<meta charset=\"UTF-8\">\n\t\t\t\t<base href=\"${baseUrl}/\" />\n\t\t\t\t${enableCsp ?\n\t\t\t\t`<meta http-equiv=\"Content-Security-Policy\" content=\"\n\t\t\t\t\tdefault-src 'none';\n\t\t\t\t\tscript-src ${webviewGenericCspSource} 'unsafe-inline' 'unsafe-eval';\n\t\t\t\t\tstyle-src ${webviewGenericCspSource} 'unsafe-inline';\n\t\t\t\t\timg-src ${webviewGenericCspSource} https: http: data:;\n\t\t\t\t\tfont-src ${webviewGenericCspSource} https:;\n\t\t\t\t\tconnect-src https:;\n\t\t\t\t\tchild-src https: data:;\n\t\t\t\t\">` : ''}\n\t\t\t\t<style nonce=\"${this.nonce}\">\n\t\t\t\t\t::highlight(find-highlight) {\n\t\t\t\t\t\tbackground-color: var(--vscode-editor-findMatchBackground, ${findMatchHighlight});\n\t\t\t\t\t}\n\n\t\t\t\t\t::highlight(current-find-highlight) {\n\t\t\t\t\t\tbackground-color: var(--vscode-editor-findMatchHighlightBackground, ${currentHighlight});\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .cell_container {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .output_container {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div > div > div.output {\n\t\t\t\t\t\tfont-size: var(--notebook-cell-output-font-size);\n\t\t\t\t\t\twidth: var(--notebook-output-width);\n\t\t\t\t\t\tmargin-left: var(--notebook-output-left-margin);\n\t\t\t\t\t\tbackground-color: var(--theme-notebook-output-background);\n\t\t\t\t\t\tpadding-top: var(--notebook-output-node-padding);\n\t\t\t\t\t\tpadding-right: var(--notebook-output-node-padding);\n\t\t\t\t\t\tpadding-bottom: var(--notebook-output-node-padding);\n\t\t\t\t\t\tpadding-left: var(--notebook-output-node-left-padding);\n\t\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\t\tborder-top: none;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* markdown */\n\t\t\t\t\t#container div.preview {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\tpadding-right: var(--notebook-preview-node-padding);\n\t\t\t\t\t\tpadding-left: var(--notebook-markdown-left-margin);\n\t\t\t\t\t\tpadding-top: var(--notebook-preview-node-padding);\n\t\t\t\t\t\tpadding-bottom: var(--notebook-preview-node-padding);\n\n\t\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t\twhite-space: initial;\n\n\t\t\t\t\t\tfont-size: var(--notebook-markup-font-size);\n\t\t\t\t\t\tcolor: var(--theme-ui-foreground);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container div.preview.draggable {\n\t\t\t\t\t\tuser-select: none;\n\t\t\t\t\t\t-webkit-user-select: none;\n\t\t\t\t\t\t-ms-user-select: none;\n\t\t\t\t\t\tcursor: grab;\n\t\t\t\t\t}\n\n\t\t\t\t\t#container div.preview.selected {\n\t\t\t\t\t\tbackground: var(--theme-notebook-cell-selected-background);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container div.preview.dragging {\n\t\t\t\t\t\tbackground-color: var(--theme-background);\n\t\t\t\t\t\topacity: 0.5 !important;\n\t\t\t\t\t}\n\n\t\t\t\t\t.monaco-workbench.vs-dark .notebookOverlay .cell.markdown .latex img,\n\t\t\t\t\t.monaco-workbench.vs-dark .notebookOverlay .cell.markdown .latex-block img {\n\t\t\t\t\t\tfilter: brightness(0) invert(1)\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .markup > div.nb-symbolHighlight {\n\t\t\t\t\t\tbackground-color: var(--theme-notebook-symbol-highlight-background);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div.nb-cellDeleted .output_container {\n\t\t\t\t\t\tbackground-color: var(--theme-notebook-diff-removed-background);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div.nb-cellAdded .output_container {\n\t\t\t\t\t\tbackground-color: var(--theme-notebook-diff-inserted-background);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div > div:not(.preview) > div {\n\t\t\t\t\t\toverflow-x: auto;\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .no-renderer-error {\n\t\t\t\t\t\tcolor: var(--vscode-editorError-foreground);\n\t\t\t\t\t}\n\n\t\t\t\t\tbody {\n\t\t\t\t\t\tpadding: 0px;\n\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t}\n\n\t\t\t\t\ttable, thead, tr, th, td, tbody {\n\t\t\t\t\t\tborder: none !important;\n\t\t\t\t\t\tborder-color: transparent;\n\t\t\t\t\t\tborder-spacing: 0;\n\t\t\t\t\t\tborder-collapse: collapse;\n\t\t\t\t\t}\n\n\t\t\t\t\ttable, th, tr {\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: right;\n\t\t\t\t\t}\n\n\t\t\t\t\tthead {\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\tbackground-color: rgba(130, 130, 130, 0.16);\n\t\t\t\t\t}\n\n\t\t\t\t\tth, td {\n\t\t\t\t\t\tpadding: 4px 8px;\n\t\t\t\t\t}\n\n\t\t\t\t\ttr:nth-child(even) {\n\t\t\t\t\t\tbackground-color: rgba(130, 130, 130, 0.08);\n\t\t\t\t\t}\n\n\t\t\t\t\ttbody th {\n\t\t\t\t\t\tfont-weight: normal;\n\t\t\t\t\t}\n\n\t\t\t\t\t.find-match {\n\t\t\t\t\t\tbackground-color: var(--vscode-editor-findMatchHighlightBackground);\n\t\t\t\t\t}\n\n\t\t\t\t\t.current-find-match {\n\t\t\t\t\t\tbackground-color: var(--vscode-editor-findMatchBackground);\n\t\t\t\t\t}\n\n\t\t\t\t\t#_defaultColorPalatte {\n\t\t\t\t\t\tcolor: var(--vscode-editor-findMatchHighlightBackground);\n\t\t\t\t\t\tbackground-color: var(--vscode-editor-findMatchBackground);\n\t\t\t\t\t}\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body style=\"overflow: hidden;\">\n\t\t\t\t<div id='findStart' tabIndex=-1></div>\n\t\t\t\t<div id='container' class=\"widgetarea\" style=\"position: absolute;width:100%;top: 0px\"></div>\n\t\t\t\t<div id=\"_defaultColorPalatte\"></div>\n\t\t\t\t<script type=\"module\">${preloadScript}</script>\n\t\t\t</body>\n\t\t</html>`;\n\t}\n\n\tprivate getRendererData(): RendererMetadata[] {\n\t\treturn this.notebookService.getRenderers().map((renderer): RendererMetadata => {\n\t\t\tconst entrypoint = {\n\t\t\t\textends: renderer.entrypoint.extends,\n\t\t\t\tpath: this.asWebviewUri(renderer.entrypoint.path, renderer.extensionLocation).toString()\n\t\t\t};\n\t\t\treturn {\n\t\t\t\tid: renderer.id,\n\t\t\t\tentrypoint,\n\t\t\t\tmimeTypes: renderer.mimeTypes,\n\t\t\t\tmessaging: renderer.messaging !== RendererMessagingSpec.Never,\n\t\t\t\tisBuiltin: renderer.isBuiltin\n\t\t\t};\n\t\t});\n\t}\n\n\tprivate getStaticPreloadsData(): StaticPreloadMetadata[] {\n\t\treturn Array.from(this.notebookService.getStaticPreloads(this.notebookViewType), preload => {\n\t\t\treturn { entrypoint: this.asWebviewUri(preload.entrypoint, preload.extensionLocation).toString().toString() };\n\t\t});\n\t}\n\n\tprivate asWebviewUri(uri: URI, fromExtension: URI | undefined) {\n\t\treturn asWebviewUri(uri, fromExtension?.scheme === Schemas.vscodeRemote ? { isRemote: true, authority: fromExtension.authority } : undefined);\n\t}\n\n\tpostKernelMessage(message: any) {\n\t\tthis._sendMessageToWebview({\n\t\t\t__vscode_notebook_message: true,\n\t\t\ttype: 'customKernelMessage',\n\t\t\tmessage,\n\t\t});\n\t}\n\n\tprivate resolveOutputId(id: string): { cellInfo: T; output: ICellOutputViewModel } | undefined {\n\t\tconst output = this.reversedInsetMapping.get(id);\n\t\tif (!output) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cellInfo = this.insetMapping.get(output)!.cellInfo;\n\t\treturn { cellInfo, output };\n\t}\n\n\tisResolved(): this is IResolvedBackLayerWebview {\n\t\treturn !!this.webview;\n\t}\n\n\tcreateWebview(): Promise<void> {\n\t\tconst baseUrl = this.asWebviewUri(this.getNotebookBaseUri(), undefined);\n\t\tconst htmlContent = this.generateContent(baseUrl.toString());\n\t\treturn this._initialize(htmlContent);\n\t}\n\n\tprivate getNotebookBaseUri() {\n\t\tif (this.documentUri.scheme === Schemas.untitled) {\n\t\t\tconst folder = this.workspaceContextService.getWorkspaceFolder(this.documentUri);\n\t\t\tif (folder) {\n\t\t\t\treturn folder.uri;\n\t\t\t}\n\n\t\t\tconst folders = this.workspaceContextService.getWorkspace().folders;\n\t\t\tif (folders.length) {\n\t\t\t\treturn folders[0].uri;\n\t\t\t}\n\t\t}\n\n\t\treturn dirname(this.documentUri);\n\t}\n\n\tprivate getBuiltinLocalResourceRoots(): URI[] {\n\t\t// Python notebooks assume that requirejs is a global.\n\t\t// For all other notebooks, they need to provide their own loader.\n\t\tif (!this.documentUri.path.toLowerCase().endsWith('.ipynb')) {\n\t\t\treturn [];\n\t\t}\n\n\t\tif (isWeb) {\n\t\t\treturn []; // script is inlined\n\t\t}\n\n\t\treturn [\n\t\t\tdirname(FileAccess.asFileUri('vs/loader.js')),\n\t\t];\n\t}\n\n\tprivate _initialize(content: string): Promise<void> {\n\t\tif (!document.body.contains(this.element)) {\n\t\t\tthrow new Error('Element is already detached from the DOM tree');\n\t\t}\n\n\t\tthis.webview = this._createInset(this.webviewService, content);\n\t\tthis.webview.mountTo(this.element);\n\t\tthis._register(this.webview);\n\n\t\tthis._register(new WebviewWindowDragMonitor(() => this.webview));\n\n\t\tconst initializePromise = new DeferredPromise<void>();\n\n\t\tthis._register(this.webview.onFatalError(e => {\n\t\t\tinitializePromise.error(new Error(`Could not initialize webview: ${e.message}}`));\n\t\t}));\n\n\t\tthis._register(this.webview.onMessage(async (message) => {\n\t\t\tconst data: FromWebviewMessage | { readonly __vscode_notebook_message: undefined } = message.message;\n\t\t\tif (this._disposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!data.__vscode_notebook_message) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (data.type) {\n\t\t\t\tcase 'initialized': {\n\t\t\t\t\tinitializePromise.complete();\n\t\t\t\t\tthis.initializeWebViewState();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'initializedMarkup': {\n\t\t\t\t\tif (this.initializeMarkupPromise?.requestId === data.requestId) {\n\t\t\t\t\t\tthis.initializeMarkupPromise?.p.complete();\n\t\t\t\t\t\tthis.initializeMarkupPromise = undefined;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'dimension': {\n\t\t\t\t\tfor (const update of data.updates) {\n\t\t\t\t\t\tconst height = update.height;\n\t\t\t\t\t\tif (update.isOutput) {\n\t\t\t\t\t\t\tconst resolvedResult = this.resolveOutputId(update.id);\n\t\t\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\t\t\tconst { cellInfo, output } = resolvedResult;\n\t\t\t\t\t\t\t\tthis.notebookEditor.updateOutputHeight(cellInfo, output, height, !!update.init, 'webview#dimension');\n\t\t\t\t\t\t\t\tthis.notebookEditor.scheduleOutputHeightAck(cellInfo, update.id, height);\n\t\t\t\t\t\t\t} else if (update.init) {\n\t\t\t\t\t\t\t\t// might be idle render request's ack\n\t\t\t\t\t\t\t\tconst outputRequest = this.reversedPendingWebviewIdleInsetMapping.get(update.id);\n\t\t\t\t\t\t\t\tif (outputRequest) {\n\t\t\t\t\t\t\t\t\tconst inset = this.pendingWebviewIdleInsetMapping.get(outputRequest)!;\n\n\t\t\t\t\t\t\t\t\t// clear the pending mapping\n\t\t\t\t\t\t\t\t\tthis.pendingWebviewIdleCreationRequest.delete(outputRequest);\n\t\t\t\t\t\t\t\t\tthis.pendingWebviewIdleCreationRequest.delete(outputRequest);\n\n\t\t\t\t\t\t\t\t\tconst cellInfo = inset.cellInfo;\n\t\t\t\t\t\t\t\t\tthis.reversedInsetMapping.set(update.id, outputRequest);\n\t\t\t\t\t\t\t\t\tthis.insetMapping.set(outputRequest, inset);\n\t\t\t\t\t\t\t\t\tthis.notebookEditor.updateOutputHeight(cellInfo, outputRequest, height, !!update.init, 'webview#dimension');\n\t\t\t\t\t\t\t\t\tthis.notebookEditor.scheduleOutputHeightAck(cellInfo, update.id, height);\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.reversedPendingWebviewIdleInsetMapping.delete(update.id);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (!update.init) {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tconst output = this.reversedInsetMapping.get(update.id);\n\n\t\t\t\t\t\t\t\tif (!output) {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tconst inset = this.insetMapping.get(output)!;\n\t\t\t\t\t\t\t\tinset.initialized = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.notebookEditor.updateMarkupCellHeight(update.id, height, !!update.init);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'mouseenter': {\n\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\tif (latestCell) {\n\t\t\t\t\t\t\tlatestCell.outputIsHovered = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'mouseleave': {\n\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\tif (latestCell) {\n\t\t\t\t\t\t\tlatestCell.outputIsHovered = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'outputFocus': {\n\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\tif (latestCell) {\n\t\t\t\t\t\t\tlatestCell.outputIsFocused = true;\n\t\t\t\t\t\t\tthis.notebookEditor.focusNotebookCell(latestCell, 'output', { skipReveal: true });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'outputBlur': {\n\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\tif (latestCell) {\n\t\t\t\t\t\t\tlatestCell.outputIsFocused = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'scroll-ack': {\n\t\t\t\t\t// const date = new Date();\n\t\t\t\t\t// const top = data.data.top;\n\t\t\t\t\t// console.log('ack top ', top, ' version: ', data.version, ' - ', date.getMinutes() + ':' + date.getSeconds() + ':' + date.getMilliseconds());\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'scroll-to-reveal': {\n\t\t\t\t\tthis.notebookEditor.setScrollTop(data.scrollTop - NOTEBOOK_WEBVIEW_BOUNDARY);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'did-scroll-wheel': {\n\t\t\t\t\tthis.notebookEditor.triggerScroll({\n\t\t\t\t\t\t...data.payload,\n\t\t\t\t\t\tpreventDefault: () => { },\n\t\t\t\t\t\tstopPropagation: () => { }\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'focus-editor': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell) {\n\t\t\t\t\t\tif (data.focusNext) {\n\t\t\t\t\t\t\tthis.notebookEditor.focusNextNotebookCell(cell, 'editor');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tawait this.notebookEditor.focusNotebookCell(cell, 'editor');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'clicked-data-url': {\n\t\t\t\t\tthis._onDidClickDataLink(data);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'clicked-link': {\n\t\t\t\t\tif (matchesScheme(data.href, Schemas.command)) {\n\t\t\t\t\t\tconst uri = URI.parse(data.href);\n\n\t\t\t\t\t\tif (uri.path === 'workbench.action.openLargeOutput') {\n\t\t\t\t\t\t\tconst outputId = uri.query;\n\t\t\t\t\t\t\tconst group = this.editorGroupService.activeGroup;\n\t\t\t\t\t\t\tif (group) {\n\t\t\t\t\t\t\t\tif (group.activeEditor) {\n\t\t\t\t\t\t\t\t\tgroup.pinEditor(group.activeEditor);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.openerService.open(CellUri.generateCellOutputUri(this.documentUri, outputId));\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (uri.path === 'cellOutput.enableScrolling') {\n\t\t\t\t\t\t\tconst outputId = uri.query;\n\t\t\t\t\t\t\tconst cell = this.reversedInsetMapping.get(outputId);\n\n\t\t\t\t\t\t\tif (cell) {\n\t\t\t\t\t\t\t\tthis.telemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>\n\t\t\t\t\t\t\t\t\t('workbenchActionExecuted', { id: 'notebook.cell.toggleOutputScrolling', from: 'inlineLink' });\n\n\t\t\t\t\t\t\t\tcell.cellViewModel.outputsViewModels.forEach((vm) => {\n\t\t\t\t\t\t\t\t\tif (vm.model.metadata) {\n\t\t\t\t\t\t\t\t\t\tvm.model.metadata['scrollable'] = true;\n\t\t\t\t\t\t\t\t\t\tvm.resetRenderer();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// We allow a very limited set of commands\n\t\t\t\t\t\tthis.openerService.open(data.href, {\n\t\t\t\t\t\t\tfromUserGesture: true,\n\t\t\t\t\t\t\tfromWorkspace: true,\n\t\t\t\t\t\t\tallowCommands: [\n\t\t\t\t\t\t\t\t'github-issues.authNow',\n\t\t\t\t\t\t\t\t'workbench.extensions.search',\n\t\t\t\t\t\t\t\t'workbench.action.openSettings',\n\t\t\t\t\t\t\t\t'_notebook.selectKernel',\n\t\t\t\t\t\t\t\t// TODO@rebornix explore open output channel with name command\n\t\t\t\t\t\t\t\t'jupyter.viewOutput'\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (matchesSomeScheme(data.href, Schemas.http, Schemas.https, Schemas.mailto)) {\n\t\t\t\t\t\tthis.openerService.open(data.href, { fromUserGesture: true, fromWorkspace: true });\n\t\t\t\t\t} else if (matchesScheme(data.href, Schemas.vscodeNotebookCell)) {\n\t\t\t\t\t\tconst uri = URI.parse(data.href);\n\t\t\t\t\t\tthis._handleNotebookCellResource(uri);\n\t\t\t\t\t} else if (!/^[\\w\\-]+:/.test(data.href)) {\n\t\t\t\t\t\t// Uri without scheme, such as a file path\n\t\t\t\t\t\tthis._handleResourceOpening(tryDecodeURIComponent(data.href));\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// uri with scheme\n\t\t\t\t\t\tif (osPath.isAbsolute(data.href)) {\n\t\t\t\t\t\t\tthis._openUri(URI.file(data.href));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._openUri(URI.parse(data.href));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'customKernelMessage': {\n\t\t\t\t\tthis._onMessage.fire({ message: data.message });\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'customRendererMessage': {\n\t\t\t\t\tthis.rendererMessaging?.postMessage(data.rendererId, data.message);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'clickMarkupCell': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell) {\n\t\t\t\t\t\tif (data.shiftKey || (isMacintosh ? data.metaKey : data.ctrlKey)) {\n\t\t\t\t\t\t\t// Modify selection\n\t\t\t\t\t\t\tthis.notebookEditor.toggleNotebookCellSelection(cell, /* fromPrevious */ data.shiftKey);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Normal click\n\t\t\t\t\t\t\tawait this.notebookEditor.focusNotebookCell(cell, 'container', { skipReveal: true });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'contextMenuMarkupCell': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell) {\n\t\t\t\t\t\t// Focus the cell first\n\t\t\t\t\t\tawait this.notebookEditor.focusNotebookCell(cell, 'container', { skipReveal: true });\n\n\t\t\t\t\t\t// Then show the context menu\n\t\t\t\t\t\tconst webviewRect = this.element.getBoundingClientRect();\n\t\t\t\t\t\tthis.contextMenuService.showContextMenu({\n\t\t\t\t\t\t\tmenuId: MenuId.NotebookCellTitle,\n\t\t\t\t\t\t\tcontextKeyService: this.contextKeyService,\n\t\t\t\t\t\t\tgetAnchor: () => ({\n\t\t\t\t\t\t\t\tx: webviewRect.x + data.clientX,\n\t\t\t\t\t\t\t\ty: webviewRect.y + data.clientY\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'toggleMarkupPreview': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell && !this.notebookEditor.creationOptions.isReadOnly) {\n\t\t\t\t\t\tthis.notebookEditor.setMarkupCellEditState(data.cellId, CellEditState.Editing);\n\t\t\t\t\t\tawait this.notebookEditor.focusNotebookCell(cell, 'editor', { skipReveal: true });\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'mouseEnterMarkupCell': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell instanceof MarkupCellViewModel) {\n\t\t\t\t\t\tcell.cellIsHovered = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'mouseLeaveMarkupCell': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell instanceof MarkupCellViewModel) {\n\t\t\t\t\t\tcell.cellIsHovered = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'cell-drag-start': {\n\t\t\t\t\tthis.notebookEditor.didStartDragMarkupCell(data.cellId, data);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'cell-drag': {\n\t\t\t\t\tthis.notebookEditor.didDragMarkupCell(data.cellId, data);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'cell-drop': {\n\t\t\t\t\tthis.notebookEditor.didDropMarkupCell(data.cellId, {\n\t\t\t\t\t\tdragOffsetY: data.dragOffsetY,\n\t\t\t\t\t\tctrlKey: data.ctrlKey,\n\t\t\t\t\t\taltKey: data.altKey,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'cell-drag-end': {\n\t\t\t\t\tthis.notebookEditor.didEndDragMarkupCell(data.cellId);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'renderedMarkup': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell instanceof MarkupCellViewModel) {\n\t\t\t\t\t\tcell.renderedHtml = data.html;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._handleHighlightCodeBlock(data.codeBlocks);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'renderedCellOutput': {\n\t\t\t\t\tthis._handleHighlightCodeBlock(data.codeBlocks);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'outputResized': {\n\t\t\t\t\tthis.notebookEditor.didResizeOutput(data.cellId);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'getOutputItem': {\n\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.outputId);\n\t\t\t\t\tconst output = resolvedResult?.output.model.outputs.find(output => output.mime === data.mime);\n\n\t\t\t\t\tthis._sendMessageToWebview({\n\t\t\t\t\t\ttype: 'returnOutputItem',\n\t\t\t\t\t\trequestId: data.requestId,\n\t\t\t\t\t\toutput: output ? { mime: output.mime, valueBytes: output.data.buffer } : undefined,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'logRendererDebugMessage': {\n\t\t\t\t\tthis._logRendererDebugMessage(`${data.message}${data.data ? ' ' + JSON.stringify(data.data, null, 4) : ''}`);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'notebookPerformanceMessage': {\n\t\t\t\t\tthis.notebookEditor.updatePerformanceMetadata(data.cellId, data.executionId, data.duration, data.rendererId);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'outputInputFocus': {\n\t\t\t\t\tthis.notebookEditor.didFocusOutputInputChange(data.inputFocused);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\treturn initializePromise.p;\n\t}\n\n\tprivate _handleNotebookCellResource(uri: URI) {\n\t\tconst lineMatch = /\\?line=(\\d+)$/.exec(uri.fragment);\n\t\tif (lineMatch) {\n\t\t\tconst parsedLineNumber = parseInt(lineMatch[1], 10);\n\t\t\tif (!isNaN(parsedLineNumber)) {\n\t\t\t\tconst lineNumber = parsedLineNumber + 1;\n\t\t\t\tconst fragment = uri.fragment.substring(0, lineMatch.index);\n\n\t\t\t\t// open the uri with selection\n\t\t\t\tconst editorOptions: ITextEditorOptions = {\n\t\t\t\t\tselection: { startLineNumber: lineNumber, startColumn: 1, endLineNumber: lineNumber, endColumn: 1 }\n\t\t\t\t};\n\t\t\t\tthis.openerService.open(uri.with({ fragment }), {\n\t\t\t\t\tfromUserGesture: true,\n\t\t\t\t\tfromWorkspace: true,\n\t\t\t\t\teditorOptions: editorOptions\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.openerService.open(uri, { fromUserGesture: true, fromWorkspace: true });\n\t\treturn uri;\n\t}\n\n\tprivate _handleResourceOpening(href: string) {\n\t\tlet linkToOpen: URI | undefined = undefined;\n\t\tif (href.startsWith('/')) {\n\t\t\tlinkToOpen = URI.parse(href);\n\t\t} else if (href.startsWith('~')) {\n\t\t\tconst userHome = this.pathService.resolvedUserHome;\n\t\t\tif (userHome) {\n\t\t\t\tlinkToOpen = URI.parse(osPath.join(userHome.fsPath, href.substring(1)));\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.documentUri.scheme === Schemas.untitled) {\n\t\t\t\tconst folders = this.workspaceContextService.getWorkspace().folders;\n\t\t\t\tif (!folders.length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlinkToOpen = URI.joinPath(folders[0].uri, href);\n\t\t\t} else {\n\t\t\t\t// Resolve relative to notebook document\n\t\t\t\tlinkToOpen = URI.joinPath(dirname(this.documentUri), href);\n\t\t\t}\n\t\t}\n\n\t\tif (linkToOpen) {\n\t\t\tthis._openUri(linkToOpen);\n\t\t}\n\t}\n\n\tprivate _openUri(uri: URI) {\n\t\tlet lineNumber: number | undefined = undefined;\n\t\tlet column: number | undefined = undefined;\n\t\tconst lineCol = LINE_COLUMN_REGEX.exec(uri.path);\n\t\tif (lineCol) {\n\t\t\turi = uri.with({\n\t\t\t\tpath: uri.path.slice(0, lineCol.index),\n\t\t\t\tfragment: `L${lineCol[0].slice(1)}`\n\t\t\t});\n\t\t\tlineNumber = parseInt(lineCol[1], 10);\n\t\t\tcolumn = parseInt(lineCol[2], 10);\n\t\t}\n\n\t\t//#region error renderer migration, remove once done\n\t\tconst lineMatch = LineQueryRegex.exec(uri.query);\n\t\tif (lineMatch) {\n\t\t\tconst parsedLineNumber = parseInt(lineMatch[1], 10);\n\t\t\tif (!isNaN(parsedLineNumber)) {\n\t\t\t\tlineNumber = parsedLineNumber + 1;\n\t\t\t\tcolumn = 1;\n\t\t\t\turi = uri.with({ fragment: `L${lineNumber}` });\n\t\t\t}\n\t\t}\n\n\t\turi = uri.with({\n\t\t\tquery: null\n\t\t});\n\t\t//#endregion\n\n\t\tlet match: { group: IEditorGroup; editor: EditorInput } | undefined = undefined;\n\n\t\tfor (const group of this.editorGroupService.groups) {\n\t\t\tconst editorInput = group.editors.find(editor => editor.resource && isEqual(editor.resource, uri, true));\n\t\t\tif (editorInput) {\n\t\t\t\tmatch = { group, editor: editorInput };\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (match) {\n\t\t\tmatch.group.openEditor(match.editor, lineNumber !== undefined && column !== undefined ? <ITextEditorOptions>{ selection: { startLineNumber: lineNumber, startColumn: column } } : undefined);\n\t\t} else {\n\t\t\tthis.openerService.open(uri, { fromUserGesture: true, fromWorkspace: true });\n\t\t}\n\t}\n\n\tprivate _handleHighlightCodeBlock(codeBlocks: ReadonlyArray<ICodeBlockHighlightRequest>) {\n\t\tfor (const { id, value, lang } of codeBlocks) {\n\t\t\t// The language id may be a language aliases (e.g.js instead of javascript)\n\t\t\tconst languageId = this.languageService.getLanguageIdByLanguageName(lang);\n\t\t\tif (!languageId) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttokenizeToString(this.languageService, value, languageId).then((html) => {\n\t\t\t\tif (this._disposed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis._sendMessageToWebview({\n\t\t\t\t\ttype: 'tokenizedCodeBlock',\n\t\t\t\t\thtml,\n\t\t\t\t\tcodeBlockId: id\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\tprivate async _onDidClickDataLink(event: IClickedDataUrlMessage): Promise<void> {\n\t\tif (typeof event.data !== 'string') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst [splitStart, splitData] = event.data.split(';base64,');\n\t\tif (!splitData || !splitStart) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst defaultDir = extname(this.documentUri) === '.interactive' ?\n\t\t\tthis.workspaceContextService.getWorkspace().folders[0]?.uri ?? await this.fileDialogService.defaultFilePath() :\n\t\t\tdirname(this.documentUri);\n\t\tlet defaultName: string;\n\t\tif (event.downloadName) {\n\t\t\tdefaultName = event.downloadName;\n\t\t} else {\n\t\t\tconst mimeType = splitStart.replace(/^data:/, '');\n\t\t\tconst candidateExtension = mimeType && getExtensionForMimeType(mimeType);\n\t\t\tdefaultName = candidateExtension ? `download${candidateExtension}` : 'download';\n\t\t}\n\n\t\tconst defaultUri = joinPath(defaultDir, defaultName);\n\t\tconst newFileUri = await this.fileDialogService.showSaveDialog({\n\t\t\tdefaultUri\n\t\t});\n\t\tif (!newFileUri) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst buff = decodeBase64(splitData);\n\t\tawait this.fileService.writeFile(newFileUri, buff);\n\t\tawait this.openerService.open(newFileUri);\n\t}\n\n\tprivate _createInset(webviewService: IWebviewService, content: string) {\n\t\tthis.localResourceRootsCache = this._getResourceRootsCache();\n\t\tconst webview = webviewService.createWebviewElement({\n\t\t\torigin: BackLayerWebView.getOriginStore(this.storageService).getOrigin(this.notebookViewType, undefined),\n\t\t\ttitle: nls.localize('webview title', \"Notebook webview content\"),\n\t\t\toptions: {\n\t\t\t\tpurpose: WebviewContentPurpose.NotebookRenderer,\n\t\t\t\tenableFindWidget: false,\n\t\t\t\ttransformCssVariables: transformWebviewThemeVars,\n\t\t\t},\n\t\t\tcontentOptions: {\n\t\t\t\tallowMultipleAPIAcquire: true,\n\t\t\t\tallowScripts: true,\n\t\t\t\tlocalResourceRoots: this.localResourceRootsCache,\n\t\t\t},\n\t\t\textension: undefined,\n\t\t\tprovidedViewType: 'notebook.output'\n\t\t});\n\n\t\twebview.setHtml(content);\n\t\twebview.setContextKeyService(this.contextKeyService);\n\t\treturn webview;\n\t}\n\n\tprivate _getResourceRootsCache(): URI[] {\n\t\tconst workspaceFolders = this.contextService.getWorkspace().folders.map(x => x.uri);\n\t\tconst notebookDir = this.getNotebookBaseUri();\n\t\treturn [\n\t\t\tthis.notebookService.getNotebookProviderResourceRoots(),\n\t\t\tthis.notebookService.getRenderers().map(x => dirname(x.entrypoint.path)),\n\t\t\t...Array.from(this.notebookService.getStaticPreloads(this.notebookViewType), x => [\n\t\t\t\tdirname(x.entrypoint),\n\t\t\t\t...x.localResourceRoots,\n\t\t\t]),\n\t\t\tworkspaceFolders,\n\t\t\tnotebookDir,\n\t\t\tthis.getBuiltinLocalResourceRoots()\n\t\t].flat();\n\t}\n\n\tprivate initializeWebViewState() {\n\t\tthis._preloadsCache.clear();\n\t\tif (this._currentKernel) {\n\t\t\tthis._updatePreloadsFromKernel(this._currentKernel);\n\t\t}\n\n\t\tfor (const [output, inset] of this.insetMapping.entries()) {\n\t\t\tthis._sendMessageToWebview({ ...inset.cachedCreation, initiallyHidden: this.hiddenInsetMapping.has(output) });\n\t\t}\n\n\t\tif (this.initializeMarkupPromise?.isFirstInit) {\n\t\t\t// On first run the contents have already been initialized so we don't need to init them again\n\t\t\t// no op\n\t\t} else {\n\t\t\tconst mdCells = [...this.markupPreviewMapping.values()];\n\t\t\tthis.markupPreviewMapping.clear();\n\t\t\tthis.initializeMarkup(mdCells);\n\t\t}\n\n\t\tthis._updateStyles();\n\t\tthis._updateOptions();\n\t}\n\n\tprivate shouldUpdateInset(cell: IGenericCellViewModel, output: ICellOutputViewModel, cellTop: number, outputOffset: number): boolean {\n\t\tif (this._disposed) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ('isOutputCollapsed' in cell && (cell as ICellViewModel).isOutputCollapsed) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.hiddenInsetMapping.has(output)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst outputCache = this.insetMapping.get(output);\n\t\tif (!outputCache) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (outputOffset === outputCache.cachedCreation.outputOffset && cellTop === outputCache.cachedCreation.cellTop) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tackHeight(updates: readonly IAckOutputHeight[]): void {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'ack-dimension',\n\t\t\tupdates\n\t\t});\n\t}\n\n\tupdateScrollTops(outputRequests: IDisplayOutputLayoutUpdateRequest[], markupPreviews: { id: string; top: number }[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst widgets = coalesce(outputRequests.map((request): IContentWidgetTopRequest | undefined => {\n\t\t\tconst outputCache = this.insetMapping.get(request.output);\n\t\t\tif (!outputCache) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!request.forceDisplay && !this.shouldUpdateInset(request.cell, request.output, request.cellTop, request.outputOffset)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst id = outputCache.outputId;\n\t\t\toutputCache.cachedCreation.cellTop = request.cellTop;\n\t\t\toutputCache.cachedCreation.outputOffset = request.outputOffset;\n\t\t\tthis.hiddenInsetMapping.delete(request.output);\n\n\t\t\treturn {\n\t\t\t\tcellId: request.cell.id,\n\t\t\t\toutputId: id,\n\t\t\t\tcellTop: request.cellTop,\n\t\t\t\toutputOffset: request.outputOffset,\n\t\t\t\tforceDisplay: request.forceDisplay,\n\t\t\t};\n\t\t}));\n\n\t\tif (!widgets.length && !markupPreviews.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'view-scroll',\n\t\t\twidgets: widgets,\n\t\t\tmarkupCells: markupPreviews,\n\t\t});\n\t}\n\n\tprivate async createMarkupPreview(initialization: IMarkupCellInitialization) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.markupPreviewMapping.has(initialization.cellId)) {\n\t\t\tconsole.error('Trying to create markup preview that already exists');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.markupPreviewMapping.set(initialization.cellId, initialization);\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'createMarkupCell',\n\t\t\tcell: initialization\n\t\t});\n\t}\n\n\tasync showMarkupPreview(newContent: IMarkupCellInitialization) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst entry = this.markupPreviewMapping.get(newContent.cellId);\n\t\tif (!entry) {\n\t\t\treturn this.createMarkupPreview(newContent);\n\t\t}\n\n\t\tconst sameContent = newContent.content === entry.content;\n\t\tconst sameMetadata = (equals(newContent.metadata, entry.metadata));\n\t\tif (!sameContent || !sameMetadata || !entry.visible) {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'showMarkupCell',\n\t\t\t\tid: newContent.cellId,\n\t\t\t\thandle: newContent.cellHandle,\n\t\t\t\t// If the content has not changed, we still want to make sure the\n\t\t\t\t// preview is visible but don't need to send anything over\n\t\t\t\tcontent: sameContent ? undefined : newContent.content,\n\t\t\t\ttop: newContent.offset,\n\t\t\t\tmetadata: sameMetadata ? undefined : newContent.metadata\n\t\t\t});\n\t\t}\n\t\tentry.metadata = newContent.metadata;\n\t\tentry.content = newContent.content;\n\t\tentry.offset = newContent.offset;\n\t\tentry.visible = true;\n\t}\n\n\tasync hideMarkupPreviews(cellIds: readonly string[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cellsToHide: string[] = [];\n\t\tfor (const cellId of cellIds) {\n\t\t\tconst entry = this.markupPreviewMapping.get(cellId);\n\t\t\tif (entry) {\n\t\t\t\tif (entry.visible) {\n\t\t\t\t\tcellsToHide.push(cellId);\n\t\t\t\t\tentry.visible = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (cellsToHide.length) {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'hideMarkupCells',\n\t\t\t\tids: cellsToHide\n\t\t\t});\n\t\t}\n\t}\n\n\tasync unhideMarkupPreviews(cellIds: readonly string[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst toUnhide: string[] = [];\n\t\tfor (const cellId of cellIds) {\n\t\t\tconst entry = this.markupPreviewMapping.get(cellId);\n\t\t\tif (entry) {\n\t\t\t\tif (!entry.visible) {\n\t\t\t\t\tentry.visible = true;\n\t\t\t\t\ttoUnhide.push(cellId);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.error(`Trying to unhide a preview that does not exist: ${cellId}`);\n\t\t\t}\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'unhideMarkupCells',\n\t\t\tids: toUnhide,\n\t\t});\n\t}\n\n\tasync deleteMarkupPreviews(cellIds: readonly string[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const id of cellIds) {\n\t\t\tif (!this.markupPreviewMapping.has(id)) {\n\t\t\t\tconsole.error(`Trying to delete a preview that does not exist: ${id}`);\n\t\t\t}\n\t\t\tthis.markupPreviewMapping.delete(id);\n\t\t}\n\n\t\tif (cellIds.length) {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'deleteMarkupCell',\n\t\t\t\tids: cellIds\n\t\t\t});\n\t\t}\n\t}\n\n\tasync updateMarkupPreviewSelections(selectedCellsIds: string[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'updateSelectedMarkupCells',\n\t\t\tselectedCellIds: selectedCellsIds.filter(id => this.markupPreviewMapping.has(id)),\n\t\t});\n\t}\n\n\tasync initializeMarkup(cells: readonly IMarkupCellInitialization[]): Promise<void> {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.initializeMarkupPromise?.p.complete();\n\t\tconst requestId = UUID.generateUuid();\n\t\tthis.initializeMarkupPromise = { p: new DeferredPromise(), requestId, isFirstInit: this.firstInit };\n\n\t\tthis.firstInit = false;\n\n\t\tfor (const cell of cells) {\n\t\t\tthis.markupPreviewMapping.set(cell.cellId, cell);\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'initializeMarkup',\n\t\t\tcells,\n\t\t\trequestId,\n\t\t});\n\n\t\treturn this.initializeMarkupPromise.p.p;\n\t}\n\n\t/**\n\t * Validate if cached inset is out of date and require a rerender\n\t * Note that it doesn't account for output content change.\n\t */\n\tprivate _cachedInsetEqual(cachedInset: ICachedInset<T>, content: IInsetRenderOutput) {\n\t\tif (content.type === RenderOutputType.Extension) {\n\t\t\t// Use a new renderer\n\t\t\treturn cachedInset.renderer?.id === content.renderer.id;\n\t\t} else {\n\t\t\t// The new renderer is the default HTML renderer\n\t\t\treturn cachedInset.cachedCreation.type === 'html';\n\t\t}\n\t}\n\n\trequestCreateOutputWhenWebviewIdle(cellInfo: T, content: IInsetRenderOutput, cellTop: number, offset: number) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.insetMapping.has(content.source)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.pendingWebviewIdleCreationRequest.has(content.source)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.pendingWebviewIdleInsetMapping.has(content.source)) {\n\t\t\t// handled in renderer process, waiting for webview to process it when idle\n\t\t\treturn;\n\t\t}\n\n\t\tthis.pendingWebviewIdleCreationRequest.set(content.source, runWhenIdle(() => {\n\t\t\tconst { message, renderer, transfer: transferable } = this._createOutputCreationMessage(cellInfo, content, cellTop, offset, true, true);\n\t\t\tthis._sendMessageToWebview(message, transferable);\n\t\t\tthis.pendingWebviewIdleInsetMapping.set(content.source, { outputId: message.outputId, versionId: content.source.model.versionId, cellInfo: cellInfo, renderer, cachedCreation: message });\n\t\t\tthis.reversedPendingWebviewIdleInsetMapping.set(message.outputId, content.source);\n\t\t\tthis.pendingWebviewIdleCreationRequest.delete(content.source);\n\t\t}));\n\t}\n\n\tcreateOutput(cellInfo: T, content: IInsetRenderOutput, cellTop: number, offset: number): void {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cachedInset = this.insetMapping.get(content.source);\n\n\t\t// we now request to render the output immediately, so we can remove the pending request\n\t\t// dispose the pending request in renderer process if it exists\n\t\tthis.pendingWebviewIdleCreationRequest.get(content.source)?.dispose();\n\t\tthis.pendingWebviewIdleCreationRequest.delete(content.source);\n\n\t\t// if request has already been sent out, we then remove it from the pending mapping\n\t\tthis.pendingWebviewIdleInsetMapping.delete(content.source);\n\t\tif (cachedInset) {\n\t\t\tthis.reversedPendingWebviewIdleInsetMapping.delete(cachedInset.outputId);\n\t\t}\n\n\t\tif (cachedInset && this._cachedInsetEqual(cachedInset, content)) {\n\t\t\tthis.hiddenInsetMapping.delete(content.source);\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'showOutput',\n\t\t\t\tcellId: cachedInset.cellInfo.cellId,\n\t\t\t\toutputId: cachedInset.outputId,\n\t\t\t\tcellTop: cellTop,\n\t\t\t\toutputOffset: offset\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\t// create new output\n\t\tconst { message, renderer, transfer: transferable } = this._createOutputCreationMessage(cellInfo, content, cellTop, offset, false, false);\n\t\tthis._sendMessageToWebview(message, transferable);\n\t\tthis.insetMapping.set(content.source, { outputId: message.outputId, versionId: content.source.model.versionId, cellInfo: cellInfo, renderer, cachedCreation: message });\n\t\tthis.hiddenInsetMapping.delete(content.source);\n\t\tthis.reversedInsetMapping.set(message.outputId, content.source);\n\t}\n\n\tprivate createMetadata(output: ICellOutput, mimeType: string) {\n\t\tif (mimeType.startsWith('image')) {\n\t\t\tconst buffer = output.outputs.find(out => out.mime === 'text/plain')?.data.buffer;\n\t\t\tif (buffer?.length && buffer?.length > 0) {\n\t\t\t\tconst altText = new TextDecoder().decode(buffer);\n\t\t\t\treturn { ...output.metadata, vscode_altText: altText };\n\t\t\t}\n\t\t}\n\t\treturn output.metadata;\n\t}\n\n\tprivate _createOutputCreationMessage(cellInfo: T, content: IInsetRenderOutput, cellTop: number, offset: number, createOnIdle: boolean, initiallyHidden: boolean): { readonly message: ICreationRequestMessage; readonly renderer: INotebookRendererInfo | undefined; transfer: readonly ArrayBuffer[] } {\n\t\tconst messageBase = {\n\t\t\ttype: 'html',\n\t\t\texecutionId: cellInfo.executionId,\n\t\t\tcellId: cellInfo.cellId,\n\t\t\tcellTop: cellTop,\n\t\t\toutputOffset: offset,\n\t\t\tleft: 0,\n\t\t\trequiredPreloads: [],\n\t\t\tcreateOnIdle: createOnIdle\n\t\t} as const;\n\n\t\tconst transfer: ArrayBuffer[] = [];\n\n\t\tlet message: ICreationRequestMessage;\n\t\tlet renderer: INotebookRendererInfo | undefined;\n\t\tif (content.type === RenderOutputType.Extension) {\n\t\t\tconst output = content.source.model;\n\t\t\trenderer = content.renderer;\n\t\t\tconst first = output.outputs.find(op => op.mime === content.mimeType)!;\n\t\t\tconst metadata = this.createMetadata(output, content.mimeType);\n\t\t\tconst valueBytes = copyBufferIfNeeded(first.data.buffer, transfer);\n\t\t\tmessage = {\n\t\t\t\t...messageBase,\n\t\t\t\toutputId: output.outputId,\n\t\t\t\trendererId: content.renderer.id,\n\t\t\t\tcontent: {\n\t\t\t\t\ttype: RenderOutputType.Extension,\n\t\t\t\t\toutputId: output.outputId,\n\t\t\t\t\tmetadata: metadata,\n\t\t\t\t\toutput: {\n\t\t\t\t\t\tmime: first.mime,\n\t\t\t\t\t\tvalueBytes,\n\t\t\t\t\t},\n\t\t\t\t\tallOutputs: output.outputs.map(output => ({ mime: output.mime })),\n\t\t\t\t},\n\t\t\t\tinitiallyHidden: initiallyHidden\n\t\t\t};\n\t\t} else {\n\t\t\tmessage = {\n\t\t\t\t...messageBase,\n\t\t\t\toutputId: UUID.generateUuid(),\n\t\t\t\tcontent: {\n\t\t\t\t\ttype: content.type,\n\t\t\t\t\thtmlContent: content.htmlContent,\n\t\t\t\t},\n\t\t\t\tinitiallyHidden: initiallyHidden\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tmessage,\n\t\t\trenderer,\n\t\t\ttransfer,\n\t\t};\n\t}\n\n\tupdateOutput(cellInfo: T, content: IInsetRenderOutput, cellTop: number, offset: number): void {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.insetMapping.has(content.source)) {\n\t\t\tthis.createOutput(cellInfo, content, cellTop, offset);\n\t\t\treturn;\n\t\t}\n\n\t\tconst outputCache = this.insetMapping.get(content.source)!;\n\n\t\tif (outputCache.versionId === content.source.model.versionId) {\n\t\t\t// already sent this output version to the renderer\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hiddenInsetMapping.delete(content.source);\n\t\tlet updatedContent: ICreationContent | undefined = undefined;\n\n\t\tconst transfer: ArrayBuffer[] = [];\n\t\tif (content.type === RenderOutputType.Extension) {\n\t\t\tconst output = content.source.model;\n\t\t\tconst firstBuffer = output.outputs.find(op => op.mime === content.mimeType)!;\n\t\t\tconst appenededData = output.appendedSinceVersion(outputCache.versionId, content.mimeType);\n\t\t\tconst appended = appenededData ? { valueBytes: appenededData.buffer, previousVersion: outputCache.versionId } : undefined;\n\n\t\t\tconst valueBytes = copyBufferIfNeeded(firstBuffer.data.buffer, transfer);\n\t\t\tupdatedContent = {\n\t\t\t\ttype: RenderOutputType.Extension,\n\t\t\t\toutputId: outputCache.outputId,\n\t\t\t\tmetadata: output.metadata,\n\t\t\t\toutput: {\n\t\t\t\t\tmime: content.mimeType,\n\t\t\t\t\tvalueBytes,\n\t\t\t\t\tappended: appended\n\t\t\t\t},\n\t\t\t\tallOutputs: output.outputs.map(output => ({ mime: output.mime }))\n\t\t\t};\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'showOutput',\n\t\t\tcellId: outputCache.cellInfo.cellId,\n\t\t\toutputId: outputCache.outputId,\n\t\t\tcellTop: cellTop,\n\t\t\toutputOffset: offset,\n\t\t\tcontent: updatedContent\n\t\t}, transfer);\n\n\t\toutputCache.versionId = content.source.model.versionId;\n\t\treturn;\n\t}\n\n\tasync copyImage(output: ICellOutputViewModel): Promise<void> {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'copyImage',\n\t\t\toutputId: output.model.outputId,\n\t\t\taltOutputId: output.model.alternativeOutputId\n\t\t});\n\t}\n\n\tremoveInsets(outputs: readonly ICellOutputViewModel[]): void {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const output of outputs) {\n\t\t\tconst outputCache = this.insetMapping.get(output);\n\t\t\tif (!outputCache) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst id = outputCache.outputId;\n\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'clearOutput',\n\t\t\t\trendererId: outputCache.cachedCreation.rendererId,\n\t\t\t\tcellUri: outputCache.cellInfo.cellUri.toString(),\n\t\t\t\toutputId: id,\n\t\t\t\tcellId: outputCache.cellInfo.cellId\n\t\t\t});\n\t\t\tthis.insetMapping.delete(output);\n\t\t\tthis.pendingWebviewIdleCreationRequest.get(output)?.dispose();\n\t\t\tthis.pendingWebviewIdleCreationRequest.delete(output);\n\t\t\tthis.pendingWebviewIdleInsetMapping.delete(output);\n\t\t\tthis.reversedPendingWebviewIdleInsetMapping.delete(id);\n\t\t\tthis.reversedInsetMapping.delete(id);\n\t\t}\n\t}\n\n\thideInset(output: ICellOutputViewModel): void {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst outputCache = this.insetMapping.get(output);\n\t\tif (!outputCache) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hiddenInsetMapping.add(output);\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'hideOutput',\n\t\t\toutputId: outputCache.outputId,\n\t\t\tcellId: outputCache.cellInfo.cellId,\n\t\t});\n\t}\n\n\tfocusWebview() {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.webview?.focus();\n\t}\n\n\tfocusOutput(cellOrOutputId: string, alternateId: string | undefined, viewFocused: boolean) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!viewFocused) {\n\t\t\tthis.webview?.focus();\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'focus-output',\n\t\t\tcellOrOutputId: cellOrOutputId,\n\t\t\talternateId: alternateId\n\t\t});\n\t}\n\n\tasync find(query: string, options: { wholeWord?: boolean; caseSensitive?: boolean; includeMarkup: boolean; includeOutput: boolean; shouldGetSearchPreviewInfo: boolean; ownerID: string }): Promise<IFindMatch[]> {\n\t\tif (query === '') {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'findStop',\n\t\t\t\townerID: options.ownerID\n\t\t\t});\n\t\t\treturn [];\n\t\t}\n\n\t\tconst p = new Promise<IFindMatch[]>(resolve => {\n\t\t\tconst sub = this.webview?.onMessage(e => {\n\t\t\t\tif (e.message.type === 'didFind') {\n\t\t\t\t\tresolve(e.message.matches);\n\t\t\t\t\tsub?.dispose();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'find',\n\t\t\tquery: query,\n\t\t\toptions\n\t\t});\n\n\t\tconst ret = await p;\n\t\treturn ret;\n\t}\n\n\tfindStop(ownerID: string) {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'findStop',\n\t\t\townerID\n\t\t});\n\t}\n\n\tasync findHighlightCurrent(index: number, ownerID: string): Promise<number> {\n\t\tconst p = new Promise<number>(resolve => {\n\t\t\tconst sub = this.webview?.onMessage(e => {\n\t\t\t\tif (e.message.type === 'didFindHighlightCurrent') {\n\t\t\t\t\tresolve(e.message.offset);\n\t\t\t\t\tsub?.dispose();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'findHighlightCurrent',\n\t\t\tindex,\n\t\t\townerID\n\t\t});\n\n\t\tconst ret = await p;\n\t\treturn ret;\n\t}\n\n\tasync findUnHighlightCurrent(index: number, ownerID: string): Promise<void> {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'findUnHighlightCurrent',\n\t\t\tindex,\n\t\t\townerID\n\t\t});\n\t}\n\n\n\tdeltaCellContainerClassNames(cellId: string, added: string[], removed: string[]) {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'decorations',\n\t\t\tcellId,\n\t\t\taddedClassNames: added,\n\t\t\tremovedClassNames: removed\n\t\t});\n\n\t}\n\n\tupdateOutputRenderers() {\n\t\tif (!this.webview) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst renderersData = this.getRendererData();\n\t\tthis.localResourceRootsCache = this._getResourceRootsCache();\n\t\tconst mixedResourceRoots = [\n\t\t\t...(this.localResourceRootsCache || []),\n\t\t\t...(this._currentKernel ? [this._currentKernel.localResourceRoot] : []),\n\t\t];\n\n\t\tthis.webview.localResourcesRoot = mixedResourceRoots;\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'updateRenderers',\n\t\t\trendererData: renderersData\n\t\t});\n\t}\n\n\tasync updateKernelPreloads(kernel: INotebookKernel | undefined) {\n\t\tif (this._disposed || kernel === this._currentKernel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst previousKernel = this._currentKernel;\n\t\tthis._currentKernel = kernel;\n\n\t\tif (previousKernel && previousKernel.preloadUris.length > 0) {\n\t\t\tthis.webview?.reload(); // preloads will be restored after reload\n\t\t} else if (kernel) {\n\t\t\tthis._updatePreloadsFromKernel(kernel);\n\t\t}\n\t}\n\n\tprivate _updatePreloadsFromKernel(kernel: INotebookKernel) {\n\t\tconst resources: IControllerPreload[] = [];\n\t\tfor (const preload of kernel.preloadUris) {\n\t\t\tconst uri = this.environmentService.isExtensionDevelopment && (preload.scheme === 'http' || preload.scheme === 'https')\n\t\t\t\t? preload : this.asWebviewUri(preload, undefined);\n\n\t\t\tif (!this._preloadsCache.has(uri.toString())) {\n\t\t\t\tresources.push({ uri: uri.toString(), originalUri: preload.toString() });\n\t\t\t\tthis._preloadsCache.add(uri.toString());\n\t\t\t}\n\t\t}\n\n\t\tif (!resources.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._updatePreloads(resources);\n\t}\n\n\tprivate _updatePreloads(resources: IControllerPreload[]) {\n\t\tif (!this.webview) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst mixedResourceRoots = [\n\t\t\t...(this.localResourceRootsCache || []),\n\t\t\t...(this._currentKernel ? [this._currentKernel.localResourceRoot] : []),\n\t\t];\n\n\t\tthis.webview.localResourcesRoot = mixedResourceRoots;\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'preload',\n\t\t\tresources: resources,\n\t\t});\n\t}\n\n\tprivate _sendMessageToWebview(message: ToWebviewMessage, transfer?: readonly ArrayBuffer[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.webview?.postMessage(message, transfer);\n\t}\n\n\toverride dispose() {\n\t\tthis._disposed = true;\n\t\tthis.webview?.dispose();\n\t\tthis.webview = undefined;\n\t\tthis.notebookEditor = null!;\n\t\tthis.insetMapping.clear();\n\t\tthis.pendingWebviewIdleCreationRequest.clear();\n\t\tsuper.dispose();\n\t}\n}\n\nfunction copyBufferIfNeeded(buffer: Uint8Array, transfer: ArrayBuffer[]): Uint8Array {\n\tif (buffer.byteLength === buffer.buffer.byteLength) {\n\t\t// No copy needed but we can't transfer either\n\t\treturn buffer;\n\t} else {\n\t\t// The buffer is smaller than its backing array buffer.\n\t\t// Create a copy to avoid sending the entire array buffer.\n\t\tconst valueBytes = new Uint8Array(buffer);\n\t\ttransfer.push(valueBytes.buffer);\n\t\treturn valueBytes;\n\t}\n}\n\nfunction getTokenizationCss() {\n\tconst colorMap = TokenizationRegistry.getColorMap();\n\tconst tokenizationCss = colorMap ? generateTokensCSSForColorMap(colorMap) : '';\n\treturn tokenizationCss;\n}\n\nfunction tryDecodeURIComponent(uri: string) {\n\ttry {\n\t\treturn decodeURIComponent(uri);\n\t} catch {\n\t\treturn uri;\n\t}\n}\n"]}