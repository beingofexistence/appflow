{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts"],"names":[],"mappings":"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","file":"webviewPreloads.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { Event } from 'vs/base/common/event';\nimport type { IDisposable } from 'vs/base/common/lifecycle';\nimport type * as webviewMessages from 'vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages';\nimport type { NotebookCellMetadata } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport type * as rendererApi from 'vscode-notebook-renderer';\n\n// !! IMPORTANT !! ----------------------------------------------------------------------------------\n// import { RenderOutputType } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\n// We can ONLY IMPORT as type in this module. This also applies to const enums that would evaporate\n// in normal compiles but remain a dependency in transpile-only compiles\n// !! IMPORTANT !! ----------------------------------------------------------------------------------\n\n// !! IMPORTANT !! everything must be in-line within the webviewPreloads\n// function. Imports are not allowed. This is stringified and injected into\n// the webview.\n\ndeclare module globalThis {\n\tconst acquireVsCodeApi: () => ({\n\t\tgetState(): { [key: string]: unknown };\n\t\tsetState(data: { [key: string]: unknown }): void;\n\t\tpostMessage: (msg: unknown) => void;\n\t});\n}\n\ndeclare class ResizeObserver {\n\tconstructor(onChange: (entries: { target: HTMLElement; contentRect?: ClientRect }[]) => void);\n\tobserve(element: Element): void;\n\tdisconnect(): void;\n}\n\ndeclare class Highlight {\n\tconstructor();\n\tadd(range: AbstractRange): void;\n\tclear(): void;\n\tpriority: number;\n}\n\ninterface CSSHighlights {\n\tset(rule: string, highlight: Highlight): void;\n}\ndeclare namespace CSS {\n\tlet highlights: CSSHighlights | undefined;\n}\n\n\ntype Listener<T> = { fn: (evt: T) => void; thisArg: unknown };\n\ninterface EmitterLike<T> {\n\tfire(data: T): void;\n\tevent: Event<T>;\n}\n\ninterface PreloadStyles {\n\treadonly outputNodePadding: number;\n\treadonly outputNodeLeftPadding: number;\n\treadonly tokenizationCss: string;\n}\n\nexport interface PreloadOptions {\n\tdragAndDropEnabled: boolean;\n}\n\nexport interface RenderOptions {\n\treadonly lineLimit: number;\n\treadonly outputScrolling: boolean;\n\treadonly outputWordWrap: boolean;\n}\n\ninterface PreloadContext {\n\treadonly nonce: string;\n\treadonly style: PreloadStyles;\n\treadonly options: PreloadOptions;\n\treadonly renderOptions: RenderOptions;\n\treadonly rendererData: readonly webviewMessages.RendererMetadata[];\n\treadonly staticPreloadsData: readonly webviewMessages.StaticPreloadMetadata[];\n\treadonly isWorkspaceTrusted: boolean;\n}\n\ndeclare function requestIdleCallback(callback: (args: IdleDeadline) => void, options?: { timeout: number }): number;\ndeclare function cancelIdleCallback(handle: number): void;\n\ndeclare function __import(path: string): Promise<any>;\n\nasync function webviewPreloads(ctx: PreloadContext) {\n\tconst textEncoder = new TextEncoder();\n\tconst textDecoder = new TextDecoder();\n\n\tlet currentOptions = ctx.options;\n\tconst isWorkspaceTrusted = ctx.isWorkspaceTrusted;\n\tlet currentRenderOptions = ctx.renderOptions;\n\tconst settingChange: EmitterLike<RenderOptions> = createEmitter<RenderOptions>();\n\n\tconst acquireVsCodeApi = globalThis.acquireVsCodeApi;\n\tconst vscode = acquireVsCodeApi();\n\tdelete (globalThis as any).acquireVsCodeApi;\n\n\tconst tokenizationStyle = new CSSStyleSheet();\n\ttokenizationStyle.replaceSync(ctx.style.tokenizationCss);\n\n\tconst runWhenIdle: (callback: (idle: IdleDeadline) => void, timeout?: number) => IDisposable = (typeof requestIdleCallback !== 'function' || typeof cancelIdleCallback !== 'function')\n\t\t? (runner) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (disposed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst end = Date.now() + 15; // one frame at 64fps\n\t\t\t\trunner(Object.freeze({\n\t\t\t\t\tdidTimeout: true,\n\t\t\t\t\ttimeRemaining() {\n\t\t\t\t\t\treturn Math.max(0, end - Date.now());\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t});\n\t\t\tlet disposed = false;\n\t\t\treturn {\n\t\t\t\tdispose() {\n\t\t\t\t\tif (disposed) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tdisposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\t: (runner, timeout?) => {\n\t\t\tconst handle: number = requestIdleCallback(runner, typeof timeout === 'number' ? { timeout } : undefined);\n\t\t\tlet disposed = false;\n\t\t\treturn {\n\t\t\t\tdispose() {\n\t\t\t\t\tif (disposed) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tdisposed = true;\n\t\t\t\t\tcancelIdleCallback(handle);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t// check if an input element is focused within the output element\n\tconst checkOutputInputFocus = () => {\n\n\t\tconst activeElement = document.activeElement;\n\t\tif (!activeElement) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA') {\n\t\t\tpostNotebookMessage<webviewMessages.IOutputInputFocusMessage>('outputInputFocus', { inputFocused: true });\n\n\t\t\tactiveElement.addEventListener('blur', () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IOutputInputFocusMessage>('outputInputFocus', { inputFocused: false });\n\t\t\t}, { once: true });\n\t\t}\n\t};\n\n\tconst handleInnerClick = (event: MouseEvent) => {\n\t\tif (!event || !event.view || !event.view.document) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const node of event.composedPath()) {\n\t\t\tif (node instanceof HTMLElement && node.classList.contains('output')) {\n\t\t\t\t// output\n\t\t\t\tpostNotebookMessage<webviewMessages.IOutputFocusMessage>('outputFocus', {\n\t\t\t\t\tid: node.id,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tfor (const node of event.composedPath()) {\n\t\t\tif (node instanceof HTMLAnchorElement && node.href) {\n\t\t\t\tif (node.href.startsWith('blob:')) {\n\t\t\t\t\thandleBlobUrlClick(node.href, node.download);\n\t\t\t\t} else if (node.href.startsWith('data:')) {\n\t\t\t\t\thandleDataUrl(node.href, node.download);\n\t\t\t\t} else if (node.getAttribute('href')?.trim().startsWith('#')) {\n\t\t\t\t\t// Scrolling to location within current doc\n\n\t\t\t\t\tif (!node.hash) {\n\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IScrollToRevealMessage>('scroll-to-reveal', { scrollTop: 0 });\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst targetId = node.hash.substring(1);\n\n\t\t\t\t\t// Check outer document first\n\t\t\t\t\tlet scrollTarget: Element | null | undefined = event.view.document.getElementById(targetId);\n\n\t\t\t\t\tif (!scrollTarget) {\n\t\t\t\t\t\t// Fallback to checking preview shadow doms\n\t\t\t\t\t\tfor (const preview of event.view.document.querySelectorAll('.preview')) {\n\t\t\t\t\t\t\tscrollTarget = preview.shadowRoot?.getElementById(targetId);\n\t\t\t\t\t\t\tif (scrollTarget) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (scrollTarget) {\n\t\t\t\t\t\tconst scrollTop = scrollTarget.getBoundingClientRect().top + event.view.scrollY;\n\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IScrollToRevealMessage>('scroll-to-reveal', { scrollTop });\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst href = node.getAttribute('href');\n\t\t\t\t\tif (href) {\n\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IClickedLinkMessage>('clicked-link', { href });\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst handleDataUrl = async (data: string | ArrayBuffer | null, downloadName: string) => {\n\t\tpostNotebookMessage<webviewMessages.IClickedDataUrlMessage>('clicked-data-url', {\n\t\t\tdata,\n\t\t\tdownloadName\n\t\t});\n\t};\n\n\tconst handleBlobUrlClick = async (url: string, downloadName: string) => {\n\t\ttry {\n\t\t\tconst response = await fetch(url);\n\t\t\tconst blob = await response.blob();\n\t\t\tconst reader = new FileReader();\n\t\t\treader.addEventListener('load', () => {\n\t\t\t\thandleDataUrl(reader.result, downloadName);\n\t\t\t});\n\t\t\treader.readAsDataURL(blob);\n\t\t} catch (e) {\n\t\t\tconsole.error(e.message);\n\t\t}\n\t};\n\n\tdocument.body.addEventListener('click', handleInnerClick);\n\tdocument.body.addEventListener('focusin', checkOutputInputFocus);\n\n\tinterface RendererContext extends rendererApi.RendererContext<unknown> {\n\t\treadonly onDidChangeSettings: Event<RenderOptions>;\n\t\treadonly settings: RenderOptions;\n\t}\n\n\tinterface RendererModule {\n\t\treadonly activate: rendererApi.ActivationFunction;\n\t}\n\n\tinterface KernelPreloadContext {\n\t\treadonly onDidReceiveKernelMessage: Event<unknown>;\n\t\tpostKernelMessage(data: unknown): void;\n\t}\n\n\tinterface KernelPreloadModule {\n\t\tactivate(ctx: KernelPreloadContext): Promise<void> | void;\n\t}\n\n\tinterface IObservedElement {\n\t\tid: string;\n\t\toutput: boolean;\n\t\tlastKnownPadding: number;\n\t\tlastKnownHeight: number;\n\t\tcellId: string;\n\t}\n\n\tfunction createKernelContext(): KernelPreloadContext {\n\t\treturn Object.freeze({\n\t\t\tonDidReceiveKernelMessage: onDidReceiveKernelMessage.event,\n\t\t\tpostKernelMessage: (data: unknown) => postNotebookMessage('customKernelMessage', { message: data }),\n\t\t});\n\t}\n\n\tasync function runKernelPreload(url: string): Promise<void> {\n\t\ttry {\n\t\t\treturn await activateModuleKernelPreload(url);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tasync function activateModuleKernelPreload(url: string) {\n\t\tconst module: KernelPreloadModule = await __import(url);\n\t\tif (!module.activate) {\n\t\t\tconsole.error(`Notebook preload '${url}' was expected to be a module but it does not export an 'activate' function`);\n\t\t\treturn;\n\t\t}\n\t\treturn module.activate(createKernelContext());\n\t}\n\n\tconst dimensionUpdater = new class {\n\t\tprivate readonly pending = new Map<string, webviewMessages.DimensionUpdate>();\n\n\t\tupdateHeight(id: string, height: number, options: { init?: boolean; isOutput?: boolean }) {\n\t\t\tif (!this.pending.size) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.updateImmediately();\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t\tconst update = this.pending.get(id);\n\t\t\tif (update && update.isOutput) {\n\t\t\t\tthis.pending.set(id, {\n\t\t\t\t\tid,\n\t\t\t\t\theight,\n\t\t\t\t\tinit: update.init,\n\t\t\t\t\tisOutput: update.isOutput,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.pending.set(id, {\n\t\t\t\t\tid,\n\t\t\t\t\theight,\n\t\t\t\t\t...options,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tupdateImmediately() {\n\t\t\tif (!this.pending.size) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpostNotebookMessage<webviewMessages.IDimensionMessage>('dimension', {\n\t\t\t\tupdates: Array.from(this.pending.values())\n\t\t\t});\n\t\t\tthis.pending.clear();\n\t\t}\n\t};\n\n\tconst resizeObserver = new class {\n\n\t\tprivate readonly _observer: ResizeObserver;\n\n\t\tprivate readonly _observedElements = new WeakMap<Element, IObservedElement>();\n\t\tprivate _outputResizeTimer: any;\n\n\t\tconstructor() {\n\t\t\tthis._observer = new ResizeObserver(entries => {\n\t\t\t\tfor (const entry of entries) {\n\t\t\t\t\tif (!document.body.contains(entry.target)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst observedElementInfo = this._observedElements.get(entry.target);\n\t\t\t\t\tif (!observedElementInfo) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.postResizeMessage(observedElementInfo.cellId);\n\n\t\t\t\t\tif (entry.target.id !== observedElementInfo.id) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!entry.contentRect) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!observedElementInfo.output) {\n\t\t\t\t\t\t// markup, update directly\n\t\t\t\t\t\tthis.updateHeight(observedElementInfo, entry.target.offsetHeight);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newHeight = entry.contentRect.height;\n\t\t\t\t\tconst shouldUpdatePadding =\n\t\t\t\t\t\t(newHeight !== 0 && observedElementInfo.lastKnownPadding === 0) ||\n\t\t\t\t\t\t(newHeight === 0 && observedElementInfo.lastKnownPadding !== 0);\n\n\t\t\t\t\tif (shouldUpdatePadding) {\n\t\t\t\t\t\t// Do not update dimension in resize observer\n\t\t\t\t\t\twindow.requestAnimationFrame(() => {\n\t\t\t\t\t\t\tif (newHeight !== 0) {\n\t\t\t\t\t\t\t\tentry.target.style.padding = `${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodeLeftPadding}px`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tentry.target.style.padding = `0px`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.updateHeight(observedElementInfo, entry.target.offsetHeight);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.updateHeight(observedElementInfo, entry.target.offsetHeight);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tprivate updateHeight(observedElementInfo: IObservedElement, offsetHeight: number) {\n\t\t\tif (observedElementInfo.lastKnownHeight !== offsetHeight) {\n\t\t\t\tobservedElementInfo.lastKnownHeight = offsetHeight;\n\t\t\t\tdimensionUpdater.updateHeight(observedElementInfo.id, offsetHeight, {\n\t\t\t\t\tisOutput: observedElementInfo.output\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tpublic observe(container: Element, id: string, output: boolean, cellId: string) {\n\t\t\tif (this._observedElements.has(container)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._observedElements.set(container, { id, output, lastKnownPadding: ctx.style.outputNodePadding, lastKnownHeight: -1, cellId });\n\t\t\tthis._observer.observe(container);\n\t\t}\n\n\t\tprivate postResizeMessage(cellId: string) {\n\t\t\t// Debounce this callback to only happen after\n\t\t\t// 250 ms. Don't need resize events that often.\n\t\t\tclearTimeout(this._outputResizeTimer);\n\t\t\tthis._outputResizeTimer = setTimeout(() => {\n\t\t\t\tpostNotebookMessage('outputResized', {\n\t\t\t\t\tcellId\n\t\t\t\t});\n\t\t\t}, 250);\n\n\t\t}\n\t};\n\n\tfunction scrollWillGoToParent(event: WheelEvent) {\n\t\tfor (let node = event.target as Node | null; node; node = node.parentNode) {\n\t\t\tif (!(node instanceof Element) || node.id === 'container' || node.classList.contains('cell_container') || node.classList.contains('markup') || node.classList.contains('output_container')) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// scroll up\n\t\t\tif (event.deltaY < 0 && node.scrollTop > 0) {\n\t\t\t\t// there is still some content to scroll\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// scroll down\n\t\t\tif (event.deltaY > 0 && node.scrollTop + node.clientHeight < node.scrollHeight) {\n\t\t\t\t// per https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight\n\t\t\t\t// scrollTop is not rounded but scrollHeight and clientHeight are\n\t\t\t\t// so we need to check if the difference is less than some threshold\n\t\t\t\tif (node.scrollHeight - node.scrollTop - node.clientHeight < 2) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// if the node is not scrollable, we can continue. We don't check the computed style always as it's expensive\n\t\t\t\tif (window.getComputedStyle(node).overflowY === 'hidden' || window.getComputedStyle(node).overflowY === 'visible') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tconst handleWheel = (event: WheelEvent & { wheelDeltaX?: number; wheelDeltaY?: number; wheelDelta?: number }) => {\n\t\tif (event.defaultPrevented || scrollWillGoToParent(event)) {\n\t\t\treturn;\n\t\t}\n\t\tpostNotebookMessage<webviewMessages.IWheelMessage>('did-scroll-wheel', {\n\t\t\tpayload: {\n\t\t\t\tdeltaMode: event.deltaMode,\n\t\t\t\tdeltaX: event.deltaX,\n\t\t\t\tdeltaY: event.deltaY,\n\t\t\t\tdeltaZ: event.deltaZ,\n\t\t\t\twheelDelta: event.wheelDelta,\n\t\t\t\twheelDeltaX: event.wheelDeltaX,\n\t\t\t\twheelDeltaY: event.wheelDeltaY,\n\t\t\t\tdetail: event.detail,\n\t\t\t\tshiftKey: event.shiftKey,\n\t\t\t\ttype: event.type\n\t\t\t}\n\t\t});\n\t};\n\n\tfunction focusFirstFocusableOrContainerInOutput(cellOrOutputId: string, alternateId?: string) {\n\t\tconst cellOutputContainer = document.getElementById(cellOrOutputId) ??\n\t\t\talternateId ? document.getElementById(alternateId!) : undefined;\n\t\tif (cellOutputContainer) {\n\t\t\tif (cellOutputContainer.contains(document.activeElement)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet focusableElement = cellOutputContainer.querySelector('[tabindex=\"0\"], [href], button, input, option, select, textarea') as HTMLElement | null;\n\t\t\tif (!focusableElement) {\n\t\t\t\tfocusableElement = cellOutputContainer;\n\t\t\t\tfocusableElement.tabIndex = -1;\n\t\t\t}\n\n\t\t\tfocusableElement.focus();\n\t\t}\n\t}\n\n\tfunction createFocusSink(cellId: string, focusNext?: boolean) {\n\t\tconst element = document.createElement('div');\n\t\telement.id = `focus-sink-${cellId}`;\n\t\telement.tabIndex = 0;\n\t\telement.addEventListener('focus', () => {\n\t\t\tpostNotebookMessage<webviewMessages.IBlurOutputMessage>('focus-editor', {\n\t\t\t\tcellId: cellId,\n\t\t\t\tfocusNext\n\t\t\t});\n\t\t});\n\n\t\treturn element;\n\t}\n\n\tfunction _internalHighlightRange(range: Range, tagName = 'mark', attributes = {}) {\n\t\t// derived from https://github.com/Treora/dom-highlight-range/blob/master/highlight-range.js\n\n\t\t// Return an array of the text nodes in the range. Split the start and end nodes if required.\n\t\tfunction _textNodesInRange(range: Range): Text[] {\n\t\t\tif (!range.startContainer.ownerDocument) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\t// If the start or end node is a text node and only partly in the range, split it.\n\t\t\tif (range.startContainer.nodeType === Node.TEXT_NODE && range.startOffset > 0) {\n\t\t\t\tconst startContainer = range.startContainer as Text;\n\t\t\t\tconst endOffset = range.endOffset; // (this may get lost when the splitting the node)\n\t\t\t\tconst createdNode = startContainer.splitText(range.startOffset);\n\t\t\t\tif (range.endContainer === startContainer) {\n\t\t\t\t\t// If the end was in the same container, it will now be in the newly created node.\n\t\t\t\t\trange.setEnd(createdNode, endOffset - range.startOffset);\n\t\t\t\t}\n\n\t\t\t\trange.setStart(createdNode, 0);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\trange.endContainer.nodeType === Node.TEXT_NODE\n\t\t\t\t&& range.endOffset < (range.endContainer as Text).length\n\t\t\t) {\n\t\t\t\t(range.endContainer as Text).splitText(range.endOffset);\n\t\t\t}\n\n\t\t\t// Collect the text nodes.\n\t\t\tconst walker = range.startContainer.ownerDocument.createTreeWalker(\n\t\t\t\trange.commonAncestorContainer,\n\t\t\t\tNodeFilter.SHOW_TEXT,\n\t\t\t\tnode => range.intersectsNode(node) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT,\n\t\t\t);\n\n\t\t\twalker.currentNode = range.startContainer;\n\n\t\t\t// // Optimise by skipping nodes that are explicitly outside the range.\n\t\t\t// const NodeTypesWithCharacterOffset = [\n\t\t\t//  Node.TEXT_NODE,\n\t\t\t//  Node.PROCESSING_INSTRUCTION_NODE,\n\t\t\t//  Node.COMMENT_NODE,\n\t\t\t// ];\n\t\t\t// if (!NodeTypesWithCharacterOffset.includes(range.startContainer.nodeType)) {\n\t\t\t//   if (range.startOffset < range.startContainer.childNodes.length) {\n\t\t\t//     walker.currentNode = range.startContainer.childNodes[range.startOffset];\n\t\t\t//   } else {\n\t\t\t//     walker.nextSibling(); // TODO verify this is correct.\n\t\t\t//   }\n\t\t\t// }\n\n\t\t\tconst nodes: Text[] = [];\n\t\t\tif (walker.currentNode.nodeType === Node.TEXT_NODE) {\n\t\t\t\tnodes.push(walker.currentNode as Text);\n\t\t\t}\n\n\t\t\twhile (walker.nextNode() && range.comparePoint(walker.currentNode, 0) !== 1) {\n\t\t\t\tif (walker.currentNode.nodeType === Node.TEXT_NODE) {\n\t\t\t\t\tnodes.push(walker.currentNode as Text);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn nodes;\n\t\t}\n\n\t\t// Replace [node] with <tagName ...attributes>[node]</tagName>\n\t\tfunction wrapNodeInHighlight(node: Text, tagName: string, attributes: any) {\n\t\t\tconst highlightElement = node.ownerDocument.createElement(tagName);\n\t\t\tObject.keys(attributes).forEach(key => {\n\t\t\t\thighlightElement.setAttribute(key, attributes[key]);\n\t\t\t});\n\t\t\tconst tempRange = node.ownerDocument.createRange();\n\t\t\ttempRange.selectNode(node);\n\t\t\ttempRange.surroundContents(highlightElement);\n\t\t\treturn highlightElement;\n\t\t}\n\n\t\tif (range.collapsed) {\n\t\t\treturn {\n\t\t\t\tremove: () => { },\n\t\t\t\tupdate: () => { }\n\t\t\t};\n\t\t}\n\n\t\t// First put all nodes in an array (splits start and end nodes if needed)\n\t\tconst nodes = _textNodesInRange(range);\n\n\t\t// Highlight each node\n\t\tconst highlightElements: Element[] = [];\n\t\tfor (const nodeIdx in nodes) {\n\t\t\tconst highlightElement = wrapNodeInHighlight(nodes[nodeIdx], tagName, attributes);\n\t\t\thighlightElements.push(highlightElement);\n\t\t}\n\n\t\t// Remove a highlight element created with wrapNodeInHighlight.\n\t\tfunction _removeHighlight(highlightElement: Element) {\n\t\t\tif (highlightElement.childNodes.length === 1) {\n\t\t\t\thighlightElement.parentNode?.replaceChild(highlightElement.firstChild!, highlightElement);\n\t\t\t} else {\n\t\t\t\t// If the highlight somehow contains multiple nodes now, move them all.\n\t\t\t\twhile (highlightElement.firstChild) {\n\t\t\t\t\thighlightElement.parentNode?.insertBefore(highlightElement.firstChild, highlightElement);\n\t\t\t\t}\n\t\t\t\thighlightElement.remove();\n\t\t\t}\n\t\t}\n\n\t\t// Return a function that cleans up the highlightElements.\n\t\tfunction _removeHighlights() {\n\t\t\t// Remove each of the created highlightElements.\n\t\t\tfor (const highlightIdx in highlightElements) {\n\t\t\t\t_removeHighlight(highlightElements[highlightIdx]);\n\t\t\t}\n\t\t}\n\n\t\tfunction _updateHighlight(highlightElement: Element, attributes: any = {}) {\n\t\t\tObject.keys(attributes).forEach(key => {\n\t\t\t\thighlightElement.setAttribute(key, attributes[key]);\n\t\t\t});\n\t\t}\n\n\t\tfunction updateHighlights(attributes: any) {\n\t\t\tfor (const highlightIdx in highlightElements) {\n\t\t\t\t_updateHighlight(highlightElements[highlightIdx], attributes);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tremove: _removeHighlights,\n\t\t\tupdate: updateHighlights\n\t\t};\n\t}\n\n\tinterface ICommonRange {\n\t\tcollapsed: boolean;\n\t\tcommonAncestorContainer: Node;\n\t\tendContainer: Node;\n\t\tendOffset: number;\n\t\tstartContainer: Node;\n\t\tstartOffset: number;\n\n\t}\n\n\tinterface IHighlightResult {\n\t\trange: ICommonRange;\n\t\tdispose: () => void;\n\t\tupdate: (color: string | undefined, className: string | undefined) => void;\n\t}\n\n\tfunction selectRange(_range: ICommonRange) {\n\t\tconst sel = window.getSelection();\n\t\tif (sel) {\n\t\t\ttry {\n\t\t\t\tsel.removeAllRanges();\n\t\t\t\tconst r = document.createRange();\n\t\t\t\tr.setStart(_range.startContainer, _range.startOffset);\n\t\t\t\tr.setEnd(_range.endContainer, _range.endOffset);\n\t\t\t\tsel.addRange(r);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction highlightRange(range: Range, useCustom: boolean, tagName = 'mark', attributes = {}): IHighlightResult {\n\t\tif (useCustom) {\n\t\t\tconst ret = _internalHighlightRange(range, tagName, attributes);\n\t\t\treturn {\n\t\t\t\trange: range,\n\t\t\t\tdispose: ret.remove,\n\t\t\t\tupdate: (color: string | undefined, className: string | undefined) => {\n\t\t\t\t\tif (className === undefined) {\n\t\t\t\t\t\tret.update({\n\t\t\t\t\t\t\t'style': `background-color: ${color}`\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tret.update({\n\t\t\t\t\t\t\t'class': className\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t} else {\n\t\t\twindow.document.execCommand('hiliteColor', false, matchColor);\n\t\t\tconst cloneRange = window.getSelection()!.getRangeAt(0).cloneRange();\n\t\t\tconst _range = {\n\t\t\t\tcollapsed: cloneRange.collapsed,\n\t\t\t\tcommonAncestorContainer: cloneRange.commonAncestorContainer,\n\t\t\t\tendContainer: cloneRange.endContainer,\n\t\t\t\tendOffset: cloneRange.endOffset,\n\t\t\t\tstartContainer: cloneRange.startContainer,\n\t\t\t\tstartOffset: cloneRange.startOffset\n\t\t\t};\n\t\t\treturn {\n\t\t\t\trange: _range,\n\t\t\t\tdispose: () => {\n\t\t\t\t\tselectRange(_range);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdocument.designMode = 'On';\n\t\t\t\t\t\tdocument.execCommand('removeFormat', false, undefined);\n\t\t\t\t\t\tdocument.designMode = 'Off';\n\t\t\t\t\t\twindow.getSelection()?.removeAllRanges();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tupdate: (color: string | undefined, className: string | undefined) => {\n\t\t\t\t\tselectRange(_range);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdocument.designMode = 'On';\n\t\t\t\t\t\tdocument.execCommand('removeFormat', false, undefined);\n\t\t\t\t\t\twindow.document.execCommand('hiliteColor', false, color);\n\t\t\t\t\t\tdocument.designMode = 'Off';\n\t\t\t\t\t\twindow.getSelection()?.removeAllRanges();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\tfunction createEmitter<T>(listenerChange: (listeners: Set<Listener<T>>) => void = () => undefined): EmitterLike<T> {\n\t\tconst listeners = new Set<Listener<T>>();\n\t\treturn {\n\t\t\tfire(data) {\n\t\t\t\tfor (const listener of [...listeners]) {\n\t\t\t\t\tlistener.fn.call(listener.thisArg, data);\n\t\t\t\t}\n\t\t\t},\n\t\t\tevent(fn, thisArg, disposables) {\n\t\t\t\tconst listenerObj = { fn, thisArg };\n\t\t\t\tconst disposable: IDisposable = {\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tlisteners.delete(listenerObj);\n\t\t\t\t\t\tlistenerChange(listeners);\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tlisteners.add(listenerObj);\n\t\t\t\tlistenerChange(listeners);\n\n\t\t\t\tif (disposables instanceof Array) {\n\t\t\t\t\tdisposables.push(disposable);\n\t\t\t\t} else if (disposables) {\n\t\t\t\t\tdisposables.add(disposable);\n\t\t\t\t}\n\n\t\t\t\treturn disposable;\n\t\t\t},\n\t\t};\n\t}\n\n\tfunction showRenderError(errorText: string, outputNode: HTMLElement, errors: readonly Error[]) {\n\t\toutputNode.innerText = errorText;\n\t\tconst errList = document.createElement('ul');\n\t\tfor (const result of errors) {\n\t\t\tconsole.error(result);\n\t\t\tconst item = document.createElement('li');\n\t\t\titem.innerText = result.message;\n\t\t\terrList.appendChild(item);\n\t\t}\n\t\toutputNode.appendChild(errList);\n\t}\n\n\tconst outputItemRequests = new class {\n\t\tprivate _requestPool = 0;\n\t\tprivate readonly _requests = new Map</*requestId*/number, { resolve: (x: webviewMessages.OutputItemEntry | undefined) => void }>();\n\n\t\tgetOutputItem(outputId: string, mime: string) {\n\t\t\tconst requestId = this._requestPool++;\n\n\t\t\tlet resolve: ((x: webviewMessages.OutputItemEntry | undefined) => void) | undefined;\n\t\t\tconst p = new Promise<webviewMessages.OutputItemEntry | undefined>(r => resolve = r);\n\t\t\tthis._requests.set(requestId, { resolve: resolve! });\n\n\t\t\tpostNotebookMessage<webviewMessages.IGetOutputItemMessage>('getOutputItem', { requestId, outputId, mime });\n\t\t\treturn p;\n\t\t}\n\n\t\tresolveOutputItem(requestId: number, output: webviewMessages.OutputItemEntry | undefined) {\n\t\t\tconst request = this._requests.get(requestId);\n\t\t\tif (!request) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._requests.delete(requestId);\n\t\t\trequest.resolve(output);\n\t\t}\n\t};\n\n\tinterface AdditionalOutputItemInfo {\n\t\treadonly mime: string;\n\t\tgetItem(): Promise<rendererApi.OutputItem | undefined>;\n\t}\n\n\tinterface ExtendedOutputItem extends rendererApi.OutputItem {\n\t\treadonly _allOutputItems: ReadonlyArray<AdditionalOutputItemInfo>;\n\t\tappendedText?(): string | undefined;\n\t}\n\n\tlet hasWarnedAboutAllOutputItemsProposal = false;\n\n\tfunction createOutputItem(\n\t\tid: string,\n\t\tmime: string,\n\t\tmetadata: unknown,\n\t\tvalueBytes: Uint8Array,\n\t\tallOutputItemData: ReadonlyArray<{ readonly mime: string }>,\n\t\tappended?: { valueBytes: Uint8Array; previousVersion: number }\n\t): ExtendedOutputItem {\n\n\t\tfunction create(\n\t\t\tid: string,\n\t\t\tmime: string,\n\t\t\tmetadata: unknown,\n\t\t\tvalueBytes: Uint8Array,\n\t\t\tappended?: { valueBytes: Uint8Array; previousVersion: number }\n\t\t): ExtendedOutputItem {\n\t\t\treturn Object.freeze<ExtendedOutputItem>({\n\t\t\t\tid,\n\t\t\t\tmime,\n\t\t\t\tmetadata,\n\n\t\t\t\tappendedText(): string | undefined {\n\t\t\t\t\tif (appended) {\n\t\t\t\t\t\treturn textDecoder.decode(appended.valueBytes);\n\t\t\t\t\t}\n\t\t\t\t\treturn undefined;\n\t\t\t\t},\n\n\t\t\t\tdata(): Uint8Array {\n\t\t\t\t\treturn valueBytes;\n\t\t\t\t},\n\n\t\t\t\ttext(): string {\n\t\t\t\t\treturn textDecoder.decode(valueBytes);\n\t\t\t\t},\n\n\t\t\t\tjson() {\n\t\t\t\t\treturn JSON.parse(this.text());\n\t\t\t\t},\n\n\t\t\t\tblob(): Blob {\n\t\t\t\t\treturn new Blob([valueBytes], { type: this.mime });\n\t\t\t\t},\n\n\t\t\t\tget _allOutputItems() {\n\t\t\t\t\tif (!hasWarnedAboutAllOutputItemsProposal) {\n\t\t\t\t\t\thasWarnedAboutAllOutputItemsProposal = true;\n\t\t\t\t\t\tconsole.warn(`'_allOutputItems' is proposed API. DO NOT ship an extension that depends on it!`);\n\t\t\t\t\t}\n\t\t\t\t\treturn allOutputItemList;\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tconst allOutputItemCache = new Map</*mime*/string, Promise<(rendererApi.OutputItem & ExtendedOutputItem) | undefined>>();\n\t\tconst allOutputItemList = Object.freeze(allOutputItemData.map(outputItem => {\n\t\t\tconst mime = outputItem.mime;\n\t\t\treturn Object.freeze({\n\t\t\t\tmime,\n\t\t\t\tgetItem() {\n\t\t\t\t\tconst existingTask = allOutputItemCache.get(mime);\n\t\t\t\t\tif (existingTask) {\n\t\t\t\t\t\treturn existingTask;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst task = outputItemRequests.getOutputItem(id, mime).then(item => {\n\t\t\t\t\t\treturn item ? create(id, item.mime, metadata, item.valueBytes) : undefined;\n\t\t\t\t\t});\n\t\t\t\t\tallOutputItemCache.set(mime, task);\n\n\t\t\t\t\treturn task;\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\n\t\tconst item = create(id, mime, metadata, valueBytes, appended);\n\t\tallOutputItemCache.set(mime, Promise.resolve(item));\n\t\treturn item;\n\t}\n\n\tconst onDidReceiveKernelMessage = createEmitter<unknown>();\n\n\tconst ttPolicy = window.trustedTypes?.createPolicy('notebookRenderer', {\n\t\tcreateHTML: value => value, // CodeQL [SM03712] The rendered content is provided by renderer extensions, which are responsible for sanitizing their content themselves. The notebook webview is also sandboxed.\n\t\tcreateScript: value => value, // CodeQL [SM03712] The rendered content is provided by renderer extensions, which are responsible for sanitizing their content themselves. The notebook webview is also sandboxed.\n\t});\n\n\twindow.addEventListener('wheel', handleWheel);\n\n\tinterface IFindMatch {\n\t\ttype: 'preview' | 'output';\n\t\tid: string;\n\t\tcellId: string;\n\t\tcontainer: Node;\n\t\toriginalRange: Range;\n\t\tisShadow: boolean;\n\t\tsearchPreviewInfo?: ISearchPreviewInfo;\n\t\thighlightResult?: IHighlightResult;\n\t}\n\n\tinterface ISearchPreviewInfo {\n\t\tline: string;\n\t\trange: {\n\t\t\tstart: number;\n\t\t\tend: number;\n\t\t};\n\t}\n\n\tinterface IHighlighter {\n\t\taddHighlights(matches: IFindMatch[], ownerID: string): void;\n\t\tremoveHighlights(ownerID: string): void;\n\t\thighlightCurrentMatch(index: number, ownerID: string): void;\n\t\tunHighlightCurrentMatch(index: number, ownerID: string): void;\n\t\tdispose(): void;\n\t}\n\n\tinterface IHighlightInfo {\n\t\tmatches: IFindMatch[];\n\t\tcurrentMatchIndex: number;\n\t}\n\n\tconst matchColor = window.getComputedStyle(document.getElementById('_defaultColorPalatte')!).color;\n\tconst currentMatchColor = window.getComputedStyle(document.getElementById('_defaultColorPalatte')!).backgroundColor;\n\n\tclass JSHighlighter implements IHighlighter {\n\t\tprivate _activeHighlightInfo: Map<string, IHighlightInfo>;\n\n\t\tconstructor(\n\t\t) {\n\t\t\tthis._activeHighlightInfo = new Map();\n\t\t}\n\n\t\taddHighlights(matches: IFindMatch[], ownerID: string): void {\n\t\t\tfor (let i = matches.length - 1; i >= 0; i--) {\n\t\t\t\tconst match = matches[i];\n\t\t\t\tconst ret = highlightRange(match.originalRange, true, 'mark', match.isShadow ? {\n\t\t\t\t\t'style': 'background-color: ' + matchColor + ';',\n\t\t\t\t} : {\n\t\t\t\t\t'class': 'find-match'\n\t\t\t\t});\n\t\t\t\tmatch.highlightResult = ret;\n\t\t\t}\n\n\t\t\tconst highlightInfo: IHighlightInfo = {\n\t\t\t\tmatches,\n\t\t\t\tcurrentMatchIndex: -1\n\t\t\t};\n\t\t\tthis._activeHighlightInfo.set(ownerID, highlightInfo);\n\t\t}\n\n\t\tremoveHighlights(ownerID: string): void {\n\t\t\tthis._activeHighlightInfo.get(ownerID)?.matches.forEach(match => {\n\t\t\t\tmatch.highlightResult?.dispose();\n\t\t\t});\n\t\t\tthis._activeHighlightInfo.delete(ownerID);\n\t\t}\n\n\t\thighlightCurrentMatch(index: number, ownerID: string) {\n\t\t\tconst highlightInfo = this._activeHighlightInfo.get(ownerID);\n\t\t\tif (!highlightInfo) {\n\t\t\t\tconsole.error('Modified current highlight match before adding highlight list.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst oldMatch = highlightInfo.matches[highlightInfo.currentMatchIndex];\n\t\t\toldMatch?.highlightResult?.update(matchColor, oldMatch.isShadow ? undefined : 'find-match');\n\n\t\t\tconst match = highlightInfo.matches[index];\n\t\t\thighlightInfo.currentMatchIndex = index;\n\t\t\tconst sel = window.getSelection();\n\t\t\tif (!!match && !!sel && match.highlightResult) {\n\t\t\t\tlet offset = 0;\n\t\t\t\ttry {\n\t\t\t\t\tconst outputOffset = document.getElementById(match.id)!.getBoundingClientRect().top;\n\t\t\t\t\tconst tempRange = document.createRange();\n\t\t\t\t\ttempRange.selectNode(match.highlightResult.range.startContainer);\n\n\t\t\t\t\tmatch.highlightResult.range.startContainer.parentElement?.scrollIntoView({ behavior: 'auto', block: 'end', inline: 'nearest' });\n\n\t\t\t\t\tconst rangeOffset = tempRange.getBoundingClientRect().top;\n\t\t\t\t\ttempRange.detach();\n\n\t\t\t\t\toffset = rangeOffset - outputOffset;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\n\t\t\t\tmatch.highlightResult?.update(currentMatchColor, match.isShadow ? undefined : 'current-find-match');\n\n\t\t\t\tdocument.getSelection()?.removeAllRanges();\n\t\t\t\tpostNotebookMessage('didFindHighlightCurrent', {\n\t\t\t\t\toffset\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tunHighlightCurrentMatch(index: number, ownerID: string) {\n\t\t\tconst highlightInfo = this._activeHighlightInfo.get(ownerID);\n\t\t\tif (!highlightInfo) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst oldMatch = highlightInfo.matches[index];\n\t\t\tif (oldMatch && oldMatch.highlightResult) {\n\t\t\t\toldMatch.highlightResult.update(matchColor, oldMatch.isShadow ? undefined : 'find-match');\n\t\t\t}\n\t\t}\n\n\t\tdispose() {\n\t\t\tdocument.getSelection()?.removeAllRanges();\n\t\t\tthis._activeHighlightInfo.forEach(highlightInfo => {\n\t\t\t\thighlightInfo.matches.forEach(match => {\n\t\t\t\t\tmatch.highlightResult?.dispose();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tclass CSSHighlighter implements IHighlighter {\n\t\tprivate _activeHighlightInfo: Map<string, IHighlightInfo>;\n\t\tprivate _matchesHighlight: Highlight;\n\t\tprivate _currentMatchesHighlight: Highlight;\n\n\t\tconstructor() {\n\t\t\tthis._activeHighlightInfo = new Map();\n\t\t\tthis._matchesHighlight = new Highlight();\n\t\t\tthis._matchesHighlight.priority = 1;\n\t\t\tthis._currentMatchesHighlight = new Highlight();\n\t\t\tthis._currentMatchesHighlight.priority = 2;\n\t\t\tCSS.highlights?.set(`find-highlight`, this._matchesHighlight);\n\t\t\tCSS.highlights?.set(`current-find-highlight`, this._currentMatchesHighlight);\n\t\t}\n\n\t\t_refreshRegistry(updateMatchesHighlight = true) {\n\t\t\t// for performance reasons, only update the full list of highlights when we need to\n\t\t\tif (updateMatchesHighlight) {\n\t\t\t\tthis._matchesHighlight.clear();\n\t\t\t}\n\n\t\t\tthis._currentMatchesHighlight.clear();\n\n\t\t\tthis._activeHighlightInfo.forEach((highlightInfo) => {\n\n\t\t\t\tif (updateMatchesHighlight) {\n\t\t\t\t\tfor (let i = 0; i < highlightInfo.matches.length; i++) {\n\t\t\t\t\t\tthis._matchesHighlight.add(highlightInfo.matches[i].originalRange);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (highlightInfo.currentMatchIndex < highlightInfo.matches.length && highlightInfo.currentMatchIndex >= 0) {\n\t\t\t\t\tthis._currentMatchesHighlight.add(highlightInfo.matches[highlightInfo.currentMatchIndex].originalRange);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\taddHighlights(\n\t\t\tmatches: IFindMatch[],\n\t\t\townerID: string\n\t\t) {\n\n\t\t\tfor (let i = 0; i < matches.length; i++) {\n\t\t\t\tthis._matchesHighlight.add(matches[i].originalRange);\n\t\t\t}\n\n\t\t\tconst newEntry: IHighlightInfo = {\n\t\t\t\tmatches,\n\t\t\t\tcurrentMatchIndex: -1,\n\t\t\t};\n\n\t\t\tthis._activeHighlightInfo.set(ownerID, newEntry);\n\t\t}\n\n\t\thighlightCurrentMatch(index: number, ownerID: string): void {\n\t\t\tconst highlightInfo = this._activeHighlightInfo.get(ownerID);\n\t\t\tif (!highlightInfo) {\n\t\t\t\tconsole.error('Modified current highlight match before adding highlight list.');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thighlightInfo.currentMatchIndex = index;\n\t\t\tconst match = highlightInfo.matches[index];\n\n\t\t\tif (match) {\n\t\t\t\tlet offset = 0;\n\t\t\t\ttry {\n\t\t\t\t\tconst outputOffset = document.getElementById(match.id)!.getBoundingClientRect().top;\n\t\t\t\t\tmatch.originalRange.startContainer.parentElement?.scrollIntoView({ behavior: 'auto', block: 'end', inline: 'nearest' });\n\t\t\t\t\tconst rangeOffset = match.originalRange.getBoundingClientRect().top;\n\t\t\t\t\toffset = rangeOffset - outputOffset;\n\t\t\t\t\tpostNotebookMessage('didFindHighlightCurrent', {\n\t\t\t\t\t\toffset\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._refreshRegistry(false);\n\t\t}\n\n\t\tunHighlightCurrentMatch(index: number, ownerID: string): void {\n\t\t\tconst highlightInfo = this._activeHighlightInfo.get(ownerID);\n\t\t\tif (!highlightInfo) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thighlightInfo.currentMatchIndex = -1;\n\t\t}\n\n\t\tremoveHighlights(ownerID: string) {\n\t\t\tthis._activeHighlightInfo.delete(ownerID);\n\t\t\tthis._refreshRegistry();\n\t\t}\n\n\t\tdispose(): void {\n\t\t\tdocument.getSelection()?.removeAllRanges();\n\t\t\tthis._currentMatchesHighlight.clear();\n\t\t\tthis._matchesHighlight.clear();\n\t\t}\n\t}\n\n\tconst _highlighter = (CSS.highlights) ? new CSSHighlighter() : new JSHighlighter();\n\n\tfunction extractSelectionLine(selection: Selection): ISearchPreviewInfo {\n\t\tconst range = selection.getRangeAt(0);\n\n\t\t// we need to keep a reference to the old selection range to re-apply later\n\t\tconst oldRange = range.cloneRange();\n\t\tconst captureLength = selection.toString().length;\n\n\t\t// use selection API to modify selection to get entire line (the first line if multi-select)\n\n\t\t// collapse selection to start so that the cursor position is at beginning of match\n\t\tselection.collapseToStart();\n\n\t\t// extend selection in both directions to select the line\n\t\tselection.modify('move', 'backward', 'lineboundary');\n\t\tselection.modify('extend', 'forward', 'lineboundary');\n\n\t\tconst line = selection.toString();\n\n\t\t// using the original range and the new range, we can find the offset of the match from the line start.\n\t\tconst rangeStart = getStartOffset(selection.getRangeAt(0), oldRange);\n\n\t\t// line range for match\n\t\tconst lineRange = {\n\t\t\tstart: rangeStart,\n\t\t\tend: rangeStart + captureLength,\n\t\t};\n\n\t\t// re-add the old range so that the selection is restored\n\t\tselection.removeAllRanges();\n\t\tselection.addRange(oldRange);\n\n\t\treturn { line, range: lineRange };\n\t}\n\n\tfunction getStartOffset(lineRange: Range, originalRange: Range) {\n\t\t// sometimes, the old and new range are in different DOM elements (ie: when the match is inside of <b></b>)\n\t\t// so we need to find the first common ancestor DOM element and find the positions of the old and new range relative to that.\n\t\tconst firstCommonAncestor = findFirstCommonAncestor(lineRange.startContainer, originalRange.startContainer);\n\n\t\tconst selectionOffset = getSelectionOffsetRelativeTo(firstCommonAncestor, lineRange.startContainer) + lineRange.startOffset;\n\t\tconst textOffset = getSelectionOffsetRelativeTo(firstCommonAncestor, originalRange.startContainer) + originalRange.startOffset;\n\t\treturn textOffset - selectionOffset;\n\t}\n\n\t// modified from https://stackoverflow.com/a/68583466/16253823\n\tfunction findFirstCommonAncestor(nodeA: Node, nodeB: Node) {\n\t\tconst range = new Range();\n\t\trange.setStart(nodeA, 0);\n\t\trange.setEnd(nodeB, 0);\n\t\treturn range.commonAncestorContainer;\n\t}\n\n\tfunction getTextContentLength(node: Node): number {\n\t\tlet length = 0;\n\n\t\tif (node.nodeType === Node.TEXT_NODE) {\n\t\t\tlength += node.textContent?.length || 0;\n\t\t} else {\n\t\t\tfor (const childNode of node.childNodes) {\n\t\t\t\tlength += getTextContentLength(childNode);\n\t\t\t}\n\t\t}\n\n\t\treturn length;\n\t}\n\n\t// modified from https://stackoverflow.com/a/48812529/16253823\n\tfunction getSelectionOffsetRelativeTo(parentElement: Node, currentNode: Node | null): number {\n\t\tif (!currentNode) {\n\t\t\treturn 0;\n\t\t}\n\t\tlet offset = 0;\n\n\t\tif (currentNode === parentElement || !parentElement.contains(currentNode)) {\n\t\t\treturn offset;\n\t\t}\n\n\n\t\t// count the number of chars before the current dom elem and the start of the dom\n\t\tlet prevSibling = currentNode.previousSibling;\n\t\twhile (prevSibling) {\n\t\t\toffset += getTextContentLength(prevSibling);\n\t\t\tprevSibling = prevSibling.previousSibling;\n\t\t}\n\n\t\treturn offset + getSelectionOffsetRelativeTo(parentElement, currentNode.parentNode);\n\t}\n\n\tconst find = (query: string, options: { wholeWord?: boolean; caseSensitive?: boolean; includeMarkup: boolean; includeOutput: boolean; shouldGetSearchPreviewInfo: boolean; ownerID: string }) => {\n\t\tlet find = true;\n\t\tconst matches: IFindMatch[] = [];\n\n\t\tconst range = document.createRange();\n\t\trange.selectNodeContents(document.getElementById('findStart')!);\n\t\tconst sel = window.getSelection();\n\t\tsel?.removeAllRanges();\n\t\tsel?.addRange(range);\n\n\t\tviewModel.toggleDragDropEnabled(false);\n\n\t\ttry {\n\t\t\tdocument.designMode = 'On';\n\n\t\t\twhile (find && matches.length < 500) {\n\t\t\t\tfind = (window as any).find(query, /* caseSensitive*/ !!options.caseSensitive,\n\t\t\t\t/* backwards*/ false,\n\t\t\t\t/* wrapAround*/ false,\n\t\t\t\t/* wholeWord */ !!options.wholeWord,\n\t\t\t\t/* searchInFrames*/ true,\n\t\t\t\t\tfalse);\n\n\t\t\t\tif (find) {\n\t\t\t\t\tconst selection = window.getSelection();\n\t\t\t\t\tif (!selection) {\n\t\t\t\t\t\tconsole.log('no selection');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Markdown preview are rendered in a shadow DOM.\n\t\t\t\t\tif (options.includeMarkup && selection.rangeCount > 0 && selection.getRangeAt(0).startContainer.nodeType === 1\n\t\t\t\t\t\t&& (selection.getRangeAt(0).startContainer as Element).classList.contains('markup')) {\n\t\t\t\t\t\t// markdown preview container\n\t\t\t\t\t\tconst preview = (selection.anchorNode?.firstChild as Element);\n\t\t\t\t\t\tconst root = preview.shadowRoot as ShadowRoot & { getSelection: () => Selection };\n\t\t\t\t\t\tconst shadowSelection = root?.getSelection ? root?.getSelection() : null;\n\t\t\t\t\t\t// find the match in the shadow dom by checking the selection inside the shadow dom\n\t\t\t\t\t\tif (shadowSelection && shadowSelection.anchorNode) {\n\t\t\t\t\t\t\tmatches.push({\n\t\t\t\t\t\t\t\ttype: 'preview',\n\t\t\t\t\t\t\t\tid: preview.id,\n\t\t\t\t\t\t\t\tcellId: preview.id,\n\t\t\t\t\t\t\t\tcontainer: preview,\n\t\t\t\t\t\t\t\tisShadow: true,\n\t\t\t\t\t\t\t\toriginalRange: shadowSelection.getRangeAt(0),\n\t\t\t\t\t\t\t\tsearchPreviewInfo: options.shouldGetSearchPreviewInfo ? extractSelectionLine(shadowSelection) : undefined,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Outputs might be rendered inside a shadow DOM.\n\t\t\t\t\tif (options.includeOutput && selection.rangeCount > 0 && selection.getRangeAt(0).startContainer.nodeType === 1\n\t\t\t\t\t\t&& (selection.getRangeAt(0).startContainer as Element).classList.contains('output_container')) {\n\t\t\t\t\t\t// output container\n\t\t\t\t\t\tconst cellId = selection.getRangeAt(0).startContainer.parentElement!.id;\n\t\t\t\t\t\tconst outputNode = (selection.anchorNode?.firstChild as Element);\n\t\t\t\t\t\tconst root = outputNode.shadowRoot as ShadowRoot & { getSelection: () => Selection };\n\t\t\t\t\t\tconst shadowSelection = root?.getSelection ? root?.getSelection() : null;\n\t\t\t\t\t\tif (shadowSelection && shadowSelection.anchorNode) {\n\t\t\t\t\t\t\tmatches.push({\n\t\t\t\t\t\t\t\ttype: 'output',\n\t\t\t\t\t\t\t\tid: outputNode.id,\n\t\t\t\t\t\t\t\tcellId: cellId,\n\t\t\t\t\t\t\t\tcontainer: outputNode,\n\t\t\t\t\t\t\t\tisShadow: true,\n\t\t\t\t\t\t\t\toriginalRange: shadowSelection.getRangeAt(0),\n\t\t\t\t\t\t\t\tsearchPreviewInfo: options.shouldGetSearchPreviewInfo ? extractSelectionLine(shadowSelection) : undefined,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst anchorNode = selection.anchorNode?.parentElement;\n\n\t\t\t\t\tif (anchorNode) {\n\t\t\t\t\t\tconst lastEl: any = matches.length ? matches[matches.length - 1] : null;\n\n\t\t\t\t\t\t// Optimization: avoid searching for the output container\n\t\t\t\t\t\tif (lastEl && lastEl.container.contains(anchorNode) && options.includeOutput) {\n\t\t\t\t\t\t\tmatches.push({\n\t\t\t\t\t\t\t\ttype: lastEl.type,\n\t\t\t\t\t\t\t\tid: lastEl.id,\n\t\t\t\t\t\t\t\tcellId: lastEl.cellId,\n\t\t\t\t\t\t\t\tcontainer: lastEl.container,\n\t\t\t\t\t\t\t\tisShadow: false,\n\t\t\t\t\t\t\t\toriginalRange: selection.getRangeAt(0),\n\t\t\t\t\t\t\t\tsearchPreviewInfo: options.shouldGetSearchPreviewInfo ? extractSelectionLine(selection) : undefined,\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Traverse up the DOM to find the container\n\t\t\t\t\t\t\tfor (let node = anchorNode as Element | null; node; node = node.parentElement) {\n\t\t\t\t\t\t\t\tif (!(node instanceof Element)) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (node.classList.contains('output') && options.includeOutput) {\n\t\t\t\t\t\t\t\t\t// inside output\n\t\t\t\t\t\t\t\t\tconst cellId = node.parentElement?.parentElement?.id;\n\t\t\t\t\t\t\t\t\tif (cellId) {\n\t\t\t\t\t\t\t\t\t\tmatches.push({\n\t\t\t\t\t\t\t\t\t\t\ttype: 'output',\n\t\t\t\t\t\t\t\t\t\t\tid: node.id,\n\t\t\t\t\t\t\t\t\t\t\tcellId: cellId,\n\t\t\t\t\t\t\t\t\t\t\tcontainer: node,\n\t\t\t\t\t\t\t\t\t\t\tisShadow: false,\n\t\t\t\t\t\t\t\t\t\t\toriginalRange: selection.getRangeAt(0),\n\t\t\t\t\t\t\t\t\t\t\tsearchPreviewInfo: options.shouldGetSearchPreviewInfo ? extractSelectionLine(selection) : undefined,\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (node.id === 'container' || node === document.body) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.log(e);\n\t\t}\n\n\t\t_highlighter.addHighlights(matches, options.ownerID);\n\t\tdocument.getSelection()?.removeAllRanges();\n\n\t\tviewModel.toggleDragDropEnabled(currentOptions.dragAndDropEnabled);\n\n\t\tdocument.designMode = 'Off';\n\n\t\tpostNotebookMessage('didFind', {\n\t\t\tmatches: matches.map((match, index) => ({\n\t\t\t\ttype: match.type,\n\t\t\t\tid: match.id,\n\t\t\t\tcellId: match.cellId,\n\t\t\t\tindex,\n\t\t\t\tsearchPreviewInfo: match.searchPreviewInfo,\n\t\t\t}))\n\t\t});\n\t};\n\n\tconst copyOutputImage = async (outputId: string, altOutputId: string, retries = 5) => {\n\t\tif (!document.hasFocus() && retries > 0) {\n\t\t\t// copyImage can be called from outside of the webview, which means this function may be running whilst the webview is gaining focus.\n\t\t\t// Since navigator.clipboard.write requires the document to be focused, we need to wait for focus.\n\t\t\t// We cannot use a listener, as there is a high chance the focus is gained during the setup of the listener resulting in us missing it.\n\t\t\tsetTimeout(() => { copyOutputImage(outputId, altOutputId, retries - 1); }, 20);\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst image = document.getElementById(outputId)?.querySelector('img')\n\t\t\t\t?? document.getElementById(altOutputId)?.querySelector('img');\n\t\t\tif (image) {\n\t\t\t\tawait navigator.clipboard.write([new ClipboardItem({\n\t\t\t\t\t'image/png': new Promise((resolve) => {\n\t\t\t\t\t\tconst canvas = document.createElement('canvas');\n\t\t\t\t\t\tif (canvas !== null) {\n\t\t\t\t\t\t\tcanvas.width = image.naturalWidth;\n\t\t\t\t\t\t\tcanvas.height = image.naturalHeight;\n\t\t\t\t\t\t\tconst context = canvas.getContext('2d');\n\t\t\t\t\t\t\tcontext?.drawImage(image, 0, 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcanvas.toBlob((blob) => {\n\t\t\t\t\t\t\tif (blob) {\n\t\t\t\t\t\t\t\tresolve(blob);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcanvas.remove();\n\t\t\t\t\t\t}, 'image/png');\n\t\t\t\t\t})\n\t\t\t\t})]);\n\t\t\t} else {\n\t\t\t\tconsole.error('Could not find image element to copy for output with id', outputId);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error('Could not copy image:', e);\n\t\t}\n\t};\n\n\twindow.addEventListener('message', async rawEvent => {\n\t\tconst event = rawEvent as ({ data: webviewMessages.ToWebviewMessage });\n\n\t\tswitch (event.data.type) {\n\t\t\tcase 'initializeMarkup': {\n\t\t\t\ttry {\n\t\t\t\t\tawait Promise.all(event.data.cells.map(info => viewModel.ensureMarkupCell(info)));\n\t\t\t\t} finally {\n\t\t\t\t\tdimensionUpdater.updateImmediately();\n\t\t\t\t\tpostNotebookMessage('initializedMarkup', { requestId: event.data.requestId });\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'createMarkupCell':\n\t\t\t\tviewModel.ensureMarkupCell(event.data.cell);\n\t\t\t\tbreak;\n\n\t\t\tcase 'showMarkupCell':\n\t\t\t\tviewModel.showMarkupCell(event.data.id, event.data.top, event.data.content, event.data.metadata);\n\t\t\t\tbreak;\n\n\t\t\tcase 'hideMarkupCells':\n\t\t\t\tfor (const id of event.data.ids) {\n\t\t\t\t\tviewModel.hideMarkupCell(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'unhideMarkupCells':\n\t\t\t\tfor (const id of event.data.ids) {\n\t\t\t\t\tviewModel.unhideMarkupCell(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'deleteMarkupCell':\n\t\t\t\tfor (const id of event.data.ids) {\n\t\t\t\t\tviewModel.deleteMarkupCell(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'updateSelectedMarkupCells':\n\t\t\t\tviewModel.updateSelectedCells(event.data.selectedCellIds);\n\t\t\t\tbreak;\n\n\t\t\tcase 'html': {\n\t\t\t\tconst data = event.data;\n\t\t\t\tif (data.createOnIdle) {\n\t\t\t\t\toutputRunner.enqueueIdle(data.outputId, signal => {\n\t\t\t\t\t\t// cancel the idle callback if it exists\n\t\t\t\t\t\treturn viewModel.renderOutputCell(data, signal);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\toutputRunner.enqueue(data.outputId, signal => {\n\t\t\t\t\t\t// cancel the idle callback if it exists\n\t\t\t\t\t\treturn viewModel.renderOutputCell(data, signal);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'view-scroll':\n\t\t\t\t{\n\t\t\t\t\t// const date = new Date();\n\t\t\t\t\t// console.log('----- will scroll ----  ', date.getMinutes() + ':' + date.getSeconds() + ':' + date.getMilliseconds());\n\n\t\t\t\t\tevent.data.widgets.forEach(widget => {\n\t\t\t\t\t\toutputRunner.enqueue(widget.outputId, () => {\n\t\t\t\t\t\t\tviewModel.updateOutputsScroll([widget]);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tviewModel.updateMarkupScrolls(event.data.markupCells);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\tcase 'clear':\n\t\t\t\trenderers.clearAll();\n\t\t\t\tviewModel.clearAll();\n\t\t\t\tdocument.getElementById('container')!.innerText = '';\n\t\t\t\tbreak;\n\n\t\t\tcase 'clearOutput': {\n\t\t\t\tconst { cellId, rendererId, outputId } = event.data;\n\t\t\t\toutputRunner.cancelOutput(outputId);\n\t\t\t\tviewModel.clearOutput(cellId, outputId, rendererId);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'hideOutput': {\n\t\t\t\tconst { cellId, outputId } = event.data;\n\t\t\t\toutputRunner.enqueue(outputId, () => {\n\t\t\t\t\tviewModel.hideOutput(cellId);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'showOutput': {\n\t\t\t\tconst { outputId, cellTop, cellId, content } = event.data;\n\t\t\t\toutputRunner.enqueue(outputId, () => {\n\t\t\t\t\tviewModel.showOutput(cellId, outputId, cellTop);\n\t\t\t\t\tif (content) {\n\t\t\t\t\t\tviewModel.updateAndRerender(cellId, outputId, content);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'copyImage': {\n\t\t\t\tawait copyOutputImage(event.data.outputId, event.data.altOutputId);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'ack-dimension': {\n\t\t\t\tfor (const { cellId, outputId, height } of event.data.updates) {\n\t\t\t\t\tviewModel.updateOutputHeight(cellId, outputId, height);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'preload': {\n\t\t\t\tconst resources = event.data.resources;\n\t\t\t\tfor (const { uri } of resources) {\n\t\t\t\t\tkernelPreloads.load(uri);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'updateRenderers': {\n\t\t\t\tconst { rendererData } = event.data;\n\t\t\t\trenderers.updateRendererData(rendererData);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'focus-output':\n\t\t\t\tfocusFirstFocusableOrContainerInOutput(event.data.cellOrOutputId, event.data.alternateId);\n\t\t\t\tbreak;\n\t\t\tcase 'decorations': {\n\t\t\t\tlet outputContainer = document.getElementById(event.data.cellId);\n\t\t\t\tif (!outputContainer) {\n\t\t\t\t\tviewModel.ensureOutputCell(event.data.cellId, -100000, true);\n\t\t\t\t\toutputContainer = document.getElementById(event.data.cellId);\n\t\t\t\t}\n\t\t\t\toutputContainer?.classList.add(...event.data.addedClassNames);\n\t\t\t\toutputContainer?.classList.remove(...event.data.removedClassNames);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'customKernelMessage':\n\t\t\t\tonDidReceiveKernelMessage.fire(event.data.message);\n\t\t\t\tbreak;\n\t\t\tcase 'customRendererMessage':\n\t\t\t\trenderers.getRenderer(event.data.rendererId)?.receiveMessage(event.data.message);\n\t\t\t\tbreak;\n\t\t\tcase 'notebookStyles': {\n\t\t\t\tconst documentStyle = document.documentElement.style;\n\n\t\t\t\tfor (let i = documentStyle.length - 1; i >= 0; i--) {\n\t\t\t\t\tconst property = documentStyle[i];\n\n\t\t\t\t\t// Don't remove properties that the webview might have added separately\n\t\t\t\t\tif (property && property.startsWith('--notebook-')) {\n\t\t\t\t\t\tdocumentStyle.removeProperty(property);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Re-add new properties\n\t\t\t\tfor (const [name, value] of Object.entries(event.data.styles)) {\n\t\t\t\t\tdocumentStyle.setProperty(`--${name}`, value);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'notebookOptions':\n\t\t\t\tcurrentOptions = event.data.options;\n\t\t\t\tviewModel.toggleDragDropEnabled(currentOptions.dragAndDropEnabled);\n\t\t\t\tcurrentRenderOptions = event.data.renderOptions;\n\t\t\t\tsettingChange.fire(currentRenderOptions);\n\t\t\t\tbreak;\n\t\t\tcase 'tokenizedCodeBlock': {\n\t\t\t\tconst { codeBlockId, html } = event.data;\n\t\t\t\tMarkdownCodeBlock.highlightCodeBlock(codeBlockId, html);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'tokenizedStylesChanged': {\n\t\t\t\ttokenizationStyle.replaceSync(event.data.css);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'find': {\n\t\t\t\t_highlighter.removeHighlights(event.data.options.ownerID);\n\t\t\t\tfind(event.data.query, event.data.options);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'findHighlightCurrent': {\n\t\t\t\t_highlighter?.highlightCurrentMatch(event.data.index, event.data.ownerID);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'findUnHighlightCurrent': {\n\t\t\t\t_highlighter?.unHighlightCurrentMatch(event.data.index, event.data.ownerID);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'findStop': {\n\t\t\t\t_highlighter.removeHighlights(event.data.ownerID);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'returnOutputItem': {\n\t\t\t\toutputItemRequests.resolveOutputItem(event.data.requestId, event.data.output);\n\t\t\t}\n\t\t}\n\t});\n\n\tconst renderFallbackErrorName = 'vscode.fallbackToNextRenderer';\n\n\tclass Renderer {\n\n\t\tprivate _onMessageEvent = createEmitter();\n\t\tprivate _loadPromise?: Promise<rendererApi.RendererApi | undefined>;\n\t\tprivate _api: rendererApi.RendererApi | undefined;\n\n\t\tconstructor(\n\t\t\tpublic readonly data: webviewMessages.RendererMetadata,\n\t\t) { }\n\n\t\tpublic receiveMessage(message: unknown) {\n\t\t\tthis._onMessageEvent.fire(message);\n\t\t}\n\n\t\tpublic async renderOutputItem(item: rendererApi.OutputItem, element: HTMLElement, signal: AbortSignal): Promise<void> {\n\t\t\ttry {\n\t\t\t\tawait this.load();\n\t\t\t} catch (e) {\n\t\t\t\tif (!signal.aborted) {\n\t\t\t\t\tshowRenderError(`Error loading renderer '${this.data.id}'`, element, e instanceof Error ? [e] : []);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._api) {\n\t\t\t\tif (!signal.aborted) {\n\t\t\t\t\tshowRenderError(`Renderer '${this.data.id}' does not implement renderOutputItem`, element, []);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst renderStart = performance.now();\n\t\t\t\tawait this._api.renderOutputItem(item, element, signal);\n\t\t\t\tthis.postDebugMessage('Rendered output item', { id: item.id, duration: `${performance.now() - renderStart}ms` });\n\n\t\t\t} catch (e) {\n\t\t\t\tif (signal.aborted) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e instanceof Error && e.name === renderFallbackErrorName) {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\n\t\t\t\tshowRenderError(`Error rendering output item using '${this.data.id}'`, element, e instanceof Error ? [e] : []);\n\t\t\t\tthis.postDebugMessage('Rendering output item failed', { id: item.id, error: e + '' });\n\t\t\t}\n\t\t}\n\n\t\tpublic disposeOutputItem(id?: string): void {\n\t\t\tthis._api?.disposeOutputItem?.(id);\n\t\t}\n\n\t\tprivate createRendererContext(): RendererContext {\n\t\t\tconst { id, messaging } = this.data;\n\t\t\tconst context: RendererContext = {\n\t\t\t\tsetState: newState => vscode.setState({ ...vscode.getState(), [id]: newState }),\n\t\t\t\tgetState: <T>() => {\n\t\t\t\t\tconst state = vscode.getState();\n\t\t\t\t\treturn typeof state === 'object' && state ? state[id] as T : undefined;\n\t\t\t\t},\n\t\t\t\tgetRenderer: async (id: string) => {\n\t\t\t\t\tconst renderer = renderers.getRenderer(id);\n\t\t\t\t\tif (!renderer) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\tif (renderer._api) {\n\t\t\t\t\t\treturn renderer._api;\n\t\t\t\t\t}\n\t\t\t\t\treturn renderer.load();\n\t\t\t\t},\n\t\t\t\tworkspace: {\n\t\t\t\t\tget isTrusted() { return isWorkspaceTrusted; }\n\t\t\t\t},\n\t\t\t\tsettings: {\n\t\t\t\t\tget lineLimit() { return currentRenderOptions.lineLimit; },\n\t\t\t\t\tget outputScrolling() { return currentRenderOptions.outputScrolling; },\n\t\t\t\t\tget outputWordWrap() { return currentRenderOptions.outputWordWrap; },\n\t\t\t\t},\n\t\t\t\tget onDidChangeSettings() { return settingChange.event; }\n\t\t\t};\n\n\t\t\tif (messaging) {\n\t\t\t\tcontext.onDidReceiveMessage = this._onMessageEvent.event;\n\t\t\t\tcontext.postMessage = message => postNotebookMessage('customRendererMessage', { rendererId: id, message });\n\t\t\t}\n\n\t\t\treturn Object.freeze(context);\n\t\t}\n\n\t\tprivate load(): Promise<rendererApi.RendererApi | undefined> {\n\t\t\tthis._loadPromise ??= this._load();\n\t\t\treturn this._loadPromise;\n\t\t}\n\n\t\t/** Inner function cached in the _loadPromise(). */\n\t\tprivate async _load(): Promise<rendererApi.RendererApi | undefined> {\n\t\t\tthis.postDebugMessage('Start loading renderer');\n\n\t\t\ttry {\n\t\t\t\t// Preloads need to be loaded before loading renderers.\n\t\t\t\tawait kernelPreloads.waitForAllCurrent();\n\n\t\t\t\tconst importStart = performance.now();\n\t\t\t\tconst module: RendererModule = await __import(this.data.entrypoint.path);\n\t\t\t\tthis.postDebugMessage('Imported renderer', { duration: `${performance.now() - importStart}ms` });\n\n\t\t\t\tif (!module) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis._api = await module.activate(this.createRendererContext());\n\t\t\t\tthis.postDebugMessage('Activated renderer', { duration: `${performance.now() - importStart}ms` });\n\n\t\t\t\tconst dependantRenderers = ctx.rendererData\n\t\t\t\t\t.filter(d => d.entrypoint.extends === this.data.id);\n\n\t\t\t\tif (dependantRenderers.length) {\n\t\t\t\t\tthis.postDebugMessage('Activating dependant renderers', { dependents: dependantRenderers.map(x => x.id).join(', ') });\n\t\t\t\t}\n\n\t\t\t\t// Load all renderers that extend this renderer\n\t\t\t\tawait Promise.all(dependantRenderers.map(async d => {\n\t\t\t\t\tconst renderer = renderers.getRenderer(d.id);\n\t\t\t\t\tif (!renderer) {\n\t\t\t\t\t\tthrow new Error(`Could not find extending renderer: ${d.id}`);\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn await renderer.load();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t// Squash any errors extends errors. They won't prevent the renderer\n\t\t\t\t\t\t// itself from working, so just log them.\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\tthis.postDebugMessage('Activating dependant renderer failed', { dependent: d.id, error: e + '' });\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\treturn this._api;\n\t\t\t} catch (e) {\n\t\t\t\tthis.postDebugMessage('Loading renderer failed');\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\n\t\tprivate postDebugMessage(msg: string, data?: Record<string, string>) {\n\t\t\tpostNotebookMessage<webviewMessages.ILogRendererDebugMessage>('logRendererDebugMessage', {\n\t\t\t\tmessage: `[renderer ${this.data.id}] - ${msg}`,\n\t\t\t\tdata\n\t\t\t});\n\t\t}\n\t}\n\n\tconst kernelPreloads = new class {\n\t\tprivate readonly preloads = new Map<string /* uri */, Promise<unknown>>();\n\n\t\t/**\n\t\t * Returns a promise that resolves when the given preload is activated.\n\t\t */\n\t\tpublic waitFor(uri: string) {\n\t\t\treturn this.preloads.get(uri) || Promise.resolve(new Error(`Preload not ready: ${uri}`));\n\t\t}\n\n\t\t/**\n\t\t * Loads a preload.\n\t\t * @param uri URI to load from\n\t\t * @param originalUri URI to show in an error message if the preload is invalid.\n\t\t */\n\t\tpublic load(uri: string) {\n\t\t\tconst promise = Promise.all([\n\t\t\t\trunKernelPreload(uri),\n\t\t\t\tthis.waitForAllCurrent(),\n\t\t\t]);\n\n\t\t\tthis.preloads.set(uri, promise);\n\t\t\treturn promise;\n\t\t}\n\n\t\t/**\n\t\t * Returns a promise that waits for all currently-registered preloads to\n\t\t * activate before resolving.\n\t\t */\n\t\tpublic waitForAllCurrent() {\n\t\t\treturn Promise.all([...this.preloads.values()].map(p => p.catch(err => err)));\n\t\t}\n\t};\n\n\tconst outputRunner = new class {\n\t\tprivate readonly outputs = new Map<string, { abort: AbortController; queue: Promise<unknown> }>();\n\n\t\t/**\n\t\t * Pushes the action onto the list of actions for the given output ID,\n\t\t * ensuring that it's run in-order.\n\t\t */\n\t\tpublic enqueue(outputId: string, action: (cancelSignal: AbortSignal) => unknown) {\n\t\t\tthis.pendingOutputCreationRequest.get(outputId)?.dispose();\n\t\t\tthis.pendingOutputCreationRequest.delete(outputId);\n\n\t\t\tconst record = this.outputs.get(outputId);\n\t\t\tif (!record) {\n\t\t\t\tconst controller = new AbortController();\n\t\t\t\tthis.outputs.set(outputId, { abort: controller, queue: new Promise(r => r(action(controller.signal))) });\n\t\t\t} else {\n\t\t\t\trecord.queue = record.queue.then(async r => {\n\t\t\t\t\tif (!record.abort.signal.aborted) {\n\t\t\t\t\t\tawait action(record.abort.signal);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tprivate pendingOutputCreationRequest: Map<string, IDisposable> = new Map();\n\n\t\tpublic enqueueIdle(outputId: string, action: (cancelSignal: AbortSignal) => unknown) {\n\t\t\tthis.pendingOutputCreationRequest.get(outputId)?.dispose();\n\t\t\toutputRunner.pendingOutputCreationRequest.set(outputId, runWhenIdle(() => {\n\t\t\t\toutputRunner.enqueue(outputId, action);\n\t\t\t\toutputRunner.pendingOutputCreationRequest.delete(outputId);\n\t\t\t}));\n\t\t}\n\n\t\t/**\n\t\t * Cancels the rendering of all outputs.\n\t\t */\n\t\tpublic cancelAll() {\n\t\t\t// Delete all pending idle requests\n\t\t\tthis.pendingOutputCreationRequest.forEach(r => r.dispose());\n\t\t\tthis.pendingOutputCreationRequest.clear();\n\n\t\t\tfor (const { abort } of this.outputs.values()) {\n\t\t\t\tabort.abort();\n\t\t\t}\n\t\t\tthis.outputs.clear();\n\t\t}\n\n\t\t/**\n\t\t * Cancels any ongoing rendering out an output.\n\t\t */\n\t\tpublic cancelOutput(outputId: string) {\n\t\t\t// Delete the pending idle request if it exists\n\t\t\tthis.pendingOutputCreationRequest.get(outputId)?.dispose();\n\t\t\tthis.pendingOutputCreationRequest.delete(outputId);\n\n\t\t\tconst output = this.outputs.get(outputId);\n\t\t\tif (output) {\n\t\t\t\toutput.abort.abort();\n\t\t\t\tthis.outputs.delete(outputId);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst renderers = new class {\n\t\tprivate readonly _renderers = new Map</* id */ string, Renderer>();\n\n\t\tconstructor() {\n\t\t\tfor (const renderer of ctx.rendererData) {\n\t\t\t\tthis.addRenderer(renderer);\n\t\t\t}\n\t\t}\n\n\t\tpublic getRenderer(id: string): Renderer | undefined {\n\t\t\treturn this._renderers.get(id);\n\t\t}\n\n\t\tprivate rendererEqual(a: webviewMessages.RendererMetadata, b: webviewMessages.RendererMetadata) {\n\t\t\tif (a.id !== b.id || a.entrypoint.path !== b.entrypoint.path || a.entrypoint.extends !== b.entrypoint.extends || a.messaging !== b.messaging) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (a.mimeTypes.length !== b.mimeTypes.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < a.mimeTypes.length; i++) {\n\t\t\t\tif (a.mimeTypes[i] !== b.mimeTypes[i]) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\tpublic updateRendererData(rendererData: readonly webviewMessages.RendererMetadata[]) {\n\t\t\tconst oldKeys = new Set(this._renderers.keys());\n\t\t\tconst newKeys = new Set(rendererData.map(d => d.id));\n\n\t\t\tfor (const renderer of rendererData) {\n\t\t\t\tconst existing = this._renderers.get(renderer.id);\n\t\t\t\tif (existing && this.rendererEqual(existing.data, renderer)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.addRenderer(renderer);\n\t\t\t}\n\n\t\t\tfor (const key of oldKeys) {\n\t\t\t\tif (!newKeys.has(key)) {\n\t\t\t\t\tthis._renderers.delete(key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate addRenderer(renderer: webviewMessages.RendererMetadata) {\n\t\t\tthis._renderers.set(renderer.id, new Renderer(renderer));\n\t\t}\n\n\t\tpublic clearAll() {\n\t\t\toutputRunner.cancelAll();\n\t\t\tfor (const renderer of this._renderers.values()) {\n\t\t\t\trenderer.disposeOutputItem();\n\t\t\t}\n\t\t}\n\n\t\tpublic clearOutput(rendererId: string, outputId: string) {\n\t\t\toutputRunner.cancelOutput(outputId);\n\t\t\tthis._renderers.get(rendererId)?.disposeOutputItem(outputId);\n\t\t}\n\n\t\tpublic async render(item: ExtendedOutputItem, preferredRendererId: string | undefined, element: HTMLElement, signal: AbortSignal): Promise<void> {\n\t\t\tconst primaryRenderer = this.findRenderer(preferredRendererId, item);\n\t\t\tif (!primaryRenderer) {\n\t\t\t\tconst errorMessage = (document.documentElement.style.getPropertyValue('--notebook-cell-renderer-not-found-error') || '').replace('$0', () => item.mime);\n\t\t\t\tthis.showRenderError(item, element, errorMessage);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Try primary renderer first\n\t\t\tif (!(await this._doRender(item, element, primaryRenderer, signal)).continue) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Primary renderer failed in an expected way. Fallback to render the next mime types\n\t\t\tfor (const additionalItemData of item._allOutputItems) {\n\t\t\t\tif (additionalItemData.mime === item.mime) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst additionalItem = await additionalItemData.getItem();\n\t\t\t\tif (signal.aborted) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (additionalItem) {\n\t\t\t\t\tconst renderer = this.findRenderer(undefined, additionalItem);\n\t\t\t\t\tif (renderer) {\n\t\t\t\t\t\tif (!(await this._doRender(additionalItem, element, renderer, signal)).continue) {\n\t\t\t\t\t\t\treturn; // We rendered successfully\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// All renderers have failed and there is nothing left to fallback to\n\t\t\tconst errorMessage = (document.documentElement.style.getPropertyValue('--notebook-cell-renderer-fallbacks-exhausted') || '').replace('$0', () => item.mime);\n\t\t\tthis.showRenderError(item, element, errorMessage);\n\t\t}\n\n\t\tprivate async _doRender(item: rendererApi.OutputItem, element: HTMLElement, renderer: Renderer, signal: AbortSignal): Promise<{ continue: boolean }> {\n\t\t\ttry {\n\t\t\t\tawait renderer.renderOutputItem(item, element, signal);\n\t\t\t\treturn { continue: false }; // We rendered successfully\n\t\t\t} catch (e) {\n\t\t\t\tif (signal.aborted) {\n\t\t\t\t\treturn { continue: false };\n\t\t\t\t}\n\n\t\t\t\tif (e instanceof Error && e.name === renderFallbackErrorName) {\n\t\t\t\t\treturn { continue: true };\n\t\t\t\t} else {\n\t\t\t\t\tthrow e; // Bail and let callers handle unknown errors\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate findRenderer(preferredRendererId: string | undefined, info: rendererApi.OutputItem) {\n\t\t\tlet renderer: Renderer | undefined;\n\n\t\t\tif (typeof preferredRendererId === 'string') {\n\t\t\t\trenderer = Array.from(this._renderers.values())\n\t\t\t\t\t.find((renderer) => renderer.data.id === preferredRendererId);\n\t\t\t} else {\n\t\t\t\tconst renderers = Array.from(this._renderers.values())\n\t\t\t\t\t.filter((renderer) => renderer.data.mimeTypes.includes(info.mime) && !renderer.data.entrypoint.extends);\n\n\t\t\t\tif (renderers.length) {\n\t\t\t\t\t// De-prioritize built-in renderers\n\t\t\t\t\trenderers.sort((a, b) => +a.data.isBuiltin - +b.data.isBuiltin);\n\n\t\t\t\t\t// Use first renderer we find in sorted list\n\t\t\t\t\trenderer = renderers[0];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn renderer;\n\t\t}\n\n\t\tprivate showRenderError(info: rendererApi.OutputItem, element: HTMLElement, errorMessage: string) {\n\t\t\tconst errorContainer = document.createElement('div');\n\n\t\t\tconst error = document.createElement('div');\n\t\t\terror.className = 'no-renderer-error';\n\t\t\terror.innerText = errorMessage;\n\n\t\t\tconst cellText = document.createElement('div');\n\t\t\tcellText.innerText = info.text();\n\n\t\t\terrorContainer.appendChild(error);\n\t\t\terrorContainer.appendChild(cellText);\n\n\t\t\telement.innerText = '';\n\t\t\telement.appendChild(errorContainer);\n\t\t}\n\t}();\n\n\tconst viewModel = new class ViewModel {\n\n\t\tprivate readonly _markupCells = new Map<string, MarkupCell>();\n\t\tprivate readonly _outputCells = new Map<string, OutputCell>();\n\n\t\tpublic clearAll() {\n\t\t\tfor (const cell of this._markupCells.values()) {\n\t\t\t\tcell.dispose();\n\t\t\t}\n\t\t\tthis._markupCells.clear();\n\n\t\t\tfor (const output of this._outputCells.values()) {\n\t\t\t\toutput.dispose();\n\t\t\t}\n\t\t\tthis._outputCells.clear();\n\t\t}\n\n\t\tprivate async createMarkupCell(init: webviewMessages.IMarkupCellInitialization, top: number, visible: boolean): Promise<MarkupCell> {\n\t\t\tconst existing = this._markupCells.get(init.cellId);\n\t\t\tif (existing) {\n\t\t\t\tconsole.error(`Trying to create markup that already exists: ${init.cellId}`);\n\t\t\t\treturn existing;\n\t\t\t}\n\n\t\t\tconst cell = new MarkupCell(init.cellId, init.mime, init.content, top, init.metadata);\n\t\t\tcell.element.style.visibility = visible ? '' : 'hidden';\n\t\t\tthis._markupCells.set(init.cellId, cell);\n\n\t\t\tawait cell.ready;\n\t\t\treturn cell;\n\t\t}\n\n\t\tpublic async ensureMarkupCell(info: webviewMessages.IMarkupCellInitialization): Promise<void> {\n\t\t\tlet cell = this._markupCells.get(info.cellId);\n\t\t\tif (cell) {\n\t\t\t\tcell.element.style.visibility = info.visible ? '' : 'hidden';\n\t\t\t\tawait cell.updateContentAndRender(info.content, info.metadata);\n\t\t\t} else {\n\t\t\t\tcell = await this.createMarkupCell(info, info.offset, info.visible);\n\t\t\t}\n\t\t}\n\n\t\tpublic deleteMarkupCell(id: string) {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tif (cell) {\n\t\t\t\tcell.remove();\n\t\t\t\tcell.dispose();\n\t\t\t\tthis._markupCells.delete(id);\n\t\t\t}\n\t\t}\n\n\t\tpublic async updateMarkupContent(id: string, newContent: string, metadata: NotebookCellMetadata): Promise<void> {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tawait cell?.updateContentAndRender(newContent, metadata);\n\t\t}\n\n\t\tpublic showMarkupCell(id: string, top: number, newContent: string | undefined, metadata: NotebookCellMetadata | undefined): void {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tcell?.show(top, newContent, metadata);\n\t\t}\n\n\t\tpublic hideMarkupCell(id: string): void {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tcell?.hide();\n\t\t}\n\n\t\tpublic unhideMarkupCell(id: string): void {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tcell?.unhide();\n\t\t}\n\n\t\tprivate getExpectedMarkupCell(id: string): MarkupCell | undefined {\n\t\t\tconst cell = this._markupCells.get(id);\n\t\t\tif (!cell) {\n\t\t\t\tconsole.log(`Could not find markup cell '${id}'`);\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn cell;\n\t\t}\n\n\t\tpublic updateSelectedCells(selectedCellIds: readonly string[]) {\n\t\t\tconst selectedCellSet = new Set<string>(selectedCellIds);\n\t\t\tfor (const cell of this._markupCells.values()) {\n\t\t\t\tcell.setSelected(selectedCellSet.has(cell.id));\n\t\t\t}\n\t\t}\n\n\t\tpublic toggleDragDropEnabled(dragAndDropEnabled: boolean) {\n\t\t\tfor (const cell of this._markupCells.values()) {\n\t\t\t\tcell.toggleDragDropEnabled(dragAndDropEnabled);\n\t\t\t}\n\t\t}\n\n\t\tpublic updateMarkupScrolls(markupCells: readonly webviewMessages.IMarkupCellScrollTops[]) {\n\t\t\tfor (const { id, top } of markupCells) {\n\t\t\t\tconst cell = this._markupCells.get(id);\n\t\t\t\tif (cell) {\n\t\t\t\t\tcell.element.style.top = `${top}px`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tpublic async renderOutputCell(data: webviewMessages.ICreationRequestMessage, signal: AbortSignal): Promise<void> {\n\t\t\tconst preloadErrors = await Promise.all<undefined | Error>(\n\t\t\t\tdata.requiredPreloads.map(p => kernelPreloads.waitFor(p.uri).then(() => undefined, err => err))\n\t\t\t);\n\t\t\tif (signal.aborted) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst cellOutput = this.ensureOutputCell(data.cellId, data.cellTop, false);\n\t\t\treturn cellOutput.renderOutputElement(data, preloadErrors, signal);\n\t\t}\n\n\t\tpublic ensureOutputCell(cellId: string, cellTop: number, skipCellTopUpdateIfExist: boolean): OutputCell {\n\t\t\tlet cell = this._outputCells.get(cellId);\n\t\t\tconst existed = !!cell;\n\t\t\tif (!cell) {\n\t\t\t\tcell = new OutputCell(cellId);\n\t\t\t\tthis._outputCells.set(cellId, cell);\n\t\t\t}\n\n\t\t\tif (existed && skipCellTopUpdateIfExist) {\n\t\t\t\treturn cell;\n\t\t\t}\n\n\t\t\tcell.element.style.top = cellTop + 'px';\n\t\t\treturn cell;\n\t\t}\n\n\t\tpublic clearOutput(cellId: string, outputId: string, rendererId: string | undefined) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.clearOutput(outputId, rendererId);\n\t\t}\n\n\t\tpublic showOutput(cellId: string, outputId: string, top: number) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.show(outputId, top);\n\t\t}\n\n\t\tpublic updateAndRerender(cellId: string, outputId: string, content: webviewMessages.ICreationContent) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.updateContentAndRerender(outputId, content);\n\t\t}\n\n\t\tpublic hideOutput(cellId: string) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.hide();\n\t\t}\n\n\t\tpublic updateOutputHeight(cellId: string, outputId: string, height: number) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.updateOutputHeight(outputId, height);\n\t\t}\n\n\t\tpublic updateOutputsScroll(updates: webviewMessages.IContentWidgetTopRequest[]) {\n\t\t\tfor (const request of updates) {\n\t\t\t\tconst cell = this._outputCells.get(request.cellId);\n\t\t\t\tcell?.updateScroll(request);\n\t\t\t}\n\t\t}\n\t}();\n\n\tclass MarkdownCodeBlock {\n\t\tprivate static pendingCodeBlocksToHighlight = new Map<string, HTMLElement>();\n\n\t\tpublic static highlightCodeBlock(id: string, html: string) {\n\t\t\tconst el = MarkdownCodeBlock.pendingCodeBlocksToHighlight.get(id);\n\t\t\tif (!el) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst trustedHtml = ttPolicy?.createHTML(html) ?? html;\n\t\t\tel.innerHTML = trustedHtml as string;\n\t\t\tconst root = el.getRootNode();\n\t\t\tif (root instanceof ShadowRoot) {\n\t\t\t\tif (!root.adoptedStyleSheets.includes(tokenizationStyle)) {\n\t\t\t\t\troot.adoptedStyleSheets.push(tokenizationStyle);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tpublic static requestHighlightCodeBlock(root: HTMLElement | ShadowRoot) {\n\t\t\tconst codeBlocks: Array<{ value: string; lang: string; id: string }> = [];\n\t\t\tlet i = 0;\n\t\t\tfor (const el of root.querySelectorAll('.vscode-code-block')) {\n\t\t\t\tconst lang = el.getAttribute('data-vscode-code-block-lang');\n\t\t\t\tif (el.textContent && lang) {\n\t\t\t\t\tconst id = `${Date.now()}-${i++}`;\n\t\t\t\t\tcodeBlocks.push({ value: el.textContent, lang: lang, id });\n\t\t\t\t\tMarkdownCodeBlock.pendingCodeBlocksToHighlight.set(id, el as HTMLElement);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn codeBlocks;\n\t\t}\n\t}\n\n\tclass MarkupCell {\n\n\t\tpublic readonly ready: Promise<void>;\n\n\t\tpublic readonly id: string;\n\t\tpublic readonly element: HTMLElement;\n\n\t\tprivate readonly outputItem: ExtendedOutputItem;\n\n\t\t/// Internal field that holds text content\n\t\tprivate _content: { readonly value: string; readonly version: number; readonly metadata: NotebookCellMetadata };\n\n\t\tprivate _isDisposed = false;\n\t\tprivate renderTaskAbort?: AbortController;\n\n\t\tconstructor(id: string, mime: string, content: string, top: number, metadata: NotebookCellMetadata) {\n\t\t\tconst self = this;\n\t\t\tthis.id = id;\n\t\t\tthis._content = { value: content, version: 0, metadata: metadata };\n\n\t\t\tlet resolve: () => void;\n\t\t\tlet reject: () => void;\n\t\t\tthis.ready = new Promise<void>((res, rej) => {\n\t\t\t\tresolve = res;\n\t\t\t\treject = rej;\n\t\t\t});\n\n\t\t\tlet cachedData: { readonly version: number; readonly value: Uint8Array } | undefined;\n\t\t\tthis.outputItem = Object.freeze<ExtendedOutputItem>({\n\t\t\t\tid,\n\t\t\t\tmime,\n\n\t\t\t\tget metadata(): NotebookCellMetadata {\n\t\t\t\t\treturn self._content.metadata;\n\t\t\t\t},\n\n\t\t\t\ttext: (): string => {\n\t\t\t\t\treturn this._content.value;\n\t\t\t\t},\n\n\t\t\t\tjson: () => {\n\t\t\t\t\treturn undefined;\n\t\t\t\t},\n\n\t\t\t\tdata: (): Uint8Array => {\n\t\t\t\t\tif (cachedData?.version === this._content.version) {\n\t\t\t\t\t\treturn cachedData.value;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst data = textEncoder.encode(this._content.value);\n\t\t\t\t\tcachedData = { version: this._content.version, value: data };\n\t\t\t\t\treturn data;\n\t\t\t\t},\n\n\t\t\t\tblob(): Blob {\n\t\t\t\t\treturn new Blob([this.data()], { type: this.mime });\n\t\t\t\t},\n\n\t\t\t\t_allOutputItems: [{\n\t\t\t\t\tmime,\n\t\t\t\t\tgetItem: async () => this.outputItem,\n\t\t\t\t}]\n\t\t\t});\n\n\t\t\tconst root = document.getElementById('container')!;\n\t\t\tconst markupCell = document.createElement('div');\n\t\t\tmarkupCell.className = 'markup';\n\t\t\tmarkupCell.style.position = 'absolute';\n\t\t\tmarkupCell.style.width = '100%';\n\n\t\t\tthis.element = document.createElement('div');\n\t\t\tthis.element.id = this.id;\n\t\t\tthis.element.classList.add('preview');\n\t\t\tthis.element.style.position = 'absolute';\n\t\t\tthis.element.style.top = top + 'px';\n\t\t\tthis.toggleDragDropEnabled(currentOptions.dragAndDropEnabled);\n\t\t\tmarkupCell.appendChild(this.element);\n\t\t\troot.appendChild(markupCell);\n\n\t\t\tthis.addEventListeners();\n\n\t\t\tthis.updateContentAndRender(this._content.value, this._content.metadata).then(() => {\n\t\t\t\tif (!this._isDisposed) {\n\t\t\t\t\tresizeObserver.observe(this.element, this.id, false, this.id);\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t}, () => reject());\n\t\t}\n\n\t\tpublic dispose() {\n\t\t\tthis._isDisposed = true;\n\t\t\tthis.renderTaskAbort?.abort();\n\t\t\tthis.renderTaskAbort = undefined;\n\t\t}\n\n\t\tprivate addEventListeners() {\n\t\t\tthis.element.addEventListener('dblclick', () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IToggleMarkupPreviewMessage>('toggleMarkupPreview', { cellId: this.id });\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('click', e => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IClickMarkupCellMessage>('clickMarkupCell', {\n\t\t\t\t\tcellId: this.id,\n\t\t\t\t\taltKey: e.altKey,\n\t\t\t\t\tctrlKey: e.ctrlKey,\n\t\t\t\t\tmetaKey: e.metaKey,\n\t\t\t\t\tshiftKey: e.shiftKey,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('contextmenu', e => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IContextMenuMarkupCellMessage>('contextMenuMarkupCell', {\n\t\t\t\t\tcellId: this.id,\n\t\t\t\t\tclientX: e.clientX,\n\t\t\t\t\tclientY: e.clientY,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('mouseenter', () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IMouseEnterMarkupCellMessage>('mouseEnterMarkupCell', { cellId: this.id });\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('mouseleave', () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IMouseLeaveMarkupCellMessage>('mouseLeaveMarkupCell', { cellId: this.id });\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('dragstart', e => {\n\t\t\t\tmarkupCellDragManager.startDrag(e, this.id);\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('drag', e => {\n\t\t\t\tmarkupCellDragManager.updateDrag(e, this.id);\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('dragend', e => {\n\t\t\t\tmarkupCellDragManager.endDrag(e, this.id);\n\t\t\t});\n\t\t}\n\n\t\tpublic async updateContentAndRender(newContent: string, metadata: NotebookCellMetadata): Promise<void> {\n\t\t\tthis._content = { value: newContent, version: this._content.version + 1, metadata };\n\n\t\t\tthis.renderTaskAbort?.abort();\n\n\t\t\tconst controller = new AbortController();\n\t\t\tthis.renderTaskAbort = controller;\n\t\t\ttry {\n\t\t\t\tawait renderers.render(this.outputItem, undefined, this.element, this.renderTaskAbort.signal);\n\t\t\t} finally {\n\t\t\t\tif (this.renderTaskAbort === controller) {\n\t\t\t\t\tthis.renderTaskAbort = undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst root = (this.element.shadowRoot ?? this.element);\n\t\t\tconst html = [];\n\t\t\tfor (const child of root.children) {\n\t\t\t\tswitch (child.tagName) {\n\t\t\t\t\tcase 'LINK':\n\t\t\t\t\tcase 'SCRIPT':\n\t\t\t\t\tcase 'STYLE':\n\t\t\t\t\t\t// not worth sending over since it will be stripped before rendering\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\thtml.push(child.outerHTML);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst codeBlocks: Array<{ value: string; lang: string; id: string }> = MarkdownCodeBlock.requestHighlightCodeBlock(root);\n\n\t\t\tpostNotebookMessage<webviewMessages.IRenderedMarkupMessage>('renderedMarkup', {\n\t\t\t\tcellId: this.id,\n\t\t\t\thtml: html.join(''),\n\t\t\t\tcodeBlocks\n\t\t\t});\n\n\t\t\tdimensionUpdater.updateHeight(this.id, this.element.offsetHeight, {\n\t\t\t\tisOutput: false\n\t\t\t});\n\t\t}\n\n\t\tpublic show(top: number, newContent: string | undefined, metadata: NotebookCellMetadata | undefined): void {\n\t\t\tthis.element.style.visibility = '';\n\t\t\tthis.element.style.top = `${top}px`;\n\t\t\tif (typeof newContent === 'string' || metadata) {\n\t\t\t\tthis.updateContentAndRender(newContent ?? this._content.value, metadata ?? this._content.metadata);\n\t\t\t} else {\n\t\t\t\tthis.updateMarkupDimensions();\n\t\t\t}\n\t\t}\n\n\t\tpublic hide() {\n\t\t\tthis.element.style.visibility = 'hidden';\n\t\t}\n\n\t\tpublic unhide() {\n\t\t\tthis.element.style.visibility = '';\n\t\t\tthis.updateMarkupDimensions();\n\t\t}\n\n\t\tpublic remove() {\n\t\t\tthis.element.remove();\n\t\t}\n\n\t\tprivate async updateMarkupDimensions() {\n\t\t\tdimensionUpdater.updateHeight(this.id, this.element.offsetHeight, {\n\t\t\t\tisOutput: false\n\t\t\t});\n\t\t}\n\n\t\tpublic setSelected(selected: boolean) {\n\t\t\tthis.element.classList.toggle('selected', selected);\n\t\t}\n\n\t\tpublic toggleDragDropEnabled(enabled: boolean) {\n\t\t\tif (enabled) {\n\t\t\t\tthis.element.classList.add('draggable');\n\t\t\t\tthis.element.setAttribute('draggable', 'true');\n\t\t\t} else {\n\t\t\t\tthis.element.classList.remove('draggable');\n\t\t\t\tthis.element.removeAttribute('draggable');\n\t\t\t}\n\t\t}\n\t}\n\n\tclass OutputCell {\n\t\tpublic readonly element: HTMLElement;\n\t\tprivate readonly outputElements = new Map</*outputId*/ string, OutputContainer>();\n\n\t\tconstructor(cellId: string) {\n\t\t\tconst container = document.getElementById('container')!;\n\n\t\t\tconst upperWrapperElement = createFocusSink(cellId);\n\t\t\tcontainer.appendChild(upperWrapperElement);\n\n\t\t\tthis.element = document.createElement('div');\n\t\t\tthis.element.style.position = 'absolute';\n\t\t\tthis.element.style.outline = '0';\n\n\t\t\tthis.element.id = cellId;\n\t\t\tthis.element.classList.add('cell_container');\n\n\t\t\tcontainer.appendChild(this.element);\n\t\t\tthis.element = this.element;\n\n\t\t\tconst lowerWrapperElement = createFocusSink(cellId, true);\n\t\t\tcontainer.appendChild(lowerWrapperElement);\n\t\t}\n\n\t\tpublic dispose() {\n\t\t\tfor (const output of this.outputElements.values()) {\n\t\t\t\toutput.dispose();\n\t\t\t}\n\t\t\tthis.outputElements.clear();\n\t\t}\n\n\t\tprivate createOutputElement(data: webviewMessages.ICreationRequestMessage): OutputElement {\n\t\t\tlet outputContainer = this.outputElements.get(data.outputId);\n\t\t\tif (!outputContainer) {\n\t\t\t\toutputContainer = new OutputContainer(data.outputId);\n\t\t\t\tthis.element.appendChild(outputContainer.element);\n\t\t\t\tthis.outputElements.set(data.outputId, outputContainer);\n\t\t\t}\n\n\t\t\treturn outputContainer.createOutputElement(data.outputId, data.outputOffset, data.left, data.cellId);\n\t\t}\n\n\t\tpublic async renderOutputElement(data: webviewMessages.ICreationRequestMessage, preloadErrors: ReadonlyArray<Error | undefined>, signal: AbortSignal) {\n\t\t\tconst startTime = Date.now();\n\t\t\tconst outputElement /** outputNode */ = this.createOutputElement(data);\n\t\t\tawait outputElement.render(data.content, data.rendererId, preloadErrors, signal);\n\n\t\t\t// don't hide until after this step so that the height is right\n\t\t\toutputElement/** outputNode */.element.style.visibility = data.initiallyHidden ? 'hidden' : '';\n\n\t\t\tif (!!data.executionId && !!data.rendererId) {\n\t\t\t\tpostNotebookMessage<webviewMessages.IPerformanceMessage>('notebookPerformanceMessage', { cellId: data.cellId, executionId: data.executionId, duration: Date.now() - startTime, rendererId: data.rendererId });\n\t\t\t}\n\t\t}\n\n\t\tpublic clearOutput(outputId: string, rendererId: string | undefined) {\n\t\t\tconst output = this.outputElements.get(outputId);\n\t\t\toutput?.clear(rendererId);\n\t\t\toutput?.dispose();\n\t\t\tthis.outputElements.delete(outputId);\n\t\t}\n\n\t\tpublic show(outputId: string, top: number) {\n\t\t\tconst outputContainer = this.outputElements.get(outputId);\n\t\t\tif (!outputContainer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.element.style.visibility = '';\n\t\t\tthis.element.style.top = `${top}px`;\n\n\t\t\tdimensionUpdater.updateHeight(outputId, outputContainer.element.offsetHeight, {\n\t\t\t\tisOutput: true,\n\t\t\t});\n\t\t}\n\n\t\tpublic hide() {\n\t\t\tthis.element.style.visibility = 'hidden';\n\t\t}\n\n\t\tpublic updateContentAndRerender(outputId: string, content: webviewMessages.ICreationContent) {\n\t\t\tthis.outputElements.get(outputId)?.updateContentAndRender(content);\n\t\t}\n\n\t\tpublic updateOutputHeight(outputId: string, height: number) {\n\t\t\tthis.outputElements.get(outputId)?.updateHeight(height);\n\t\t}\n\n\t\tpublic updateScroll(request: webviewMessages.IContentWidgetTopRequest) {\n\t\t\tthis.element.style.top = `${request.cellTop}px`;\n\n\t\t\tconst outputElement = this.outputElements.get(request.outputId);\n\t\t\tif (outputElement) {\n\t\t\t\toutputElement.updateScroll(request.outputOffset);\n\n\t\t\t\tif (request.forceDisplay && outputElement.outputNode) {\n\t\t\t\t\t// TODO @rebornix @mjbvz, there is a misalignment here.\n\t\t\t\t\t// We set output visibility on cell container, other than output container or output node itself.\n\t\t\t\t\toutputElement.outputNode.element.style.visibility = '';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (request.forceDisplay) {\n\t\t\t\tthis.element.style.visibility = '';\n\t\t\t}\n\t\t}\n\t}\n\n\tclass OutputContainer {\n\n\t\tpublic readonly element: HTMLElement;\n\n\t\tprivate _outputNode?: OutputElement;\n\n\t\tget outputNode() {\n\t\t\treturn this._outputNode;\n\t\t}\n\n\t\tconstructor(\n\t\t\tprivate readonly outputId: string,\n\t\t) {\n\t\t\tthis.element = document.createElement('div');\n\t\t\tthis.element.classList.add('output_container');\n\t\t\tthis.element.setAttribute('data-vscode-context', JSON.stringify({ 'preventDefaultContextMenuItems': true }));\n\t\t\tthis.element.style.position = 'absolute';\n\t\t\tthis.element.style.overflow = 'hidden';\n\t\t}\n\n\t\tpublic dispose() {\n\t\t\tthis._outputNode?.dispose();\n\t\t}\n\n\t\tpublic clear(rendererId: string | undefined) {\n\t\t\tif (rendererId) {\n\t\t\t\trenderers.clearOutput(rendererId, this.outputId);\n\t\t\t}\n\t\t\tthis.element.remove();\n\t\t}\n\n\t\tpublic updateHeight(height: number) {\n\t\t\tthis.element.style.maxHeight = `${height}px`;\n\t\t\tthis.element.style.height = `${height}px`;\n\t\t}\n\n\t\tpublic updateScroll(outputOffset: number) {\n\t\t\tthis.element.style.top = `${outputOffset}px`;\n\t\t}\n\n\t\tpublic createOutputElement(outputId: string, outputOffset: number, left: number, cellId: string): OutputElement {\n\t\t\tthis.element.innerText = '';\n\t\t\tthis.element.style.maxHeight = '0px';\n\t\t\tthis.element.style.top = `${outputOffset}px`;\n\n\t\t\tthis._outputNode?.dispose();\n\t\t\tthis._outputNode = new OutputElement(outputId, left, cellId);\n\t\t\tthis.element.appendChild(this._outputNode.element);\n\t\t\treturn this._outputNode;\n\t\t}\n\n\t\tpublic updateContentAndRender(content: webviewMessages.ICreationContent) {\n\t\t\tthis._outputNode?.updateAndRerender(content);\n\t\t}\n\t}\n\n\tvscode.postMessage({\n\t\t__vscode_notebook_message: true,\n\t\ttype: 'initialized'\n\t});\n\n\tfor (const preload of ctx.staticPreloadsData) {\n\t\tkernelPreloads.load(preload.entrypoint);\n\t}\n\n\tfunction postNotebookMessage<T extends webviewMessages.FromWebviewMessage>(\n\t\ttype: T['type'],\n\t\tproperties: Omit<T, '__vscode_notebook_message' | 'type'>\n\t) {\n\t\tvscode.postMessage({\n\t\t\t__vscode_notebook_message: true,\n\t\t\ttype,\n\t\t\t...properties\n\t\t});\n\t}\n\n\tclass OutputElement {\n\t\tpublic readonly element: HTMLElement;\n\t\tprivate _content?: {\n\t\t\treadonly preferredRendererId: string | undefined;\n\t\t\treadonly preloadErrors: ReadonlyArray<Error | undefined>;\n\t\t};\n\t\tprivate hasResizeObserver = false;\n\n\t\tprivate renderTaskAbort?: AbortController;\n\n\t\tconstructor(\n\t\t\tprivate readonly outputId: string,\n\t\t\tleft: number,\n\t\t\tpublic readonly cellId: string\n\t\t) {\n\t\t\tthis.element = document.createElement('div');\n\t\t\tthis.element.id = outputId;\n\t\t\tthis.element.classList.add('output');\n\t\t\tthis.element.style.position = 'absolute';\n\t\t\tthis.element.style.top = `0px`;\n\t\t\tthis.element.style.left = left + 'px';\n\t\t\tthis.element.style.padding = `${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodeLeftPadding}`;\n\n\t\t\tthis.element.addEventListener('mouseenter', () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IMouseEnterMessage>('mouseenter', { id: outputId });\n\t\t\t});\n\t\t\tthis.element.addEventListener('mouseleave', () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IMouseLeaveMessage>('mouseleave', { id: outputId });\n\t\t\t});\n\t\t}\n\n\t\tpublic dispose() {\n\t\t\tthis.renderTaskAbort?.abort();\n\t\t\tthis.renderTaskAbort = undefined;\n\t\t}\n\n\t\tpublic async render(content: webviewMessages.ICreationContent, preferredRendererId: string | undefined, preloadErrors: ReadonlyArray<Error | undefined>, signal?: AbortSignal) {\n\t\t\tthis.renderTaskAbort?.abort();\n\t\t\tthis.renderTaskAbort = undefined;\n\n\t\t\tthis._content = { preferredRendererId, preloadErrors };\n\t\t\tif (content.type === 0 /* RenderOutputType.Html */) {\n\t\t\t\tconst trustedHtml = ttPolicy?.createHTML(content.htmlContent) ?? content.htmlContent; // CodeQL [SM03712] The content comes from renderer extensions, not from direct user input.\n\t\t\t\tthis.element.innerHTML = trustedHtml as string;\n\t\t\t} else if (preloadErrors.some(e => e instanceof Error)) {\n\t\t\t\tconst errors = preloadErrors.filter((e): e is Error => e instanceof Error);\n\t\t\t\tshowRenderError(`Error loading preloads`, this.element, errors);\n\t\t\t} else {\n\t\t\t\tconst item = createOutputItem(this.outputId, content.output.mime, content.metadata, content.output.valueBytes, content.allOutputs, content.output.appended);\n\n\t\t\t\tconst controller = new AbortController();\n\t\t\t\tthis.renderTaskAbort = controller;\n\n\t\t\t\t// Abort rendering if caller aborts\n\t\t\t\tsignal?.addEventListener('abort', () => controller.abort());\n\n\t\t\t\ttry {\n\t\t\t\t\tawait renderers.render(item, preferredRendererId, this.element, controller.signal);\n\t\t\t\t} finally {\n\t\t\t\t\tif (this.renderTaskAbort === controller) {\n\t\t\t\t\t\tthis.renderTaskAbort = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.hasResizeObserver) {\n\t\t\t\tthis.hasResizeObserver = true;\n\t\t\t\tresizeObserver.observe(this.element, this.outputId, true, this.cellId);\n\t\t\t}\n\n\t\t\tconst offsetHeight = this.element.offsetHeight;\n\t\t\tconst cps = document.defaultView!.getComputedStyle(this.element);\n\t\t\tif (offsetHeight !== 0 && cps.padding === '0px') {\n\t\t\t\t// we set padding to zero if the output height is zero (then we can have a zero-height output DOM node)\n\t\t\t\t// thus we need to ensure the padding is accounted when updating the init height of the output\n\t\t\t\tdimensionUpdater.updateHeight(this.outputId, offsetHeight + ctx.style.outputNodePadding * 2, {\n\t\t\t\t\tisOutput: true,\n\t\t\t\t\tinit: true,\n\t\t\t\t});\n\n\t\t\t\tthis.element.style.padding = `${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodeLeftPadding}`;\n\t\t\t} else {\n\t\t\t\tdimensionUpdater.updateHeight(this.outputId, this.element.offsetHeight, {\n\t\t\t\t\tisOutput: true,\n\t\t\t\t\tinit: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst root = this.element.shadowRoot ?? this.element;\n\t\t\tconst codeBlocks: Array<{ value: string; lang: string; id: string }> = MarkdownCodeBlock.requestHighlightCodeBlock(root);\n\n\t\t\tif (codeBlocks.length > 0) {\n\t\t\t\tpostNotebookMessage<webviewMessages.IRenderedCellOutputMessage>('renderedCellOutput', {\n\t\t\t\t\tcodeBlocks\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tpublic updateAndRerender(content: webviewMessages.ICreationContent) {\n\t\t\tif (this._content) {\n\t\t\t\tthis.render(content, this._content.preferredRendererId, this._content.preloadErrors);\n\t\t\t}\n\t\t}\n\t}\n\n\tconst markupCellDragManager = new class MarkupCellDragManager {\n\n\t\tprivate currentDrag: { cellId: string; clientY: number } | undefined;\n\n\t\t// Transparent overlay that prevents elements from inside the webview from eating\n\t\t// drag events.\n\t\tprivate dragOverlay?: HTMLElement;\n\n\t\tconstructor() {\n\t\t\tdocument.addEventListener('dragover', e => {\n\t\t\t\t// Allow dropping dragged markup cells\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tdocument.addEventListener('drop', e => {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tconst drag = this.currentDrag;\n\t\t\t\tif (!drag) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.currentDrag = undefined;\n\t\t\t\tpostNotebookMessage<webviewMessages.ICellDropMessage>('cell-drop', {\n\t\t\t\t\tcellId: drag.cellId,\n\t\t\t\t\tctrlKey: e.ctrlKey,\n\t\t\t\t\taltKey: e.altKey,\n\t\t\t\t\tdragOffsetY: e.clientY,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tstartDrag(e: DragEvent, cellId: string) {\n\t\t\tif (!e.dataTransfer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!currentOptions.dragAndDropEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentDrag = { cellId, clientY: e.clientY };\n\n\t\t\tconst overlayZIndex = 9999;\n\t\t\tif (!this.dragOverlay) {\n\t\t\t\tthis.dragOverlay = document.createElement('div');\n\t\t\t\tthis.dragOverlay.style.position = 'absolute';\n\t\t\t\tthis.dragOverlay.style.top = '0';\n\t\t\t\tthis.dragOverlay.style.left = '0';\n\t\t\t\tthis.dragOverlay.style.zIndex = `${overlayZIndex}`;\n\t\t\t\tthis.dragOverlay.style.width = '100%';\n\t\t\t\tthis.dragOverlay.style.height = '100%';\n\t\t\t\tthis.dragOverlay.style.background = 'transparent';\n\t\t\t\tdocument.body.appendChild(this.dragOverlay);\n\t\t\t}\n\t\t\t(e.target as HTMLElement).style.zIndex = `${overlayZIndex + 1}`;\n\t\t\t(e.target as HTMLElement).classList.add('dragging');\n\n\t\t\tpostNotebookMessage<webviewMessages.ICellDragStartMessage>('cell-drag-start', {\n\t\t\t\tcellId: cellId,\n\t\t\t\tdragOffsetY: e.clientY,\n\t\t\t});\n\n\t\t\t// Continuously send updates while dragging instead of relying on `updateDrag`.\n\t\t\t// This lets us scroll the list based on drag position.\n\t\t\tconst trySendDragUpdate = () => {\n\t\t\t\tif (this.currentDrag?.cellId !== cellId) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tpostNotebookMessage<webviewMessages.ICellDragMessage>('cell-drag', {\n\t\t\t\t\tcellId: cellId,\n\t\t\t\t\tdragOffsetY: this.currentDrag.clientY,\n\t\t\t\t});\n\t\t\t\trequestAnimationFrame(trySendDragUpdate);\n\t\t\t};\n\t\t\trequestAnimationFrame(trySendDragUpdate);\n\t\t}\n\n\t\tupdateDrag(e: DragEvent, cellId: string) {\n\t\t\tif (cellId !== this.currentDrag?.cellId) {\n\t\t\t\tthis.currentDrag = undefined;\n\t\t\t} else {\n\t\t\t\tthis.currentDrag = { cellId, clientY: e.clientY };\n\t\t\t}\n\t\t}\n\n\t\tendDrag(e: DragEvent, cellId: string) {\n\t\t\tthis.currentDrag = undefined;\n\t\t\t(e.target as HTMLElement).classList.remove('dragging');\n\t\t\tpostNotebookMessage<webviewMessages.ICellDragEndMessage>('cell-drag-end', {\n\t\t\t\tcellId: cellId\n\t\t\t});\n\n\t\t\tif (this.dragOverlay) {\n\t\t\t\tdocument.body.removeChild(this.dragOverlay);\n\t\t\t\tthis.dragOverlay = undefined;\n\t\t\t}\n\n\t\t\t(e.target as HTMLElement).style.zIndex = '';\n\t\t}\n\t}();\n}\n\nexport function preloadsScriptStr(styleValues: PreloadStyles, options: PreloadOptions, renderOptions: RenderOptions, renderers: readonly webviewMessages.RendererMetadata[], preloads: readonly webviewMessages.StaticPreloadMetadata[], isWorkspaceTrusted: boolean, nonce: string) {\n\tconst ctx: PreloadContext = {\n\t\tstyle: styleValues,\n\t\toptions,\n\t\trenderOptions,\n\t\trendererData: renderers,\n\t\tstaticPreloadsData: preloads,\n\t\tisWorkspaceTrusted,\n\t\tnonce,\n\t};\n\t// TS will try compiling `import()` in webviewPreloads, so use a helper function instead\n\t// of using `import(...)` directly\n\treturn `\n\t\tconst __import = (x) => import(x);\n\t\t(${webviewPreloads})(\n\t\t\tJSON.parse(decodeURIComponent(\"${encodeURIComponent(JSON.stringify(ctx))}\"))\n\t\t)\\n//# sourceURL=notebookWebviewPreloads.js\\n`;\n}\n"]}