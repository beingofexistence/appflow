{"version":3,"sources":["vs/workbench/contrib/notebook/browser/controller/foldingController.ts"],"names":[],"mappings":"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","file":"foldingController.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { NOTEBOOK_EDITOR_FOCUSED, NOTEBOOK_IS_ACTIVE_EDITOR } from 'vs/workbench/contrib/notebook/common/notebookContextKeys';\nimport { INotebookEditor, INotebookEditorMouseEvent, INotebookEditorContribution, getNotebookEditorFromEditorPane, CellFoldingState } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { FoldingModel } from 'vs/workbench/contrib/notebook/browser/viewModel/foldingModel'; import { CellKind } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { ICellRange } from 'vs/workbench/contrib/notebook/common/notebookRange';\nimport { registerNotebookContribution } from 'vs/workbench/contrib/notebook/browser/notebookEditorExtensions';\nimport { registerAction2, Action2 } from 'vs/platform/actions/common/actions';\nimport { ContextKeyExpr } from 'vs/platform/contextkey/common/contextkey';\nimport { InputFocusedContextKey } from 'vs/platform/contextkey/common/contextkeys';\nimport { KeyCode, KeyMod } from 'vs/base/common/keyCodes';\nimport { KeybindingWeight } from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { NOTEBOOK_ACTIONS_CATEGORY } from 'vs/workbench/contrib/notebook/browser/controller/coreActions';\nimport { localize } from 'vs/nls';\nimport { FoldingRegion } from 'vs/editor/contrib/folding/browser/foldingRanges';\nimport { ICommandHandlerDescription } from 'vs/platform/commands/common/commands';\nimport { NotebookViewModel } from 'vs/workbench/contrib/notebook/browser/viewModel/notebookViewModelImpl';\n\nexport class FoldingController extends Disposable implements INotebookEditorContribution {\n\tstatic id: string = 'workbench.notebook.foldingController';\n\n\tprivate _foldingModel: FoldingModel | null = null;\n\tprivate readonly _localStore = this._register(new DisposableStore());\n\n\tconstructor(private readonly _notebookEditor: INotebookEditor) {\n\t\tsuper();\n\n\t\tthis._register(this._notebookEditor.onMouseUp(e => { this.onMouseUp(e); }));\n\n\t\tthis._register(this._notebookEditor.onDidChangeModel(() => {\n\t\t\tthis._localStore.clear();\n\n\t\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._localStore.add(this._notebookEditor.onDidChangeCellState(e => {\n\t\t\t\tif (e.source.editStateChanged && e.cell.cellKind === CellKind.Markup) {\n\t\t\t\t\tthis._foldingModel?.recompute();\n\t\t\t\t\t// this._updateEditorFoldingRanges();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tthis._foldingModel = new FoldingModel();\n\t\t\tthis._localStore.add(this._foldingModel);\n\t\t\tthis._foldingModel.attachViewModel(this._notebookEditor.getViewModel());\n\n\t\t\tthis._localStore.add(this._foldingModel.onDidFoldingRegionChanged(() => {\n\t\t\t\tthis._updateEditorFoldingRanges();\n\t\t\t}));\n\t\t}));\n\t}\n\n\tsaveViewState(): ICellRange[] {\n\t\treturn this._foldingModel?.getMemento() || [];\n\t}\n\n\trestoreViewState(state: ICellRange[] | undefined) {\n\t\tthis._foldingModel?.applyMemento(state || []);\n\t\tthis._updateEditorFoldingRanges();\n\t}\n\n\tsetFoldingStateDown(index: number, state: CellFoldingState, levels: number) {\n\t\tconst doCollapse = state === CellFoldingState.Collapsed;\n\t\tconst region = this._foldingModel!.getRegionAtLine(index + 1);\n\t\tconst regions: FoldingRegion[] = [];\n\t\tif (region) {\n\t\t\tif (region.isCollapsed !== doCollapse) {\n\t\t\t\tregions.push(region);\n\t\t\t}\n\t\t\tif (levels > 1) {\n\t\t\t\tconst regionsInside = this._foldingModel!.getRegionsInside(region, (r, level: number) => r.isCollapsed !== doCollapse && level < levels);\n\t\t\t\tregions.push(...regionsInside);\n\t\t\t}\n\t\t}\n\n\t\tregions.forEach(r => this._foldingModel!.setCollapsed(r.regionIndex, state === CellFoldingState.Collapsed));\n\t\tthis._updateEditorFoldingRanges();\n\t}\n\n\tsetFoldingStateUp(index: number, state: CellFoldingState, levels: number) {\n\t\tif (!this._foldingModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst regions = this._foldingModel.getAllRegionsAtLine(index + 1, (region, level) => region.isCollapsed !== (state === CellFoldingState.Collapsed) && level <= levels);\n\t\tregions.forEach(r => this._foldingModel!.setCollapsed(r.regionIndex, state === CellFoldingState.Collapsed));\n\t\tthis._updateEditorFoldingRanges();\n\t}\n\n\tprivate _updateEditorFoldingRanges() {\n\t\tif (!this._foldingModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst vm = this._notebookEditor.getViewModel() as NotebookViewModel;\n\n\t\tvm.updateFoldingRanges(this._foldingModel.regions);\n\t\tconst hiddenRanges = vm.getHiddenRanges();\n\t\tthis._notebookEditor.setHiddenAreas(hiddenRanges);\n\t}\n\n\tonMouseUp(e: INotebookEditorMouseEvent) {\n\t\tif (!e.event.target) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst viewModel = this._notebookEditor.getViewModel() as NotebookViewModel;\n\t\tconst target = e.event.target as HTMLElement;\n\n\t\tif (target.classList.contains('codicon-notebook-collapsed') || target.classList.contains('codicon-notebook-expanded')) {\n\t\t\tconst parent = target.parentElement as HTMLElement;\n\n\t\t\tif (!parent.classList.contains('notebook-folding-indicator')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// folding icon\n\n\t\t\tconst cellViewModel = e.target;\n\t\t\tconst modelIndex = viewModel.getCellIndex(cellViewModel);\n\t\t\tconst state = viewModel.getFoldingState(modelIndex);\n\n\t\t\tif (state === CellFoldingState.None) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setFoldingStateUp(modelIndex, state === CellFoldingState.Collapsed ? CellFoldingState.Expanded : CellFoldingState.Collapsed, 1);\n\t\t\tthis._notebookEditor.focusElement(cellViewModel);\n\t\t}\n\n\t\treturn;\n\t}\n}\n\nregisterNotebookContribution(FoldingController.id, FoldingController);\n\n\nconst NOTEBOOK_FOLD_COMMAND_LABEL = localize('fold.cell', \"Fold Cell\");\nconst NOTEBOOK_UNFOLD_COMMAND_LABEL = localize('unfold.cell', \"Unfold Cell\");\n\nconst FOLDING_COMMAND_ARGS: Pick<ICommandHandlerDescription, 'args'> = {\n\targs: [{\n\t\tisOptional: true,\n\t\tname: 'index',\n\t\tdescription: 'The cell index',\n\t\tschema: {\n\t\t\t'type': 'object',\n\t\t\t'required': ['index', 'direction'],\n\t\t\t'properties': {\n\t\t\t\t'index': {\n\t\t\t\t\t'type': 'number'\n\t\t\t\t},\n\t\t\t\t'direction': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'enum': ['up', 'down'],\n\t\t\t\t\t'default': 'down'\n\t\t\t\t},\n\t\t\t\t'levels': {\n\t\t\t\t\t'type': 'number',\n\t\t\t\t\t'default': 1\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}]\n};\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.fold',\n\t\t\ttitle: { value: localize('fold.cell', \"Fold Cell\"), original: 'Fold Cell' },\n\t\t\tcategory: NOTEBOOK_ACTIONS_CATEGORY,\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.and(NOTEBOOK_EDITOR_FOCUSED, ContextKeyExpr.not(InputFocusedContextKey)),\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.BracketLeft,\n\t\t\t\tmac: {\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.BracketLeft,\n\t\t\t\t\tsecondary: [KeyCode.LeftArrow],\n\t\t\t\t},\n\t\t\t\tsecondary: [KeyCode.LeftArrow],\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib\n\t\t\t},\n\t\t\tdescription: {\n\t\t\t\tdescription: NOTEBOOK_FOLD_COMMAND_LABEL,\n\t\t\t\targs: FOLDING_COMMAND_ARGS.args\n\t\t\t},\n\t\t\tprecondition: NOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, args?: { index: number; levels: number; direction: 'up' | 'down' }): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst levels = args && args.levels || 1;\n\t\tconst direction = args && args.direction === 'up' ? 'up' : 'down';\n\t\tlet index: number | undefined = undefined;\n\n\t\tif (args) {\n\t\t\tindex = args.index;\n\t\t} else {\n\t\t\tconst activeCell = editor.getActiveCell();\n\t\t\tif (!activeCell) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tindex = editor.getCellIndex(activeCell);\n\t\t}\n\n\t\tconst controller = editor.getContribution<FoldingController>(FoldingController.id);\n\t\tif (index !== undefined) {\n\t\t\tconst targetCell = (index < 0 || index >= editor.getLength()) ? undefined : editor.cellAt(index);\n\t\t\tif (targetCell?.cellKind === CellKind.Code && direction === 'down') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (direction === 'up') {\n\t\t\t\tcontroller.setFoldingStateUp(index, CellFoldingState.Collapsed, levels);\n\t\t\t} else {\n\t\t\t\tcontroller.setFoldingStateDown(index, CellFoldingState.Collapsed, levels);\n\t\t\t}\n\n\t\t\tconst viewIndex = editor.getViewModel().getNearestVisibleCellIndexUpwards(index);\n\t\t\teditor.focusElement(editor.cellAt(viewIndex));\n\t\t}\n\t}\n});\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.unfold',\n\t\t\ttitle: { value: NOTEBOOK_UNFOLD_COMMAND_LABEL, original: 'Unfold Cell' },\n\t\t\tcategory: NOTEBOOK_ACTIONS_CATEGORY,\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.and(NOTEBOOK_EDITOR_FOCUSED, ContextKeyExpr.not(InputFocusedContextKey)),\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.BracketRight,\n\t\t\t\tmac: {\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.BracketRight,\n\t\t\t\t\tsecondary: [KeyCode.RightArrow],\n\t\t\t\t},\n\t\t\t\tsecondary: [KeyCode.RightArrow],\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib\n\t\t\t},\n\t\t\tdescription: {\n\t\t\t\tdescription: NOTEBOOK_UNFOLD_COMMAND_LABEL,\n\t\t\t\targs: FOLDING_COMMAND_ARGS.args\n\t\t\t},\n\t\t\tprecondition: NOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, args?: { index: number; levels: number; direction: 'up' | 'down' }): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst levels = args && args.levels || 1;\n\t\tconst direction = args && args.direction === 'up' ? 'up' : 'down';\n\t\tlet index: number | undefined = undefined;\n\n\t\tif (args) {\n\t\t\tindex = args.index;\n\t\t} else {\n\t\t\tconst activeCell = editor.getActiveCell();\n\t\t\tif (!activeCell) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tindex = editor.getCellIndex(activeCell);\n\t\t}\n\n\t\tconst controller = editor.getContribution<FoldingController>(FoldingController.id);\n\t\tif (index !== undefined) {\n\t\t\tif (direction === 'up') {\n\t\t\t\tcontroller.setFoldingStateUp(index, CellFoldingState.Expanded, levels);\n\t\t\t} else {\n\t\t\t\tcontroller.setFoldingStateDown(index, CellFoldingState.Expanded, levels);\n\t\t\t}\n\t\t}\n\t}\n});\n"]}