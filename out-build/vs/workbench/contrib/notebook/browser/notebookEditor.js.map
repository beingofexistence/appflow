{"version":3,"sources":["vs/workbench/contrib/notebook/browser/notebookEditor.ts"],"names":[],"mappings":"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","file":"notebookEditor.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from 'vs/base/browser/dom';\nimport { IActionViewItem } from 'vs/base/browser/ui/actionbar/actionbar';\nimport { IAction, toAction } from 'vs/base/common/actions';\nimport { timeout } from 'vs/base/common/async';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { DisposableStore, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { extname, isEqual } from 'vs/base/common/resources';\nimport { URI } from 'vs/base/common/uri';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { ITextResourceConfigurationService } from 'vs/editor/common/services/textResourceConfiguration';\nimport { localize } from 'vs/nls';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IEditorOptions } from 'vs/platform/editor/common/editor';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IStorageService } from 'vs/platform/storage/common/storage';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { EditorPane } from 'vs/workbench/browser/parts/editor/editorPane';\nimport { DEFAULT_EDITOR_ASSOCIATION, EditorPaneSelectionChangeReason, EditorPaneSelectionCompareResult, EditorResourceAccessor, IEditorMemento, IEditorOpenContext, IEditorPaneSelection, IEditorPaneSelectionChangeEvent, createEditorOpenError, isEditorOpenError } from 'vs/workbench/common/editor';\nimport { EditorInput } from 'vs/workbench/common/editor/editorInput';\nimport { SELECT_KERNEL_ID } from 'vs/workbench/contrib/notebook/browser/controller/coreActions';\nimport { INotebookEditorOptions, INotebookEditorPane, INotebookEditorViewState } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { IBorrowValue, INotebookEditorService } from 'vs/workbench/contrib/notebook/browser/services/notebookEditorService';\nimport { NotebookEditorWidget } from 'vs/workbench/contrib/notebook/browser/notebookEditorWidget';\nimport { NotebooKernelActionViewItem } from 'vs/workbench/contrib/notebook/browser/viewParts/notebookKernelView';\nimport { NotebookTextModel } from 'vs/workbench/contrib/notebook/common/model/notebookTextModel';\nimport { NOTEBOOK_EDITOR_ID, NotebookWorkingCopyTypeIdentifier } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { NotebookEditorInput } from 'vs/workbench/contrib/notebook/common/notebookEditorInput';\nimport { NotebookPerfMarks } from 'vs/workbench/contrib/notebook/common/notebookPerformance';\nimport { IEditorDropService } from 'vs/workbench/services/editor/browser/editorDropService';\nimport { GroupsOrder, IEditorGroup, IEditorGroupsService } from 'vs/workbench/services/editor/common/editorGroupsService';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { IEditorProgressService } from 'vs/platform/progress/common/progress';\nimport { InstallRecommendedExtensionAction } from 'vs/workbench/contrib/extensions/browser/extensionsActions';\nimport { INotebookService } from 'vs/workbench/contrib/notebook/common/notebookService';\nimport { IExtensionsWorkbenchService } from 'vs/workbench/contrib/extensions/common/extensions';\nimport { EnablementState } from 'vs/workbench/services/extensionManagement/common/extensionManagement';\nimport { IWorkingCopyBackupService } from 'vs/workbench/services/workingCopy/common/workingCopyBackup';\nimport { streamToBuffer } from 'vs/base/common/buffer';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { INotebookEditorWorkerService } from 'vs/workbench/contrib/notebook/common/services/notebookWorkerService';\n\nconst NOTEBOOK_EDITOR_VIEW_STATE_PREFERENCE_KEY = 'NotebookEditorViewState';\n\nexport class NotebookEditor extends EditorPane implements INotebookEditorPane {\n\tstatic readonly ID: string = NOTEBOOK_EDITOR_ID;\n\n\tprivate readonly _editorMemento: IEditorMemento<INotebookEditorViewState>;\n\tprivate readonly _groupListener = this._register(new DisposableStore());\n\tprivate readonly _widgetDisposableStore: DisposableStore = this._register(new DisposableStore());\n\tprivate _widget: IBorrowValue<NotebookEditorWidget> = { value: undefined };\n\tprivate _rootElement!: HTMLElement;\n\tprivate _pagePosition?: { readonly dimension: DOM.Dimension; readonly position: DOM.IDomPosition };\n\n\tprivate readonly _inputListener = this._register(new MutableDisposable());\n\n\t// override onDidFocus and onDidBlur to be based on the NotebookEditorWidget element\n\tprivate readonly _onDidFocusWidget = this._register(new Emitter<void>());\n\toverride get onDidFocus(): Event<void> { return this._onDidFocusWidget.event; }\n\tprivate readonly _onDidBlurWidget = this._register(new Emitter<void>());\n\toverride get onDidBlur(): Event<void> { return this._onDidBlurWidget.event; }\n\n\tprivate readonly _onDidChangeModel = this._register(new Emitter<void>());\n\treadonly onDidChangeModel: Event<void> = this._onDidChangeModel.event;\n\n\tprivate readonly _onDidChangeSelection = this._register(new Emitter<IEditorPaneSelectionChangeEvent>());\n\treadonly onDidChangeSelection = this._onDidChangeSelection.event;\n\n\tconstructor(\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IEditorGroupsService private readonly _editorGroupService: IEditorGroupsService,\n\t\t@IEditorDropService private readonly _editorDropService: IEditorDropService,\n\t\t@INotebookEditorService private readonly _notebookWidgetService: INotebookEditorService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@ITextResourceConfigurationService configurationService: ITextResourceConfigurationService,\n\t\t@IEditorProgressService private readonly _editorProgressService: IEditorProgressService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@IExtensionsWorkbenchService private readonly _extensionsWorkbenchService: IExtensionsWorkbenchService,\n\t\t@IWorkingCopyBackupService private readonly _workingCopyBackupService: IWorkingCopyBackupService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@INotebookEditorWorkerService private readonly _notebookEditorWorkerService: INotebookEditorWorkerService,\n\t) {\n\t\tsuper(NotebookEditor.ID, telemetryService, themeService, storageService);\n\t\tthis._editorMemento = this.getEditorMemento<INotebookEditorViewState>(_editorGroupService, configurationService, NOTEBOOK_EDITOR_VIEW_STATE_PREFERENCE_KEY);\n\n\t\tthis._register(this._fileService.onDidChangeFileSystemProviderCapabilities(e => this._onDidChangeFileSystemProvider(e.scheme)));\n\t\tthis._register(this._fileService.onDidChangeFileSystemProviderRegistrations(e => this._onDidChangeFileSystemProvider(e.scheme)));\n\t}\n\n\tprivate _onDidChangeFileSystemProvider(scheme: string): void {\n\t\tif (this.input instanceof NotebookEditorInput && this.input.resource?.scheme === scheme) {\n\t\t\tthis._updateReadonly(this.input);\n\t\t}\n\t}\n\n\tprivate _onDidChangeInputCapabilities(input: NotebookEditorInput): void {\n\t\tif (this.input === input) {\n\t\t\tthis._updateReadonly(input);\n\t\t}\n\t}\n\n\tprivate _updateReadonly(input: NotebookEditorInput): void {\n\t\tthis._widget.value?.setOptions({ isReadOnly: !!input.isReadonly() });\n\t}\n\n\tget textModel(): NotebookTextModel | undefined {\n\t\treturn this._widget.value?.textModel;\n\t}\n\n\toverride get minimumWidth(): number { return 220; }\n\toverride get maximumWidth(): number { return Number.POSITIVE_INFINITY; }\n\n\t// these setters need to exist because this extends from EditorPane\n\toverride set minimumWidth(value: number) { /*noop*/ }\n\toverride set maximumWidth(value: number) { /*noop*/ }\n\n\t//#region Editor Core\n\toverride get scopedContextKeyService(): IContextKeyService | undefined {\n\t\treturn this._widget.value?.scopedContextKeyService;\n\t}\n\n\tprotected createEditor(parent: HTMLElement): void {\n\t\tthis._rootElement = DOM.append(parent, DOM.$('.notebook-editor'));\n\t\tthis._rootElement.id = `notebook-editor-element-${generateUuid()}`;\n\t}\n\n\toverride getActionViewItem(action: IAction): IActionViewItem | undefined {\n\t\tif (action.id === SELECT_KERNEL_ID) {\n\t\t\t// this is being disposed by the consumer\n\t\t\treturn this._instantiationService.createInstance(NotebooKernelActionViewItem, action, this);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\toverride getControl(): NotebookEditorWidget | undefined {\n\t\treturn this._widget.value;\n\t}\n\n\tprotected override setEditorVisible(visible: boolean, group: IEditorGroup | undefined): void {\n\t\tsuper.setEditorVisible(visible, group);\n\t\tif (group) {\n\t\t\tthis._groupListener.clear();\n\t\t\tthis._groupListener.add(group.onWillCloseEditor(e => this._saveEditorViewState(e.editor)));\n\t\t\tthis._groupListener.add(group.onDidModelChange(() => {\n\t\t\t\tif (this._editorGroupService.activeGroup !== group) {\n\t\t\t\t\tthis._widget?.value?.updateEditorFocus();\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tif (!visible) {\n\t\t\tthis._saveEditorViewState(this.input);\n\t\t\tif (this.input && this._widget.value) {\n\t\t\t\t// the widget is not transfered to other editor inputs\n\t\t\t\tthis._widget.value.onWillHide();\n\t\t\t}\n\t\t}\n\t}\n\n\toverride focus() {\n\t\tsuper.focus();\n\t\tthis._widget.value?.focus();\n\t}\n\n\toverride hasFocus(): boolean {\n\t\tconst activeElement = document.activeElement;\n\t\tconst value = this._widget.value;\n\n\t\treturn !!value && (DOM.isAncestor(activeElement, value.getDomNode() || DOM.isAncestor(activeElement, value.getOverflowContainerDomNode())));\n\t}\n\n\toverride async setInput(input: NotebookEditorInput, options: INotebookEditorOptions | undefined, context: IEditorOpenContext, token: CancellationToken, noRetry?: boolean): Promise<void> {\n\t\ttry {\n\t\t\tlet perfMarksCaptured = false;\n\t\t\tconst fileOpenMonitor = timeout(10000);\n\t\t\tfileOpenMonitor.then(() => {\n\t\t\t\tperfMarksCaptured = true;\n\t\t\t\tthis._handlePerfMark(perf, input);\n\t\t\t});\n\n\t\t\tconst perf = new NotebookPerfMarks();\n\t\t\tperf.mark('startTime');\n\t\t\tconst group = this.group!;\n\n\t\t\tthis._inputListener.value = input.onDidChangeCapabilities(() => this._onDidChangeInputCapabilities(input));\n\n\t\t\tthis._widgetDisposableStore.clear();\n\n\t\t\t// there currently is a widget which we still own so\n\t\t\t// we need to hide it before getting a new widget\n\t\t\tthis._widget.value?.onWillHide();\n\n\t\t\tthis._widget = <IBorrowValue<NotebookEditorWidget>>this._instantiationService.invokeFunction(this._notebookWidgetService.retrieveWidget, group, input, undefined, this._pagePosition?.dimension);\n\n\t\t\tif (this._rootElement && this._widget.value!.getDomNode()) {\n\t\t\t\tthis._rootElement.setAttribute('aria-flowto', this._widget.value!.getDomNode().id || '');\n\t\t\t\tDOM.setParentFlowTo(this._widget.value!.getDomNode(), this._rootElement);\n\t\t\t}\n\n\t\t\tthis._widgetDisposableStore.add(this._widget.value!.onDidChangeModel(() => this._onDidChangeModel.fire()));\n\t\t\tthis._widgetDisposableStore.add(this._widget.value!.onDidChangeActiveCell(() => this._onDidChangeSelection.fire({ reason: EditorPaneSelectionChangeReason.USER })));\n\n\t\t\tif (this._pagePosition) {\n\t\t\t\tthis._widget.value!.layout(this._pagePosition.dimension, this._rootElement, this._pagePosition.position);\n\t\t\t}\n\n\t\t\t// only now `setInput` and yield/await. this is AFTER the actual widget is ready. This is very important\n\t\t\t// so that others synchronously receive a notebook editor with the correct widget being set\n\t\t\tawait super.setInput(input, options, context, token);\n\t\t\tconst model = await input.resolve(options, perf);\n\t\t\tperf.mark('inputLoaded');\n\n\t\t\t// Check for cancellation\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\t// The widget has been taken away again. This can happen when the tab has been closed while\n\t\t\t// loading was in progress, in particular when open the same resource as different view type.\n\t\t\t// When this happen, retry once\n\t\t\tif (!this._widget.value) {\n\t\t\t\tif (noRetry) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn this.setInput(input, options, context, token, true);\n\t\t\t}\n\n\t\t\tif (model === null) {\n\t\t\t\tconst knownProvider = this._notebookService.getViewTypeProvider(input.viewType);\n\n\t\t\t\tif (!knownProvider) {\n\t\t\t\t\tthrow new Error(localize('fail.noEditor', \"Cannot open resource with notebook editor type '{0}', please check if you have the right extension installed and enabled.\", input.viewType));\n\t\t\t\t}\n\n\t\t\t\tawait this._extensionsWorkbenchService.whenInitialized;\n\t\t\t\tconst extensionInfo = this._extensionsWorkbenchService.local.find(e => e.identifier.id === knownProvider);\n\n\t\t\t\tthrow createEditorOpenError(new Error(localize('fail.noEditor.extensionMissing', \"Cannot open resource with notebook editor type '{0}', please check if you have the right extension installed and enabled.\", input.viewType)), [\n\t\t\t\t\ttoAction({\n\t\t\t\t\t\tid: 'workbench.notebook.action.installOrEnableMissing', label:\n\t\t\t\t\t\t\textensionInfo\n\t\t\t\t\t\t\t\t? localize('notebookOpenEnableMissingViewType', \"Enable extension for '{0}'\", input.viewType)\n\t\t\t\t\t\t\t\t: localize('notebookOpenInstallMissingViewType', \"Install extension for '{0}'\", input.viewType)\n\t\t\t\t\t\t, run: async () => {\n\t\t\t\t\t\t\tconst d = this._notebookService.onAddViewType(viewType => {\n\t\t\t\t\t\t\t\tif (viewType === input.viewType) {\n\t\t\t\t\t\t\t\t\t// serializer is registered, try to open again\n\t\t\t\t\t\t\t\t\tthis._editorService.openEditor({ resource: input.resource });\n\t\t\t\t\t\t\t\t\td.dispose();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tconst extensionInfo = this._extensionsWorkbenchService.local.find(e => e.identifier.id === knownProvider);\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif (extensionInfo) {\n\t\t\t\t\t\t\t\t\tawait this._extensionsWorkbenchService.setEnablement(extensionInfo, extensionInfo.enablementState === EnablementState.DisabledWorkspace ? EnablementState.EnabledWorkspace : EnablementState.EnabledGlobally);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tawait this._instantiationService.createInstance(InstallRecommendedExtensionAction, knownProvider).run();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\t\tthis.logService.error(`Failed to install or enable extension ${knownProvider}`, ex);\n\t\t\t\t\t\t\t\td.dispose();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\ttoAction({\n\t\t\t\t\t\tid: 'workbench.notebook.action.openAsText', label: localize('notebookOpenAsText', \"Open As Text\"), run: async () => {\n\t\t\t\t\t\t\tconst backup = await this._workingCopyBackupService.resolve({ resource: input.resource, typeId: NotebookWorkingCopyTypeIdentifier.create(input.viewType) });\n\t\t\t\t\t\t\tif (backup) {\n\t\t\t\t\t\t\t\t// with a backup present, we must resort to opening the backup contents\n\t\t\t\t\t\t\t\t// as untitled text file to not show the wrong data to the user\n\t\t\t\t\t\t\t\tconst contents = await streamToBuffer(backup.value);\n\t\t\t\t\t\t\t\tthis._editorService.openEditor({ resource: undefined, contents: contents.toString() });\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// without a backup present, we can open the original resource\n\t\t\t\t\t\t\t\tthis._editorService.openEditor({ resource: input.resource, options: { override: DEFAULT_EDITOR_ASSOCIATION.id, pinned: true } });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t], { allowDialog: true });\n\n\t\t\t}\n\n\t\t\tthis._widgetDisposableStore.add(model.notebook.onDidChangeContent(() => this._onDidChangeSelection.fire({ reason: EditorPaneSelectionChangeReason.EDIT })));\n\n\t\t\tconst viewState = options?.viewState ?? this._loadNotebookEditorViewState(input);\n\n\t\t\t// We might be moving the notebook widget between groups, and these services are tied to the group\n\t\t\tthis._widget.value!.setParentContextKeyService(this._contextKeyService);\n\t\t\tthis._widget.value!.setEditorProgressService(this._editorProgressService);\n\n\t\t\tawait this._widget.value!.setModel(model.notebook, viewState, perf);\n\t\t\tconst isReadOnly = !!input.isReadonly();\n\t\t\tawait this._widget.value!.setOptions({ ...options, isReadOnly });\n\t\t\tthis._widgetDisposableStore.add(this._widget.value!.onDidFocusWidget(() => this._onDidFocusWidget.fire()));\n\t\t\tthis._widgetDisposableStore.add(this._widget.value!.onDidBlurWidget(() => this._onDidBlurWidget.fire()));\n\n\t\t\tthis._widgetDisposableStore.add(this._editorDropService.createEditorDropTarget(this._widget.value!.getDomNode(), {\n\t\t\t\tcontainsGroup: (group) => this.group?.id === group.id\n\t\t\t}));\n\n\t\t\tperf.mark('editorLoaded');\n\n\t\t\tfileOpenMonitor.cancel();\n\t\t\tif (perfMarksCaptured) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._handlePerfMark(perf, input);\n\t\t\tthis._handlePromptRecommendations(model.notebook);\n\t\t} catch (e) {\n\t\t\tthis.logService.warn('NotebookEditorWidget#setInput failed', e);\n\t\t\tif (isEditorOpenError(e)) {\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\tconst error = createEditorOpenError(e instanceof Error ? e : new Error((e ? e.message : '')), [\n\t\t\t\ttoAction({\n\t\t\t\t\tid: 'workbench.notebook.action.openInTextEditor', label: localize('notebookOpenInTextEditor', \"Open in Text Editor\"), run: async () => {\n\t\t\t\t\t\tconst activeEditorPane = this._editorService.activeEditorPane;\n\t\t\t\t\t\tif (!activeEditorPane) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst activeEditorResource = EditorResourceAccessor.getCanonicalUri(activeEditorPane.input);\n\t\t\t\t\t\tif (!activeEditorResource) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (activeEditorResource.toString() === input.resource?.toString()) {\n\t\t\t\t\t\t\t// Replace the current editor with the text editor\n\t\t\t\t\t\t\treturn this._editorService.openEditor({\n\t\t\t\t\t\t\t\tresource: activeEditorResource,\n\t\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t\toverride: DEFAULT_EDITOR_ASSOCIATION.id,\n\t\t\t\t\t\t\t\t\tpinned: true // new file gets pinned by default\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t], { allowDialog: true });\n\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tprivate _handlePerfMark(perf: NotebookPerfMarks, input: NotebookEditorInput) {\n\t\tconst perfMarks = perf.value;\n\n\t\ttype WorkbenchNotebookOpenClassification = {\n\t\t\towner: 'rebornix';\n\t\t\tcomment: 'The notebook file open metrics. Used to get a better understanding of the performance of notebook file opening';\n\t\t\tscheme: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'File system provider scheme for the notebook resource' };\n\t\t\text: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'File extension for the notebook resource' };\n\t\t\tviewType: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The view type of the notebook editor' };\n\t\t\textensionActivated: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Extension activation time for the resource opening' };\n\t\t\tinputLoaded: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Editor Input loading time for the resource opening' };\n\t\t\twebviewCommLoaded: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Webview initialization time for the resource opening' };\n\t\t\tcustomMarkdownLoaded: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Custom markdown loading time for the resource opening' };\n\t\t\teditorLoaded: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Overall editor loading time for the resource opening' };\n\t\t};\n\n\t\ttype WorkbenchNotebookOpenEvent = {\n\t\t\tscheme: string;\n\t\t\text: string;\n\t\t\tviewType: string;\n\t\t\textensionActivated: number;\n\t\t\tinputLoaded: number;\n\t\t\twebviewCommLoaded: number;\n\t\t\tcustomMarkdownLoaded: number | undefined;\n\t\t\teditorLoaded: number;\n\t\t};\n\n\t\tconst startTime = perfMarks['startTime'];\n\t\tconst extensionActivated = perfMarks['extensionActivated'];\n\t\tconst inputLoaded = perfMarks['inputLoaded'];\n\t\tconst customMarkdownLoaded = perfMarks['customMarkdownLoaded'];\n\t\tconst editorLoaded = perfMarks['editorLoaded'];\n\n\t\tlet extensionActivationTimespan = -1;\n\t\tlet inputLoadingTimespan = -1;\n\t\tlet webviewCommLoadingTimespan = -1;\n\t\tlet customMarkdownLoadingTimespan = -1;\n\t\tlet editorLoadingTimespan = -1;\n\n\t\tif (startTime !== undefined && extensionActivated !== undefined) {\n\t\t\textensionActivationTimespan = extensionActivated - startTime;\n\n\t\t\tif (inputLoaded !== undefined) {\n\t\t\t\tinputLoadingTimespan = inputLoaded - extensionActivated;\n\t\t\t\twebviewCommLoadingTimespan = inputLoaded - extensionActivated; // TODO@rebornix, we don't track webview comm anymore\n\t\t\t}\n\n\t\t\tif (customMarkdownLoaded !== undefined) {\n\t\t\t\tcustomMarkdownLoadingTimespan = customMarkdownLoaded - startTime;\n\t\t\t}\n\n\t\t\tif (editorLoaded !== undefined) {\n\t\t\t\teditorLoadingTimespan = editorLoaded - startTime;\n\t\t\t}\n\t\t}\n\n\t\tthis.telemetryService.publicLog2<WorkbenchNotebookOpenEvent, WorkbenchNotebookOpenClassification>('notebook/editorOpenPerf', {\n\t\t\tscheme: input.resource.scheme,\n\t\t\text: extname(input.resource),\n\t\t\tviewType: input.viewType,\n\t\t\textensionActivated: extensionActivationTimespan,\n\t\t\tinputLoaded: inputLoadingTimespan,\n\t\t\twebviewCommLoaded: webviewCommLoadingTimespan,\n\t\t\tcustomMarkdownLoaded: customMarkdownLoadingTimespan,\n\t\t\teditorLoaded: editorLoadingTimespan\n\t\t});\n\t}\n\n\tprivate _handlePromptRecommendations(model: NotebookTextModel) {\n\t\tthis._notebookEditorWorkerService.canPromptRecommendation(model.uri).then(shouldPrompt => {\n\t\t\ttype WorkbenchNotebookShouldPromptRecommendationClassification = {\n\t\t\t\towner: 'rebornix';\n\t\t\t\tcomment: 'The notebook file metrics. Used to get a better understanding of if we should prompt for notebook extension recommendations';\n\t\t\t\tshouldPrompt: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Should we prompt for notebook extension recommendations' };\n\t\t\t};\n\n\t\t\ttype WorkbenchNotebookShouldPromptRecommendationEvent = {\n\t\t\t\tshouldPrompt: boolean;\n\t\t\t};\n\n\t\t\tthis.telemetryService.publicLog2<WorkbenchNotebookShouldPromptRecommendationEvent, WorkbenchNotebookShouldPromptRecommendationClassification>('notebook/shouldPromptRecommendation', {\n\t\t\t\tshouldPrompt: shouldPrompt\n\t\t\t});\n\t\t});\n\t}\n\n\toverride clearInput(): void {\n\t\tthis._inputListener.clear();\n\n\t\tif (this._widget.value) {\n\t\t\tthis._saveEditorViewState(this.input);\n\t\t\tthis._widget.value.onWillHide();\n\t\t}\n\t\tsuper.clearInput();\n\t}\n\n\toverride setOptions(options: INotebookEditorOptions | undefined): void {\n\t\tthis._widget.value?.setOptions(options);\n\t\tsuper.setOptions(options);\n\t}\n\n\tprotected override saveState(): void {\n\t\tthis._saveEditorViewState(this.input);\n\t\tsuper.saveState();\n\t}\n\n\toverride getViewState(): INotebookEditorViewState | undefined {\n\t\tconst input = this.input;\n\t\tif (!(input instanceof NotebookEditorInput)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tthis._saveEditorViewState(input);\n\t\treturn this._loadNotebookEditorViewState(input);\n\t}\n\n\tgetSelection(): IEditorPaneSelection | undefined {\n\t\tif (this._widget.value) {\n\t\t\tconst activeCell = this._widget.value.getActiveCell();\n\t\t\tif (activeCell) {\n\t\t\t\tconst cellUri = activeCell.uri;\n\t\t\t\treturn new NotebookEditorSelection(cellUri, activeCell.getSelections());\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\n\tprivate _saveEditorViewState(input: EditorInput | undefined): void {\n\t\tif (this.group && this._widget.value && input instanceof NotebookEditorInput) {\n\t\t\tif (this._widget.value.isDisposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst state = this._widget.value.getEditorViewState();\n\t\t\tthis._editorMemento.saveEditorState(this.group, input.resource, state);\n\t\t}\n\t}\n\n\tprivate _loadNotebookEditorViewState(input: NotebookEditorInput): INotebookEditorViewState | undefined {\n\t\tlet result: INotebookEditorViewState | undefined;\n\t\tif (this.group) {\n\t\t\tresult = this._editorMemento.loadEditorState(this.group, input.resource);\n\t\t}\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\t// when we don't have a view state for the group/input-tuple then we try to use an existing\n\t\t// editor for the same resource.\n\t\tfor (const group of this._editorGroupService.getGroups(GroupsOrder.MOST_RECENTLY_ACTIVE)) {\n\t\t\tif (group.activeEditorPane !== this && group.activeEditorPane instanceof NotebookEditor && group.activeEditor?.matches(input)) {\n\t\t\t\treturn group.activeEditorPane._widget.value?.getEditorViewState();\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\tlayout(dimension: DOM.Dimension, position: DOM.IDomPosition): void {\n\t\tthis._rootElement.classList.toggle('mid-width', dimension.width < 1000 && dimension.width >= 600);\n\t\tthis._rootElement.classList.toggle('narrow-width', dimension.width < 600);\n\t\tthis._pagePosition = { dimension, position };\n\n\t\tif (!this._widget.value || !(this._input instanceof NotebookEditorInput)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._input.resource.toString() !== this.textModel?.uri.toString() && this._widget.value?.hasModel()) {\n\t\t\t// input and widget mismatch\n\t\t\t// this happens when\n\t\t\t// 1. open document A, pin the document\n\t\t\t// 2. open document B\n\t\t\t// 3. close document B\n\t\t\t// 4. a layout is triggered\n\t\t\treturn;\n\t\t}\n\n\t\tthis._widget.value.layout(dimension, this._rootElement, position);\n\t}\n\n\t//#endregion\n}\n\nclass NotebookEditorSelection implements IEditorPaneSelection {\n\n\tconstructor(\n\t\tprivate readonly cellUri: URI,\n\t\tprivate readonly selections: Selection[]\n\t) { }\n\n\tcompare(other: IEditorPaneSelection): EditorPaneSelectionCompareResult {\n\t\tif (!(other instanceof NotebookEditorSelection)) {\n\t\t\treturn EditorPaneSelectionCompareResult.DIFFERENT;\n\t\t}\n\n\t\tif (isEqual(this.cellUri, other.cellUri)) {\n\t\t\treturn EditorPaneSelectionCompareResult.IDENTICAL;\n\t\t}\n\n\t\treturn EditorPaneSelectionCompareResult.DIFFERENT;\n\t}\n\n\trestore(options: IEditorOptions): INotebookEditorOptions {\n\t\tconst notebookOptions: INotebookEditorOptions = {\n\t\t\tcellOptions: {\n\t\t\t\tresource: this.cellUri,\n\t\t\t\toptions: {\n\t\t\t\t\tselection: this.selections[0]\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tObject.assign(notebookOptions, options);\n\n\t\treturn notebookOptions;\n\t}\n\n\tlog(): string {\n\t\treturn this.cellUri.fragment;\n\t}\n}\n"]}