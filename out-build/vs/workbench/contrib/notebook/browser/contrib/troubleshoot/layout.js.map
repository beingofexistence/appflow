{"version":3,"sources":["vs/workbench/contrib/notebook/browser/contrib/troubleshoot/layout.ts"],"names":[],"mappings":"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","file":"layout.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableStore, dispose, IDisposable } from 'vs/base/common/lifecycle';\nimport { localize } from 'vs/nls';\nimport { Action2, registerAction2 } from 'vs/platform/actions/common/actions';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { Categories } from 'vs/platform/action/common/actionCommonCategories';\nimport { getNotebookEditorFromEditorPane, ICellViewModel, ICommonCellViewModelLayoutChangeInfo, INotebookDeltaCellStatusBarItems, INotebookEditor, INotebookEditorContribution } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { registerNotebookContribution } from 'vs/workbench/contrib/notebook/browser/notebookEditorExtensions';\nimport { NotebookEditorWidget } from 'vs/workbench/contrib/notebook/browser/notebookEditorWidget';\nimport { CellStatusbarAlignment, INotebookCellStatusBarItem } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { INotebookService } from 'vs/workbench/contrib/notebook/common/notebookService';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\n\nexport class TroubleshootController extends Disposable implements INotebookEditorContribution {\n\tstatic id: string = 'workbench.notebook.troubleshoot';\n\n\tprivate readonly _localStore = this._register(new DisposableStore());\n\tprivate _cellStateListeners: IDisposable[] = [];\n\tprivate _enabled: boolean = false;\n\tprivate _cellStatusItems: string[] = [];\n\n\tconstructor(private readonly _notebookEditor: INotebookEditor) {\n\t\tsuper();\n\n\t\tthis._register(this._notebookEditor.onDidChangeModel(() => {\n\t\t\tthis._update();\n\t\t}));\n\n\t\tthis._update();\n\t}\n\n\ttoggle(): void {\n\t\tthis._enabled = !this._enabled;\n\t\tthis._update();\n\t}\n\n\tprivate _update() {\n\t\tthis._localStore.clear();\n\t\tthis._cellStateListeners.forEach(listener => listener.dispose());\n\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._updateListener();\n\t}\n\n\tprivate _log(cell: ICellViewModel, e: any) {\n\t\tif (this._enabled) {\n\t\t\tconst oldHeight = (this._notebookEditor as NotebookEditorWidget).getViewHeight(cell);\n\t\t\tconsole.log(`cell#${cell.handle}`, e, `${oldHeight} -> ${cell.layoutInfo.totalHeight}`);\n\t\t}\n\t}\n\n\tprivate _updateListener() {\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < this._notebookEditor.getLength(); i++) {\n\t\t\tconst cell = this._notebookEditor.cellAt(i);\n\n\t\t\tthis._cellStateListeners.push(cell.onDidChangeLayout(e => {\n\t\t\t\tthis._log(cell, e);\n\t\t\t}));\n\t\t}\n\n\t\tthis._localStore.add(this._notebookEditor.onDidChangeViewCells(e => {\n\t\t\t[...e.splices].reverse().forEach(splice => {\n\t\t\t\tconst [start, deleted, newCells] = splice;\n\t\t\t\tconst deletedCells = this._cellStateListeners.splice(start, deleted, ...newCells.map(cell => {\n\t\t\t\t\treturn cell.onDidChangeLayout((e: ICommonCellViewModelLayoutChangeInfo) => {\n\t\t\t\t\t\tthis._log(cell, e);\n\t\t\t\t\t});\n\t\t\t\t}));\n\n\t\t\t\tdispose(deletedCells);\n\t\t\t});\n\t\t}));\n\n\t\tconst vm = this._notebookEditor.getViewModel();\n\t\tlet items: INotebookDeltaCellStatusBarItems[] = [];\n\n\t\tif (this._enabled) {\n\t\t\titems = this._getItemsForCells();\n\t\t}\n\n\t\tthis._cellStatusItems = vm.deltaCellStatusBarItems(this._cellStatusItems, items);\n\t}\n\n\tprivate _getItemsForCells(): INotebookDeltaCellStatusBarItems[] {\n\t\tconst items: INotebookDeltaCellStatusBarItems[] = [];\n\t\tfor (let i = 0; i < this._notebookEditor.getLength(); i++) {\n\t\t\titems.push({\n\t\t\t\thandle: i,\n\t\t\t\titems: [\n\t\t\t\t\t<INotebookCellStatusBarItem>{\n\t\t\t\t\t\ttext: `index: ${i}`,\n\t\t\t\t\t\talignment: CellStatusbarAlignment.Left,\n\t\t\t\t\t\tpriority: Number.MAX_SAFE_INTEGER\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\n\t\treturn items;\n\t}\n\n\toverride dispose() {\n\t\tdispose(this._cellStateListeners);\n\t\tsuper.dispose();\n\t}\n}\n\nregisterNotebookContribution(TroubleshootController.id, TroubleshootController);\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.toggleLayoutTroubleshoot',\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('workbench.notebook.toggleLayoutTroubleshoot', \"Toggle Layout Troubleshoot\"),\n\t\t\t\toriginal: 'Toggle Notebook Layout Troubleshoot'\n\t\t\t},\n\t\t\tcategory: Categories.Developer,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst controller = editor.getContribution<TroubleshootController>(TroubleshootController.id);\n\t\tcontroller?.toggle();\n\t}\n});\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.inspectLayout',\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('workbench.notebook.inspectLayout', \"Inspect Notebook Layout\"),\n\t\t\t\toriginal: 'Inspect Notebook Layout'\n\t\t\t},\n\t\t\tcategory: Categories.Developer,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\n\t\tif (!editor || !editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < editor.getLength(); i++) {\n\t\t\tconst cell = editor.cellAt(i);\n\t\t\tconsole.log(`cell#${cell.handle}`, cell.layoutInfo);\n\t\t}\n\t}\n});\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.clearNotebookEdtitorTypeCache',\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('workbench.notebook.clearNotebookEdtitorTypeCache', \"Clear Notebook Editor Type Cache\"),\n\t\t\t\toriginal: 'Clear Notebook Editor Cache'\n\t\t\t},\n\t\t\tcategory: Categories.Developer,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst notebookService = accessor.get(INotebookService);\n\t\tnotebookService.clearEditorCache();\n\t}\n});\n"]}