{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/notebook/browser/contrib/find/findModel.ts"],"names":[],"mappings":"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","file":"findModel.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancelablePromise, createCancelablePromise, Delayer } from 'vs/base/common/async';\nimport { INotebookEditor, CellEditState, CellFindMatchWithIndex, CellWebviewFindMatch, ICellViewModel } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { Range } from 'vs/editor/common/core/range';\nimport { FindMatch } from 'vs/editor/common/model';\nimport { PrefixSumComputer } from 'vs/editor/common/model/prefixSumComputer';\nimport { FindReplaceState, FindReplaceStateChangedEvent } from 'vs/editor/contrib/find/browser/findState';\nimport { CellKind, INotebookSearchOptions, NotebookCellsChangeType } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { Disposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { findFirstIdxMonotonousOrArrLen } from 'vs/base/common/arraysFind';\nimport { NotebookTextModel } from 'vs/workbench/contrib/notebook/common/model/notebookTextModel';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { NotebookFindFilters } from 'vs/workbench/contrib/notebook/browser/contrib/find/findFilters';\nimport { FindMatchDecorationModel } from 'vs/workbench/contrib/notebook/browser/contrib/find/findMatchDecorationModel';\nimport { NotebookViewModel } from 'vs/workbench/contrib/notebook/browser/viewModel/notebookViewModelImpl';\n\nexport class CellFindMatchModel implements CellFindMatchWithIndex {\n\treadonly cell: ICellViewModel;\n\treadonly index: number;\n\tprivate _contentMatches: FindMatch[];\n\tprivate _webviewMatches: CellWebviewFindMatch[];\n\tget length() {\n\t\treturn this._contentMatches.length + this._webviewMatches.length;\n\t}\n\n\tget contentMatches(): FindMatch[] {\n\t\treturn this._contentMatches;\n\t}\n\n\tget webviewMatches(): CellWebviewFindMatch[] {\n\t\treturn this._webviewMatches;\n\t}\n\n\tconstructor(cell: ICellViewModel, index: number, contentMatches: FindMatch[], webviewMatches: CellWebviewFindMatch[]) {\n\t\tthis.cell = cell;\n\t\tthis.index = index;\n\t\tthis._contentMatches = contentMatches;\n\t\tthis._webviewMatches = webviewMatches;\n\t}\n\n\tgetMatch(index: number) {\n\t\tif (index >= this.length) {\n\t\t\tthrow new Error('NotebookCellFindMatch: index out of range');\n\t\t}\n\n\t\tif (index < this._contentMatches.length) {\n\t\t\treturn this._contentMatches[index];\n\t\t}\n\n\t\treturn this._webviewMatches[index - this._contentMatches.length];\n\t}\n}\n\nexport class FindModel extends Disposable {\n\tprivate _findMatches: CellFindMatchWithIndex[] = [];\n\tprotected _findMatchesStarts: PrefixSumComputer | null = null;\n\tprivate _currentMatch: number = -1;\n\n\tprivate readonly _throttledDelayer: Delayer<void>;\n\tprivate _computePromise: CancelablePromise<CellFindMatchWithIndex[] | null> | null = null;\n\tprivate readonly _modelDisposable = this._register(new DisposableStore());\n\tprivate _findMatchDecorationModel: FindMatchDecorationModel;\n\n\tget findMatches() {\n\t\treturn this._findMatches;\n\t}\n\n\tget currentMatch() {\n\t\treturn this._currentMatch;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditor,\n\t\tprivate readonly _state: FindReplaceState<NotebookFindFilters>,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\n\t\tthis._throttledDelayer = new Delayer(20);\n\t\tthis._computePromise = null;\n\n\t\tthis._register(_state.onFindReplaceStateChange(e => {\n\t\t\tthis._updateCellStates(e);\n\n\t\t\tif (e.searchString || e.isRegex || e.matchCase || e.searchScope || e.wholeWord || (e.isRevealed && this._state.isRevealed) || e.filters || e.isReplaceRevealed) {\n\t\t\t\tthis.research();\n\t\t\t}\n\n\t\t\tif (e.isRevealed && !this._state.isRevealed) {\n\t\t\t\tthis.clear();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._notebookEditor.onDidChangeModel(e => {\n\t\t\tthis._registerModelListener(e);\n\t\t}));\n\n\t\tthis._register(this._notebookEditor.onDidChangeCellState(e => {\n\t\t\tif (e.cell.cellKind === CellKind.Markup && e.source.editStateChanged) {\n\t\t\t\t// research when markdown cell is switching between markdown preview and editing mode.\n\t\t\t\tthis.research();\n\t\t\t}\n\t\t}));\n\n\t\tif (this._notebookEditor.hasModel()) {\n\t\t\tthis._registerModelListener(this._notebookEditor.textModel);\n\t\t}\n\n\t\tthis._findMatchDecorationModel = new FindMatchDecorationModel(this._notebookEditor, this._notebookEditor.getId());\n\t}\n\n\tprivate _updateCellStates(e: FindReplaceStateChangedEvent) {\n\t\tif (!this._state.filters?.markupInput) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._state.filters?.markupPreview) {\n\t\t\treturn;\n\t\t}\n\n\t\t// we only update cell state if users are using the hybrid mode (both input and preview are enabled)\n\t\tconst updateEditingState = () => {\n\t\t\tconst viewModel = this._notebookEditor.getViewModel() as NotebookViewModel | undefined;\n\t\t\tif (!viewModel) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// search markup sources first to decide if a markup cell should be in editing mode\n\t\t\tconst wordSeparators = this._configurationService.inspect<string>('editor.wordSeparators').value;\n\t\t\tconst options: INotebookSearchOptions = {\n\t\t\t\tregex: this._state.isRegex,\n\t\t\t\twholeWord: this._state.wholeWord,\n\t\t\t\tcaseSensitive: this._state.matchCase,\n\t\t\t\twordSeparators: wordSeparators,\n\t\t\t\tincludeMarkupInput: true,\n\t\t\t\tincludeCodeInput: false,\n\t\t\t\tincludeMarkupPreview: false,\n\t\t\t\tincludeOutput: false\n\t\t\t};\n\n\t\t\tconst contentMatches = viewModel.find(this._state.searchString, options);\n\t\t\tfor (let i = 0; i < viewModel.length; i++) {\n\t\t\t\tconst cell = viewModel.cellAt(i);\n\t\t\t\tif (cell && cell.cellKind === CellKind.Markup) {\n\t\t\t\t\tconst foundContentMatch = contentMatches.find(m => m.cell.handle === cell.handle && m.contentMatches.length > 0);\n\t\t\t\t\tconst targetState = foundContentMatch ? CellEditState.Editing : CellEditState.Preview;\n\t\t\t\t\tconst currentEditingState = cell.getEditState();\n\n\t\t\t\t\tif (currentEditingState === CellEditState.Editing && cell.editStateSource !== 'find') {\n\t\t\t\t\t\t// it's already in editing mode, we should not update\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (currentEditingState !== targetState) {\n\t\t\t\t\t\tcell.updateEditState(targetState, 'find');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\n\t\tif (e.isReplaceRevealed && !this._state.isReplaceRevealed) {\n\t\t\t// replace is hidden, we need to switch all markdown cells to preview mode\n\t\t\tconst viewModel = this._notebookEditor.getViewModel() as NotebookViewModel | undefined;\n\t\t\tif (!viewModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < viewModel.length; i++) {\n\t\t\t\tconst cell = viewModel.cellAt(i);\n\t\t\t\tif (cell && cell.cellKind === CellKind.Markup) {\n\t\t\t\t\tif (cell.getEditState() === CellEditState.Editing && cell.editStateSource === 'find') {\n\t\t\t\t\t\tcell.updateEditState(CellEditState.Preview, 'find');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.isReplaceRevealed) {\n\t\t\tupdateEditingState();\n\t\t} else if ((e.filters || e.isRevealed || e.searchString || e.replaceString) && this._state.isRevealed && this._state.isReplaceRevealed) {\n\t\t\tupdateEditingState();\n\t\t}\n\t}\n\n\tensureFindMatches() {\n\t\tif (!this._findMatchesStarts) {\n\t\t\tthis.set(this._findMatches, true);\n\t\t}\n\t}\n\n\tgetCurrentMatch() {\n\t\tconst nextIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\tconst cell = this._findMatches[nextIndex.index].cell;\n\t\tconst match = this._findMatches[nextIndex.index].getMatch(nextIndex.remainder);\n\n\t\treturn {\n\t\t\tcell,\n\t\t\tmatch,\n\t\t\tisModelMatch: nextIndex.remainder < this._findMatches[nextIndex.index].contentMatches.length\n\t\t};\n\t}\n\n\trefreshCurrentMatch(focus: { cell: ICellViewModel; range: Range }) {\n\t\tconst findMatchIndex = this.findMatches.findIndex(match => match.cell === focus.cell);\n\n\t\tif (findMatchIndex === -1) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst findMatch = this.findMatches[findMatchIndex];\n\t\tconst index = findMatch.contentMatches.findIndex(match => match.range.intersectRanges(focus.range) !== null);\n\n\t\tif (index === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst matchesBefore = findMatchIndex === 0 ? 0 : (this._findMatchesStarts?.getPrefixSum(findMatchIndex - 1) ?? 0);\n\t\tthis._currentMatch = matchesBefore + index;\n\n\t\tthis.highlightCurrentFindMatchDecoration(findMatchIndex, index).then(offset => {\n\t\t\tthis.revealCellRange(findMatchIndex, index, offset);\n\n\t\t\tthis._state.changeMatchInfo(\n\t\t\t\tthis._currentMatch,\n\t\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\t\tundefined\n\t\t\t);\n\t\t});\n\t}\n\n\tfind(option: { previous: boolean } | { index: number }) {\n\t\tif (!this.findMatches.length) {\n\t\t\treturn;\n\t\t}\n\n\t\t// let currCell;\n\t\tif (!this._findMatchesStarts) {\n\t\t\tthis.set(this._findMatches, true);\n\t\t\tif ('index' in option) {\n\t\t\t\tthis._currentMatch = option.index;\n\t\t\t}\n\t\t} else {\n\t\t\t// const currIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\t\t// currCell = this._findMatches[currIndex.index].cell;\n\t\t\tconst totalVal = this._findMatchesStarts.getTotalSum();\n\t\t\tif ('index' in option) {\n\t\t\t\tthis._currentMatch = option.index;\n\t\t\t}\n\t\t\telse if (this._currentMatch === -1) {\n\t\t\t\tthis._currentMatch = option.previous ? totalVal - 1 : 0;\n\t\t\t} else {\n\t\t\t\tconst nextVal = (this._currentMatch + (option.previous ? -1 : 1) + totalVal) % totalVal;\n\t\t\t\tthis._currentMatch = nextVal;\n\t\t\t}\n\t\t}\n\n\t\tconst nextIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\t// const newFocusedCell = this._findMatches[nextIndex.index].cell;\n\t\tthis.highlightCurrentFindMatchDecoration(nextIndex.index, nextIndex.remainder).then(offset => {\n\t\t\tthis.revealCellRange(nextIndex.index, nextIndex.remainder, offset);\n\n\t\t\tthis._state.changeMatchInfo(\n\t\t\t\tthis._currentMatch,\n\t\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\t\tundefined\n\t\t\t);\n\t\t});\n\t}\n\n\tprivate revealCellRange(cellIndex: number, matchIndex: number, outputOffset: number | null) {\n\t\tconst findMatch = this._findMatches[cellIndex];\n\t\tif (matchIndex >= findMatch.contentMatches.length) {\n\t\t\t// reveal output range\n\t\t\tthis._notebookEditor.focusElement(findMatch.cell);\n\t\t\tconst index = this._notebookEditor.getCellIndex(findMatch.cell);\n\t\t\tif (index !== undefined) {\n\t\t\t\t// const range: ICellRange = { start: index, end: index + 1 };\n\t\t\t\tthis._notebookEditor.revealCellOffsetInCenterAsync(findMatch.cell, outputOffset ?? 0);\n\t\t\t}\n\t\t} else {\n\t\t\tconst match = findMatch.getMatch(matchIndex) as FindMatch;\n\t\t\tif (findMatch.cell.getEditState() !== CellEditState.Editing) {\n\t\t\t\tfindMatch.cell.updateEditState(CellEditState.Editing, 'find');\n\t\t\t}\n\t\t\tfindMatch.cell.isInputCollapsed = false;\n\t\t\tthis._notebookEditor.focusElement(findMatch.cell);\n\t\t\tthis._notebookEditor.setCellEditorSelection(findMatch.cell, match.range);\n\t\t\tthis._notebookEditor.revealRangeInCenterIfOutsideViewportAsync(findMatch.cell, match.range);\n\t\t}\n\t}\n\n\tprivate _registerModelListener(notebookTextModel?: NotebookTextModel) {\n\t\tthis._modelDisposable.clear();\n\n\t\tif (notebookTextModel) {\n\t\t\tthis._modelDisposable.add(notebookTextModel.onDidChangeContent((e) => {\n\t\t\t\tif (!e.rawEvents.some(event => event.kind === NotebookCellsChangeType.ChangeCellContent || event.kind === NotebookCellsChangeType.ModelChange)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.research();\n\t\t\t}));\n\t\t}\n\n\t\tthis.research();\n\t}\n\n\tasync research() {\n\t\treturn this._throttledDelayer.trigger(async () => {\n\t\t\tthis._state.change({ isSearching: true }, false);\n\t\t\tawait this._research();\n\t\t\tthis._state.change({ isSearching: false }, false);\n\t\t});\n\t}\n\n\tasync _research() {\n\t\tthis._computePromise?.cancel();\n\n\t\tif (!this._state.isRevealed || !this._notebookEditor.hasModel()) {\n\t\t\tthis.set([], false);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._computePromise = createCancelablePromise(token => this._compute(token));\n\n\t\tconst findMatches = await this._computePromise;\n\t\tif (!findMatches) {\n\t\t\tthis.set([], false);\n\t\t\treturn;\n\t\t}\n\n\t\tif (findMatches.length === 0) {\n\t\t\tthis.set([], false);\n\t\t\treturn;\n\t\t}\n\n\t\tconst findFirstMatchAfterCellIndex = (cellIndex: number) => {\n\t\t\tconst matchAfterSelection = findFirstIdxMonotonousOrArrLen(findMatches.map(match => match.index), index => index >= cellIndex);\n\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection));\n\t\t};\n\n\t\tif (this._currentMatch === -1) {\n\t\t\t// no active current match\n\t\t\tif (this._notebookEditor.getLength() === 0) {\n\t\t\t\tthis.set(findMatches, false);\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tconst focus = this._notebookEditor.getFocus().start;\n\t\t\t\tfindFirstMatchAfterCellIndex(focus);\n\t\t\t\tthis.set(findMatches, false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst oldCurrIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\tconst oldCurrCell = this._findMatches[oldCurrIndex.index].cell;\n\t\tconst oldCurrMatchCellIndex = this._notebookEditor.getCellIndex(oldCurrCell);\n\n\n\t\tif (oldCurrMatchCellIndex < 0) {\n\t\t\t// the cell containing the active match is deleted\n\t\t\tif (this._notebookEditor.getLength() === 0) {\n\t\t\t\tthis.set(findMatches, false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfindFirstMatchAfterCellIndex(oldCurrMatchCellIndex);\n\t\t\treturn;\n\t\t}\n\n\t\t// the cell still exist\n\t\tconst cell = this._notebookEditor.cellAt(oldCurrMatchCellIndex);\n\t\t// we will try restore the active find match in this cell, if it contains any find match\n\n\t\tif (cell.cellKind === CellKind.Markup && cell.getEditState() === CellEditState.Preview) {\n\t\t\t// find first match in this cell or below\n\t\t\tfindFirstMatchAfterCellIndex(oldCurrMatchCellIndex);\n\t\t\treturn;\n\t\t}\n\n\t\t// the cell is a markup cell in editing mode or a code cell, both should have monaco editor rendered\n\n\t\tif (!this._findMatchDecorationModel.currentMatchDecorations) {\n\t\t\t// no current highlight decoration\n\t\t\tfindFirstMatchAfterCellIndex(oldCurrMatchCellIndex);\n\t\t\treturn;\n\t\t}\n\n\t\t// check if there is monaco editor selection and find the first match, otherwise find the first match above current cell\n\t\t// this._findMatches[cellIndex].matches[matchIndex].range\n\t\tif (this._findMatchDecorationModel.currentMatchDecorations.kind === 'input') {\n\t\t\tconst currentMatchDecorationId = this._findMatchDecorationModel.currentMatchDecorations.decorations.find(decoration => decoration.ownerId === cell.handle);\n\n\t\t\tif (!currentMatchDecorationId) {\n\t\t\t\t// current match decoration is no longer valid\n\t\t\t\tfindFirstMatchAfterCellIndex(oldCurrMatchCellIndex);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst matchAfterSelection = findFirstIdxMonotonousOrArrLen(findMatches, match => match.index >= oldCurrMatchCellIndex) % findMatches.length;\n\t\t\tif (findMatches[matchAfterSelection].index > oldCurrMatchCellIndex) {\n\t\t\t\t// there is no search result in curr cell anymore, find the nearest one (from top to bottom)\n\t\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection));\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\t// there are still some search results in current cell\n\t\t\t\tlet currMatchRangeInEditor = cell.editorAttached && currentMatchDecorationId.decorations[0] ? cell.getCellDecorationRange(currentMatchDecorationId.decorations[0]) : null;\n\n\t\t\t\tif (currMatchRangeInEditor === null && oldCurrIndex.remainder < this._findMatches[oldCurrIndex.index].contentMatches.length) {\n\t\t\t\t\tcurrMatchRangeInEditor = (this._findMatches[oldCurrIndex.index].getMatch(oldCurrIndex.remainder) as FindMatch).range;\n\t\t\t\t}\n\n\t\t\t\tif (currMatchRangeInEditor !== null) {\n\t\t\t\t\t// we find a range for the previous current match, let's find the nearest one after it (can overlap)\n\t\t\t\t\tconst cellMatch = findMatches[matchAfterSelection];\n\t\t\t\t\tconst matchAfterOldSelection = findFirstIdxMonotonousOrArrLen(cellMatch.contentMatches, match => Range.compareRangesUsingStarts((match as FindMatch).range, currMatchRangeInEditor) >= 0);\n\t\t\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection) + matchAfterOldSelection);\n\t\t\t\t} else {\n\t\t\t\t\t// no range found, let's fall back to finding the nearest match\n\t\t\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// output now has the highlight\n\t\t\tconst matchAfterSelection = findFirstIdxMonotonousOrArrLen(findMatches.map(match => match.index), index => index >= oldCurrMatchCellIndex) % findMatches.length;\n\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection));\n\t\t}\n\t}\n\n\tprivate set(cellFindMatches: CellFindMatchWithIndex[] | null, autoStart: boolean): void {\n\t\tif (!cellFindMatches || !cellFindMatches.length) {\n\t\t\tthis._findMatches = [];\n\t\t\tthis._findMatchDecorationModel.setAllFindMatchesDecorations([]);\n\n\t\t\tthis.constructFindMatchesStarts();\n\t\t\tthis._currentMatch = -1;\n\t\t\tthis._findMatchDecorationModel.clearCurrentFindMatchDecoration();\n\n\t\t\tthis._state.changeMatchInfo(\n\t\t\t\tthis._currentMatch,\n\t\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\t\tundefined\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t// all matches\n\t\tthis._findMatches = cellFindMatches;\n\t\tthis._findMatchDecorationModel.setAllFindMatchesDecorations(cellFindMatches || []);\n\n\t\t// current match\n\t\tthis.constructFindMatchesStarts();\n\n\t\tif (autoStart) {\n\t\t\tthis._currentMatch = 0;\n\t\t\tthis.highlightCurrentFindMatchDecoration(0, 0);\n\t\t}\n\n\t\tthis._state.changeMatchInfo(\n\t\t\tthis._currentMatch,\n\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\tundefined\n\t\t);\n\t}\n\n\tprivate async _compute(token: CancellationToken): Promise<CellFindMatchWithIndex[] | null> {\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn null;\n\t\t}\n\t\tlet ret: CellFindMatchWithIndex[] | null = null;\n\t\tconst val = this._state.searchString;\n\t\tconst wordSeparators = this._configurationService.inspect<string>('editor.wordSeparators').value;\n\n\t\tconst options: INotebookSearchOptions = {\n\t\t\tregex: this._state.isRegex,\n\t\t\twholeWord: this._state.wholeWord,\n\t\t\tcaseSensitive: this._state.matchCase,\n\t\t\twordSeparators: wordSeparators,\n\t\t\tincludeMarkupInput: this._state.filters?.markupInput ?? true,\n\t\t\tincludeCodeInput: this._state.filters?.codeInput ?? true,\n\t\t\tincludeMarkupPreview: !!this._state.filters?.markupPreview,\n\t\t\tincludeOutput: !!this._state.filters?.codeOutput\n\t\t};\n\n\t\tret = await this._notebookEditor.find(val, options, token);\n\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\tprivate _updateCurrentMatch(findMatches: CellFindMatchWithIndex[], currentMatchesPosition: number) {\n\t\tthis.set(findMatches, false);\n\t\tthis._currentMatch = currentMatchesPosition % findMatches.length;\n\t\tconst nextIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\tthis.highlightCurrentFindMatchDecoration(nextIndex.index, nextIndex.remainder);\n\n\t\tthis._state.changeMatchInfo(\n\t\t\tthis._currentMatch,\n\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\tundefined\n\t\t);\n\t}\n\n\tprivate _matchesCountBeforeIndex(findMatches: CellFindMatchWithIndex[], index: number) {\n\t\tlet prevMatchesCount = 0;\n\t\tfor (let i = 0; i < index; i++) {\n\t\t\tprevMatchesCount += findMatches[i].length;\n\t\t}\n\n\t\treturn prevMatchesCount;\n\t}\n\n\tprivate constructFindMatchesStarts() {\n\t\tif (this._findMatches && this._findMatches.length) {\n\t\t\tconst values = new Uint32Array(this._findMatches.length);\n\t\t\tfor (let i = 0; i < this._findMatches.length; i++) {\n\t\t\t\tvalues[i] = this._findMatches[i].length;\n\t\t\t}\n\n\t\t\tthis._findMatchesStarts = new PrefixSumComputer(values);\n\t\t} else {\n\t\t\tthis._findMatchesStarts = null;\n\t\t}\n\t}\n\n\n\tprivate async highlightCurrentFindMatchDecoration(cellIndex: number, matchIndex: number): Promise<number | null> {\n\t\tconst cell = this._findMatches[cellIndex].cell;\n\t\tconst match = this._findMatches[cellIndex].getMatch(matchIndex);\n\n\t\tif (matchIndex < this._findMatches[cellIndex].contentMatches.length) {\n\t\t\treturn this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInCell(cell, (match as FindMatch).range);\n\t\t} else {\n\t\t\treturn this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInWebview(cell, (match as CellWebviewFindMatch).index);\n\t\t}\n\t}\n\n\tclear() {\n\t\tthis._computePromise?.cancel();\n\t\tthis._throttledDelayer.cancel();\n\t\tthis.set([], false);\n\t}\n\n\toverride dispose() {\n\t\tthis._findMatchDecorationModel.dispose();\n\t\tsuper.dispose();\n\t}\n}\n"]}