{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/notebook/browser/contrib/find/findMatchDecorationModel.ts"],"names":[],"mappings":"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","file":"findMatchDecorationModel.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { IModelDeltaDecoration } from 'vs/editor/common/model';\nimport { ModelDecorationOptions } from 'vs/editor/common/model/textModel';\nimport { FindDecorations } from 'vs/editor/contrib/find/browser/findDecorations';\nimport { Range } from 'vs/editor/common/core/range';\nimport { overviewRulerSelectionHighlightForeground, overviewRulerFindMatchForeground } from 'vs/platform/theme/common/colorRegistry';\nimport { CellFindMatchWithIndex, ICellModelDecorations, ICellModelDeltaDecorations, ICellViewModel, INotebookDeltaDecoration, INotebookEditor, NotebookOverviewRulerLane, } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\n\nexport class FindMatchDecorationModel extends Disposable {\n\tprivate _allMatchesDecorations: ICellModelDecorations[] = [];\n\tprivate _currentMatchCellDecorations: string[] = [];\n\tprivate _allMatchesCellDecorations: string[] = [];\n\tprivate _currentMatchDecorations: { kind: 'input'; decorations: ICellModelDecorations[] } | { kind: 'output'; index: number } | null = null;\n\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditor,\n\t\tprivate readonly ownerID: string,\n\t) {\n\t\tsuper();\n\t}\n\n\tpublic get currentMatchDecorations() {\n\t\treturn this._currentMatchDecorations;\n\t}\n\n\tprivate clearDecorations() {\n\t\tthis.clearCurrentFindMatchDecoration();\n\t\tthis.setAllFindMatchesDecorations([]);\n\t}\n\n\n\tpublic async highlightCurrentFindMatchDecorationInCell(cell: ICellViewModel, cellRange: Range): Promise<number | null> {\n\n\t\tthis.clearCurrentFindMatchDecoration();\n\n\t\t// match is an editor FindMatch, we update find match decoration in the editor\n\t\t// we will highlight the match in the webview\n\t\tthis._notebookEditor.changeModelDecorations(accessor => {\n\t\t\tconst findMatchesOptions: ModelDecorationOptions = FindDecorations._CURRENT_FIND_MATCH_DECORATION;\n\n\t\t\tconst decorations: IModelDeltaDecoration[] = [\n\t\t\t\t{ range: cellRange, options: findMatchesOptions }\n\t\t\t];\n\t\t\tconst deltaDecoration: ICellModelDeltaDecorations = {\n\t\t\t\townerId: cell.handle,\n\t\t\t\tdecorations: decorations\n\t\t\t};\n\n\t\t\tthis._currentMatchDecorations = {\n\t\t\t\tkind: 'input',\n\t\t\t\tdecorations: accessor.deltaDecorations(this._currentMatchDecorations?.kind === 'input' ? this._currentMatchDecorations.decorations : [], [deltaDecoration])\n\t\t\t};\n\t\t});\n\n\t\tthis._currentMatchCellDecorations = this._notebookEditor.deltaCellDecorations(this._currentMatchCellDecorations, [{\n\t\t\townerId: cell.handle,\n\t\t\thandle: cell.handle,\n\t\t\toptions: {\n\t\t\t\toverviewRuler: {\n\t\t\t\t\tcolor: overviewRulerSelectionHighlightForeground,\n\t\t\t\t\tmodelRanges: [cellRange],\n\t\t\t\t\tincludeOutput: false,\n\t\t\t\t\tposition: NotebookOverviewRulerLane.Center\n\t\t\t\t}\n\t\t\t}\n\t\t} as INotebookDeltaDecoration]);\n\n\t\treturn null;\n\t}\n\n\tpublic async highlightCurrentFindMatchDecorationInWebview(cell: ICellViewModel, index: number): Promise<number | null> {\n\n\t\tthis.clearCurrentFindMatchDecoration();\n\n\t\tconst offset = await this._notebookEditor.findHighlightCurrent(index, this.ownerID);\n\t\tthis._currentMatchDecorations = { kind: 'output', index: index };\n\n\t\tthis._currentMatchCellDecorations = this._notebookEditor.deltaCellDecorations(this._currentMatchCellDecorations, [{\n\t\t\townerId: cell.handle,\n\t\t\thandle: cell.handle,\n\t\t\toptions: {\n\t\t\t\toverviewRuler: {\n\t\t\t\t\tcolor: overviewRulerSelectionHighlightForeground,\n\t\t\t\t\tmodelRanges: [],\n\t\t\t\t\tincludeOutput: true,\n\t\t\t\t\tposition: NotebookOverviewRulerLane.Center\n\t\t\t\t}\n\t\t\t}\n\t\t} as INotebookDeltaDecoration]);\n\n\t\treturn offset;\n\t}\n\n\tpublic clearCurrentFindMatchDecoration() {\n\t\tif (this._currentMatchDecorations?.kind === 'input') {\n\t\t\tthis._notebookEditor.changeModelDecorations(accessor => {\n\t\t\t\taccessor.deltaDecorations(this._currentMatchDecorations?.kind === 'input' ? this._currentMatchDecorations.decorations : [], []);\n\t\t\t\tthis._currentMatchDecorations = null;\n\t\t\t});\n\t\t} else if (this._currentMatchDecorations?.kind === 'output') {\n\t\t\tthis._notebookEditor.findUnHighlightCurrent(this._currentMatchDecorations.index, this.ownerID);\n\t\t}\n\n\t\tthis._currentMatchCellDecorations = this._notebookEditor.deltaCellDecorations(this._currentMatchCellDecorations, []);\n\t}\n\n\tpublic setAllFindMatchesDecorations(cellFindMatches: CellFindMatchWithIndex[]) {\n\t\tthis._notebookEditor.changeModelDecorations((accessor) => {\n\n\t\t\tconst findMatchesOptions: ModelDecorationOptions = FindDecorations._FIND_MATCH_DECORATION;\n\n\t\t\tconst deltaDecorations: ICellModelDeltaDecorations[] = cellFindMatches.map(cellFindMatch => {\n\t\t\t\t// Find matches\n\t\t\t\tconst newFindMatchesDecorations: IModelDeltaDecoration[] = new Array<IModelDeltaDecoration>(cellFindMatch.contentMatches.length);\n\t\t\t\tfor (let i = 0; i < cellFindMatch.contentMatches.length; i++) {\n\t\t\t\t\tnewFindMatchesDecorations[i] = {\n\t\t\t\t\t\trange: cellFindMatch.contentMatches[i].range,\n\t\t\t\t\t\toptions: findMatchesOptions\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn { ownerId: cellFindMatch.cell.handle, decorations: newFindMatchesDecorations };\n\t\t\t});\n\n\t\t\tthis._allMatchesDecorations = accessor.deltaDecorations(this._allMatchesDecorations, deltaDecorations);\n\t\t});\n\n\t\tthis._allMatchesCellDecorations = this._notebookEditor.deltaCellDecorations(this._allMatchesCellDecorations, cellFindMatches.map(cellFindMatch => {\n\t\t\treturn {\n\t\t\t\townerId: cellFindMatch.cell.handle,\n\t\t\t\thandle: cellFindMatch.cell.handle,\n\t\t\t\toptions: {\n\t\t\t\t\toverviewRuler: {\n\t\t\t\t\t\tcolor: overviewRulerFindMatchForeground,\n\t\t\t\t\t\tmodelRanges: cellFindMatch.contentMatches.map(match => match.range),\n\t\t\t\t\t\tincludeOutput: cellFindMatch.webviewMatches.length > 0,\n\t\t\t\t\t\tposition: NotebookOverviewRulerLane.Center\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}));\n\t}\n\n\tstopWebviewFind() {\n\t\tthis._notebookEditor.findStop(this.ownerID);\n\t}\n\n\toverride dispose() {\n\t\tthis.clearDecorations();\n\t\tsuper.dispose();\n\t}\n\n}\n"]}