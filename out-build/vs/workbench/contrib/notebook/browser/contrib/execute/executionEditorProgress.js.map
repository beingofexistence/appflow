{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/notebook/browser/contrib/execute/executionEditorProgress.ts"],"names":[],"mappings":"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","file":"executionEditorProgress.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { throttle } from 'vs/base/common/decorators';\nimport { Disposable, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { INotebookEditor, INotebookEditorContribution } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { registerNotebookContribution } from 'vs/workbench/contrib/notebook/browser/notebookEditorExtensions';\nimport { NotebookCellExecutionState } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { INotebookCellExecution, INotebookExecutionStateService } from 'vs/workbench/contrib/notebook/common/notebookExecutionStateService';\nimport { IUserActivityService } from 'vs/workbench/services/userActivity/common/userActivityService';\n\nexport class ExecutionEditorProgressController extends Disposable implements INotebookEditorContribution {\n\tstatic id: string = 'workbench.notebook.executionEditorProgress';\n\n\tprivate readonly _activityMutex = this._register(new MutableDisposable());\n\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditor,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService,\n\t\t@IUserActivityService private readonly _userActivity: IUserActivityService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(_notebookEditor.onDidScroll(() => this._update()));\n\n\t\tthis._register(_notebookExecutionStateService.onDidChangeExecution(e => {\n\t\t\tif (e.notebook.toString() !== this._notebookEditor.textModel?.uri.toString()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._update();\n\t\t}));\n\n\t\tthis._register(_notebookEditor.onDidChangeModel(() => this._update()));\n\t}\n\n\t@throttle(100)\n\tprivate _update() {\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cellExecutions = this._notebookExecutionStateService.getCellExecutionsForNotebook(this._notebookEditor.textModel?.uri)\n\t\t\t.filter(exe => exe.state === NotebookCellExecutionState.Executing);\n\t\tconst notebookExecution = this._notebookExecutionStateService.getExecution(this._notebookEditor.textModel?.uri);\n\t\tconst executionIsVisible = (exe: INotebookCellExecution) => {\n\t\t\tfor (const range of this._notebookEditor.visibleRanges) {\n\t\t\t\tfor (const cell of this._notebookEditor.getCellsInRange(range)) {\n\t\t\t\t\tif (cell.handle === exe.cellHandle) {\n\t\t\t\t\t\tconst top = this._notebookEditor.getAbsoluteTopOfElement(cell);\n\t\t\t\t\t\tif (this._notebookEditor.scrollTop < top + 5) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\tconst hasAnyExecution = cellExecutions.length || notebookExecution;\n\t\tif (hasAnyExecution && !this._activityMutex.value) {\n\t\t\tthis._activityMutex.value = this._userActivity.markActive();\n\t\t} else if (!hasAnyExecution && this._activityMutex.value) {\n\t\t\tthis._activityMutex.clear();\n\t\t}\n\n\t\tconst shouldShowEditorProgressbarForCellExecutions = cellExecutions.length && !cellExecutions.some(executionIsVisible) && !cellExecutions.some(e => e.isPaused);\n\t\tconst showEditorProgressBar = !!notebookExecution || shouldShowEditorProgressbarForCellExecutions;\n\t\tif (showEditorProgressBar) {\n\t\t\tthis._notebookEditor.showProgress();\n\t\t} else {\n\t\t\tthis._notebookEditor.hideProgress();\n\t\t}\n\t}\n}\n\n\nregisterNotebookContribution(ExecutionEditorProgressController.id, ExecutionEditorProgressController);\n"]}