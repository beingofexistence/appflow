{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/notebook/browser/contrib/marker/markerProvider.ts"],"names":[],"mappings":"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","file":"markerProvider.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from 'vs/base/common/uri';\nimport { LifecyclePhase } from 'vs/workbench/services/lifecycle/common/lifecycle';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { Extensions as WorkbenchExtensions, IWorkbenchContributionsRegistry } from 'vs/workbench/common/contributions';\nimport { IMarkerListProvider, MarkerList, IMarkerNavigationService } from 'vs/editor/contrib/gotoError/browser/markerNavigationService';\nimport { CellUri } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { IMarkerService, MarkerSeverity } from 'vs/platform/markers/common/markers';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\nimport { INotebookDeltaDecoration, INotebookEditor, INotebookEditorContribution, NotebookOverviewRulerLane } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { registerNotebookContribution } from 'vs/workbench/contrib/notebook/browser/notebookEditorExtensions';\nimport { throttle } from 'vs/base/common/decorators';\nimport { editorErrorForeground, editorWarningForeground } from 'vs/platform/theme/common/colorRegistry';\nimport { isEqual } from 'vs/base/common/resources';\n\nclass MarkerListProvider implements IMarkerListProvider {\n\n\tprivate readonly _dispoables: IDisposable;\n\n\tconstructor(\n\t\t@IMarkerService private readonly _markerService: IMarkerService,\n\t\t@IMarkerNavigationService markerNavigation: IMarkerNavigationService,\n\t\t@IConfigurationService private readonly _configService: IConfigurationService\n\t) {\n\t\tthis._dispoables = markerNavigation.registerProvider(this);\n\t}\n\n\tdispose() {\n\t\tthis._dispoables.dispose();\n\t}\n\n\tgetMarkerList(resource: URI | undefined): MarkerList | undefined {\n\t\tif (!resource) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst data = CellUri.parse(resource);\n\t\tif (!data) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn new MarkerList(uri => {\n\t\t\tconst otherData = CellUri.parse(uri);\n\t\t\treturn otherData?.notebook.toString() === data.notebook.toString();\n\t\t}, this._markerService, this._configService);\n\t}\n}\n\nclass NotebookMarkerDecorationContribution extends Disposable implements INotebookEditorContribution {\n\tstatic id: string = 'workbench.notebook.markerDecoration';\n\tprivate _markersOverviewRulerDecorations: string[] = [];\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditor,\n\t\t@IMarkerService private readonly _markerService: IMarkerService\n\t) {\n\t\tsuper();\n\n\t\tthis._update();\n\t\tthis._register(this._notebookEditor.onDidChangeModel(() => this._update()));\n\t\tthis._register(this._markerService.onMarkerChanged(e => {\n\t\t\tif (e.some(uri => this._notebookEditor.getCellsInRange().some(cell => isEqual(cell.uri, uri)))) {\n\t\t\t\tthis._update();\n\t\t\t}\n\t\t}));\n\t}\n\n\t@throttle(100)\n\tprivate _update() {\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cellDecorations: INotebookDeltaDecoration[] = [];\n\t\tthis._notebookEditor.getCellsInRange().forEach(cell => {\n\t\t\tconst marker = this._markerService.read({ resource: cell.uri, severities: MarkerSeverity.Error | MarkerSeverity.Warning });\n\t\t\tmarker.forEach(m => {\n\t\t\t\tconst color = m.severity === MarkerSeverity.Error ? editorErrorForeground : editorWarningForeground;\n\t\t\t\tconst range = { startLineNumber: m.startLineNumber, startColumn: m.startColumn, endLineNumber: m.endLineNumber, endColumn: m.endColumn };\n\t\t\t\tcellDecorations.push({\n\t\t\t\t\thandle: cell.handle,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\toverviewRuler: {\n\t\t\t\t\t\t\tcolor: color,\n\t\t\t\t\t\t\tmodelRanges: [range],\n\t\t\t\t\t\t\tincludeOutput: false,\n\t\t\t\t\t\t\tposition: NotebookOverviewRulerLane.Right\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tthis._markersOverviewRulerDecorations = this._notebookEditor.deltaCellDecorations(this._markersOverviewRulerDecorations, cellDecorations);\n\t}\n}\n\nRegistry\n\t.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench)\n\t.registerWorkbenchContribution(MarkerListProvider, LifecyclePhase.Ready);\n\nregisterNotebookContribution(NotebookMarkerDecorationContribution.id, NotebookMarkerDecorationContribution);\n"]}