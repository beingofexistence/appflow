{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/notebook/browser/diff/diffNestedCellViewModel.ts"],"names":[],"mappings":"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","file":"diffNestedCellViewModel.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { PrefixSumComputer } from 'vs/editor/common/model/prefixSumComputer';\nimport { IDiffNestedCellViewModel } from 'vs/workbench/contrib/notebook/browser/diff/notebookDiffEditorBrowser';\nimport { ICellOutputViewModel, IGenericCellViewModel } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { CellViewModelStateChangeEvent } from 'vs/workbench/contrib/notebook/browser/notebookViewEvents';\nimport { CellOutputViewModel } from 'vs/workbench/contrib/notebook/browser/viewModel/cellOutputViewModel';\nimport { NotebookCellTextModel } from 'vs/workbench/contrib/notebook/common/model/notebookCellTextModel';\nimport { INotebookService } from 'vs/workbench/contrib/notebook/common/notebookService';\n\nexport class DiffNestedCellViewModel extends Disposable implements IDiffNestedCellViewModel, IGenericCellViewModel {\n\tprivate _id: string;\n\tget id() {\n\t\treturn this._id;\n\t}\n\n\tget outputs() {\n\t\treturn this.textModel.outputs;\n\t}\n\n\tget language() {\n\t\treturn this.textModel.language;\n\t}\n\n\tget metadata() {\n\t\treturn this.textModel.metadata;\n\t}\n\n\tget uri() {\n\t\treturn this.textModel.uri;\n\t}\n\n\tget handle() {\n\t\treturn this.textModel.handle;\n\t}\n\n\tprotected readonly _onDidChangeState: Emitter<CellViewModelStateChangeEvent> = this._register(new Emitter<CellViewModelStateChangeEvent>());\n\n\tprivate _hoveringOutput: boolean = false;\n\tpublic get outputIsHovered(): boolean {\n\t\treturn this._hoveringOutput;\n\t}\n\n\tpublic set outputIsHovered(v: boolean) {\n\t\tthis._hoveringOutput = v;\n\t\tthis._onDidChangeState.fire({ outputIsHoveredChanged: true });\n\t}\n\n\tprivate _focusOnOutput: boolean = false;\n\tpublic get outputIsFocused(): boolean {\n\t\treturn this._focusOnOutput;\n\t}\n\n\tpublic set outputIsFocused(v: boolean) {\n\t\tthis._focusOnOutput = v;\n\t\tthis._onDidChangeState.fire({ outputIsFocusedChanged: true });\n\t}\n\n\tprivate _outputViewModels: ICellOutputViewModel[];\n\n\tget outputsViewModels() {\n\t\treturn this._outputViewModels;\n\t}\n\n\tprotected _outputCollection: number[] = [];\n\tprotected _outputsTop: PrefixSumComputer | null = null;\n\n\tprotected readonly _onDidChangeOutputLayout = this._register(new Emitter<void>());\n\treadonly onDidChangeOutputLayout = this._onDidChangeOutputLayout.event;\n\n\tconstructor(\n\t\treadonly textModel: NotebookCellTextModel,\n\t\t@INotebookService private _notebookService: INotebookService\n\t) {\n\t\tsuper();\n\t\tthis._id = generateUuid();\n\n\t\tthis._outputViewModels = this.textModel.outputs.map(output => new CellOutputViewModel(this, output, this._notebookService));\n\t\tthis._register(this.textModel.onDidChangeOutputs((splice) => {\n\t\t\tthis._outputCollection.splice(splice.start, splice.deleteCount, ...splice.newOutputs.map(() => 0));\n\t\t\tconst removed = this._outputViewModels.splice(splice.start, splice.deleteCount, ...splice.newOutputs.map(output => new CellOutputViewModel(this, output, this._notebookService)));\n\t\t\tremoved.forEach(vm => vm.dispose());\n\n\t\t\tthis._outputsTop = null;\n\t\t\tthis._onDidChangeOutputLayout.fire();\n\t\t}));\n\t\tthis._outputCollection = new Array(this.textModel.outputs.length);\n\t}\n\n\tprivate _ensureOutputsTop() {\n\t\tif (!this._outputsTop) {\n\t\t\tconst values = new Uint32Array(this._outputCollection.length);\n\t\t\tfor (let i = 0; i < this._outputCollection.length; i++) {\n\t\t\t\tvalues[i] = this._outputCollection[i];\n\t\t\t}\n\n\t\t\tthis._outputsTop = new PrefixSumComputer(values);\n\t\t}\n\t}\n\n\tgetOutputOffset(index: number): number {\n\t\tthis._ensureOutputsTop();\n\n\t\tif (index >= this._outputCollection.length) {\n\t\t\tthrow new Error('Output index out of range!');\n\t\t}\n\n\t\treturn this._outputsTop!.getPrefixSum(index - 1);\n\t}\n\n\tupdateOutputHeight(index: number, height: number): void {\n\t\tif (index >= this._outputCollection.length) {\n\t\t\tthrow new Error('Output index out of range!');\n\t\t}\n\n\t\tthis._ensureOutputsTop();\n\t\tthis._outputCollection[index] = height;\n\t\tif (this._outputsTop!.setValue(index, height)) {\n\t\t\tthis._onDidChangeOutputLayout.fire();\n\t\t}\n\t}\n\n\tgetOutputTotalHeight() {\n\t\tthis._ensureOutputsTop();\n\n\t\treturn this._outputsTop?.getTotalSum() ?? 0;\n\t}\n\n\tpublic override dispose(): void {\n\t\tsuper.dispose();\n\n\t\tthis._outputViewModels.forEach(output => {\n\t\t\toutput.dispose();\n\t\t});\n\t}\n}\n"]}