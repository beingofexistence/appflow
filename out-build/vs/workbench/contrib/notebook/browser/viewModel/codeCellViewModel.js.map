{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts"],"names":[],"mappings":"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","file":"codeCellViewModel.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event, PauseableEmitter } from 'vs/base/common/event';\nimport { dispose } from 'vs/base/common/lifecycle';\nimport * as UUID from 'vs/base/common/uuid';\nimport { ICodeEditorService } from 'vs/editor/browser/services/codeEditorService';\nimport * as editorCommon from 'vs/editor/common/editorCommon';\nimport { ITextModelService } from 'vs/editor/common/services/resolverService';\nimport { PrefixSumComputer } from 'vs/editor/common/model/prefixSumComputer';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IUndoRedoService } from 'vs/platform/undoRedo/common/undoRedo';\nimport { CellEditState, CellFindMatch, CodeCellLayoutChangeEvent, CodeCellLayoutInfo, CellLayoutState, ICellOutputViewModel, ICellViewModel } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { CellOutputViewModel } from 'vs/workbench/contrib/notebook/browser/viewModel/cellOutputViewModel';\nimport { ViewContext } from 'vs/workbench/contrib/notebook/browser/viewModel/viewContext';\nimport { NotebookCellTextModel } from 'vs/workbench/contrib/notebook/common/model/notebookCellTextModel';\nimport { CellKind, INotebookSearchOptions, NotebookCellOutputsSplice } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { NotebookOptionsChangeEvent } from 'vs/workbench/contrib/notebook/browser/notebookOptions';\nimport { INotebookService } from 'vs/workbench/contrib/notebook/common/notebookService';\nimport { BaseCellViewModel } from './baseCellViewModel';\nimport { NotebookLayoutInfo } from 'vs/workbench/contrib/notebook/browser/notebookViewEvents';\nimport { ICellExecutionStateChangedEvent } from 'vs/workbench/contrib/notebook/common/notebookExecutionStateService';\n\nexport const outputDisplayLimit = 500;\n\nexport class CodeCellViewModel extends BaseCellViewModel implements ICellViewModel {\n\treadonly cellKind = CellKind.Code;\n\n\tprotected readonly _onLayoutInfoRead = this._register(new Emitter<void>());\n\treadonly onLayoutInfoRead = this._onLayoutInfoRead.event;\n\n\tprotected readonly _onDidStartExecution = this._register(new Emitter<ICellExecutionStateChangedEvent>());\n\treadonly onDidStartExecution = this._onDidStartExecution.event;\n\tprotected readonly _onDidStopExecution = this._register(new Emitter<ICellExecutionStateChangedEvent>());\n\treadonly onDidStopExecution = this._onDidStopExecution.event;\n\n\tprotected readonly _onDidChangeOutputs = this._register(new Emitter<NotebookCellOutputsSplice>());\n\treadonly onDidChangeOutputs = this._onDidChangeOutputs.event;\n\n\tprivate readonly _onDidRemoveOutputs = this._register(new Emitter<readonly ICellOutputViewModel[]>());\n\treadonly onDidRemoveOutputs = this._onDidRemoveOutputs.event;\n\n\tprivate _outputCollection: number[] = [];\n\n\tprivate _outputsTop: PrefixSumComputer | null = null;\n\n\tprotected _pauseableEmitter = this._register(new PauseableEmitter<CodeCellLayoutChangeEvent>());\n\n\treadonly onDidChangeLayout = this._pauseableEmitter.event;\n\n\tprivate _editorHeight = 0;\n\tset editorHeight(height: number) {\n\t\tif (this._editorHeight === height) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._editorHeight = height;\n\t\tthis.layoutChange({ editorHeight: true }, 'CodeCellViewModel#editorHeight');\n\t}\n\n\tget editorHeight() {\n\t\tthrow new Error('editorHeight is write-only');\n\t}\n\n\tprivate _commentHeight = 0;\n\n\tset commentHeight(height: number) {\n\t\tif (this._commentHeight === height) {\n\t\t\treturn;\n\t\t}\n\t\tthis._commentHeight = height;\n\t\tthis.layoutChange({ commentHeight: true }, 'CodeCellViewModel#commentHeight');\n\t}\n\n\tprivate _hoveringOutput: boolean = false;\n\tpublic get outputIsHovered(): boolean {\n\t\treturn this._hoveringOutput;\n\t}\n\n\tpublic set outputIsHovered(v: boolean) {\n\t\tthis._hoveringOutput = v;\n\t\tthis._onDidChangeState.fire({ outputIsHoveredChanged: true });\n\t}\n\n\tprivate _focusOnOutput: boolean = false;\n\tpublic get outputIsFocused(): boolean {\n\t\treturn this._focusOnOutput;\n\t}\n\n\tpublic set outputIsFocused(v: boolean) {\n\t\tthis._focusOnOutput = v;\n\t\tthis._onDidChangeState.fire({ outputIsFocusedChanged: true });\n\t}\n\n\tprivate _outputMinHeight: number = 0;\n\n\tprivate get outputMinHeight() {\n\t\treturn this._outputMinHeight;\n\t}\n\n\t/**\n\t * The minimum height of the output region. It's only set to non-zero temporarily when replacing an output with a new one.\n\t * It's reset to 0 when the new output is rendered, or in one second.\n\t */\n\tprivate set outputMinHeight(newMin: number) {\n\t\tthis._outputMinHeight = newMin;\n\t}\n\n\tprivate _layoutInfo: CodeCellLayoutInfo;\n\n\tget layoutInfo() {\n\t\treturn this._layoutInfo;\n\t}\n\n\tprivate _outputViewModels: ICellOutputViewModel[];\n\n\tget outputsViewModels() {\n\t\treturn this._outputViewModels;\n\t}\n\n\tconstructor(\n\t\tviewType: string,\n\t\tmodel: NotebookCellTextModel,\n\t\tinitialNotebookLayoutInfo: NotebookLayoutInfo | null,\n\t\treadonly viewContext: ViewContext,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@ITextModelService modelService: ITextModelService,\n\t\t@IUndoRedoService undoRedoService: IUndoRedoService,\n\t\t@ICodeEditorService codeEditorService: ICodeEditorService\n\t) {\n\t\tsuper(viewType, model, UUID.generateUuid(), viewContext, configurationService, modelService, undoRedoService, codeEditorService);\n\t\tthis._outputViewModels = this.model.outputs.map(output => new CellOutputViewModel(this, output, this._notebookService));\n\n\t\tthis._register(this.model.onDidChangeOutputs((splice) => {\n\t\t\tconst removedOutputs: ICellOutputViewModel[] = [];\n\t\t\tlet outputLayoutChange = false;\n\t\t\tfor (let i = splice.start; i < splice.start + splice.deleteCount; i++) {\n\t\t\t\tif (this._outputCollection[i] !== undefined && this._outputCollection[i] !== 0) {\n\t\t\t\t\toutputLayoutChange = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._outputCollection.splice(splice.start, splice.deleteCount, ...splice.newOutputs.map(() => 0));\n\t\t\tremovedOutputs.push(...this._outputViewModels.splice(splice.start, splice.deleteCount, ...splice.newOutputs.map(output => new CellOutputViewModel(this, output, this._notebookService))));\n\n\t\t\tthis._outputsTop = null;\n\t\t\tthis._onDidChangeOutputs.fire(splice);\n\t\t\tthis._onDidRemoveOutputs.fire(removedOutputs);\n\t\t\tif (outputLayoutChange) {\n\t\t\t\tthis.layoutChange({ outputHeight: true }, 'CodeCellViewModel#model.onDidChangeOutputs');\n\t\t\t}\n\t\t\tdispose(removedOutputs);\n\t\t}));\n\n\t\tthis._outputCollection = new Array(this.model.outputs.length);\n\n\t\tthis._layoutInfo = {\n\t\t\tfontInfo: initialNotebookLayoutInfo?.fontInfo || null,\n\t\t\teditorHeight: 0,\n\t\t\teditorWidth: initialNotebookLayoutInfo\n\t\t\t\t? this.viewContext.notebookOptions.computeCodeCellEditorWidth(initialNotebookLayoutInfo.width)\n\t\t\t\t: 0,\n\t\t\tstatusBarHeight: 0,\n\t\t\tcommentHeight: 0,\n\t\t\toutputContainerOffset: 0,\n\t\t\toutputTotalHeight: 0,\n\t\t\toutputShowMoreContainerHeight: 0,\n\t\t\toutputShowMoreContainerOffset: 0,\n\t\t\ttotalHeight: this.computeTotalHeight(17, 0, 0),\n\t\t\tcodeIndicatorHeight: 0,\n\t\t\toutputIndicatorHeight: 0,\n\t\t\tbottomToolbarOffset: 0,\n\t\t\tlayoutState: CellLayoutState.Uninitialized,\n\t\t\testimatedHasHorizontalScrolling: false\n\t\t};\n\t}\n\n\tupdateExecutionState(e: ICellExecutionStateChangedEvent) {\n\t\tif (e.changed) {\n\t\t\tthis._onDidStartExecution.fire(e);\n\t\t} else {\n\t\t\tthis._onDidStopExecution.fire(e);\n\t\t}\n\t}\n\n\tupdateOptions(e: NotebookOptionsChangeEvent) {\n\t\tif (e.cellStatusBarVisibility || e.insertToolbarPosition || e.cellToolbarLocation) {\n\t\t\tthis.layoutChange({});\n\t\t}\n\t}\n\n\tpauseLayout() {\n\t\tthis._pauseableEmitter.pause();\n\t}\n\n\tresumeLayout() {\n\t\tthis._pauseableEmitter.resume();\n\t}\n\n\tlayoutChange(state: CodeCellLayoutChangeEvent, source?: string) {\n\t\t// recompute\n\t\tthis._ensureOutputsTop();\n\t\tconst notebookLayoutConfiguration = this.viewContext.notebookOptions.getLayoutConfiguration();\n\t\tconst bottomToolbarDimensions = this.viewContext.notebookOptions.computeBottomToolbarDimensions(this.viewType);\n\t\tconst outputShowMoreContainerHeight = state.outputShowMoreContainerHeight ? state.outputShowMoreContainerHeight : this._layoutInfo.outputShowMoreContainerHeight;\n\t\tconst outputTotalHeight = Math.max(this._outputMinHeight, this.isOutputCollapsed ? notebookLayoutConfiguration.collapsedIndicatorHeight : this._outputsTop!.getTotalSum());\n\t\tconst commentHeight = state.commentHeight ? this._commentHeight : this._layoutInfo.commentHeight;\n\n\t\tconst originalLayout = this.layoutInfo;\n\t\tif (!this.isInputCollapsed) {\n\t\t\tlet newState: CellLayoutState;\n\t\t\tlet editorHeight: number;\n\t\t\tlet totalHeight: number;\n\t\t\tlet hasHorizontalScrolling = false;\n\t\t\tif (!state.editorHeight && this._layoutInfo.layoutState === CellLayoutState.FromCache && !state.outputHeight) {\n\t\t\t\t// No new editorHeight info - keep cached totalHeight and estimate editorHeight\n\t\t\t\tconst estimate = this.estimateEditorHeight(state.font?.lineHeight ?? this._layoutInfo.fontInfo?.lineHeight);\n\t\t\t\teditorHeight = estimate.editorHeight;\n\t\t\t\thasHorizontalScrolling = estimate.hasHorizontalScrolling;\n\t\t\t\ttotalHeight = this._layoutInfo.totalHeight;\n\t\t\t\tnewState = CellLayoutState.FromCache;\n\t\t\t} else if (state.editorHeight || this._layoutInfo.layoutState === CellLayoutState.Measured) {\n\t\t\t\t// Editor has been measured\n\t\t\t\teditorHeight = this._editorHeight;\n\t\t\t\ttotalHeight = this.computeTotalHeight(this._editorHeight, outputTotalHeight, outputShowMoreContainerHeight);\n\t\t\t\tnewState = CellLayoutState.Measured;\n\t\t\t\thasHorizontalScrolling = this._layoutInfo.estimatedHasHorizontalScrolling;\n\t\t\t} else {\n\t\t\t\tconst estimate = this.estimateEditorHeight(state.font?.lineHeight ?? this._layoutInfo.fontInfo?.lineHeight);\n\t\t\t\teditorHeight = estimate.editorHeight;\n\t\t\t\thasHorizontalScrolling = estimate.hasHorizontalScrolling;\n\t\t\t\ttotalHeight = this.computeTotalHeight(editorHeight, outputTotalHeight, outputShowMoreContainerHeight);\n\t\t\t\tnewState = CellLayoutState.Estimated;\n\t\t\t}\n\n\t\t\tconst statusBarHeight = this.viewContext.notebookOptions.computeEditorStatusbarHeight(this.internalMetadata, this.uri);\n\t\t\tconst codeIndicatorHeight = editorHeight + statusBarHeight;\n\t\t\tconst outputIndicatorHeight = outputTotalHeight + outputShowMoreContainerHeight;\n\t\t\tconst outputContainerOffset = notebookLayoutConfiguration.editorToolbarHeight\n\t\t\t\t+ notebookLayoutConfiguration.cellTopMargin // CELL_TOP_MARGIN\n\t\t\t\t+ editorHeight\n\t\t\t\t+ statusBarHeight;\n\t\t\tconst outputShowMoreContainerOffset = totalHeight\n\t\t\t\t- bottomToolbarDimensions.bottomToolbarGap\n\t\t\t\t- bottomToolbarDimensions.bottomToolbarHeight / 2\n\t\t\t\t- outputShowMoreContainerHeight;\n\t\t\tconst bottomToolbarOffset = this.viewContext.notebookOptions.computeBottomToolbarOffset(totalHeight, this.viewType);\n\t\t\tconst editorWidth = state.outerWidth !== undefined\n\t\t\t\t? this.viewContext.notebookOptions.computeCodeCellEditorWidth(state.outerWidth)\n\t\t\t\t: this._layoutInfo?.editorWidth;\n\n\t\t\tthis._layoutInfo = {\n\t\t\t\tfontInfo: state.font ?? this._layoutInfo.fontInfo ?? null,\n\t\t\t\teditorHeight,\n\t\t\t\teditorWidth,\n\t\t\t\tstatusBarHeight,\n\t\t\t\tcommentHeight,\n\t\t\t\toutputContainerOffset,\n\t\t\t\toutputTotalHeight,\n\t\t\t\toutputShowMoreContainerHeight,\n\t\t\t\toutputShowMoreContainerOffset,\n\t\t\t\ttotalHeight,\n\t\t\t\tcodeIndicatorHeight,\n\t\t\t\toutputIndicatorHeight,\n\t\t\t\tbottomToolbarOffset,\n\t\t\t\tlayoutState: newState,\n\t\t\t\testimatedHasHorizontalScrolling: hasHorizontalScrolling\n\t\t\t};\n\t\t} else {\n\t\t\tconst codeIndicatorHeight = notebookLayoutConfiguration.collapsedIndicatorHeight;\n\t\t\tconst outputIndicatorHeight = outputTotalHeight + outputShowMoreContainerHeight;\n\n\t\t\tconst outputContainerOffset = notebookLayoutConfiguration.cellTopMargin + notebookLayoutConfiguration.collapsedIndicatorHeight;\n\t\t\tconst totalHeight =\n\t\t\t\tnotebookLayoutConfiguration.cellTopMargin\n\t\t\t\t+ notebookLayoutConfiguration.collapsedIndicatorHeight\n\t\t\t\t+ notebookLayoutConfiguration.cellBottomMargin //CELL_BOTTOM_MARGIN\n\t\t\t\t+ bottomToolbarDimensions.bottomToolbarGap //BOTTOM_CELL_TOOLBAR_GAP\n\t\t\t\t+ commentHeight\n\t\t\t\t+ outputTotalHeight + outputShowMoreContainerHeight;\n\t\t\tconst outputShowMoreContainerOffset = totalHeight\n\t\t\t\t- bottomToolbarDimensions.bottomToolbarGap\n\t\t\t\t- bottomToolbarDimensions.bottomToolbarHeight / 2\n\t\t\t\t- outputShowMoreContainerHeight;\n\t\t\tconst bottomToolbarOffset = this.viewContext.notebookOptions.computeBottomToolbarOffset(totalHeight, this.viewType);\n\t\t\tconst editorWidth = state.outerWidth !== undefined\n\t\t\t\t? this.viewContext.notebookOptions.computeCodeCellEditorWidth(state.outerWidth)\n\t\t\t\t: this._layoutInfo?.editorWidth;\n\n\t\t\tthis._layoutInfo = {\n\t\t\t\tfontInfo: state.font ?? this._layoutInfo.fontInfo ?? null,\n\t\t\t\teditorHeight: this._layoutInfo.editorHeight,\n\t\t\t\teditorWidth,\n\t\t\t\tstatusBarHeight: 0,\n\t\t\t\tcommentHeight,\n\t\t\t\toutputContainerOffset,\n\t\t\t\toutputTotalHeight,\n\t\t\t\toutputShowMoreContainerHeight,\n\t\t\t\toutputShowMoreContainerOffset,\n\t\t\t\ttotalHeight,\n\t\t\t\tcodeIndicatorHeight,\n\t\t\t\toutputIndicatorHeight,\n\t\t\t\tbottomToolbarOffset,\n\t\t\t\tlayoutState: this._layoutInfo.layoutState,\n\t\t\t\testimatedHasHorizontalScrolling: false\n\t\t\t};\n\t\t}\n\n\t\tthis._fireOnDidChangeLayout({\n\t\t\t...state,\n\t\t\ttotalHeight: this.layoutInfo.totalHeight !== originalLayout.totalHeight,\n\t\t\tsource,\n\t\t});\n\t}\n\n\tprivate _fireOnDidChangeLayout(state: CodeCellLayoutChangeEvent) {\n\t\tthis._pauseableEmitter.fire(state);\n\t}\n\n\toverride restoreEditorViewState(editorViewStates: editorCommon.ICodeEditorViewState | null, totalHeight?: number) {\n\t\tsuper.restoreEditorViewState(editorViewStates);\n\t\tif (totalHeight !== undefined && this._layoutInfo.layoutState !== CellLayoutState.Measured) {\n\t\t\tthis._layoutInfo = {\n\t\t\t\tfontInfo: this._layoutInfo.fontInfo,\n\t\t\t\teditorHeight: this._layoutInfo.editorHeight,\n\t\t\t\teditorWidth: this._layoutInfo.editorWidth,\n\t\t\t\tstatusBarHeight: this.layoutInfo.statusBarHeight,\n\t\t\t\tcommentHeight: this.layoutInfo.commentHeight,\n\t\t\t\toutputContainerOffset: this._layoutInfo.outputContainerOffset,\n\t\t\t\toutputTotalHeight: this._layoutInfo.outputTotalHeight,\n\t\t\t\toutputShowMoreContainerHeight: this._layoutInfo.outputShowMoreContainerHeight,\n\t\t\t\toutputShowMoreContainerOffset: this._layoutInfo.outputShowMoreContainerOffset,\n\t\t\t\ttotalHeight: totalHeight,\n\t\t\t\tcodeIndicatorHeight: this._layoutInfo.codeIndicatorHeight,\n\t\t\t\toutputIndicatorHeight: this._layoutInfo.outputIndicatorHeight,\n\t\t\t\tbottomToolbarOffset: this._layoutInfo.bottomToolbarOffset,\n\t\t\t\tlayoutState: CellLayoutState.FromCache,\n\t\t\t\testimatedHasHorizontalScrolling: this._layoutInfo.estimatedHasHorizontalScrolling\n\t\t\t};\n\t\t}\n\t}\n\n\tgetDynamicHeight() {\n\t\tthis._onLayoutInfoRead.fire();\n\t\treturn this._layoutInfo.totalHeight;\n\t}\n\n\tgetHeight(lineHeight: number) {\n\t\tif (this._layoutInfo.layoutState === CellLayoutState.Uninitialized) {\n\t\t\tconst estimate = this.estimateEditorHeight(lineHeight);\n\t\t\treturn this.computeTotalHeight(estimate.editorHeight, 0, 0);\n\t\t} else {\n\t\t\treturn this._layoutInfo.totalHeight;\n\t\t}\n\t}\n\n\tprivate estimateEditorHeight(lineHeight: number | undefined = 20): { editorHeight: number; hasHorizontalScrolling: boolean } {\n\t\tlet hasHorizontalScrolling = false;\n\t\tconst cellEditorOptions = this.viewContext.getBaseCellEditorOptions(this.language);\n\t\tif (this.layoutInfo.fontInfo && cellEditorOptions.value.wordWrap === 'off') {\n\t\t\tfor (let i = 0; i < this.lineCount; i++) {\n\t\t\t\tconst max = this.textBuffer.getLineLastNonWhitespaceColumn(i + 1);\n\t\t\t\tconst estimatedWidth = max * (this.layoutInfo.fontInfo.typicalHalfwidthCharacterWidth + this.layoutInfo.fontInfo.letterSpacing);\n\t\t\t\tif (estimatedWidth > this.layoutInfo.editorWidth) {\n\t\t\t\t\thasHorizontalScrolling = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst verticalScrollbarHeight = hasHorizontalScrolling ? 12 : 0; // take zoom level into account\n\t\tconst editorPadding = this.viewContext.notebookOptions.computeEditorPadding(this.internalMetadata, this.uri);\n\t\tconst editorHeight = this.lineCount * lineHeight\n\t\t\t+ editorPadding.top\n\t\t\t+ editorPadding.bottom // EDITOR_BOTTOM_PADDING\n\t\t\t+ verticalScrollbarHeight;\n\t\treturn {\n\t\t\teditorHeight,\n\t\t\thasHorizontalScrolling\n\t\t};\n\t}\n\n\tprivate computeTotalHeight(editorHeight: number, outputsTotalHeight: number, outputShowMoreContainerHeight: number): number {\n\t\tconst layoutConfiguration = this.viewContext.notebookOptions.getLayoutConfiguration();\n\t\tconst { bottomToolbarGap } = this.viewContext.notebookOptions.computeBottomToolbarDimensions(this.viewType);\n\t\treturn layoutConfiguration.editorToolbarHeight\n\t\t\t+ layoutConfiguration.cellTopMargin\n\t\t\t+ editorHeight\n\t\t\t+ this.viewContext.notebookOptions.computeEditorStatusbarHeight(this.internalMetadata, this.uri)\n\t\t\t+ this._commentHeight\n\t\t\t+ outputsTotalHeight\n\t\t\t+ outputShowMoreContainerHeight\n\t\t\t+ bottomToolbarGap\n\t\t\t+ layoutConfiguration.cellBottomMargin;\n\t}\n\n\tprotected onDidChangeTextModelContent(): void {\n\t\tif (this.getEditState() !== CellEditState.Editing) {\n\t\t\tthis.updateEditState(CellEditState.Editing, 'onDidChangeTextModelContent');\n\t\t\tthis._onDidChangeState.fire({ contentChanged: true });\n\t\t}\n\t}\n\n\tonDeselect() {\n\t\tthis.updateEditState(CellEditState.Preview, 'onDeselect');\n\t}\n\n\tupdateOutputShowMoreContainerHeight(height: number) {\n\t\tthis.layoutChange({ outputShowMoreContainerHeight: height }, 'CodeCellViewModel#updateOutputShowMoreContainerHeight');\n\t}\n\n\tupdateOutputMinHeight(height: number) {\n\t\tthis.outputMinHeight = height;\n\t}\n\n\tunlockOutputHeight() {\n\t\tthis.outputMinHeight = 0;\n\t\tthis.layoutChange({ outputHeight: true });\n\t}\n\n\tupdateOutputHeight(index: number, height: number, source?: string) {\n\t\tif (index >= this._outputCollection.length) {\n\t\t\tthrow new Error('Output index out of range!');\n\t\t}\n\n\t\tthis._ensureOutputsTop();\n\t\tif (height < 28 && this._outputViewModels[index].hasMultiMimeType()) {\n\t\t\theight = 28;\n\t\t}\n\n\t\tthis._outputCollection[index] = height;\n\t\tif (this._outputsTop!.setValue(index, height)) {\n\t\t\tthis.layoutChange({ outputHeight: true }, source);\n\t\t}\n\t}\n\n\tgetOutputOffsetInContainer(index: number) {\n\t\tthis._ensureOutputsTop();\n\n\t\tif (index >= this._outputCollection.length) {\n\t\t\tthrow new Error('Output index out of range!');\n\t\t}\n\n\t\treturn this._outputsTop!.getPrefixSum(index - 1);\n\t}\n\n\tgetOutputOffset(index: number): number {\n\t\treturn this.layoutInfo.outputContainerOffset + this.getOutputOffsetInContainer(index);\n\t}\n\n\tspliceOutputHeights(start: number, deleteCnt: number, heights: number[]) {\n\t\tthis._ensureOutputsTop();\n\n\t\tthis._outputsTop!.removeValues(start, deleteCnt);\n\t\tif (heights.length) {\n\t\t\tconst values = new Uint32Array(heights.length);\n\t\t\tfor (let i = 0; i < heights.length; i++) {\n\t\t\t\tvalues[i] = heights[i];\n\t\t\t}\n\n\t\t\tthis._outputsTop!.insertValues(start, values);\n\t\t}\n\n\t\tthis.layoutChange({ outputHeight: true }, 'CodeCellViewModel#spliceOutputs');\n\t}\n\n\tprivate _ensureOutputsTop(): void {\n\t\tif (!this._outputsTop) {\n\t\t\tconst values = new Uint32Array(this._outputCollection.length);\n\t\t\tfor (let i = 0; i < this._outputCollection.length; i++) {\n\t\t\t\tvalues[i] = this._outputCollection[i];\n\t\t\t}\n\n\t\t\tthis._outputsTop = new PrefixSumComputer(values);\n\t\t}\n\t}\n\n\tprivate readonly _hasFindResult = this._register(new Emitter<boolean>());\n\tpublic readonly hasFindResult: Event<boolean> = this._hasFindResult.event;\n\n\tstartFind(value: string, options: INotebookSearchOptions): CellFindMatch | null {\n\t\tconst matches = super.cellStartFind(value, options);\n\n\t\tif (matches === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tcell: this,\n\t\t\tcontentMatches: matches\n\t\t};\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\n\t\tthis._outputCollection = [];\n\t\tthis._outputsTop = null;\n\t\tdispose(this._outputViewModels);\n\t}\n}\n"]}