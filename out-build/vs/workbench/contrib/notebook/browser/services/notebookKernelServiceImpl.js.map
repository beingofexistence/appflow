{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/notebook/browser/services/notebookKernelServiceImpl.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;;IAiBhG,MAAM,UAAU;iBAEA,MAAC,GAAa,CAAb,AAAc,CAAC;QAQ/B,YAAY,MAAuB;YAF1B,uBAAkB,GAAG,IAAI,SAAG,EAAkB,CAAC;YAGvD,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;YACrB,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;YAChB,IAAI,CAAC,IAAI,GAAG,UAAU,CAAC,CAAC,EAAY,CAAC;QACtC,CAAC;;IAGF,MAAM,uBAAuB;QAC5B,MAAM,CAAC,GAAG,CAAC,CAAyB;YACnC,OAAO,GAAG,CAAC,CAAC,QAAQ,IAAI,CAAC,CAAC,GAAG,CAAC,QAAQ,EAAE,EAAE,CAAC;QAC5C,CAAC;QACD,MAAM,CAAC,GAAG,CAAC,CAAS;YACnB,MAAM,GAAG,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;YAC3B,OAAO;gBACN,QAAQ,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,GAAG,CAAC;gBAC7B,GAAG,EAAE,SAAG,CAAC,KAAK,CAAC,CAAC,CAAC,SAAS,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;aACpC,CAAC;QACH,CAAC;KACD;IAED,MAAM,YAAa,SAAQ,eAAG;QAK7B,YACU,MAAe,EACf,KAA6B,EAC7B,SAAkB;YAE3B,KAAK,EAAE,CAAC;YAJC,WAAM,GAAN,MAAM,CAAS;YACf,UAAK,GAAL,KAAK,CAAwB;YAC7B,cAAS,GAAT,SAAS,CAAS;YANX,MAAC,GAAmB,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAY,CAAC,CAAC;YAChE,qBAAgB,GAAG,IAAI,CAAC,CAAC,CAAiB,KAAK,CAAC;QAQzD,CAAC;QAED,KAAK,CAAC,SAAS;YACd,IAAI,IAAI,CAAC,SAAS,EAAE;gBACnB,OAAO,IAAI,CAAC,SAAS,CAAC;aACtB;YAED,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,CAAC,EAAW,CAAC;YACnC,IAAI,CAAC,CAAC,CAAiB,IAAI,EAAE,CAAC;YAC9B,MAAM,IAAI,CAAC,SAAS,CAAC;YACrB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;YAC3B,IAAI,CAAC,CAAC,CAAiB,IAAI,EAAE,CAAC;QAC/B,CAAC;QAEO,KAAK,CAAC,CAAC;YACd,IAAI;gBACH,MAAM,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC;oBACrB,GAAG,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG;oBACnB,IAAI,6CAAoC;iBACxC,CAAC,CAAC;aAEH;YAAC,OAAO,KAAK,EAAE;gBACf,OAAO,CAAC,IAAI,CAAC,iCAAiC,KAAK,EAAE,CAAC,CAAC;aACvD;QACF,CAAC;KACD;IAQM,IAAM,IAAI,GAAV,MAAM,IAAsB,SAAQ,eAAG;;iBA0B9B,MAAC,GAAyB,sCAAzB,AAA+D,CAAC;QAGhF,YACmB,CAAuC,EACxC,CAAqC,EACxC,CAAkC,EAC5B,CAAwC;YAE5D,KAAK,EAAE,CAAC;YAL2B,MAAC,GAAD,CAAC,CAAqB;YACvB,MAAC,GAAD,CAAC,CAAmB;YACvB,MAAC,GAAD,CAAC,CAAgB;YACX,MAAC,GAAD,CAAC,CAAsB;YA7B5C,MAAC,GAAU,IAAI,GAAG,EAAsB,CAAC;YAEzC,MAAC,GAAmB,IAAI,SAAG,CAAsB,IAAI,EAAE,GAAG,CAAC,CAAC;YAE5D,MAAC,GAAmC,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAqC,CAAC,CAAC;YACjG,MAAC,GAAiB,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAuB,CAAC,CAAC;YACjE,MAAC,GAAoB,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAuB,CAAC,CAAC;YACpE,MAAC,GAA8B,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAY,CAAC,CAAC;YACnE,MAAC,GAA2B,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAwC,CAAC,CAAC;YAC5F,MAAC,GAAgB,IAAI,GAAG,EAA4B,CAAC;YACrD,MAAC,GAA6B,IAAI,GAAG,EAAuB,CAAC;YAC7D,MAAC,GAAuB,IAAI,GAAG,EAA0C,CAAC;YAC1E,MAAC,GAAkC,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAc,CAAC,CAAC;YACzE,MAAC,GAA8B,IAAI,GAAG,EAAyC,CAAC;YAExF,iCAA4B,GAAyC,IAAI,CAAC,CAAC,CAAiC,KAAK,CAAC;YAClH,mBAAc,GAA2B,IAAI,CAAC,CAAC,CAAe,KAAK,CAAC;YACpE,sBAAiB,GAA2B,IAAI,CAAC,CAAC,CAAkB,KAAK,CAAC;YAC1E,gCAA2B,GAAgB,IAAI,CAAC,CAAC,CAA4B,KAAK,CAAC;YACnF,6BAAwB,GAA4C,IAAI,CAAC,CAAC,CAAyB,KAAK,CAAC;YACzG,oCAA+B,GAAkB,IAAI,CAAC,CAAC,CAAgC,KAAK,CAAC;YAarG,yEAAyE;YACzE,4DAA4D;YAC5D,IAAI,CAAC,CAAC,CAAS,CAAC,CAAgB,wBAAwB,CAAC,IAAI,CAAC,CAAC,EAAqB,IAAI,CAAC,CAAC,CAAC;YAC3F,IAAI,CAAC,CAAC,CAAS,CAAC,CAAgB,4BAA4B,CAAC,QAAQ,CAAC,EAAE;gBACvE,MAAM,EAAE,GAAG,uBAAuB,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;gBACjD,MAAM,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAiB,GAAG,CAAC,EAAE,CAAC,CAAC;gBAChD,IAAI,QAAQ,IAAI,QAAQ,CAAC,GAAG,CAAC,MAAM,KAAK,iBAAO,CAAC,QAAQ,EAAE;oBACzD,IAAI,CAAC,uBAAuB,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;iBAClD;gBACD,IAAI,CAAC,CAAC,CAA2B,GAAG,CAAC,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC;gBACpD,IAAI,CAAC,CAAC,CAA2B,MAAM,CAAC,EAAE,CAAC,CAAC;YAC7C,CAAC,CAAC,CAAC,CAAC;YAEJ,uBAAuB;YACvB,IAAI;gBACH,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAe,GAAG,CAAC,MAAI,CAAkB,CAAC,kCAAgD,IAAI,CAAC,CAAC,CAAC;gBAC/H,IAAI,CAAC,CAAC,CAAiB,QAAQ,CAAC,IAAI,CAAC,CAAC;aACtC;YAAC,MAAM;gBACP,SAAS;aACT;QACF,CAAC;QAEQ,OAAO;YACf,IAAI,CAAC,CAAC,CAAQ,KAAK,EAAE,CAAC;YACtB,IAAI,CAAC,CAAC,CAAc,OAAO,CAAC,CAAC,CAAC,EAAE;gBAC/B,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;gBACjB,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC;YACxC,CAAC,CAAC,CAAC;YACH,IAAI,CAAC,CAAC,CAA2B,OAAO,CAAC,CAAC,CAAC,EAAE;gBAC5C,CAAC,CAAC,OAAO,EAAE,CAAC;YACb,CAAC,CAAC,CAAC;YACH,IAAI,CAAC,CAAC,CAA2B,KAAK,EAAE,CAAC;YACzC,KAAK,CAAC,OAAO,EAAE,CAAC;QACjB,CAAC;QAIO,CAAC;YACR,IAAI,CAAC,CAAC,EAAmB,OAAO,EAAE,CAAC;YACnC,IAAI,CAAC,CAAC,GAAoB,IAAA,WAAG,EAAS,GAAG,EAAE;gBAC1C,IAAI,CAAC,CAAC,CAAe,KAAK,CAAC,MAAI,CAAkB,CAAC,EAAwB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAiB,gEAAgD,CAAC;YAClK,CAAC,EAAE,GAAG,CAAC,CAAC;QACT,CAAC;QAEO,MAAM,CAAC,CAAC,CAAM,MAAuB,EAAE,QAAgC;YAC9E,IAAI,MAAM,CAAC,QAAQ,KAAK,GAAG,EAAE;gBAC5B,OAAO,CAAC,CAAC;aACT;iBAAM,IAAI,MAAM,CAAC,QAAQ,KAAK,QAAQ,CAAC,QAAQ,EAAE;gBACjD,OAAO,EAAE,CAAC;aACV;iBAAM;gBACN,OAAO,CAAC,CAAC;aACT;QACF,CAAC;QAEO,CAAC,CAAoB,QAA4B,EAAE,cAAgC;YAE1F,MAAM,EAAE,GAAG,IAAI,CAAC,CAAC,CAAiB,GAAG,CAAC,uBAAuB,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;YAC7E,IAAI,CAAC,EAAE,EAAE;gBACR,uBAAuB;gBACvB,OAAO;aACP;YACD,MAAM,cAAc,GAAG,IAAI,CAAC,CAAC,CAAQ,GAAG,CAAC,EAAE,CAAC,CAAC;YAC7C,IAAI,CAAC,cAAc,IAAI,CAAC,MAAI,CAAkB,CAAC,CAAM,cAAc,CAAC,MAAM,EAAE,QAAQ,CAAC,EAAE;gBACtF,4CAA4C;gBAC5C,OAAO;aACP;YACD,IAAI,CAAC,cAAc,IAAI,cAAc,CAAC,MAAM,KAAK,cAAc,EAAE;gBAChE,IAAI,CAAC,CAAC,CAAiC,IAAI,CAAC,EAAE,QAAQ,EAAE,QAAQ,CAAC,GAAG,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,cAAc,CAAC,MAAM,CAAC,EAAE,EAAE,CAAC,CAAC;aACnI;QACF,CAAC;QAED,cAAc,CAAC,MAAuB;YACrC,IAAI,IAAI,CAAC,CAAC,CAAQ,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE;gBACjC,MAAM,IAAI,KAAK,CAAC,gCAAgC,MAAM,CAAC,EAAE,kBAAkB,CAAC,CAAC;aAC7E;YAED,IAAI,CAAC,CAAC,CAAQ,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC;YACrD,IAAI,CAAC,CAAC,CAAe,IAAI,CAAC,MAAM,CAAC,CAAC;YAElC,6DAA6D;YAC7D,6BAA6B;YAC7B,KAAK,MAAM,QAAQ,IAAI,IAAI,CAAC,CAAC,CAAgB,qBAAqB,EAAE,EAAE;gBACrE,IAAI,CAAC,CAAC,CAAoB,QAAQ,EAAE,MAAM,CAAC,CAAC;aAC5C;YAED,OAAO,IAAA,eAAG,EAAU,GAAG,EAAE;gBACxB,IAAI,IAAI,CAAC,CAAC,CAAQ,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE;oBACpC,IAAI,CAAC,CAAC,CAAkB,IAAI,CAAC,MAAM,CAAC,CAAC;iBACrC;gBACD,KAAK,MAAM,CAAC,GAAG,EAAE,SAAS,CAAC,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAiB,EAAE;oBAClE,IAAI,SAAS,KAAK,MAAM,CAAC,EAAE,EAAE;wBAC5B,IAAI,CAAC,CAAC,CAAiC,IAAI,CAAC,EAAE,QAAQ,EAAE,uBAAuB,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,SAAS,EAAE,MAAM,CAAC,EAAE,EAAE,SAAS,EAAE,SAAS,EAAE,CAAC,CAAC;qBAC5I;iBACD;YACF,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,iBAAiB,CAAC,QAAgC;YAEjD,yBAAyB;YACzB,MAAM,OAAO,GAA2E,EAAE,CAAC;YAC3F,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,CAAC,CAAQ,MAAM,EAAE,EAAE;gBAC1C,MAAM,KAAK,GAAG,MAAI,CAAkB,CAAC,CAAM,IAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;gBAClE,IAAI,KAAK,EAAE;oBACV,OAAO,CAAC,IAAI,CAAC;wBACZ,KAAK;wBACL,MAAM,EAAE,IAAI,CAAC,MAAM;wBACnB,gBAAgB,EAAE,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,+CAA+C;qBAChH,CAAC,CAAC;iBACH;aACD;YAED,OAAO;iBACL,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,gBAAgB,GAAG,CAAC,CAAC,gBAAgB,IAAI,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;YAC/H,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YAE3C,eAAe;YACf,MAAM,UAAU,GAAG,IAAI,CAAC,CAAC,CAAiB,GAAG,CAAC,uBAAuB,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;YACrF,MAAM,QAAQ,GAAG,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAQ,GAAG,CAAC,UAAU,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC;YAChF,MAAM,WAAW,GAAG,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,gBAAgB,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAC/F,MAAM,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,gBAAgB,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAC1F,OAAO,EAAE,GAAG,EAAE,QAAQ,EAAE,WAAW,EAAE,MAAM,EAAE,CAAC;QAC/C,CAAC;QAED,4BAA4B,CAAC,QAA4B;YACxD,MAAM,IAAI,GAAG,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;YAC9C,IAAI,IAAI,CAAC,QAAQ,EAAE;gBAClB,OAAO,IAAI,CAAC,QAAQ,CAAC;aACrB;YAED,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAQ,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,kBAAkB,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,iDAAiD,CAAC,CAAC;YACxK,IAAI,SAAS,CAAC,MAAM,KAAK,CAAC,EAAE;gBAC3B,OAAO,SAAS,CAAC,CAAC,CAAC,CAAC;aACpB;YAED,OAAO,IAAI,CAAC,GAAG,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;QACxD,CAAC;QAED,sDAAsD;QACtD,6BAA6B;QAC7B,uBAAuB,CAAC,MAAmC,EAAE,QAAgC;YAC5F,MAAM,GAAG,GAAG,uBAAuB,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YAClD,MAAM,SAAS,GAAG,IAAI,CAAC,CAAC,CAAiB,GAAG,CAAC,GAAG,CAAC,CAAC;YAClD,IAAI,SAAS,KAAK,MAAM,EAAE,EAAE,EAAE;gBAC7B,IAAI,MAAM,EAAE;oBACX,IAAI,CAAC,CAAC,CAAiB,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,EAAE,CAAC,CAAC;iBAC3C;qBAAM;oBACN,IAAI,CAAC,CAAC,CAAiB,MAAM,CAAC,GAAG,CAAC,CAAC;iBACnC;gBACD,IAAI,CAAC,CAAC,CAAiC,IAAI,CAAC,EAAE,QAAQ,EAAE,QAAQ,CAAC,GAAG,EAAE,SAAS,EAAE,SAAS,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC;gBAC1G,IAAI,CAAC,CAAC,EAAiB,CAAC;aACxB;QACF,CAAC;QAED,0BAA0B,CAAC,MAAuB,EAAE,QAAgC;YACnF,MAAM,GAAG,GAAG,uBAAuB,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YAClD,MAAM,SAAS,GAAG,IAAI,CAAC,CAAC,CAAiB,GAAG,CAAC,GAAG,CAAC,CAAC;YAClD,IAAI,SAAS,KAAK,MAAM,EAAE,EAAE,EAAE;gBAC7B,IAAI,CAAC,CAAC,CAAiB,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,EAAE,CAAC,CAAC;gBAC3C,IAAI,CAAC,CAAC,EAAiB,CAAC;aACxB;QACF,CAAC;QAED,4BAA4B,CAAC,MAAuB,EAAE,QAAa,EAAE,UAA8B;YAClG,MAAM,IAAI,GAAG,IAAI,CAAC,CAAC,CAAQ,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;YAC1C,IAAI,CAAC,IAAI,EAAE;gBACV,MAAM,IAAI,KAAK,CAAC,mBAAmB,MAAM,CAAC,EAAE,GAAG,CAAC,CAAC;aACjD;YACD,IAAI,UAAU,KAAK,SAAS,EAAE;gBAC7B,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;aACzC;iBAAM;gBACN,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;aAClD;YACD,IAAI,CAAC,CAAC,CAA4B,IAAI,EAAE,CAAC;QAC1C,CAAC;QAED,uBAAuB,CAAC,QAAgC;YACvD,MAAM,EAAE,GAAG,uBAAuB,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YACjD,MAAM,YAAY,GAAG,IAAI,CAAC,CAAC,CAAc,GAAG,CAAC,EAAE,CAAC,CAAC;YACjD,IAAI,YAAY,EAAE;gBACjB,OAAO,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;aAC3F;YAED,OAAO,EAAE,CAAC;QACX,CAAC;QAED,gBAAgB,CAAC,QAAgC,EAAE,iBAAiD;YACnG,iBAAiB,GAAG,iBAAiB,IAAI,IAAI,CAAC,CAAC,CAAkB;YACjE,MAAM,EAAE,GAAG,uBAAuB,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YACjD,MAAM,YAAY,GAAG,IAAI,CAAC,CAAC,CAAc,GAAG,CAAC,EAAE,CAAC,CAAC;YAEjD,IAAI,YAAY,EAAE;gBACjB,OAAO,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;aAC3C;YAED,MAAM,UAAU,GAAG,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,CAAC,CAAY,UAAU,CAAC,aAAG,CAAI,oBAAoB,EAAE,iBAAiB,CAAC,CAAC,CAAC;YAChH,MAAM,IAAI,GAAqB,EAAE,IAAI,EAAE,UAAU,EAAE,OAAO,EAAE,EAAE,EAAE,CAAC;YAEjE,MAAM,mBAAmB,GAAG,CAAC,IAAW,EAAE,QAAgC,EAAE,EAAE;gBAC7E,MAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,EAAE,iBAAiB,EAAE,IAAI,EAAE,CAAC,CAAC;gBAC5D,MAAM,aAAa,GAAmC,EAAE,CAAC;gBACzD,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;oBACtB,MAAM,SAAS,GAAG,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC5C,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;wBACzB,MAAM,YAAY,GAAG,IAAI,YAAY,CAAC,MAAM,EAAE,QAAQ,EAAE,SAAS,CAAC,CAAC;wBACnE,MAAM,mBAAmB,GAAG,YAAY,CAAC,gBAAgB,CAAC,GAAG,EAAE;4BAC9D,IAAI,CAAC,CAAC,CAAyB,IAAI,CAAC;gCACnC,QAAQ,EAAE,QAAQ,CAAC,GAAG;gCACtB,QAAQ,EAAE,QAAQ,CAAC,QAAQ;6BAC3B,CAAC,CAAC;wBACJ,CAAC,CAAC,CAAC;wBACH,aAAa,CAAC,IAAI,CAAC,CAAC,YAAY,EAAE,mBAAmB,CAAC,CAAC,CAAC;oBACzD,CAAC,CAAC,CAAC;gBACJ,CAAC,CAAC,CAAC;gBACH,IAAI,CAAC,OAAO,GAAG,aAAa,CAAC;gBAC7B,IAAI,CAAC,CAAC,CAAc,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;gBAClC,IAAI,CAAC,CAAC,CAAyB,IAAI,CAAC,EAAE,QAAQ,EAAE,QAAQ,CAAC,GAAG,EAAE,QAAQ,EAAE,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC;YAC9F,CAAC,CAAC;YAEF,IAAI,CAAC,CAAC,CAA2B,GAAG,CAAC,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC;YACpD,IAAI,CAAC,CAAC,CAA2B,GAAG,CAAC,EAAE,EAAE,UAAU,CAAC,WAAW,CAAC,GAAG,EAAE;gBACpE,mBAAmB,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;YAC3C,CAAC,CAAC,CAAC,CAAC;YAEJ,mBAAmB,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;YAE1C,OAAO,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACpC,CAAC;QAED,mCAAmC,CAAC,IAAkC;YACrE,MAAM,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC;YACvC,MAAM,GAAG,GAAG,IAAI,CAAC,CAAC,CAAqB,GAAG,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;YAC/D,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACf,IAAI,CAAC,CAAC,CAAqB,GAAG,CAAC,YAAY,EAAE,GAAG,CAAC,CAAC;YAClD,IAAI,CAAC,CAAC,CAAgC,IAAI,CAAC,YAAY,CAAC,CAAC;YACzD,OAAO,IAAA,eAAG,EAAU,GAAG,EAAE;gBACxB,MAAM,GAAG,GAAG,IAAI,CAAC,CAAC,CAAqB,GAAG,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;gBAC/D,MAAM,GAAG,GAAG,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;gBAC9B,IAAI,GAAG,IAAI,CAAC,EAAE;oBACb,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;oBACnB,IAAI,CAAC,CAAC,CAAqB,GAAG,CAAC,YAAY,EAAE,GAAG,CAAC,CAAC;oBAClD,IAAI,CAAC,CAAC,CAAgC,IAAI,CAAC,YAAY,CAAC,CAAC;iBACzD;YACF,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,uBAAuB,CAAC,QAAgC;YACvD,OAAO,IAAI,CAAC,CAAC,CAAqB,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;QAChE,CAAC;QAED,kCAAkC,CAAC,QAAgB,EAAE,QAAqC;YACzF,MAAM,SAAS,GAAG,IAAI,CAAC,CAAC,CAA4B,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;YACxE,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACzB,IAAI,CAAC,CAAC,CAA4B,GAAG,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;YAC3D,IAAI,CAAC,CAAC,CAAyB,IAAI,CAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC,CAAC;YAE5D,MAAM,sBAAsB,GAAG,QAAQ,CAAC,wBAAwB,EAAE,CAAC,GAAG,EAAE;gBACvE,IAAI,CAAC,CAAC,CAAyB,IAAI,CAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC,CAAC;YAC7D,CAAC,CAAC,CAAC;YAEH,OAAO,IAAA,eAAG,EAAU,GAAG,EAAE;gBACxB,MAAM,SAAS,GAAG,IAAI,CAAC,CAAC,CAA4B,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;gBACxE,MAAM,GAAG,GAAG,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;gBACxC,IAAI,GAAG,IAAI,CAAC,EAAE;oBACb,SAAS,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;oBACzB,IAAI,CAAC,CAAC,CAA4B,GAAG,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;iBAC3D;gBAED,sBAAsB,EAAE,OAAO,EAAE,CAAC;YACnC,CAAC,CAAC,CAAC;QACJ,CAAC;QAED;;WAEG;QACH,uBAAuB,CAAC,QAAgC;YACvD,MAAM,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC;YACnC,MAAM,SAAS,GAAG,IAAI,CAAC,CAAC,CAA4B,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;YACxE,MAAM,QAAQ,GAAG,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,0BAA0B,EAAE,CAAC,CAAC;YAClF,OAAO,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;gBAC3C,OAAO,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;YAClD,CAAC,CAAC,CAAC;QACJ,CAAC;;IA/TW,oBAAI;mBAAJ,IAAI;QA8Bd,WAAA,sBAAI,CAAA;QACJ,WAAA,aAAG,CAAA;QACH,WAAA,aAAG,CAAA;QACH,WAAA,gBAAG,CAAA;OAjCO,IAAI,CAgUhB","file":"notebookKernelServiceImpl.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { Disposable, IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { INotebookKernelSourceAction, INotebookTextModel } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { INotebookKernel, ISelectedNotebooksChangeEvent, INotebookKernelMatchResult, INotebookKernelService, INotebookTextModelLike, ISourceAction, INotebookSourceActionChangeEvent, INotebookKernelDetectionTask, IKernelSourceActionProvider } from 'vs/workbench/contrib/notebook/common/notebookKernelService';\nimport { LRUCache, ResourceMap } from 'vs/base/common/map';\nimport { IStorageService, StorageScope, StorageTarget } from 'vs/platform/storage/common/storage';\nimport { URI } from 'vs/base/common/uri';\nimport { INotebookService } from 'vs/workbench/contrib/notebook/common/notebookService';\nimport { runWhenIdle } from 'vs/base/common/async';\nimport { IMenu, IMenuService, MenuId } from 'vs/platform/actions/common/actions';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IAction } from 'vs/base/common/actions';\nimport { MarshalledId } from 'vs/base/common/marshallingIds';\nimport { Schemas } from 'vs/base/common/network';\n\nclass KernelInfo {\n\n\tprivate static _logicClock = 0;\n\n\treadonly kernel: INotebookKernel;\n\tpublic score: number;\n\treadonly time: number;\n\n\treadonly notebookPriorities = new ResourceMap<number>();\n\n\tconstructor(kernel: INotebookKernel) {\n\t\tthis.kernel = kernel;\n\t\tthis.score = -1;\n\t\tthis.time = KernelInfo._logicClock++;\n\t}\n}\n\nclass NotebookTextModelLikeId {\n\tstatic str(k: INotebookTextModelLike): string {\n\t\treturn `${k.viewType}/${k.uri.toString()}`;\n\t}\n\tstatic obj(s: string): INotebookTextModelLike {\n\t\tconst idx = s.indexOf('/');\n\t\treturn {\n\t\t\tviewType: s.substring(0, idx),\n\t\t\turi: URI.parse(s.substring(idx + 1))\n\t\t};\n\t}\n}\n\nclass SourceAction extends Disposable implements ISourceAction {\n\texecution: Promise<void> | undefined;\n\tprivate readonly _onDidChangeState = this._register(new Emitter<void>());\n\treadonly onDidChangeState = this._onDidChangeState.event;\n\n\tconstructor(\n\t\treadonly action: IAction,\n\t\treadonly model: INotebookTextModelLike,\n\t\treadonly isPrimary: boolean\n\t) {\n\t\tsuper();\n\t}\n\n\tasync runAction() {\n\t\tif (this.execution) {\n\t\t\treturn this.execution;\n\t\t}\n\n\t\tthis.execution = this._runAction();\n\t\tthis._onDidChangeState.fire();\n\t\tawait this.execution;\n\t\tthis.execution = undefined;\n\t\tthis._onDidChangeState.fire();\n\t}\n\n\tprivate async _runAction(): Promise<void> {\n\t\ttry {\n\t\t\tawait this.action.run({\n\t\t\t\turi: this.model.uri,\n\t\t\t\t$mid: MarshalledId.NotebookActionContext\n\t\t\t});\n\n\t\t} catch (error) {\n\t\t\tconsole.warn(`Kernel source command failed: ${error}`);\n\t\t}\n\t}\n}\n\ninterface IKernelInfoCache {\n\tmenu: IMenu;\n\tactions: [ISourceAction, IDisposable][];\n\n}\n\nexport class NotebookKernelService extends Disposable implements INotebookKernelService {\n\n\tdeclare _serviceBrand: undefined;\n\n\tprivate readonly _kernels = new Map<string, KernelInfo>();\n\n\tprivate readonly _notebookBindings = new LRUCache<string, string>(1000, 0.7);\n\n\tprivate readonly _onDidChangeNotebookKernelBinding = this._register(new Emitter<ISelectedNotebooksChangeEvent>());\n\tprivate readonly _onDidAddKernel = this._register(new Emitter<INotebookKernel>());\n\tprivate readonly _onDidRemoveKernel = this._register(new Emitter<INotebookKernel>());\n\tprivate readonly _onDidChangeNotebookAffinity = this._register(new Emitter<void>());\n\tprivate readonly _onDidChangeSourceActions = this._register(new Emitter<INotebookSourceActionChangeEvent>());\n\tprivate readonly _kernelSources = new Map<string, IKernelInfoCache>();\n\tprivate readonly _kernelSourceActionsUpdates = new Map<string, IDisposable>();\n\tprivate readonly _kernelDetectionTasks = new Map<string, INotebookKernelDetectionTask[]>();\n\tprivate readonly _onDidChangeKernelDetectionTasks = this._register(new Emitter<string>());\n\tprivate readonly _kernelSourceActionProviders = new Map<string, IKernelSourceActionProvider[]>();\n\n\treadonly onDidChangeSelectedNotebooks: Event<ISelectedNotebooksChangeEvent> = this._onDidChangeNotebookKernelBinding.event;\n\treadonly onDidAddKernel: Event<INotebookKernel> = this._onDidAddKernel.event;\n\treadonly onDidRemoveKernel: Event<INotebookKernel> = this._onDidRemoveKernel.event;\n\treadonly onDidChangeNotebookAffinity: Event<void> = this._onDidChangeNotebookAffinity.event;\n\treadonly onDidChangeSourceActions: Event<INotebookSourceActionChangeEvent> = this._onDidChangeSourceActions.event;\n\treadonly onDidChangeKernelDetectionTasks: Event<string> = this._onDidChangeKernelDetectionTasks.event;\n\n\tprivate static _storageNotebookBinding = 'notebook.controller2NotebookBindings';\n\n\n\tconstructor(\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@IMenuService private readonly _menuService: IMenuService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService\n\t) {\n\t\tsuper();\n\n\t\t// auto associate kernels to new notebook documents, also emit event when\n\t\t// a notebook has been closed (but don't update the memento)\n\t\tthis._register(_notebookService.onDidAddNotebookDocument(this._tryAutoBindNotebook, this));\n\t\tthis._register(_notebookService.onWillRemoveNotebookDocument(notebook => {\n\t\t\tconst id = NotebookTextModelLikeId.str(notebook);\n\t\t\tconst kernelId = this._notebookBindings.get(id);\n\t\t\tif (kernelId && notebook.uri.scheme === Schemas.untitled) {\n\t\t\t\tthis.selectKernelForNotebook(undefined, notebook);\n\t\t\t}\n\t\t\tthis._kernelSourceActionsUpdates.get(id)?.dispose();\n\t\t\tthis._kernelSourceActionsUpdates.delete(id);\n\t\t}));\n\n\t\t// restore from storage\n\t\ttry {\n\t\t\tconst data = JSON.parse(this._storageService.get(NotebookKernelService._storageNotebookBinding, StorageScope.WORKSPACE, '[]'));\n\t\t\tthis._notebookBindings.fromJSON(data);\n\t\t} catch {\n\t\t\t// ignore\n\t\t}\n\t}\n\n\toverride dispose() {\n\t\tthis._kernels.clear();\n\t\tthis._kernelSources.forEach(v => {\n\t\t\tv.menu.dispose();\n\t\t\tv.actions.forEach(a => a[1].dispose());\n\t\t});\n\t\tthis._kernelSourceActionsUpdates.forEach(v => {\n\t\t\tv.dispose();\n\t\t});\n\t\tthis._kernelSourceActionsUpdates.clear();\n\t\tsuper.dispose();\n\t}\n\n\tprivate _persistSoonHandle?: IDisposable;\n\n\tprivate _persistMementos(): void {\n\t\tthis._persistSoonHandle?.dispose();\n\t\tthis._persistSoonHandle = runWhenIdle(() => {\n\t\t\tthis._storageService.store(NotebookKernelService._storageNotebookBinding, JSON.stringify(this._notebookBindings), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t}, 100);\n\t}\n\n\tprivate static _score(kernel: INotebookKernel, notebook: INotebookTextModelLike): number {\n\t\tif (kernel.viewType === '*') {\n\t\t\treturn 5;\n\t\t} else if (kernel.viewType === notebook.viewType) {\n\t\t\treturn 10;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tprivate _tryAutoBindNotebook(notebook: INotebookTextModel, onlyThisKernel?: INotebookKernel): void {\n\n\t\tconst id = this._notebookBindings.get(NotebookTextModelLikeId.str(notebook));\n\t\tif (!id) {\n\t\t\t// no kernel associated\n\t\t\treturn;\n\t\t}\n\t\tconst existingKernel = this._kernels.get(id);\n\t\tif (!existingKernel || !NotebookKernelService._score(existingKernel.kernel, notebook)) {\n\t\t\t// associated kernel not known, not matching\n\t\t\treturn;\n\t\t}\n\t\tif (!onlyThisKernel || existingKernel.kernel === onlyThisKernel) {\n\t\t\tthis._onDidChangeNotebookKernelBinding.fire({ notebook: notebook.uri, oldKernel: undefined, newKernel: existingKernel.kernel.id });\n\t\t}\n\t}\n\n\tregisterKernel(kernel: INotebookKernel): IDisposable {\n\t\tif (this._kernels.has(kernel.id)) {\n\t\t\tthrow new Error(`NOTEBOOK CONTROLLER with id '${kernel.id}' already exists`);\n\t\t}\n\n\t\tthis._kernels.set(kernel.id, new KernelInfo(kernel));\n\t\tthis._onDidAddKernel.fire(kernel);\n\n\t\t// auto associate the new kernel to existing notebooks it was\n\t\t// associated to in the past.\n\t\tfor (const notebook of this._notebookService.getNotebookTextModels()) {\n\t\t\tthis._tryAutoBindNotebook(notebook, kernel);\n\t\t}\n\n\t\treturn toDisposable(() => {\n\t\t\tif (this._kernels.delete(kernel.id)) {\n\t\t\t\tthis._onDidRemoveKernel.fire(kernel);\n\t\t\t}\n\t\t\tfor (const [key, candidate] of Array.from(this._notebookBindings)) {\n\t\t\t\tif (candidate === kernel.id) {\n\t\t\t\t\tthis._onDidChangeNotebookKernelBinding.fire({ notebook: NotebookTextModelLikeId.obj(key).uri, oldKernel: kernel.id, newKernel: undefined });\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tgetMatchingKernel(notebook: INotebookTextModelLike): INotebookKernelMatchResult {\n\n\t\t// all applicable kernels\n\t\tconst kernels: { kernel: INotebookKernel; instanceAffinity: number; score: number }[] = [];\n\t\tfor (const info of this._kernels.values()) {\n\t\t\tconst score = NotebookKernelService._score(info.kernel, notebook);\n\t\t\tif (score) {\n\t\t\t\tkernels.push({\n\t\t\t\t\tscore,\n\t\t\t\t\tkernel: info.kernel,\n\t\t\t\t\tinstanceAffinity: info.notebookPriorities.get(notebook.uri) ?? 1 /* vscode.NotebookControllerPriority.Default */,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tkernels\n\t\t\t.sort((a, b) => b.instanceAffinity - a.instanceAffinity || a.score - b.score || a.kernel.label.localeCompare(b.kernel.label));\n\t\tconst all = kernels.map(obj => obj.kernel);\n\n\t\t// bound kernel\n\t\tconst selectedId = this._notebookBindings.get(NotebookTextModelLikeId.str(notebook));\n\t\tconst selected = selectedId ? this._kernels.get(selectedId)?.kernel : undefined;\n\t\tconst suggestions = kernels.filter(item => item.instanceAffinity > 1).map(item => item.kernel);\n\t\tconst hidden = kernels.filter(item => item.instanceAffinity < 0).map(item => item.kernel);\n\t\treturn { all, selected, suggestions, hidden };\n\t}\n\n\tgetSelectedOrSuggestedKernel(notebook: INotebookTextModel): INotebookKernel | undefined {\n\t\tconst info = this.getMatchingKernel(notebook);\n\t\tif (info.selected) {\n\t\t\treturn info.selected;\n\t\t}\n\n\t\tconst preferred = info.all.filter(kernel => this._kernels.get(kernel.id)?.notebookPriorities.get(notebook.uri) === 2 /* vscode.NotebookControllerPriority.Preferred */);\n\t\tif (preferred.length === 1) {\n\t\t\treturn preferred[0];\n\t\t}\n\n\t\treturn info.all.length === 1 ? info.all[0] : undefined;\n\t}\n\n\t// a notebook has one kernel, a kernel has N notebooks\n\t// notebook <-1----N-> kernel\n\tselectKernelForNotebook(kernel: INotebookKernel | undefined, notebook: INotebookTextModelLike): void {\n\t\tconst key = NotebookTextModelLikeId.str(notebook);\n\t\tconst oldKernel = this._notebookBindings.get(key);\n\t\tif (oldKernel !== kernel?.id) {\n\t\t\tif (kernel) {\n\t\t\t\tthis._notebookBindings.set(key, kernel.id);\n\t\t\t} else {\n\t\t\t\tthis._notebookBindings.delete(key);\n\t\t\t}\n\t\t\tthis._onDidChangeNotebookKernelBinding.fire({ notebook: notebook.uri, oldKernel, newKernel: kernel?.id });\n\t\t\tthis._persistMementos();\n\t\t}\n\t}\n\n\tpreselectKernelForNotebook(kernel: INotebookKernel, notebook: INotebookTextModelLike): void {\n\t\tconst key = NotebookTextModelLikeId.str(notebook);\n\t\tconst oldKernel = this._notebookBindings.get(key);\n\t\tif (oldKernel !== kernel?.id) {\n\t\t\tthis._notebookBindings.set(key, kernel.id);\n\t\t\tthis._persistMementos();\n\t\t}\n\t}\n\n\tupdateKernelNotebookAffinity(kernel: INotebookKernel, notebook: URI, preference: number | undefined): void {\n\t\tconst info = this._kernels.get(kernel.id);\n\t\tif (!info) {\n\t\t\tthrow new Error(`UNKNOWN kernel '${kernel.id}'`);\n\t\t}\n\t\tif (preference === undefined) {\n\t\t\tinfo.notebookPriorities.delete(notebook);\n\t\t} else {\n\t\t\tinfo.notebookPriorities.set(notebook, preference);\n\t\t}\n\t\tthis._onDidChangeNotebookAffinity.fire();\n\t}\n\n\tgetRunningSourceActions(notebook: INotebookTextModelLike) {\n\t\tconst id = NotebookTextModelLikeId.str(notebook);\n\t\tconst existingInfo = this._kernelSources.get(id);\n\t\tif (existingInfo) {\n\t\t\treturn existingInfo.actions.filter(action => action[0].execution).map(action => action[0]);\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tgetSourceActions(notebook: INotebookTextModelLike, contextKeyService: IContextKeyService | undefined): ISourceAction[] {\n\t\tcontextKeyService = contextKeyService ?? this._contextKeyService;\n\t\tconst id = NotebookTextModelLikeId.str(notebook);\n\t\tconst existingInfo = this._kernelSources.get(id);\n\n\t\tif (existingInfo) {\n\t\t\treturn existingInfo.actions.map(a => a[0]);\n\t\t}\n\n\t\tconst sourceMenu = this._register(this._menuService.createMenu(MenuId.NotebookKernelSource, contextKeyService));\n\t\tconst info: IKernelInfoCache = { menu: sourceMenu, actions: [] };\n\n\t\tconst loadActionsFromMenu = (menu: IMenu, document: INotebookTextModelLike) => {\n\t\t\tconst groups = menu.getActions({ shouldForwardArgs: true });\n\t\t\tconst sourceActions: [ISourceAction, IDisposable][] = [];\n\t\t\tgroups.forEach(group => {\n\t\t\t\tconst isPrimary = /^primary/.test(group[0]);\n\t\t\t\tgroup[1].forEach(action => {\n\t\t\t\t\tconst sourceAction = new SourceAction(action, document, isPrimary);\n\t\t\t\t\tconst stateChangeListener = sourceAction.onDidChangeState(() => {\n\t\t\t\t\t\tthis._onDidChangeSourceActions.fire({\n\t\t\t\t\t\t\tnotebook: document.uri,\n\t\t\t\t\t\t\tviewType: document.viewType,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tsourceActions.push([sourceAction, stateChangeListener]);\n\t\t\t\t});\n\t\t\t});\n\t\t\tinfo.actions = sourceActions;\n\t\t\tthis._kernelSources.set(id, info);\n\t\t\tthis._onDidChangeSourceActions.fire({ notebook: document.uri, viewType: document.viewType });\n\t\t};\n\n\t\tthis._kernelSourceActionsUpdates.get(id)?.dispose();\n\t\tthis._kernelSourceActionsUpdates.set(id, sourceMenu.onDidChange(() => {\n\t\t\tloadActionsFromMenu(sourceMenu, notebook);\n\t\t}));\n\n\t\tloadActionsFromMenu(sourceMenu, notebook);\n\n\t\treturn info.actions.map(a => a[0]);\n\t}\n\n\tregisterNotebookKernelDetectionTask(task: INotebookKernelDetectionTask): IDisposable {\n\t\tconst notebookType = task.notebookType;\n\t\tconst all = this._kernelDetectionTasks.get(notebookType) ?? [];\n\t\tall.push(task);\n\t\tthis._kernelDetectionTasks.set(notebookType, all);\n\t\tthis._onDidChangeKernelDetectionTasks.fire(notebookType);\n\t\treturn toDisposable(() => {\n\t\t\tconst all = this._kernelDetectionTasks.get(notebookType) ?? [];\n\t\t\tconst idx = all.indexOf(task);\n\t\t\tif (idx >= 0) {\n\t\t\t\tall.splice(idx, 1);\n\t\t\t\tthis._kernelDetectionTasks.set(notebookType, all);\n\t\t\t\tthis._onDidChangeKernelDetectionTasks.fire(notebookType);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetKernelDetectionTasks(notebook: INotebookTextModelLike): INotebookKernelDetectionTask[] {\n\t\treturn this._kernelDetectionTasks.get(notebook.viewType) ?? [];\n\t}\n\n\tregisterKernelSourceActionProvider(viewType: string, provider: IKernelSourceActionProvider): IDisposable {\n\t\tconst providers = this._kernelSourceActionProviders.get(viewType) ?? [];\n\t\tproviders.push(provider);\n\t\tthis._kernelSourceActionProviders.set(viewType, providers);\n\t\tthis._onDidChangeSourceActions.fire({ viewType: viewType });\n\n\t\tconst eventEmitterDisposable = provider.onDidChangeSourceActions?.(() => {\n\t\t\tthis._onDidChangeSourceActions.fire({ viewType: viewType });\n\t\t});\n\n\t\treturn toDisposable(() => {\n\t\t\tconst providers = this._kernelSourceActionProviders.get(viewType) ?? [];\n\t\t\tconst idx = providers.indexOf(provider);\n\t\t\tif (idx >= 0) {\n\t\t\t\tproviders.splice(idx, 1);\n\t\t\t\tthis._kernelSourceActionProviders.set(viewType, providers);\n\t\t\t}\n\n\t\t\teventEmitterDisposable?.dispose();\n\t\t});\n\t}\n\n\t/**\n\t * Get kernel source actions from providers\n\t */\n\tgetKernelSourceActions2(notebook: INotebookTextModelLike): Promise<INotebookKernelSourceAction[]> {\n\t\tconst viewType = notebook.viewType;\n\t\tconst providers = this._kernelSourceActionProviders.get(viewType) ?? [];\n\t\tconst promises = providers.map(provider => provider.provideKernelSourceActions());\n\t\treturn Promise.all(promises).then(actions => {\n\t\t\treturn actions.reduce((a, b) => a.concat(b), []);\n\t\t});\n\t}\n}\n"]}