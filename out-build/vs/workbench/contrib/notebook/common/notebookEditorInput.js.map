{"version":3,"sources":["vs/workbench/contrib/notebook/common/notebookEditorInput.ts"],"names":[],"mappings":"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","file":"notebookEditorInput.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as glob from 'vs/base/common/glob';\nimport { GroupIdentifier, ISaveOptions, IMoveResult, IRevertOptions, EditorInputCapabilities, Verbosity, IUntypedEditorInput } from 'vs/workbench/common/editor';\nimport { EditorInput } from 'vs/workbench/common/editor/editorInput';\nimport { INotebookService, SimpleNotebookProviderInfo } from 'vs/workbench/contrib/notebook/common/notebookService';\nimport { URI } from 'vs/base/common/uri';\nimport { isEqual, joinPath } from 'vs/base/common/resources';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IFileDialogService } from 'vs/platform/dialogs/common/dialogs';\nimport { INotebookEditorModelResolverService } from 'vs/workbench/contrib/notebook/common/notebookEditorModelResolverService';\nimport { IDisposable, IReference } from 'vs/base/common/lifecycle';\nimport { CellEditType, IResolvedNotebookEditorModel } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { Schemas } from 'vs/base/common/network';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { AbstractResourceEditorInput } from 'vs/workbench/common/editor/resourceEditorInput';\nimport { IEditorOptions, IResourceEditorInput } from 'vs/platform/editor/common/editor';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { IWorkingCopyIdentifier } from 'vs/workbench/services/workingCopy/common/workingCopy';\nimport { NotebookProviderInfo } from 'vs/workbench/contrib/notebook/common/notebookProvider';\nimport { NotebookPerfMarks } from 'vs/workbench/contrib/notebook/common/notebookPerformance';\nimport { AutoSaveMode, IFilesConfigurationService } from 'vs/workbench/services/filesConfiguration/common/filesConfigurationService';\nimport { IExtensionService } from 'vs/workbench/services/extensions/common/extensions';\nimport { localize } from 'vs/nls';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { IMarkdownString } from 'vs/base/common/htmlContent';\n\nexport interface NotebookEditorInputOptions {\n\tstartDirty?: boolean;\n\t/**\n\t * backupId for webview\n\t */\n\t_backupId?: string;\n\t_workingCopy?: IWorkingCopyIdentifier;\n}\n\nexport class NotebookEditorInput extends AbstractResourceEditorInput {\n\n\tstatic create(instantiationService: IInstantiationService, resource: URI, viewType: string, options: NotebookEditorInputOptions = {}) {\n\t\treturn instantiationService.createInstance(NotebookEditorInput, resource, viewType, options);\n\t}\n\n\tstatic readonly ID: string = 'workbench.input.notebook';\n\n\tprivate _editorModelReference: IReference<IResolvedNotebookEditorModel> | null = null;\n\tprivate _sideLoadedListener: IDisposable;\n\tprivate _defaultDirtyState: boolean = false;\n\n\tconstructor(\n\t\tresource: URI,\n\t\tpublic readonly viewType: string,\n\t\tpublic readonly options: NotebookEditorInputOptions,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@INotebookEditorModelResolverService private readonly _notebookModelResolverService: INotebookEditorModelResolverService,\n\t\t@IFileDialogService private readonly _fileDialogService: IFileDialogService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IFilesConfigurationService filesConfigurationService: IFilesConfigurationService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IEditorService editorService: IEditorService\n\t) {\n\t\tsuper(resource, undefined, labelService, fileService, filesConfigurationService);\n\t\tthis._defaultDirtyState = !!options.startDirty;\n\n\t\t// Automatically resolve this input when the \"wanted\" model comes to life via\n\t\t// some other way. This happens only once per input and resolve disposes\n\t\t// this listener\n\t\tthis._sideLoadedListener = _notebookService.onDidAddNotebookDocument(e => {\n\t\t\tif (e.viewType === this.viewType && e.uri.toString() === this.resource.toString()) {\n\t\t\t\tthis.resolve().catch(onUnexpectedError);\n\t\t\t}\n\t\t});\n\n\t\tthis._register(extensionService.onWillStop(e => {\n\t\t\tif (!this.isDirty()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.veto((async () => {\n\t\t\t\tconst editors = editorService.findEditors(this);\n\t\t\t\tif (editors.length > 0) {\n\t\t\t\t\tconst result = await editorService.save(editors[0]);\n\t\t\t\t\tif (result.success) {\n\t\t\t\t\t\treturn false; // Don't Veto\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true; // Veto\n\t\t\t})(), localize('vetoExtHostRestart', \"Notebook '{0}' could not be saved.\", this.resource.path));\n\t\t}));\n\t}\n\n\toverride dispose() {\n\t\tthis._sideLoadedListener.dispose();\n\t\tthis._editorModelReference?.dispose();\n\t\tthis._editorModelReference = null;\n\t\tsuper.dispose();\n\t}\n\n\toverride get typeId(): string {\n\t\treturn NotebookEditorInput.ID;\n\t}\n\n\toverride get editorId(): string | undefined {\n\t\treturn this.viewType;\n\t}\n\n\toverride get capabilities(): EditorInputCapabilities {\n\t\tlet capabilities = EditorInputCapabilities.None;\n\n\t\tif (this.resource.scheme === Schemas.untitled) {\n\t\t\tcapabilities |= EditorInputCapabilities.Untitled;\n\t\t}\n\n\t\tif (this._editorModelReference) {\n\t\t\tif (this._editorModelReference.object.isReadonly()) {\n\t\t\t\tcapabilities |= EditorInputCapabilities.Readonly;\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.filesConfigurationService.isReadonly(this.resource)) {\n\t\t\t\tcapabilities |= EditorInputCapabilities.Readonly;\n\t\t\t}\n\t\t}\n\n\t\tif (!(capabilities & EditorInputCapabilities.Readonly)) {\n\t\t\tcapabilities |= EditorInputCapabilities.CanDropIntoEditor;\n\t\t}\n\n\t\treturn capabilities;\n\t}\n\n\toverride getDescription(verbosity = Verbosity.MEDIUM): string | undefined {\n\t\tif (!this.hasCapability(EditorInputCapabilities.Untitled) || this._editorModelReference?.object.hasAssociatedFilePath()) {\n\t\t\treturn super.getDescription(verbosity);\n\t\t}\n\n\t\treturn undefined; // no description for untitled notebooks without associated file path\n\t}\n\n\toverride isReadonly(): boolean | IMarkdownString {\n\t\tif (!this._editorModelReference) {\n\t\t\treturn this.filesConfigurationService.isReadonly(this.resource);\n\t\t}\n\t\treturn this._editorModelReference.object.isReadonly();\n\t}\n\n\toverride isDirty() {\n\t\tif (!this._editorModelReference) {\n\t\t\treturn this._defaultDirtyState;\n\t\t}\n\t\treturn this._editorModelReference.object.isDirty();\n\t}\n\n\toverride isSaving(): boolean {\n\t\tconst model = this._editorModelReference?.object;\n\t\tif (!model || !model.isDirty() || model.hasErrorState || this.hasCapability(EditorInputCapabilities.Untitled)) {\n\t\t\treturn false; // require the model to be dirty, file-backed and not in an error state\n\t\t}\n\n\t\t// if a short auto save is configured, treat this as being saved\n\t\treturn this.filesConfigurationService.getAutoSaveMode() === AutoSaveMode.AFTER_SHORT_DELAY;\n\t}\n\n\toverride async save(group: GroupIdentifier, options?: ISaveOptions): Promise<EditorInput | IUntypedEditorInput | undefined> {\n\t\tif (this._editorModelReference) {\n\n\t\t\tif (this.hasCapability(EditorInputCapabilities.Untitled)) {\n\t\t\t\treturn this.saveAs(group, options);\n\t\t\t} else {\n\t\t\t\tawait this._editorModelReference.object.save(options);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\toverride async saveAs(group: GroupIdentifier, options?: ISaveOptions): Promise<IUntypedEditorInput | undefined> {\n\t\tif (!this._editorModelReference) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst provider = this._notebookService.getContributedNotebookType(this.viewType);\n\n\t\tif (!provider) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst pathCandidate = this.hasCapability(EditorInputCapabilities.Untitled) ? await this._suggestName(provider, this.labelService.getUriBasenameLabel(this.resource)) : this._editorModelReference.object.resource;\n\t\tlet target: URI | undefined;\n\t\tif (this._editorModelReference.object.hasAssociatedFilePath()) {\n\t\t\ttarget = pathCandidate;\n\t\t} else {\n\t\t\ttarget = await this._fileDialogService.pickFileToSave(pathCandidate, options?.availableFileSystems);\n\t\t\tif (!target) {\n\t\t\t\treturn undefined; // save cancelled\n\t\t\t}\n\t\t}\n\n\t\tif (!provider.matches(target)) {\n\t\t\tconst patterns = provider.selectors.map(pattern => {\n\t\t\t\tif (typeof pattern === 'string') {\n\t\t\t\t\treturn pattern;\n\t\t\t\t}\n\n\t\t\t\tif (glob.isRelativePattern(pattern)) {\n\t\t\t\t\treturn `${pattern} (base ${pattern.base})`;\n\t\t\t\t}\n\n\t\t\t\tif (pattern.exclude) {\n\t\t\t\t\treturn `${pattern.include} (exclude: ${pattern.exclude})`;\n\t\t\t\t} else {\n\t\t\t\t\treturn `${pattern.include}`;\n\t\t\t\t}\n\n\t\t\t}).join(', ');\n\t\t\tthrow new Error(`File name ${target} is not supported by ${provider.providerDisplayName}.\\n\\nPlease make sure the file name matches following patterns:\\n${patterns}`);\n\t\t}\n\n\t\treturn await this._editorModelReference.object.saveAs(target);\n\t}\n\n\tprivate async _suggestName(provider: NotebookProviderInfo, suggestedFilename: string) {\n\t\t// guess file extensions\n\t\tconst firstSelector = provider.selectors[0];\n\t\tlet selectorStr = firstSelector && typeof firstSelector === 'string' ? firstSelector : undefined;\n\t\tif (!selectorStr && firstSelector) {\n\t\t\tconst include = (firstSelector as { include?: string }).include;\n\t\t\tif (typeof include === 'string') {\n\t\t\t\tselectorStr = include;\n\t\t\t}\n\t\t}\n\n\t\tif (selectorStr) {\n\t\t\tconst matches = /^\\*\\.([A-Za-z_-]*)$/.exec(selectorStr);\n\t\t\tif (matches && matches.length > 1) {\n\t\t\t\tconst fileExt = matches[1];\n\t\t\t\tif (!suggestedFilename.endsWith(fileExt)) {\n\t\t\t\t\treturn joinPath(await this._fileDialogService.defaultFilePath(), suggestedFilename + '.' + fileExt);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn joinPath(await this._fileDialogService.defaultFilePath(), suggestedFilename);\n\t}\n\n\t// called when users rename a notebook document\n\toverride async rename(group: GroupIdentifier, target: URI): Promise<IMoveResult | undefined> {\n\t\tif (this._editorModelReference) {\n\t\t\tconst contributedNotebookProviders = this._notebookService.getContributedNotebookTypes(target);\n\n\t\t\tif (contributedNotebookProviders.find(provider => provider.id === this._editorModelReference!.object.viewType)) {\n\t\t\t\treturn this._move(group, target);\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate _move(_group: GroupIdentifier, newResource: URI): { editor: EditorInput } {\n\t\tconst editorInput = NotebookEditorInput.create(this._instantiationService, newResource, this.viewType);\n\t\treturn { editor: editorInput };\n\t}\n\n\toverride async revert(_group: GroupIdentifier, options?: IRevertOptions): Promise<void> {\n\t\tif (this._editorModelReference && this._editorModelReference.object.isDirty()) {\n\t\t\tawait this._editorModelReference.object.revert(options);\n\t\t}\n\t}\n\n\toverride async resolve(_options?: IEditorOptions, perf?: NotebookPerfMarks): Promise<IResolvedNotebookEditorModel | null> {\n\t\tif (!await this._notebookService.canResolve(this.viewType)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tperf?.mark('extensionActivated');\n\n\t\t// we are now loading the notebook and don't need to listen to\n\t\t// \"other\" loading anymore\n\t\tthis._sideLoadedListener.dispose();\n\n\t\tif (!this._editorModelReference) {\n\t\t\tconst ref = await this._notebookModelResolverService.resolve(this.resource, this.viewType);\n\t\t\tif (this._editorModelReference) {\n\t\t\t\t// Re-entrant, double resolve happened. Dispose the addition references and proceed\n\t\t\t\t// with the truth.\n\t\t\t\tref.dispose();\n\t\t\t\treturn (<IReference<IResolvedNotebookEditorModel>>this._editorModelReference).object;\n\t\t\t}\n\t\t\tthis._editorModelReference = ref;\n\t\t\tif (this.isDisposed()) {\n\t\t\t\tthis._editorModelReference.dispose();\n\t\t\t\tthis._editorModelReference = null;\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tthis._register(this._editorModelReference.object.onDidChangeDirty(() => this._onDidChangeDirty.fire()));\n\t\t\tthis._register(this._editorModelReference.object.onDidChangeReadonly(() => this._onDidChangeCapabilities.fire()));\n\t\t\tthis._register(this._editorModelReference.object.onDidRevertUntitled(() => this.dispose()));\n\t\t\tif (this._editorModelReference.object.isDirty()) {\n\t\t\t\tthis._onDidChangeDirty.fire();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._editorModelReference.object.load();\n\t\t}\n\n\t\tif (this.options._backupId) {\n\t\t\tconst info = await this._notebookService.withNotebookDataProvider(this._editorModelReference.object.notebook.viewType);\n\t\t\tif (!(info instanceof SimpleNotebookProviderInfo)) {\n\t\t\t\tthrow new Error('CANNOT open file notebook with this provider');\n\t\t\t}\n\n\t\t\tconst data = await info.serializer.dataToNotebook(VSBuffer.fromString(JSON.stringify({ __webview_backup: this.options._backupId })));\n\t\t\tthis._editorModelReference.object.notebook.applyEdits([\n\t\t\t\t{\n\t\t\t\t\teditType: CellEditType.Replace,\n\t\t\t\t\tindex: 0,\n\t\t\t\t\tcount: this._editorModelReference.object.notebook.length,\n\t\t\t\t\tcells: data.cells\n\t\t\t\t}\n\t\t\t], true, undefined, () => undefined, undefined, false);\n\n\t\t\tif (this.options._workingCopy) {\n\t\t\t\tthis.options._backupId = undefined;\n\t\t\t\tthis.options._workingCopy = undefined;\n\t\t\t\tthis.options.startDirty = undefined;\n\t\t\t}\n\t\t}\n\n\t\treturn this._editorModelReference.object;\n\t}\n\n\toverride toUntyped(): IResourceEditorInput {\n\t\treturn {\n\t\t\tresource: this.preferredResource,\n\t\t\toptions: {\n\t\t\t\toverride: this.viewType\n\t\t\t}\n\t\t};\n\t}\n\n\toverride matches(otherInput: EditorInput | IUntypedEditorInput): boolean {\n\t\tif (super.matches(otherInput)) {\n\t\t\treturn true;\n\t\t}\n\t\tif (otherInput instanceof NotebookEditorInput) {\n\t\t\treturn this.viewType === otherInput.viewType && isEqual(this.resource, otherInput.resource);\n\t\t}\n\t\treturn false;\n\t}\n}\n\nexport interface ICompositeNotebookEditorInput {\n\treadonly editorInputs: NotebookEditorInput[];\n}\n\nexport function isCompositeNotebookEditorInput(thing: unknown): thing is ICompositeNotebookEditorInput {\n\treturn !!thing\n\t\t&& typeof thing === 'object'\n\t\t&& Array.isArray((<ICompositeNotebookEditorInput>thing).editorInputs)\n\t\t&& ((<ICompositeNotebookEditorInput>thing).editorInputs.every(input => input instanceof NotebookEditorInput));\n}\n"]}