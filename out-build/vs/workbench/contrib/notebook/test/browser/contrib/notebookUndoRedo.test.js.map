{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/notebook/test/browser/contrib/notebookUndoRedo.test.ts"],"names":[],"mappings":"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","file":"notebookUndoRedo.test.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { ILanguageService } from 'vs/editor/common/languages/language';\nimport { CellEditType, CellKind, SelectionStateType } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { createNotebookCellList, TestCell, withTestNotebook } from 'vs/workbench/contrib/notebook/test/browser/testNotebookEditor';\n\nsuite('Notebook Undo/Redo', () => {\n\ttest('Basics', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel, _ds, accessor) => {\n\t\t\t\tconst languageService = accessor.get(ILanguageService);\n\t\t\t\tassert.strictEqual(viewModel.length, 2);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 0);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '0_0,1;1,1');\n\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\tassert.strictEqual(viewModel.length, 0);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 1);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '1_');\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.strictEqual(viewModel.length, 2);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 2);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '0_0,1;1,1');\n\n\t\t\t\tawait viewModel.redo();\n\t\t\t\tassert.strictEqual(viewModel.length, 0);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 3);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '1_');\n\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 0, cells: [\n\t\t\t\t\t\tnew TestCell(viewModel.viewType, 3, '# header 2', 'markdown', CellKind.Code, [], languageService),\n\t\t\t\t\t]\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 4);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '4_2,1');\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 5);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '1_');\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Invalid replace count should not throw', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel, _ds, accessor) => {\n\t\t\t\tconst languageService = accessor.get(ILanguageService);\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\n\t\t\t\tassert.doesNotThrow(() => {\n\t\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: [\n\t\t\t\t\t\t\tnew TestCell(viewModel.viewType, 3, '# header 2', 'markdown', CellKind.Code, [], languageService),\n\t\t\t\t\t\t]\n\t\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Replace beyond length', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel) => {\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 1, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 1);\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 2);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Invalid replace count should not affect undo/redo', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel, _ds, accessor) => {\n\t\t\t\tconst languageService = accessor.get(ILanguageService);\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: [\n\t\t\t\t\t\tnew TestCell(viewModel.viewType, 3, '# header 2', 'markdown', CellKind.Code, [], languageService),\n\t\t\t\t\t]\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 1);\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tawait viewModel.undo();\n\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 2);\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 1, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 1);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Focus/selection update', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel, _ds, accessor) => {\n\t\t\t\tconst languageService = accessor.get(ILanguageService);\n\t\t\t\tconst cellList = createNotebookCellList(accessor, new DisposableStore());\n\t\t\t\tcellList.attachViewModel(viewModel);\n\t\t\t\tcellList.setFocus([1]);\n\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 2, count: 0, cells: [\n\t\t\t\t\t\tnew TestCell(viewModel.viewType, 3, '# header 2', 'markdown', CellKind.Code, [], languageService)\n\t\t\t\t\t]\n\t\t\t\t}], true, { focus: { start: 1, end: 2 }, selections: [{ start: 1, end: 2 }], kind: SelectionStateType.Index }, () => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfocus: { start: 2, end: 3 }, selections: [{ start: 2, end: 3 }], kind: SelectionStateType.Index\n\t\t\t\t\t};\n\t\t\t\t}, undefined, true);\n\t\t\t\tassert.strictEqual(viewModel.length, 3);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 1);\n\t\t\t\tassert.deepStrictEqual(cellList.getFocus(), [2]);\n\t\t\t\tassert.deepStrictEqual(cellList.getSelection(), [2]);\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.strictEqual(viewModel.length, 2);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 2);\n\t\t\t\tassert.deepStrictEqual(cellList.getFocus(), [1]);\n\t\t\t\tassert.deepStrictEqual(cellList.getSelection(), [1]);\n\n\t\t\t\tawait viewModel.redo();\n\t\t\t\tassert.strictEqual(viewModel.length, 3);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 3);\n\t\t\t\tassert.deepStrictEqual(cellList.getFocus(), [2]);\n\t\t\t\tassert.deepStrictEqual(cellList.getSelection(), [2]);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Batch edits', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel, _ds, accessor) => {\n\t\t\t\tconst languageService = accessor.get(ILanguageService);\n\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 2, count: 0, cells: [\n\t\t\t\t\t\tnew TestCell(viewModel.viewType, 3, '# header 2', 'markdown', CellKind.Code, [], languageService)\n\t\t\t\t\t]\n\t\t\t\t}, {\n\t\t\t\t\teditType: CellEditType.Metadata, index: 0, metadata: { inputCollapsed: false }\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 1);\n\t\t\t\tassert.deepStrictEqual(viewModel.cellAt(0)?.metadata, { inputCollapsed: false });\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.strictEqual(viewModel.length, 2);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 2);\n\t\t\t\tassert.deepStrictEqual(viewModel.cellAt(0)?.metadata, {});\n\n\t\t\t\tawait viewModel.redo();\n\t\t\t\tassert.strictEqual(viewModel.length, 3);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 3);\n\t\t\t\tassert.deepStrictEqual(viewModel.cellAt(0)?.metadata, { inputCollapsed: false });\n\n\t\t\t}\n\t\t);\n\t});\n});\n"]}