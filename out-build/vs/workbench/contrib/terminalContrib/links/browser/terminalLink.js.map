{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/terminalContrib/links/browser/terminalLink.ts"],"names":[],"mappings":"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","file":"terminalLink.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { IViewportRange, IBufferRange, ILink, ILinkDecorations, Terminal } from 'xterm';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport * as dom from 'vs/base/browser/dom';\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport { convertBufferRangeToViewport } from 'vs/workbench/contrib/terminalContrib/links/browser/terminalLinkHelpers';\nimport { isMacintosh } from 'vs/base/common/platform';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { TerminalLinkType } from 'vs/workbench/contrib/terminalContrib/links/browser/links';\nimport { IHoverAction } from 'vs/workbench/services/hover/browser/hover';\n\nexport class TerminalLink extends DisposableStore implements ILink {\n\tdecorations: ILinkDecorations;\n\tasyncActivate: Promise<void> | undefined;\n\n\tprivate _tooltipScheduler: RunOnceScheduler | undefined;\n\tprivate _hoverListeners: DisposableStore | undefined;\n\n\tprivate readonly _onInvalidated = new Emitter<void>();\n\tget onInvalidated(): Event<void> { return this._onInvalidated.event; }\n\n\tget type(): TerminalLinkType { return this._type; }\n\n\tconstructor(\n\t\tprivate readonly _xterm: Terminal,\n\t\treadonly range: IBufferRange,\n\t\treadonly text: string,\n\t\treadonly actions: IHoverAction[] | undefined,\n\t\tprivate readonly _viewportY: number,\n\t\tprivate readonly _activateCallback: (event: MouseEvent | undefined, uri: string) => Promise<void>,\n\t\tprivate readonly _tooltipCallback: (link: TerminalLink, viewportRange: IViewportRange, modifierDownCallback?: () => void, modifierUpCallback?: () => void) => void,\n\t\tprivate readonly _isHighConfidenceLink: boolean,\n\t\treadonly label: string | undefined,\n\t\tprivate readonly _type: TerminalLinkType,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\t\tthis.decorations = {\n\t\t\tpointerCursor: false,\n\t\t\tunderline: this._isHighConfidenceLink\n\t\t};\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._hoverListeners?.dispose();\n\t\tthis._hoverListeners = undefined;\n\t\tthis._tooltipScheduler?.dispose();\n\t\tthis._tooltipScheduler = undefined;\n\t}\n\n\tactivate(event: MouseEvent | undefined, text: string): void {\n\t\t// Trigger the xterm.js callback synchronously but track the promise resolution so we can\n\t\t// use it in tests\n\t\tthis.asyncActivate = this._activateCallback(event, text);\n\t}\n\n\thover(event: MouseEvent, text: string): void {\n\t\t// Listen for modifier before handing it off to the hover to handle so it gets disposed correctly\n\t\tthis._hoverListeners = new DisposableStore();\n\t\tthis._hoverListeners.add(dom.addDisposableListener(document, 'keydown', e => {\n\t\t\tif (!e.repeat && this._isModifierDown(e)) {\n\t\t\t\tthis._enableDecorations();\n\t\t\t}\n\t\t}));\n\t\tthis._hoverListeners.add(dom.addDisposableListener(document, 'keyup', e => {\n\t\t\tif (!e.repeat && !this._isModifierDown(e)) {\n\t\t\t\tthis._disableDecorations();\n\t\t\t}\n\t\t}));\n\n\t\t// Listen for when the terminal renders on the same line as the link\n\t\tthis._hoverListeners.add(this._xterm.onRender(e => {\n\t\t\tconst viewportRangeY = this.range.start.y - this._viewportY;\n\t\t\tif (viewportRangeY >= e.start && viewportRangeY <= e.end) {\n\t\t\t\tthis._onInvalidated.fire();\n\t\t\t}\n\t\t}));\n\n\t\t// Only show the tooltip and highlight for high confidence links (not word/search workspace\n\t\t// links). Feedback was that this makes using the terminal overly noisy.\n\t\tif (this._isHighConfidenceLink) {\n\t\t\tthis._tooltipScheduler = new RunOnceScheduler(() => {\n\t\t\t\tthis._tooltipCallback(\n\t\t\t\t\tthis,\n\t\t\t\t\tconvertBufferRangeToViewport(this.range, this._viewportY),\n\t\t\t\t\tthis._isHighConfidenceLink ? () => this._enableDecorations() : undefined,\n\t\t\t\t\tthis._isHighConfidenceLink ? () => this._disableDecorations() : undefined\n\t\t\t\t);\n\t\t\t\t// Clear out scheduler until next hover event\n\t\t\t\tthis._tooltipScheduler?.dispose();\n\t\t\t\tthis._tooltipScheduler = undefined;\n\t\t\t}, this._configurationService.getValue('workbench.hover.delay'));\n\t\t\tthis.add(this._tooltipScheduler);\n\t\t\tthis._tooltipScheduler.schedule();\n\t\t}\n\n\t\tconst origin = { x: event.pageX, y: event.pageY };\n\t\tthis._hoverListeners.add(dom.addDisposableListener(document, dom.EventType.MOUSE_MOVE, e => {\n\t\t\t// Update decorations\n\t\t\tif (this._isModifierDown(e)) {\n\t\t\t\tthis._enableDecorations();\n\t\t\t} else {\n\t\t\t\tthis._disableDecorations();\n\t\t\t}\n\n\t\t\t// Reset the scheduler if the mouse moves too much\n\t\t\tif (Math.abs(e.pageX - origin.x) > window.devicePixelRatio * 2 || Math.abs(e.pageY - origin.y) > window.devicePixelRatio * 2) {\n\t\t\t\torigin.x = e.pageX;\n\t\t\t\torigin.y = e.pageY;\n\t\t\t\tthis._tooltipScheduler?.schedule();\n\t\t\t}\n\t\t}));\n\t}\n\n\tleave(): void {\n\t\tthis._hoverListeners?.dispose();\n\t\tthis._hoverListeners = undefined;\n\t\tthis._tooltipScheduler?.dispose();\n\t\tthis._tooltipScheduler = undefined;\n\t}\n\n\tprivate _enableDecorations(): void {\n\t\tif (!this.decorations.pointerCursor) {\n\t\t\tthis.decorations.pointerCursor = true;\n\t\t}\n\t\tif (!this.decorations.underline) {\n\t\t\tthis.decorations.underline = true;\n\t\t}\n\t}\n\n\tprivate _disableDecorations(): void {\n\t\tif (this.decorations.pointerCursor) {\n\t\t\tthis.decorations.pointerCursor = false;\n\t\t}\n\t\tif (this.decorations.underline !== this._isHighConfidenceLink) {\n\t\t\tthis.decorations.underline = this._isHighConfidenceLink;\n\t\t}\n\t}\n\n\tprivate _isModifierDown(event: MouseEvent | KeyboardEvent): boolean {\n\t\tconst multiCursorModifier = this._configurationService.getValue<'ctrlCmd' | 'alt'>('editor.multiCursorModifier');\n\t\tif (multiCursorModifier === 'ctrlCmd') {\n\t\t\treturn !!event.altKey;\n\t\t}\n\t\treturn isMacintosh ? event.metaKey : event.ctrlKey;\n\t}\n}\n"]}