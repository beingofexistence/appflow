{"version":3,"sources":["vs/workbench/contrib/terminal/browser/terminalConfigHelper.ts"],"names":[],"mappings":"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","file":"terminalConfigHelper.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport { EDITOR_FONT_DEFAULTS, IEditorOptions } from 'vs/editor/common/config/editorOptions';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { ITerminalConfiguration, TERMINAL_CONFIG_SECTION, DEFAULT_LETTER_SPACING, DEFAULT_LINE_HEIGHT, MINIMUM_LETTER_SPACING, MINIMUM_FONT_WEIGHT, MAXIMUM_FONT_WEIGHT, DEFAULT_FONT_WEIGHT, DEFAULT_BOLD_FONT_WEIGHT, FontWeight, ITerminalFont } from 'vs/workbench/contrib/terminal/common/terminal';\nimport Severity from 'vs/base/common/severity';\nimport { INotificationService, NeverShowAgainScope } from 'vs/platform/notification/common/notification';\nimport { IBrowserTerminalConfigHelper, LinuxDistro } from 'vs/workbench/contrib/terminal/browser/terminal';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { basename } from 'vs/base/common/path';\nimport { IExtensionManagementService } from 'vs/platform/extensionManagement/common/extensionManagement';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { InstallRecommendedExtensionAction } from 'vs/workbench/contrib/extensions/browser/extensionsActions';\nimport { IProductService } from 'vs/platform/product/common/productService';\nimport { IXtermCore } from 'vs/workbench/contrib/terminal/browser/xterm-private';\nimport { IShellLaunchConfig } from 'vs/platform/terminal/common/terminal';\nimport { isLinux, isWindows } from 'vs/base/common/platform';\nimport { Disposable } from 'vs/base/common/lifecycle';\n\nconst enum FontConstants {\n\tMinimumFontSize = 6,\n\tMaximumFontSize = 100,\n}\n\n/**\n * Encapsulates terminal configuration logic, the primary purpose of this file is so that platform\n * specific test cases can be written.\n */\nexport class TerminalConfigHelper extends Disposable implements IBrowserTerminalConfigHelper {\n\tpanelContainer: HTMLElement | undefined;\n\n\tprivate _charMeasureElement: HTMLElement | undefined;\n\tprivate _lastFontMeasurement: ITerminalFont | undefined;\n\tprotected _linuxDistro: LinuxDistro = LinuxDistro.Unknown;\n\tconfig!: ITerminalConfiguration;\n\n\tprivate readonly _onConfigChanged = this._register(new Emitter<void>());\n\tget onConfigChanged(): Event<void> { return this._onConfigChanged.event; }\n\n\tconstructor(\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IExtensionManagementService private readonly _extensionManagementService: IExtensionManagementService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IProductService private readonly _productService: IProductService,\n\t) {\n\t\tsuper();\n\t\tthis._updateConfig();\n\t\tthis._register(this._configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(TERMINAL_CONFIG_SECTION)) {\n\t\t\t\tthis._updateConfig();\n\t\t\t}\n\t\t}));\n\t\tif (isLinux) {\n\t\t\tif (navigator.userAgent.includes('Ubuntu')) {\n\t\t\t\tthis._linuxDistro = LinuxDistro.Ubuntu;\n\t\t\t} else if (navigator.userAgent.includes('Fedora')) {\n\t\t\t\tthis._linuxDistro = LinuxDistro.Fedora;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _updateConfig(): void {\n\t\tconst configValues = this._configurationService.getValue<ITerminalConfiguration>(TERMINAL_CONFIG_SECTION);\n\t\tconfigValues.fontWeight = this._normalizeFontWeight(configValues.fontWeight, DEFAULT_FONT_WEIGHT);\n\t\tconfigValues.fontWeightBold = this._normalizeFontWeight(configValues.fontWeightBold, DEFAULT_BOLD_FONT_WEIGHT);\n\n\t\tthis.config = configValues;\n\t\tthis._onConfigChanged.fire();\n\t}\n\n\tconfigFontIsMonospace(): boolean {\n\t\tconst fontSize = 15;\n\t\tconst fontFamily = this.config.fontFamily || this._configurationService.getValue<IEditorOptions>('editor').fontFamily || EDITOR_FONT_DEFAULTS.fontFamily;\n\t\tconst iRect = this._getBoundingRectFor('i', fontFamily, fontSize);\n\t\tconst wRect = this._getBoundingRectFor('w', fontFamily, fontSize);\n\n\t\t// Check for invalid bounds, there is no reason to believe the font is not monospace\n\t\tif (!iRect || !wRect || !iRect.width || !wRect.width) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn iRect.width === wRect.width;\n\t}\n\n\tprivate _createCharMeasureElementIfNecessary(): HTMLElement {\n\t\tif (!this.panelContainer) {\n\t\t\tthrow new Error('Cannot measure element when terminal is not attached');\n\t\t}\n\t\t// Create charMeasureElement if it hasn't been created or if it was orphaned by its parent\n\t\tif (!this._charMeasureElement || !this._charMeasureElement.parentElement) {\n\t\t\tthis._charMeasureElement = document.createElement('div');\n\t\t\tthis.panelContainer.appendChild(this._charMeasureElement);\n\t\t}\n\t\treturn this._charMeasureElement;\n\t}\n\n\tprivate _getBoundingRectFor(char: string, fontFamily: string, fontSize: number): ClientRect | DOMRect | undefined {\n\t\tlet charMeasureElement: HTMLElement;\n\t\ttry {\n\t\t\tcharMeasureElement = this._createCharMeasureElementIfNecessary();\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst style = charMeasureElement.style;\n\t\tstyle.display = 'inline-block';\n\t\tstyle.fontFamily = fontFamily;\n\t\tstyle.fontSize = fontSize + 'px';\n\t\tstyle.lineHeight = 'normal';\n\t\tcharMeasureElement.innerText = char;\n\t\tconst rect = charMeasureElement.getBoundingClientRect();\n\t\tstyle.display = 'none';\n\n\t\treturn rect;\n\t}\n\n\tprivate _measureFont(fontFamily: string, fontSize: number, letterSpacing: number, lineHeight: number): ITerminalFont {\n\t\tconst rect = this._getBoundingRectFor('X', fontFamily, fontSize);\n\n\t\t// Bounding client rect was invalid, use last font measurement if available.\n\t\tif (this._lastFontMeasurement && (!rect || !rect.width || !rect.height)) {\n\t\t\treturn this._lastFontMeasurement;\n\t\t}\n\n\t\tthis._lastFontMeasurement = {\n\t\t\tfontFamily,\n\t\t\tfontSize,\n\t\t\tletterSpacing,\n\t\t\tlineHeight,\n\t\t\tcharWidth: 0,\n\t\t\tcharHeight: 0\n\t\t};\n\n\t\tif (rect && rect.width && rect.height) {\n\t\t\tthis._lastFontMeasurement.charHeight = Math.ceil(rect.height);\n\t\t\t// Char width is calculated differently for DOM and the other renderer types. Refer to\n\t\t\t// how each renderer updates their dimensions in xterm.js\n\t\t\tif (this.config.gpuAcceleration === 'off') {\n\t\t\t\tthis._lastFontMeasurement.charWidth = rect.width;\n\t\t\t} else {\n\t\t\t\tconst deviceCharWidth = Math.floor(rect.width * window.devicePixelRatio);\n\t\t\t\tconst deviceCellWidth = deviceCharWidth + Math.round(letterSpacing);\n\t\t\t\tconst cssCellWidth = deviceCellWidth / window.devicePixelRatio;\n\t\t\t\tthis._lastFontMeasurement.charWidth = cssCellWidth - Math.round(letterSpacing) / window.devicePixelRatio;\n\t\t\t}\n\t\t}\n\n\t\treturn this._lastFontMeasurement;\n\t}\n\n\t/**\n\t * Gets the font information based on the terminal.integrated.fontFamily\n\t * terminal.integrated.fontSize, terminal.integrated.lineHeight configuration properties\n\t */\n\tgetFont(xtermCore?: IXtermCore, excludeDimensions?: boolean): ITerminalFont {\n\t\tconst editorConfig = this._configurationService.getValue<IEditorOptions>('editor');\n\n\t\tlet fontFamily = this.config.fontFamily || editorConfig.fontFamily || EDITOR_FONT_DEFAULTS.fontFamily;\n\t\tlet fontSize = this._clampInt(this.config.fontSize, FontConstants.MinimumFontSize, FontConstants.MaximumFontSize, EDITOR_FONT_DEFAULTS.fontSize);\n\n\t\t// Work around bad font on Fedora/Ubuntu\n\t\tif (!this.config.fontFamily) {\n\t\t\tif (this._linuxDistro === LinuxDistro.Fedora) {\n\t\t\t\tfontFamily = '\\'DejaVu Sans Mono\\'';\n\t\t\t}\n\t\t\tif (this._linuxDistro === LinuxDistro.Ubuntu) {\n\t\t\t\tfontFamily = '\\'Ubuntu Mono\\'';\n\n\t\t\t\t// Ubuntu mono is somehow smaller, so set fontSize a bit larger to get the same perceived size.\n\t\t\t\tfontSize = this._clampInt(fontSize + 2, FontConstants.MinimumFontSize, FontConstants.MaximumFontSize, EDITOR_FONT_DEFAULTS.fontSize);\n\t\t\t}\n\t\t}\n\n\t\t// Always fallback to monospace, otherwise a proportional font may become the default\n\t\tfontFamily += ', monospace';\n\n\t\tconst letterSpacing = this.config.letterSpacing ? Math.max(Math.floor(this.config.letterSpacing), MINIMUM_LETTER_SPACING) : DEFAULT_LETTER_SPACING;\n\t\tconst lineHeight = this.config.lineHeight ? Math.max(this.config.lineHeight, 1) : DEFAULT_LINE_HEIGHT;\n\n\t\tif (excludeDimensions) {\n\t\t\treturn {\n\t\t\t\tfontFamily,\n\t\t\t\tfontSize,\n\t\t\t\tletterSpacing,\n\t\t\t\tlineHeight\n\t\t\t};\n\t\t}\n\n\t\t// Get the character dimensions from xterm if it's available\n\t\tif (xtermCore) {\n\t\t\tif (xtermCore._renderService && xtermCore._renderService.dimensions?.css.cell.width && xtermCore._renderService.dimensions?.css.cell.height) {\n\t\t\t\treturn {\n\t\t\t\t\tfontFamily,\n\t\t\t\t\tfontSize,\n\t\t\t\t\tletterSpacing,\n\t\t\t\t\tlineHeight,\n\t\t\t\t\tcharHeight: xtermCore._renderService.dimensions.css.cell.height / lineHeight,\n\t\t\t\t\tcharWidth: xtermCore._renderService.dimensions.css.cell.width - Math.round(letterSpacing) / window.devicePixelRatio\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// Fall back to measuring the font ourselves\n\t\treturn this._measureFont(fontFamily, fontSize, letterSpacing, lineHeight);\n\t}\n\n\tprivate _clampInt<T>(source: any, minimum: number, maximum: number, fallback: T): number | T {\n\t\tlet r = parseInt(source, 10);\n\t\tif (isNaN(r)) {\n\t\t\treturn fallback;\n\t\t}\n\t\tif (typeof minimum === 'number') {\n\t\t\tr = Math.max(minimum, r);\n\t\t}\n\t\tif (typeof maximum === 'number') {\n\t\t\tr = Math.min(maximum, r);\n\t\t}\n\t\treturn r;\n\t}\n\n\tprivate _recommendationsShown = false;\n\n\tasync showRecommendations(shellLaunchConfig: IShellLaunchConfig): Promise<void> {\n\t\tif (this._recommendationsShown) {\n\t\t\treturn;\n\t\t}\n\t\tthis._recommendationsShown = true;\n\n\t\tif (isWindows && shellLaunchConfig.executable && basename(shellLaunchConfig.executable).toLowerCase() === 'wsl.exe') {\n\t\t\tconst exeBasedExtensionTips = this._productService.exeBasedExtensionTips;\n\t\t\tif (!exeBasedExtensionTips || !exeBasedExtensionTips.wsl) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst extId = Object.keys(exeBasedExtensionTips.wsl.recommendations).find(extId => exeBasedExtensionTips.wsl.recommendations[extId].important);\n\t\t\tif (extId && ! await this._isExtensionInstalled(extId)) {\n\t\t\t\tthis._notificationService.prompt(\n\t\t\t\t\tSeverity.Info,\n\t\t\t\t\tnls.localize(\n\t\t\t\t\t\t'useWslExtension.title', \"The '{0}' extension is recommended for opening a terminal in WSL.\", exeBasedExtensionTips.wsl.friendlyName),\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: nls.localize('install', 'Install'),\n\t\t\t\t\t\t\trun: () => {\n\t\t\t\t\t\t\t\tthis._instantiationService.createInstance(InstallRecommendedExtensionAction, extId).run();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t{\n\t\t\t\t\t\tsticky: true,\n\t\t\t\t\t\tneverShowAgain: { id: 'terminalConfigHelper/launchRecommendationsIgnore', scope: NeverShowAgainScope.APPLICATION },\n\t\t\t\t\t\tonCancel: () => { }\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _isExtensionInstalled(id: string): Promise<boolean> {\n\t\tconst extensions = await this._extensionManagementService.getInstalled();\n\t\treturn extensions.some(e => e.identifier.id === id);\n\t}\n\n\tprivate _normalizeFontWeight(input: any, defaultWeight: FontWeight): FontWeight {\n\t\tif (input === 'normal' || input === 'bold') {\n\t\t\treturn input;\n\t\t}\n\t\treturn this._clampInt(input, MINIMUM_FONT_WEIGHT, MAXIMUM_FONT_WEIGHT, defaultWeight);\n\t}\n}\n"]}