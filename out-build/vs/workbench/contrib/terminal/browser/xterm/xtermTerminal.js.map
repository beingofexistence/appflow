{"version":3,"sources":["vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts"],"names":[],"mappings":"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","file":"xtermTerminal.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { IBuffer, ITerminalOptions, ITheme, Terminal as RawXtermTerminal, LogLevel as XtermLogLevel } from 'xterm';\nimport type { CanvasAddon as CanvasAddonType } from 'xterm-addon-canvas';\nimport type { ISearchOptions, SearchAddon as SearchAddonType } from 'xterm-addon-search';\nimport type { Unicode11Addon as Unicode11AddonType } from 'xterm-addon-unicode11';\nimport type { WebglAddon as WebglAddonType } from 'xterm-addon-webgl';\nimport type { SerializeAddon as SerializeAddonType } from 'xterm-addon-serialize';\nimport type { ImageAddon as ImageAddonType } from 'xterm-addon-image';\nimport * as dom from 'vs/base/browser/dom';\nimport { IXtermCore } from 'vs/workbench/contrib/terminal/browser/xterm-private';\nimport { ConfigurationTarget, IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { TerminalConfigHelper } from 'vs/workbench/contrib/terminal/browser/terminalConfigHelper';\nimport { Disposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { IEditorOptions } from 'vs/editor/common/config/editorOptions';\nimport { IShellIntegration, ITerminalLogService, TerminalSettingId } from 'vs/platform/terminal/common/terminal';\nimport { ITerminalFont, ITerminalConfiguration } from 'vs/workbench/contrib/terminal/common/terminal';\nimport { isSafari } from 'vs/base/browser/browser';\nimport { IMarkTracker, IInternalXtermTerminal, IXtermTerminal, ISuggestController, IXtermColorProvider, XtermTerminalConstants, IXtermAttachToElementOptions, IDetachedXtermTerminal } from 'vs/workbench/contrib/terminal/browser/terminal';\nimport { LogLevel } from 'vs/platform/log/common/log';\nimport { IStorageService, StorageScope, StorageTarget } from 'vs/platform/storage/common/storage';\nimport { TerminalStorageKeys } from 'vs/workbench/contrib/terminal/common/terminalStorageKeys';\nimport { INotificationService, IPromptChoice, Severity } from 'vs/platform/notification/common/notification';\nimport { MarkNavigationAddon } from 'vs/workbench/contrib/terminal/browser/xterm/markNavigationAddon';\nimport { localize } from 'vs/nls';\nimport { IColorTheme, IThemeService } from 'vs/platform/theme/common/themeService';\nimport { PANEL_BACKGROUND } from 'vs/workbench/common/theme';\nimport { TERMINAL_FOREGROUND_COLOR, TERMINAL_BACKGROUND_COLOR, TERMINAL_CURSOR_FOREGROUND_COLOR, TERMINAL_CURSOR_BACKGROUND_COLOR, ansiColorIdentifiers, TERMINAL_SELECTION_BACKGROUND_COLOR, TERMINAL_FIND_MATCH_BACKGROUND_COLOR, TERMINAL_FIND_MATCH_HIGHLIGHT_BACKGROUND_COLOR, TERMINAL_FIND_MATCH_BORDER_COLOR, TERMINAL_OVERVIEW_RULER_FIND_MATCH_FOREGROUND_COLOR, TERMINAL_FIND_MATCH_HIGHLIGHT_BORDER_COLOR, TERMINAL_OVERVIEW_RULER_CURSOR_FOREGROUND_COLOR, TERMINAL_SELECTION_FOREGROUND_COLOR, TERMINAL_INACTIVE_SELECTION_BACKGROUND_COLOR } from 'vs/workbench/contrib/terminal/common/terminalColorRegistry';\nimport { ShellIntegrationAddon } from 'vs/platform/terminal/common/xterm/shellIntegrationAddon';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { DecorationAddon } from 'vs/workbench/contrib/terminal/browser/xterm/decorationAddon';\nimport { ITerminalCapabilityStore, ITerminalCommand, TerminalCapability } from 'vs/platform/terminal/common/capabilities/capabilities';\nimport { Emitter } from 'vs/base/common/event';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { importAMDNodeModule } from 'vs/amdX';\nimport { SuggestAddon } from 'vs/workbench/contrib/terminal/browser/xterm/suggestAddon';\nimport { IContextKey, IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { TerminalContextKeys } from 'vs/workbench/contrib/terminal/common/terminalContextKey';\nimport { IClipboardService } from 'vs/platform/clipboard/common/clipboardService';\nimport { debounce } from 'vs/base/common/decorators';\nimport { MouseWheelClassifier } from 'vs/base/browser/ui/scrollbar/scrollableElement';\nimport { IMouseWheelEvent, StandardWheelEvent } from 'vs/base/browser/mouseEvent';\n\nconst enum RenderConstants {\n\t/**\n\t * How long in milliseconds should an average frame take to render for a notification to appear\n\t * which suggests the fallback DOM-based renderer.\n\t */\n\tSlowCanvasRenderThreshold = 50,\n\tNumberOfFramestoMeasure = 20,\n\tSmoothScrollDuration = 125\n}\n\nlet CanvasAddon: typeof CanvasAddonType;\nlet ImageAddon: typeof ImageAddonType;\nlet SearchAddon: typeof SearchAddonType;\nlet SerializeAddon: typeof SerializeAddonType;\nlet Unicode11Addon: typeof Unicode11AddonType;\nlet WebglAddon: typeof WebglAddonType;\n\nfunction getFullBufferLineAsString(lineIndex: number, buffer: IBuffer): { lineData: string | undefined; lineIndex: number } {\n\tlet line = buffer.getLine(lineIndex);\n\tif (!line) {\n\t\treturn { lineData: undefined, lineIndex };\n\t}\n\tlet lineData = line.translateToString(true);\n\twhile (lineIndex > 0 && line.isWrapped) {\n\t\tline = buffer.getLine(--lineIndex);\n\t\tif (!line) {\n\t\t\tbreak;\n\t\t}\n\t\tlineData = line.translateToString(false) + lineData;\n\t}\n\treturn { lineData, lineIndex };\n}\n\n\n// DEBUG: This helper can be used to draw image data to the console, it's commented out as we don't\n//        want to ship it, but this is very useful for investigating texture atlas issues.\n// (console as any).image = (source: ImageData | HTMLCanvasElement, scale: number = 1) => {\n// \tfunction getBox(width: number, height: number) {\n// \t\treturn {\n// \t\t\tstring: '+',\n// \t\t\tstyle: 'font-size: 1px; padding: ' + Math.floor(height/2) + 'px ' + Math.floor(width/2) + 'px; line-height: ' + height + 'px;'\n// \t\t};\n// \t}\n// \tif (source instanceof HTMLCanvasElement) {\n// \t\tsource = source.getContext('2d')?.getImageData(0, 0, source.width, source.height)!;\n// \t}\n// \tconst canvas = document.createElement('canvas');\n// \tcanvas.width = source.width;\n// \tcanvas.height = source.height;\n// \tconst ctx = canvas.getContext('2d')!;\n// \tctx.putImageData(source, 0, 0);\n\n// \tconst sw = source.width * scale;\n// \tconst sh = source.height * scale;\n// \tconst dim = getBox(sw, sh);\n// \tconsole.log(\n// \t\t`Image: ${source.width} x ${source.height}\\n%c${dim.string}`,\n// \t\t`${dim.style}background: url(${canvas.toDataURL()}); background-size: ${sw}px ${sh}px; background-repeat: no-repeat; color: transparent;`\n// \t);\n// \tconsole.groupCollapsed('Zoomed');\n// \tconsole.log(\n// \t\t`%c${dim.string}`,\n// \t\t`${getBox(sw * 10, sh * 10).style}background: url(${canvas.toDataURL()}); background-size: ${sw * 10}px ${sh * 10}px; background-repeat: no-repeat; color: transparent; image-rendering: pixelated;-ms-interpolation-mode: nearest-neighbor;`\n// \t);\n// \tconsole.groupEnd();\n// };\n\n/**\n * Wraps the xterm object with additional functionality. Interaction with the backing process is out\n * of the scope of this class.\n */\nexport class XtermTerminal extends Disposable implements IXtermTerminal, IDetachedXtermTerminal, IInternalXtermTerminal {\n\t/** The raw xterm.js instance */\n\treadonly raw: RawXtermTerminal;\n\tprivate _core: IXtermCore;\n\tprivate static _suggestedRendererType: 'canvas' | 'dom' | undefined = undefined;\n\tprivate static _checkedWebglCompatible = false;\n\tprivate _attached?: { container: HTMLElement; options: IXtermAttachToElementOptions };\n\tprivate _isPhysicalMouseWheel = MouseWheelClassifier.INSTANCE.isPhysicalMouseWheel();\n\n\t// Always on addons\n\tprivate _markNavigationAddon: MarkNavigationAddon;\n\tprivate _shellIntegrationAddon: ShellIntegrationAddon;\n\tprivate _decorationAddon: DecorationAddon;\n\n\t// Optional addons\n\tprivate _suggestAddon?: SuggestAddon;\n\tprivate _canvasAddon?: CanvasAddonType;\n\tprivate _searchAddon?: SearchAddonType;\n\tprivate _unicode11Addon?: Unicode11AddonType;\n\tprivate _webglAddon?: WebglAddonType;\n\tprivate _serializeAddon?: SerializeAddonType;\n\tprivate _imageAddon?: ImageAddonType;\n\n\tprivate readonly _attachedDisposables = this._register(new DisposableStore());\n\tprivate readonly _anyTerminalFocusContextKey: IContextKey<boolean>;\n\tprivate readonly _anyFocusedTerminalHasSelection: IContextKey<boolean>;\n\n\tprivate _lastFindResult: { resultIndex: number; resultCount: number } | undefined;\n\tget findResult(): { resultIndex: number; resultCount: number } | undefined { return this._lastFindResult; }\n\n\tget isStdinDisabled(): boolean { return !!this.raw.options.disableStdin; }\n\n\tprivate readonly _onDidRequestRunCommand = this._register(new Emitter<{ command: ITerminalCommand; copyAsHtml?: boolean; noNewLine?: boolean }>());\n\treadonly onDidRequestRunCommand = this._onDidRequestRunCommand.event;\n\tprivate readonly _onDidRequestFocus = this._register(new Emitter<void>());\n\treadonly onDidRequestFocus = this._onDidRequestFocus.event;\n\tprivate readonly _onDidRequestSendText = this._register(new Emitter<string>());\n\treadonly onDidRequestSendText = this._onDidRequestSendText.event;\n\tprivate readonly _onDidRequestFreePort = this._register(new Emitter<string>());\n\treadonly onDidRequestFreePort = this._onDidRequestFreePort.event;\n\tprivate readonly _onDidChangeFindResults = this._register(new Emitter<{ resultIndex: number; resultCount: number }>());\n\treadonly onDidChangeFindResults = this._onDidChangeFindResults.event;\n\tprivate readonly _onDidChangeSelection = this._register(new Emitter<void>());\n\treadonly onDidChangeSelection = this._onDidChangeSelection.event;\n\tprivate readonly _onDidChangeFocus = this._register(new Emitter<boolean>());\n\treadonly onDidChangeFocus = this._onDidChangeFocus.event;\n\tprivate readonly _onDidDispose = this._register(new Emitter<void>());\n\treadonly onDidDispose = this._onDidDispose.event;\n\n\tget markTracker(): IMarkTracker { return this._markNavigationAddon; }\n\tget shellIntegration(): IShellIntegration { return this._shellIntegrationAddon; }\n\tget suggestController(): ISuggestController | undefined { return this._suggestAddon; }\n\n\tget textureAtlas(): Promise<ImageBitmap> | undefined {\n\t\tconst canvas = this._webglAddon?.textureAtlas || this._canvasAddon?.textureAtlas;\n\t\tif (!canvas) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn createImageBitmap(canvas);\n\t}\n\n\tpublic get isFocused() {\n\t\treturn !!this.raw.element?.contains(document.activeElement);\n\t}\n\n\t/**\n\t * @param xtermCtor The xterm.js constructor, this is passed in so it can be fetched lazily\n\t * outside of this class such that {@link raw} is not nullable.\n\t */\n\tconstructor(\n\t\txtermCtor: typeof RawXtermTerminal,\n\t\tprivate readonly _configHelper: TerminalConfigHelper,\n\t\tcols: number,\n\t\trows: number,\n\t\tprivate readonly _backgroundColorProvider: IXtermColorProvider,\n\t\tprivate readonly _capabilities: ITerminalCapabilityStore,\n\t\tshellIntegrationNonce: string,\n\t\tprivate readonly _terminalSuggestWidgetVisibleContextKey: IContextKey<boolean> | undefined,\n\t\tdisableShellIntegrationReporting: boolean,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ITerminalLogService private readonly _logService: ITerminalLogService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@IThemeService private readonly _themeService: IThemeService,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@IClipboardService private readonly _clipboardService: IClipboardService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService\n\t) {\n\t\tsuper();\n\t\tconst font = this._configHelper.getFont(undefined, true);\n\t\tconst config = this._configHelper.config;\n\t\tconst editorOptions = this._configurationService.getValue<IEditorOptions>('editor');\n\n\t\tthis.raw = this._register(new xtermCtor({\n\t\t\tallowProposedApi: true,\n\t\t\tcols,\n\t\t\trows,\n\t\t\taltClickMovesCursor: config.altClickMovesCursor && editorOptions.multiCursorModifier === 'alt',\n\t\t\tscrollback: config.scrollback,\n\t\t\ttheme: this._getXtermTheme(),\n\t\t\tdrawBoldTextInBrightColors: config.drawBoldTextInBrightColors,\n\t\t\tfontFamily: font.fontFamily,\n\t\t\tfontWeight: config.fontWeight,\n\t\t\tfontWeightBold: config.fontWeightBold,\n\t\t\tfontSize: font.fontSize,\n\t\t\tletterSpacing: font.letterSpacing,\n\t\t\tlineHeight: font.lineHeight,\n\t\t\tlogLevel: vscodeToXtermLogLevel(this._logService.getLevel()),\n\t\t\tlogger: this._logService,\n\t\t\tminimumContrastRatio: config.minimumContrastRatio,\n\t\t\ttabStopWidth: config.tabStopWidth,\n\t\t\tcursorBlink: config.cursorBlinking,\n\t\t\tcursorStyle: vscodeToXtermCursorStyle<'cursorStyle'>(config.cursorStyle),\n\t\t\tcursorInactiveStyle: vscodeToXtermCursorStyle(config.cursorStyleInactive),\n\t\t\tcursorWidth: config.cursorWidth,\n\t\t\tmacOptionIsMeta: config.macOptionIsMeta,\n\t\t\tmacOptionClickForcesSelection: config.macOptionClickForcesSelection,\n\t\t\trightClickSelectsWord: config.rightClickBehavior === 'selectWord',\n\t\t\tfastScrollModifier: 'alt',\n\t\t\tfastScrollSensitivity: config.fastScrollSensitivity,\n\t\t\tscrollSensitivity: config.mouseWheelScrollSensitivity,\n\t\t\twordSeparator: config.wordSeparators,\n\t\t\toverviewRulerWidth: 10,\n\t\t\tignoreBracketedPasteMode: config.ignoreBracketedPasteMode\n\t\t}));\n\t\tthis._updateSmoothScrolling();\n\t\tthis._core = (this.raw as any)._core as IXtermCore;\n\n\t\tthis._register(this._configurationService.onDidChangeConfiguration(async e => {\n\t\t\tif (e.affectsConfiguration(TerminalSettingId.GpuAcceleration)) {\n\t\t\t\tXtermTerminal._suggestedRendererType = undefined;\n\t\t\t}\n\t\t\tif (e.affectsConfiguration('terminal.integrated') || e.affectsConfiguration('editor.fastScrollSensitivity') || e.affectsConfiguration('editor.mouseWheelScrollSensitivity') || e.affectsConfiguration('editor.multiCursorModifier')) {\n\t\t\t\tthis.updateConfig();\n\t\t\t}\n\t\t\tif (e.affectsConfiguration(TerminalSettingId.UnicodeVersion)) {\n\t\t\t\tthis._updateUnicodeVersion();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._themeService.onDidColorThemeChange(theme => this._updateTheme(theme)));\n\t\tthis._register(this._logService.onDidChangeLogLevel(e => this.raw.options.logLevel = vscodeToXtermLogLevel(e)));\n\n\t\t// Refire events\n\t\tthis._register(this.raw.onSelectionChange(() => {\n\t\t\tthis._onDidChangeSelection.fire();\n\t\t\tif (this.isFocused) {\n\t\t\t\tthis._anyFocusedTerminalHasSelection.set(this.raw.hasSelection());\n\t\t\t}\n\t\t}));\n\n\t\t// Load addons\n\t\tthis._updateUnicodeVersion();\n\t\tthis._markNavigationAddon = this._instantiationService.createInstance(MarkNavigationAddon, _capabilities);\n\t\tthis.raw.loadAddon(this._markNavigationAddon);\n\t\tthis._decorationAddon = this._instantiationService.createInstance(DecorationAddon, this._capabilities);\n\t\tthis._register(this._decorationAddon.onDidRequestRunCommand(e => this._onDidRequestRunCommand.fire(e)));\n\t\tthis.raw.loadAddon(this._decorationAddon);\n\t\tthis._shellIntegrationAddon = new ShellIntegrationAddon(shellIntegrationNonce, disableShellIntegrationReporting, this._telemetryService, this._logService);\n\t\tthis.raw.loadAddon(this._shellIntegrationAddon);\n\n\t\tthis._anyTerminalFocusContextKey = TerminalContextKeys.focusInAny.bindTo(contextKeyService);\n\t\tthis._anyFocusedTerminalHasSelection = TerminalContextKeys.textSelectedInFocused.bindTo(contextKeyService);\n\n\t\t// Load the suggest addon, this should be loaded regardless of the setting as the sequences\n\t\t// may still come in\n\t\tif (this._terminalSuggestWidgetVisibleContextKey) {\n\t\t\tthis._suggestAddon = this._register(this._instantiationService.createInstance(SuggestAddon, this._terminalSuggestWidgetVisibleContextKey));\n\t\t\tthis.raw.loadAddon(this._suggestAddon);\n\t\t\tthis._register(this._suggestAddon.onAcceptedCompletion(async text => {\n\t\t\t\tthis._onDidRequestFocus.fire();\n\t\t\t\tthis._onDidRequestSendText.fire(text);\n\t\t\t}));\n\t\t}\n\t}\n\n\t*getBufferReverseIterator(): IterableIterator<string> {\n\t\tfor (let i = this.raw.buffer.active.length; i >= 0; i--) {\n\t\t\tconst { lineData, lineIndex } = getFullBufferLineAsString(i, this.raw.buffer.active);\n\t\t\tif (lineData) {\n\t\t\t\ti = lineIndex;\n\t\t\t\tyield lineData;\n\t\t\t}\n\t\t}\n\t}\n\n\tasync getContentsAsHtml(): Promise<string> {\n\t\tif (!this._serializeAddon) {\n\t\t\tconst Addon = await this._getSerializeAddonConstructor();\n\t\t\tthis._serializeAddon = new Addon();\n\t\t\tthis.raw.loadAddon(this._serializeAddon);\n\t\t}\n\n\t\treturn this._serializeAddon.serializeAsHTML();\n\t}\n\n\tasync getSelectionAsHtml(command?: ITerminalCommand): Promise<string> {\n\t\tif (!this._serializeAddon) {\n\t\t\tconst Addon = await this._getSerializeAddonConstructor();\n\t\t\tthis._serializeAddon = new Addon();\n\t\t\tthis.raw.loadAddon(this._serializeAddon);\n\t\t}\n\t\tif (command) {\n\t\t\tconst length = command.getOutput()?.length;\n\t\t\tconst row = command.marker?.line;\n\t\t\tif (!length || !row) {\n\t\t\t\tthrow new Error(`No row ${row} or output length ${length} for command ${command}`);\n\t\t\t}\n\t\t\tthis.raw.select(0, row + 1, length - Math.floor(length / this.raw.cols));\n\t\t}\n\t\tconst result = this._serializeAddon.serializeAsHTML({ onlySelection: true });\n\t\tif (command) {\n\t\t\tthis.raw.clearSelection();\n\t\t}\n\t\treturn result;\n\t}\n\n\tattachToElement(container: HTMLElement, partialOptions?: Partial<IXtermAttachToElementOptions>): HTMLElement {\n\t\tconst options: IXtermAttachToElementOptions = { enableGpu: true, ...partialOptions };\n\t\tif (!this._attached) {\n\t\t\tthis.raw.open(container);\n\t\t}\n\n\t\t// TODO: Move before open to the DOM renderer doesn't initialize\n\t\tif (options.enableGpu) {\n\t\t\tif (this._shouldLoadWebgl()) {\n\t\t\t\tthis._enableWebglRenderer();\n\t\t\t} else if (this._shouldLoadCanvas()) {\n\t\t\t\tthis._enableCanvasRenderer();\n\t\t\t}\n\t\t}\n\n\t\tif (!this.raw.element || !this.raw.textarea) {\n\t\t\tthrow new Error('xterm elements not set after open');\n\t\t}\n\n\t\tconst ad = this._attachedDisposables;\n\t\tad.clear();\n\t\tad.add(dom.addDisposableListener(this.raw.textarea, 'focus', () => this._setFocused(true)));\n\t\tad.add(dom.addDisposableListener(this.raw.textarea, 'blur', () => this._setFocused(false)));\n\t\tad.add(dom.addDisposableListener(this.raw.textarea, 'focusout', () => this._setFocused(false)));\n\n\t\t// Track wheel events in mouse wheel classifier and update smoothScrolling when it changes\n\t\t// as it must be disabled when a trackpad is used\n\t\tad.add(dom.addDisposableListener(this.raw.element!, dom.EventType.MOUSE_WHEEL, (e: IMouseWheelEvent) => {\n\t\t\tconst classifier = MouseWheelClassifier.INSTANCE;\n\t\t\tclassifier.acceptStandardWheelEvent(new StandardWheelEvent(e));\n\t\t\tconst value = classifier.isPhysicalMouseWheel();\n\t\t\tif (value !== this._isPhysicalMouseWheel) {\n\t\t\t\tthis._isPhysicalMouseWheel = value;\n\t\t\t\tthis._updateSmoothScrolling();\n\t\t\t}\n\t\t}, { passive: true }));\n\n\t\tthis._suggestAddon?.setContainer(container);\n\n\t\tthis._attached = { container, options };\n\t\t// Screen must be created at this point as xterm.open is called\n\t\treturn this._attached?.container.querySelector('.xterm-screen')!;\n\t}\n\n\tprivate _setFocused(isFocused: boolean) {\n\t\tthis._onDidChangeFocus.fire(isFocused);\n\t\tthis._anyTerminalFocusContextKey.set(isFocused);\n\t\tthis._anyFocusedTerminalHasSelection.set(isFocused && this.raw.hasSelection());\n\t}\n\n\twrite(data: string | Uint8Array, callback?: () => void): void {\n\t\tthis.raw.write(data, callback);\n\t}\n\n\tresize(columns: number, rows: number): void {\n\t\tthis.raw.resize(columns, rows);\n\t}\n\n\tupdateConfig(): void {\n\t\tconst config = this._configHelper.config;\n\t\tthis.raw.options.altClickMovesCursor = config.altClickMovesCursor;\n\t\tthis._setCursorBlink(config.cursorBlinking);\n\t\tthis._setCursorStyle(config.cursorStyle);\n\t\tthis._setCursorStyleInactive(config.cursorStyleInactive);\n\t\tthis._setCursorWidth(config.cursorWidth);\n\t\tthis.raw.options.scrollback = config.scrollback;\n\t\tthis.raw.options.drawBoldTextInBrightColors = config.drawBoldTextInBrightColors;\n\t\tthis.raw.options.minimumContrastRatio = config.minimumContrastRatio;\n\t\tthis.raw.options.tabStopWidth = config.tabStopWidth;\n\t\tthis.raw.options.fastScrollSensitivity = config.fastScrollSensitivity;\n\t\tthis.raw.options.scrollSensitivity = config.mouseWheelScrollSensitivity;\n\t\tthis.raw.options.macOptionIsMeta = config.macOptionIsMeta;\n\t\tconst editorOptions = this._configurationService.getValue<IEditorOptions>('editor');\n\t\tthis.raw.options.altClickMovesCursor = config.altClickMovesCursor && editorOptions.multiCursorModifier === 'alt';\n\t\tthis.raw.options.macOptionClickForcesSelection = config.macOptionClickForcesSelection;\n\t\tthis.raw.options.rightClickSelectsWord = config.rightClickBehavior === 'selectWord';\n\t\tthis.raw.options.wordSeparator = config.wordSeparators;\n\t\tthis.raw.options.customGlyphs = config.customGlyphs;\n\t\tthis.raw.options.ignoreBracketedPasteMode = config.ignoreBracketedPasteMode;\n\t\tthis._updateSmoothScrolling();\n\t\tif (this._attached?.options.enableGpu) {\n\t\t\tif (this._shouldLoadWebgl()) {\n\t\t\t\tthis._enableWebglRenderer();\n\t\t\t} else {\n\t\t\t\tthis._disposeOfWebglRenderer();\n\t\t\t\tif (this._shouldLoadCanvas()) {\n\t\t\t\t\tthis._enableCanvasRenderer();\n\t\t\t\t} else {\n\t\t\t\t\tthis._disposeOfCanvasRenderer();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _updateSmoothScrolling() {\n\t\tthis.raw.options.smoothScrollDuration = this._configHelper.config.smoothScrolling && this._isPhysicalMouseWheel ? RenderConstants.SmoothScrollDuration : 0;\n\t}\n\n\tprivate _shouldLoadWebgl(): boolean {\n\t\treturn !isSafari && (this._configHelper.config.gpuAcceleration === 'auto' && XtermTerminal._suggestedRendererType === undefined) || this._configHelper.config.gpuAcceleration === 'on';\n\t}\n\n\tprivate _shouldLoadCanvas(): boolean {\n\t\treturn (this._configHelper.config.gpuAcceleration === 'auto' && (XtermTerminal._suggestedRendererType === undefined || XtermTerminal._suggestedRendererType === 'canvas')) || this._configHelper.config.gpuAcceleration === 'canvas';\n\t}\n\n\tforceRedraw() {\n\t\tthis.raw.clearTextureAtlas();\n\t}\n\n\tclearDecorations(): void {\n\t\tthis._decorationAddon?.clearDecorations();\n\t}\n\n\tforceRefresh() {\n\t\tthis._core.viewport?._innerRefresh();\n\t}\n\n\tforceUnpause() {\n\t\t// HACK: Force the renderer to unpause by simulating an IntersectionObserver event.\n\t\t// This is to fix an issue where dragging the windpow to the top of the screen to\n\t\t// maximize on Windows/Linux would fire an event saying that the terminal was not\n\t\t// visible.\n\t\tif (!!this._canvasAddon) {\n\t\t\tthis._core._renderService?._handleIntersectionChange({ intersectionRatio: 1 });\n\t\t\t// HACK: Force a refresh of the screen to ensure links are refresh corrected.\n\t\t\t// This can probably be removed when the above hack is fixed in Chromium.\n\t\t\tthis.raw.refresh(0, this.raw.rows - 1);\n\t\t}\n\t}\n\n\tasync findNext(term: string, searchOptions: ISearchOptions): Promise<boolean> {\n\t\tthis._updateFindColors(searchOptions);\n\t\treturn (await this._getSearchAddon()).findNext(term, searchOptions);\n\t}\n\n\tasync findPrevious(term: string, searchOptions: ISearchOptions): Promise<boolean> {\n\t\tthis._updateFindColors(searchOptions);\n\t\treturn (await this._getSearchAddon()).findPrevious(term, searchOptions);\n\t}\n\n\tprivate _updateFindColors(searchOptions: ISearchOptions): void {\n\t\tconst theme = this._themeService.getColorTheme();\n\t\t// Theme color names align with monaco/vscode whereas xterm.js has some different naming.\n\t\t// The mapping is as follows:\n\t\t// - findMatch -> activeMatch\n\t\t// - findMatchHighlight -> match\n\t\tconst terminalBackground = theme.getColor(TERMINAL_BACKGROUND_COLOR) || theme.getColor(PANEL_BACKGROUND);\n\t\tconst findMatchBackground = theme.getColor(TERMINAL_FIND_MATCH_BACKGROUND_COLOR);\n\t\tconst findMatchBorder = theme.getColor(TERMINAL_FIND_MATCH_BORDER_COLOR);\n\t\tconst findMatchOverviewRuler = theme.getColor(TERMINAL_OVERVIEW_RULER_CURSOR_FOREGROUND_COLOR);\n\t\tconst findMatchHighlightBackground = theme.getColor(TERMINAL_FIND_MATCH_HIGHLIGHT_BACKGROUND_COLOR);\n\t\tconst findMatchHighlightBorder = theme.getColor(TERMINAL_FIND_MATCH_HIGHLIGHT_BORDER_COLOR);\n\t\tconst findMatchHighlightOverviewRuler = theme.getColor(TERMINAL_OVERVIEW_RULER_FIND_MATCH_FOREGROUND_COLOR);\n\t\tsearchOptions.decorations = {\n\t\t\tactiveMatchBackground: findMatchBackground?.toString(),\n\t\t\tactiveMatchBorder: findMatchBorder?.toString() || 'transparent',\n\t\t\tactiveMatchColorOverviewRuler: findMatchOverviewRuler?.toString() || 'transparent',\n\t\t\t// decoration bgs don't support the alpha channel so blend it with the regular bg\n\t\t\tmatchBackground: terminalBackground ? findMatchHighlightBackground?.blend(terminalBackground).toString() : undefined,\n\t\t\tmatchBorder: findMatchHighlightBorder?.toString() || 'transparent',\n\t\t\tmatchOverviewRuler: findMatchHighlightOverviewRuler?.toString() || 'transparent'\n\t\t};\n\t}\n\n\tprivate _searchAddonPromise: Promise<SearchAddonType> | undefined;\n\tprivate _getSearchAddon(): Promise<SearchAddonType> {\n\t\tif (!this._searchAddonPromise) {\n\t\t\tthis._searchAddonPromise = this._getSearchAddonConstructor().then((AddonCtor) => {\n\t\t\t\tthis._searchAddon = new AddonCtor({ highlightLimit: XtermTerminalConstants.SearchHighlightLimit });\n\t\t\t\tthis.raw.loadAddon(this._searchAddon);\n\t\t\t\tthis._searchAddon.onDidChangeResults((results: { resultIndex: number; resultCount: number }) => {\n\t\t\t\t\tthis._lastFindResult = results;\n\t\t\t\t\tthis._onDidChangeFindResults.fire(results);\n\t\t\t\t});\n\t\t\t\treturn this._searchAddon;\n\t\t\t});\n\t\t}\n\t\treturn this._searchAddonPromise;\n\t}\n\n\tclearSearchDecorations(): void {\n\t\tthis._searchAddon?.clearDecorations();\n\t}\n\n\tclearActiveSearchDecoration(): void {\n\t\tthis._searchAddon?.clearActiveDecoration();\n\t}\n\n\tgetFont(): ITerminalFont {\n\t\treturn this._configHelper.getFont(this._core);\n\t}\n\n\tgetLongestViewportWrappedLineLength(): number {\n\t\tlet maxLineLength = 0;\n\t\tfor (let i = this.raw.buffer.active.length - 1; i >= this.raw.buffer.active.viewportY; i--) {\n\t\t\tconst lineInfo = this._getWrappedLineCount(i, this.raw.buffer.active);\n\t\t\tmaxLineLength = Math.max(maxLineLength, ((lineInfo.lineCount * this.raw.cols) - lineInfo.endSpaces) || 0);\n\t\t\ti = lineInfo.currentIndex;\n\t\t}\n\t\treturn maxLineLength;\n\t}\n\n\tprivate _getWrappedLineCount(index: number, buffer: IBuffer): { lineCount: number; currentIndex: number; endSpaces: number } {\n\t\tlet line = buffer.getLine(index);\n\t\tif (!line) {\n\t\t\tthrow new Error('Could not get line');\n\t\t}\n\t\tlet currentIndex = index;\n\t\tlet endSpaces = 0;\n\t\t// line.length may exceed cols as it doesn't necessarily trim the backing array on resize\n\t\tfor (let i = Math.min(line.length, this.raw.cols) - 1; i >= 0; i--) {\n\t\t\tif (!line?.getCell(i)?.getChars()) {\n\t\t\t\tendSpaces++;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\twhile (line?.isWrapped && currentIndex > 0) {\n\t\t\tcurrentIndex--;\n\t\t\tline = buffer.getLine(currentIndex);\n\t\t}\n\t\treturn { lineCount: index - currentIndex + 1, currentIndex, endSpaces };\n\t}\n\n\tscrollDownLine(): void {\n\t\tthis.raw.scrollLines(1);\n\t}\n\n\tscrollDownPage(): void {\n\t\tthis.raw.scrollPages(1);\n\t}\n\n\tscrollToBottom(): void {\n\t\tthis.raw.scrollToBottom();\n\t}\n\n\tscrollUpLine(): void {\n\t\tthis.raw.scrollLines(-1);\n\t}\n\n\tscrollUpPage(): void {\n\t\tthis.raw.scrollPages(-1);\n\t}\n\n\tscrollToTop(): void {\n\t\tthis.raw.scrollToTop();\n\t}\n\n\tclearBuffer(): void {\n\t\tthis.raw.clear();\n\t\t// xterm.js does not clear the first prompt, so trigger these to simulate\n\t\t// the prompt being written\n\t\tthis._capabilities.get(TerminalCapability.CommandDetection)?.handlePromptStart();\n\t\tthis._capabilities.get(TerminalCapability.CommandDetection)?.handleCommandStart();\n\t}\n\n\thasSelection(): boolean {\n\t\treturn this.raw.hasSelection();\n\t}\n\n\tclearSelection(): void {\n\t\tthis.raw.clearSelection();\n\t}\n\n\tselectMarkedRange(fromMarkerId: string, toMarkerId: string, scrollIntoView = false) {\n\t\tconst detectionCapability = this.shellIntegration.capabilities.get(TerminalCapability.BufferMarkDetection);\n\t\tif (!detectionCapability) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst start = detectionCapability.getMark(fromMarkerId);\n\t\tconst end = detectionCapability.getMark(toMarkerId);\n\t\tif (start === undefined || end === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.raw.selectLines(start.line, end.line);\n\t\tif (scrollIntoView) {\n\t\t\tthis.raw.scrollToLine(start.line);\n\t\t}\n\t}\n\n\tselectAll(): void {\n\t\tthis.raw.focus();\n\t\tthis.raw.selectAll();\n\t}\n\n\tfocus(): void {\n\t\tthis.raw.focus();\n\t}\n\n\tasync copySelection(asHtml?: boolean, command?: ITerminalCommand): Promise<void> {\n\t\tif (this.hasSelection() || (asHtml && command)) {\n\t\t\tif (asHtml) {\n\t\t\t\tconst textAsHtml = await this.getSelectionAsHtml(command);\n\t\t\t\tfunction listener(e: any) {\n\t\t\t\t\tif (!e.clipboardData.types.includes('text/plain')) {\n\t\t\t\t\t\te.clipboardData.setData('text/plain', command?.getOutput() ?? '');\n\t\t\t\t\t}\n\t\t\t\t\te.clipboardData.setData('text/html', textAsHtml);\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t\tdocument.addEventListener('copy', listener);\n\t\t\t\tdocument.execCommand('copy');\n\t\t\t\tdocument.removeEventListener('copy', listener);\n\t\t\t} else {\n\t\t\t\tawait this._clipboardService.writeText(this.raw.getSelection());\n\t\t\t}\n\t\t} else {\n\t\t\tthis._notificationService.warn(localize('terminal.integrated.copySelection.noSelection', 'The terminal has no selection to copy'));\n\t\t}\n\t}\n\n\tprivate _setCursorBlink(blink: boolean): void {\n\t\tif (this.raw.options.cursorBlink !== blink) {\n\t\t\tthis.raw.options.cursorBlink = blink;\n\t\t\tthis.raw.refresh(0, this.raw.rows - 1);\n\t\t}\n\t}\n\n\tprivate _setCursorStyle(style: ITerminalConfiguration['cursorStyle']): void {\n\t\tconst mapped = vscodeToXtermCursorStyle<'cursorStyle'>(style);\n\t\tif (this.raw.options.cursorStyle !== mapped) {\n\t\t\tthis.raw.options.cursorStyle = mapped;\n\t\t}\n\t}\n\n\tprivate _setCursorStyleInactive(style: ITerminalConfiguration['cursorStyleInactive']): void {\n\t\tconst mapped = vscodeToXtermCursorStyle(style);\n\t\tif (this.raw.options.cursorInactiveStyle !== mapped) {\n\t\t\tthis.raw.options.cursorInactiveStyle = mapped;\n\t\t}\n\t}\n\n\tprivate _setCursorWidth(width: number): void {\n\t\tif (this.raw.options.cursorWidth !== width) {\n\t\t\tthis.raw.options.cursorWidth = width;\n\t\t}\n\t}\n\n\tprivate async _enableWebglRenderer(): Promise<void> {\n\t\tif (!this.raw.element || this._webglAddon) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check if the the WebGL renderer is compatible with xterm.js:\n\t\t// - https://github.com/microsoft/vscode/issues/190195\n\t\t// - https://github.com/xtermjs/xterm.js/issues/4665\n\t\t// - https://bugs.chromium.org/p/chromium/issues/detail?id=1476475\n\t\tif (!XtermTerminal._checkedWebglCompatible) {\n\t\t\tXtermTerminal._checkedWebglCompatible = true;\n\t\t\tconst checkCanvas = document.createElement('canvas');\n\t\t\tconst checkGl = checkCanvas.getContext('webgl2');\n\t\t\tconst debugInfo = checkGl?.getExtension('WEBGL_debug_renderer_info');\n\t\t\tif (checkGl && debugInfo) {\n\t\t\t\tconst renderer = checkGl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);\n\t\t\t\tif (renderer.startsWith('ANGLE (Google, Vulkan 1.3.0 (SwiftShader Device (Subzero)')) {\n\t\t\t\t\tthis._disableWebglForThisSession();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst Addon = await this._getWebglAddonConstructor();\n\t\tthis._webglAddon = new Addon();\n\t\tthis._disposeOfCanvasRenderer();\n\t\ttry {\n\t\t\tthis.raw.loadAddon(this._webglAddon);\n\t\t\tthis._logService.trace('Webgl was loaded');\n\t\t\tthis._webglAddon.onContextLoss(() => {\n\t\t\t\tthis._logService.info(`Webgl lost context, disposing of webgl renderer`);\n\t\t\t\tthis._disposeOfWebglRenderer();\n\t\t\t});\n\t\t\tthis._refreshImageAddon();\n\t\t\t// Uncomment to add the texture atlas to the DOM\n\t\t\t// setTimeout(() => {\n\t\t\t// \tif (this._webglAddon?.textureAtlas) {\n\t\t\t// \t\tdocument.body.appendChild(this._webglAddon?.textureAtlas);\n\t\t\t// \t}\n\t\t\t// }, 5000);\n\t\t} catch (e) {\n\t\t\tthis._logService.warn(`Webgl could not be loaded. Falling back to the canvas renderer type.`, e);\n\t\t\tconst neverMeasureRenderTime = this._storageService.getBoolean(TerminalStorageKeys.NeverMeasureRenderTime, StorageScope.APPLICATION, false);\n\t\t\t// if it's already set to dom, no need to measure render time\n\t\t\tif (!neverMeasureRenderTime && this._configHelper.config.gpuAcceleration !== 'off') {\n\t\t\t\tthis._measureRenderTime();\n\t\t\t}\n\t\t\tthis._disableWebglForThisSession();\n\t\t}\n\t}\n\n\tprivate _disableWebglForThisSession() {\n\t\tXtermTerminal._suggestedRendererType = 'canvas';\n\t\tthis._disposeOfWebglRenderer();\n\t\tthis._enableCanvasRenderer();\n\t}\n\n\tprivate async _enableCanvasRenderer(): Promise<void> {\n\t\tif (!this.raw.element || this._canvasAddon) {\n\t\t\treturn;\n\t\t}\n\t\tconst Addon = await this._getCanvasAddonConstructor();\n\t\tthis._canvasAddon = new Addon();\n\t\tthis._disposeOfWebglRenderer();\n\t\ttry {\n\t\t\tthis.raw.loadAddon(this._canvasAddon);\n\t\t\tthis._logService.trace('Canvas renderer was loaded');\n\t\t} catch (e) {\n\t\t\tthis._logService.warn(`Canvas renderer could not be loaded, falling back to dom renderer`, e);\n\t\t\tconst neverMeasureRenderTime = this._storageService.getBoolean(TerminalStorageKeys.NeverMeasureRenderTime, StorageScope.APPLICATION, false);\n\t\t\t// if it's already set to dom, no need to measure render time\n\t\t\tif (!neverMeasureRenderTime && this._configHelper.config.gpuAcceleration !== 'off') {\n\t\t\t\tthis._measureRenderTime();\n\t\t\t}\n\t\t\tXtermTerminal._suggestedRendererType = 'dom';\n\t\t\tthis._disposeOfCanvasRenderer();\n\t\t}\n\t\tthis._refreshImageAddon();\n\t}\n\n\tprotected async _getCanvasAddonConstructor(): Promise<typeof CanvasAddonType> {\n\t\tif (!CanvasAddon) {\n\t\t\tCanvasAddon = (await importAMDNodeModule<typeof import('xterm-addon-canvas')>('xterm-addon-canvas', 'lib/xterm-addon-canvas.js')).CanvasAddon;\n\t\t}\n\t\treturn CanvasAddon;\n\t}\n\n\t@debounce(100)\n\tprivate async _refreshImageAddon(): Promise<void> {\n\t\t// Only allow the image addon when a canvas is being used to avoid possible GPU issues\n\t\tif (this._configHelper.config.enableImages && (this._canvasAddon || this._webglAddon)) {\n\t\t\tif (!this._imageAddon) {\n\t\t\t\tconst AddonCtor = await this._getImageAddonConstructor();\n\t\t\t\tthis._imageAddon = new AddonCtor();\n\t\t\t\tthis.raw.loadAddon(this._imageAddon);\n\t\t\t}\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tthis._imageAddon?.dispose();\n\t\t\t} catch {\n\t\t\t\t// ignore\n\t\t\t}\n\t\t\tthis._imageAddon = undefined;\n\t\t}\n\t}\n\n\tprotected async _getImageAddonConstructor(): Promise<typeof ImageAddonType> {\n\t\tif (!ImageAddon) {\n\t\t\tImageAddon = (await importAMDNodeModule<typeof import('xterm-addon-image')>('xterm-addon-image', 'lib/xterm-addon-image.js')).ImageAddon;\n\t\t}\n\t\treturn ImageAddon;\n\t}\n\n\tprotected async _getSearchAddonConstructor(): Promise<typeof SearchAddonType> {\n\t\tif (!SearchAddon) {\n\t\t\tSearchAddon = (await importAMDNodeModule<typeof import('xterm-addon-search')>('xterm-addon-search', 'lib/xterm-addon-search.js')).SearchAddon;\n\t\t}\n\t\treturn SearchAddon;\n\t}\n\n\tprotected async _getUnicode11Constructor(): Promise<typeof Unicode11AddonType> {\n\t\tif (!Unicode11Addon) {\n\t\t\tUnicode11Addon = (await importAMDNodeModule<typeof import('xterm-addon-unicode11')>('xterm-addon-unicode11', 'lib/xterm-addon-unicode11.js')).Unicode11Addon;\n\t\t}\n\t\treturn Unicode11Addon;\n\t}\n\n\tprotected async _getWebglAddonConstructor(): Promise<typeof WebglAddonType> {\n\t\tif (!WebglAddon) {\n\t\t\tWebglAddon = (await importAMDNodeModule<typeof import('xterm-addon-webgl')>('xterm-addon-webgl', 'lib/xterm-addon-webgl.js')).WebglAddon;\n\t\t}\n\t\treturn WebglAddon;\n\t}\n\n\tprotected async _getSerializeAddonConstructor(): Promise<typeof SerializeAddonType> {\n\t\tif (!SerializeAddon) {\n\t\t\tSerializeAddon = (await importAMDNodeModule<typeof import('xterm-addon-serialize')>('xterm-addon-serialize', 'lib/xterm-addon-serialize.js')).SerializeAddon;\n\t\t}\n\t\treturn SerializeAddon;\n\t}\n\n\tprivate _disposeOfCanvasRenderer(): void {\n\t\ttry {\n\t\t\tthis._canvasAddon?.dispose();\n\t\t} catch {\n\t\t\t// ignore\n\t\t}\n\t\tthis._canvasAddon = undefined;\n\t\tthis._refreshImageAddon();\n\t}\n\n\tprivate _disposeOfWebglRenderer(): void {\n\t\ttry {\n\t\t\tthis._webglAddon?.dispose();\n\t\t} catch {\n\t\t\t// ignore\n\t\t}\n\t\tthis._webglAddon = undefined;\n\t\tthis._refreshImageAddon();\n\t}\n\n\tprivate async _measureRenderTime(): Promise<void> {\n\t\tconst frameTimes: number[] = [];\n\t\tif (!this._core._renderService?._renderer._renderLayers) {\n\t\t\treturn;\n\t\t}\n\t\tconst textRenderLayer = this._core._renderService._renderer._renderLayers[0];\n\t\tconst originalOnGridChanged = textRenderLayer?.onGridChanged;\n\t\tconst evaluateCanvasRenderer = () => {\n\t\t\t// Discard first frame time as it's normal to take longer\n\t\t\tframeTimes.shift();\n\n\t\t\tconst medianTime = frameTimes.sort((a, b) => a - b)[Math.floor(frameTimes.length / 2)];\n\t\t\tif (medianTime > RenderConstants.SlowCanvasRenderThreshold) {\n\t\t\t\tif (this._configHelper.config.gpuAcceleration === 'auto') {\n\t\t\t\t\tXtermTerminal._suggestedRendererType = 'dom';\n\t\t\t\t\tthis.updateConfig();\n\t\t\t\t} else {\n\t\t\t\t\tconst promptChoices: IPromptChoice[] = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: localize('yes', \"Yes\"),\n\t\t\t\t\t\t\trun: () => this._configurationService.updateValue(TerminalSettingId.GpuAcceleration, 'off', ConfigurationTarget.USER)\n\t\t\t\t\t\t} as IPromptChoice,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: localize('no', \"No\"),\n\t\t\t\t\t\t\trun: () => { }\n\t\t\t\t\t\t} as IPromptChoice,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: localize('dontShowAgain', \"Don't Show Again\"),\n\t\t\t\t\t\t\tisSecondary: true,\n\t\t\t\t\t\t\trun: () => this._storageService.store(TerminalStorageKeys.NeverMeasureRenderTime, true, StorageScope.APPLICATION, StorageTarget.MACHINE)\n\t\t\t\t\t\t} as IPromptChoice\n\t\t\t\t\t];\n\t\t\t\t\tthis._notificationService.prompt(\n\t\t\t\t\t\tSeverity.Warning,\n\t\t\t\t\t\tlocalize('terminal.slowRendering', 'Terminal GPU acceleration appears to be slow on your computer. Would you like to switch to disable it which may improve performance? [Read more about terminal settings](https://code.visualstudio.com/docs/editor/integrated-terminal#_changing-how-the-terminal-is-rendered).'),\n\t\t\t\t\t\tpromptChoices\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\ttextRenderLayer.onGridChanged = (terminal: RawXtermTerminal, firstRow: number, lastRow: number) => {\n\t\t\tconst startTime = performance.now();\n\t\t\toriginalOnGridChanged.call(textRenderLayer, terminal, firstRow, lastRow);\n\t\t\tframeTimes.push(performance.now() - startTime);\n\t\t\tif (frameTimes.length === RenderConstants.NumberOfFramestoMeasure) {\n\t\t\t\tevaluateCanvasRenderer();\n\t\t\t\t// Restore original function\n\t\t\t\ttextRenderLayer.onGridChanged = originalOnGridChanged;\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate _getXtermTheme(theme?: IColorTheme): ITheme {\n\t\tif (!theme) {\n\t\t\ttheme = this._themeService.getColorTheme();\n\t\t}\n\n\t\tconst foregroundColor = theme.getColor(TERMINAL_FOREGROUND_COLOR);\n\t\tconst backgroundColor = this._backgroundColorProvider.getBackgroundColor(theme);\n\t\tconst cursorColor = theme.getColor(TERMINAL_CURSOR_FOREGROUND_COLOR) || foregroundColor;\n\t\tconst cursorAccentColor = theme.getColor(TERMINAL_CURSOR_BACKGROUND_COLOR) || backgroundColor;\n\t\tconst selectionBackgroundColor = theme.getColor(TERMINAL_SELECTION_BACKGROUND_COLOR);\n\t\tconst selectionInactiveBackgroundColor = theme.getColor(TERMINAL_INACTIVE_SELECTION_BACKGROUND_COLOR);\n\t\tconst selectionForegroundColor = theme.getColor(TERMINAL_SELECTION_FOREGROUND_COLOR) || undefined;\n\n\t\treturn {\n\t\t\tbackground: backgroundColor?.toString(),\n\t\t\tforeground: foregroundColor?.toString(),\n\t\t\tcursor: cursorColor?.toString(),\n\t\t\tcursorAccent: cursorAccentColor?.toString(),\n\t\t\tselectionBackground: selectionBackgroundColor?.toString(),\n\t\t\tselectionInactiveBackground: selectionInactiveBackgroundColor?.toString(),\n\t\t\tselectionForeground: selectionForegroundColor?.toString(),\n\t\t\tblack: theme.getColor(ansiColorIdentifiers[0])?.toString(),\n\t\t\tred: theme.getColor(ansiColorIdentifiers[1])?.toString(),\n\t\t\tgreen: theme.getColor(ansiColorIdentifiers[2])?.toString(),\n\t\t\tyellow: theme.getColor(ansiColorIdentifiers[3])?.toString(),\n\t\t\tblue: theme.getColor(ansiColorIdentifiers[4])?.toString(),\n\t\t\tmagenta: theme.getColor(ansiColorIdentifiers[5])?.toString(),\n\t\t\tcyan: theme.getColor(ansiColorIdentifiers[6])?.toString(),\n\t\t\twhite: theme.getColor(ansiColorIdentifiers[7])?.toString(),\n\t\t\tbrightBlack: theme.getColor(ansiColorIdentifiers[8])?.toString(),\n\t\t\tbrightRed: theme.getColor(ansiColorIdentifiers[9])?.toString(),\n\t\t\tbrightGreen: theme.getColor(ansiColorIdentifiers[10])?.toString(),\n\t\t\tbrightYellow: theme.getColor(ansiColorIdentifiers[11])?.toString(),\n\t\t\tbrightBlue: theme.getColor(ansiColorIdentifiers[12])?.toString(),\n\t\t\tbrightMagenta: theme.getColor(ansiColorIdentifiers[13])?.toString(),\n\t\t\tbrightCyan: theme.getColor(ansiColorIdentifiers[14])?.toString(),\n\t\t\tbrightWhite: theme.getColor(ansiColorIdentifiers[15])?.toString()\n\t\t};\n\t}\n\n\tprivate _updateTheme(theme?: IColorTheme): void {\n\t\tthis.raw.options.theme = this._getXtermTheme(theme);\n\t}\n\n\trefresh() {\n\t\tthis._updateTheme();\n\t\tthis._decorationAddon.refreshLayouts();\n\t}\n\n\tprivate async _updateUnicodeVersion(): Promise<void> {\n\t\tif (!this._unicode11Addon && this._configHelper.config.unicodeVersion === '11') {\n\t\t\tconst Addon = await this._getUnicode11Constructor();\n\t\t\tthis._unicode11Addon = new Addon();\n\t\t\tthis.raw.loadAddon(this._unicode11Addon);\n\t\t}\n\t\tif (this.raw.unicode.activeVersion !== this._configHelper.config.unicodeVersion) {\n\t\t\tthis.raw.unicode.activeVersion = this._configHelper.config.unicodeVersion;\n\t\t}\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\t_writeText(data: string): void {\n\t\tthis.raw.write(data);\n\t}\n\n\toverride dispose(): void {\n\t\tthis._anyTerminalFocusContextKey.reset();\n\t\tthis._anyFocusedTerminalHasSelection.reset();\n\t\tthis._onDidDispose.fire();\n\t\tsuper.dispose();\n\t}\n}\n\nexport function getXtermScaledDimensions(font: ITerminalFont, width: number, height: number) {\n\tif (!font.charWidth || !font.charHeight) {\n\t\treturn null;\n\t}\n\n\t// Because xterm.js converts from CSS pixels to actual pixels through\n\t// the use of canvas, window.devicePixelRatio needs to be used here in\n\t// order to be precise. font.charWidth/charHeight alone as insufficient\n\t// when window.devicePixelRatio changes.\n\tconst scaledWidthAvailable = width * window.devicePixelRatio;\n\n\tconst scaledCharWidth = font.charWidth * window.devicePixelRatio + font.letterSpacing;\n\tconst cols = Math.max(Math.floor(scaledWidthAvailable / scaledCharWidth), 1);\n\n\tconst scaledHeightAvailable = height * window.devicePixelRatio;\n\tconst scaledCharHeight = Math.ceil(font.charHeight * window.devicePixelRatio);\n\tconst scaledLineHeight = Math.floor(scaledCharHeight * font.lineHeight);\n\tconst rows = Math.max(Math.floor(scaledHeightAvailable / scaledLineHeight), 1);\n\n\treturn { rows, cols };\n}\n\nfunction vscodeToXtermLogLevel(logLevel: LogLevel): XtermLogLevel {\n\tswitch (logLevel) {\n\t\tcase LogLevel.Trace: return 'trace';\n\t\tcase LogLevel.Debug: return 'debug';\n\t\tcase LogLevel.Info: return 'info';\n\t\tcase LogLevel.Warning: return 'warn';\n\t\tcase LogLevel.Error: return 'error';\n\t\tdefault: return 'off';\n\t}\n}\n\ninterface ICursorStyleVscodeToXtermMap {\n\t'cursorStyle': NonNullable<ITerminalOptions['cursorStyle']>;\n\t'cursorStyleInactive': NonNullable<ITerminalOptions['cursorInactiveStyle']>;\n}\nfunction vscodeToXtermCursorStyle<T extends 'cursorStyle' | 'cursorStyleInactive'>(style: ITerminalConfiguration[T]): ICursorStyleVscodeToXtermMap[T] {\n\t// 'line' is used instead of bar in VS Code to be consistent with editor.cursorStyle\n\tif (style === 'line') {\n\t\treturn 'bar';\n\t}\n\treturn style as ICursorStyleVscodeToXtermMap[T];\n}\n"]}