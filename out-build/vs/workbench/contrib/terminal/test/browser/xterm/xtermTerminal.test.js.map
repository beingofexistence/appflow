{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/terminal/test/browser/xterm/xtermTerminal.test.ts"],"names":[],"mappings":"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","file":"xtermTerminal.test.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { IEvent, Terminal } from 'xterm';\nimport { XtermTerminal } from 'vs/workbench/contrib/terminal/browser/xterm/xtermTerminal';\nimport { TerminalConfigHelper } from 'vs/workbench/contrib/terminal/browser/terminalConfigHelper';\nimport { TestInstantiationService } from 'vs/platform/instantiation/test/common/instantiationServiceMock';\nimport { ITerminalConfiguration, TERMINAL_VIEW_ID } from 'vs/workbench/contrib/terminal/common/terminal';\nimport { deepStrictEqual, strictEqual } from 'assert';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { TestConfigurationService } from 'vs/platform/configuration/test/common/testConfigurationService';\nimport { TestColorTheme, TestThemeService } from 'vs/platform/theme/test/common/testThemeService';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { IViewDescriptor, IViewDescriptorService, ViewContainerLocation } from 'vs/workbench/common/views';\nimport { IEditorOptions } from 'vs/editor/common/config/editorOptions';\nimport { Emitter } from 'vs/base/common/event';\nimport { TERMINAL_BACKGROUND_COLOR, TERMINAL_FOREGROUND_COLOR, TERMINAL_CURSOR_FOREGROUND_COLOR, TERMINAL_CURSOR_BACKGROUND_COLOR, TERMINAL_SELECTION_BACKGROUND_COLOR, TERMINAL_SELECTION_FOREGROUND_COLOR, TERMINAL_INACTIVE_SELECTION_BACKGROUND_COLOR } from 'vs/workbench/contrib/terminal/common/terminalColorRegistry';\nimport { PANEL_BACKGROUND, SIDE_BAR_BACKGROUND } from 'vs/workbench/common/theme';\nimport type { WebglAddon } from 'xterm-addon-webgl';\nimport { NullLogService } from 'vs/platform/log/common/log';\nimport { IStorageService } from 'vs/platform/storage/common/storage';\nimport { TestStorageService } from 'vs/workbench/test/common/workbenchTestServices';\nimport { isSafari } from 'vs/base/browser/browser';\nimport { TerminalCapabilityStore } from 'vs/platform/terminal/common/capabilities/terminalCapabilityStore';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { ContextMenuService } from 'vs/platform/contextview/browser/contextMenuService';\nimport { TestLifecycleService } from 'vs/workbench/test/browser/workbenchTestServices';\nimport { ILifecycleService } from 'vs/workbench/services/lifecycle/common/lifecycle';\nimport { importAMDNodeModule } from 'vs/amdX';\nimport { MockContextKeyService } from 'vs/platform/keybinding/test/common/mockKeybindingService';\nimport { Color, RGBA } from 'vs/base/common/color';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { ITerminalLogService } from 'vs/platform/terminal/common/terminal';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from 'vs/base/test/common/utils';\n\nclass TestWebglAddon implements WebglAddon {\n\tstatic shouldThrow = false;\n\tstatic isEnabled = false;\n\treadonly onChangeTextureAtlas = new Emitter().event as IEvent<HTMLCanvasElement>;\n\treadonly onAddTextureAtlasCanvas = new Emitter().event as IEvent<HTMLCanvasElement>;\n\treadonly onContextLoss = new Emitter().event as IEvent<void>;\n\tactivate() {\n\t\tTestWebglAddon.isEnabled = !TestWebglAddon.shouldThrow;\n\t\tif (TestWebglAddon.shouldThrow) {\n\t\t\tthrow new Error('Test webgl set to throw');\n\t\t}\n\t}\n\tdispose() {\n\t\tTestWebglAddon.isEnabled = false;\n\t}\n\tclearTextureAtlas() { }\n}\n\nclass TestXtermTerminal extends XtermTerminal {\n\twebglAddonPromise: Promise<typeof WebglAddon> = Promise.resolve(TestWebglAddon);\n\t// Force synchronous to avoid async when activating the addon\n\tprotected override _getWebglAddonConstructor() {\n\t\treturn this.webglAddonPromise;\n\t}\n}\n\nexport class TestViewDescriptorService implements Partial<IViewDescriptorService> {\n\tprivate _location = ViewContainerLocation.Panel;\n\tprivate _onDidChangeLocation = new Emitter<{ views: IViewDescriptor[]; from: ViewContainerLocation; to: ViewContainerLocation }>();\n\tonDidChangeLocation = this._onDidChangeLocation.event;\n\tgetViewLocationById(id: string) {\n\t\treturn this._location;\n\t}\n\tmoveTerminalToLocation(to: ViewContainerLocation) {\n\t\tconst oldLocation = this._location;\n\t\tthis._location = to;\n\t\tthis._onDidChangeLocation.fire({\n\t\t\tviews: [\n\t\t\t\t{ id: TERMINAL_VIEW_ID } as any\n\t\t\t],\n\t\t\tfrom: oldLocation,\n\t\t\tto\n\t\t});\n\t}\n}\n\nconst defaultTerminalConfig: Partial<ITerminalConfiguration> = {\n\tfontFamily: 'monospace',\n\tfontWeight: 'normal',\n\tfontWeightBold: 'normal',\n\tgpuAcceleration: 'off',\n\tscrollback: 1000,\n\tfastScrollSensitivity: 2,\n\tmouseWheelScrollSensitivity: 1,\n\tunicodeVersion: '6'\n};\n\nsuite('XtermTerminal', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet configurationService: TestConfigurationService;\n\tlet themeService: TestThemeService;\n\tlet viewDescriptorService: TestViewDescriptorService;\n\tlet xterm: TestXtermTerminal;\n\tlet configHelper: TerminalConfigHelper;\n\tlet XTermBaseCtor: typeof Terminal;\n\n\tsetup(async () => {\n\t\tconfigurationService = new TestConfigurationService({\n\t\t\teditor: {\n\t\t\t\tfastScrollSensitivity: 2,\n\t\t\t\tmouseWheelScrollSensitivity: 1\n\t\t\t} as Partial<IEditorOptions>,\n\t\t\tterminal: {\n\t\t\t\tintegrated: defaultTerminalConfig\n\t\t\t}\n\t\t});\n\t\tthemeService = new TestThemeService();\n\t\tviewDescriptorService = new TestViewDescriptorService();\n\n\t\tinstantiationService = store.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IConfigurationService, configurationService);\n\t\tinstantiationService.stub(ITerminalLogService, new NullLogService());\n\t\tinstantiationService.stub(IStorageService, store.add(new TestStorageService()));\n\t\tinstantiationService.stub(IThemeService, themeService);\n\t\tinstantiationService.stub(IViewDescriptorService, viewDescriptorService);\n\t\tinstantiationService.stub(IContextMenuService, store.add(instantiationService.createInstance(ContextMenuService)));\n\t\tinstantiationService.stub(ILifecycleService, store.add(new TestLifecycleService()));\n\t\tinstantiationService.stub(IContextKeyService, new MockContextKeyService());\n\n\t\tconfigHelper = store.add(instantiationService.createInstance(TerminalConfigHelper));\n\t\tXTermBaseCtor = (await importAMDNodeModule<typeof import('xterm')>('xterm', 'lib/xterm.js')).Terminal;\n\n\t\tconst capabilityStore = store.add(new TerminalCapabilityStore());\n\t\txterm = store.add(instantiationService.createInstance(TestXtermTerminal, XTermBaseCtor, configHelper, 80, 30, { getBackgroundColor: () => undefined }, capabilityStore, '', new MockContextKeyService().createKey('', true)!, true));\n\n\t\tTestWebglAddon.shouldThrow = false;\n\t\tTestWebglAddon.isEnabled = false;\n\t});\n\n\ttest('should use fallback dimensions of 80x30', () => {\n\t\tstrictEqual(xterm.raw.cols, 80);\n\t\tstrictEqual(xterm.raw.rows, 30);\n\t});\n\n\tsuite('theme', () => {\n\t\ttest('should apply correct background color based on getBackgroundColor', () => {\n\t\t\tthemeService.setTheme(new TestColorTheme({\n\t\t\t\t[PANEL_BACKGROUND]: '#ff0000',\n\t\t\t\t[SIDE_BAR_BACKGROUND]: '#00ff00'\n\t\t\t}));\n\t\t\txterm = store.add(instantiationService.createInstance(XtermTerminal, XTermBaseCtor, configHelper, 80, 30, { getBackgroundColor: () => new Color(new RGBA(255, 0, 0)) }, store.add(new TerminalCapabilityStore()), '', new MockContextKeyService().createKey('', true)!, true));\n\t\t\tstrictEqual(xterm.raw.options.theme?.background, '#ff0000');\n\t\t});\n\t\ttest('should react to and apply theme changes', () => {\n\t\t\tthemeService.setTheme(new TestColorTheme({\n\t\t\t\t[TERMINAL_BACKGROUND_COLOR]: '#000100',\n\t\t\t\t[TERMINAL_FOREGROUND_COLOR]: '#000200',\n\t\t\t\t[TERMINAL_CURSOR_FOREGROUND_COLOR]: '#000300',\n\t\t\t\t[TERMINAL_CURSOR_BACKGROUND_COLOR]: '#000400',\n\t\t\t\t[TERMINAL_SELECTION_BACKGROUND_COLOR]: '#000500',\n\t\t\t\t[TERMINAL_INACTIVE_SELECTION_BACKGROUND_COLOR]: '#000600',\n\t\t\t\t[TERMINAL_SELECTION_FOREGROUND_COLOR]: undefined,\n\t\t\t\t'terminal.ansiBlack': '#010000',\n\t\t\t\t'terminal.ansiRed': '#020000',\n\t\t\t\t'terminal.ansiGreen': '#030000',\n\t\t\t\t'terminal.ansiYellow': '#040000',\n\t\t\t\t'terminal.ansiBlue': '#050000',\n\t\t\t\t'terminal.ansiMagenta': '#060000',\n\t\t\t\t'terminal.ansiCyan': '#070000',\n\t\t\t\t'terminal.ansiWhite': '#080000',\n\t\t\t\t'terminal.ansiBrightBlack': '#090000',\n\t\t\t\t'terminal.ansiBrightRed': '#100000',\n\t\t\t\t'terminal.ansiBrightGreen': '#110000',\n\t\t\t\t'terminal.ansiBrightYellow': '#120000',\n\t\t\t\t'terminal.ansiBrightBlue': '#130000',\n\t\t\t\t'terminal.ansiBrightMagenta': '#140000',\n\t\t\t\t'terminal.ansiBrightCyan': '#150000',\n\t\t\t\t'terminal.ansiBrightWhite': '#160000',\n\t\t\t}));\n\t\t\txterm = store.add(instantiationService.createInstance(XtermTerminal, XTermBaseCtor, configHelper, 80, 30, { getBackgroundColor: () => undefined }, store.add(new TerminalCapabilityStore()), '', new MockContextKeyService().createKey('', true)!, true));\n\t\t\tdeepStrictEqual(xterm.raw.options.theme, {\n\t\t\t\tbackground: undefined,\n\t\t\t\tforeground: '#000200',\n\t\t\t\tcursor: '#000300',\n\t\t\t\tcursorAccent: '#000400',\n\t\t\t\tselectionBackground: '#000500',\n\t\t\t\tselectionInactiveBackground: '#000600',\n\t\t\t\tselectionForeground: undefined,\n\t\t\t\tblack: '#010000',\n\t\t\t\tgreen: '#030000',\n\t\t\t\tred: '#020000',\n\t\t\t\tyellow: '#040000',\n\t\t\t\tblue: '#050000',\n\t\t\t\tmagenta: '#060000',\n\t\t\t\tcyan: '#070000',\n\t\t\t\twhite: '#080000',\n\t\t\t\tbrightBlack: '#090000',\n\t\t\t\tbrightRed: '#100000',\n\t\t\t\tbrightGreen: '#110000',\n\t\t\t\tbrightYellow: '#120000',\n\t\t\t\tbrightBlue: '#130000',\n\t\t\t\tbrightMagenta: '#140000',\n\t\t\t\tbrightCyan: '#150000',\n\t\t\t\tbrightWhite: '#160000',\n\t\t\t});\n\t\t\tthemeService.setTheme(new TestColorTheme({\n\t\t\t\t[TERMINAL_BACKGROUND_COLOR]: '#00010f',\n\t\t\t\t[TERMINAL_FOREGROUND_COLOR]: '#00020f',\n\t\t\t\t[TERMINAL_CURSOR_FOREGROUND_COLOR]: '#00030f',\n\t\t\t\t[TERMINAL_CURSOR_BACKGROUND_COLOR]: '#00040f',\n\t\t\t\t[TERMINAL_SELECTION_BACKGROUND_COLOR]: '#00050f',\n\t\t\t\t[TERMINAL_INACTIVE_SELECTION_BACKGROUND_COLOR]: '#00060f',\n\t\t\t\t[TERMINAL_SELECTION_FOREGROUND_COLOR]: '#00070f',\n\t\t\t\t'terminal.ansiBlack': '#01000f',\n\t\t\t\t'terminal.ansiRed': '#02000f',\n\t\t\t\t'terminal.ansiGreen': '#03000f',\n\t\t\t\t'terminal.ansiYellow': '#04000f',\n\t\t\t\t'terminal.ansiBlue': '#05000f',\n\t\t\t\t'terminal.ansiMagenta': '#06000f',\n\t\t\t\t'terminal.ansiCyan': '#07000f',\n\t\t\t\t'terminal.ansiWhite': '#08000f',\n\t\t\t\t'terminal.ansiBrightBlack': '#09000f',\n\t\t\t\t'terminal.ansiBrightRed': '#10000f',\n\t\t\t\t'terminal.ansiBrightGreen': '#11000f',\n\t\t\t\t'terminal.ansiBrightYellow': '#12000f',\n\t\t\t\t'terminal.ansiBrightBlue': '#13000f',\n\t\t\t\t'terminal.ansiBrightMagenta': '#14000f',\n\t\t\t\t'terminal.ansiBrightCyan': '#15000f',\n\t\t\t\t'terminal.ansiBrightWhite': '#16000f',\n\t\t\t}));\n\t\t\tdeepStrictEqual(xterm.raw.options.theme, {\n\t\t\t\tbackground: undefined,\n\t\t\t\tforeground: '#00020f',\n\t\t\t\tcursor: '#00030f',\n\t\t\t\tcursorAccent: '#00040f',\n\t\t\t\tselectionBackground: '#00050f',\n\t\t\t\tselectionInactiveBackground: '#00060f',\n\t\t\t\tselectionForeground: '#00070f',\n\t\t\t\tblack: '#01000f',\n\t\t\t\tgreen: '#03000f',\n\t\t\t\tred: '#02000f',\n\t\t\t\tyellow: '#04000f',\n\t\t\t\tblue: '#05000f',\n\t\t\t\tmagenta: '#06000f',\n\t\t\t\tcyan: '#07000f',\n\t\t\t\twhite: '#08000f',\n\t\t\t\tbrightBlack: '#09000f',\n\t\t\t\tbrightRed: '#10000f',\n\t\t\t\tbrightGreen: '#11000f',\n\t\t\t\tbrightYellow: '#12000f',\n\t\t\t\tbrightBlue: '#13000f',\n\t\t\t\tbrightMagenta: '#14000f',\n\t\t\t\tbrightCyan: '#15000f',\n\t\t\t\tbrightWhite: '#16000f',\n\t\t\t});\n\t\t});\n\t});\n\n\tsuite('renderers', () => {\n\t\t// This is skipped until the webgl renderer bug is fixed in Chromium\n\t\t// https://bugs.chromium.org/p/chromium/issues/detail?id=1476475\n\t\ttest.skip('should re-evaluate gpu acceleration auto when the setting is changed', async () => {\n\t\t\t// Check initial state\n\t\t\tstrictEqual(TestWebglAddon.isEnabled, false);\n\n\t\t\t// Open xterm as otherwise the webgl addon won't activate\n\t\t\tconst container = document.createElement('div');\n\t\t\txterm.attachToElement(container);\n\n\t\t\t// Auto should activate the webgl addon\n\t\t\tawait configurationService.setUserConfiguration('terminal', { integrated: { ...defaultTerminalConfig, gpuAcceleration: 'auto' } });\n\t\t\tconfigurationService.onDidChangeConfigurationEmitter.fire({ affectsConfiguration: () => true } as any);\n\t\t\tawait xterm.webglAddonPromise; // await addon activate\n\t\t\tif (isSafari) {\n\t\t\t\tstrictEqual(TestWebglAddon.isEnabled, false, 'The webgl renderer is always disabled on Safari');\n\t\t\t} else {\n\t\t\t\tstrictEqual(TestWebglAddon.isEnabled, true);\n\t\t\t}\n\n\t\t\t// Turn off to reset state\n\t\t\tawait configurationService.setUserConfiguration('terminal', { integrated: { ...defaultTerminalConfig, gpuAcceleration: 'off' } });\n\t\t\tconfigurationService.onDidChangeConfigurationEmitter.fire({ affectsConfiguration: () => true } as any);\n\t\t\tawait xterm.webglAddonPromise; // await addon activate\n\t\t\tstrictEqual(TestWebglAddon.isEnabled, false);\n\n\t\t\t// Set to auto again but throw when activating the webgl addon\n\t\t\tTestWebglAddon.shouldThrow = true;\n\t\t\tawait configurationService.setUserConfiguration('terminal', { integrated: { ...defaultTerminalConfig, gpuAcceleration: 'auto' } });\n\t\t\tconfigurationService.onDidChangeConfigurationEmitter.fire({ affectsConfiguration: () => true } as any);\n\t\t\tawait xterm.webglAddonPromise; // await addon activate\n\t\t\tstrictEqual(TestWebglAddon.isEnabled, false);\n\t\t});\n\t});\n});\n"]}