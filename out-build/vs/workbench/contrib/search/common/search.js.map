{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/search/common/search.ts"],"names":[],"mappings":"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","file":"search.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedExternalError } from 'vs/base/common/errors';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { ISearchConfiguration, ISearchConfigurationProperties } from 'vs/workbench/services/search/common/search';\nimport { SymbolKind, Location, ProviderResult, SymbolTag } from 'vs/editor/common/languages';\nimport { IWorkspaceContextService } from 'vs/platform/workspace/common/workspace';\nimport { URI } from 'vs/base/common/uri';\nimport { EditorResourceAccessor, SideBySideEditor } from 'vs/workbench/common/editor';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IRange, Range } from 'vs/editor/common/core/range';\nimport { isNumber } from 'vs/base/common/types';\nimport { RawContextKey } from 'vs/platform/contextkey/common/contextkey';\nimport { compare } from 'vs/base/common/strings';\nimport { groupBy } from 'vs/base/common/arrays';\n\nexport interface IWorkspaceSymbol {\n\tname: string;\n\tcontainerName?: string;\n\tkind: SymbolKind;\n\ttags?: SymbolTag[];\n\tlocation: Location;\n}\n\nexport interface IWorkspaceSymbolProvider {\n\tprovideWorkspaceSymbols(search: string, token: CancellationToken): ProviderResult<IWorkspaceSymbol[]>;\n\tresolveWorkspaceSymbol?(item: IWorkspaceSymbol, token: CancellationToken): ProviderResult<IWorkspaceSymbol>;\n}\n\nexport namespace WorkspaceSymbolProviderRegistry {\n\n\tconst _supports: IWorkspaceSymbolProvider[] = [];\n\n\texport function register(provider: IWorkspaceSymbolProvider): IDisposable {\n\t\tlet support: IWorkspaceSymbolProvider | undefined = provider;\n\t\tif (support) {\n\t\t\t_supports.push(support);\n\t\t}\n\n\t\treturn {\n\t\t\tdispose() {\n\t\t\t\tif (support) {\n\t\t\t\t\tconst idx = _supports.indexOf(support);\n\t\t\t\t\tif (idx >= 0) {\n\t\t\t\t\t\t_supports.splice(idx, 1);\n\t\t\t\t\t\tsupport = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\texport function all(): IWorkspaceSymbolProvider[] {\n\t\treturn _supports.slice(0);\n\t}\n}\n\nexport class WorkspaceSymbolItem {\n\tconstructor(readonly symbol: IWorkspaceSymbol, readonly provider: IWorkspaceSymbolProvider) { }\n}\n\nexport async function getWorkspaceSymbols(query: string, token: CancellationToken = CancellationToken.None): Promise<WorkspaceSymbolItem[]> {\n\n\tconst all: WorkspaceSymbolItem[] = [];\n\n\tconst promises = WorkspaceSymbolProviderRegistry.all().map(async provider => {\n\t\ttry {\n\t\t\tconst value = await provider.provideWorkspaceSymbols(query, token);\n\t\t\tif (!value) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (const symbol of value) {\n\t\t\t\tall.push(new WorkspaceSymbolItem(symbol, provider));\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tonUnexpectedExternalError(err);\n\t\t}\n\t});\n\n\tawait Promise.all(promises);\n\n\tif (token.isCancellationRequested) {\n\t\treturn [];\n\t}\n\n\t// de-duplicate entries\n\n\tfunction compareItems(a: WorkspaceSymbolItem, b: WorkspaceSymbolItem): number {\n\t\tlet res = compare(a.symbol.name, b.symbol.name);\n\t\tif (res === 0) {\n\t\t\tres = a.symbol.kind - b.symbol.kind;\n\t\t}\n\t\tif (res === 0) {\n\t\t\tres = compare(a.symbol.location.uri.toString(), b.symbol.location.uri.toString());\n\t\t}\n\t\tif (res === 0) {\n\t\t\tif (a.symbol.location.range && b.symbol.location.range) {\n\t\t\t\tif (!Range.areIntersecting(a.symbol.location.range, b.symbol.location.range)) {\n\t\t\t\t\tres = Range.compareRangesUsingStarts(a.symbol.location.range, b.symbol.location.range);\n\t\t\t\t}\n\t\t\t} else if (a.provider.resolveWorkspaceSymbol && !b.provider.resolveWorkspaceSymbol) {\n\t\t\t\tres = -1;\n\t\t\t} else if (!a.provider.resolveWorkspaceSymbol && b.provider.resolveWorkspaceSymbol) {\n\t\t\t\tres = 1;\n\t\t\t}\n\t\t}\n\t\tif (res === 0) {\n\t\t\tres = compare(a.symbol.containerName ?? '', b.symbol.containerName ?? '');\n\t\t}\n\t\treturn res;\n\t}\n\n\treturn groupBy(all, compareItems).map(group => group[0]).flat();\n}\n\nexport interface IWorkbenchSearchConfigurationProperties extends ISearchConfigurationProperties {\n\tquickOpen: {\n\t\tincludeSymbols: boolean;\n\t\tincludeHistory: boolean;\n\t\thistory: {\n\t\t\tfilterSortOrder: 'default' | 'recency';\n\t\t};\n\t};\n}\n\nexport interface IWorkbenchSearchConfiguration extends ISearchConfiguration {\n\tsearch: IWorkbenchSearchConfigurationProperties;\n}\n\n/**\n * Helper to return all opened editors with resources not belonging to the currently opened workspace.\n */\nexport function getOutOfWorkspaceEditorResources(accessor: ServicesAccessor): URI[] {\n\tconst editorService = accessor.get(IEditorService);\n\tconst contextService = accessor.get(IWorkspaceContextService);\n\tconst fileService = accessor.get(IFileService);\n\n\tconst resources = editorService.editors\n\t\t.map(editor => EditorResourceAccessor.getOriginalUri(editor, { supportSideBySide: SideBySideEditor.PRIMARY }))\n\t\t.filter(resource => !!resource && !contextService.isInsideWorkspace(resource) && fileService.hasProvider(resource));\n\n\treturn resources as URI[];\n}\n\n// Supports patterns of <path><#|:|(><line><#|:|,><col?><:?>\nconst LINE_COLON_PATTERN = /\\s?[#:\\(](?:line )?(\\d*)(?:[#:,](\\d*))?\\)?:?\\s*$/;\n\nexport interface IFilterAndRange {\n\tfilter: string;\n\trange: IRange;\n}\n\nexport function extractRangeFromFilter(filter: string, unless?: string[]): IFilterAndRange | undefined {\n\t// Ignore when the unless character not the first character or is before the line colon pattern\n\tif (!filter || unless?.some(value => {\n\t\tconst unlessCharPos = filter.indexOf(value);\n\t\treturn unlessCharPos === 0 || unlessCharPos > 0 && !LINE_COLON_PATTERN.test(filter.substring(unlessCharPos + 1));\n\t})) {\n\t\treturn undefined;\n\t}\n\n\tlet range: IRange | undefined = undefined;\n\n\t// Find Line/Column number from search value using RegExp\n\tconst patternMatch = LINE_COLON_PATTERN.exec(filter);\n\n\tif (patternMatch) {\n\t\tconst startLineNumber = parseInt(patternMatch[1] ?? '', 10);\n\n\t\t// Line Number\n\t\tif (isNumber(startLineNumber)) {\n\t\t\trange = {\n\t\t\t\tstartLineNumber: startLineNumber,\n\t\t\t\tstartColumn: 1,\n\t\t\t\tendLineNumber: startLineNumber,\n\t\t\t\tendColumn: 1\n\t\t\t};\n\n\t\t\t// Column Number\n\t\t\tconst startColumn = parseInt(patternMatch[2] ?? '', 10);\n\t\t\tif (isNumber(startColumn)) {\n\t\t\t\trange = {\n\t\t\t\t\tstartLineNumber: range.startLineNumber,\n\t\t\t\t\tstartColumn: startColumn,\n\t\t\t\t\tendLineNumber: range.endLineNumber,\n\t\t\t\t\tendColumn: startColumn\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// User has typed \"something:\" or \"something#\" without a line number, in this case treat as start of file\n\t\telse if (patternMatch[1] === '') {\n\t\t\trange = {\n\t\t\t\tstartLineNumber: 1,\n\t\t\t\tstartColumn: 1,\n\t\t\t\tendLineNumber: 1,\n\t\t\t\tendColumn: 1\n\t\t\t};\n\t\t}\n\t}\n\n\tif (patternMatch && range) {\n\t\treturn {\n\t\t\tfilter: filter.substr(0, patternMatch.index), // clear range suffix from search value\n\t\t\trange\n\t\t};\n\t}\n\n\treturn undefined;\n}\n\nexport enum SearchUIState {\n\tIdle,\n\tSearching,\n\tSlowSearch\n}\n\nexport const SearchStateKey = new RawContextKey<SearchUIState>('searchState', SearchUIState.Idle);\n"]}