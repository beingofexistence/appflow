{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/search/browser/notebookSearchService.ts"],"names":[],"mappings":"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","file":"notebookSearchService.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { streamToBuffer } from 'vs/base/common/buffer';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { IRelativePattern } from 'vs/base/common/glob';\nimport { ResourceSet, ResourceMap } from 'vs/base/common/map';\nimport { URI } from 'vs/base/common/uri';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IUriIdentityService } from 'vs/platform/uriIdentity/common/uriIdentity';\nimport { NotebookEditorWidget } from 'vs/workbench/contrib/notebook/browser/notebookEditorWidget';\nimport { INotebookEditorService } from 'vs/workbench/contrib/notebook/browser/services/notebookEditorService';\nimport { NotebookCellTextModel } from 'vs/workbench/contrib/notebook/common/model/notebookCellTextModel';\nimport { NotebookTextModel } from 'vs/workbench/contrib/notebook/common/model/notebookTextModel';\nimport { INotebookExclusiveDocumentFilter, NotebookData } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { INotebookSerializer, INotebookService, SimpleNotebookProviderInfo } from 'vs/workbench/contrib/notebook/common/notebookService';\nimport { INotebookSearchService } from 'vs/workbench/contrib/search/common/notebookSearch';\nimport { IFileMatchWithCells, ICellMatch, CellSearchModel, contentMatchesToTextSearchMatches, webviewMatchesToTextSearchMatches, genericCellMatchesToTextSearchMatches } from 'vs/workbench/contrib/search/browser/searchNotebookHelpers';\nimport { IEditorResolverService, priorityToRank } from 'vs/workbench/services/editor/common/editorResolverService';\nimport { ITextQuery, QueryType, ISearchProgressItem, ISearchComplete, ISearchConfigurationProperties, IFileQuery, ISearchService } from 'vs/workbench/services/search/common/search';\nimport * as arrays from 'vs/base/common/arrays';\nimport { isNumber } from 'vs/base/common/types';\n\ninterface INotebookDataEditInfo {\n\tnotebookData: NotebookData;\n\tmTime: number;\n}\n\ninterface INotebookSearchMatchResults {\n\tresults: ResourceMap<IFileMatchWithCells | null>;\n\tlimitHit: boolean;\n}\n\nclass NotebookDataCache {\n\tprivate _entries: ResourceMap<INotebookDataEditInfo>;\n\t// private _serializer: INotebookSerializer | undefined;\n\n\tconstructor(\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@INotebookService private readonly notebookService: INotebookService,\n\t\t@IEditorResolverService private readonly editorResolverService: IEditorResolverService,\n\t) {\n\t\tthis._entries = new ResourceMap<INotebookDataEditInfo>(uri => this.uriIdentityService.extUri.getComparisonKey(uri));\n\t}\n\n\tprivate async getSerializer(notebookUri: URI): Promise<INotebookSerializer | undefined> {\n\t\tconst registeredEditorInfo = this.editorResolverService.getEditors(notebookUri);\n\t\tconst priorityEditorInfo = registeredEditorInfo.reduce((acc, val) =>\n\t\t\tpriorityToRank(acc.priority) > priorityToRank(val.priority) ? acc : val\n\t\t);\n\t\tconst info = await this.notebookService.withNotebookDataProvider(priorityEditorInfo.id);\n\t\tif (!(info instanceof SimpleNotebookProviderInfo)) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn info.serializer;\n\t}\n\n\tasync getNotebookData(notebookUri: URI): Promise<NotebookData> {\n\t\tconst mTime = (await this.fileService.stat(notebookUri)).mtime;\n\n\t\tconst entry = this._entries.get(notebookUri);\n\n\t\tif (entry && entry.mTime === mTime) {\n\t\t\treturn entry.notebookData;\n\t\t} else {\n\n\t\t\tlet _data: NotebookData = {\n\t\t\t\tmetadata: {},\n\t\t\t\tcells: []\n\t\t\t};\n\n\t\t\tconst content = await this.fileService.readFileStream(notebookUri);\n\t\t\tconst bytes = await streamToBuffer(content.value);\n\t\t\tconst serializer = await this.getSerializer(notebookUri);\n\t\t\tif (!serializer) {\n\t\t\t\t//unsupported\n\t\t\t\tthrow new Error(`serializer not initialized`);\n\t\t\t}\n\t\t\t_data = await serializer.dataToNotebook(bytes);\n\t\t\tthis._entries.set(notebookUri, { notebookData: _data, mTime });\n\t\t\treturn _data;\n\t\t}\n\t}\n\n}\n\nexport class NotebookSearchService implements INotebookSearchService {\n\tdeclare readonly _serviceBrand: undefined;\n\tprivate _notebookDataCache: NotebookDataCache;\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@INotebookEditorService private readonly notebookEditorService: INotebookEditorService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@INotebookService private readonly notebookService: INotebookService,\n\t\t@ISearchService private readonly searchService: ISearchService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\n\t) {\n\t\tthis._notebookDataCache = this.instantiationService.createInstance(NotebookDataCache);\n\t}\n\n\tprivate async runFileQueries(includes: (string)[], token: CancellationToken, textQuery: ITextQuery): Promise<URI[]> {\n\t\tconst promises = includes.map(include => {\n\t\t\tconst query: IFileQuery = {\n\t\t\t\ttype: QueryType.File,\n\t\t\t\tfilePattern: include,\n\t\t\t\tfolderQueries: textQuery.folderQueries,\n\t\t\t\tmaxResults: textQuery.maxResults,\n\t\t\t};\n\t\t\treturn this.searchService.fileSearch(\n\t\t\t\tquery,\n\t\t\t\ttoken\n\t\t\t);\n\t\t});\n\t\tconst result = (await Promise.all(promises)).map(sc => sc.results.map(fm => fm.resource)).flat();\n\t\tconst uris = new ResourceSet(result, uri => this.uriIdentityService.extUri.getComparisonKey(uri));\n\t\treturn Array.from(uris.keys());\n\t}\n\n\tnotebookSearch(query: ITextQuery, token: CancellationToken | undefined, searchInstanceID: string, onProgress?: (result: ISearchProgressItem) => void): {\n\t\topenFilesToScan: ResourceSet;\n\t\tcompleteData: Promise<ISearchComplete>;\n\t\tallScannedFiles: Promise<ResourceSet>;\n\t} {\n\n\t\tif (query.type !== QueryType.Text) {\n\t\t\treturn {\n\t\t\t\topenFilesToScan: new ResourceSet(),\n\t\t\t\tcompleteData: Promise.resolve({\n\t\t\t\t\tmessages: [],\n\t\t\t\t\tlimitHit: false,\n\t\t\t\t\tresults: [],\n\t\t\t\t}),\n\t\t\t\tallScannedFiles: Promise.resolve(new ResourceSet()),\n\t\t\t};\n\t\t}\n\n\t\tconst localNotebookWidgets = this.getLocalNotebookWidgets();\n\t\tconst localNotebookFiles = localNotebookWidgets.map(widget => widget.viewModel!.uri);\n\t\tconst getAllResults = (): { completeData: Promise<ISearchComplete>; allScannedFiles: Promise<ResourceSet> } => {\n\t\t\tconst searchStart = Date.now();\n\n\t\t\tconst localResultPromise = this.getLocalNotebookResults(query, token ?? CancellationToken.None, localNotebookWidgets, searchInstanceID);\n\t\t\tconst searchLocalEnd = Date.now();\n\n\t\t\tconst experimentalNotebooksEnabled = this.configurationService.getValue<ISearchConfigurationProperties>('search').experimental?.closedNotebookRichContentResults ?? false;\n\n\t\t\tlet closedResultsPromise: Promise<INotebookSearchMatchResults | undefined> = Promise.resolve(undefined);\n\t\t\tif (experimentalNotebooksEnabled) {\n\t\t\t\tclosedResultsPromise = this.getClosedNotebookResults(query, new ResourceSet(localNotebookFiles, uri => this.uriIdentityService.extUri.getComparisonKey(uri)), token ?? CancellationToken.None);\n\t\t\t}\n\n\t\t\tconst promise = Promise.all([localResultPromise, closedResultsPromise]);\n\t\t\treturn {\n\t\t\t\tcompleteData: promise.then(resolvedPromise => {\n\t\t\t\t\tconst resolved = resolvedPromise.filter((e): e is INotebookSearchMatchResults => !!e);\n\t\t\t\t\tconst resultArray = resolved.map(elem => elem.results);\n\t\t\t\t\tconst results = arrays.coalesce(resultArray.flatMap(map => Array.from(map.values())));\n\t\t\t\t\tif (onProgress) {\n\t\t\t\t\t\tresults.forEach(onProgress);\n\t\t\t\t\t}\n\t\t\t\t\tthis.logService.trace(`local notebook search time | ${searchLocalEnd - searchStart}ms`);\n\t\t\t\t\treturn <ISearchComplete>{\n\t\t\t\t\t\tmessages: [],\n\t\t\t\t\t\tlimitHit: resolved.reduce((prev, cur) => prev || cur.limitHit, false),\n\t\t\t\t\t\tresults,\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\tallScannedFiles: promise.then(resolvedPromise => {\n\t\t\t\t\tconst resolved = resolvedPromise.filter((e): e is INotebookSearchMatchResults => !!e);\n\t\t\t\t\tconst resultArray = resolved.map(elem => elem.results);\n\t\t\t\t\treturn new ResourceSet(resultArray.flatMap(map => Array.from(map.keys())), uri => this.uriIdentityService.extUri.getComparisonKey(uri));\n\t\t\t\t})\n\t\t\t};\n\t\t};\n\t\tconst promiseResults = getAllResults();\n\t\treturn {\n\t\t\topenFilesToScan: new ResourceSet(localNotebookFiles),\n\t\t\tcompleteData: promiseResults.completeData,\n\t\t\tallScannedFiles: promiseResults.allScannedFiles\n\t\t};\n\t}\n\n\tprivate async getClosedNotebookResults(textQuery: ITextQuery, scannedFiles: ResourceSet, token: CancellationToken): Promise<INotebookSearchMatchResults> {\n\t\tconst infoProviders = this.notebookService.getContributedNotebookTypes();\n\t\tconst includes = infoProviders.flatMap(\n\t\t\t(provider) => {\n\t\t\t\treturn provider.selectors.map((selector) => {\n\t\t\t\t\tconst globPattern = (selector as INotebookExclusiveDocumentFilter).include || selector as IRelativePattern | string;\n\t\t\t\t\treturn globPattern.toString();\n\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\n\t\tconst results = new ResourceMap<IFileMatchWithCells | null>(uri => this.uriIdentityService.extUri.getComparisonKey(uri));\n\n\t\tconst start = Date.now();\n\n\t\tconst filesToScan = await this.runFileQueries(includes, token, textQuery);\n\t\tconst deserializedNotebooks = new ResourceMap<NotebookTextModel>();\n\t\tconst textModels = this.notebookService.getNotebookTextModels();\n\t\tfor (const notebook of textModels) {\n\t\t\tdeserializedNotebooks.set(notebook.uri, notebook);\n\t\t}\n\n\t\tconst promises = filesToScan.map(async (uri) => {\n\t\t\tconst cellMatches: ICellMatch[] = [];\n\t\t\tif (scannedFiles.has(uri)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst notebook = deserializedNotebooks.get(uri) ?? (await this._notebookDataCache.getNotebookData(uri));\n\t\t\t\tconst cells = notebook.cells;\n\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcells.forEach((cell, index) => {\n\t\t\t\t\tconst target = textQuery.contentPattern.pattern;\n\t\t\t\t\tconst cellModel = cell instanceof NotebookCellTextModel ? new CellSearchModel('', cell.textBuffer, cell.outputs.flatMap(value => value.outputs), uri, index) : new CellSearchModel(cell.source, undefined, cell.outputs.flatMap(value => value.outputs), uri, index);\n\n\t\t\t\t\tconst inputMatches = cellModel.findInInputs(target);\n\t\t\t\t\tconst outputMatches = cellModel.findInOutputs(target);\n\t\t\t\t\tconst webviewResults = outputMatches\n\t\t\t\t\t\t.flatMap(outputMatch =>\n\t\t\t\t\t\t\tgenericCellMatchesToTextSearchMatches(outputMatch.matches, outputMatch.textBuffer, cellModel))\n\t\t\t\t\t\t.map((textMatch, index) => {\n\t\t\t\t\t\t\ttextMatch.webviewIndex = index;\n\t\t\t\t\t\t\treturn textMatch;\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (inputMatches.length > 0 || outputMatches.length > 0) {\n\t\t\t\t\t\tconst cellMatch: ICellMatch = {\n\t\t\t\t\t\t\tcell: cellModel,\n\t\t\t\t\t\t\tindex: index,\n\t\t\t\t\t\t\tcontentResults: contentMatchesToTextSearchMatches(inputMatches, cellModel),\n\t\t\t\t\t\t\twebviewResults\n\t\t\t\t\t\t};\n\t\t\t\t\t\tcellMatches.push(cellMatch);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tconst fileMatch = cellMatches.length > 0 ? {\n\t\t\t\t\tresource: uri, cellResults: cellMatches\n\t\t\t\t} : null;\n\t\t\t\tresults.set(uri, fileMatch);\n\t\t\t\treturn;\n\n\t\t\t} catch (e) {\n\t\t\t\tthis.logService.info('error: ' + e);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t});\n\n\t\tawait Promise.all(promises);\n\t\tconst end = Date.now();\n\n\t\tthis.logService.trace(`query: ${textQuery.contentPattern.pattern}`);\n\t\tthis.logService.trace(`closed notebook search time | ${end - start}ms`);\n\t\treturn {\n\t\t\tresults: results,\n\t\t\tlimitHit: false\n\t\t};\n\t}\n\n\tprivate async getLocalNotebookResults(query: ITextQuery, token: CancellationToken, widgets: Array<NotebookEditorWidget>, searchID: string): Promise<INotebookSearchMatchResults> {\n\t\tconst localResults = new ResourceMap<IFileMatchWithCells | null>(uri => this.uriIdentityService.extUri.getComparisonKey(uri));\n\t\tlet limitHit = false;\n\n\t\tfor (const widget of widgets) {\n\t\t\tif (!widget.viewModel) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst askMax = isNumber(query.maxResults) ? query.maxResults + 1 : Number.MAX_SAFE_INTEGER;\n\t\t\tlet matches = await widget\n\t\t\t\t.find(query.contentPattern.pattern, {\n\t\t\t\t\tregex: query.contentPattern.isRegExp,\n\t\t\t\t\twholeWord: query.contentPattern.isWordMatch,\n\t\t\t\t\tcaseSensitive: query.contentPattern.isCaseSensitive,\n\t\t\t\t\tincludeMarkupInput: query.contentPattern.notebookInfo?.isInNotebookMarkdownInput ?? true,\n\t\t\t\t\tincludeMarkupPreview: query.contentPattern.notebookInfo?.isInNotebookMarkdownPreview ?? true,\n\t\t\t\t\tincludeCodeInput: query.contentPattern.notebookInfo?.isInNotebookCellInput ?? true,\n\t\t\t\t\tincludeOutput: query.contentPattern.notebookInfo?.isInNotebookCellOutput ?? true,\n\t\t\t\t}, token, false, true, searchID);\n\n\n\t\t\tif (matches.length) {\n\t\t\t\tif (askMax && matches.length >= askMax) {\n\t\t\t\t\tlimitHit = true;\n\t\t\t\t\tmatches = matches.slice(0, askMax - 1);\n\t\t\t\t}\n\t\t\t\tconst cellResults: ICellMatch[] = matches.map(match => {\n\t\t\t\t\tconst contentResults = contentMatchesToTextSearchMatches(match.contentMatches, match.cell);\n\t\t\t\t\tconst webviewResults = webviewMatchesToTextSearchMatches(match.webviewMatches);\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcell: match.cell,\n\t\t\t\t\t\tindex: match.index,\n\t\t\t\t\t\tcontentResults: contentResults,\n\t\t\t\t\t\twebviewResults: webviewResults,\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tconst fileMatch: IFileMatchWithCells = {\n\t\t\t\t\tresource: widget.viewModel.uri, cellResults: cellResults\n\t\t\t\t};\n\t\t\t\tlocalResults.set(widget.viewModel.uri, fileMatch);\n\t\t\t} else {\n\t\t\t\tlocalResults.set(widget.viewModel.uri, null);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tresults: localResults,\n\t\t\tlimitHit\n\t\t};\n\t}\n\n\n\tprivate getLocalNotebookWidgets(): Array<NotebookEditorWidget> {\n\t\tconst notebookWidgets = this.notebookEditorService.retrieveAllExistingWidgets();\n\t\treturn notebookWidgets\n\t\t\t.map(widget => widget.value)\n\t\t\t.filter((val): val is NotebookEditorWidget => !!val && !!(val.viewModel));\n\t}\n}\n"]}