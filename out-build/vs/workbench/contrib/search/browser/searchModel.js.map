{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/search/browser/searchModel.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;;IA0ChG,MAAa,IAAI;iBAEQ,MAAC,GAAmB,GAAG,CAAC;QAQhD,YAAsB,CAAa,EAAe,CAA2B,EAAE,iBAA+B,EAAE,cAA4B;YAAtH,MAAC,GAAD,CAAC,CAAY;YAAe,MAAC,GAAD,CAAC,CAA0B;YAC5E,IAAI,CAAC,CAAC,GAAqB,CAAC,CAAiB,iBAAiB,CAAC,eAAe,CAAC,CAAC;YAChF,MAAM,cAAc,GAAG,iBAAiB,CAAC,eAAe,KAAK,iBAAiB,CAAC,aAAa,CAAC,CAAC;gBAC7F,iBAAiB,CAAC,SAAS,CAAC,CAAC;gBAC7B,IAAI,CAAC,CAAC,CAAmB,MAAM,CAAC;YACjC,IAAI,CAAC,CAAC,GAAqB,IAAI,YAAG,CAAU,CAAC,EAAE,iBAAiB,CAAC,WAAW,GAAG,CAAC,EAAE,cAAc,GAAG,CAAC,CAAC,CAAC;YAEtG,IAAI,CAAC,CAAC,GAAQ,IAAI,WAAG,CACpB,cAAc,CAAC,eAAe,GAAG,CAAC,EAClC,cAAc,CAAC,WAAW,GAAG,CAAC,EAC9B,cAAc,CAAC,aAAa,GAAG,CAAC,EAChC,cAAc,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC;YAE/B,IAAI,CAAC,CAAC,GAAmB,iBAAiB,CAAC;YAE3C,IAAI,CAAC,CAAC,GAAK,IAAI,CAAC,CAAC,CAAO,EAAE,EAAE,GAAG,GAAG,GAAG,IAAI,CAAC,CAAC,GAAQ,IAAI,CAAC,cAAc,EAAE,CAAC;QAC1E,CAAC;QAED,EAAE;YACD,OAAO,IAAI,CAAC,CAAC,CAAG;QACjB,CAAC;QAED,MAAM;YACL,OAAO,IAAI,CAAC,CAAC,CAAO;QACrB,CAAC;QAED,IAAI;YACH,OAAO,IAAI,CAAC,CAAC,CAAmB;QACjC,CAAC;QAED,KAAK;YACJ,OAAO,IAAI,CAAC,CAAC,CAAM;QACpB,CAAC;QAGD,OAAO;YACN,IAAI,MAAM,GAAG,IAAI,CAAC,CAAC,CAAmB,SAAS,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAmB,WAAW,GAAG,CAAC,CAAC,EAC3F,MAAM,GAAG,IAAI,CAAC,cAAc,EAAE,EAC9B,KAAK,GAAG,IAAI,CAAC,CAAC,CAAmB,SAAS,CAAC,IAAI,CAAC,CAAC,CAAmB,SAAS,GAAG,CAAC,CAAC,CAAC;YAEpF,MAAM,GAAG,IAAA,aAAG,EAAE,MAAM,EAAE,EAAE,CAAC,CAAC;YAC1B,MAAM,GAAG,MAAM,CAAC,SAAS,EAAE,CAAC;YAE5B,IAAI,cAAc,GAAG,IAAI,CAAE,CAAC,GAAmB,MAAM,CAAC,MAAM,CAAC;YAC7D,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,cAAc,CAAC,CAAC;YAC1C,cAAc,IAAI,MAAM,CAAC,MAAM,CAAC;YAChC,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,cAAc,CAAC,CAAC;YAExC,OAAO;gBACN,MAAM;gBACN,MAAM;gBACN,KAAK;aACL,CAAC;QACH,CAAC;QAED,IAAI,aAAa;YAChB,MAAM,WAAW,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,MAAM,EAAE,CAAC,WAAW,CAAC;YACvD,IAAI,CAAC,WAAW,CAAC,cAAc,EAAE;gBAChC,MAAM,IAAI,KAAK,CAAC,uEAAuE,CAAC,CAAC;aACzF;YAED,MAAM,aAAa,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC;YAC3C,IAAI,aAAa,GAAG,WAAW,CAAC,cAAc,CAAC,gBAAgB,CAAC,aAAa,EAAE,WAAW,CAAC,YAAY,CAAC,CAAC;YACzG,IAAI,aAAa,KAAK,IAAI,EAAE;gBAC3B,OAAO,aAAa,CAAC;aACrB;YAED,qFAAqF;YACrF,MAAM,sBAAsB,GAAG,aAAa,CAAC,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YACpE,IAAI,sBAAsB,KAAK,aAAa,EAAE;gBAC7C,aAAa,GAAG,WAAW,CAAC,cAAc,CAAC,gBAAgB,CAAC,sBAAsB,EAAE,WAAW,CAAC,YAAY,CAAC,CAAC;gBAC9G,IAAI,aAAa,KAAK,IAAI,EAAE;oBAC3B,OAAO,aAAa,CAAC;iBACrB;aACD;YAED,gFAAgF;YAChF,MAAM,sCAAsC,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;YACxE,aAAa,GAAG,WAAW,CAAC,cAAc,CAAC,gBAAgB,CAAC,sCAAsC,EAAE,WAAW,CAAC,YAAY,CAAC,CAAC;YAC9H,IAAI,aAAa,KAAK,IAAI,EAAE;gBAC3B,OAAO,aAAa,CAAC;aACrB;YAED,gEAAgE;YAChE,MAAM,yBAAyB,GAAG,sCAAsC,CAAC,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YAChG,IAAI,yBAAyB,KAAK,sCAAsC,EAAE;gBACzE,aAAa,GAAG,WAAW,CAAC,cAAc,CAAC,gBAAgB,CAAC,yBAAyB,EAAE,WAAW,CAAC,YAAY,CAAC,CAAC;gBACjH,IAAI,aAAa,KAAK,IAAI,EAAE;oBAC3B,OAAO,aAAa,CAAC;iBACrB;aACD;YAED,iFAAiF;YACjF,OAAO,WAAW,CAAC,cAAc,CAAC,OAAO,CAAC;QAC3C,CAAC;QAED,aAAa,CAAC,kBAAkB,GAAG,KAAK;YACvC,IAAI,qBAA+B,CAAC;YACpC,IAAI,kBAAkB,EAAE;gBACvB,qBAAqB,GAAG,IAAI,CAAC,CAAC,CAAiB;aAC/C;iBAAM;gBACN,qBAAqB,GAAG,IAAI,CAAC,CAAC,CAAiB,KAAK,CAAC,IAAI,CAAC,CAAC,CAAiB,eAAe,EAAE,IAAI,CAAC,CAAC,CAAiB,aAAa,GAAG,CAAC,CAAC,CAAC;gBACvI,qBAAqB,CAAC,qBAAqB,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,qBAAqB,CAAC,qBAAqB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAiB,SAAS,CAAC,CAAC;gBAC7J,qBAAqB,CAAC,CAAC,CAAC,GAAG,qBAAqB,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAiB,WAAW,CAAC,CAAC;aAC9F;YAED,OAAO,qBAAqB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACzC,CAAC;QAED,cAAc;YACb,wCAAwC;YACxC,OAAO;gBACN,GAAG,IAAI,CAAC,CAAC;gBACT,WAAW,EAAE,IAAI,CAAC,CAAC,CAAiB,WAAW,GAAG,CAAC;gBACnD,SAAS,EAAE,IAAI,CAAC,CAAC,CAAiB,SAAS,GAAG,CAAC;aAC/C,CAAC;QACH,CAAC;QAED,gBAAgB;YACf,OAAO,IAAI,CAAC,CAAC,CAAiB,KAAK,CAAC,IAAI,CAAC,CAAC,CAAiB,eAAe,EAAE,IAAI,CAAC,CAAC,CAAiB,aAAa,GAAG,CAAC,CAAC,CAAC;QACvH,CAAC;QAED,cAAc;YACb,OAAO,IAAI,CAAC,CAAC,CAAmB,SAAS,CAAC,IAAI,CAAC,CAAC,CAAmB,WAAW,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,CAAmB,SAAS,GAAG,CAAC,CAAC,CAAC;QAC7H,CAAC;;IAtIF,oBAuIC;IA1FA;QADC,gBAAG;uCAmBH;IA0EF,MAAa,IAAI;QAKhB,YACkB,CAAa,EACtB,CAA4B,EACnB,CAAkB;YAFlB,MAAC,GAAD,CAAC,CAAY;YACtB,MAAC,GAAD,CAAC,CAA2B;YACnB,MAAC,GAAD,CAAC,CAAiB;YAGnC,IAAI,CAAC,CAAC,GAAiB,IAAI,GAAG,EAA2B,CAAC;YAC1D,IAAI,CAAC,CAAC,GAAiB,IAAI,GAAG,EAA2B,CAAC;YAC1D,IAAI,CAAC,CAAC,GAAU,IAAI,GAAG,EAAkB,CAAC;QAC3C,CAAC;QAED,IAAI,OAAO;YACV,OAAO,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC,CAAQ,CAAC;QAC/B,CAAC;QAED,OAAO;YACN,OAAO,CAAC,GAAG,IAAI,CAAC,CAAC,CAAe,MAAM,EAAE,EAAE,GAAI,IAAI,CAAC,CAAC,CAAe,MAAM,EAAE,CAAC,CAAC;QAC9E,CAAC;QAED,IAAI,cAAc;YACjB,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAe,MAAM,EAAE,CAAC,CAAC;QAClD,CAAC;QAED,IAAI,cAAc;YACjB,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAe,MAAM,EAAE,CAAC,CAAC;QAClD,CAAC;QAED,MAAM,CAAC,OAA4C;YAClD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;gBAC5B,OAAO,GAAG,CAAC,OAAO,CAAC,CAAC;aACpB;YACD,KAAK,MAAM,KAAK,IAAI,OAAO,EAAE;gBAC5B,IAAI,CAAC,CAAC,CAAe,MAAM,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC;gBACxC,IAAI,CAAC,CAAC,CAAe,MAAM,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC;aACxC;QACF,CAAC;QAED,eAAe;YACd,IAAI,CAAC,CAAC,CAAe,KAAK,EAAE,CAAC;YAC7B,IAAI,CAAC,CAAC,CAAe,KAAK,EAAE,CAAC;QAC9B,CAAC;QAED,iBAAiB,CAAC,iBAAqC;YACtD,MAAM,cAAc,GAAG,IAAI,CAA+B,iBAAiB,EAAE,IAAI,CAAC,CAAC;YACnF,cAAc,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,EAAE;gBAChC,IAAI,CAAC,CAAC,CAAe,GAAG,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC;YAC7C,CAAC,CAAC,CAAC;YACH,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,CAAC;QACpC,CAAC;QAEM,UAAU,CAAC,iBAAqC;YACtD,IAAI,IAAI,CAAC,IAAI,YAAY,4BAAI,EAAa;gBACzC,qDAAqD;gBACrD,OAAO;aACP;YACD,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC,IAAI,CAAC,CAAC,SAAS,EAAE,EAAE;gBAC/C,MAAM,sBAAsB,GAAG,IAAA,oBAAI,EAAsB,iBAAiB,EAAE,SAAS,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,KAAM,CAAC,CAAC;gBACpH,MAAM,QAAQ,GAAG,sBAAsB,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,IAAA,YAAG,EAAW,MAAM,CAAC,CAA0C,CAAC,CAAC;gBAC5H,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,EAAE,GAAG,OAAO,EAAE,UAAU,EAAE,OAAO,CAAC,UAAU,GAAG,CAAC,EAAE,CAAC,CAAC;qBAC3E,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,GAAG,IAAI,CAAC,CAAC,CAAQ,GAAG,CAAC,OAAO,CAAC,UAAU,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAClF,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,iBAAiB,CAAC,iBAAqC;YACtD,MAAM,cAAc,GAAG,IAAI,CAA+B,iBAAiB,EAAE,IAAI,CAAC,CAAC;YACnF,cAAc,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,EAAE;gBAChC,IAAI,CAAC,CAAC,CAAe,GAAG,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC;YAC7C,CAAC,CAAC,CAAC;YACH,uCAAuC;QACxC,CAAC;QAGD,YAAY,CAAC,IAAoB;YAChC,IAAI,CAAC,CAAC,GAAO,IAAI,CAAC;QACnB,CAAC;QAED,IAAI,MAAM;YACT,OAAO,IAAI,CAAC,CAAC,CAAO;QACrB,CAAC;QAED,IAAI,EAAE;YACL,OAAO,IAAI,CAAC,CAAC,CAAK,EAAE,CAAC;QACtB,CAAC;QAED,IAAI,SAAS;YACZ,OAAO,IAAI,CAAC,CAAC,CAAU;QACxB,CAAC;QAED,IAAI,IAAI;YACP,OAAO,IAAI,CAAC,CAAC,CAAK;QACnB,CAAC;KAED;IAjGD,oBAiGC;IAED,MAAa,IAAgB,SAAQ,IAAI;QAGxC,YAA6B,CAAiB,EAAO,iBAA2B,EAAE,iBAA+B,EAAE,cAA4B,EAAE,YAAqB;YACrK,KAAK,CAAC,CAAC,CAAW,MAAM,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,cAAc,CAAC,CAAC;YADpD,MAAC,GAAD,CAAC,CAAgB;YAE7C,IAAI,CAAC,CAAC,GAAK,IAAI,CAAC,CAAC,CAAO,EAAE,EAAE,GAAG,GAAG,GAAG,IAAI,CAAC,CAAC,CAAW,SAAS,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC,GAAG,GAAG,YAAY,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,CAAC,EAAwB,GAAG,IAAI,CAAC,CAAC,GAAQ,IAAI,CAAC,cAAc,EAAE,CAAC;YACxL,IAAI,CAAC,CAAC,GAAe,YAAY,CAAC;QACnC,CAAC;QAEQ,MAAM;YACd,OAAO,IAAI,CAAC,CAAC,CAAW,MAAM,CAAC;QAChC,CAAC;QAED,IAAI,UAAU;YACb,OAAO,IAAI,CAAC,CAAC,CAAW;QACzB,CAAC;QAEO,CAAC;YACR,OAAO,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC;QACtD,CAAC;QAEM,cAAc;YACpB,OAAO,IAAI,CAAC,CAAC,KAAiB,SAAS,CAAC;QACzC,CAAC;QAED,IAAI,SAAS;YACZ,OAAO,IAAI,CAAC,CAAC,CAAW,SAAS,CAAC;QACnC,CAAC;QAED,IAAI,YAAY;YACf,OAAO,IAAI,CAAC,CAAC,CAAa;QAC3B,CAAC;QAED,IAAI,IAAI;YACP,OAAO,IAAI,CAAC,CAAC,CAAW,IAAI,CAAC;QAC9B,CAAC;KACD;IApCD,oBAoCC;IAGM,IAAM,IAAI,GAAV,MAAM,IAAU,SAAQ,eAAG;;iBAET,MAAC,GAAqB,eAAG,CAAoB,QAAQ,CAAC;YAC7E,WAAW,EAAE,2BAA2B;YACxC,UAAU,4DAAoD;YAC9D,MAAM,EAAE,EAAE;YACV,SAAS,EAAE,kBAAkB;YAC7B,aAAa,EAAE;gBACd,KAAK,EAAE,IAAA,kBAAG,EAAc,mBAAG,CAA8B;gBACzD,QAAQ,EAAE,yBAAiB,CAAC,MAAM;aAClC;YACD,OAAO,EAAE;gBACR,KAAK,EAAE,IAAA,kBAAG,EAAc,mBAAG,CAAc;gBACzC,QAAQ,EAAE,uBAAe,CAAC,MAAM;aAChC;SACD,CAbwB,AAavB,CAAC;iBAEqB,MAAC,GAAa,eAAG,CAAoB,QAAQ,CAAC;YACrE,WAAW,EAAE,mBAAmB;YAChC,UAAU,4DAAoD;YAC9D,SAAS,EAAE,WAAW;YACtB,aAAa,EAAE;gBACd,KAAK,EAAE,IAAA,kBAAG,EAAc,mBAAG,CAA8B;gBACzD,QAAQ,EAAE,yBAAiB,CAAC,MAAM;aAClC;YACD,OAAO,EAAE;gBACR,KAAK,EAAE,IAAA,kBAAG,EAAc,mBAAG,CAAc;gBACzC,QAAQ,EAAE,uBAAe,CAAC,MAAM;aAChC;SACD,CAZwB,AAYvB,CAAC;QAEK,MAAM,CAAC,CAAC,CAAmB,QAAiB;YACnD,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAI,CAAM,CAAC,CAAmB,CAAC,CAAC,MAAI,CAAM,CAAC,CAAW,CAAC;QAC3E,CAAC;QAwBD,IAAW,OAAO;YACjB,OAAO,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC,CAAQ,CAAC;QAC/B,CAAC;QAED,IAAW,WAAW;YACrB,MAAM,WAAW,GAAG,IAAI,GAAG,EAA+B,CAAC;YAC3D,IAAI,CAAC,CAAC,CAAY,OAAO,CAAC,SAAS,CAAC,EAAE;gBACrC,WAAW,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,EAAE,SAAS,CAAC,OAAO,CAAC,CAAC;YAClD,CAAC,CAAC,CAAC;YACH,OAAO,WAAW,CAAC;QACpB,CAAC;QAQD,aAAa;QAEb,YACS,CAAoB,EACpB,CAAsD,EACtD,CAA+B,EAC/B,CAAa,EACb,CAAoB,EACpB,CAA6C,EACpC,CAAwB,EAC1B,CAAkC,EAChC,CAAqC,EACvC,YAA0B,EACjB,CAA4C;YAEpE,KAAK,EAAE,CAAC;YAZA,MAAC,GAAD,CAAC,CAAmB;YACpB,MAAC,GAAD,CAAC,CAAqD;YACtD,MAAC,GAAD,CAAC,CAA8B;YAC/B,MAAC,GAAD,CAAC,CAAY;YACb,MAAC,GAAD,CAAC,CAAmB;YACpB,MAAC,GAAD,CAAC,CAA4C;YACpC,MAAC,GAAD,CAAC,CAAuB;YACT,MAAC,GAAD,CAAC,CAAgB;YACf,MAAC,GAAD,CAAC,CAAmB;YAC9B,iBAAY,GAAZ,YAAY,CAAK;YACA,MAAC,GAAD,CAAC,CAA0B;YArD3D,MAAC,GAAW,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAA2D,CAAC,CAAC;YAChG,aAAQ,GAA+D,IAAI,CAAC,CAAC,CAAS,KAAK,CAAC;YAE7F,MAAC,GAAY,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAY,CAAC,CAAC;YAChD,cAAS,GAAgB,IAAI,CAAC,CAAC,CAAU,KAAK,CAAC;YAIhD,MAAC,GAA2B,IAAI,CAAC;YACjC,MAAC,GAAoC,IAAI,CAAC;YAK1C,MAAC,GAA8B,IAAI,CAAC;YAIpC,MAAC,GAA6B,EAAE,CAAC;YAEjC,MAAC,GAA+B,IAAI,GAAG,EAAE,CAAC;YAclD,0BAA0B;YAClB,MAAC,GAAoD,IAAI,CAAC;YAC1D,MAAC,GAA2C,IAAI,CAAC;YAuOjD,OAAE,GAAS,OAAO,CAAC,OAAO,EAAE,CAAC;YAnNpC,IAAI,CAAC,CAAC,GAAW,IAAI,CAAC,CAAC,CAAQ,QAAQ,CAAC;YACxC,IAAI,CAAC,CAAC,GAAc,IAAI,GAAG,EAAiB,CAAC;YAC7C,IAAI,CAAC,CAAC,GAAqB,IAAI,GAAG,EAAU,CAAC;YAC7C,IAAI,CAAC,CAAC,GAAkB,IAAI,WAAG,CAAc,IAAI,CAAC,EAAE,CAAoB,IAAI,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC;YACzF,IAAI,CAAC,CAAC,GAAO,IAAI,SAAE,CAAG,GAAG,EAAE,CAAC,YAAY,CAAC,mBAAmB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;YAC7E,IAAI,CAAC,CAAC,GAAc,IAAI,GAAG,EAAqB,CAAC;YACjD,IAAI,CAAC,CAAC,GAA0B,IAAI,WAAG,CAAc,IAAI,CAAC,4BAA4B,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC;YACxG,IAAI,CAAC,aAAa,EAAE,CAAC;QACtB,CAAC;QAED,uBAAuB,CAAC,MAAc,EAAE,cAAkC;YACzE,MAAM,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;YAC5C,IAAI,SAAS,KAAK,SAAS,EAAE;gBAC5B,SAAS,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;aAC5C;QACF,CAAC;QAED,uBAAuB,CAAC,MAAc,EAAE,cAAkC;YACzE,MAAM,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;YAC5C,IAAI,SAAS,KAAK,SAAS,EAAE;gBAC5B,SAAS,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;aAC5C;QACF,CAAC;QAED,YAAY,CAAC,MAAc;YAC1B,OAAO,IAAI,CAAC,CAAC,CAAY,GAAG,CAAC,MAAM,CAAC,CAAC;QACtC,CAAC;QAED,YAAY,CAAC,OAAmB;YAC/B,MAAM,SAAS,GAAG,IAAI,IAAI,CAAM,IAAI,EAAE,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC;YACnE,IAAI,CAAC,CAAC,CAAY,GAAG,CAAC,SAAS,CAAC,EAAE,EAAE,SAAS,CAAC,CAAC;YAC/C,IAAI,CAAC,uBAAuB,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,EAAE,OAAO,CAAC,cAAc,CAAC,CAAC;YACtE,IAAI,CAAC,uBAAuB,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,EAAE,OAAO,CAAC,cAAc,CAAC,CAAC;QACvE,CAAC;QAED,IAAI,WAAW;YACd,OAAO,IAAI,CAAC,CAAC,CAAY;QAC1B,CAAC;QAED,iBAAiB;YAChB,OAAO,IAAI,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,YAAY,IAAI,IAAe,CAAC,CAAC,cAAc,EAAE,CAAC,CAAC;QACrF,CAAC;QAED,aAAa;YACZ,MAAM,KAAK,GAAG,IAAI,CAAC,CAAC,CAAY,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAS,CAAC;YACzD,IAAI,KAAK,EAAE;gBACV,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACtB,IAAI,CAAC,EAAE,EAAqB,CAAC;aAC7B;iBAAM;gBACN,MAAM,0BAA0B,GAAG,IAAI,CAAC,CAAC,CAAqB,6BAA6B,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBAE3G,IAAI,0BAA0B,EAAE,KAAK,EAAE;oBACtC,IAAI,CAAC,wBAAwB,CAAC,0BAA0B,CAAC,KAAK,CAAC,CAAC;iBAChE;gBACD,IAAI,IAAI,CAAC,CAAC,CAAQ,OAAO,EAAE;oBAC1B,IAAI,CAAC,CAAC,CAAQ,OAAO;yBACnB,MAAM,CAAC,YAAG,CAAW;yBACrB,OAAO,CAAC,QAAQ,CAAC,EAAE;wBACnB,yBAAyB,CAAC,QAAQ,EAAE,IAAI,CAAC;6BACvC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC7B,CAAC,CAAC,CAAC;iBACJ;gBAED,IAAI,IAAA,4BAAI,EAAkB,IAAI,CAAC,CAAC,CAAQ,EAAE;oBACzC,IAAI,CAAC,CAAC,CAAQ,WAAW,EAAE,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC;oBACpE,IAAI,CAAC,EAAE,CAA8C,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;oBACzE,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,EAAE,gBAAgB,EAAE,IAAI,EAAE,CAAC,CAAC;iBAChD;gBACD,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAQ,OAAO,CAAC,CAAC;aACvC;QACF,CAAC;QAED,SAAS,CAAC,KAAiB;YAC1B,IAAI,CAAC,CAAC,GAAQ,KAAK,CAAC;YACpB,IAAI,CAAC,CAAC,GAAgB,IAAI,CAAC,CAAC,CAAM,kBAAkB,CAAC,GAAG,EAAE;gBACzD,IAAI,CAAC,CAAC,CAAgB,QAAQ,EAAE,CAAC;YAClC,CAAC,CAAC,CAAC;YACH,IAAI,CAAC,CAAC,CAAM,aAAa,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,EAAE,EAAkB,CAAC,CAAC;YAC3D,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACzB,CAAC;QAEO,EAAE;YACT,6DAA6D;YAC7D,IAAI,CAAC,EAAE,EAAqB,CAAC;YAC7B,IAAI,CAAC,EAAE,EAAW,CAAC;QACpB,CAAC;QAEO,EAAE;YACT,IAAI,IAAI,CAAC,CAAC,EAAO;gBAChB,IAAI,CAAC,CAAC,CAAgB,MAAM,EAAE,CAAC;gBAC/B,IAAI,CAAC,CAAC,CAAM,iBAAiB,CAAC,CAAC,QAAQ,EAAE,EAAE;oBAC1C,IAAI,CAAC,CAAC,GAAmB,QAAQ,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,EAAkB,EAAE,CAAC,CAAC;gBAChF,CAAC,CAAC,CAAC;gBACH,IAAI,CAAC,CAAC,GAAQ,IAAI,CAAC;gBACnB,IAAI,CAAC,CAAe,CAAC,OAAO,EAAE,CAAC;aAC/B;QACF,CAAC;QAEO,EAAE;YACT,+CAA+C;YAC/C,oCAAoC;YACpC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAO;gBACjB,OAAO;aACP;YACD,IAAI,CAAC,CAAC,GAAc,IAAI,GAAG,EAAiB,CAAC;YAE7C,MAAM,cAAc,GAAG,IAAI,CAAC,CAAC,CAAM,WAAW,IAAI,IAAI,CAAC,CAAC,CAAM,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAM,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC;YACjH,MAAM,OAAO,GAAG,IAAI,CAAC,CAAC;iBACpB,WAAW,CAAC,IAAI,CAAC,CAAC,CAAM,OAAO,EAAE,IAAI,CAAC,CAAC,CAAM,iBAAiB,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAM,QAAQ,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAM,eAAe,EAAE,cAAc,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC,IAAc,MAAM,CAAC,gBAAgB,CAAC,CAAC;YAE/L,IAAI,CAAC,EAAE,CAAY,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAM,CAAC;QAChD,CAAC;QAIS,KAAK,CAAC,EAAE,CAAgC,UAAkB,EAAE,WAAoB;YACzF,IAAI,CAAC,IAAI,CAAC,CAAC,EAAO;gBACjB,OAAO;aACP;YACD,MAAM,KAAK,GAAG;gBACb,eAAe,EAAE,UAAU;gBAC3B,WAAW,EAAE,IAAI,CAAC,CAAC,CAAM,gBAAgB,CAAC,UAAU,CAAC;gBACrD,aAAa,EAAE,UAAU;gBACzB,SAAS,EAAE,IAAI,CAAC,CAAC,CAAM,gBAAgB,CAAC,UAAU,CAAC;aACnD,CAAC;YACF,MAAM,UAAU,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAY,MAAM,EAAE,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,eAAe,KAAK,UAAU,CAAC,CAAC;YACxH,UAAU,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAY,MAAM,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;YAElE,MAAM,cAAc,GAAG,IAAI,CAAC,CAAC,CAAM,WAAW,IAAI,IAAI,CAAC,CAAC,CAAM,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAM,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC;YACjH,MAAM,OAAO,GAAG,IAAI,CAAC,CAAC,CAAM,WAAW,CAAC,IAAI,CAAC,CAAC,CAAM,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAM,QAAQ,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAM,eAAe,EAAE,cAAc,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC,IAAc,MAAM,CAAC,gBAAgB,CAAC,CAAC;YAC/L,IAAI,CAAC,EAAE,CAAY,OAAO,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC,CAAM,CAAC;YAEtD,6CAA6C;QAC9C,CAAC;QAIO,EAAE,CAAY,OAAoB,EAAE,WAAoB,EAAE,KAAiB;YAClF,MAAM,iBAAiB,GAAG,IAAA,oBAAI,EAA6B,OAAO,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC,CAAe,CAAC;YACjG,iBAAiB,CAAC,OAAO,CAAC,gBAAgB,CAAC,EAAE;gBAC5C,yBAAyB,CAAC,gBAAgB,EAAE,IAAI,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;oBACjE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAmB,GAAG,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE;wBAC9C,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;wBAChB,IAAI,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,EAAE;4BAChC,IAAI,CAAC,CAAC,GAAgB,KAAK,CAAC;yBAC5B;qBACD;gBACF,CAAC,CAAC,CAAC;YACJ,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,UAAU,CACd,IAAA,oBAAI,EAAsB,iBAAiB,EAAE,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,MAAM,EAAE,CAAC,KAAM,CAAC;iBAChF,MAAM,CAAC,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,IAAA,YAAG,EAAW,MAAM,CAAC,CAA0C,CAAC;iBACnF,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,EAAE,GAAG,OAAO,EAAE,UAAU,EAAE,OAAO,CAAC,UAAU,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YAEzE,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,EAAE,gBAAgB,EAAE,WAAW,EAAE,CAAC,CAAC;YACvD,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACzB,CAAC;QAED,gBAAgB;YACf,IAAI,CAAC,IAAI,CAAC,CAAC,EAAO;gBACjB,OAAO;aACP;YAED,IAAI,CAAC,CAAC,CAAM,iBAAiB,CAAC,CAAC,QAAQ,EAAE,EAAE;gBAC1C,MAAM,cAAc,GAAG,CACtB,IAAI,CAAC,MAAM,EAAE,CAAC,cAAc;oBAC3B,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAuB;wBACpD,KAAK,EAAE,KAAK,CAAC,KAAK,EAAE;wBACpB,OAAO,EAAE,MAAI,CAAM,CAAC,CAAmB,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;qBACnE,CAAA,CAAC;oBACF,CAAC,CAAC,EAAE,CACL,CAAC;gBACF,IAAI,CAAC,CAAC,GAAmB,QAAQ,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,EAAkB,cAAc,CAAC,CAAC;YAC5F,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,EAAE;YACD,OAAO,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;QACjC,CAAC;QAED,MAAM;YACL,OAAO,IAAI,CAAC,CAAC,CAAO;QACrB,CAAC;QAED,OAAO;YACN,MAAM,WAAW,GAAsB,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAY,MAAM,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC;YAC1G,OAAO,CAAC,GAAG,IAAI,CAAC,CAAC,CAAY,MAAM,EAAE,EAAE,GAAG,WAAW,CAAC,CAAC;QACxD,CAAC;QAED,WAAW;YACV,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAY,MAAM,EAAE,CAAC,CAAC;QAC/C,CAAC;QAED,WAAW;YACV,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAY,MAAM,EAAE,CAAC,CAAC;QAC/C,CAAC;QAED,MAAM,CAAC,OAAwB;YAC9B,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;gBAC5B,OAAO,GAAG,CAAC,OAAO,CAAC,CAAC;aACpB;YAED,KAAK,MAAM,KAAK,IAAI,OAAO,EAAE;gBAC5B,IAAI,CAAC,EAAE,CAAU,KAAK,CAAC,CAAC;gBACxB,IAAI,CAAC,CAAC,CAAmB,GAAG,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC;aACzC;YAED,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;QAC1C,CAAC;QAGD,KAAK,CAAC,OAAO,CAAC,SAAe;YAC5B,OAAO,IAAI,CAAC,EAAE,GAAS,IAAI,CAAC,EAAE,CAAO,OAAO,CAAC,KAAK,IAAI,EAAE;gBACvD,MAAM,IAAI,CAAC,CAAC,CAAc,OAAO,CAAC,SAAS,CAAC,CAAC;gBAC7C,MAAM,IAAI,CAAC,EAAE,CAAgC,SAAS,CAAC,KAAK,EAAE,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;YACxF,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,gBAAgB,CAAC,KAAmB;YACnC,IAAI,KAAK,EAAE;gBAEV,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,KAAK,YAAY,IAAI,EAAa;oBACrE,IAAI,CAAC,CAAC,GAAgB,KAAK,CAAC;oBAC5B,OAAO;iBACP;gBAED,IAAI,CAAC,IAAI,CAAC,CAAC,CAAY,GAAG,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE;oBACvC,OAAO;iBACP;gBACD,IAAI,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,EAAE;oBAChC,OAAO;iBACP;aACD;YAED,IAAI,CAAC,CAAC,GAAgB,KAAK,CAAC;YAC5B,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACzB,CAAC;QAED,gBAAgB;YACf,OAAO,IAAI,CAAC,CAAC,CAAc;QAC5B,CAAC;QAED,eAAe,CAAC,KAAW;YAC1B,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,IAAiB,IAAI,CAAC,CAAC,CAAc,EAAE,EAAE,KAAK,KAAK,CAAC,EAAE,EAAE,CAAC;QACzE,CAAC;QAED,KAAK;YACJ,OAAO,IAAI,CAAC,OAAO,EAAE,CAAC,MAAM,CAAC;QAC9B,CAAC;QAED,IAAI,QAAQ;YACX,OAAO,IAAI,CAAC,CAAC,CAAS;QACvB,CAAC;QAED,IAAI;YACH,OAAO,IAAI,CAAC,CAAC,CAAK,KAAK,CAAC;QACzB,CAAC;QAED,UAAU,CAAC,OAAwC;YAClD,IAAI,CAAC,OAAO,EAAE;gBAAE,OAAO;aAAE;YAEzB,MAAM,QAAQ,GAAG,OAAO;iBACtB,MAAM,CAAC,CAAC,MAAM,CAAC,EAAE,CACjB,CAAC,IAAA,YAAG,EAAW,MAAM,CAAC,CAA0C,CAAC,CAAC;YAEpE,OAAO,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAQ,GAAG,CAAC,OAAO,CAAC,UAAU,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;QACzF,CAAC;QAED,GAAG,CAAC,KAAW,EAAG,OAAiB;YAClC,IAAI,CAAC,CAAC,CAAY,GAAG,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC;YACzC,IAAI,OAAO,EAAE;gBACZ,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,EAAE,gBAAgB,EAAE,IAAI,EAAE,CAAC,CAAC;aAChD;QACF,CAAC;QAEO,EAAE,CAAU,KAAW;YAE9B,IAAI,KAAK,YAAY,IAAI,EAAa;gBACrC,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;gBAC/B,IAAI,KAAK,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,MAAM,KAAK,CAAC,EAAE;oBAC5C,IAAI,CAAC,CAAC,CAAY,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;iBAC9C;aACD;iBAAM;gBACN,IAAI,CAAC,CAAC,CAAY,MAAM,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC;aACrC;YACD,IAAI,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,EAAE;gBAChC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;gBAC5B,IAAI,CAAC,CAAC,EAA0B,+BAA+B,EAAE,CAAC;aAClE;iBAAM;gBACN,IAAI,CAAC,gBAAgB,EAAE,CAAC;aACxB;YACD,IAAI,KAAK,YAAY,IAAI,EAAa;gBACrC,IAAI,CAAC,EAAE,CAA8C,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;aACzE;QACF,CAAC;QAED,KAAK,CAAC,eAAe,CAAC,WAAgB;YACrC,IAAI,CAAC,CAAC,GAAW,MAAM,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,SAAS,CAAC,CAAC;QAC/E,CAAC;QAED,IAAW,QAAQ;YAClB,OAAO,IAAI,CAAC,CAAC,CAAS;QACvB,CAAC;QAED,IAAW,QAAQ,CAAC,IAA8C;YACjE,IAAI,CAAC,CAAC,GAAW,IAAI,CAAC;QACvB,CAAC;QAEQ,OAAO;YACf,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;YAC5B,IAAI,CAAC,EAAE,EAAW,CAAC;YACnB,IAAI,CAAC,0BAA0B,EAAE,CAAC;YAClC,IAAI,CAAC,CAAC,CAAU,IAAI,EAAE,CAAC;YACvB,KAAK,CAAC,OAAO,EAAE,CAAC;QACjB,CAAC;QAED,sBAAsB;YACrB,OAAO,IAAI,CAAC,OAAO,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,KAAK,YAAY,IAAI,IAAe,KAAK,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC;QACpG,CAAC;QAED,oCAAoC;QACpC,wBAAwB,CAAC,MAAY;YACpC,IAAI,IAAI,CAAC,CAAC,KAAyB,MAAM,EAAE;gBAC1C,OAAO;aACP;YAED,IAAI,CAAC,CAAC,GAAuB,MAAM,CAAC;YAEpC,IAAI,CAAC,CAAC,GAAuB,IAAI,CAAC,CAAC,CAAqB,SAAS,EAAE,kBAAkB,CAAC,CAAC,CAAC,EAAE,EAAE;gBAC3F,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,KAAK,wCAAuB,CAAC,iBAAiB,IAAI,KAAK,CAAC,IAAI,KAAK,wCAAuB,CAAC,WAAW,CAAC,EAAE;oBAC/I,OAAO;iBACP;gBACD,IAAI,CAAC,CAAC,CAAwB,QAAQ,EAAE,CAAC;YAC1C,CAAC,CAAC,IAAI,IAAI,CAAC;YACX,IAAI,CAAC,EAAE,EAAsB,CAAC;QAC/B,CAAC;QAED,0BAA0B,CAAC,MAAa;YACvC,IAAI,MAAM,IAAI,IAAI,CAAC,CAAC,KAAyB,MAAM,EAAE;gBACpD,OAAO;aACP;YAED,IAAI,IAAI,CAAC,CAAC,EAAsB;gBAC/B,IAAI,CAAC,CAAC,CAAwB,MAAM,EAAE,CAAC;gBACvC,IAAI,CAAC,CAAC,EAAsB,OAAO,EAAE,CAAC;aACtC;YACD,IAAI,CAAC,EAAE,EAAyB,CAAC;YACjC,IAAI,CAAC,CAAC,GAAuB,IAAI,CAAC;QACnC,CAAC;QAED,wBAAwB;YACvB,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC,cAAc,EAAE;gBACjC,IAAI,CAAC,EAAE,EAAsB,CAAC;gBAC9B,IAAI,CAAC,EAAE,CAA8C,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAY,MAAM,EAAE,CAAC,CAAC,CAAC;aAC7F;iBAAM;gBACN,IAAI,CAAC,EAAE,EAAyB,CAAC;aACjC;QACF,CAAC;QAEO,EAAE;YACT,IAAI,CAAC,IAAI,CAAC,CAAC,EAAsB;gBAChC,OAAO;aACP;YACD,IAAI,CAAC,CAAC,EAA0B,eAAe,EAAE,CAAC;YAClD,IAAI,CAAC,CAAC,EAA0B,OAAO,EAAE,CAAC;YAC1C,IAAI,CAAC,CAAC,GAA2B,IAAI,+BAAI,CAAqB,IAAI,CAAC,CAAC,EAAsB,IAAI,CAAC,CAAC,CAAgB,CAAC;YACjH,IAAI,IAAI,CAAC,CAAC,YAAyB,IAAI,EAAa;gBACnD,IAAI,CAAC,EAAE,CAAkC,IAAI,CAAC,CAAC,CAAc,CAAC;aAC9D;QACF,CAAC;QAEO,EAAE;YACT,IAAI,IAAI,CAAC,CAAC,EAA0B;gBACnC,IAAI,CAAC,CAAC,EAA0B,eAAe,EAAE,CAAC;gBAClD,IAAI,CAAC,CAAC,EAA0B,OAAO,EAAE,CAAC;gBAC1C,IAAI,CAAC,CAAC,GAA2B,SAAS,CAAC;aAC3C;QACF,CAAC;QAEO,EAAE,CAAoB,OAAiC,EAAE,WAAoB;YACpF,IAAI,CAAC,IAAI,CAAC,CAAC,EAAsB;gBAChC,OAAO;aACP;YAED,MAAM,cAAc,GAAG,IAAI,GAAG,CAAoB,IAAI,CAAC,CAAC,CAAY,CAAC;YACrE,IAAI,IAAI,CAAC,CAAC,CAAqB,KAAK,EAAE,KAAK,IAAI,CAAC,CAAC,EAA6B;gBAC7E,IAAI,CAAC,CAAC,CAAY,KAAK,EAAE,CAAC;gBAC1B,IAAI,CAAC,CAAC,GAA8B,IAAI,CAAC,CAAC,CAAqB,KAAK,EAAE,CAAC;aACvE;YACD,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACvB,IAAI,YAAY,GAAG,IAAI,CAAC,CAAC,CAAY,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;gBACxD,IAAI,IAAI,CAAC,CAAC,IAAwB,CAAC,YAAY,EAAE;oBAChD,MAAM,KAAK,GAAG,IAAI,CAAC,CAAC,CAAqB,YAAY,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;oBAClE,MAAM,eAAe,GAAG,cAAc,CAAC,GAAG,CAAC,GAAG,4BAAI,GAAY,KAAK,EAAE,CAAC,CAAC;oBACvE,IAAI,eAAe,EAAE;wBACpB,eAAe,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;wBACzC,eAAe,CAAC,eAAe,EAAE,CAAC;wBAClC,YAAY,GAAG,eAAe,CAAC;qBAC/B;iBACD;gBACD,MAAM,IAAI,GAAG,YAAY,IAAI,IAAI,IAAI,CAAM,IAAI,EAAE,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;gBAC1E,IAAI,CAAC,iBAAiB,CAAC,IAAA,4BAAI,EAA8B,KAAK,CAAC,cAAc,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;gBAC5F,IAAI,CAAC,iBAAiB,CAAC,IAAA,4BAAI,EAA8B,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC;gBAChF,IAAI,CAAC,CAAC,CAAY,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;YAEtC,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,CAAC,EAA0B,4BAA4B,CAAC,OAAO,CAAC,CAAC;YACtE,IAAI,IAAI,CAAC,CAAC,YAAyB,IAAI,EAAa;gBACnD,IAAI,CAAC,EAAE,CAAkC,IAAI,CAAC,CAAC,CAAc,CAAC;aAC9D;YACD,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,EAAE,gBAAgB,EAAE,WAAW,EAAE,CAAC,CAAC;QACxD,CAAC;QAEO,EAAE,CAA8C,KAAkB;YACzE,IAAI,CAAC,IAAI,CAAC,CAAC,EAA0B;gBACpC,OAAO;aACP;YACD,MAAM,aAAa,GAA6B,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE;gBAClE,MAAM,cAAc,GAA2B,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;oBAC9E,OAA6B;wBAC5B,KAAK,EAAE,KAAK,CAAC,YAAY;qBACzB,CAAC;gBACH,CAAC,CAAC,CAAC;gBACH,MAAM,WAAW,GAAgB,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;oBAChE,OAAO,IAAI,WAAG,CAAO,KAAK,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;gBACrD,CAAC,CAAC,CAAC;gBACH,OAA+B;oBAC9B,IAAI,EAAE,IAAI,CAAC,IAAI;oBACf,KAAK,EAAE,IAAI,CAAC,SAAS;oBACrB,cAAc,EAAE,WAAW;oBAC3B,cAAc,EAAE,cAAc;iBAC9B,CAAC;YACH,CAAC,CAAC,CAAC;YACH,IAAI;gBACH,IAAI,CAAC,CAAC,CAAyB,4BAA4B,CAAC,aAAa,CAAC,CAAC;aAC3E;YAAC,OAAO,CAAC,EAAE;gBACX,sEAAsE;aACtE;QACF,CAAC;QACD,KAAK,CAAC,4BAA4B;YACjC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAsB;gBAChC,OAAO;aACP;YAED,IAAI,CAAC,CAAC,GAAc,IAAI,GAAG,EAAiB,CAAC;YAE7C,MAAM,cAAc,GAAG,IAAI,CAAC,CAAC,CAAM,WAAW,IAAI,IAAI,CAAC,CAAC,CAAM,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAM,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC;YACjH,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,CAAC;iBAC7B,IAAI,CAAC,IAAI,CAAC,CAAC,CAAM,OAAO,EAAE;gBAC1B,KAAK,EAAE,IAAI,CAAC,CAAC,CAAM,QAAQ;gBAC3B,SAAS,EAAE,IAAI,CAAC,CAAC,CAAM,WAAW;gBAClC,aAAa,EAAE,IAAI,CAAC,CAAC,CAAM,eAAe;gBAC1C,cAAc,EAAE,cAAc,IAAI,SAAS;gBAC3C,kBAAkB,EAAE,IAAI,CAAC,CAAC,CAAM,YAAY,EAAE,yBAAyB;gBACvE,oBAAoB,EAAE,IAAI,CAAC,CAAC,CAAM,YAAY,EAAE,2BAA2B;gBAC3E,gBAAgB,EAAE,IAAI,CAAC,CAAC,CAAM,YAAY,EAAE,qBAAqB;gBACjE,aAAa,EAAE,IAAI,CAAC,CAAC,CAAM,YAAY,EAAE,sBAAsB;aAC/D,EAAE,gCAAiB,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAgB,CAAC;YAEhE,IAAI,CAAC,EAAE,CAAoB,UAAU,EAAE,IAAI,CAAC,CAAC;QAC9C,CAAC;QAEM,KAAK,CAAC,SAAS,CAAC,KAAW;YACjC,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,EAAE,CAAkC,KAAK,CAAC,CAAC;YACrE,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;YAC7B,IAAI,CAAC,EAAE,CAAc,KAAK,EAAE,MAAM,CAAC,CAAC;QACrC,CAAC;QAEO,KAAK,CAAC,EAAE,CAAkC,KAAW;YAC5D,IAAI,CAAC,IAAI,CAAC,CAAC,IAA4B,KAAK,CAAC,IAAI,YAAY,4BAAI,EAAa;gBAC7E,uEAAuE;gBACvE,OAAO,IAAI,CAAC;aACZ;YACD,IAAI,KAAK,CAAC,YAAY,KAAK,SAAS,EAAE;gBACrC,OAAO,IAAI,CAAC,CAAC,CAAyB,yCAAyC,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC;aAC3G;iBAAM;gBACN,OAAO,IAAI,CAAC,CAAC,CAAyB,4CAA4C,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,YAAY,CAAC,CAAC;aACnH;QACF,CAAC;QAEO,EAAE,CAAc,KAAW,EAAa,YAA2B;YAC1E,IAAI,CAAC,IAAI,CAAC,CAAC,IAAwB,KAAK,CAAC,IAAI,YAAY,4BAAI,EAAa;gBACzE,uEAAuE;gBACvE,OAAO;aACP;YACD,IAAI,KAAK,CAAC,YAAY,KAAK,SAAS,EAAE;gBACrC,MAAM,KAAK,GAAG,IAAI,CAAC,CAAC,CAAqB,YAAY,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBAClE,IAAI,KAAK,KAAK,SAAS,EAAE;oBACxB,IAAI,CAAC,CAAC,CAAqB,6BAA6B,CAAC,KAAK,CAAC,IAAI,EAAE,YAAY,IAAI,CAAC,CAAC,CAAC;iBACxF;aACD;iBAAM;gBACN,KAAK,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE,mBAAmB,CAAC,CAAC;gBAC3E,IAAI,CAAC,CAAC,CAAqB,sBAAsB,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC;gBAC7E,IAAI,CAAC,CAAC,CAAqB,yCAAyC,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC;aAChG;QACF,CAAC;;IA5kBW,oBAAI;mBAAJ,IAAI;QAqFd,WAAA,WAAG,CAAA;QACH,WAAA,cAAI,CAAA;QACJ,WAAA,WAAG,CAAA;QACH,YAAA,4BAAI,CAAA;OAxFM,IAAI,CA+kBhB;IASM,IAAM,IAAI,YAAV,MAAM,IAAY,SAAQ,eAAG;QAgBnC,YACW,CAAqB,EACvB,CAAW,EACT,CAAc,EACd,CAAkB,EACpB,CAA4B,EAC5B,CAAmB,EACnB,CAA6C,EACpC,CAAqC,EAC/B,CAA4C,EACpD,YAAiB,EACX,CAA0C;YAE/D,KAAK,EAAE,CAAC;YAZE,MAAC,GAAD,CAAC,CAAoB;YACvB,MAAC,GAAD,CAAC,CAAU;YACT,MAAC,GAAD,CAAC,CAAa;YACd,MAAC,GAAD,CAAC,CAAiB;YACpB,MAAC,GAAD,CAAC,CAA2B;YAC5B,MAAC,GAAD,CAAC,CAAkB;YACnB,MAAC,GAAD,CAAC,CAA4C;YACnB,MAAC,GAAD,CAAC,CAAmB;YACZ,MAAC,GAAD,CAAC,CAAwB;YAE3B,MAAC,GAAD,CAAC,CAAsB;YAzBtD,MAAC,GAAW,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAoB,CAAC,CAAC;YACzD,aAAQ,GAAwB,IAAI,CAAC,CAAC,CAAS,KAAK,CAAC;YAEtD,MAAC,GAAY,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAY,CAAC,CAAC;YAChD,cAAS,GAAgB,IAAI,CAAC,CAAC,CAAU,KAAK,CAAC;YAOhD,MAAC,GAAwB,KAAK,CAAC;YAiBtC,IAAI,CAAC,CAAC,GAAc,IAAI,SAAG,EAAqB,CAAC;YACjD,IAAI,CAAC,CAAC,GAAgB,IAAI,SAAG,EAAmC,CAAC;YACjE,IAAI,CAAC,CAAC,GAAmB,uBAAG,CAAe,OAAO,CAA0B,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC,CAAC;YACzI,IAAI,CAAC,CAAC,GAAwB,IAAI,SAAG,EAAqB,CAAC;YAC3D,IAAI,CAAC,CAAC,GAA0B,IAAI,SAAG,EAAmC,CAAC;YAC3E,IAAI,CAAC,CAAC,GAAO,IAAI,SAAE,CAAG,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,YAAY,CAAC,mBAAmB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;QACnG,CAAC;QAED,IAAI,WAAW;YACd,OAAO,IAAI,CAAC,CAAC,CAAa,WAAW,CAAC;QACvC,CAAC;QAED,IAAI,cAAc;YACjB,OAAO,IAAI,CAAC,CAAC,CAAO,cAAc,CAAC;QACpC,CAAC;QAED,IAAI,WAAW;YACd,OAAO,IAAI,CAAC,CAAC,CAAY;QAC1B,CAAC;QAED,IAAI,YAAY,CAAC,CAAU;YAC1B,IAAI,CAAC,CAAC,GAAe,CAAC,CAAC;QACxB,CAAC;QAED,EAAE;YACD,OAAO,IAAI,CAAC,CAAC,CAAG;QACjB,CAAC;QAED,IAAI,QAAQ;YACX,OAAO,IAAI,CAAC,CAAC,CAAS;QACvB,CAAC;QAED,KAAK;YACJ,OAAO,IAAI,CAAC,CAAC,CAAM;QACpB,CAAC;QAED,IAAI;YACH,OAAO,IAAI,CAAC,CAAC,CAAK,KAAK,CAAC;QACzB,CAAC;QAED,MAAM;YACL,OAAO,IAAI,CAAC,CAAC,CAAO;QACrB,CAAC;QAED,SAAS,CAAC,KAAiB;YAC1B,MAAM,SAAS,GAAG,IAAI,CAAC,CAAC,CAAY,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAEnD,IAAI,SAAS,EAAE;gBACd,SAAS,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;aAC3B;iBAAM;gBACN,MAAM,WAAW,GAAG,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBACnD,MAAM,KAAK,GAAG,WAAW,EAAE,sBAAsB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBAC7D,KAAK,EAAE,SAAS,CAAC,KAAK,CAAC,CAAC;aACxB;QACF,CAAC;QAED,KAAK,CAAC,wBAAwB,CAAC,MAAY,EAAkB,QAAa;YACzE,MAAM,SAAS,GAAG,IAAI,CAAC,CAAC,CAAY,GAAG,CAAC,QAAQ,CAAC,CAAC;YAElD,IAAI,SAAS,EAAE;gBACd,SAAS,CAAC,wBAAwB,CAAC,MAAM,CAAC,CAAC;gBAC3C,MAAM,SAAS,CAAC,4BAA4B,EAAE,CAAC;aAC/C;iBAAM;gBACN,MAAM,aAAa,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC;gBACnD,KAAK,MAAM,IAAI,IAAI,aAAa,EAAE;oBACjC,MAAM,IAAI,CAAC,wBAAwB,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;iBACtD;aACD;QACF,CAAC;QAED,0BAA0B,CAAC,MAAY,EAAkB,QAAa;YACrE,MAAM,SAAS,GAAG,IAAI,CAAC,CAAC,CAAY,GAAG,CAAC,QAAQ,CAAC,CAAC;YAElD,IAAI,SAAS,EAAE;gBACd,SAAS,CAAC,0BAA0B,CAAC,MAAM,CAAC,CAAC;aAC7C;iBAAM;gBACN,MAAM,aAAa,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC;gBACnD,KAAK,MAAM,IAAI,IAAI,aAAa,EAAE;oBACjC,IAAI,CAAC,0BAA0B,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;iBAClD;aACD;QAEF,CAAC;QAEM,6BAA6B,CAAC,QAAa,EAAE,EAAU,EAAE,KAAa,EAAE,KAAiB,EAAE,mBAAyB;YAC1H,MAAM,WAAW,GAAG,IAAI,CAAC,CAAC,CAAoB,cAAc,CAAC,IAAI,EAAqB,QAAQ,EAAE,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,EAAc,mBAAmB,CAAC,CAAC;YACjK,IAAI,CAAC,0BAA0B,CAAC,WAAW,CAAC,CAAC;YAC7C,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;YAC9B,OAAO,WAAW,CAAC;QACpB,CAAC;QAEM,0BAA0B,CAAC,WAAiB;YAClD,MAAM,UAAU,GAAG,WAAW,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC,CAAC;YAC5F,WAAW,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC;QACnD,CAAC;QAED,KAAK,CAAC,WAAW,GAAG,KAAK;YACxB,MAAM,OAAO,GAAgB,IAAI,CAAC,wBAAwB,EAAE,CAAC;YAC7D,IAAI,CAAC,CAAC,EAAe,CAAC;YACtB,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,EAAE,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,CAAC,CAAC;QACtF,CAAC;QAED,MAAM,CAAC,OAAsF;YAC5F,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;gBAC5B,OAAO,GAAG,CAAC,OAAO,CAAC,CAAC;aACpB;YACD,MAAM,UAAU,GAAG,cAAc,CAAC,OAAO,CAAC,CAAC;YAC3C,IAAI,CAAC,CAAC,CAAY,UAAU,CAAC,CAAC;QAC/B,CAAC;QAED,KAAK,CAAC,OAAO,CAAC,KAAW;YACxB,OAAO,IAAI,CAAC,CAAC,CAAc,OAAO,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;gBACrD,IAAI,CAAC,CAAC,CAAY,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;YAC9C,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,UAAU;YACT,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;YAC/B,OAAO,IAAI,CAAC,CAAC,CAAY,OAAO,CAAC,CAAC;QACnC,CAAC;QAED,OAAO;YACN,OAAO,CAAC,GAAG,IAAI,CAAC,mBAAmB,EAAE,EAAE,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC,CAAC;QACzE,CAAC;QAED,mBAAmB;YAClB,OAAO,IAAI,CAAC,CAAC,CAAY,MAAM,EAAE,CAAC;QACnC,CAAC;QAED,qBAAqB;YACpB,OAAO,IAAI,CAAC,CAAC,CAAc,MAAM,EAAE,CAAC;QACrC,CAAC;QAED,OAAO;YACN,OAAO,CAAC,IAAI,CAAC,CAAC,EAAU,GAAG,IAAI,CAAC,CAAC,EAAY,CAAC,KAAK,CAAC,CAAC;QACtD,CAAC;QAED,sBAAsB,CAAC,GAAQ;YAC9B,MAAM,oBAAoB,GAAG,IAAI,CAAC,CAAC,CAAY,GAAG,CAAC,GAAG,CAAC,CAAC;YACxD,IAAI,oBAAoB,EAAE;gBACzB,OAAO,oBAAoB,CAAC;aAC5B;YAED,MAAM,WAAW,GAAG,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,KAAK,GAAG,WAAW,EAAE,sBAAsB,CAAC,GAAG,CAAC,CAAC;YACvD,IAAI,KAAK,EAAE;gBACV,OAAO,KAAK,CAAC;aACb;YAED,OAAO,IAAI,CAAC;QACb,CAAC;QAED,wBAAwB;YACvB,IAAI,iBAAiB,GAAgB,EAAE,CAAC;YACxC,MAAM,QAAQ,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC;YAC9C,KAAK,MAAM,IAAI,IAAI,QAAQ,EAAE;gBAC5B,iBAAiB,GAAG,iBAAiB,CAAC,MAAM,CAAC,IAAI,CAAC,wBAAwB,EAAE,CAAC,CAAC;aAC9E;YAED,OAAO,CAAC,GAAG,IAAI,CAAC,mBAAmB,EAAE,EAAE,GAAG,iBAAiB,CAAC,CAAC;QAC9D,CAAC;QAEO,CAAC;YACR,OAAO,IAAI,CAAC,CAAC,CAAY,IAAI,CAAC;QAC/B,CAAC;QAEO,CAAC;YACR,OAAO,IAAI,CAAC,CAAC,CAAc,IAAI,CAAC;QACjC,CAAC;QAED,KAAK;YACJ,OAAO,IAAI,CAAC,CAAC,EAAU,GAAG,IAAI,CAAC,CAAC,EAAY,CAAC;QAC9C,CAAC;QAED,kBAAkB;YACjB,OAAO,IAAI,CAAC,wBAAwB,EAAE,CAAC,MAAM,CAAC;QAC/C,CAAC;QAED,mBAAmB;YAClB,OAAO,IAAI,CAAC,wBAAwB,EAAE,CAAC,MAAM,CAAS,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE,CAAC,IAAI,GAAG,KAAK,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC;QACjG,CAAC;QAED,IAAI,KAAK;YACR,OAAO,IAAI,CAAC,CAAC,CAAM;QACpB,CAAC;QAED,YAAY,CAAC,GAAiB,EAAE,MAAe,EAAE,gBAAwB;YACxE,4DAA4D;YAC5D,MAAM,KAAK,GAAgB,EAAE,CAAC;YAC9B,MAAM,OAAO,GAAgB,EAAE,CAAC;YAEhC,GAAG,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE;gBAC1B,MAAM,iBAAiB,GAAG,IAAI,CAAC,sBAAsB,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;gBAC7E,IAAI,iBAAiB,EAAE;oBAEtB,IAAI,YAAY,CAAC,OAAO,EAAE;wBACzB,YAAY;6BACV,OAAO;6BACP,MAAM,CAAC,YAAG,CAAW;6BACrB,OAAO,CAAC,CAAC,CAAC,EAAE;4BACZ,yBAAyB,CAAC,CAAC,EAAE,iBAAiB,CAAC;iCAC7C,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;wBAC1C,CAAC,CAAC,CAAC;qBACJ;oBAED,mBAAmB;oBACnB,IAAI,IAAA,4BAAI,EAAkB,YAAY,CAAC,EAAE;wBACxC,YAAY,CAAC,WAAW,EAAE,OAAO,CAAC,YAAY,CAAC,EAAE;4BAChD,MAAM,iBAAiB,GAAG,iBAAiB,CAAC,YAAY,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;4BAC/E,IAAI,iBAAiB,EAAE;gCACtB,iBAAiB,CAAC,iBAAiB,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC;gCACjE,iBAAiB,CAAC,iBAAiB,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC;6BACjE;iCAAM;gCACN,iBAAiB,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;6BAC7C;wBACF,CAAC,CAAC,CAAC;qBACH;oBAED,OAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;oBAEhC,iBAAiB,CAAC,UAAU,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;iBACnD;qBAAM;oBACN,IAAI,IAAI,YAAY,IAAI,IAAwB,IAAI,YAAY,IAAI,EAAe;wBAClF,MAAM,SAAS,GAAG,IAAI,CAAC,2BAA2B,CAAC,YAAY,EAAE,gBAAgB,CAAC,CAAC;wBACnF,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;qBACtB;iBACD;YACF,CAAC,CAAC,CAAC;YAEH,MAAM,QAAQ,GAAG,CAAC,GAAG,KAAK,EAAE,GAAG,OAAO,CAAC,CAAC;YACxC,IAAI,CAAC,MAAM,IAAI,QAAQ,CAAC,MAAM,EAAE;gBAC/B,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,CAAC;aACzD;QACF,CAAC;QAED,SAAS,CAAC,SAAe;YACxB,IAAI,CAAC,CAAC,CAAY,GAAG,CAAC,SAAS,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;YACrD,IAAI,IAAI,CAAC,CAAC,CAAsB,GAAG,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE;gBACxD,IAAI,CAAC,CAAC,CAAsB,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;aACvD;QACF,CAAC;QAED,sBAAsB;YACrB,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAY,MAAM,EAAE,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,sBAAsB,EAAE,CAAC,CAAC;QACxF,CAAC;QAES,CAAC,CAAY,MAAW,EAAE,KAAU;YAC7C,OAAO,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,eAAe,CAAC,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;QAChI,CAAC;QAEO,CAAC,CAAe,WAAiB;YAExC,IAAI,SAAS,GAA+B,IAAI,CAAC;YACjD,OAAO,SAAS,YAAY,MAAI,EAAS;gBACxC,IAAI,SAAS,CAAC,EAAE,EAAE,KAAK,WAAW,CAAC,EAAE,EAAE,EAAE;oBACxC,OAAO,IAAI,CAAC;iBACZ;gBACD,SAAS,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC;aAC/B;YACD,OAAO,KAAK,CAAC;QACd,CAAC;QAEM,cAAc,CAAC,QAAa;YAClC,MAAM,WAAW,GAAG,IAAI,CAAC,CAAC,CAAiB,UAAU,CAAC,QAAQ,CAAC,CAAC;YAChE,OAAO,WAAW,CAAC;QACpB,CAAC;QAED,WAAW,CAAC,WAAiB;YAC5B,IAAI,IAAI,YAAY,IAAI,IAAuB,CAAC,IAAI,CAAC,CAAC,CAAY,IAAI,CAAC,QAAQ,EAAE,WAAW,CAAC,QAAQ,CAAC,EAAE;gBACvG,MAAM,KAAK,CAAC,GAAG,WAAW,CAAC,QAAQ,kCAAkC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;aACtF;iBAAM,IAAI,IAAI,CAAC,CAAC,CAAe,WAAW,CAAC,EAAE;gBAC7C,MAAM,KAAK,CAAC,GAAG,WAAW,CAAC,QAAQ,mBAAmB,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;aACvE;YAED,IAAI,CAAC,CAAC,CAAc,GAAG,CAAC,WAAW,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC;YAC3D,IAAI,CAAC,CAAC,CAAiB,GAAG,CAAC,WAAW,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC;YAC9D,IAAI,IAAI,CAAC,CAAC,CAAwB,GAAG,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE;gBAC5D,IAAI,CAAC,CAAC,CAAwB,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;aAC3D;QACF,CAAC;QAEO,KAAK,CAAC,CAAC,CAAY,OAAgD;YAC1E,MAAM,UAAU,GAAG,cAAc,CAAC,OAAO,CAAC,CAAC;YAE3C,MAAM,IAAI,CAAC,CAAC,CAAc,OAAO,CAAC,UAAU,CAAC,CAAC;YAC9C,IAAI,CAAC,CAAC,CAAY,UAAU,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QACjD,CAAC;QAEM,YAAY,CAAC,SAAe,EAAO,OAAO,GAAG,KAAK;YACxD,IAAI,KAAK,GAAG,KAAK,CAAC;YAClB,IAAI,CAAC,IAAI,CAAC,CAAC,CAAY,GAAG,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE;gBAC/C,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;gBAC1B,KAAK,GAAG,IAAI,CAAC;aACb;YACD,IAAI,SAAS,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE;gBAC5B,IAAI,CAAC,CAAC,CAAY,CAAC,SAAS,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;gBAC7C,KAAK,GAAG,KAAK,CAAC;gBACd,OAAO,GAAG,IAAI,CAAC;aACf;YACD,IAAI,CAAC,IAAI,CAAC,CAAC,EAAc;gBACxB,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,EAAE,QAAQ,EAAE,CAAC,SAAS,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,CAAC,CAAC;aAC/E;QACF,CAAC;QAEM,cAAc,CAAC,WAAiB,EAAqB,KAAmB;YAC9E,IAAI,CAAC,IAAI,CAAC,CAAC,CAAc,GAAG,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE;gBACnD,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;aAC9B;YACD,IAAI,WAAW,CAAC,OAAO,EAAE,EAAE;gBAC1B,IAAI,CAAC,CAAC,CAAc,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;gBACjD,WAAW,CAAC,OAAO,EAAE,CAAC;aACtB;YAED,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,KAAK,CAAC,CAAC;QAC5B,CAAC;QAEO,CAAC,CAAY,WAAwB,EAAE,UAAmB,IAAI,EAAE,UAAmB,IAAI,EAAE,YAAY,GAAG,KAAK;YAEpH,MAAM,OAAO,GAAG,EAAE,CAAC;YACnB,KAAK,MAAM,KAAK,IAAI,WAA0B,EAAE;gBAC/C,IAAI,IAAI,CAAC,CAAC,CAAY,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAE;oBAC1C,IAAI,YAAY,IAAI,KAAK,CAAC,iBAAiB,EAAE,EAAE;wBAC9C,SAAS;qBACT;oBACD,IAAI,CAAC,CAAC,CAAY,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;oBACzC,IAAI,OAAO,EAAE;wBACZ,KAAK,CAAC,OAAO,EAAE,CAAC;qBAChB;yBAAM;wBACN,IAAI,CAAC,CAAC,CAAsB,GAAG,CAAC,KAAK,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;qBACvD;oBACD,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;iBACpB;qBAAM;oBACN,MAAM,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;oBACnD,IAAI,MAAM,EAAE;wBACX,MAAM,CAAC,CAAC,CAAY,CAAC,KAAK,CAAC,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;qBAC/C;yBAAM;wBACN,MAAM,KAAK,CAAC,aAAa,KAAK,CAAC,QAAQ,sCAAsC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;qBAC9F;iBACD;aACD;YAED,IAAI,OAAO,EAAE;gBACZ,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,EAAE,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;aAC1D;QACF,CAAC;QAEO,CAAC;YACR,CAAC,GAAG,IAAI,CAAC,CAAC,CAAY,MAAM,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,SAAe,EAAO,EAAE,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC,CAAC;YACvF,CAAC,GAAG,IAAI,CAAC,CAAC,CAAc,MAAM,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,WAAiB,EAAS,EAAE,CAAC,WAAW,CAAC,CAAC,EAAe,CAAC,CAAC;YACtG,CAAC,GAAG,IAAI,CAAC,CAAC,CAAsB,MAAM,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,SAAe,EAAO,EAAE,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC,CAAC;YACjG,CAAC,GAAG,IAAI,CAAC,CAAC,CAAwB,MAAM,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,WAAiB,EAAS,EAAE,CAAC,WAAW,CAAC,CAAC,EAAe,CAAC,CAAC;YAChH,IAAI,CAAC,CAAC,CAAY,KAAK,EAAE,CAAC;YAC1B,IAAI,CAAC,CAAC,CAAc,KAAK,EAAE,CAAC;YAC5B,IAAI,CAAC,CAAC,CAAsB,KAAK,EAAE,CAAC;YACpC,IAAI,CAAC,CAAC,CAAwB,KAAK,EAAE,CAAC;QACvC,CAAC;QAEQ,OAAO;YACf,IAAI,CAAC,CAAC,EAAe,CAAC;YACtB,IAAI,CAAC,CAAC,CAAU,IAAI,EAAE,CAAC;YACvB,KAAK,CAAC,OAAO,EAAE,CAAC;QACjB,CAAC;KACD,CAAA;IAxYY,oBAAI;mBAAJ,IAAI;QAwBd,WAAA,cAAI,CAAA;QACJ,WAAA,mBAAG,CAAA;QACH,WAAA,WAAG,CAAA;QACH,YAAA,iBAAG,CAAA;OA3BO,IAAI,CAwYhB;IAEM,IAAM,IAAI,GAAV,MAAM,IAAwB,SAAQ,IAAI;QAIhD,YAAY,SAAc,EAAE,GAAW,EAAE,MAAc,EAAE,MAAkB,EAAE,OAA4B,EAAS,aAAmB,EAAU,YAA6C,EAC1K,cAAoB,EACd,oBAAyB,EACjC,YAAiB,EACX,kBAAuB;YAE5C,KAAK,CAAC,SAAS,EAAE,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,aAAa,EAAE,YAAY,EAAE,cAAc,EAAE,oBAAoB,EAAE,YAAY,EAAE,kBAAkB,CAAC,CAAC;YACpJ,IAAI,CAAC,CAAC,GAAqB,IAAI,SAAE,CAAG,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,2BAA2B,CAAC,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,aAAa,CAChJ,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;QACnB,CAAC;QAED,IAAa,QAAQ;YACpB,OAAO,IAAI,CAAC,CAAU,CAAC;QACxB,CAAC;QAED,IAAI,kBAAkB;YACrB,OAAO,IAAI,CAAC,CAAC,CAAmB,KAAK,CAAC;QACvC,CAAC;KACD,CAAA;IAtBY,oBAAI;mBAAJ,IAAI;QAKd,WAAA,cAAI,CAAA;QACJ,WAAA,mBAAG,CAAA;QACH,WAAA,WAAG,CAAA;QACH,YAAA,iBAAG,CAAA;OARO,IAAI,CAsBhB;IAED;;OAEG;IACI,IAAM,IAAI,GAAV,MAAM,IAAyB,SAAQ,IAAI;QACjD,YAAY,SAAc,EAAE,GAAW,EAAE,MAAc,EAAE,MAAkB,EAAE,OAAa,EACxE,cAAoB,EACd,oBAAyB,EACjC,YAAiB,EACX,kBAAuB;YAE5C,KAAK,CAAC,SAAS,EAAE,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,cAAc,EAAE,oBAAoB,EAAE,YAAY,EAAE,kBAAkB,CAAC,CAAC;QACvI,CAAC;QAEO,CAAC,CAAmB,GAAQ;YACnC,OAAO,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC;QAClG,CAAC;QAEO,CAAC,CAAS,IAAS,EAAE,GAAQ;YACpC,OAAO,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QAC1D,CAAC;QAEO,CAAC,CAAe,KAAmB,EAAE,cAAqD,EAAE,UAA8B,EAAE,MAAY,EAAS,YAAwB,EAAE,WAA4C,EAAE,gBAAwB;YACxP,MAAM,SAAS,GACd,IAAI,CAAC,CAAC,CAAoB,cAAc,CACvC,IAAI,EACJ,KAAK,EACL,cAAc,EACd,UAAU,EACV,MAAM,EACN,YAAY,EACZ,WAAW,EACX,gBAAgB,CAChB,CAAC;YACH,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;YAC5B,MAAM,UAAU,GAAG,SAAS,CAAC,QAAQ,CAAC,CAAC,EAAE,SAAS,EAAE,EAAE,EAAE,CAAC,MAAM,CAAC,YAAY,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC;YACpG,SAAS,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC;YAChD,OAAO,SAAS,CAAC;QAClB,CAAC;QAED,2BAA2B,CAAC,YAA6B,EAAE,gBAAwB;YAElF,IAAI,CAAC,IAAI,CAAC,CAAC,CAAY,IAAI,CAAC,QAAQ,EAAE,YAAY,CAAC,QAAQ,CAAC,EAAE;gBAC7D,MAAM,KAAK,CAAC,GAAG,YAAY,CAAC,QAAQ,2BAA2B,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;aAChF;YAED,MAAM,oBAAoB,GAAU,EAAE,CAAC;YACvC,IAAI,GAAG,GAAG,IAAI,CAAC,CAAC,CAAmB,YAAY,CAAC,QAAQ,CAAC,CAAC;YAE1D,OAAO,CAAC,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,kBAAkB,EAAE,GAAG,CAAC,EAAE;gBACrD,oBAAoB,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;gBAClC,MAAM,OAAO,GAAG,GAAG,CAAC;gBACpB,GAAG,GAAG,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,2BAA2B,CAAC,IAAI,CAAC,CAAC,CAAmB,GAAG,CAAC,CAAC,CAAC;gBAChG,IAAI,IAAI,CAAC,CAAC,CAAS,OAAO,EAAE,GAAG,CAAC,EAAE;oBACjC,MAAM,KAAK,CAAC,GAAG,YAAY,CAAC,QAAQ,8CAA8C,IAAI,CAAC,kBAAkB,EAAE,CAAC,CAAC;iBAC7G;aACD;YAED,MAAM,IAAI,GAAG,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC;YACtC,IAAI,MAAM,GAAgB,IAAI,CAAC;YAC/B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,oBAAoB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBACrD,IAAI,WAAW,GAAwC,MAAM,CAAC,cAAc,CAAC,oBAAoB,CAAC,CAAC,CAAC,CAAC,CAAC;gBACtG,IAAI,CAAC,WAAW,EAAE;oBACjB,WAAW,GAAG,MAAM,CAAC,6BAA6B,CAAC,oBAAoB,CAAC,CAAC,CAAC,EAAE,oBAAoB,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,EAAO,IAAI,CAAC,CAAC;iBACvI;gBACD,MAAM,GAAG,WAAW,CAAC;aACrB;YAED,OAAO,IAAI,CAAC,CAAC,CAAe,IAAI,CAAC,CAAC,CAAM,cAAc,EAAE,IAAI,CAAC,CAAC,CAAM,cAAc,EAAE,IAAI,CAAC,CAAC,CAAM,UAAU,EAAE,MAAM,EAAE,YAAY,EAAE,IAAI,EAAE,gBAAgB,CAAC,CAAC;QAC3J,CAAC;KACD,CAAA;IAlEY,oBAAI;mBAAJ,IAAI;QAEd,WAAA,cAAI,CAAA;QACJ,WAAA,mBAAG,CAAA;QACH,WAAA,WAAG,CAAA;QACH,WAAA,iBAAG,CAAA;OALO,IAAI,CAkEhB;IAED;;;OAGG;IACI,IAAM,IAAI,GAAV,MAAM,IAAkB,SAAQ,IAAI;QAC1C,YAAY,GAAW,EAAE,MAAc,EAAE,MAAkB,EAAE,OAAa,EACxD,cAAoB,EACd,oBAAyB,EACjC,YAAiB,EACX,kBAAuB;YAG5C,KAAK,CAAC,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,cAAc,EAAE,oBAAoB,EAAE,YAAY,EAAE,kBAAkB,CAAC,CAAC;QAClI,CAAC;QAED,2BAA2B,CAAC,YAAwB,EAAE,gBAAwB;YAC7E,MAAM,SAAS,GAAG,IAAI,CAAC,CAAC,CAAoB,cAAc,CACzD,IAAI,EACJ,IAAI,CAAC,CAAC,CAAM,cAAc,EAC1B,IAAI,CAAC,CAAC,CAAM,cAAc,EAC1B,IAAI,CAAC,CAAC,CAAM,UAAU,EACtB,IAAI,EAAE,YAAY,EAClB,IAAI,EACJ,gBAAgB,CAAC,CAAC;YACnB,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;YAC1B,MAAM,UAAU,GAAG,SAAS,CAAC,QAAQ,CAAC,CAAC,EAAE,SAAS,EAAE,EAAE,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC;YAClG,SAAS,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC;YAChD,OAAO,SAAS,CAAC;QAClB,CAAC;KACD,CAAA;IAzBY,oBAAI;mBAAJ,IAAI;QAEd,WAAA,cAAI,CAAA;QACJ,WAAA,mBAAG,CAAA;QACH,WAAA,WAAG,CAAA;QACH,WAAA,iBAAG,CAAA;OALO,IAAI,CAyBhB;IAED,IAAI,UAAU,GAAW,CAAC,CAAC,CAAC;IAC5B,IAAI,UAAU,GAAW,CAAC,CAAC,CAAC;IAC5B;;;OAGG;IACH,SAAgB,IAAI,CAAgB,QAAyB,EAAE,QAAyB,EAAE,mDAAoD;QAE7I,IAAI,QAAQ,YAAY,IAAI,IAAS,QAAQ,YAAY,IAAI,EAAS;YACrE,OAAO,CAAC,CAAC;SACT;QAED,IAAI,QAAQ,YAAY,IAAI,IAAS,QAAQ,YAAY,IAAI,EAAS;YACrE,OAAO,CAAC,CAAC,CAAC;SACV;QAED,IAAI,QAAQ,YAAY,IAAI,IAAW,QAAQ,YAAY,IAAI,EAAS;YACvE,UAAU,GAAG,QAAQ,CAAC,KAAK,EAAE,CAAC;YAC9B,UAAU,GAAG,QAAQ,CAAC,KAAK,EAAE,CAAC;YAC9B,IAAI,UAAU,KAAK,CAAC,CAAC,IAAI,UAAU,KAAK,CAAC,CAAC,EAAE;gBAC3C,OAAO,UAAU,GAAG,UAAU,CAAC;aAC/B;YAED,QAAQ,SAAS,EAAE;gBAClB;oBACC,OAAO,QAAQ,CAAC,KAAK,EAAE,GAAG,QAAQ,CAAC,KAAK,EAAE,CAAC;gBAC5C;oBACC,OAAO,QAAQ,CAAC,KAAK,EAAE,GAAG,QAAQ,CAAC,KAAK,EAAE,CAAC;gBAC5C;oBACC,OAAO,IAAA,eAAG,EAAmB,QAAQ,CAAC,IAAI,EAAE,EAAE,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC;gBAChE;oBACC,OAAO,IAAA,eAAG,EAAc,QAAQ,CAAC,IAAI,EAAE,EAAE,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC;gBAC3D,yBAAyB;gBACzB;oBACC,IAAI,CAAC,QAAQ,CAAC,QAAQ,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE;wBAC7C,OAAO,CAAC,CAAC;qBACT;oBACD,OAAO,IAAA,eAAG,EAAU,QAAQ,CAAC,QAAQ,CAAC,MAAM,EAAE,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,IAAA,eAAG,EAAc,QAAQ,CAAC,IAAI,EAAE,EAAE,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC;aAC/H;SACD;QAED,IAAI,QAAQ,YAAY,IAAI,IAAS,QAAQ,YAAY,IAAI,EAAO;YACnE,QAAQ,SAAS,EAAE;gBAClB;oBACC,OAAO,QAAQ,CAAC,KAAK,EAAE,GAAG,QAAQ,CAAC,KAAK,EAAE,CAAC;gBAC5C;oBACC,OAAO,QAAQ,CAAC,KAAK,EAAE,GAAG,QAAQ,CAAC,KAAK,EAAE,CAAC;gBAC5C;oBACC,OAAO,IAAA,eAAG,EAAmB,QAAQ,CAAC,IAAI,EAAE,EAAE,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC;gBAChE;oBACC,OAAO,IAAA,eAAG,EAAc,QAAQ,CAAC,IAAI,EAAE,EAAE,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC;gBAC3D,8CAA6B,CAAC,CAAC;oBAC9B,MAAM,SAAS,GAAG,QAAQ,CAAC,QAAQ,CAAC;oBACpC,MAAM,SAAS,GAAG,QAAQ,CAAC,QAAQ,CAAC;oBACpC,IAAI,SAAS,IAAI,SAAS,EAAE;wBAC3B,OAAO,SAAS,CAAC,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC;qBAEzC;iBACD;gBACD,yBAAyB;gBACzB;oBACC,OAAO,IAAA,eAAG,EAAU,QAAQ,CAAC,QAAQ,CAAC,MAAM,EAAE,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,IAAA,eAAG,EAAc,QAAQ,CAAC,IAAI,EAAE,EAAE,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC;aAC/H;SACD;QAED,IAAI,QAAQ,YAAY,IAAI,IAAe,QAAQ,YAAY,IAAI,EAAa;YAC/E,OAAO,IAAI,CAAe,QAAQ,EAAE,QAAQ,CAAC,CAAC;SAC9C;QAED,IAAI,QAAQ,YAAY,IAAI,IAAK,QAAQ,YAAY,IAAI,EAAG;YAC3D,OAAO,WAAG,CAAG,wBAAwB,CAAC,QAAQ,CAAC,KAAK,EAAE,EAAE,QAAQ,CAAC,KAAK,EAAE,CAAC,CAAC;SAC1E;QAED,OAAO,CAAC,CAAC;IACV,CAAC;IApED,oBAoEC;IAED,SAAgB,IAAI,CAAe,MAAY,EAAa,MAAY;QACvE,IAAI,MAAM,CAAC,SAAS,KAAK,MAAM,CAAC,SAAS,EAAE;YAE1C,IAAI,MAAM,CAAC,YAAY,KAAK,SAAS,IAAI,MAAM,CAAC,YAAY,KAAK,SAAS,EAAE;gBAC3E,OAAO,MAAM,CAAC,YAAY,GAAG,MAAM,CAAC,YAAY,CAAC;aACjD;iBAAM,IAAI,MAAM,CAAC,YAAY,KAAK,SAAS,IAAI,MAAM,CAAC,YAAY,KAAK,SAAS,EAAE;gBAClF,OAAO,WAAG,CAAG,wBAAwB,CAAC,MAAM,CAAC,KAAK,EAAE,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC;aACtE;iBAAM;gBACN,yDAAyD;gBACzD,IAAI,MAAM,CAAC,YAAY,KAAK,SAAS,EAAE;oBACtC,OAAO,CAAC,CAAC;iBACT;qBAAM;oBACN,OAAO,CAAC,CAAC,CAAC;iBACV;aACD;SACD;aAAM,IAAI,MAAM,CAAC,SAAS,GAAG,MAAM,CAAC,SAAS,EAAE;YAC/C,OAAO,CAAC,CAAC,CAAC;SACV;aAAM;YACN,OAAO,CAAC,CAAC;SACT;IACF,CAAC;IApBD,oBAoBC;IACD,SAAgB,IAAI,CAAW,QAAyB,EAAE,QAAyB,EAAE,mDAAoD;QACxI,MAAM,YAAY,GAAG,gBAAgB,CAAC,QAAQ,CAAC,CAAC;QAChD,MAAM,YAAY,GAAG,gBAAgB,CAAC,QAAQ,CAAC,CAAC;QAEhD,IAAI,CAAC,GAAG,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC;QAChC,IAAI,CAAC,GAAG,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC;QAChC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;YACxB,IAAI,YAAY,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,KAAK,YAAY,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE;gBAClD,OAAO,IAAI,CAAgB,YAAY,CAAC,CAAC,CAAC,EAAE,YAAY,CAAC,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;aACxE;YACD,CAAC,EAAE,CAAC;YACJ,CAAC,EAAE,CAAC;SACJ;QACD,MAAM,UAAU,GAAG,CAAC,KAAK,CAAC,CAAC;QAC3B,MAAM,UAAU,GAAG,CAAC,KAAK,CAAC,CAAC;QAE3B,IAAI,UAAU,IAAI,CAAC,UAAU,EAAE;YAC9B,OAAO,CAAC,CAAC;SACT;aAAM,IAAI,CAAC,UAAU,IAAI,UAAU,EAAE;YACrC,OAAO,CAAC,CAAC,CAAC;SACV;QACD,OAAO,CAAC,CAAC;IACV,CAAC;IAtBD,oBAsBC;IAED,SAAS,gBAAgB,CAAC,OAAwB;QACjD,MAAM,WAAW,GAAsB,EAAE,CAAC;QAC1C,IAAI,WAAW,GAAmC,OAAO,CAAC;QAE1D,OAAO,CAAC,CAAC,WAAW,YAAY,IAAI,CAAS,EAAE;YAC9C,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAC9B,WAAW,GAAG,WAAW,CAAC,MAAM,EAAE,CAAC;SACnC;QAED,OAAO,WAAW,CAAC;IACpB,CAAC;IACM,IAAM,IAAI,GAAV,MAAM,IAAa,SAAQ,eAAG;QAiBpC,YACQ,WAAiB,EACP,CAAqC,EAC/B,CAA0C,EAClD,CAAkC,EAC5B,CAAwC,EACrC,CAA4C;YAEpE,KAAK,EAAE,CAAC;YAPD,gBAAW,GAAX,WAAW,CAAM;YACU,MAAC,GAAD,CAAC,CAAmB;YACd,MAAC,GAAD,CAAC,CAAwB;YACjC,MAAC,GAAD,CAAC,CAAgB;YACX,MAAC,GAAD,CAAC,CAAsB;YACpB,MAAC,GAAD,CAAC,CAA0B;YArB7D,MAAC,GAAW,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,CAA4B;gBACrE,KAAK,EAAE,uBAAuB;aAC9B,CAAC,CAAC,CAAC;YACK,aAAQ,GAAwB,IAAI,CAAC,CAAC,CAAS,KAAK,CAAC;YACtD,MAAC,GAA4C,EAAE,CAAC;YAChD,MAAC,GAAsC,IAAI,CAAC;YAC5C,MAAC,GAAoE,uBAAG,CAAe,OAAO,CAA2B,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC,CAAC;YACtL,MAAC,GAA0B,KAAK,CAAC;YACjC,MAAC,GAA2B,IAAI,CAAC;YAEjC,MAAC,GAAgC,GAAG,EAAE,GAAG,CAAC,CAAC;YAC3C,MAAC,GAAU,KAAK,CAAC;YAaxB,IAAI,CAAC,CAAC,GAA4B,IAAI,CAAC,CAAC,CAAoB,cAAc,CAAC,IAAI,CAAsB,CAAC;YAEtG,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,CAAC,CAAY,YAAY,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAY,KAAK,CAAC,CAAC,CAAC,CAAC;YAElF,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,CAAC,CAAqB,sBAAsB,CAAC,MAAM,CAAC,EAAE;gBACzE,IAAI,MAAM,YAAY,2BAAI,EAAkB;oBAC3C,IAAI,CAAC,CAAC,CAAkD,MAAM,CAAC,CAAC;iBAChE;YACF,CAAC,CAAC,CAAC,CAAC;YAEJ,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE;gBAChC,IAAI,CAAC,CAAC,OAAO,EAAE;oBACd,IAAI,CAAC,CAAC,GAAU,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;iBAChC;YACF,CAAC,CAAC,CAAC,CAAC;QACL,CAAC;QAED,KAAK,CAAC,YAAY,CAAC,iBAAoC;YACtD,IAAI;gBACH,IAAI,CAAC,CAAC,CAAS,KAAK,EAAE,CAAC;gBACvB,MAAM,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE;oBACtD,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;oBAE7B,IAAI,CAAC,MAAM,YAAY,IAAI,IAAW,MAAM,YAAY,IAAI,CAAM,IAAI,IAAI,CAAyB,MAAM,EAAE,iBAAiB,CAAC,EAAE;wBAC9H,kDAAkD;wBAClD,OAAO;qBACP;oBAED,IAAI,IAAI,YAAY,IAAI,EAAO;wBAC9B,MAAM,IAAI,CAAC,MAAM,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;qBAClC;yBAAM,IAAI,IAAI,YAAY,IAAI,EAAG;wBACjC,MAAM,IAAI,CAAC,MAAM,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;qBAClC;yBAAM,IAAI,IAAI,YAAY,IAAI,EAAS;wBACvC,MAAM,IAAI,CAAC,UAAU,EAAE,CAAC;qBACxB;gBACF,CAAC,CAAC,CAAC,CAAC;aACJ;oBAAS;gBACT,IAAI,CAAC,CAAC,CAAS,MAAM,EAAE,CAAC;aACxB;QACF,CAAC;QAED,WAAW,CAAC,gBAAmC;YAC9C,+DAA+D;YAC/D,MAAM,YAAY,GAAsB,EAAE,CAAC;YAE3C,IAAI;gBACH,IAAI,CAAC,CAAC,CAAS,KAAK,EAAE,CAAC;gBACvB,gBAAgB,CAAC,OAAO,CAAC,CAAC,cAAc,EAAE,EAAE;oBAC3C,IAAI,CAAC,IAAI,CAAyB,cAAc,EAAE,YAAY,CAAC,EAAE;wBAChE,cAAc,CAAC,MAAM,EAAE,CAAC,MAAM,CAAoD,cAAc,CAAC,CAAC;wBAClG,YAAY,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;qBAClC;gBACF,CAAC,CACA,CAAC;aACF;oBAAS;gBACT,IAAI,CAAC,CAAC,CAAS,MAAM,EAAE,CAAC;aACxB;QACF,CAAC;QAED,IAAI,OAAO;YACV,OAAO,IAAI,CAAC,CAAC,CAAQ;QACtB,CAAC;QAED,IAAI,KAAK;YACR,OAAO,IAAI,CAAC,CAAC,CAAM;QACpB,CAAC;QAED,IAAI,KAAK,CAAC,KAAwB;YACjC,kIAAkI;YAClI,MAAM,gBAAgB,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC;YAC9C,IAAI,OAAO,CAAO,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,GAAoB,OAAO,CAAC;iBAC7D,IAAI,CAAC,GAAG,EAAE,CAAC,gBAAgB,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC;iBAC5D,IAAI,CAAC,GAAG,EAAE,CAAC,gBAAgB,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;iBAC9D,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC,GAAU,KAAK,CAAC,CAAC;YAEpC,IAAI,CAAC,CAAC,CAA0B,oBAAoB,EAAE,CAAC;YACvD,IAAI,CAAC,CAAC,GAAmB,uBAAG,CAAe,OAAO,CAA0B,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC,CAAC;YAEzI,IAAI,CAAC,KAAK,EAAE;gBACX,OAAO;aACP;YAED,IAAI,CAAC,CAAC,GAAgB,CAAC,KAAK,IAAI,KAAK,CAAC,aAAa,IAAI,EAAE,CAAC;iBACxD,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,MAAM,CAAC;iBACpB,GAAG,CAAC,CAAC,QAAQ,EAAE,KAAK,EAAE,EAAE,CAA2B,IAAI,CAAC,CAAC,CAAsB,QAAQ,EAAE,QAAQ,CAAC,QAAQ,EAAE,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC;YAE/H,IAAI,CAAC,CAAC,CAAc,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAiB,GAAG,CAAC,EAAE,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC,CAAC;YAC/E,IAAI,CAAC,CAAC,GAAqC,IAAI,CAAC,CAAC,CAAsB,IAAI,EAAE,YAAY,EAAE,IAAI,CAAC,CAAC,CAAc,MAAM,GAAG,CAAC,EAAE,KAAK,CAAC,CAAC;YAElI,IAAI,CAAC,CAAC,GAAQ,KAAK,CAAC;QACrB,CAAC;QAEO,CAAC,CAA4B,MAAY;YAEhD,IAAI,CAAC,CAAC,EAA2B,OAAO,EAAE,CAAC;YAC3C,IAAI,CAAC,CAAC,GAA4B,MAAM,CAAC,iBAAiB,CACzD,CAAC,KAAK,EAAE,EAAE;gBACT,IAAI,KAAK,EAAE;oBACV,IAAI,CAAC,CAAC,CAA6B,MAAM,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC;iBACvD;YACF,CAAC,CACD,CAAC;YAEF,IAAI,CAAC,CAAC,EAA0B,OAAO,EAAE,CAAC;YAC1C,6EAA6E;YAC7E,IAAI,CAAC,CAAC,GAA2B,MAAM,CAAC,oBAAoB,CAC3D,GAAG,EAAE;gBACJ,IAAI,MAAM,CAAC,QAAQ,EAAE,EAAE;oBACtB,IAAI,CAAC,CAAC,CAA2B,MAAM,EAAE,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;iBAC/D;YACF,CAAC,CACD,CAAC;QACH,CAAC;QAEO,CAAC,CAAY,KAAiB;YACrC,MAAM,WAAW,GAAG,IAAI,CAAC,CAAC,CAAiB,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YACjE,WAAW,EAAE,SAAS,CAAC,KAAK,CAAC,CAAC;QAC/B,CAAC;QAEO,KAAK,CAAC,CAAC,CAA2B,MAAY,EAAkB,QAAa;YACpF,MAAM,WAAW,GAAG,IAAI,CAAC,CAAC,CAAiB,UAAU,CAAC,QAAQ,CAAC,CAAC;YAChE,MAAM,WAAW,EAAE,wBAAwB,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;QAC/D,CAAC;QAEO,CAAC,CAA6B,MAAY,EAAkB,QAAa;YAChF,MAAM,WAAW,GAAG,IAAI,CAAC,CAAC,CAAiB,UAAU,CAAC,QAAQ,CAAC,CAAC;YAChE,WAAW,EAAE,0BAA0B,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;QAC3D,CAAC;QAEO,CAAC,CAAsB,QAAoB,EAAE,EAAU,EAAE,KAAa,EAAE,KAAiB;YAChG,IAAI,WAAiB,CAAQ;YAC7B,IAAI,QAAQ,EAAE;gBACb,WAAW,GAAG,IAAI,CAAC,CAAC,CAAoB,cAAc,CAAC,IAAI,EAAsB,QAAQ,EAAE,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;aACnH;iBAAM;gBACN,WAAW,GAAG,IAAI,CAAC,CAAC,CAAoB,cAAc,CAAC,IAAI,EAAe,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;aAClG;YACD,MAAM,UAAU,GAAG,WAAW,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;YAC/E,WAAW,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC;YAClD,OAAO,WAAW,CAAC;QACpB,CAAC;QAGD,GAAG,CAAC,MAAoB,EAAE,gBAAwB,EAAE,SAAkB,KAAK;YAC1E,2EAA2E;YAE3E,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,CAAC;YAC5D,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;gBACtB,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE;oBAChB,OAAO;iBACP;gBAED,MAAM,WAAW,GAAG,IAAI,CAAC,CAAC,CAAc,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;gBACzD,WAAW,EAAE,YAAY,CAAC,GAAG,EAAE,MAAM,EAAE,gBAAgB,CAAC,CAAC;YAC1D,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,CAAC,EAAiB,YAAY,CAAC,KAAK,EAAE,MAAM,EAAE,gBAAgB,CAAC,CAAC;YACrE,IAAI,CAAC,CAAC,EAAmB,CAAC;QAC3B,CAAC;QAED,KAAK;YACJ,IAAI,CAAC,aAAa,EAAE,CAAC,OAAO,CAAC,CAAC,WAAW,EAAE,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;YACvE,IAAI,CAAC,CAAC,EAAe,CAAC;YACtB,IAAI,CAAC,CAAC,GAAgB,EAAE,CAAC;YACzB,IAAI,CAAC,CAAC,GAAkB,IAAI,CAAC;QAC9B,CAAC;QAED,MAAM,CAAC,OAA8D;YACpE,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;gBAC5B,OAAO,GAAG,CAAC,OAAO,CAAC,CAAC;aACpB;YAED,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;gBACnB,IAAI,CAAC,YAAY,IAAI,EAAS;oBAC7B,CAAC,CAAC,KAAK,EAAE,CAAC;iBACV;YACF,CAAC,CAAC,CAAC;YAEH,MAAM,WAAW,GAAgB,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,YAAY,IAAI,CAAqB,CAAC;YAE5F,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,CAAC,CAAkB,WAAW,CAAC,CAAC;YACjE,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;gBAC1B,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;oBACpB,OAAO;iBACP;gBAED,IAAI,CAAC,CAAC,CAAc,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAc,OAAO,CAAC,CAAC;YACvE,CAAC,CAAC,CAAC;YAEH,IAAI,KAAK,CAAC,MAAM,EAAE;gBACjB,IAAI,CAAC,CAAC,CAAc,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAc,KAAK,CAAC,CAAC;aAClE;QACF,CAAC;QAED,OAAO,CAAC,KAAW;YAClB,OAAO,IAAI,CAAC,CAAC,CAAc,KAAK,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QAC3D,CAAC;QAED,UAAU,CAAC,QAAkC;YAC5C,IAAI,CAAC,CAAC,GAAc,IAAI,CAAC;YAEzB,MAAM,OAAO,GAAG,IAAI,CAAC,CAAC,CAAc,OAAO,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,QAAQ,CAAC,CAAC;YAEtE,OAAO,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE;gBACxB,IAAI,CAAC,CAAC,GAAc,KAAK,CAAC;gBAC1B,IAAI,CAAC,KAAK,EAAE,CAAC;YACd,CAAC,EAAE,GAAG,EAAE;gBACP,IAAI,CAAC,CAAC,GAAc,KAAK,CAAC;YAC3B,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,aAAa;YACZ,OAAO,IAAI,CAAC,CAAC,CAAgB,CAAC;gBAC7B;oBACC,GAAG,IAAI,CAAC,CAAC;oBACT,IAAI,CAAC,CAAC;iBACN,CAAC,CAAC;gBACH;oBACC,GAAG,IAAI,CAAC,CAAC;iBACT,CAAC;QACJ,CAAC;QAED,OAAO;YACN,MAAM,OAAO,GAAkB,EAAE,CAAC;YAClC,IAAI,CAAC,aAAa,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE;gBAC1C,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,wBAAwB,EAAE,CAAC,CAAC;YACtD,CAAC,CAAC,CAAC;YAEH,OAAqB,EAAG,CAAC,MAAM,CAAC,GAAG,OAAO,CAAC,CAAC;QAC7C,CAAC;QAED,OAAO;YACN,OAAO,IAAI,CAAC,aAAa,EAAE,CAAC,KAAK,CAAC,CAAC,WAAW,EAAE,EAAE,CAAC,WAAW,CAAC,OAAO,EAAE,CAAC,CAAC;QAC3E,CAAC;QAED,SAAS;YACR,OAAO,IAAI,CAAC,aAAa,EAAE,CAAC,MAAM,CAAS,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE,CAAC,IAAI,GAAG,KAAK,CAAC,kBAAkB,EAAE,EAAE,CAAC,CAAC,CAAC;QACnG,CAAC;QAED,KAAK;YACJ,OAAO,IAAI,CAAC,OAAO,EAAE,CAAC,MAAM,CAAS,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE,CAAC,IAAI,GAAG,KAAK,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC;QAChF,CAAC;QAED,IAAI,cAAc;YACjB,OAAO,IAAI,CAAC,CAAC,CAAe;QAC7B,CAAC;QAED,gBAAgB,CAAC,KAAc;YAC9B,IAAI,IAAI,CAAC,CAAC,KAAmB,KAAK,EAAE;gBACnC,OAAO;aACP;YACD,IAAI,CAAC,CAAC,GAAiB,KAAK,CAAC;YAC7B,IAAI,aAAa,GAAiB,IAAI,CAAC;YACvC,IAAI,CAAC,OAAO,EAAE,CAAC,OAAO,CAAC,CAAC,SAAe,EAAO,EAAE;gBAC/C,SAAS,CAAC,gBAAgB,EAAE,CAAC;gBAC7B,SAAS,CAAC,wBAAwB,EAAE,CAAC;gBACrC,IAAI,CAAC,aAAa,EAAE;oBACnB,aAAa,GAAG,SAAS,CAAC,gBAAgB,EAAE,CAAC;iBAC7C;YACF,CAAC,CAAC,CAAC;YACH,IAAI,IAAI,CAAC,CAAC,IAAkB,aAAa,EAAE;gBAC1C,MAAM;gBACN,IAAI,CAAC,CAAC,CAA0B,cAAc,CACrC,aAAc,CAAC,MAAM,EAAE,CAAC,QAAQ,EAChC,aAAc,CAAC,KAAK,EAAE,CAC9B,CAAC;aACF;iBAAM;gBACN,IAAI,CAAC,CAAC,CAA0B,oBAAoB,EAAE,CAAC;aACvD;QACF,CAAC;QAED,IAAI,yBAAyB;YAC5B,OAAO,IAAI,CAAC,CAAC,CAA0B;QACxC,CAAC;QAEO,CAAC,CAAc,QAAa;YACnC,MAAM,WAAW,GAAG,IAAI,CAAC,CAAC,CAAiB,UAAU,CAAC,QAAQ,CAAC,CAAC;YAChE,OAAO,WAAW,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,CAAiB,CAAC;QAC3D,CAAC;QAED,IAAY,CAAC,CAAY,OAAgB;YACxC,IAAI,CAAC,aAAa,EAAE,CAAC,OAAO,CAAC,CAAC,WAAW,EAAE,EAAE;gBAC5C,WAAW,CAAC,YAAY,GAAG,OAAO,CAAC;YACpC,CAAC,CAAC,CAAC;QACJ,CAAC;QAEO,CAAC,CAAkB,WAAyB;YACnD,MAAM,YAAY,GAAG,IAAI,SAAG,EAAwB,CAAC;YACrD,MAAM,gBAAgB,GAAiB,EAAE,CAAC;YAC1C,IAAI,CAAC,CAAC,CAAc,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC,YAAY,CAAC,GAAG,CAAC,EAAE,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC,CAAC;YAErE,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE;gBAClC,MAAM,WAAW,GAAG,IAAI,CAAC,CAAC,CAAc,YAAY,CAAC,QAAQ,CAAC,CAAC;gBAC/D,IAAI,CAAC,WAAW,EAAE;oBACjB,yEAAyE;oBACzE,OAAO;iBACP;gBAED,MAAM,QAAQ,GAAG,WAAW,CAAC,QAAQ,CAAC;gBACtC,IAAI,QAAQ,EAAE;oBACb,YAAY,CAAC,GAAG,CAAC,QAAQ,CAAE,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;iBAC/C;qBAAM;oBACN,gBAAgB,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;iBACpC;YACF,CAAC,CAAC,CAAC;YAEH,OAAO;gBACN,QAAQ,EAAE,YAAY;gBACtB,KAAK,EAAE,gBAAgB;aACvB,CAAC;QACH,CAAC;QAEO,CAAC;YACR,IAAI,CAAC,aAAa,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE,CAAC,WAAW,CAAC,OAAO,EAAE,CAAC,CAAC;YACnE,IAAI,CAAC,CAAC,GAAgB,EAAE,CAAC;YACzB,IAAI,CAAC,CAAC,GAAmB,uBAAG,CAAe,OAAO,CAA0B,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC,CAAC;YACzI,IAAI,CAAC,CAAC,CAA0B,oBAAoB,EAAE,CAAC;QACxD,CAAC;QAEQ,OAAO;YACf,IAAI,CAAC,CAAC,EAA2B,OAAO,EAAE,CAAC;YAC3C,IAAI,CAAC,CAAC,EAA0B,OAAO,EAAE,CAAC;YAC1C,IAAI,CAAC,CAAC,EAAmB,CAAC;YAC1B,IAAI,CAAC,CAAC,EAAe,CAAC;YACtB,IAAI,CAAC,CAAC,CAA0B,OAAO,EAAE,CAAC;YAC1C,KAAK,CAAC,OAAO,EAAE,CAAC;QACjB,CAAC;KACD,CAAA;IAhWY,oBAAI;mBAAJ,IAAI;QAmBd,WAAA,cAAI,CAAA;QACJ,WAAA,mBAAG,CAAA;QACH,WAAA,WAAG,CAAA;QACH,WAAA,iBAAG,CAAA;QACH,WAAA,4BAAI,CAAA;OAvBM,IAAI,CAgWhB;IAEM,IAAM,IAAI,GAAV,MAAM,IAAY,SAAQ,eAAG;QAuBnC,YACiB,CAAmC,EAChC,CAAsC,EAClC,CAA0C,EAC1C,CAA0C,EACpD,CAAgC,EACrB,CAA4C;YAEpE,KAAK,EAAE,CAAC;YAPyB,MAAC,GAAD,CAAC,CAAiB;YACf,MAAC,GAAD,CAAC,CAAoB;YACjB,MAAC,GAAD,CAAC,CAAwB;YACzB,MAAC,GAAD,CAAC,CAAwB;YACnC,MAAC,GAAD,CAAC,CAAc;YACJ,MAAC,GAAD,CAAC,CAA0B;YA1B7D,MAAC,GAAiC,IAAI,CAAC;YACvC,MAAC,GAAyB,KAAK,CAAC;YAChC,MAAC,GAA+B,IAAI,CAAC;YACrC,MAAC,GAAwC,IAAI,CAAC;YAC9C,MAAC,GAAwB,KAAK,CAAC;YAC/B,MAAC,GAAkC,OAAO,CAAC,OAAO,EAAE,CAAC;YAC5C,MAAC,GAA4B,EAAE,CAAC;YAEhC,MAAC,GAAsC,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAY,CAAC,CAAC;YACnF,yBAAoB,GAAgB,IAAI,CAAC,CAAC,CAAqB,KAAK,CAAC;YAE7D,MAAC,GAAwB,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,CAA4B;gBAC3F,KAAK,EAAE,uBAAuB;aAC9B,CAAC,CAAC,CAAC;YACK,0BAAqB,GAAwB,IAAI,CAAC,CAAC,CAAsB,KAAK,CAAC;YAEhF,MAAC,GAA0D,IAAI,CAAC;YAChE,MAAC,GAAsC,KAAK,CAAC;YAYpD,IAAI,CAAC,CAAC,GAAe,IAAI,CAAC,CAAC,CAAoB,cAAc,CAAC,IAAI,EAAU,IAAI,CAAC,CAAC;YAClF,IAAI,CAAC,CAAC,GAA8B,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,CAAC,CAAa,QAAQ,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,CAAC,CAAsB,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC7H,CAAC;QAED,eAAe;YACd,OAAO,IAAI,CAAC,CAAC,CAAc;QAC5B,CAAC;QAED,IAAI,aAAa,CAAC,aAAsB;YACvC,IAAI,CAAC,CAAC,GAAgB,aAAa,CAAC;QACrC,CAAC;QAED,IAAI,cAAc;YACjB,OAAO,IAAI,CAAC,CAAC,CAAe;QAC7B,CAAC;QAED,IAAI,aAAa;YAChB,OAAO,IAAI,CAAC,CAAC,IAAiB,EAAE,CAAC;QAClC,CAAC;QAED,IAAI,YAAY,CAAC,KAAc;YAC9B,IAAI,CAAC,CAAC,GAAe,KAAK,CAAC;QAC5B,CAAC;QAED,IAAI,YAAY;YACf,OAAO,IAAI,CAAC,CAAC,CAAa;QAC3B,CAAC;QAED,IAAI,aAAa,CAAC,aAAqB;YACtC,IAAI,CAAC,CAAC,GAAgB,aAAa,CAAC;YACpC,IAAI,IAAI,CAAC,CAAC,EAAa;gBACtB,IAAI,CAAC,CAAC,GAAiB,IAAI,cAAI,CAAW,aAAa,EAAE,IAAI,CAAC,CAAC,CAAY,cAAc,CAAC,CAAC;aAC3F;YACD,IAAI,CAAC,CAAC,CAAqB,IAAI,EAAE,CAAC;QACnC,CAAC;QAED,IAAI,YAAY;YACf,OAAO,IAAI,CAAC,CAAC,CAAa;QAC3B,CAAC;QAED,IAAI,YAAY,CAAC,YAAkB;YAClC,IAAI,CAAC,CAAC,CAAa,OAAO,EAAE,CAAC;YAC7B,IAAI,CAAC,CAAC,CAA4B,OAAO,EAAE,CAAC;YAE5C,IAAI,CAAC,CAAC,GAAe,YAAY,CAAC;YAClC,IAAI,CAAC,CAAC,CAAa,WAAW,GAAG,IAAI,CAAC;YACtC,IAAI,CAAC,CAAC,GAA8B,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,CAAC,CAAa,QAAQ,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,CAAC,CAAsB,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC7H,CAAC;QAGO,CAAC,CAAQ,KAAiB,EAAE,eAA8B,EAAE,WAAuB,EAAE,gBAAwB,EAAE,UAAkD,EAAE,WAA+B;YAIzM,MAAM,uBAAuB,GAAG,KAAK,EAAE,CAAsB,EAAE,EAAE;gBAChE,eAAe,CAAC,IAAI,EAAE,CAAC;gBACvB,IAAI,CAAC,CAAC,CAAgB,CAAC,EAAE,gBAAgB,EAAE,KAAK,CAAC,CAAC;gBAClD,UAAU,EAAE,CAAC,CAAC,CAAC,CAAC;YACjB,CAAC,CAAC;YAEF,MAAM,sBAAsB,GAAG,CAAC,CAAsB,EAAE,EAAE;gBACzD,eAAe,CAAC,IAAI,EAAE,CAAC;gBACvB,IAAI,CAAC,CAAC,CAAgB,CAAC,EAAE,gBAAgB,EAAE,IAAI,CAAC,CAAC;gBACjD,UAAU,EAAE,CAAC,CAAC,CAAC,CAAC;YACjB,CAAC,CAAC;YACF,MAAM,WAAW,GAAG,IAAI,CAAC,CAAC,GAA0B,IAAI,kBAAG,CAAqB,WAAW,CAAC,CAAC;YAE7F,MAAM,cAAc,GAAG,IAAI,CAAC,CAAC,CAAqB,cAAc,CAAC,KAAK,EAAE,WAAW,CAAC,KAAK,EAAE,gBAAgB,EAAE,uBAAuB,CAAC,CAAC;YACtI,MAAM,UAAU,GAAG,IAAI,CAAC,CAAC,CAAa,wBAAwB,CAC7D,WAAW,EACX,IAAI,CAAC,CAAC,CAAwB,KAAK,EAAE,uBAAuB,EAC5D,cAAc,CAAC,eAAe,EAC9B,cAAc,CAAC,eAAe,CAC9B,CAAC;YAEF,MAAM,WAAW,GAAG,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC;YACnD,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE;gBAAE,sBAAsB,CAAC,CAAC,CAAC,CAAC;aAAE,CAAC,CAAC,CAAC,CAAC;YAEpE,MAAM,eAAe,GAAG,KAAK,IAA8B,EAAE;gBAC5D,MAAM,WAAW,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;gBAE/B,gCAAgC;gBAChC,MAAM,sBAAsB,GAAG,MAAM,UAAU,CAAC,YAAY,CAAC;gBAC7D,MAAM,uBAAuB,GAAG,MAAM,cAAc,CAAC,YAAY,CAAC;gBAClE,WAAW,CAAC,OAAO,EAAE,CAAC;gBACtB,MAAM,YAAY,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,WAAW,CAAC;gBAC9C,MAAM,cAAc,GAAoB;oBACvC,OAAO,EAAE,CAAC,GAAG,sBAAsB,CAAC,OAAO,EAAE,GAAG,uBAAuB,CAAC,OAAO,CAAC;oBAChF,QAAQ,EAAE,CAAC,GAAG,sBAAsB,CAAC,QAAQ,EAAE,GAAG,uBAAuB,CAAC,QAAQ,CAAC;oBACnF,QAAQ,EAAE,sBAAsB,CAAC,QAAQ,IAAI,uBAAuB,CAAC,QAAQ;oBAC7E,IAAI,EAAE,sBAAsB,CAAC,IAAI;oBACjC,KAAK,EAAE,sBAAsB,CAAC,KAAK;iBACnC,CAAC;gBACF,IAAI,CAAC,CAAC,CAAU,KAAK,CAAC,uBAAuB,YAAY,IAAI,CAAC,CAAC;gBAC/D,OAAO,cAAc,CAAC;YACvB,CAAC,CAAC;YACF,OAAO;gBACN,YAAY,EAAE,eAAe,EAAE;gBAC/B,WAAW;aACX,CAAC;QACH,CAAC;QAED,MAAM,CAAC,KAAiB,EAAE,UAAkD,EAAE,WAA+B;YAI5G,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;YAExB,IAAI,CAAC,CAAC,GAAc,KAAK,CAAC;YAC1B,IAAI,CAAC,IAAI,CAAC,CAAC,CAAY,YAAY,EAAE;gBACpC,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC;aAC1B;YACD,MAAM,gBAAgB,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC,QAAQ,EAAE,CAAC;YAE/C,IAAI,CAAC,CAAC,CAAa,KAAK,GAAG,IAAI,CAAC,CAAC,CAAY;YAE7C,MAAM,eAAe,GAAG,IAAI,WAAG,EAAY,CAAC;YAC5C,IAAI,CAAC,CAAC,GAAiB,IAAI,cAAI,CAAW,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC,CAAY,cAAc,CAAC,CAAC;YAEhG,+HAA+H;YAC/H,IAAI,CAAC,CAAC,GAAmB,IAAI,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAY,YAAY,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAE/G,MAAM,GAAG,GAAG,IAAI,CAAC,CAAC,CAAQ,KAAK,EAAE,eAAe,EAAE,IAAI,CAAC,CAAC,EAAa,gBAAgB,EAAE,UAAU,EAAE,WAAW,CAAC,CAAC;YAChH,MAAM,YAAY,GAAG,GAAG,CAAC,YAAY,CAAC;YACtC,MAAM,WAAW,GAAG,GAAG,CAAC,WAAW,CAAC;YAEpC,IAAI,UAAU,EAAE;gBACf,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;oBACvB,IAAI,CAAC,EAAE;wBACN,UAAU,CAAC,CAAC,CAAC,CAAC;qBACd;gBACF,CAAC,CAAC,CAAC;aACH;YAED,MAAM,KAAK,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;YAEzB,OAAO,CAAC,IAAI,CAAC,CAAC,YAAY,EAAE,aAAK,CAAC,SAAS,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE;gBACjF;;;;;kBAKE;gBACF,IAAI,CAAC,CAAC,CAAgB,SAAS,CAAC,0BAA0B,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,KAAK,EAAE,CAAC,CAAC;YAC/F,CAAC,CAAC,CAAC;YAEH,IAAI;gBACH,OAAO;oBACN,YAAY,EAAE,YAAY,CAAC,IAAI,CAC9B,KAAK,CAAC,EAAE;wBACP,IAAI,CAAC,CAAC,CAAiB,KAAK,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,KAAK,EAAE,gBAAgB,CAAC,CAAC;wBACpE,OAAO,KAAK,CAAC;oBACd,CAAC,EACD,CAAC,CAAC,EAAE;wBACH,IAAI,CAAC,CAAC,CAAa,CAAC,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,KAAK,CAAC,CAAC;wBAC1C,MAAM,CAAC,CAAC;oBACT,CAAC,CAAC;oBACH,WAAW;iBACX,CAAC;aACF;oBAAS;gBACT;;;;;kBAKE;gBACF,IAAI,CAAC,CAAC,CAAgB,SAAS,CAAC,uBAAuB,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,KAAK,EAAE,CAAC,CAAC;aAC3F;QACF,CAAC;QAEO,CAAC,CAAiB,SAAiC,EAAE,QAAgB,EAAE,gBAAwB;YACtG,IAAI,CAAC,IAAI,CAAC,CAAC,EAAa;gBACvB,MAAM,IAAI,KAAK,CAAC,4DAA4D,CAAC,CAAC;aAC9E;YAED,IAAI,CAAC,CAAC,CAAa,GAAG,CAAC,IAAI,CAAC,CAAC,EAAa,gBAAgB,CAAC,CAAC;YAC5D,IAAI,CAAC,CAAC,CAAY,MAAM,GAAG,CAAC,CAAC;YAE7B,MAAM,OAAO,GAAiB,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,CAAY,cAAc,CAAC,CAAC;YAClF,OAAQ,OAAe,CAAC,OAAO,CAAC;YAEhC,MAAM,KAAK,GAAG,SAAS,IAAI,SAAS,CAAC,KAAyB,CAAC;YAE/D,MAAM,cAAc,GAAG,IAAI,CAAC,CAAC,CAAY,aAAa,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,MAAM,CAAC,MAAM,KAAK,iBAAO,CAAC,IAAI,CAAC,CAAC;YACtG,MAAM,eAAe,GAAG,IAAI,CAAC,CAAC,CAAY,aAAa,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,MAAM,CAAC,MAAM,KAAK,iBAAO,CAAC,IAAI,CAAC,CAAC;YACvG,MAAM,MAAM,GAAG,cAAc,CAAC,CAAC,CAAC,iBAAO,CAAC,IAAI,CAAC,CAAC;gBAC7C,eAAe,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;oBAC1B,OAAO,CAAC;YAEV;;;;;;;;;;;cAWE;YACF,IAAI,CAAC,CAAC,CAAgB,SAAS,CAAC,oBAAoB,EAAE;gBACrD,KAAK,EAAE,IAAI,CAAC,CAAC,CAAa,KAAK,EAAE;gBACjC,SAAS,EAAE,IAAI,CAAC,CAAC,CAAa,SAAS,EAAE;gBACzC,OAAO;gBACP,QAAQ;gBACR,IAAI,EAAE,KAAK,IAAI,KAAK,CAAC,IAAI;gBACzB,MAAM;gBACN,mBAAmB,EAAE,IAAI,CAAC,CAAC,CAAY,YAAY;aACnD,CAAC,CAAC;YACH,OAAO,SAAS,CAAC;QAClB,CAAC;QAEO,CAAC,CAAa,CAAM,EAAE,QAAgB;YAC7C,IAAI,MAAM,CAAC,EAAE,CAAkB,CAAC,CAAC,EAAE;gBAClC,IAAI,CAAC,CAAC,CACL,IAAI,CAAC,CAAC;oBACL,CAAC,CAAC,EAAE,IAAI,mDAA2C,EAAE,OAAO,EAAE,EAAE,EAAE,QAAQ,EAAE,EAAE,EAAE;oBAChF,CAAC,CAAC,IAAI,EACP,QAAQ,EAAE,EAAE,CAAC,CAAC;gBACf,IAAI,CAAC,CAAC,GAA6B,KAAK,CAAC;aACzC;QACF,CAAC;QAEO,CAAC,CAAgB,CAAsB,EAAE,gBAAwB,EAAE,IAAI,GAAG,IAAI;YACrF,IAAiB,CAAE,CAAC,QAAQ,EAAE;gBAC7B,IAAI,CAAC,CAAC,CAAY,IAAI,CAAa,CAAC,CAAC,CAAC;gBACtC,IAAI,IAAI,EAAE;oBACT,IAAI,IAAI,CAAC,CAAC,CAAY,MAAM,EAAE;wBAC7B,IAAI,CAAC,CAAC,CAAa,GAAG,CAAC,IAAI,CAAC,CAAC,EAAa,gBAAgB,EAAE,IAAI,CAAC,CAAC;wBAClE,IAAI,CAAC,CAAC,CAAY,MAAM,GAAG,CAAC,CAAC;qBAC7B;iBACD;qBAAM;oBACN,IAAI,CAAC,CAAC,CAAiB,IAAI,CAAC,GAAG,EAAE;wBAChC,IAAI,IAAI,CAAC,CAAC,CAAY,MAAM,EAAE;4BAC7B,IAAI,CAAC,CAAC,CAAa,GAAG,CAAC,IAAI,CAAC,CAAC,EAAa,gBAAgB,EAAE,IAAI,CAAC,CAAC;4BAClE,IAAI,CAAC,CAAC,CAAY,MAAM,GAAG,CAAC,CAAC;yBAC7B;oBACF,CAAC,CAAC,CAAC;iBACH;aAED;QACF,CAAC;QAED,IAAY,CAAC;YACZ,OAAO,IAAI,CAAC,CAAC,CAAoB,QAAQ,CAAiC,QAAQ,CAAC,CAAC;QACrF,CAAC;QAED,YAAY,CAAC,qBAAqB,GAAG,KAAK;YACzC,IAAI,IAAI,CAAC,CAAC,EAAyB;gBAClC,IAAI,CAAC,CAAC,GAA6B,qBAAqB,CAAC;gBACzD,IAAI,CAAC,CAAC,CAAwB,MAAM,EAAE,CAAC;gBACvC,OAAO,IAAI,CAAC;aACZ;YACD,OAAO,KAAK,CAAC;QACd,CAAC;QAEQ,OAAO;YACf,IAAI,CAAC,YAAY,EAAE,CAAC;YACpB,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC;YAC5B,KAAK,CAAC,OAAO,EAAE,CAAC;QACjB,CAAC;QAED,oBAAoB,CAAC,KAAW;YAC/B,KAAK,CAAC,YAAY,GAAG,IAAI,CAAC,CAAC,CAAa;YACxC,IAAI,CAAC,CAAC,GAAe,IAAI,CAAC,CAAC,CAAoB,cAAc,CAAC,IAAI,EAAU,IAAI,CAAC,CAAC;QACnF,CAAC;KACD,CAAA;IA3SY,oBAAI;mBAAJ,IAAI;QAwBd,WAAA,YAAG,CAAA;QACH,WAAA,eAAG,CAAA;QACH,WAAA,mBAAG,CAAA;QACH,WAAA,mBAAG,CAAA;QACH,WAAA,SAAG,CAAA;QACH,WAAA,qBAAI,CAAA;OA7BM,IAAI,CA2ShB;IAMM,IAAM,IAAI,GAAV,MAAM,IAAI;QAKhB,YAAmC,CAA0C;YAAzB,MAAC,GAAD,CAAC,CAAwB;YAFrE,MAAC,GAAkC,IAAI,CAAC;QAGhD,CAAC;QAED,IAAI,WAAW;YACd,IAAI,CAAC,IAAI,CAAC,CAAC,EAAa;gBACvB,IAAI,CAAC,CAAC,GAAc,IAAI,CAAC,CAAC,CAAoB,cAAc,CAAC,IAAI,CAAQ,CAAC;aAC1E;YACD,OAAO,IAAI,CAAC,CAAC,CAAY;QAC1B,CAAC;KACD,CAAA;IAdY,oBAAI;mBAAJ,IAAI;QAKH,WAAA,mBAAG,CAAA;OALJ,IAAI,CAchB;IAEY,QAAA,IAAI,GAA+B,IAAA,mBAAG,EAA+C,iCAAiC,CAAC,CAAC;IAQrI;;;OAGG;IACI,IAAM,IAAI,GAAV,MAAM,IAAI;;QAMhB,YACgB,CAAmC;YAAlB,MAAC,GAAD,CAAC,CAAiB;YAL3C,MAAC,GAA8B,IAAI,CAAC;YACpC,MAAC,GAA2B,IAAI,CAAC;YACxB,MAAC,GAAmB,IAAI,eAAG,EAAc,CAAC;QAK3D,CAAC;QAED,oBAAoB;YACnB,IAAI,IAAI,CAAC,CAAC,IAAS,IAAI,CAAC,CAAC,EAAc;gBACtC,MAAM,YAAY,GAAG,IAAI,CAAC,CAAC,CAAa;gBACxC,IAAI,CAAC,CAAC,CAAM,iBAAiB,CAAC,CAAC,QAAQ,EAAE,EAAE;oBAC1C,QAAQ,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;gBACzC,CAAC,CAAC,CAAC;aACH;YACD,IAAI,CAAC,CAAC,GAAe,IAAI,CAAC;QAC3B,CAAC;QAED,cAAc,CAAC,QAA0B,EAAE,KAAU,EAAI,UAAkB,CAAC;YAC3E,IAAI,KAAwB,CAAC;YAC7B,IAAI,SAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAE;gBACxB,KAAK,GAAG,IAAI,CAAC,CAAC,CAAa,QAAQ,CAAC,QAAQ,CAAC,CAAC;aAC9C;iBAAM;gBACN,KAAK,GAAG,QAAQ,CAAC;aACjB;YAED,IAAI,KAAK,EAAE;gBACV,IAAI,CAAC,CAAC,CAAgB,KAAK,EAAE,KAAK,CAAC,CAAC;aACpC;QACF,CAAC;QAEO,CAAC,CAAgB,KAAiB,EAAE,KAAU;YACrD,IAAI,CAAC,oBAAoB,EAAE,CAAC;YAC5B,KAAK,CAAC,iBAAiB,CAAC,CAAC,QAAQ,EAAE,EAAE;gBACpC,IAAI,CAAC,CAAC,GAAe,QAAQ,CAAC,aAAa,CAAC,KAAK,EAAE,MAAI,CAAsB,CAAC,CAA2B,CAAC;YAC3G,CAAC,CAAC,CAAC;YACH,IAAI,CAAC,CAAC,CAAQ,KAAK,CAAC,CAAC;QACtB,CAAC;QAEO,CAAC,CAAQ,KAAiB;YACjC,IAAI,IAAI,CAAC,CAAC,KAAU,KAAK,EAAE;gBAC1B,IAAI,CAAC,CAAC,EAAoB,CAAC;gBAC3B,IAAI,CAAC,CAAC,GAAQ,KAAK,CAAC;gBACpB,IAAI,CAAC,CAAC,CAAiB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAM,sBAAsB,CAAC,CAAC,CAAC,EAAE,EAAE;oBACnE,IAAI,CAAC,CAAC,EAAoB,CAAC;oBAC3B,IAAI,CAAC,oBAAoB,EAAE,CAAC;oBAC5B,IAAI,CAAC,CAAC,GAAQ,IAAI,CAAC;gBACpB,CAAC,CAAC,CAAC,CAAC;gBACJ,IAAI,CAAC,CAAC,CAAiB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAM,aAAa,CAAC,GAAG,EAAE;oBACzD,IAAI,CAAC,CAAC,EAAoB,CAAC;oBAC3B,IAAI,CAAC,oBAAoB,EAAE,CAAC;oBAC5B,IAAI,CAAC,CAAC,GAAQ,IAAI,CAAC;gBACpB,CAAC,CAAC,CAAC,CAAC;aACJ;QACF,CAAC;QAEO,CAAC;YACR,IAAI,CAAC,CAAC,CAAiB,KAAK,EAAE,CAAC;QAChC,CAAC;QAED,OAAO;YACN,IAAI,IAAI,CAAC,CAAC,EAAO;gBAChB,IAAI,CAAC,oBAAoB,EAAE,CAAC;gBAC5B,IAAI,CAAC,CAAC,CAAiB,OAAO,EAAE,CAAC;gBACjC,IAAI,CAAC,CAAC,GAAQ,IAAI,CAAC;aACnB;QACF,CAAC;iBAEuB,MAAC,GAA6B,eAAG,CAAoB,QAAQ,CAAC;YACrF,WAAW,EAAE,wBAAwB;YACrC,UAAU,4DAAoD;YAC9D,SAAS,EAAE,gBAAgB;YAC3B,WAAW,EAAE,IAAI;SACjB,CALwB,AAKvB,CAAC;;IA5ES,oBAAI;mBAAJ,IAAI;QAOd,WAAA,WAAG,CAAA;OAPO,IAAI,CA6EhB;IAID,SAAS,yBAAyB,CAAC,QAA0B,EAAE,SAAe;QAC7E,MAAM,YAAY,GAAG,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QACvD,IAAI,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;YACnC,OAAO,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;gBACnC,MAAM,YAAY,GAAkC,QAAQ,CAAC,OAAO,CAAC,OAAQ,CAAC,CAAC,CAAC,CAAC;gBACjF,OAAO,IAAI,IAAI,CAAE,SAAS,EAAE,YAAY,EAAE,YAAY,EAAE,CAAC,CAAC,CAAC;YAC5D,CAAC,CAAC,CAAC;SACH;aAAM;YACN,MAAM,YAAY,GAAiB,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC;YAC5D,MAAM,KAAK,GAAG,IAAI,IAAI,CAAE,SAAS,EAAE,YAAY,EAAE,YAAY,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC;YAChF,OAAO,CAAC,KAAK,CAAC,CAAC;SACf;IACF,CAAC;IAED,kCAAkC;IAElC,SAAgB,IAAI,CAA+B,iBAAqC,EAAE,IAAU;QACnG,MAAM,eAAe,GAAsB,EAAE,CAAC;QAC9C,iBAAiB,CAAC,GAAG,CAAC,CAAC,eAAe,EAAE,EAAE;YACzC,MAAM,YAAY,GAAG,eAAe,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YAC9D,IAAI,KAAK,CAAC,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,EAAE;gBAC1C,eAAe,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;oBACvC,MAAM,YAAY,GAAkC,eAAe,CAAC,OAAO,CAAC,OAAQ,CAAC,CAAC,CAAC,CAAC;oBACxF,MAAM,KAAK,GAAG,IAAI,IAAI,CAAY,IAAI,EAAE,YAAY,EAAE,YAAY,EAAE,CAAC,EAAE,eAAe,CAAC,YAAY,CAAC,CAAC;oBACrG,eAAe,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC7B,CAAC,CAAC,CAAC;aACH;iBAAM;gBACN,MAAM,YAAY,GAAiB,eAAe,CAAC,OAAO,CAAC,OAAO,CAAC;gBACnE,MAAM,KAAK,GAAG,IAAI,IAAI,CAAY,IAAI,EAAE,YAAY,EAAE,YAAY,EAAE,eAAe,CAAC,MAAM,EAAE,eAAe,CAAC,YAAY,CAAC,CAAC;gBAC1H,eAAe,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aAC5B;QACF,CAAC,CAAC,CAAC;QACH,OAAO,eAAe,CAAC;IACxB,CAAC;IAjBD,oBAiBC;IAED,SAAgB,IAAI,CAAyB,OAAwB,EAAE,SAA4B;QAClG,GAAG;YACF,IAAI,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE;gBAChC,OAAO,IAAI,CAAC;aACZ;SACD,QAAQ,CAAC,CAAC,OAAO,CAAC,MAAM,EAAE,YAAY,IAAI,CAAS,IAAI,CAAC,OAAO,GAAoB,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE;QAEvG,OAAO,KAAK,CAAC;IACd,CAAC;IARD,oBAQC;IAED,SAAS,cAAc,CAAC,OAAgD;QAEvE,MAAM,aAAa,GAA8B,EAAE,CAAC;QACpD,MAAM,WAAW,GAAgB,EAAE,CAAC;QACpC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE;YACrB,IAAI,CAAC,YAAY,IAAI,EAAO;gBAC3B,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;aACpB;iBAAM;gBACN,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;aACtB;QACF,CAAC,CAAC,CAAC;QAEH,OAAO,WAAW,CAAC,MAAM,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,wBAAwB,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;IACxF,CAAC;IAID,SAAS,uBAAuB,CAAC,MAAsB;QACtD,MAAM,QAAQ,GAAiB;YAC9B,QAAQ,EAAE,EAAE;YACZ,KAAK,EAAE,KAAK;YACZ,OAAO,EAAE,KAAK;SACd,CAAC;QACF,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE;YACpB,IAAI,CAAC,CAAC,KAAK,EAAE;gBACZ,QAAQ,CAAC,KAAK,GAAG,IAAI,CAAC;aACtB;YAED,IAAI,CAAC,CAAC,OAAO,EAAE;gBACd,QAAQ,CAAC,OAAO,GAAG,IAAI,CAAC;aACxB;YAED,QAAQ,CAAC,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QAC1D,CAAC,CAAC,CAAC;QAEH,OAAO,QAAQ,CAAC;IACjB,CAAC","file":"searchModel.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { compareFileExtensions, compareFileNames, comparePaths } from 'vs/base/common/comparers';\nimport { memoize } from 'vs/base/common/decorators';\nimport * as errors from 'vs/base/common/errors';\nimport { Emitter, Event, PauseableEmitter } from 'vs/base/common/event';\nimport { Lazy } from 'vs/base/common/lazy';\nimport { Disposable, DisposableStore, IDisposable } from 'vs/base/common/lifecycle';\nimport { ResourceMap } from 'vs/base/common/map';\nimport { Schemas } from 'vs/base/common/network';\nimport { lcut } from 'vs/base/common/strings';\nimport { TernarySearchTree } from 'vs/base/common/ternarySearchTree';\nimport { URI } from 'vs/base/common/uri';\nimport { Range } from 'vs/editor/common/core/range';\nimport { FindMatch, IModelDeltaDecoration, ITextModel, MinimapPosition, OverviewRulerLane, TrackedRangeStickiness } from 'vs/editor/common/model';\nimport { ModelDecorationOptions } from 'vs/editor/common/model/textModel';\nimport { IModelService } from 'vs/editor/common/services/model';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IFileService, IFileStatWithPartialMetadata } from 'vs/platform/files/common/files';\nimport { createDecorator, IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IProgress, IProgressStep } from 'vs/platform/progress/common/progress';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { minimapFindMatch, overviewRulerFindMatchForeground } from 'vs/platform/theme/common/colorRegistry';\nimport { themeColorFromId } from 'vs/platform/theme/common/themeService';\nimport { IUriIdentityService } from 'vs/platform/uriIdentity/common/uriIdentity';\nimport { FindMatchDecorationModel } from 'vs/workbench/contrib/notebook/browser/contrib/find/findMatchDecorationModel';\nimport { CellFindMatchWithIndex, CellWebviewFindMatch, ICellViewModel } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { NotebookEditorWidget } from 'vs/workbench/contrib/notebook/browser/notebookEditorWidget';\nimport { INotebookEditorService } from 'vs/workbench/contrib/notebook/browser/services/notebookEditorService';\nimport { NotebookCellsChangeType } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { IReplaceService } from 'vs/workbench/contrib/search/browser/replace';\nimport { CellSearchModel, ICellMatch, contentMatchesToTextSearchMatches, isIFileMatchWithCells, rawCellPrefix, webviewMatchesToTextSearchMatches } from 'vs/workbench/contrib/search/browser/searchNotebookHelpers';\nimport { INotebookSearchService } from 'vs/workbench/contrib/search/common/notebookSearch';\nimport { ReplacePattern } from 'vs/workbench/services/search/common/replace';\nimport { IFileMatch, IPatternInfo, ISearchComplete, ISearchConfigurationProperties, ISearchProgressItem, ISearchRange, ISearchService, ITextQuery, ITextSearchContext, ITextSearchMatch, ITextSearchPreviewOptions, ITextSearchResult, ITextSearchStats, OneLineRange, resultIsMatch, SearchCompletionExitCode, SearchSortOrder } from 'vs/workbench/services/search/common/search';\nimport { addContextToEditorMatches, editorMatchesToTextSearchResults } from 'vs/workbench/services/search/common/searchHelpers';\n\nexport class Match {\n\n\tprivate static readonly MAX_PREVIEW_CHARS = 250;\n\tprotected _id: string;\n\tprotected _range: Range;\n\tprivate _oneLinePreviewText: string;\n\tprivate _rangeInPreviewText: ISearchRange;\n\t// For replace\n\tprivate _fullPreviewRange: ISearchRange;\n\n\tconstructor(protected _parent: FileMatch, private _fullPreviewLines: string[], _fullPreviewRange: ISearchRange, _documentRange: ISearchRange) {\n\t\tthis._oneLinePreviewText = _fullPreviewLines[_fullPreviewRange.startLineNumber];\n\t\tconst adjustedEndCol = _fullPreviewRange.startLineNumber === _fullPreviewRange.endLineNumber ?\n\t\t\t_fullPreviewRange.endColumn :\n\t\t\tthis._oneLinePreviewText.length;\n\t\tthis._rangeInPreviewText = new OneLineRange(1, _fullPreviewRange.startColumn + 1, adjustedEndCol + 1);\n\n\t\tthis._range = new Range(\n\t\t\t_documentRange.startLineNumber + 1,\n\t\t\t_documentRange.startColumn + 1,\n\t\t\t_documentRange.endLineNumber + 1,\n\t\t\t_documentRange.endColumn + 1);\n\n\t\tthis._fullPreviewRange = _fullPreviewRange;\n\n\t\tthis._id = this._parent.id() + '>' + this._range + this.getMatchString();\n\t}\n\n\tid(): string {\n\t\treturn this._id;\n\t}\n\n\tparent(): FileMatch {\n\t\treturn this._parent;\n\t}\n\n\ttext(): string {\n\t\treturn this._oneLinePreviewText;\n\t}\n\n\trange(): Range {\n\t\treturn this._range;\n\t}\n\n\t@memoize\n\tpreview(): { before: string; inside: string; after: string } {\n\t\tlet before = this._oneLinePreviewText.substring(0, this._rangeInPreviewText.startColumn - 1),\n\t\t\tinside = this.getMatchString(),\n\t\t\tafter = this._oneLinePreviewText.substring(this._rangeInPreviewText.endColumn - 1);\n\n\t\tbefore = lcut(before, 26);\n\t\tbefore = before.trimStart();\n\n\t\tlet charsRemaining = Match.MAX_PREVIEW_CHARS - before.length;\n\t\tinside = inside.substr(0, charsRemaining);\n\t\tcharsRemaining -= inside.length;\n\t\tafter = after.substr(0, charsRemaining);\n\n\t\treturn {\n\t\t\tbefore,\n\t\t\tinside,\n\t\t\tafter,\n\t\t};\n\t}\n\n\tget replaceString(): string {\n\t\tconst searchModel = this.parent().parent().searchModel;\n\t\tif (!searchModel.replacePattern) {\n\t\t\tthrow new Error('searchModel.replacePattern must be set before accessing replaceString');\n\t\t}\n\n\t\tconst fullMatchText = this.fullMatchText();\n\t\tlet replaceString = searchModel.replacePattern.getReplaceString(fullMatchText, searchModel.preserveCase);\n\t\tif (replaceString !== null) {\n\t\t\treturn replaceString;\n\t\t}\n\n\t\t// Search/find normalize line endings - check whether \\r prevents regex from matching\n\t\tconst fullMatchTextWithoutCR = fullMatchText.replace(/\\r\\n/g, '\\n');\n\t\tif (fullMatchTextWithoutCR !== fullMatchText) {\n\t\t\treplaceString = searchModel.replacePattern.getReplaceString(fullMatchTextWithoutCR, searchModel.preserveCase);\n\t\t\tif (replaceString !== null) {\n\t\t\t\treturn replaceString;\n\t\t\t}\n\t\t}\n\n\t\t// If match string is not matching then regex pattern has a lookahead expression\n\t\tconst contextMatchTextWithSurroundingContent = this.fullMatchText(true);\n\t\treplaceString = searchModel.replacePattern.getReplaceString(contextMatchTextWithSurroundingContent, searchModel.preserveCase);\n\t\tif (replaceString !== null) {\n\t\t\treturn replaceString;\n\t\t}\n\n\t\t// Search/find normalize line endings, this time in full context\n\t\tconst contextMatchTextWithoutCR = contextMatchTextWithSurroundingContent.replace(/\\r\\n/g, '\\n');\n\t\tif (contextMatchTextWithoutCR !== contextMatchTextWithSurroundingContent) {\n\t\t\treplaceString = searchModel.replacePattern.getReplaceString(contextMatchTextWithoutCR, searchModel.preserveCase);\n\t\t\tif (replaceString !== null) {\n\t\t\t\treturn replaceString;\n\t\t\t}\n\t\t}\n\n\t\t// Match string is still not matching. Could be unsupported matches (multi-line).\n\t\treturn searchModel.replacePattern.pattern;\n\t}\n\n\tfullMatchText(includeSurrounding = false): string {\n\t\tlet thisMatchPreviewLines: string[];\n\t\tif (includeSurrounding) {\n\t\t\tthisMatchPreviewLines = this._fullPreviewLines;\n\t\t} else {\n\t\t\tthisMatchPreviewLines = this._fullPreviewLines.slice(this._fullPreviewRange.startLineNumber, this._fullPreviewRange.endLineNumber + 1);\n\t\t\tthisMatchPreviewLines[thisMatchPreviewLines.length - 1] = thisMatchPreviewLines[thisMatchPreviewLines.length - 1].slice(0, this._fullPreviewRange.endColumn);\n\t\t\tthisMatchPreviewLines[0] = thisMatchPreviewLines[0].slice(this._fullPreviewRange.startColumn);\n\t\t}\n\n\t\treturn thisMatchPreviewLines.join('\\n');\n\t}\n\n\trangeInPreview() {\n\t\t// convert to editor's base 1 positions.\n\t\treturn {\n\t\t\t...this._fullPreviewRange,\n\t\t\tstartColumn: this._fullPreviewRange.startColumn + 1,\n\t\t\tendColumn: this._fullPreviewRange.endColumn + 1\n\t\t};\n\t}\n\n\tfullPreviewLines(): string[] {\n\t\treturn this._fullPreviewLines.slice(this._fullPreviewRange.startLineNumber, this._fullPreviewRange.endLineNumber + 1);\n\t}\n\n\tgetMatchString(): string {\n\t\treturn this._oneLinePreviewText.substring(this._rangeInPreviewText.startColumn - 1, this._rangeInPreviewText.endColumn - 1);\n\t}\n}\n\nexport class CellMatch {\n\tprivate _contentMatches: Map<string, MatchInNotebook>;\n\tprivate _webviewMatches: Map<string, MatchInNotebook>;\n\tprivate _context: Map<number, string>;\n\n\tconstructor(\n\t\tprivate readonly _parent: FileMatch,\n\t\tprivate _cell: ICellViewModel | CellSearchModel,\n\t\tprivate readonly _cellIndex: number,\n\t) {\n\n\t\tthis._contentMatches = new Map<string, MatchInNotebook>();\n\t\tthis._webviewMatches = new Map<string, MatchInNotebook>();\n\t\tthis._context = new Map<number, string>();\n\t}\n\n\tget context(): Map<number, string> {\n\t\treturn new Map(this._context);\n\t}\n\n\tmatches() {\n\t\treturn [...this._contentMatches.values(), ... this._webviewMatches.values()];\n\t}\n\n\tget contentMatches(): MatchInNotebook[] {\n\t\treturn Array.from(this._contentMatches.values());\n\t}\n\n\tget webviewMatches(): MatchInNotebook[] {\n\t\treturn Array.from(this._webviewMatches.values());\n\t}\n\n\tremove(matches: MatchInNotebook | MatchInNotebook[]): void {\n\t\tif (!Array.isArray(matches)) {\n\t\t\tmatches = [matches];\n\t\t}\n\t\tfor (const match of matches) {\n\t\t\tthis._contentMatches.delete(match.id());\n\t\t\tthis._webviewMatches.delete(match.id());\n\t\t}\n\t}\n\n\tclearAllMatches() {\n\t\tthis._contentMatches.clear();\n\t\tthis._webviewMatches.clear();\n\t}\n\n\taddContentMatches(textSearchMatches: ITextSearchMatch[]) {\n\t\tconst contentMatches = textSearchMatchesToNotebookMatches(textSearchMatches, this);\n\t\tcontentMatches.forEach((match) => {\n\t\t\tthis._contentMatches.set(match.id(), match);\n\t\t});\n\t\tthis.addContext(textSearchMatches);\n\t}\n\n\tpublic addContext(textSearchMatches: ITextSearchMatch[]) {\n\t\tif (this.cell instanceof CellSearchModel) {\n\t\t\t// todo: get closed notebook results in search editor\n\t\t\treturn;\n\t\t}\n\t\tthis.cell.resolveTextModel().then((textModel) => {\n\t\t\tconst textResultsWithContext = addContextToEditorMatches(textSearchMatches, textModel, this.parent.parent().query!);\n\t\t\tconst contexts = textResultsWithContext.filter((result => !resultIsMatch(result)) as ((a: any) => a is ITextSearchContext));\n\t\t\tcontexts.map(context => ({ ...context, lineNumber: context.lineNumber + 1 }))\n\t\t\t\t.forEach((context) => { this._context.set(context.lineNumber, context.text); });\n\t\t});\n\t}\n\n\taddWebviewMatches(textSearchMatches: ITextSearchMatch[]) {\n\t\tconst webviewMatches = textSearchMatchesToNotebookMatches(textSearchMatches, this);\n\t\twebviewMatches.forEach((match) => {\n\t\t\tthis._webviewMatches.set(match.id(), match);\n\t\t});\n\t\t// TODO: add webview results to context\n\t}\n\n\n\tsetCellModel(cell: ICellViewModel) {\n\t\tthis._cell = cell;\n\t}\n\n\tget parent(): FileMatch {\n\t\treturn this._parent;\n\t}\n\n\tget id(): string {\n\t\treturn this._cell.id;\n\t}\n\n\tget cellIndex(): number {\n\t\treturn this._cellIndex;\n\t}\n\n\tget cell(): ICellViewModel | CellSearchModel {\n\t\treturn this._cell;\n\t}\n\n}\n\nexport class MatchInNotebook extends Match {\n\tprivate _webviewIndex: number | undefined;\n\n\tconstructor(private readonly _cellParent: CellMatch, _fullPreviewLines: string[], _fullPreviewRange: ISearchRange, _documentRange: ISearchRange, webviewIndex?: number) {\n\t\tsuper(_cellParent.parent, _fullPreviewLines, _fullPreviewRange, _documentRange);\n\t\tthis._id = this._parent.id() + '>' + this._cellParent.cellIndex + (webviewIndex ? '_' + webviewIndex : '') + '_' + this.notebookMatchTypeString() + this._range + this.getMatchString();\n\t\tthis._webviewIndex = webviewIndex;\n\t}\n\n\toverride parent(): FileMatch { // visible parent in search tree\n\t\treturn this._cellParent.parent;\n\t}\n\n\tget cellParent(): CellMatch {\n\t\treturn this._cellParent;\n\t}\n\n\tprivate notebookMatchTypeString(): string {\n\t\treturn this.isWebviewMatch() ? 'webview' : 'content';\n\t}\n\n\tpublic isWebviewMatch() {\n\t\treturn this._webviewIndex !== undefined;\n\t}\n\n\tget cellIndex() {\n\t\treturn this._cellParent.cellIndex;\n\t}\n\n\tget webviewIndex() {\n\t\treturn this._webviewIndex;\n\t}\n\n\tget cell() {\n\t\treturn this._cellParent.cell;\n\t}\n}\n\n\nexport class FileMatch extends Disposable implements IFileMatch {\n\n\tprivate static readonly _CURRENT_FIND_MATCH = ModelDecorationOptions.register({\n\t\tdescription: 'search-current-find-match',\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tzIndex: 13,\n\t\tclassName: 'currentFindMatch',\n\t\toverviewRuler: {\n\t\t\tcolor: themeColorFromId(overviewRulerFindMatchForeground),\n\t\t\tposition: OverviewRulerLane.Center\n\t\t},\n\t\tminimap: {\n\t\t\tcolor: themeColorFromId(minimapFindMatch),\n\t\t\tposition: MinimapPosition.Inline\n\t\t}\n\t});\n\n\tprivate static readonly _FIND_MATCH = ModelDecorationOptions.register({\n\t\tdescription: 'search-find-match',\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tclassName: 'findMatch',\n\t\toverviewRuler: {\n\t\t\tcolor: themeColorFromId(overviewRulerFindMatchForeground),\n\t\t\tposition: OverviewRulerLane.Center\n\t\t},\n\t\tminimap: {\n\t\t\tcolor: themeColorFromId(minimapFindMatch),\n\t\t\tposition: MinimapPosition.Inline\n\t\t}\n\t});\n\n\tprivate static getDecorationOption(selected: boolean): ModelDecorationOptions {\n\t\treturn (selected ? FileMatch._CURRENT_FIND_MATCH : FileMatch._FIND_MATCH);\n\t}\n\n\tprotected _onChange = this._register(new Emitter<{ didRemove?: boolean; forceUpdateModel?: boolean }>());\n\treadonly onChange: Event<{ didRemove?: boolean; forceUpdateModel?: boolean }> = this._onChange.event;\n\n\tprivate _onDispose = this._register(new Emitter<void>());\n\treadonly onDispose: Event<void> = this._onDispose.event;\n\n\tprivate _resource: URI;\n\tprivate _fileStat?: IFileStatWithPartialMetadata;\n\tprivate _model: ITextModel | null = null;\n\tprivate _modelListener: IDisposable | null = null;\n\tprivate _textMatches: Map<string, Match>;\n\tprivate _cellMatches: Map<string, CellMatch>;\n\n\tprivate _removedTextMatches: Set<string>;\n\tprivate _selectedMatch: Match | null = null;\n\tprivate _name: Lazy<string>;\n\n\tprivate _updateScheduler: RunOnceScheduler;\n\tprivate _modelDecorations: string[] = [];\n\n\tprivate _context: Map<number, string> = new Map();\n\n\tpublic get context(): Map<number, string> {\n\t\treturn new Map(this._context);\n\t}\n\n\tpublic get cellContext(): Map<string, Map<number, string>> {\n\t\tconst cellContext = new Map<string, Map<number, string>>();\n\t\tthis._cellMatches.forEach(cellMatch => {\n\t\t\tcellContext.set(cellMatch.id, cellMatch.context);\n\t\t});\n\t\treturn cellContext;\n\t}\n\n\t// #region notebook fields\n\tprivate _notebookEditorWidget: NotebookEditorWidget | null = null;\n\tprivate _editorWidgetListener: IDisposable | null = null;\n\tprivate _notebookUpdateScheduler: RunOnceScheduler;\n\tprivate _findMatchDecorationModel: FindMatchDecorationModel | undefined;\n\tprivate _lastEditorWidgetIdForUpdate: string | undefined;\n\t// #endregion\n\n\tconstructor(\n\t\tprivate _query: IPatternInfo,\n\t\tprivate _previewOptions: ITextSearchPreviewOptions | undefined,\n\t\tprivate _maxResults: number | undefined,\n\t\tprivate _parent: FolderMatch,\n\t\tprivate rawMatch: IFileMatch,\n\t\tprivate _closestRoot: FolderMatchWorkspaceRoot | null,\n\t\tprivate readonly searchInstanceID: string,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@IReplaceService private readonly replaceService: IReplaceService,\n\t\t@ILabelService readonly labelService: ILabelService,\n\t\t@INotebookEditorService private readonly notebookEditorService: INotebookEditorService,\n\t) {\n\t\tsuper();\n\t\tthis._resource = this.rawMatch.resource;\n\t\tthis._textMatches = new Map<string, Match>();\n\t\tthis._removedTextMatches = new Set<string>();\n\t\tthis._updateScheduler = new RunOnceScheduler(this.updateMatchesForModel.bind(this), 250);\n\t\tthis._name = new Lazy(() => labelService.getUriBasenameLabel(this.resource));\n\t\tthis._cellMatches = new Map<string, CellMatch>();\n\t\tthis._notebookUpdateScheduler = new RunOnceScheduler(this.updateMatchesForEditorWidget.bind(this), 250);\n\t\tthis.createMatches();\n\t}\n\n\taddWebviewMatchesToCell(cellID: string, webviewMatches: ITextSearchMatch[]) {\n\t\tconst cellMatch = this.getCellMatch(cellID);\n\t\tif (cellMatch !== undefined) {\n\t\t\tcellMatch.addWebviewMatches(webviewMatches);\n\t\t}\n\t}\n\n\taddContentMatchesToCell(cellID: string, contentMatches: ITextSearchMatch[]) {\n\t\tconst cellMatch = this.getCellMatch(cellID);\n\t\tif (cellMatch !== undefined) {\n\t\t\tcellMatch.addContentMatches(contentMatches);\n\t\t}\n\t}\n\n\tgetCellMatch(cellID: string): CellMatch | undefined {\n\t\treturn this._cellMatches.get(cellID);\n\t}\n\n\taddCellMatch(rawCell: ICellMatch) {\n\t\tconst cellMatch = new CellMatch(this, rawCell.cell, rawCell.index);\n\t\tthis._cellMatches.set(cellMatch.id, cellMatch);\n\t\tthis.addWebviewMatchesToCell(rawCell.cell.id, rawCell.webviewResults);\n\t\tthis.addContentMatchesToCell(rawCell.cell.id, rawCell.contentResults);\n\t}\n\n\tget closestRoot(): FolderMatchWorkspaceRoot | null {\n\t\treturn this._closestRoot;\n\t}\n\n\thasWebviewMatches(): boolean {\n\t\treturn this.matches().some(m => m instanceof MatchInNotebook && m.isWebviewMatch());\n\t}\n\n\tcreateMatches(): void {\n\t\tconst model = this.modelService.getModel(this._resource);\n\t\tif (model) {\n\t\t\tthis.bindModel(model);\n\t\t\tthis.updateMatchesForModel();\n\t\t} else {\n\t\t\tconst notebookEditorWidgetBorrow = this.notebookEditorService.retrieveExistingWidgetFromURI(this.resource);\n\n\t\t\tif (notebookEditorWidgetBorrow?.value) {\n\t\t\t\tthis.bindNotebookEditorWidget(notebookEditorWidgetBorrow.value);\n\t\t\t}\n\t\t\tif (this.rawMatch.results) {\n\t\t\t\tthis.rawMatch.results\n\t\t\t\t\t.filter(resultIsMatch)\n\t\t\t\t\t.forEach(rawMatch => {\n\t\t\t\t\t\ttextSearchResultToMatches(rawMatch, this)\n\t\t\t\t\t\t\t.forEach(m => this.add(m));\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (isIFileMatchWithCells(this.rawMatch)) {\n\t\t\t\tthis.rawMatch.cellResults?.forEach(cell => this.addCellMatch(cell));\n\t\t\t\tthis.setNotebookFindMatchDecorationsUsingCellMatches(this.cellMatches());\n\t\t\t\tthis._onChange.fire({ forceUpdateModel: true });\n\t\t\t}\n\t\t\tthis.addContext(this.rawMatch.results);\n\t\t}\n\t}\n\n\tbindModel(model: ITextModel): void {\n\t\tthis._model = model;\n\t\tthis._modelListener = this._model.onDidChangeContent(() => {\n\t\t\tthis._updateScheduler.schedule();\n\t\t});\n\t\tthis._model.onWillDispose(() => this.onModelWillDispose());\n\t\tthis.updateHighlights();\n\t}\n\n\tprivate onModelWillDispose(): void {\n\t\t// Update matches because model might have some dirty changes\n\t\tthis.updateMatchesForModel();\n\t\tthis.unbindModel();\n\t}\n\n\tprivate unbindModel(): void {\n\t\tif (this._model) {\n\t\t\tthis._updateScheduler.cancel();\n\t\t\tthis._model.changeDecorations((accessor) => {\n\t\t\t\tthis._modelDecorations = accessor.deltaDecorations(this._modelDecorations, []);\n\t\t\t});\n\t\t\tthis._model = null;\n\t\t\tthis._modelListener!.dispose();\n\t\t}\n\t}\n\n\tprivate updateMatchesForModel(): void {\n\t\t// this is called from a timeout and might fire\n\t\t// after the model has been disposed\n\t\tif (!this._model) {\n\t\t\treturn;\n\t\t}\n\t\tthis._textMatches = new Map<string, Match>();\n\n\t\tconst wordSeparators = this._query.isWordMatch && this._query.wordSeparators ? this._query.wordSeparators : null;\n\t\tconst matches = this._model\n\t\t\t.findMatches(this._query.pattern, this._model.getFullModelRange(), !!this._query.isRegExp, !!this._query.isCaseSensitive, wordSeparators, false, this._maxResults ?? Number.MAX_SAFE_INTEGER);\n\n\t\tthis.updateMatches(matches, true, this._model);\n\t}\n\n\n\n\tprotected async updatesMatchesForLineAfterReplace(lineNumber: number, modelChange: boolean): Promise<void> {\n\t\tif (!this._model) {\n\t\t\treturn;\n\t\t}\n\t\tconst range = {\n\t\t\tstartLineNumber: lineNumber,\n\t\t\tstartColumn: this._model.getLineMinColumn(lineNumber),\n\t\t\tendLineNumber: lineNumber,\n\t\t\tendColumn: this._model.getLineMaxColumn(lineNumber)\n\t\t};\n\t\tconst oldMatches = Array.from(this._textMatches.values()).filter(match => match.range().startLineNumber === lineNumber);\n\t\toldMatches.forEach(match => this._textMatches.delete(match.id()));\n\n\t\tconst wordSeparators = this._query.isWordMatch && this._query.wordSeparators ? this._query.wordSeparators : null;\n\t\tconst matches = this._model.findMatches(this._query.pattern, range, !!this._query.isRegExp, !!this._query.isCaseSensitive, wordSeparators, false, this._maxResults ?? Number.MAX_SAFE_INTEGER);\n\t\tthis.updateMatches(matches, modelChange, this._model);\n\n\t\t// await this.updateMatchesForEditorWidget();\n\t}\n\n\n\n\tprivate updateMatches(matches: FindMatch[], modelChange: boolean, model: ITextModel): void {\n\t\tconst textSearchResults = editorMatchesToTextSearchResults(matches, model, this._previewOptions);\n\t\ttextSearchResults.forEach(textSearchResult => {\n\t\t\ttextSearchResultToMatches(textSearchResult, this).forEach(match => {\n\t\t\t\tif (!this._removedTextMatches.has(match.id())) {\n\t\t\t\t\tthis.add(match);\n\t\t\t\t\tif (this.isMatchSelected(match)) {\n\t\t\t\t\t\tthis._selectedMatch = match;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis.addContext(\n\t\t\taddContextToEditorMatches(textSearchResults, model, this.parent().parent().query!)\n\t\t\t\t.filter((result => !resultIsMatch(result)) as ((a: any) => a is ITextSearchContext))\n\t\t\t\t.map(context => ({ ...context, lineNumber: context.lineNumber + 1 })));\n\n\t\tthis._onChange.fire({ forceUpdateModel: modelChange });\n\t\tthis.updateHighlights();\n\t}\n\n\tupdateHighlights(): void {\n\t\tif (!this._model) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._model.changeDecorations((accessor) => {\n\t\t\tconst newDecorations = (\n\t\t\t\tthis.parent().showHighlights\n\t\t\t\t\t? this.matches().map(match => <IModelDeltaDecoration>{\n\t\t\t\t\t\trange: match.range(),\n\t\t\t\t\t\toptions: FileMatch.getDecorationOption(this.isMatchSelected(match))\n\t\t\t\t\t})\n\t\t\t\t\t: []\n\t\t\t);\n\t\t\tthis._modelDecorations = accessor.deltaDecorations(this._modelDecorations, newDecorations);\n\t\t});\n\t}\n\n\tid(): string {\n\t\treturn this.resource.toString();\n\t}\n\n\tparent(): FolderMatch {\n\t\treturn this._parent;\n\t}\n\n\tmatches(): Match[] {\n\t\tconst cellMatches: MatchInNotebook[] = Array.from(this._cellMatches.values()).flatMap((e) => e.matches());\n\t\treturn [...this._textMatches.values(), ...cellMatches];\n\t}\n\n\ttextMatches(): Match[] {\n\t\treturn Array.from(this._textMatches.values());\n\t}\n\n\tcellMatches(): CellMatch[] {\n\t\treturn Array.from(this._cellMatches.values());\n\t}\n\n\tremove(matches: Match | Match[]): void {\n\t\tif (!Array.isArray(matches)) {\n\t\t\tmatches = [matches];\n\t\t}\n\n\t\tfor (const match of matches) {\n\t\t\tthis.removeMatch(match);\n\t\t\tthis._removedTextMatches.add(match.id());\n\t\t}\n\n\t\tthis._onChange.fire({ didRemove: true });\n\t}\n\n\tprivate replaceQ = Promise.resolve();\n\tasync replace(toReplace: Match): Promise<void> {\n\t\treturn this.replaceQ = this.replaceQ.finally(async () => {\n\t\t\tawait this.replaceService.replace(toReplace);\n\t\t\tawait this.updatesMatchesForLineAfterReplace(toReplace.range().startLineNumber, false);\n\t\t});\n\t}\n\n\tsetSelectedMatch(match: Match | null): void {\n\t\tif (match) {\n\n\t\t\tif (!this.isMatchSelected(match) && match instanceof MatchInNotebook) {\n\t\t\t\tthis._selectedMatch = match;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._textMatches.has(match.id())) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.isMatchSelected(match)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis._selectedMatch = match;\n\t\tthis.updateHighlights();\n\t}\n\n\tgetSelectedMatch(): Match | null {\n\t\treturn this._selectedMatch;\n\t}\n\n\tisMatchSelected(match: Match): boolean {\n\t\treturn !!this._selectedMatch && this._selectedMatch.id() === match.id();\n\t}\n\n\tcount(): number {\n\t\treturn this.matches().length;\n\t}\n\n\tget resource(): URI {\n\t\treturn this._resource;\n\t}\n\n\tname(): string {\n\t\treturn this._name.value;\n\t}\n\n\taddContext(results: ITextSearchResult[] | undefined) {\n\t\tif (!results) { return; }\n\n\t\tconst contexts = results\n\t\t\t.filter((result =>\n\t\t\t\t!resultIsMatch(result)) as ((a: any) => a is ITextSearchContext));\n\n\t\treturn contexts.forEach(context => this._context.set(context.lineNumber, context.text));\n\t}\n\n\tadd(match: Match, trigger?: boolean) {\n\t\tthis._textMatches.set(match.id(), match);\n\t\tif (trigger) {\n\t\t\tthis._onChange.fire({ forceUpdateModel: true });\n\t\t}\n\t}\n\n\tprivate removeMatch(match: Match) {\n\n\t\tif (match instanceof MatchInNotebook) {\n\t\t\tmatch.cellParent.remove(match);\n\t\t\tif (match.cellParent.matches().length === 0) {\n\t\t\t\tthis._cellMatches.delete(match.cellParent.id);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._textMatches.delete(match.id());\n\t\t}\n\t\tif (this.isMatchSelected(match)) {\n\t\t\tthis.setSelectedMatch(null);\n\t\t\tthis._findMatchDecorationModel?.clearCurrentFindMatchDecoration();\n\t\t} else {\n\t\t\tthis.updateHighlights();\n\t\t}\n\t\tif (match instanceof MatchInNotebook) {\n\t\t\tthis.setNotebookFindMatchDecorationsUsingCellMatches(this.cellMatches());\n\t\t}\n\t}\n\n\tasync resolveFileStat(fileService: IFileService): Promise<void> {\n\t\tthis._fileStat = await fileService.stat(this.resource).catch(() => undefined);\n\t}\n\n\tpublic get fileStat(): IFileStatWithPartialMetadata | undefined {\n\t\treturn this._fileStat;\n\t}\n\n\tpublic set fileStat(stat: IFileStatWithPartialMetadata | undefined) {\n\t\tthis._fileStat = stat;\n\t}\n\n\toverride dispose(): void {\n\t\tthis.setSelectedMatch(null);\n\t\tthis.unbindModel();\n\t\tthis.unbindNotebookEditorWidget();\n\t\tthis._onDispose.fire();\n\t\tsuper.dispose();\n\t}\n\n\thasOnlyReadOnlyMatches(): boolean {\n\t\treturn this.matches().every(match => (match instanceof MatchInNotebook && match.isWebviewMatch()));\n\t}\n\n\t// #region strictly notebook methods\n\tbindNotebookEditorWidget(widget: NotebookEditorWidget) {\n\t\tif (this._notebookEditorWidget === widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._notebookEditorWidget = widget;\n\n\t\tthis._editorWidgetListener = this._notebookEditorWidget.textModel?.onDidChangeContent((e) => {\n\t\t\tif (!e.rawEvents.some(event => event.kind === NotebookCellsChangeType.ChangeCellContent || event.kind === NotebookCellsChangeType.ModelChange)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._notebookUpdateScheduler.schedule();\n\t\t}) ?? null;\n\t\tthis._addNotebookHighlights();\n\t}\n\n\tunbindNotebookEditorWidget(widget?: NotebookEditorWidget) {\n\t\tif (widget && this._notebookEditorWidget !== widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._notebookEditorWidget) {\n\t\t\tthis._notebookUpdateScheduler.cancel();\n\t\t\tthis._editorWidgetListener?.dispose();\n\t\t}\n\t\tthis._removeNotebookHighlights();\n\t\tthis._notebookEditorWidget = null;\n\t}\n\n\tupdateNotebookHighlights(): void {\n\t\tif (this.parent().showHighlights) {\n\t\t\tthis._addNotebookHighlights();\n\t\t\tthis.setNotebookFindMatchDecorationsUsingCellMatches(Array.from(this._cellMatches.values()));\n\t\t} else {\n\t\t\tthis._removeNotebookHighlights();\n\t\t}\n\t}\n\n\tprivate _addNotebookHighlights(): void {\n\t\tif (!this._notebookEditorWidget) {\n\t\t\treturn;\n\t\t}\n\t\tthis._findMatchDecorationModel?.stopWebviewFind();\n\t\tthis._findMatchDecorationModel?.dispose();\n\t\tthis._findMatchDecorationModel = new FindMatchDecorationModel(this._notebookEditorWidget, this.searchInstanceID);\n\t\tif (this._selectedMatch instanceof MatchInNotebook) {\n\t\t\tthis.highlightCurrentFindMatchDecoration(this._selectedMatch);\n\t\t}\n\t}\n\n\tprivate _removeNotebookHighlights(): void {\n\t\tif (this._findMatchDecorationModel) {\n\t\t\tthis._findMatchDecorationModel?.stopWebviewFind();\n\t\t\tthis._findMatchDecorationModel?.dispose();\n\t\t\tthis._findMatchDecorationModel = undefined;\n\t\t}\n\t}\n\n\tprivate updateNotebookMatches(matches: CellFindMatchWithIndex[], modelChange: boolean): void {\n\t\tif (!this._notebookEditorWidget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldCellMatches = new Map<string, CellMatch>(this._cellMatches);\n\t\tif (this._notebookEditorWidget.getId() !== this._lastEditorWidgetIdForUpdate) {\n\t\t\tthis._cellMatches.clear();\n\t\t\tthis._lastEditorWidgetIdForUpdate = this._notebookEditorWidget.getId();\n\t\t}\n\t\tmatches.forEach(match => {\n\t\t\tlet existingCell = this._cellMatches.get(match.cell.id);\n\t\t\tif (this._notebookEditorWidget && !existingCell) {\n\t\t\t\tconst index = this._notebookEditorWidget.getCellIndex(match.cell);\n\t\t\t\tconst existingRawCell = oldCellMatches.get(`${rawCellPrefix}${index}`);\n\t\t\t\tif (existingRawCell) {\n\t\t\t\t\texistingRawCell.setCellModel(match.cell);\n\t\t\t\t\texistingRawCell.clearAllMatches();\n\t\t\t\t\texistingCell = existingRawCell;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst cell = existingCell ?? new CellMatch(this, match.cell, match.index);\n\t\t\tcell.addContentMatches(contentMatchesToTextSearchMatches(match.contentMatches, match.cell));\n\t\t\tcell.addWebviewMatches(webviewMatchesToTextSearchMatches(match.webviewMatches));\n\t\t\tthis._cellMatches.set(cell.id, cell);\n\n\t\t});\n\n\t\tthis._findMatchDecorationModel?.setAllFindMatchesDecorations(matches);\n\t\tif (this._selectedMatch instanceof MatchInNotebook) {\n\t\t\tthis.highlightCurrentFindMatchDecoration(this._selectedMatch);\n\t\t}\n\t\tthis._onChange.fire({ forceUpdateModel: modelChange });\n\t}\n\n\tprivate setNotebookFindMatchDecorationsUsingCellMatches(cells: CellMatch[]): void {\n\t\tif (!this._findMatchDecorationModel) {\n\t\t\treturn;\n\t\t}\n\t\tconst cellFindMatch: CellFindMatchWithIndex[] = cells.map((cell) => {\n\t\t\tconst webviewMatches: CellWebviewFindMatch[] = cell.webviewMatches.map(match => {\n\t\t\t\treturn <CellWebviewFindMatch>{\n\t\t\t\t\tindex: match.webviewIndex,\n\t\t\t\t};\n\t\t\t});\n\t\t\tconst findMatches: FindMatch[] = cell.contentMatches.map(match => {\n\t\t\t\treturn new FindMatch(match.range(), [match.text()]);\n\t\t\t});\n\t\t\treturn <CellFindMatchWithIndex>{\n\t\t\t\tcell: cell.cell,\n\t\t\t\tindex: cell.cellIndex,\n\t\t\t\tcontentMatches: findMatches,\n\t\t\t\twebviewMatches: webviewMatches\n\t\t\t};\n\t\t});\n\t\ttry {\n\t\t\tthis._findMatchDecorationModel.setAllFindMatchesDecorations(cellFindMatch);\n\t\t} catch (e) {\n\t\t\t// no op, might happen due to bugs related to cell output regex search\n\t\t}\n\t}\n\tasync updateMatchesForEditorWidget(): Promise<void> {\n\t\tif (!this._notebookEditorWidget) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._textMatches = new Map<string, Match>();\n\n\t\tconst wordSeparators = this._query.isWordMatch && this._query.wordSeparators ? this._query.wordSeparators : null;\n\t\tconst allMatches = await this._notebookEditorWidget\n\t\t\t.find(this._query.pattern, {\n\t\t\t\tregex: this._query.isRegExp,\n\t\t\t\twholeWord: this._query.isWordMatch,\n\t\t\t\tcaseSensitive: this._query.isCaseSensitive,\n\t\t\t\twordSeparators: wordSeparators ?? undefined,\n\t\t\t\tincludeMarkupInput: this._query.notebookInfo?.isInNotebookMarkdownInput,\n\t\t\t\tincludeMarkupPreview: this._query.notebookInfo?.isInNotebookMarkdownPreview,\n\t\t\t\tincludeCodeInput: this._query.notebookInfo?.isInNotebookCellInput,\n\t\t\t\tincludeOutput: this._query.notebookInfo?.isInNotebookCellOutput,\n\t\t\t}, CancellationToken.None, false, true, this.searchInstanceID);\n\n\t\tthis.updateNotebookMatches(allMatches, true);\n\t}\n\n\tpublic async showMatch(match: MatchInNotebook) {\n\t\tconst offset = await this.highlightCurrentFindMatchDecoration(match);\n\t\tthis.setSelectedMatch(match);\n\t\tthis.revealCellRange(match, offset);\n\t}\n\n\tprivate async highlightCurrentFindMatchDecoration(match: MatchInNotebook): Promise<number | null> {\n\t\tif (!this._findMatchDecorationModel || match.cell instanceof CellSearchModel) {\n\t\t\t// match cell should never be a CellSearchModel if the notebook is open\n\t\t\treturn null;\n\t\t}\n\t\tif (match.webviewIndex === undefined) {\n\t\t\treturn this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInCell(match.cell, match.range());\n\t\t} else {\n\t\t\treturn this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInWebview(match.cell, match.webviewIndex);\n\t\t}\n\t}\n\n\tprivate revealCellRange(match: MatchInNotebook, outputOffset: number | null) {\n\t\tif (!this._notebookEditorWidget || match.cell instanceof CellSearchModel) {\n\t\t\t// match cell should never be a CellSearchModel if the notebook is open\n\t\t\treturn;\n\t\t}\n\t\tif (match.webviewIndex !== undefined) {\n\t\t\tconst index = this._notebookEditorWidget.getCellIndex(match.cell);\n\t\t\tif (index !== undefined) {\n\t\t\t\tthis._notebookEditorWidget.revealCellOffsetInCenterAsync(match.cell, outputOffset ?? 0);\n\t\t\t}\n\t\t} else {\n\t\t\tmatch.cell.updateEditState(match.cell.getEditState(), 'focusNotebookCell');\n\t\t\tthis._notebookEditorWidget.setCellEditorSelection(match.cell, match.range());\n\t\t\tthis._notebookEditorWidget.revealRangeInCenterIfOutsideViewportAsync(match.cell, match.range());\n\t\t}\n\t}\n\n\t//#endregion\n}\n\nexport interface IChangeEvent {\n\telements: FileMatch[];\n\tadded?: boolean;\n\tremoved?: boolean;\n\tclearingAll?: boolean;\n}\n\nexport class FolderMatch extends Disposable {\n\n\tprotected _onChange = this._register(new Emitter<IChangeEvent>());\n\treadonly onChange: Event<IChangeEvent> = this._onChange.event;\n\n\tprivate _onDispose = this._register(new Emitter<void>());\n\treadonly onDispose: Event<void> = this._onDispose.event;\n\n\tprotected _fileMatches: ResourceMap<FileMatch>;\n\tprotected _folderMatches: ResourceMap<FolderMatchWithResource>;\n\tprotected _folderMatchesMap: TernarySearchTree<URI, FolderMatchWithResource>;\n\tprotected _unDisposedFileMatches: ResourceMap<FileMatch>;\n\tprotected _unDisposedFolderMatches: ResourceMap<FolderMatchWithResource>;\n\tprivate _replacingAll: boolean = false;\n\tprivate _name: Lazy<string>;\n\n\tconstructor(\n\t\tprotected _resource: URI | null,\n\t\tprivate _id: string,\n\t\tprotected _index: number,\n\t\tprotected _query: ITextQuery,\n\t\tprivate _parent: SearchResult | FolderMatch,\n\t\tprivate _searchResult: SearchResult,\n\t\tprivate _closestRoot: FolderMatchWorkspaceRoot | null,\n\t\t@IReplaceService private readonly replaceService: IReplaceService,\n\t\t@IInstantiationService protected readonly instantiationService: IInstantiationService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@IUriIdentityService protected readonly uriIdentityService: IUriIdentityService\n\t) {\n\t\tsuper();\n\t\tthis._fileMatches = new ResourceMap<FileMatch>();\n\t\tthis._folderMatches = new ResourceMap<FolderMatchWithResource>();\n\t\tthis._folderMatchesMap = TernarySearchTree.forUris<FolderMatchWithResource>(key => this.uriIdentityService.extUri.ignorePathCasing(key));\n\t\tthis._unDisposedFileMatches = new ResourceMap<FileMatch>();\n\t\tthis._unDisposedFolderMatches = new ResourceMap<FolderMatchWithResource>();\n\t\tthis._name = new Lazy(() => this.resource ? labelService.getUriBasenameLabel(this.resource) : '');\n\t}\n\n\tget searchModel(): SearchModel {\n\t\treturn this._searchResult.searchModel;\n\t}\n\n\tget showHighlights(): boolean {\n\t\treturn this._parent.showHighlights;\n\t}\n\n\tget closestRoot(): FolderMatchWorkspaceRoot | null {\n\t\treturn this._closestRoot;\n\t}\n\n\tset replacingAll(b: boolean) {\n\t\tthis._replacingAll = b;\n\t}\n\n\tid(): string {\n\t\treturn this._id;\n\t}\n\n\tget resource(): URI | null {\n\t\treturn this._resource;\n\t}\n\n\tindex(): number {\n\t\treturn this._index;\n\t}\n\n\tname(): string {\n\t\treturn this._name.value;\n\t}\n\n\tparent(): SearchResult | FolderMatch {\n\t\treturn this._parent;\n\t}\n\n\tbindModel(model: ITextModel): void {\n\t\tconst fileMatch = this._fileMatches.get(model.uri);\n\n\t\tif (fileMatch) {\n\t\t\tfileMatch.bindModel(model);\n\t\t} else {\n\t\t\tconst folderMatch = this.getFolderMatch(model.uri);\n\t\t\tconst match = folderMatch?.getDownstreamFileMatch(model.uri);\n\t\t\tmatch?.bindModel(model);\n\t\t}\n\t}\n\n\tasync bindNotebookEditorWidget(editor: NotebookEditorWidget, resource: URI) {\n\t\tconst fileMatch = this._fileMatches.get(resource);\n\n\t\tif (fileMatch) {\n\t\t\tfileMatch.bindNotebookEditorWidget(editor);\n\t\t\tawait fileMatch.updateMatchesForEditorWidget();\n\t\t} else {\n\t\t\tconst folderMatches = this.folderMatchesIterator();\n\t\t\tfor (const elem of folderMatches) {\n\t\t\t\tawait elem.bindNotebookEditorWidget(editor, resource);\n\t\t\t}\n\t\t}\n\t}\n\n\tunbindNotebookEditorWidget(editor: NotebookEditorWidget, resource: URI) {\n\t\tconst fileMatch = this._fileMatches.get(resource);\n\n\t\tif (fileMatch) {\n\t\t\tfileMatch.unbindNotebookEditorWidget(editor);\n\t\t} else {\n\t\t\tconst folderMatches = this.folderMatchesIterator();\n\t\t\tfor (const elem of folderMatches) {\n\t\t\t\telem.unbindNotebookEditorWidget(editor, resource);\n\t\t\t}\n\t\t}\n\n\t}\n\n\tpublic createIntermediateFolderMatch(resource: URI, id: string, index: number, query: ITextQuery, baseWorkspaceFolder: FolderMatchWorkspaceRoot): FolderMatchWithResource {\n\t\tconst folderMatch = this.instantiationService.createInstance(FolderMatchWithResource, resource, id, index, query, this, this._searchResult, baseWorkspaceFolder);\n\t\tthis.configureIntermediateMatch(folderMatch);\n\t\tthis.doAddFolder(folderMatch);\n\t\treturn folderMatch;\n\t}\n\n\tpublic configureIntermediateMatch(folderMatch: FolderMatchWithResource) {\n\t\tconst disposable = folderMatch.onChange((event) => this.onFolderChange(folderMatch, event));\n\t\tfolderMatch.onDispose(() => disposable.dispose());\n\t}\n\n\tclear(clearingAll = false): void {\n\t\tconst changed: FileMatch[] = this.allDownstreamFileMatches();\n\t\tthis.disposeMatches();\n\t\tthis._onChange.fire({ elements: changed, removed: true, added: false, clearingAll });\n\t}\n\n\tremove(matches: FileMatch | FolderMatchWithResource | (FileMatch | FolderMatchWithResource)[]): void {\n\t\tif (!Array.isArray(matches)) {\n\t\t\tmatches = [matches];\n\t\t}\n\t\tconst allMatches = getFileMatches(matches);\n\t\tthis.doRemoveFile(allMatches);\n\t}\n\n\tasync replace(match: FileMatch): Promise<any> {\n\t\treturn this.replaceService.replace([match]).then(() => {\n\t\t\tthis.doRemoveFile([match], true, true, true);\n\t\t});\n\t}\n\n\treplaceAll(): Promise<any> {\n\t\tconst matches = this.matches();\n\t\treturn this.batchReplace(matches);\n\t}\n\n\tmatches(): (FileMatch | FolderMatchWithResource)[] {\n\t\treturn [...this.fileMatchesIterator(), ...this.folderMatchesIterator()];\n\t}\n\n\tfileMatchesIterator(): IterableIterator<FileMatch> {\n\t\treturn this._fileMatches.values();\n\t}\n\n\tfolderMatchesIterator(): IterableIterator<FolderMatchWithResource> {\n\t\treturn this._folderMatches.values();\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn (this.fileCount() + this.folderCount()) === 0;\n\t}\n\n\tgetDownstreamFileMatch(uri: URI): FileMatch | null {\n\t\tconst directChildFileMatch = this._fileMatches.get(uri);\n\t\tif (directChildFileMatch) {\n\t\t\treturn directChildFileMatch;\n\t\t}\n\n\t\tconst folderMatch = this.getFolderMatch(uri);\n\t\tconst match = folderMatch?.getDownstreamFileMatch(uri);\n\t\tif (match) {\n\t\t\treturn match;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tallDownstreamFileMatches(): FileMatch[] {\n\t\tlet recursiveChildren: FileMatch[] = [];\n\t\tconst iterator = this.folderMatchesIterator();\n\t\tfor (const elem of iterator) {\n\t\t\trecursiveChildren = recursiveChildren.concat(elem.allDownstreamFileMatches());\n\t\t}\n\n\t\treturn [...this.fileMatchesIterator(), ...recursiveChildren];\n\t}\n\n\tprivate fileCount(): number {\n\t\treturn this._fileMatches.size;\n\t}\n\n\tprivate folderCount(): number {\n\t\treturn this._folderMatches.size;\n\t}\n\n\tcount(): number {\n\t\treturn this.fileCount() + this.folderCount();\n\t}\n\n\trecursiveFileCount(): number {\n\t\treturn this.allDownstreamFileMatches().length;\n\t}\n\n\trecursiveMatchCount(): number {\n\t\treturn this.allDownstreamFileMatches().reduce<number>((prev, match) => prev + match.count(), 0);\n\t}\n\n\tget query(): ITextQuery | null {\n\t\treturn this._query;\n\t}\n\n\taddFileMatch(raw: IFileMatch[], silent: boolean, searchInstanceID: string): void {\n\t\t// when adding a fileMatch that has intermediate directories\n\t\tconst added: FileMatch[] = [];\n\t\tconst updated: FileMatch[] = [];\n\n\t\traw.forEach(rawFileMatch => {\n\t\t\tconst existingFileMatch = this.getDownstreamFileMatch(rawFileMatch.resource);\n\t\t\tif (existingFileMatch) {\n\n\t\t\t\tif (rawFileMatch.results) {\n\t\t\t\t\trawFileMatch\n\t\t\t\t\t\t.results\n\t\t\t\t\t\t.filter(resultIsMatch)\n\t\t\t\t\t\t.forEach(m => {\n\t\t\t\t\t\t\ttextSearchResultToMatches(m, existingFileMatch)\n\t\t\t\t\t\t\t\t.forEach(m => existingFileMatch.add(m));\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// add cell matches\n\t\t\t\tif (isIFileMatchWithCells(rawFileMatch)) {\n\t\t\t\t\trawFileMatch.cellResults?.forEach(rawCellMatch => {\n\t\t\t\t\t\tconst existingCellMatch = existingFileMatch.getCellMatch(rawCellMatch.cell.id);\n\t\t\t\t\t\tif (existingCellMatch) {\n\t\t\t\t\t\t\texistingCellMatch.addContentMatches(rawCellMatch.contentResults);\n\t\t\t\t\t\t\texistingCellMatch.addWebviewMatches(rawCellMatch.webviewResults);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\texistingFileMatch.addCellMatch(rawCellMatch);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tupdated.push(existingFileMatch);\n\n\t\t\t\texistingFileMatch.addContext(rawFileMatch.results);\n\t\t\t} else {\n\t\t\t\tif (this instanceof FolderMatchWorkspaceRoot || this instanceof FolderMatchNoRoot) {\n\t\t\t\t\tconst fileMatch = this.createAndConfigureFileMatch(rawFileMatch, searchInstanceID);\n\t\t\t\t\tadded.push(fileMatch);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst elements = [...added, ...updated];\n\t\tif (!silent && elements.length) {\n\t\t\tthis._onChange.fire({ elements, added: !!added.length });\n\t\t}\n\t}\n\n\tdoAddFile(fileMatch: FileMatch): void {\n\t\tthis._fileMatches.set(fileMatch.resource, fileMatch);\n\t\tif (this._unDisposedFileMatches.has(fileMatch.resource)) {\n\t\t\tthis._unDisposedFileMatches.delete(fileMatch.resource);\n\t\t}\n\t}\n\n\thasOnlyReadOnlyMatches(): boolean {\n\t\treturn Array.from(this._fileMatches.values()).every(fm => fm.hasOnlyReadOnlyMatches());\n\t}\n\n\tprotected uriHasParent(parent: URI, child: URI) {\n\t\treturn this.uriIdentityService.extUri.isEqualOrParent(child, parent) && !this.uriIdentityService.extUri.isEqual(child, parent);\n\t}\n\n\tprivate isInParentChain(folderMatch: FolderMatchWithResource) {\n\n\t\tlet matchItem: FolderMatch | SearchResult = this;\n\t\twhile (matchItem instanceof FolderMatch) {\n\t\t\tif (matchItem.id() === folderMatch.id()) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tmatchItem = matchItem.parent();\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic getFolderMatch(resource: URI): FolderMatchWithResource | undefined {\n\t\tconst folderMatch = this._folderMatchesMap.findSubstr(resource);\n\t\treturn folderMatch;\n\t}\n\n\tdoAddFolder(folderMatch: FolderMatchWithResource) {\n\t\tif (this instanceof FolderMatchWithResource && !this.uriHasParent(this.resource, folderMatch.resource)) {\n\t\t\tthrow Error(`${folderMatch.resource} does not belong as a child of ${this.resource}`);\n\t\t} else if (this.isInParentChain(folderMatch)) {\n\t\t\tthrow Error(`${folderMatch.resource} is a parent of ${this.resource}`);\n\t\t}\n\n\t\tthis._folderMatches.set(folderMatch.resource, folderMatch);\n\t\tthis._folderMatchesMap.set(folderMatch.resource, folderMatch);\n\t\tif (this._unDisposedFolderMatches.has(folderMatch.resource)) {\n\t\t\tthis._unDisposedFolderMatches.delete(folderMatch.resource);\n\t\t}\n\t}\n\n\tprivate async batchReplace(matches: (FileMatch | FolderMatchWithResource)[]): Promise<any> {\n\t\tconst allMatches = getFileMatches(matches);\n\n\t\tawait this.replaceService.replace(allMatches);\n\t\tthis.doRemoveFile(allMatches, true, true, true);\n\t}\n\n\tpublic onFileChange(fileMatch: FileMatch, removed = false): void {\n\t\tlet added = false;\n\t\tif (!this._fileMatches.has(fileMatch.resource)) {\n\t\t\tthis.doAddFile(fileMatch);\n\t\t\tadded = true;\n\t\t}\n\t\tif (fileMatch.count() === 0) {\n\t\t\tthis.doRemoveFile([fileMatch], false, false);\n\t\t\tadded = false;\n\t\t\tremoved = true;\n\t\t}\n\t\tif (!this._replacingAll) {\n\t\t\tthis._onChange.fire({ elements: [fileMatch], added: added, removed: removed });\n\t\t}\n\t}\n\n\tpublic onFolderChange(folderMatch: FolderMatchWithResource, event: IChangeEvent): void {\n\t\tif (!this._folderMatches.has(folderMatch.resource)) {\n\t\t\tthis.doAddFolder(folderMatch);\n\t\t}\n\t\tif (folderMatch.isEmpty()) {\n\t\t\tthis._folderMatches.delete(folderMatch.resource);\n\t\t\tfolderMatch.dispose();\n\t\t}\n\n\t\tthis._onChange.fire(event);\n\t}\n\n\tprivate doRemoveFile(fileMatches: FileMatch[], dispose: boolean = true, trigger: boolean = true, keepReadonly = false): void {\n\n\t\tconst removed = [];\n\t\tfor (const match of fileMatches as FileMatch[]) {\n\t\t\tif (this._fileMatches.get(match.resource)) {\n\t\t\t\tif (keepReadonly && match.hasWebviewMatches()) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis._fileMatches.delete(match.resource);\n\t\t\t\tif (dispose) {\n\t\t\t\t\tmatch.dispose();\n\t\t\t\t} else {\n\t\t\t\t\tthis._unDisposedFileMatches.set(match.resource, match);\n\t\t\t\t}\n\t\t\t\tremoved.push(match);\n\t\t\t} else {\n\t\t\t\tconst folder = this.getFolderMatch(match.resource);\n\t\t\t\tif (folder) {\n\t\t\t\t\tfolder.doRemoveFile([match], dispose, trigger);\n\t\t\t\t} else {\n\t\t\t\t\tthrow Error(`FileMatch ${match.resource} is not located within FolderMatch ${this.resource}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (trigger) {\n\t\t\tthis._onChange.fire({ elements: removed, removed: true });\n\t\t}\n\t}\n\n\tprivate disposeMatches(): void {\n\t\t[...this._fileMatches.values()].forEach((fileMatch: FileMatch) => fileMatch.dispose());\n\t\t[...this._folderMatches.values()].forEach((folderMatch: FolderMatch) => folderMatch.disposeMatches());\n\t\t[...this._unDisposedFileMatches.values()].forEach((fileMatch: FileMatch) => fileMatch.dispose());\n\t\t[...this._unDisposedFolderMatches.values()].forEach((folderMatch: FolderMatch) => folderMatch.disposeMatches());\n\t\tthis._fileMatches.clear();\n\t\tthis._folderMatches.clear();\n\t\tthis._unDisposedFileMatches.clear();\n\t\tthis._unDisposedFolderMatches.clear();\n\t}\n\n\toverride dispose(): void {\n\t\tthis.disposeMatches();\n\t\tthis._onDispose.fire();\n\t\tsuper.dispose();\n\t}\n}\n\nexport class FolderMatchWithResource extends FolderMatch {\n\n\tprotected _normalizedResource: Lazy<URI>;\n\n\tconstructor(_resource: URI, _id: string, _index: number, _query: ITextQuery, _parent: SearchResult | FolderMatch, _searchResult: SearchResult, _closestRoot: FolderMatchWorkspaceRoot | null,\n\t\t@IReplaceService replaceService: IReplaceService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService\n\t) {\n\t\tsuper(_resource, _id, _index, _query, _parent, _searchResult, _closestRoot, replaceService, instantiationService, labelService, uriIdentityService);\n\t\tthis._normalizedResource = new Lazy(() => this.uriIdentityService.extUri.removeTrailingPathSeparator(this.uriIdentityService.extUri.normalizePath(\n\t\t\tthis.resource)));\n\t}\n\n\toverride get resource(): URI {\n\t\treturn this._resource!;\n\t}\n\n\tget normalizedResource(): URI {\n\t\treturn this._normalizedResource.value;\n\t}\n}\n\n/**\n * FolderMatchWorkspaceRoot => folder for workspace root\n */\nexport class FolderMatchWorkspaceRoot extends FolderMatchWithResource {\n\tconstructor(_resource: URI, _id: string, _index: number, _query: ITextQuery, _parent: SearchResult,\n\t\t@IReplaceService replaceService: IReplaceService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService\n\t) {\n\t\tsuper(_resource, _id, _index, _query, _parent, _parent, null, replaceService, instantiationService, labelService, uriIdentityService);\n\t}\n\n\tprivate normalizedUriParent(uri: URI): URI {\n\t\treturn this.uriIdentityService.extUri.normalizePath(this.uriIdentityService.extUri.dirname(uri));\n\t}\n\n\tprivate uriEquals(uri1: URI, ur2: URI): boolean {\n\t\treturn this.uriIdentityService.extUri.isEqual(uri1, ur2);\n\t}\n\n\tprivate createFileMatch(query: IPatternInfo, previewOptions: ITextSearchPreviewOptions | undefined, maxResults: number | undefined, parent: FolderMatch, rawFileMatch: IFileMatch, closestRoot: FolderMatchWorkspaceRoot | null, searchInstanceID: string): FileMatch {\n\t\tconst fileMatch =\n\t\t\tthis.instantiationService.createInstance(\n\t\t\t\tFileMatch,\n\t\t\t\tquery,\n\t\t\t\tpreviewOptions,\n\t\t\t\tmaxResults,\n\t\t\t\tparent,\n\t\t\t\trawFileMatch,\n\t\t\t\tclosestRoot,\n\t\t\t\tsearchInstanceID\n\t\t\t);\n\t\tparent.doAddFile(fileMatch);\n\t\tconst disposable = fileMatch.onChange(({ didRemove }) => parent.onFileChange(fileMatch, didRemove));\n\t\tfileMatch.onDispose(() => disposable.dispose());\n\t\treturn fileMatch;\n\t}\n\n\tcreateAndConfigureFileMatch(rawFileMatch: IFileMatch<URI>, searchInstanceID: string): FileMatch {\n\n\t\tif (!this.uriHasParent(this.resource, rawFileMatch.resource)) {\n\t\t\tthrow Error(`${rawFileMatch.resource} is not a descendant of ${this.resource}`);\n\t\t}\n\n\t\tconst fileMatchParentParts: URI[] = [];\n\t\tlet uri = this.normalizedUriParent(rawFileMatch.resource);\n\n\t\twhile (!this.uriEquals(this.normalizedResource, uri)) {\n\t\t\tfileMatchParentParts.unshift(uri);\n\t\t\tconst prevUri = uri;\n\t\t\turi = this.uriIdentityService.extUri.removeTrailingPathSeparator(this.normalizedUriParent(uri));\n\t\t\tif (this.uriEquals(prevUri, uri)) {\n\t\t\t\tthrow Error(`${rawFileMatch.resource} is not correctly configured as a child of ${this.normalizedResource}`);\n\t\t\t}\n\t\t}\n\n\t\tconst root = this.closestRoot ?? this;\n\t\tlet parent: FolderMatch = this;\n\t\tfor (let i = 0; i < fileMatchParentParts.length; i++) {\n\t\t\tlet folderMatch: FolderMatchWithResource | undefined = parent.getFolderMatch(fileMatchParentParts[i]);\n\t\t\tif (!folderMatch) {\n\t\t\t\tfolderMatch = parent.createIntermediateFolderMatch(fileMatchParentParts[i], fileMatchParentParts[i].toString(), -1, this._query, root);\n\t\t\t}\n\t\t\tparent = folderMatch;\n\t\t}\n\n\t\treturn this.createFileMatch(this._query.contentPattern, this._query.previewOptions, this._query.maxResults, parent, rawFileMatch, root, searchInstanceID);\n\t}\n}\n\n/**\n * BaseFolderMatch => optional resource (\"other files\" node)\n * FolderMatch => required resource (normal folder node)\n */\nexport class FolderMatchNoRoot extends FolderMatch {\n\tconstructor(_id: string, _index: number, _query: ITextQuery, _parent: SearchResult,\n\t\t@IReplaceService replaceService: IReplaceService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\n\t) {\n\t\tsuper(null, _id, _index, _query, _parent, _parent, null, replaceService, instantiationService, labelService, uriIdentityService);\n\t}\n\n\tcreateAndConfigureFileMatch(rawFileMatch: IFileMatch, searchInstanceID: string): FileMatch {\n\t\tconst fileMatch = this.instantiationService.createInstance(\n\t\t\tFileMatch,\n\t\t\tthis._query.contentPattern,\n\t\t\tthis._query.previewOptions,\n\t\t\tthis._query.maxResults,\n\t\t\tthis, rawFileMatch,\n\t\t\tnull,\n\t\t\tsearchInstanceID);\n\t\tthis.doAddFile(fileMatch);\n\t\tconst disposable = fileMatch.onChange(({ didRemove }) => this.onFileChange(fileMatch, didRemove));\n\t\tfileMatch.onDispose(() => disposable.dispose());\n\t\treturn fileMatch;\n\t}\n}\n\nlet elemAIndex: number = -1;\nlet elemBIndex: number = -1;\n/**\n * Compares instances of the same match type. Different match types should not be siblings\n * and their sort order is undefined.\n */\nexport function searchMatchComparer(elementA: RenderableMatch, elementB: RenderableMatch, sortOrder: SearchSortOrder = SearchSortOrder.Default): number {\n\n\tif (elementA instanceof FileMatch && elementB instanceof FolderMatch) {\n\t\treturn 1;\n\t}\n\n\tif (elementB instanceof FileMatch && elementA instanceof FolderMatch) {\n\t\treturn -1;\n\t}\n\n\tif (elementA instanceof FolderMatch && elementB instanceof FolderMatch) {\n\t\telemAIndex = elementA.index();\n\t\telemBIndex = elementB.index();\n\t\tif (elemAIndex !== -1 && elemBIndex !== -1) {\n\t\t\treturn elemAIndex - elemBIndex;\n\t\t}\n\n\t\tswitch (sortOrder) {\n\t\t\tcase SearchSortOrder.CountDescending:\n\t\t\t\treturn elementB.count() - elementA.count();\n\t\t\tcase SearchSortOrder.CountAscending:\n\t\t\t\treturn elementA.count() - elementB.count();\n\t\t\tcase SearchSortOrder.Type:\n\t\t\t\treturn compareFileExtensions(elementA.name(), elementB.name());\n\t\t\tcase SearchSortOrder.FileNames:\n\t\t\t\treturn compareFileNames(elementA.name(), elementB.name());\n\t\t\t// Fall through otherwise\n\t\t\tdefault:\n\t\t\t\tif (!elementA.resource || !elementB.resource) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t\treturn comparePaths(elementA.resource.fsPath, elementB.resource.fsPath) || compareFileNames(elementA.name(), elementB.name());\n\t\t}\n\t}\n\n\tif (elementA instanceof FileMatch && elementB instanceof FileMatch) {\n\t\tswitch (sortOrder) {\n\t\t\tcase SearchSortOrder.CountDescending:\n\t\t\t\treturn elementB.count() - elementA.count();\n\t\t\tcase SearchSortOrder.CountAscending:\n\t\t\t\treturn elementA.count() - elementB.count();\n\t\t\tcase SearchSortOrder.Type:\n\t\t\t\treturn compareFileExtensions(elementA.name(), elementB.name());\n\t\t\tcase SearchSortOrder.FileNames:\n\t\t\t\treturn compareFileNames(elementA.name(), elementB.name());\n\t\t\tcase SearchSortOrder.Modified: {\n\t\t\t\tconst fileStatA = elementA.fileStat;\n\t\t\t\tconst fileStatB = elementB.fileStat;\n\t\t\t\tif (fileStatA && fileStatB) {\n\t\t\t\t\treturn fileStatB.mtime - fileStatA.mtime;\n\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Fall through otherwise\n\t\t\tdefault:\n\t\t\t\treturn comparePaths(elementA.resource.fsPath, elementB.resource.fsPath) || compareFileNames(elementA.name(), elementB.name());\n\t\t}\n\t}\n\n\tif (elementA instanceof MatchInNotebook && elementB instanceof MatchInNotebook) {\n\t\treturn compareNotebookPos(elementA, elementB);\n\t}\n\n\tif (elementA instanceof Match && elementB instanceof Match) {\n\t\treturn Range.compareRangesUsingStarts(elementA.range(), elementB.range());\n\t}\n\n\treturn 0;\n}\n\nexport function compareNotebookPos(match1: MatchInNotebook, match2: MatchInNotebook): number {\n\tif (match1.cellIndex === match2.cellIndex) {\n\n\t\tif (match1.webviewIndex !== undefined && match2.webviewIndex !== undefined) {\n\t\t\treturn match1.webviewIndex - match2.webviewIndex;\n\t\t} else if (match1.webviewIndex === undefined && match2.webviewIndex === undefined) {\n\t\t\treturn Range.compareRangesUsingStarts(match1.range(), match2.range());\n\t\t} else {\n\t\t\t// webview matches should always be after content matches\n\t\t\tif (match1.webviewIndex !== undefined) {\n\t\t\t\treturn 1;\n\t\t\t} else {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}\n\t} else if (match1.cellIndex < match2.cellIndex) {\n\t\treturn -1;\n\t} else {\n\t\treturn 1;\n\t}\n}\nexport function searchComparer(elementA: RenderableMatch, elementB: RenderableMatch, sortOrder: SearchSortOrder = SearchSortOrder.Default): number {\n\tconst elemAParents = createParentList(elementA);\n\tconst elemBParents = createParentList(elementB);\n\n\tlet i = elemAParents.length - 1;\n\tlet j = elemBParents.length - 1;\n\twhile (i >= 0 && j >= 0) {\n\t\tif (elemAParents[i].id() !== elemBParents[j].id()) {\n\t\t\treturn searchMatchComparer(elemAParents[i], elemBParents[j], sortOrder);\n\t\t}\n\t\ti--;\n\t\tj--;\n\t}\n\tconst elemAAtEnd = i === 0;\n\tconst elemBAtEnd = j === 0;\n\n\tif (elemAAtEnd && !elemBAtEnd) {\n\t\treturn 1;\n\t} else if (!elemAAtEnd && elemBAtEnd) {\n\t\treturn -1;\n\t}\n\treturn 0;\n}\n\nfunction createParentList(element: RenderableMatch): RenderableMatch[] {\n\tconst parentArray: RenderableMatch[] = [];\n\tlet currElement: RenderableMatch | SearchResult = element;\n\n\twhile (!(currElement instanceof SearchResult)) {\n\t\tparentArray.push(currElement);\n\t\tcurrElement = currElement.parent();\n\t}\n\n\treturn parentArray;\n}\nexport class SearchResult extends Disposable {\n\n\tprivate _onChange = this._register(new PauseableEmitter<IChangeEvent>({\n\t\tmerge: mergeSearchResultEvents\n\t}));\n\treadonly onChange: Event<IChangeEvent> = this._onChange.event;\n\tprivate _folderMatches: FolderMatchWorkspaceRoot[] = [];\n\tprivate _otherFilesMatch: FolderMatch | null = null;\n\tprivate _folderMatchesMap: TernarySearchTree<URI, FolderMatchWithResource> = TernarySearchTree.forUris<FolderMatchWorkspaceRoot>(key => this.uriIdentityService.extUri.ignorePathCasing(key));\n\tprivate _showHighlights: boolean = false;\n\tprivate _query: ITextQuery | null = null;\n\tprivate _rangeHighlightDecorations: RangeHighlightDecorations;\n\tprivate disposePastResults: () => void = () => { };\n\tprivate _isDirty = false;\n\tprivate _onWillChangeModelListener: IDisposable | undefined;\n\tprivate _onDidChangeModelListener: IDisposable | undefined;\n\n\tconstructor(\n\t\tpublic searchModel: SearchModel,\n\t\t@IReplaceService private readonly replaceService: IReplaceService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@INotebookEditorService private readonly notebookEditorService: INotebookEditorService,\n\t) {\n\t\tsuper();\n\t\tthis._rangeHighlightDecorations = this.instantiationService.createInstance(RangeHighlightDecorations);\n\n\t\tthis._register(this.modelService.onModelAdded(model => this.onModelAdded(model)));\n\n\t\tthis._register(this.notebookEditorService.onDidAddNotebookEditor(widget => {\n\t\t\tif (widget instanceof NotebookEditorWidget) {\n\t\t\t\tthis.onDidAddNotebookEditorWidget(<NotebookEditorWidget>widget);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.onChange(e => {\n\t\t\tif (e.removed) {\n\t\t\t\tthis._isDirty = !this.isEmpty();\n\t\t\t}\n\t\t}));\n\t}\n\n\tasync batchReplace(elementsToReplace: RenderableMatch[]) {\n\t\ttry {\n\t\t\tthis._onChange.pause();\n\t\t\tawait Promise.all(elementsToReplace.map(async (elem) => {\n\t\t\t\tconst parent = elem.parent();\n\n\t\t\t\tif ((parent instanceof FolderMatch || parent instanceof FileMatch) && arrayContainsElementOrParent(parent, elementsToReplace)) {\n\t\t\t\t\t// skip any children who have parents in the array\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (elem instanceof FileMatch) {\n\t\t\t\t\tawait elem.parent().replace(elem);\n\t\t\t\t} else if (elem instanceof Match) {\n\t\t\t\t\tawait elem.parent().replace(elem);\n\t\t\t\t} else if (elem instanceof FolderMatch) {\n\t\t\t\t\tawait elem.replaceAll();\n\t\t\t\t}\n\t\t\t}));\n\t\t} finally {\n\t\t\tthis._onChange.resume();\n\t\t}\n\t}\n\n\tbatchRemove(elementsToRemove: RenderableMatch[]) {\n\t\t// need to check that we aren't trying to remove elements twice\n\t\tconst removedElems: RenderableMatch[] = [];\n\n\t\ttry {\n\t\t\tthis._onChange.pause();\n\t\t\telementsToRemove.forEach((currentElement) => {\n\t\t\t\tif (!arrayContainsElementOrParent(currentElement, removedElems)) {\n\t\t\t\t\tcurrentElement.parent().remove(<(FolderMatch | FileMatch)[] & Match & FileMatch[]>currentElement);\n\t\t\t\t\tremovedElems.push(currentElement);\n\t\t\t\t}\n\t\t\t}\n\t\t\t);\n\t\t} finally {\n\t\t\tthis._onChange.resume();\n\t\t}\n\t}\n\n\tget isDirty(): boolean {\n\t\treturn this._isDirty;\n\t}\n\n\tget query(): ITextQuery | null {\n\t\treturn this._query;\n\t}\n\n\tset query(query: ITextQuery | null) {\n\t\t// When updating the query we could change the roots, so keep a reference to them to clean up when we trigger `disposePastResults`\n\t\tconst oldFolderMatches = this.folderMatches();\n\t\tnew Promise<void>(resolve => this.disposePastResults = resolve)\n\t\t\t.then(() => oldFolderMatches.forEach(match => match.clear()))\n\t\t\t.then(() => oldFolderMatches.forEach(match => match.dispose()))\n\t\t\t.then(() => this._isDirty = false);\n\n\t\tthis._rangeHighlightDecorations.removeHighlightRange();\n\t\tthis._folderMatchesMap = TernarySearchTree.forUris<FolderMatchWithResource>(key => this.uriIdentityService.extUri.ignorePathCasing(key));\n\n\t\tif (!query) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._folderMatches = (query && query.folderQueries || [])\n\t\t\t.map(fq => fq.folder)\n\t\t\t.map((resource, index) => <FolderMatchWorkspaceRoot>this._createBaseFolderMatch(resource, resource.toString(), index, query));\n\n\t\tthis._folderMatches.forEach(fm => this._folderMatchesMap.set(fm.resource, fm));\n\t\tthis._otherFilesMatch = <FolderMatchNoRoot>this._createBaseFolderMatch(null, 'otherFiles', this._folderMatches.length + 1, query);\n\n\t\tthis._query = query;\n\t}\n\n\tprivate onDidAddNotebookEditorWidget(widget: NotebookEditorWidget): void {\n\n\t\tthis._onWillChangeModelListener?.dispose();\n\t\tthis._onWillChangeModelListener = widget.onWillChangeModel(\n\t\t\t(model) => {\n\t\t\t\tif (model) {\n\t\t\t\t\tthis.onNotebookEditorWidgetRemoved(widget, model?.uri);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis._onDidChangeModelListener?.dispose();\n\t\t// listen to view model change as we are searching on both inputs and outputs\n\t\tthis._onDidChangeModelListener = widget.onDidAttachViewModel(\n\t\t\t() => {\n\t\t\t\tif (widget.hasModel()) {\n\t\t\t\t\tthis.onNotebookEditorWidgetAdded(widget, widget.textModel.uri);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tprivate onModelAdded(model: ITextModel): void {\n\t\tconst folderMatch = this._folderMatchesMap.findSubstr(model.uri);\n\t\tfolderMatch?.bindModel(model);\n\t}\n\n\tprivate async onNotebookEditorWidgetAdded(editor: NotebookEditorWidget, resource: URI): Promise<void> {\n\t\tconst folderMatch = this._folderMatchesMap.findSubstr(resource);\n\t\tawait folderMatch?.bindNotebookEditorWidget(editor, resource);\n\t}\n\n\tprivate onNotebookEditorWidgetRemoved(editor: NotebookEditorWidget, resource: URI): void {\n\t\tconst folderMatch = this._folderMatchesMap.findSubstr(resource);\n\t\tfolderMatch?.unbindNotebookEditorWidget(editor, resource);\n\t}\n\n\tprivate _createBaseFolderMatch(resource: URI | null, id: string, index: number, query: ITextQuery): FolderMatch {\n\t\tlet folderMatch: FolderMatch;\n\t\tif (resource) {\n\t\t\tfolderMatch = this.instantiationService.createInstance(FolderMatchWorkspaceRoot, resource, id, index, query, this);\n\t\t} else {\n\t\t\tfolderMatch = this.instantiationService.createInstance(FolderMatchNoRoot, id, index, query, this);\n\t\t}\n\t\tconst disposable = folderMatch.onChange((event) => this._onChange.fire(event));\n\t\tfolderMatch.onDispose(() => disposable.dispose());\n\t\treturn folderMatch;\n\t}\n\n\n\tadd(allRaw: IFileMatch[], searchInstanceID: string, silent: boolean = false): void {\n\t\t// Split up raw into a list per folder so we can do a batch add per folder.\n\n\t\tconst { byFolder, other } = this.groupFilesByFolder(allRaw);\n\t\tbyFolder.forEach(raw => {\n\t\t\tif (!raw.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst folderMatch = this.getFolderMatch(raw[0].resource);\n\t\t\tfolderMatch?.addFileMatch(raw, silent, searchInstanceID);\n\t\t});\n\n\t\tthis._otherFilesMatch?.addFileMatch(other, silent, searchInstanceID);\n\t\tthis.disposePastResults();\n\t}\n\n\tclear(): void {\n\t\tthis.folderMatches().forEach((folderMatch) => folderMatch.clear(true));\n\t\tthis.disposeMatches();\n\t\tthis._folderMatches = [];\n\t\tthis._otherFilesMatch = null;\n\t}\n\n\tremove(matches: FileMatch | FolderMatch | (FileMatch | FolderMatch)[]): void {\n\t\tif (!Array.isArray(matches)) {\n\t\t\tmatches = [matches];\n\t\t}\n\n\t\tmatches.forEach(m => {\n\t\t\tif (m instanceof FolderMatch) {\n\t\t\t\tm.clear();\n\t\t\t}\n\t\t});\n\n\t\tconst fileMatches: FileMatch[] = matches.filter(m => m instanceof FileMatch) as FileMatch[];\n\n\t\tconst { byFolder, other } = this.groupFilesByFolder(fileMatches);\n\t\tbyFolder.forEach(matches => {\n\t\t\tif (!matches.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getFolderMatch(matches[0].resource).remove(<FileMatch[]>matches);\n\t\t});\n\n\t\tif (other.length) {\n\t\t\tthis.getFolderMatch(other[0].resource).remove(<FileMatch[]>other);\n\t\t}\n\t}\n\n\treplace(match: FileMatch): Promise<any> {\n\t\treturn this.getFolderMatch(match.resource).replace(match);\n\t}\n\n\treplaceAll(progress: IProgress<IProgressStep>): Promise<any> {\n\t\tthis.replacingAll = true;\n\n\t\tconst promise = this.replaceService.replace(this.matches(), progress);\n\n\t\treturn promise.then(() => {\n\t\t\tthis.replacingAll = false;\n\t\t\tthis.clear();\n\t\t}, () => {\n\t\t\tthis.replacingAll = false;\n\t\t});\n\t}\n\n\tfolderMatches(): FolderMatch[] {\n\t\treturn this._otherFilesMatch ?\n\t\t\t[\n\t\t\t\t...this._folderMatches,\n\t\t\t\tthis._otherFilesMatch\n\t\t\t] :\n\t\t\t[\n\t\t\t\t...this._folderMatches\n\t\t\t];\n\t}\n\n\tmatches(): FileMatch[] {\n\t\tconst matches: FileMatch[][] = [];\n\t\tthis.folderMatches().forEach(folderMatch => {\n\t\t\tmatches.push(folderMatch.allDownstreamFileMatches());\n\t\t});\n\n\t\treturn (<FileMatch[]>[]).concat(...matches);\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this.folderMatches().every((folderMatch) => folderMatch.isEmpty());\n\t}\n\n\tfileCount(): number {\n\t\treturn this.folderMatches().reduce<number>((prev, match) => prev + match.recursiveFileCount(), 0);\n\t}\n\n\tcount(): number {\n\t\treturn this.matches().reduce<number>((prev, match) => prev + match.count(), 0);\n\t}\n\n\tget showHighlights(): boolean {\n\t\treturn this._showHighlights;\n\t}\n\n\ttoggleHighlights(value: boolean): void {\n\t\tif (this._showHighlights === value) {\n\t\t\treturn;\n\t\t}\n\t\tthis._showHighlights = value;\n\t\tlet selectedMatch: Match | null = null;\n\t\tthis.matches().forEach((fileMatch: FileMatch) => {\n\t\t\tfileMatch.updateHighlights();\n\t\t\tfileMatch.updateNotebookHighlights();\n\t\t\tif (!selectedMatch) {\n\t\t\t\tselectedMatch = fileMatch.getSelectedMatch();\n\t\t\t}\n\t\t});\n\t\tif (this._showHighlights && selectedMatch) {\n\t\t\t// TS?\n\t\t\tthis._rangeHighlightDecorations.highlightRange(\n\t\t\t\t(<Match>selectedMatch).parent().resource,\n\t\t\t\t(<Match>selectedMatch).range()\n\t\t\t);\n\t\t} else {\n\t\t\tthis._rangeHighlightDecorations.removeHighlightRange();\n\t\t}\n\t}\n\n\tget rangeHighlightDecorations(): RangeHighlightDecorations {\n\t\treturn this._rangeHighlightDecorations;\n\t}\n\n\tprivate getFolderMatch(resource: URI): FolderMatchWorkspaceRoot | FolderMatch {\n\t\tconst folderMatch = this._folderMatchesMap.findSubstr(resource);\n\t\treturn folderMatch ? folderMatch : this._otherFilesMatch!;\n\t}\n\n\tprivate set replacingAll(running: boolean) {\n\t\tthis.folderMatches().forEach((folderMatch) => {\n\t\t\tfolderMatch.replacingAll = running;\n\t\t});\n\t}\n\n\tprivate groupFilesByFolder(fileMatches: IFileMatch[]): { byFolder: ResourceMap<IFileMatch[]>; other: IFileMatch[] } {\n\t\tconst rawPerFolder = new ResourceMap<IFileMatch[]>();\n\t\tconst otherFileMatches: IFileMatch[] = [];\n\t\tthis._folderMatches.forEach(fm => rawPerFolder.set(fm.resource, []));\n\n\t\tfileMatches.forEach(rawFileMatch => {\n\t\t\tconst folderMatch = this.getFolderMatch(rawFileMatch.resource);\n\t\t\tif (!folderMatch) {\n\t\t\t\t// foldermatch was previously removed by user or disposed for some reason\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst resource = folderMatch.resource;\n\t\t\tif (resource) {\n\t\t\t\trawPerFolder.get(resource)!.push(rawFileMatch);\n\t\t\t} else {\n\t\t\t\totherFileMatches.push(rawFileMatch);\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tbyFolder: rawPerFolder,\n\t\t\tother: otherFileMatches\n\t\t};\n\t}\n\n\tprivate disposeMatches(): void {\n\t\tthis.folderMatches().forEach(folderMatch => folderMatch.dispose());\n\t\tthis._folderMatches = [];\n\t\tthis._folderMatchesMap = TernarySearchTree.forUris<FolderMatchWithResource>(key => this.uriIdentityService.extUri.ignorePathCasing(key));\n\t\tthis._rangeHighlightDecorations.removeHighlightRange();\n\t}\n\n\toverride dispose(): void {\n\t\tthis._onWillChangeModelListener?.dispose();\n\t\tthis._onDidChangeModelListener?.dispose();\n\t\tthis.disposePastResults();\n\t\tthis.disposeMatches();\n\t\tthis._rangeHighlightDecorations.dispose();\n\t\tsuper.dispose();\n\t}\n}\n\nexport class SearchModel extends Disposable {\n\n\tprivate _searchResult: SearchResult;\n\tprivate _searchQuery: ITextQuery | null = null;\n\tprivate _replaceActive: boolean = false;\n\tprivate _replaceString: string | null = null;\n\tprivate _replacePattern: ReplacePattern | null = null;\n\tprivate _preserveCase: boolean = false;\n\tprivate _startStreamDelay: Promise<void> = Promise.resolve();\n\tprivate readonly _resultQueue: IFileMatch[] = [];\n\n\tprivate readonly _onReplaceTermChanged: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onReplaceTermChanged: Event<void> = this._onReplaceTermChanged.event;\n\n\tprivate readonly _onSearchResultChanged = this._register(new PauseableEmitter<IChangeEvent>({\n\t\tmerge: mergeSearchResultEvents\n\t}));\n\treadonly onSearchResultChanged: Event<IChangeEvent> = this._onSearchResultChanged.event;\n\n\tprivate currentCancelTokenSource: CancellationTokenSource | null = null;\n\tprivate searchCancelledForNewSearch: boolean = false;\n\tprivate _searchResultChangedListener: IDisposable;\n\n\tconstructor(\n\t\t@ISearchService private readonly searchService: ISearchService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@INotebookSearchService private readonly notebookSearchService: INotebookSearchService,\n\t) {\n\t\tsuper();\n\t\tthis._searchResult = this.instantiationService.createInstance(SearchResult, this);\n\t\tthis._searchResultChangedListener = this._register(this._searchResult.onChange((e) => this._onSearchResultChanged.fire(e)));\n\t}\n\n\tisReplaceActive(): boolean {\n\t\treturn this._replaceActive;\n\t}\n\n\tset replaceActive(replaceActive: boolean) {\n\t\tthis._replaceActive = replaceActive;\n\t}\n\n\tget replacePattern(): ReplacePattern | null {\n\t\treturn this._replacePattern;\n\t}\n\n\tget replaceString(): string {\n\t\treturn this._replaceString || '';\n\t}\n\n\tset preserveCase(value: boolean) {\n\t\tthis._preserveCase = value;\n\t}\n\n\tget preserveCase(): boolean {\n\t\treturn this._preserveCase;\n\t}\n\n\tset replaceString(replaceString: string) {\n\t\tthis._replaceString = replaceString;\n\t\tif (this._searchQuery) {\n\t\t\tthis._replacePattern = new ReplacePattern(replaceString, this._searchQuery.contentPattern);\n\t\t}\n\t\tthis._onReplaceTermChanged.fire();\n\t}\n\n\tget searchResult(): SearchResult {\n\t\treturn this._searchResult;\n\t}\n\n\tset searchResult(searchResult: SearchResult) {\n\t\tthis._searchResult.dispose();\n\t\tthis._searchResultChangedListener.dispose();\n\n\t\tthis._searchResult = searchResult;\n\t\tthis._searchResult.searchModel = this;\n\t\tthis._searchResultChangedListener = this._register(this._searchResult.onChange((e) => this._onSearchResultChanged.fire(e)));\n\t}\n\n\n\tprivate doSearch(query: ITextQuery, progressEmitter: Emitter<void>, searchQuery: ITextQuery, searchInstanceID: string, onProgress?: (result: ISearchProgressItem) => void, callerToken?: CancellationToken): {\n\t\tasyncResults: Promise<ISearchComplete>;\n\t\tsyncResults: IFileMatch<URI>[];\n\t} {\n\t\tconst asyncGenerateOnProgress = async (p: ISearchProgressItem) => {\n\t\t\tprogressEmitter.fire();\n\t\t\tthis.onSearchProgress(p, searchInstanceID, false);\n\t\t\tonProgress?.(p);\n\t\t};\n\n\t\tconst syncGenerateOnProgress = (p: ISearchProgressItem) => {\n\t\t\tprogressEmitter.fire();\n\t\t\tthis.onSearchProgress(p, searchInstanceID, true);\n\t\t\tonProgress?.(p);\n\t\t};\n\t\tconst tokenSource = this.currentCancelTokenSource = new CancellationTokenSource(callerToken);\n\n\t\tconst notebookResult = this.notebookSearchService.notebookSearch(query, tokenSource.token, searchInstanceID, asyncGenerateOnProgress);\n\t\tconst textResult = this.searchService.textSearchSplitSyncAsync(\n\t\t\tsearchQuery,\n\t\t\tthis.currentCancelTokenSource.token, asyncGenerateOnProgress,\n\t\t\tnotebookResult.openFilesToScan,\n\t\t\tnotebookResult.allScannedFiles,\n\t\t);\n\n\t\tconst syncResults = textResult.syncResults.results;\n\t\tsyncResults.forEach(p => { if (p) { syncGenerateOnProgress(p); } });\n\n\t\tconst getAsyncResults = async (): Promise<ISearchComplete> => {\n\t\t\tconst searchStart = Date.now();\n\n\t\t\t// resolve async parts of search\n\t\t\tconst allClosedEditorResults = await textResult.asyncResults;\n\t\t\tconst resolvedNotebookResults = await notebookResult.completeData;\n\t\t\ttokenSource.dispose();\n\t\t\tconst searchLength = Date.now() - searchStart;\n\t\t\tconst resolvedResult = <ISearchComplete>{\n\t\t\t\tresults: [...allClosedEditorResults.results, ...resolvedNotebookResults.results],\n\t\t\t\tmessages: [...allClosedEditorResults.messages, ...resolvedNotebookResults.messages],\n\t\t\t\tlimitHit: allClosedEditorResults.limitHit || resolvedNotebookResults.limitHit,\n\t\t\t\texit: allClosedEditorResults.exit,\n\t\t\t\tstats: allClosedEditorResults.stats,\n\t\t\t};\n\t\t\tthis.logService.trace(`whole search time | ${searchLength}ms`);\n\t\t\treturn resolvedResult;\n\t\t};\n\t\treturn {\n\t\t\tasyncResults: getAsyncResults(),\n\t\t\tsyncResults\n\t\t};\n\t}\n\n\tsearch(query: ITextQuery, onProgress?: (result: ISearchProgressItem) => void, callerToken?: CancellationToken): {\n\t\tasyncResults: Promise<ISearchComplete>;\n\t\tsyncResults: IFileMatch<URI>[];\n\t} {\n\t\tthis.cancelSearch(true);\n\n\t\tthis._searchQuery = query;\n\t\tif (!this.searchConfig.searchOnType) {\n\t\t\tthis.searchResult.clear();\n\t\t}\n\t\tconst searchInstanceID = Date.now().toString();\n\n\t\tthis._searchResult.query = this._searchQuery;\n\n\t\tconst progressEmitter = new Emitter<void>();\n\t\tthis._replacePattern = new ReplacePattern(this.replaceString, this._searchQuery.contentPattern);\n\n\t\t// In search on type case, delay the streaming of results just a bit, so that we don't flash the only \"local results\" fast path\n\t\tthis._startStreamDelay = new Promise(resolve => setTimeout(resolve, this.searchConfig.searchOnType ? 150 : 0));\n\n\t\tconst req = this.doSearch(query, progressEmitter, this._searchQuery, searchInstanceID, onProgress, callerToken);\n\t\tconst asyncResults = req.asyncResults;\n\t\tconst syncResults = req.syncResults;\n\n\t\tif (onProgress) {\n\t\t\tsyncResults.forEach(p => {\n\t\t\t\tif (p) {\n\t\t\t\t\tonProgress(p);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst start = Date.now();\n\n\t\tPromise.race([asyncResults, Event.toPromise(progressEmitter.event)]).finally(() => {\n\t\t\t/* __GDPR__\n\t\t\t\t\"searchResultsFirstRender\" : {\n\t\t\t\t\t\"owner\": \"roblourens\",\n\t\t\t\t\t\"duration\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true }\n\t\t\t\t}\n\t\t\t*/\n\t\t\tthis.telemetryService.publicLog('searchResultsFirstRender', { duration: Date.now() - start });\n\t\t});\n\n\t\ttry {\n\t\t\treturn {\n\t\t\t\tasyncResults: asyncResults.then(\n\t\t\t\t\tvalue => {\n\t\t\t\t\t\tthis.onSearchCompleted(value, Date.now() - start, searchInstanceID);\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t},\n\t\t\t\t\te => {\n\t\t\t\t\t\tthis.onSearchError(e, Date.now() - start);\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}),\n\t\t\t\tsyncResults\n\t\t\t};\n\t\t} finally {\n\t\t\t/* __GDPR__\n\t\t\t\t\"searchResultsFinished\" : {\n\t\t\t\t\t\"owner\": \"roblourens\",\n\t\t\t\t\t\"duration\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true }\n\t\t\t\t}\n\t\t\t*/\n\t\t\tthis.telemetryService.publicLog('searchResultsFinished', { duration: Date.now() - start });\n\t\t}\n\t}\n\n\tprivate onSearchCompleted(completed: ISearchComplete | null, duration: number, searchInstanceID: string): ISearchComplete | null {\n\t\tif (!this._searchQuery) {\n\t\t\tthrow new Error('onSearchCompleted must be called after a search is started');\n\t\t}\n\n\t\tthis._searchResult.add(this._resultQueue, searchInstanceID);\n\t\tthis._resultQueue.length = 0;\n\n\t\tconst options: IPatternInfo = Object.assign({}, this._searchQuery.contentPattern);\n\t\tdelete (options as any).pattern;\n\n\t\tconst stats = completed && completed.stats as ITextSearchStats;\n\n\t\tconst fileSchemeOnly = this._searchQuery.folderQueries.every(fq => fq.folder.scheme === Schemas.file);\n\t\tconst otherSchemeOnly = this._searchQuery.folderQueries.every(fq => fq.folder.scheme !== Schemas.file);\n\t\tconst scheme = fileSchemeOnly ? Schemas.file :\n\t\t\totherSchemeOnly ? 'other' :\n\t\t\t\t'mixed';\n\n\t\t/* __GDPR__\n\t\t\t\"searchResultsShown\" : {\n\t\t\t\t\"owner\": \"roblourens\",\n\t\t\t\t\"count\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\t\t\"fileCount\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\t\t\"options\": { \"${inline}\": [ \"${IPatternInfo}\" ] },\n\t\t\t\t\"duration\": { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true },\n\t\t\t\t\"type\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" },\n\t\t\t\t\"scheme\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" },\n\t\t\t\t\"searchOnTypeEnabled\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\t\t\t}\n\t\t*/\n\t\tthis.telemetryService.publicLog('searchResultsShown', {\n\t\t\tcount: this._searchResult.count(),\n\t\t\tfileCount: this._searchResult.fileCount(),\n\t\t\toptions,\n\t\t\tduration,\n\t\t\ttype: stats && stats.type,\n\t\t\tscheme,\n\t\t\tsearchOnTypeEnabled: this.searchConfig.searchOnType\n\t\t});\n\t\treturn completed;\n\t}\n\n\tprivate onSearchError(e: any, duration: number): void {\n\t\tif (errors.isCancellationError(e)) {\n\t\t\tthis.onSearchCompleted(\n\t\t\t\tthis.searchCancelledForNewSearch\n\t\t\t\t\t? { exit: SearchCompletionExitCode.NewSearchStarted, results: [], messages: [] }\n\t\t\t\t\t: null,\n\t\t\t\tduration, '');\n\t\t\tthis.searchCancelledForNewSearch = false;\n\t\t}\n\t}\n\n\tprivate onSearchProgress(p: ISearchProgressItem, searchInstanceID: string, sync = true) {\n\t\tif ((<IFileMatch>p).resource) {\n\t\t\tthis._resultQueue.push(<IFileMatch>p);\n\t\t\tif (sync) {\n\t\t\t\tif (this._resultQueue.length) {\n\t\t\t\t\tthis._searchResult.add(this._resultQueue, searchInstanceID, true);\n\t\t\t\t\tthis._resultQueue.length = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._startStreamDelay.then(() => {\n\t\t\t\t\tif (this._resultQueue.length) {\n\t\t\t\t\t\tthis._searchResult.add(this._resultQueue, searchInstanceID, true);\n\t\t\t\t\t\tthis._resultQueue.length = 0;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t}\n\n\tprivate get searchConfig() {\n\t\treturn this.configurationService.getValue<ISearchConfigurationProperties>('search');\n\t}\n\n\tcancelSearch(cancelledForNewSearch = false): boolean {\n\t\tif (this.currentCancelTokenSource) {\n\t\t\tthis.searchCancelledForNewSearch = cancelledForNewSearch;\n\t\t\tthis.currentCancelTokenSource.cancel();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\toverride dispose(): void {\n\t\tthis.cancelSearch();\n\t\tthis.searchResult.dispose();\n\t\tsuper.dispose();\n\t}\n\n\ttransferSearchResult(other: SearchModel): void {\n\t\tother.searchResult = this._searchResult;\n\t\tthis._searchResult = this.instantiationService.createInstance(SearchResult, this);\n\t}\n}\n\nexport type FileMatchOrMatch = FileMatch | Match;\n\nexport type RenderableMatch = FolderMatch | FolderMatchWithResource | FileMatch | Match;\n\nexport class SearchViewModelWorkbenchService implements ISearchViewModelWorkbenchService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\tprivate _searchModel: SearchModel | null = null;\n\n\tconstructor(@IInstantiationService private readonly instantiationService: IInstantiationService) {\n\t}\n\n\tget searchModel(): SearchModel {\n\t\tif (!this._searchModel) {\n\t\t\tthis._searchModel = this.instantiationService.createInstance(SearchModel);\n\t\t}\n\t\treturn this._searchModel;\n\t}\n}\n\nexport const ISearchViewModelWorkbenchService = createDecorator<ISearchViewModelWorkbenchService>('searchViewModelWorkbenchService');\n\nexport interface ISearchViewModelWorkbenchService {\n\treadonly _serviceBrand: undefined;\n\n\treadonly searchModel: SearchModel;\n}\n\n/**\n * Can add a range highlight decoration to a model.\n * It will automatically remove it when the model has its decorations changed.\n */\nexport class RangeHighlightDecorations implements IDisposable {\n\n\tprivate _decorationId: string | null = null;\n\tprivate _model: ITextModel | null = null;\n\tprivate readonly _modelDisposables = new DisposableStore();\n\n\tconstructor(\n\t\t@IModelService private readonly _modelService: IModelService\n\t) {\n\t}\n\n\tremoveHighlightRange() {\n\t\tif (this._model && this._decorationId) {\n\t\t\tconst decorationId = this._decorationId;\n\t\t\tthis._model.changeDecorations((accessor) => {\n\t\t\t\taccessor.removeDecoration(decorationId);\n\t\t\t});\n\t\t}\n\t\tthis._decorationId = null;\n\t}\n\n\thighlightRange(resource: URI | ITextModel, range: Range, ownerId: number = 0): void {\n\t\tlet model: ITextModel | null;\n\t\tif (URI.isUri(resource)) {\n\t\t\tmodel = this._modelService.getModel(resource);\n\t\t} else {\n\t\t\tmodel = resource;\n\t\t}\n\n\t\tif (model) {\n\t\t\tthis.doHighlightRange(model, range);\n\t\t}\n\t}\n\n\tprivate doHighlightRange(model: ITextModel, range: Range) {\n\t\tthis.removeHighlightRange();\n\t\tmodel.changeDecorations((accessor) => {\n\t\t\tthis._decorationId = accessor.addDecoration(range, RangeHighlightDecorations._RANGE_HIGHLIGHT_DECORATION);\n\t\t});\n\t\tthis.setModel(model);\n\t}\n\n\tprivate setModel(model: ITextModel) {\n\t\tif (this._model !== model) {\n\t\t\tthis.clearModelListeners();\n\t\t\tthis._model = model;\n\t\t\tthis._modelDisposables.add(this._model.onDidChangeDecorations((e) => {\n\t\t\t\tthis.clearModelListeners();\n\t\t\t\tthis.removeHighlightRange();\n\t\t\t\tthis._model = null;\n\t\t\t}));\n\t\t\tthis._modelDisposables.add(this._model.onWillDispose(() => {\n\t\t\t\tthis.clearModelListeners();\n\t\t\t\tthis.removeHighlightRange();\n\t\t\t\tthis._model = null;\n\t\t\t}));\n\t\t}\n\t}\n\n\tprivate clearModelListeners() {\n\t\tthis._modelDisposables.clear();\n\t}\n\n\tdispose() {\n\t\tif (this._model) {\n\t\t\tthis.removeHighlightRange();\n\t\t\tthis._modelDisposables.dispose();\n\t\t\tthis._model = null;\n\t\t}\n\t}\n\n\tprivate static readonly _RANGE_HIGHLIGHT_DECORATION = ModelDecorationOptions.register({\n\t\tdescription: 'search-range-highlight',\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tclassName: 'rangeHighlight',\n\t\tisWholeLine: true\n\t});\n}\n\n\n\nfunction textSearchResultToMatches(rawMatch: ITextSearchMatch, fileMatch: FileMatch): Match[] {\n\tconst previewLines = rawMatch.preview.text.split('\\n');\n\tif (Array.isArray(rawMatch.ranges)) {\n\t\treturn rawMatch.ranges.map((r, i) => {\n\t\t\tconst previewRange: ISearchRange = (<ISearchRange[]>rawMatch.preview.matches)[i];\n\t\t\treturn new Match(fileMatch, previewLines, previewRange, r);\n\t\t});\n\t} else {\n\t\tconst previewRange = <ISearchRange>rawMatch.preview.matches;\n\t\tconst match = new Match(fileMatch, previewLines, previewRange, rawMatch.ranges);\n\t\treturn [match];\n\t}\n}\n\n// text search to notebook matches\n\nexport function textSearchMatchesToNotebookMatches(textSearchMatches: ITextSearchMatch[], cell: CellMatch): MatchInNotebook[] {\n\tconst notebookMatches: MatchInNotebook[] = [];\n\ttextSearchMatches.map((textSearchMatch) => {\n\t\tconst previewLines = textSearchMatch.preview.text.split('\\n');\n\t\tif (Array.isArray(textSearchMatch.ranges)) {\n\t\t\ttextSearchMatch.ranges.forEach((r, i) => {\n\t\t\t\tconst previewRange: ISearchRange = (<ISearchRange[]>textSearchMatch.preview.matches)[i];\n\t\t\t\tconst match = new MatchInNotebook(cell, previewLines, previewRange, r, textSearchMatch.webviewIndex);\n\t\t\t\tnotebookMatches.push(match);\n\t\t\t});\n\t\t} else {\n\t\t\tconst previewRange = <ISearchRange>textSearchMatch.preview.matches;\n\t\t\tconst match = new MatchInNotebook(cell, previewLines, previewRange, textSearchMatch.ranges, textSearchMatch.webviewIndex);\n\t\t\tnotebookMatches.push(match);\n\t\t}\n\t});\n\treturn notebookMatches;\n}\n\nexport function arrayContainsElementOrParent(element: RenderableMatch, testArray: RenderableMatch[]): boolean {\n\tdo {\n\t\tif (testArray.includes(element)) {\n\t\t\treturn true;\n\t\t}\n\t} while (!(element.parent() instanceof SearchResult) && (element = <RenderableMatch>element.parent()));\n\n\treturn false;\n}\n\nfunction getFileMatches(matches: (FileMatch | FolderMatchWithResource)[]): FileMatch[] {\n\n\tconst folderMatches: FolderMatchWithResource[] = [];\n\tconst fileMatches: FileMatch[] = [];\n\tmatches.forEach((e) => {\n\t\tif (e instanceof FileMatch) {\n\t\t\tfileMatches.push(e);\n\t\t} else {\n\t\t\tfolderMatches.push(e);\n\t\t}\n\t});\n\n\treturn fileMatches.concat(folderMatches.map(e => e.allDownstreamFileMatches()).flat());\n}\n\n\n\nfunction mergeSearchResultEvents(events: IChangeEvent[]): IChangeEvent {\n\tconst retEvent: IChangeEvent = {\n\t\telements: [],\n\t\tadded: false,\n\t\tremoved: false,\n\t};\n\tevents.forEach((e) => {\n\t\tif (e.added) {\n\t\t\tretEvent.added = true;\n\t\t}\n\n\t\tif (e.removed) {\n\t\t\tretEvent.removed = true;\n\t\t}\n\n\t\tretEvent.elements = retEvent.elements.concat(e.elements);\n\t});\n\n\treturn retEvent;\n}\n"]}