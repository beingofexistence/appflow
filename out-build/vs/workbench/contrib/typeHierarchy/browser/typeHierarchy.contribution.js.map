{"version":3,"sources":["vs/workbench/contrib/typeHierarchy/browser/typeHierarchy.contribution.ts"],"names":[],"mappings":"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","file":"typeHierarchy.contribution.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { Codicon } from 'vs/base/common/codicons';\nimport { isCancellationError } from 'vs/base/common/errors';\nimport { Event } from 'vs/base/common/event';\nimport { KeyCode, KeyMod } from 'vs/base/common/keyCodes';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { EditorAction2, EditorContributionInstantiation, registerEditorContribution, ServicesAccessor } from 'vs/editor/browser/editorExtensions';\nimport { ICodeEditorService } from 'vs/editor/browser/services/codeEditorService';\nimport { Position } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\nimport { IEditorContribution } from 'vs/editor/common/editorCommon';\nimport { PeekContext } from 'vs/editor/contrib/peekView/browser/peekView';\nimport { localize } from 'vs/nls';\nimport { MenuId, registerAction2 } from 'vs/platform/actions/common/actions';\nimport { ContextKeyExpr, IContextKey, IContextKeyService, RawContextKey } from 'vs/platform/contextkey/common/contextkey';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { KeybindingWeight } from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport { IStorageService, StorageScope, StorageTarget } from 'vs/platform/storage/common/storage';\nimport { TypeHierarchyTreePeekWidget } from 'vs/workbench/contrib/typeHierarchy/browser/typeHierarchyPeek';\nimport { TypeHierarchyDirection, TypeHierarchyModel, TypeHierarchyProviderRegistry } from 'vs/workbench/contrib/typeHierarchy/common/typeHierarchy';\n\n\nconst _ctxHasTypeHierarchyProvider = new RawContextKey<boolean>('editorHasTypeHierarchyProvider', false, localize('editorHasTypeHierarchyProvider', 'Whether a type hierarchy provider is available'));\nconst _ctxTypeHierarchyVisible = new RawContextKey<boolean>('typeHierarchyVisible', false, localize('typeHierarchyVisible', 'Whether type hierarchy peek is currently showing'));\nconst _ctxTypeHierarchyDirection = new RawContextKey<string>('typeHierarchyDirection', undefined, { type: 'string', description: localize('typeHierarchyDirection', 'whether type hierarchy shows super types or subtypes') });\n\nfunction sanitizedDirection(candidate: string): TypeHierarchyDirection {\n\treturn candidate === TypeHierarchyDirection.Subtypes || candidate === TypeHierarchyDirection.Supertypes\n\t\t? candidate\n\t\t: TypeHierarchyDirection.Subtypes;\n}\n\nclass TypeHierarchyController implements IEditorContribution {\n\tstatic readonly Id = 'typeHierarchy';\n\n\tstatic get(editor: ICodeEditor): TypeHierarchyController | null {\n\t\treturn editor.getContribution<TypeHierarchyController>(TypeHierarchyController.Id);\n\t}\n\n\tprivate static readonly _storageDirectionKey = 'typeHierarchy/defaultDirection';\n\n\tprivate readonly _ctxHasProvider: IContextKey<boolean>;\n\tprivate readonly _ctxIsVisible: IContextKey<boolean>;\n\tprivate readonly _ctxDirection: IContextKey<string>;\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate readonly _sessionDisposables = new DisposableStore();\n\n\tprivate _widget?: TypeHierarchyTreePeekWidget;\n\n\tconstructor(\n\t\treadonly _editor: ICodeEditor,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@ICodeEditorService private readonly _editorService: ICodeEditorService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tthis._ctxHasProvider = _ctxHasTypeHierarchyProvider.bindTo(this._contextKeyService);\n\t\tthis._ctxIsVisible = _ctxTypeHierarchyVisible.bindTo(this._contextKeyService);\n\t\tthis._ctxDirection = _ctxTypeHierarchyDirection.bindTo(this._contextKeyService);\n\t\tthis._disposables.add(Event.any<any>(_editor.onDidChangeModel, _editor.onDidChangeModelLanguage, TypeHierarchyProviderRegistry.onDidChange)(() => {\n\t\t\tthis._ctxHasProvider.set(_editor.hasModel() && TypeHierarchyProviderRegistry.has(_editor.getModel()));\n\t\t}));\n\t\tthis._disposables.add(this._sessionDisposables);\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t}\n\n\t// Peek\n\tasync startTypeHierarchyFromEditor(): Promise<void> {\n\t\tthis._sessionDisposables.clear();\n\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst document = this._editor.getModel();\n\t\tconst position = this._editor.getPosition();\n\t\tif (!TypeHierarchyProviderRegistry.has(document)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cts = new CancellationTokenSource();\n\t\tconst model = TypeHierarchyModel.create(document, position, cts.token);\n\t\tconst direction = sanitizedDirection(this._storageService.get(TypeHierarchyController._storageDirectionKey, StorageScope.PROFILE, TypeHierarchyDirection.Subtypes));\n\n\t\tthis._showTypeHierarchyWidget(position, direction, model, cts);\n\t}\n\n\tprivate _showTypeHierarchyWidget(position: Position, direction: TypeHierarchyDirection, model: Promise<TypeHierarchyModel | undefined>, cts: CancellationTokenSource) {\n\n\t\tthis._ctxIsVisible.set(true);\n\t\tthis._ctxDirection.set(direction);\n\t\tEvent.any<any>(this._editor.onDidChangeModel, this._editor.onDidChangeModelLanguage)(this.endTypeHierarchy, this, this._sessionDisposables);\n\t\tthis._widget = this._instantiationService.createInstance(TypeHierarchyTreePeekWidget, this._editor, position, direction);\n\t\tthis._widget.showLoading();\n\t\tthis._sessionDisposables.add(this._widget.onDidClose(() => {\n\t\t\tthis.endTypeHierarchy();\n\t\t\tthis._storageService.store(TypeHierarchyController._storageDirectionKey, this._widget!.direction, StorageScope.PROFILE, StorageTarget.USER);\n\t\t}));\n\t\tthis._sessionDisposables.add({ dispose() { cts.dispose(true); } });\n\t\tthis._sessionDisposables.add(this._widget);\n\n\t\tmodel.then(model => {\n\t\t\tif (cts.token.isCancellationRequested) {\n\t\t\t\treturn; // nothing\n\t\t\t}\n\t\t\tif (model) {\n\t\t\t\tthis._sessionDisposables.add(model);\n\t\t\t\tthis._widget!.showModel(model);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._widget!.showMessage(localize('no.item', \"No results\"));\n\t\t\t}\n\t\t}).catch(err => {\n\t\t\tif (isCancellationError(err)) {\n\t\t\t\tthis.endTypeHierarchy();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._widget!.showMessage(localize('error', \"Failed to show type hierarchy\"));\n\t\t});\n\t}\n\n\tasync startTypeHierarchyFromTypeHierarchy(): Promise<void> {\n\t\tif (!this._widget) {\n\t\t\treturn;\n\t\t}\n\t\tconst model = this._widget.getModel();\n\t\tconst typeItem = this._widget.getFocused();\n\t\tif (!typeItem || !model) {\n\t\t\treturn;\n\t\t}\n\t\tconst newEditor = await this._editorService.openCodeEditor({ resource: typeItem.item.uri }, this._editor);\n\t\tif (!newEditor) {\n\t\t\treturn;\n\t\t}\n\t\tconst newModel = model.fork(typeItem.item);\n\t\tthis._sessionDisposables.clear();\n\n\t\tTypeHierarchyController.get(newEditor)?._showTypeHierarchyWidget(\n\t\t\tRange.lift(newModel.root.selectionRange).getStartPosition(),\n\t\t\tthis._widget.direction,\n\t\t\tPromise.resolve(newModel),\n\t\t\tnew CancellationTokenSource()\n\t\t);\n\t}\n\n\tshowSupertypes(): void {\n\t\tthis._widget?.updateDirection(TypeHierarchyDirection.Supertypes);\n\t\tthis._ctxDirection.set(TypeHierarchyDirection.Supertypes);\n\t}\n\n\tshowSubtypes(): void {\n\t\tthis._widget?.updateDirection(TypeHierarchyDirection.Subtypes);\n\t\tthis._ctxDirection.set(TypeHierarchyDirection.Subtypes);\n\t}\n\n\tendTypeHierarchy(): void {\n\t\tthis._sessionDisposables.clear();\n\t\tthis._ctxIsVisible.set(false);\n\t\tthis._editor.focus();\n\t}\n}\n\nregisterEditorContribution(TypeHierarchyController.Id, TypeHierarchyController, EditorContributionInstantiation.Eager); // eager because it needs to define a context key\n\n// Peek\nregisterAction2(class PeekTypeHierarchyAction extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.showTypeHierarchy',\n\t\t\ttitle: { value: localize('title', \"Peek Type Hierarchy\"), original: 'Peek Type Hierarchy' },\n\t\t\tmenu: {\n\t\t\t\tid: MenuId.EditorContextPeek,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\torder: 1000,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t_ctxHasTypeHierarchyProvider,\n\t\t\t\t\tPeekContext.notInPeekEditor\n\t\t\t\t),\n\t\t\t},\n\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\t_ctxHasTypeHierarchyProvider,\n\t\t\t\tPeekContext.notInPeekEditor\n\t\t\t),\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync runEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor): Promise<void> {\n\t\treturn TypeHierarchyController.get(editor)?.startTypeHierarchyFromEditor();\n\t}\n});\n\n// actions for peek widget\nregisterAction2(class extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.showSupertypes',\n\t\t\ttitle: { value: localize('title.supertypes', \"Show Supertypes\"), original: 'Show Supertypes' },\n\t\t\ticon: Codicon.typeHierarchySuper,\n\t\t\tprecondition: ContextKeyExpr.and(_ctxTypeHierarchyVisible, _ctxTypeHierarchyDirection.isEqualTo(TypeHierarchyDirection.Subtypes)),\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.Shift + KeyMod.Alt + KeyCode.KeyH,\n\t\t\t},\n\t\t\tmenu: {\n\t\t\t\tid: TypeHierarchyTreePeekWidget.TitleMenu,\n\t\t\t\twhen: _ctxTypeHierarchyDirection.isEqualTo(TypeHierarchyDirection.Subtypes),\n\t\t\t\torder: 1,\n\t\t\t}\n\t\t});\n\t}\n\n\trunEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor) {\n\t\treturn TypeHierarchyController.get(editor)?.showSupertypes();\n\t}\n});\n\nregisterAction2(class extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.showSubtypes',\n\t\t\ttitle: { value: localize('title.subtypes', \"Show Subtypes\"), original: 'Show Subtypes' },\n\t\t\ticon: Codicon.typeHierarchySub,\n\t\t\tprecondition: ContextKeyExpr.and(_ctxTypeHierarchyVisible, _ctxTypeHierarchyDirection.isEqualTo(TypeHierarchyDirection.Supertypes)),\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.Shift + KeyMod.Alt + KeyCode.KeyH,\n\t\t\t},\n\t\t\tmenu: {\n\t\t\t\tid: TypeHierarchyTreePeekWidget.TitleMenu,\n\t\t\t\twhen: _ctxTypeHierarchyDirection.isEqualTo(TypeHierarchyDirection.Supertypes),\n\t\t\t\torder: 1,\n\t\t\t}\n\t\t});\n\t}\n\n\trunEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor) {\n\t\treturn TypeHierarchyController.get(editor)?.showSubtypes();\n\t}\n});\n\nregisterAction2(class extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.refocusTypeHierarchy',\n\t\t\ttitle: { value: localize('title.refocusTypeHierarchy', \"Refocus Type Hierarchy\"), original: 'Refocus Type Hierarchy' },\n\t\t\tprecondition: _ctxTypeHierarchyVisible,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.Shift + KeyCode.Enter\n\t\t\t}\n\t\t});\n\t}\n\n\tasync runEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor): Promise<void> {\n\t\treturn TypeHierarchyController.get(editor)?.startTypeHierarchyFromTypeHierarchy();\n\t}\n});\n\nregisterAction2(class extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.closeTypeHierarchy',\n\t\t\ttitle: localize('close', 'Close'),\n\t\t\ticon: Codicon.close,\n\t\t\tprecondition: _ctxTypeHierarchyVisible,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib + 10,\n\t\t\t\tprimary: KeyCode.Escape,\n\t\t\t\twhen: ContextKeyExpr.not('config.editor.stablePeek')\n\t\t\t},\n\t\t\tmenu: {\n\t\t\t\tid: TypeHierarchyTreePeekWidget.TitleMenu,\n\t\t\t\torder: 1000\n\t\t\t}\n\t\t});\n\t}\n\n\trunEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor): void {\n\t\treturn TypeHierarchyController.get(editor)?.endTypeHierarchy();\n\t}\n});\n"]}