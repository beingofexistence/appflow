{"version":3,"sources":["vs/workbench/contrib/callHierarchy/browser/callHierarchy.contribution.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IA0BhG,MAAM,4BAA4B,GAAG,IAAI,gBAAG,CAAoB,gCAAgC,EAAE,KAAK,EAAE,IAAA,cAAQ,EAAC,CAAgC,EAAE,IAAgD,CAAC,CAAC,CAAC;IACvM,MAAM,wBAAwB,GAAG,IAAI,gBAAG,CAAoB,sBAAsB,EAAE,KAAK,EAAE,IAAA,cAAQ,EAAC,CAAsB,EAAE,IAAkD,CAAC,CAAC,CAAC;IACjL,MAAM,0BAA0B,GAAG,IAAI,gBAAG,CAAmB,wBAAwB,EAAE,SAAS,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,WAAW,EAAE,IAAA,cAAQ,EAAC,CAAwB,EAAE,IAAyD,CAAC,EAAE,CAAC,CAAC;IAElO,SAAS,kBAAkB,CAAC,SAAiB;QAC5C,OAAO,SAAS,2DAAqC,IAAI,SAAS,yDAAmC;YACpG,CAAC,CAAC,SAAS;YACX,CAAC,qDAA+B,CAAC;IACnC,CAAC;IAED,IAAM,uBAAuB,GAA7B,MAAM,uBAAuB;;iBAEZ,OAAE,GAAG,eAAH,AAAkB,CAAC;QAErC,MAAM,CAAC,GAAG,CAAC,MAAmB;YAC7B,OAAO,MAAM,CAAC,eAAe,CAA0B,yBAAuB,CAAC,EAAE,CAAC,CAAC;QACpF,CAAC;iBAEuB,MAAC,GAAmB,gCAAnB,AAAmD,CAAC;QAU7E,YACkB,CAAoB,EACjB,CAAwC,EAC3C,CAAqC,EAClC,CAAoC,EACjC,CAA2C;YAJjD,MAAC,GAAD,CAAC,CAAmB;YACA,MAAC,GAAD,CAAC,CAAsB;YAC1B,MAAC,GAAD,CAAC,CAAmB;YACjB,MAAC,GAAD,CAAC,CAAkB;YAChB,MAAC,GAAD,CAAC,CAAyB;YAVlD,MAAC,GAAa,IAAI,eAAG,EAAc,CAAC;YACpC,MAAC,GAAqB,IAAI,eAAG,EAAc,CAAC;YAW5D,IAAI,CAAC,CAAC,GAAe,wBAAwB,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAkB,CAAC;YAC9E,IAAI,CAAC,CAAC,GAAiB,4BAA4B,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAkB,CAAC;YACpF,IAAI,CAAC,CAAC,GAAe,0BAA0B,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAkB,CAAC;YAChF,IAAI,CAAC,CAAC,CAAW,GAAG,CAAC,aAAK,CAAC,GAAG,CAAM,CAAC,CAAO,gBAAgB,EAAE,CAAC,CAAO,wBAAwB,EAAE,mBAAG,CAA2B,WAAW,CAAC,CAAC,GAAG,EAAE;gBAC/I,IAAI,CAAC,CAAC,CAAe,GAAG,CAAC,CAAC,CAAO,QAAQ,EAAE,IAAI,mBAAG,CAA2B,GAAG,CAAC,CAAC,CAAO,QAAQ,EAAE,CAAC,CAAC,CAAC;YACvG,CAAC,CAAC,CAAC,CAAC;YACJ,IAAI,CAAC,CAAC,CAAW,GAAG,CAAC,IAAI,CAAC,CAAC,CAAmB,CAAC;QAChD,CAAC;QAED,OAAO;YACN,IAAI,CAAC,CAAC,CAAe,KAAK,EAAE,CAAC;YAC7B,IAAI,CAAC,CAAC,CAAa,KAAK,EAAE,CAAC;YAC3B,IAAI,CAAC,CAAC,CAAW,OAAO,EAAE,CAAC;QAC5B,CAAC;QAED,KAAK,CAAC,4BAA4B;YACjC,IAAI,CAAC,CAAC,CAAmB,KAAK,EAAE,CAAC;YAEjC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAO,QAAQ,EAAE,EAAE;gBAC7B,OAAO;aACP;YAED,MAAM,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAO,QAAQ,EAAE,CAAC;YACzC,MAAM,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAO,WAAW,EAAE,CAAC;YAC5C,IAAI,CAAC,mBAAG,CAA2B,GAAG,CAAC,QAAQ,CAAC,EAAE;gBACjD,OAAO;aACP;YAED,MAAM,GAAG,GAAG,IAAI,kBAAG,EAAsB,CAAC;YAC1C,MAAM,KAAK,GAAG,mBAAG,CAAgB,MAAM,CAAC,QAAQ,EAAE,QAAQ,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC;YACvE,MAAM,SAAS,GAAG,kBAAkB,CAAC,IAAI,CAAC,CAAC,CAAe,GAAG,CAAC,yBAAuB,CAAC,CAAC,qFAAuE,CAAC,CAAC;YAEhK,IAAI,CAAC,CAAC,CAAwB,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC;QAChE,CAAC;QAED,KAAK,CAAC,mCAAmC;YACxC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAQ;gBAClB,OAAO;aACP;YACD,MAAM,KAAK,GAAG,IAAI,CAAC,CAAC,CAAO,QAAQ,EAAE,CAAC;YACtC,MAAM,IAAI,GAAG,IAAI,CAAC,CAAC,CAAO,UAAU,EAAE,CAAC;YACvC,IAAI,CAAC,IAAI,IAAI,CAAC,KAAK,EAAE;gBACpB,OAAO;aACP;YACD,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,CAAC,CAAc,cAAc,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,EAAE,IAAI,CAAC,CAAC,CAAO,CAAC;YACtG,IAAI,CAAC,SAAS,EAAE;gBACf,OAAO;aACP;YACD,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACvC,IAAI,CAAC,CAAC,CAAmB,KAAK,EAAE,CAAC;YAEjC,yBAAuB,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,CAAC,CACxC,WAAG,CAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,gBAAgB,EAAE,EAC3D,IAAI,CAAC,CAAC,CAAO,SAAS,EACtB,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,EACzB,IAAI,kBAAG,EAAsB,CAC7B,CAAC;QACH,CAAC;QAEO,CAAC,CAAwB,QAAmB,EAAE,SAAiC,EAAE,KAA8C,EAAE,GAAQ;YAEhJ,IAAI,CAAC,CAAC,CAAa,GAAG,CAAC,IAAI,CAAC,CAAC;YAC7B,IAAI,CAAC,CAAC,CAAa,GAAG,CAAC,SAAS,CAAC,CAAC;YAClC,aAAK,CAAC,GAAG,CAAM,IAAI,CAAC,CAAC,CAAO,gBAAgB,EAAE,IAAI,CAAC,CAAC,CAAO,wBAAwB,CAAC,CAAC,IAAI,CAAC,gBAAgB,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAmB,CAAC;YAC5I,IAAI,CAAC,CAAC,GAAS,IAAI,CAAC,CAAC,CAAqB,cAAc,CAAC,wBAAI,EAAyB,IAAI,CAAC,CAAC,EAAQ,QAAQ,EAAE,SAAS,CAAC,CAAC;YACzH,IAAI,CAAC,CAAC,CAAO,WAAW,EAAE,CAAC;YAC3B,IAAI,CAAC,CAAC,CAAmB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAO,UAAU,CAAC,GAAG,EAAE;gBACzD,IAAI,CAAC,gBAAgB,EAAE,CAAC;gBACxB,IAAI,CAAC,CAAC,CAAe,KAAK,CAAC,yBAAuB,CAAC,CAAC,EAAkB,IAAI,CAAC,CAAQ,CAAC,SAAS,2DAA2C,CAAC;YAC1I,CAAC,CAAC,CAAC,CAAC;YACJ,IAAI,CAAC,CAAC,CAAmB,GAAG,CAAC,EAAE,OAAO,KAAK,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YACnE,IAAI,CAAC,CAAC,CAAmB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAO,CAAC;YAE3C,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;gBAClB,IAAI,GAAG,CAAC,KAAK,CAAC,uBAAuB,EAAE;oBACtC,OAAO,CAAC,UAAU;iBAClB;gBACD,IAAI,KAAK,EAAE;oBACV,IAAI,CAAC,CAAC,CAAmB,GAAG,CAAC,KAAK,CAAC,CAAC;oBACpC,IAAI,CAAC,CAAQ,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;iBAC/B;qBACI;oBACJ,IAAI,CAAC,CAAQ,CAAC,WAAW,CAAC,IAAA,cAAQ,EAAC,CAAS,EAAE,IAAY,CAAC,CAAC,CAAC;iBAC7D;YACF,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE;gBACd,IAAI,IAAA,WAAE,EAAkB,GAAG,CAAC,EAAE;oBAC7B,IAAI,CAAC,gBAAgB,EAAE,CAAC;oBACxB,OAAO;iBACP;gBACD,IAAI,CAAC,CAAQ,CAAC,WAAW,CAAC,IAAA,cAAQ,EAAC,CAAO,EAAE,IAA+B,CAAC,CAAC,CAAC;YAC/E,CAAC,CAAC,CAAC;QACJ,CAAC;QAED,iBAAiB;YAChB,IAAI,CAAC,CAAC,EAAQ,eAAe,wDAAkC,CAAC;YAChE,IAAI,CAAC,CAAC,CAAa,GAAG,wDAAkC,CAAC;QAC1D,CAAC;QAED,iBAAiB;YAChB,IAAI,CAAC,CAAC,EAAQ,eAAe,sDAAgC,CAAC;YAC9D,IAAI,CAAC,CAAC,CAAa,GAAG,sDAAgC,CAAC;QACxD,CAAC;QAED,gBAAgB;YACf,IAAI,CAAC,CAAC,CAAmB,KAAK,EAAE,CAAC;YACjC,IAAI,CAAC,CAAC,CAAa,GAAG,CAAC,KAAK,CAAC,CAAC;YAC9B,IAAI,CAAC,CAAC,CAAO,KAAK,EAAE,CAAC;QACtB,CAAC;;IApII,uBAAuB;QAoB1B,WAAA,gBAAG,CAAA;QACH,WAAA,aAAG,CAAA;QACH,WAAA,uBAAG,CAAA;QACH,WAAA,mBAAG,CAAA;OAvBA,uBAAuB,CAqI5B;IAED,IAAA,sBAAG,EAAwB,uBAAuB,CAAC,EAAE,EAAE,uBAAuB,gDAAwC,CAAC,CAAC,iDAAiD;IAEzK,IAAA,aAAG,EAAa,MAAM,uBAAwB,SAAQ,sBAAG;QAExD;YACC,KAAK,CAAC;gBACL,EAAE,EAAE,0BAA0B;gBAC9B,KAAK,EAAE,EAAE,KAAK,EAAE,IAAA,cAAQ,EAAC,CAAO,EAAE,IAAqB,CAAC,EAAE,QAAQ,EAAE,qBAAqB,EAAE;gBAC3F,IAAI,EAAE;oBACL,EAAE,EAAE,aAAG,CAAI,iBAAiB;oBAC5B,KAAK,EAAE,YAAY;oBACnB,KAAK,EAAE,IAAI;oBACX,IAAI,EAAE,gBAAG,CAAY,GAAG,CACvB,4BAA4B,EAC5B,sBAAW,CAAC,eAAe,CAC3B;iBACD;gBACD,UAAU,EAAE;oBACX,IAAI,EAAE,qCAAiB,CAAC,eAAe;oBACvC,MAAM,6CAAmC;oBACzC,OAAO,EAAE,8CAAyB,wBAAe;iBACjD;gBACD,YAAY,EAAE,gBAAG,CAAY,GAAG,CAC/B,4BAA4B,EAC5B,sBAAW,CAAC,eAAe,CAC3B;gBACD,EAAE,EAAE,IAAI;aACR,CAAC,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,gBAAgB,CAAC,SAA2B,EAAE,MAAmB;YACtE,OAAO,uBAAuB,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,4BAA4B,EAAE,CAAC;QAC5E,CAAC;KACD,CAAC,CAAC;IAEH,IAAA,aAAG,EAAa,KAAM,SAAQ,sBAAG;QAEhC;YACC,KAAK,CAAC;gBACL,EAAE,EAAE,0BAA0B;gBAC9B,KAAK,EAAE,EAAE,KAAK,EAAE,IAAA,cAAQ,EAAC,CAAgB,EAAE,IAAqB,CAAC,EAAE,QAAQ,EAAE,qBAAqB,EAAE;gBACpG,IAAI,EAAE,IAAA,kBAAG,EAAU,wBAAwB,EAAE,cAAG,CAAK,YAAY,EAAE,IAAA,cAAQ,EAAC,CAAwB,EAAE,IAAqD,CAAC,CAAC;gBAC7J,YAAY,EAAE,gBAAG,CAAY,GAAG,CAAC,wBAAwB,EAAE,0BAA0B,CAAC,SAAS,wDAAkC,CAAC;gBAClI,UAAU,EAAE;oBACX,MAAM,6CAAmC;oBACzC,OAAO,EAAE,8CAAyB,wBAAe;iBACjD;gBACD,IAAI,EAAE;oBACL,EAAE,EAAE,wBAAI,CAAwB,SAAS;oBACzC,IAAI,EAAE,0BAA0B,CAAC,SAAS,wDAAkC;oBAC5E,KAAK,EAAE,CAAC;iBACR;aACD,CAAC,CAAC;QACJ,CAAC;QAED,gBAAgB,CAAC,SAA2B,EAAE,MAAmB;YAChE,OAAO,uBAAuB,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,iBAAiB,EAAE,CAAC;QACjE,CAAC;KACD,CAAC,CAAC;IAEH,IAAA,aAAG,EAAa,KAAM,SAAQ,sBAAG;QAEhC;YACC,KAAK,CAAC;gBACL,EAAE,EAAE,0BAA0B;gBAC9B,KAAK,EAAE,EAAE,KAAK,EAAE,IAAA,cAAQ,EAAC,CAAgB,EAAE,IAAqB,CAAC,EAAE,QAAQ,EAAE,qBAAqB,EAAE;gBACpG,IAAI,EAAE,IAAA,kBAAG,EAAU,wBAAwB,EAAE,cAAG,CAAK,YAAY,EAAE,IAAA,cAAQ,EAAC,CAAuB,EAAE,IAAqD,CAAC,CAAC;gBAC5J,YAAY,EAAE,gBAAG,CAAY,GAAG,CAAC,wBAAwB,EAAE,0BAA0B,CAAC,SAAS,sDAAgC,CAAC;gBAChI,UAAU,EAAE;oBACX,MAAM,6CAAmC;oBACzC,OAAO,EAAE,8CAAyB,wBAAe;iBACjD;gBACD,IAAI,EAAE;oBACL,EAAE,EAAE,wBAAI,CAAwB,SAAS;oBACzC,IAAI,EAAE,0BAA0B,CAAC,SAAS,sDAAgC;oBAC1E,KAAK,EAAE,CAAC;iBACR;aACD,CAAC,CAAC;QACJ,CAAC;QAED,gBAAgB,CAAC,SAA2B,EAAE,MAAmB;YAChE,OAAO,uBAAuB,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,iBAAiB,EAAE,CAAC;QACjE,CAAC;KACD,CAAC,CAAC;IAGH,IAAA,aAAG,EAAa,KAAM,SAAQ,sBAAG;QAEhC;YACC,KAAK,CAAC;gBACL,EAAE,EAAE,6BAA6B;gBACjC,KAAK,EAAE,EAAE,KAAK,EAAE,IAAA,cAAQ,EAAC,EAAe,EAAE,IAAwB,CAAC,EAAE,QAAQ,EAAE,wBAAwB,EAAE;gBACzG,YAAY,EAAE,wBAAwB;gBACtC,UAAU,EAAE;oBACX,MAAM,6CAAmC;oBACzC,OAAO,EAAE,+CAA4B;iBACrC;aACD,CAAC,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,gBAAgB,CAAC,SAA2B,EAAE,MAAmB;YACtE,OAAO,uBAAuB,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,mCAAmC,EAAE,CAAC;QACnF,CAAC;KACD,CAAC,CAAC;IAGH,IAAA,aAAG,EAAa,KAAM,SAAQ,sBAAG;QAEhC;YACC,KAAK,CAAC;gBACL,EAAE,EAAE,2BAA2B;gBAC/B,KAAK,EAAE,IAAA,cAAQ,EAAC,EAAO,EAAE,IAAO,CAAC;gBACjC,IAAI,EAAE,cAAG,CAAK,KAAK;gBACnB,YAAY,EAAE,wBAAwB;gBACtC,UAAU,EAAE;oBACX,MAAM,EAAE,8CAAoC,EAAE;oBAC9C,OAAO,wBAAgB;oBACvB,IAAI,EAAE,gBAAG,CAAY,GAAG,CAAC,0BAA0B,CAAC;iBACpD;gBACD,IAAI,EAAE;oBACL,EAAE,EAAE,wBAAI,CAAwB,SAAS;oBACzC,KAAK,EAAE,IAAI;iBACX;aACD,CAAC,CAAC;QACJ,CAAC;QAED,gBAAgB,CAAC,SAA2B,EAAE,MAAmB;YAChE,OAAO,uBAAuB,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,gBAAgB,EAAE,CAAC;QAChE,CAAC;KACD,CAAC,CAAC","file":"callHierarchy.contribution.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from 'vs/nls';\nimport { CallHierarchyProviderRegistry, CallHierarchyDirection, CallHierarchyModel } from 'vs/workbench/contrib/callHierarchy/common/callHierarchy';\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { IInstantiationService, ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { CallHierarchyTreePeekWidget } from 'vs/workbench/contrib/callHierarchy/browser/callHierarchyPeek';\nimport { Event } from 'vs/base/common/event';\nimport { registerEditorContribution, EditorAction2, EditorContributionInstantiation } from 'vs/editor/browser/editorExtensions';\nimport { IEditorContribution } from 'vs/editor/common/editorCommon';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { IContextKeyService, RawContextKey, IContextKey, ContextKeyExpr } from 'vs/platform/contextkey/common/contextkey';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { KeybindingWeight } from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport { KeyCode, KeyMod } from 'vs/base/common/keyCodes';\nimport { EditorContextKeys } from 'vs/editor/common/editorContextKeys';\nimport { PeekContext } from 'vs/editor/contrib/peekView/browser/peekView';\nimport { IStorageService, StorageScope, StorageTarget } from 'vs/platform/storage/common/storage';\nimport { ICodeEditorService } from 'vs/editor/browser/services/codeEditorService';\nimport { Range } from 'vs/editor/common/core/range';\nimport { IPosition } from 'vs/editor/common/core/position';\nimport { MenuId, registerAction2 } from 'vs/platform/actions/common/actions';\nimport { Codicon } from 'vs/base/common/codicons';\nimport { registerIcon } from 'vs/platform/theme/common/iconRegistry';\nimport { isCancellationError } from 'vs/base/common/errors';\n\nconst _ctxHasCallHierarchyProvider = new RawContextKey<boolean>('editorHasCallHierarchyProvider', false, localize('editorHasCallHierarchyProvider', 'Whether a call hierarchy provider is available'));\nconst _ctxCallHierarchyVisible = new RawContextKey<boolean>('callHierarchyVisible', false, localize('callHierarchyVisible', 'Whether call hierarchy peek is currently showing'));\nconst _ctxCallHierarchyDirection = new RawContextKey<string>('callHierarchyDirection', undefined, { type: 'string', description: localize('callHierarchyDirection', 'Whether call hierarchy shows incoming or outgoing calls') });\n\nfunction sanitizedDirection(candidate: string): CallHierarchyDirection {\n\treturn candidate === CallHierarchyDirection.CallsFrom || candidate === CallHierarchyDirection.CallsTo\n\t\t? candidate\n\t\t: CallHierarchyDirection.CallsTo;\n}\n\nclass CallHierarchyController implements IEditorContribution {\n\n\tstatic readonly Id = 'callHierarchy';\n\n\tstatic get(editor: ICodeEditor): CallHierarchyController | null {\n\t\treturn editor.getContribution<CallHierarchyController>(CallHierarchyController.Id);\n\t}\n\n\tprivate static readonly _StorageDirection = 'callHierarchy/defaultDirection';\n\n\tprivate readonly _ctxHasProvider: IContextKey<boolean>;\n\tprivate readonly _ctxIsVisible: IContextKey<boolean>;\n\tprivate readonly _ctxDirection: IContextKey<string>;\n\tprivate readonly _dispoables = new DisposableStore();\n\tprivate readonly _sessionDisposables = new DisposableStore();\n\n\tprivate _widget?: CallHierarchyTreePeekWidget;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@ICodeEditorService private readonly _editorService: ICodeEditorService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tthis._ctxIsVisible = _ctxCallHierarchyVisible.bindTo(this._contextKeyService);\n\t\tthis._ctxHasProvider = _ctxHasCallHierarchyProvider.bindTo(this._contextKeyService);\n\t\tthis._ctxDirection = _ctxCallHierarchyDirection.bindTo(this._contextKeyService);\n\t\tthis._dispoables.add(Event.any<any>(_editor.onDidChangeModel, _editor.onDidChangeModelLanguage, CallHierarchyProviderRegistry.onDidChange)(() => {\n\t\t\tthis._ctxHasProvider.set(_editor.hasModel() && CallHierarchyProviderRegistry.has(_editor.getModel()));\n\t\t}));\n\t\tthis._dispoables.add(this._sessionDisposables);\n\t}\n\n\tdispose(): void {\n\t\tthis._ctxHasProvider.reset();\n\t\tthis._ctxIsVisible.reset();\n\t\tthis._dispoables.dispose();\n\t}\n\n\tasync startCallHierarchyFromEditor(): Promise<void> {\n\t\tthis._sessionDisposables.clear();\n\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst document = this._editor.getModel();\n\t\tconst position = this._editor.getPosition();\n\t\tif (!CallHierarchyProviderRegistry.has(document)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cts = new CancellationTokenSource();\n\t\tconst model = CallHierarchyModel.create(document, position, cts.token);\n\t\tconst direction = sanitizedDirection(this._storageService.get(CallHierarchyController._StorageDirection, StorageScope.PROFILE, CallHierarchyDirection.CallsTo));\n\n\t\tthis._showCallHierarchyWidget(position, direction, model, cts);\n\t}\n\n\tasync startCallHierarchyFromCallHierarchy(): Promise<void> {\n\t\tif (!this._widget) {\n\t\t\treturn;\n\t\t}\n\t\tconst model = this._widget.getModel();\n\t\tconst call = this._widget.getFocused();\n\t\tif (!call || !model) {\n\t\t\treturn;\n\t\t}\n\t\tconst newEditor = await this._editorService.openCodeEditor({ resource: call.item.uri }, this._editor);\n\t\tif (!newEditor) {\n\t\t\treturn;\n\t\t}\n\t\tconst newModel = model.fork(call.item);\n\t\tthis._sessionDisposables.clear();\n\n\t\tCallHierarchyController.get(newEditor)?._showCallHierarchyWidget(\n\t\t\tRange.lift(newModel.root.selectionRange).getStartPosition(),\n\t\t\tthis._widget.direction,\n\t\t\tPromise.resolve(newModel),\n\t\t\tnew CancellationTokenSource()\n\t\t);\n\t}\n\n\tprivate _showCallHierarchyWidget(position: IPosition, direction: CallHierarchyDirection, model: Promise<CallHierarchyModel | undefined>, cts: CancellationTokenSource) {\n\n\t\tthis._ctxIsVisible.set(true);\n\t\tthis._ctxDirection.set(direction);\n\t\tEvent.any<any>(this._editor.onDidChangeModel, this._editor.onDidChangeModelLanguage)(this.endCallHierarchy, this, this._sessionDisposables);\n\t\tthis._widget = this._instantiationService.createInstance(CallHierarchyTreePeekWidget, this._editor, position, direction);\n\t\tthis._widget.showLoading();\n\t\tthis._sessionDisposables.add(this._widget.onDidClose(() => {\n\t\t\tthis.endCallHierarchy();\n\t\t\tthis._storageService.store(CallHierarchyController._StorageDirection, this._widget!.direction, StorageScope.PROFILE, StorageTarget.USER);\n\t\t}));\n\t\tthis._sessionDisposables.add({ dispose() { cts.dispose(true); } });\n\t\tthis._sessionDisposables.add(this._widget);\n\n\t\tmodel.then(model => {\n\t\t\tif (cts.token.isCancellationRequested) {\n\t\t\t\treturn; // nothing\n\t\t\t}\n\t\t\tif (model) {\n\t\t\t\tthis._sessionDisposables.add(model);\n\t\t\t\tthis._widget!.showModel(model);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._widget!.showMessage(localize('no.item', \"No results\"));\n\t\t\t}\n\t\t}).catch(err => {\n\t\t\tif (isCancellationError(err)) {\n\t\t\t\tthis.endCallHierarchy();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._widget!.showMessage(localize('error', \"Failed to show call hierarchy\"));\n\t\t});\n\t}\n\n\tshowOutgoingCalls(): void {\n\t\tthis._widget?.updateDirection(CallHierarchyDirection.CallsFrom);\n\t\tthis._ctxDirection.set(CallHierarchyDirection.CallsFrom);\n\t}\n\n\tshowIncomingCalls(): void {\n\t\tthis._widget?.updateDirection(CallHierarchyDirection.CallsTo);\n\t\tthis._ctxDirection.set(CallHierarchyDirection.CallsTo);\n\t}\n\n\tendCallHierarchy(): void {\n\t\tthis._sessionDisposables.clear();\n\t\tthis._ctxIsVisible.set(false);\n\t\tthis._editor.focus();\n\t}\n}\n\nregisterEditorContribution(CallHierarchyController.Id, CallHierarchyController, EditorContributionInstantiation.Eager); // eager because it needs to define a context key\n\nregisterAction2(class PeekCallHierarchyAction extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.showCallHierarchy',\n\t\t\ttitle: { value: localize('title', \"Peek Call Hierarchy\"), original: 'Peek Call Hierarchy' },\n\t\t\tmenu: {\n\t\t\t\tid: MenuId.EditorContextPeek,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\torder: 1000,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t_ctxHasCallHierarchyProvider,\n\t\t\t\t\tPeekContext.notInPeekEditor\n\t\t\t\t),\n\t\t\t},\n\t\t\tkeybinding: {\n\t\t\t\twhen: EditorContextKeys.editorTextFocus,\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.Shift + KeyMod.Alt + KeyCode.KeyH\n\t\t\t},\n\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\t_ctxHasCallHierarchyProvider,\n\t\t\t\tPeekContext.notInPeekEditor\n\t\t\t),\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync runEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor): Promise<void> {\n\t\treturn CallHierarchyController.get(editor)?.startCallHierarchyFromEditor();\n\t}\n});\n\nregisterAction2(class extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.showIncomingCalls',\n\t\t\ttitle: { value: localize('title.incoming', \"Show Incoming Calls\"), original: 'Show Incoming Calls' },\n\t\t\ticon: registerIcon('callhierarchy-incoming', Codicon.callIncoming, localize('showIncomingCallsIcons', 'Icon for incoming calls in the call hierarchy view.')),\n\t\t\tprecondition: ContextKeyExpr.and(_ctxCallHierarchyVisible, _ctxCallHierarchyDirection.isEqualTo(CallHierarchyDirection.CallsFrom)),\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.Shift + KeyMod.Alt + KeyCode.KeyH,\n\t\t\t},\n\t\t\tmenu: {\n\t\t\t\tid: CallHierarchyTreePeekWidget.TitleMenu,\n\t\t\t\twhen: _ctxCallHierarchyDirection.isEqualTo(CallHierarchyDirection.CallsFrom),\n\t\t\t\torder: 1,\n\t\t\t}\n\t\t});\n\t}\n\n\trunEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor) {\n\t\treturn CallHierarchyController.get(editor)?.showIncomingCalls();\n\t}\n});\n\nregisterAction2(class extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.showOutgoingCalls',\n\t\t\ttitle: { value: localize('title.outgoing', \"Show Outgoing Calls\"), original: 'Show Outgoing Calls' },\n\t\t\ticon: registerIcon('callhierarchy-outgoing', Codicon.callOutgoing, localize('showOutgoingCallsIcon', 'Icon for outgoing calls in the call hierarchy view.')),\n\t\t\tprecondition: ContextKeyExpr.and(_ctxCallHierarchyVisible, _ctxCallHierarchyDirection.isEqualTo(CallHierarchyDirection.CallsTo)),\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.Shift + KeyMod.Alt + KeyCode.KeyH,\n\t\t\t},\n\t\t\tmenu: {\n\t\t\t\tid: CallHierarchyTreePeekWidget.TitleMenu,\n\t\t\t\twhen: _ctxCallHierarchyDirection.isEqualTo(CallHierarchyDirection.CallsTo),\n\t\t\t\torder: 1\n\t\t\t}\n\t\t});\n\t}\n\n\trunEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor) {\n\t\treturn CallHierarchyController.get(editor)?.showOutgoingCalls();\n\t}\n});\n\n\nregisterAction2(class extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.refocusCallHierarchy',\n\t\t\ttitle: { value: localize('title.refocus', \"Refocus Call Hierarchy\"), original: 'Refocus Call Hierarchy' },\n\t\t\tprecondition: _ctxCallHierarchyVisible,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.Shift + KeyCode.Enter\n\t\t\t}\n\t\t});\n\t}\n\n\tasync runEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor): Promise<void> {\n\t\treturn CallHierarchyController.get(editor)?.startCallHierarchyFromCallHierarchy();\n\t}\n});\n\n\nregisterAction2(class extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.closeCallHierarchy',\n\t\t\ttitle: localize('close', 'Close'),\n\t\t\ticon: Codicon.close,\n\t\t\tprecondition: _ctxCallHierarchyVisible,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib + 10,\n\t\t\t\tprimary: KeyCode.Escape,\n\t\t\t\twhen: ContextKeyExpr.not('config.editor.stablePeek')\n\t\t\t},\n\t\t\tmenu: {\n\t\t\t\tid: CallHierarchyTreePeekWidget.TitleMenu,\n\t\t\t\torder: 1000\n\t\t\t}\n\t\t});\n\t}\n\n\trunEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor): void {\n\t\treturn CallHierarchyController.get(editor)?.endCallHierarchy();\n\t}\n});\n"]}