{"version":3,"sources":["vs/workbench/contrib/preferences/browser/keyboardLayoutPicker.ts"],"names":[],"mappings":"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","file":"keyboardLayoutPicker.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport { StatusbarAlignment, IStatusbarService, IStatusbarEntryAccessor } from 'vs/workbench/services/statusbar/browser/statusbar';\nimport { Disposable, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { parseKeyboardLayoutDescription, areKeyboardLayoutsEqual, getKeyboardLayoutId, IKeyboardLayoutService, IKeyboardLayoutInfo } from 'vs/platform/keyboardLayout/common/keyboardLayout';\nimport { LifecyclePhase } from 'vs/workbench/services/lifecycle/common/lifecycle';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { Extensions as WorkbenchExtensions, IWorkbenchContribution, IWorkbenchContributionsRegistry } from 'vs/workbench/common/contributions';\nimport { KEYBOARD_LAYOUT_OPEN_PICKER } from 'vs/workbench/contrib/preferences/common/preferences';\nimport { isMacintosh, isWindows } from 'vs/base/common/platform';\nimport { QuickPickInput, IQuickInputService, IQuickPickItem } from 'vs/platform/quickinput/common/quickInput';\nimport { Action2, registerAction2 } from 'vs/platform/actions/common/actions';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { IEditorPane } from 'vs/workbench/common/editor';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\n\nexport class KeyboardLayoutPickerContribution extends Disposable implements IWorkbenchContribution {\n\tprivate readonly pickerElement = this._register(new MutableDisposable<IStatusbarEntryAccessor>());\n\n\tconstructor(\n\t\t@IKeyboardLayoutService private readonly keyboardLayoutService: IKeyboardLayoutService,\n\t\t@IStatusbarService private readonly statusbarService: IStatusbarService,\n\t) {\n\t\tsuper();\n\n\t\tconst name = nls.localize('status.workbench.keyboardLayout', \"Keyboard Layout\");\n\n\t\tconst layout = this.keyboardLayoutService.getCurrentKeyboardLayout();\n\t\tif (layout) {\n\t\t\tconst layoutInfo = parseKeyboardLayoutDescription(layout);\n\t\t\tconst text = nls.localize('keyboardLayout', \"Layout: {0}\", layoutInfo.label);\n\n\t\t\tthis.pickerElement.value = this.statusbarService.addEntry(\n\t\t\t\t{\n\t\t\t\t\tname,\n\t\t\t\t\ttext,\n\t\t\t\t\tariaLabel: text,\n\t\t\t\t\tcommand: KEYBOARD_LAYOUT_OPEN_PICKER\n\t\t\t\t},\n\t\t\t\t'status.workbench.keyboardLayout',\n\t\t\t\tStatusbarAlignment.RIGHT\n\t\t\t);\n\t\t}\n\n\t\tthis._register(this.keyboardLayoutService.onDidChangeKeyboardLayout(() => {\n\t\t\tconst layout = this.keyboardLayoutService.getCurrentKeyboardLayout();\n\t\t\tconst layoutInfo = parseKeyboardLayoutDescription(layout);\n\n\t\t\tif (this.pickerElement.value) {\n\t\t\t\tconst text = nls.localize('keyboardLayout', \"Layout: {0}\", layoutInfo.label);\n\t\t\t\tthis.pickerElement.value.update({\n\t\t\t\t\tname,\n\t\t\t\t\ttext,\n\t\t\t\t\tariaLabel: text,\n\t\t\t\t\tcommand: KEYBOARD_LAYOUT_OPEN_PICKER\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst text = nls.localize('keyboardLayout', \"Layout: {0}\", layoutInfo.label);\n\t\t\t\tthis.pickerElement.value = this.statusbarService.addEntry(\n\t\t\t\t\t{\n\t\t\t\t\t\tname,\n\t\t\t\t\t\ttext,\n\t\t\t\t\t\tariaLabel: text,\n\t\t\t\t\t\tcommand: KEYBOARD_LAYOUT_OPEN_PICKER\n\t\t\t\t\t},\n\t\t\t\t\t'status.workbench.keyboardLayout',\n\t\t\t\t\tStatusbarAlignment.RIGHT\n\t\t\t\t);\n\t\t\t}\n\t\t}));\n\t}\n}\n\nconst workbenchContributionsRegistry = Registry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench);\nworkbenchContributionsRegistry.registerWorkbenchContribution(KeyboardLayoutPickerContribution, LifecyclePhase.Starting);\n\ninterface LayoutQuickPickItem extends IQuickPickItem {\n\tlayout: IKeyboardLayoutInfo;\n}\n\ninterface IUnknownLayout {\n\ttext?: string;\n\tlang?: string;\n\tlayout?: string;\n}\n\nconst DEFAULT_CONTENT: string = [\n\t`// ${nls.localize('displayLanguage', 'Defines the keyboard layout used in VS Code in the browser environment.')}`,\n\t`// ${nls.localize('doc', 'Open VS Code and run \"Developer: Inspect Key Mappings (JSON)\" from Command Palette.')}`,\n\t``,\n\t`// Once you have the keyboard layout info, please paste it below.`,\n\t'\\n'\n].join('\\n');\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: KEYBOARD_LAYOUT_OPEN_PICKER,\n\t\t\ttitle: { value: nls.localize('keyboard.chooseLayout', \"Change Keyboard Layout\"), original: 'Change Keyboard Layout' },\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst keyboardLayoutService = accessor.get(IKeyboardLayoutService);\n\t\tconst quickInputService = accessor.get(IQuickInputService);\n\t\tconst configurationService = accessor.get(IConfigurationService);\n\t\tconst environmentService = accessor.get(IEnvironmentService);\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst fileService = accessor.get(IFileService);\n\n\t\tconst layouts = keyboardLayoutService.getAllKeyboardLayouts();\n\t\tconst currentLayout = keyboardLayoutService.getCurrentKeyboardLayout();\n\t\tconst layoutConfig = configurationService.getValue('keyboard.layout');\n\t\tconst isAutoDetect = layoutConfig === 'autodetect';\n\n\t\tconst picks: QuickPickInput[] = layouts.map(layout => {\n\t\t\tconst picked = !isAutoDetect && areKeyboardLayoutsEqual(currentLayout, layout);\n\t\t\tconst layoutInfo = parseKeyboardLayoutDescription(layout);\n\t\t\treturn {\n\t\t\t\tlayout: layout,\n\t\t\t\tlabel: [layoutInfo.label, (layout && layout.isUserKeyboardLayout) ? '(User configured layout)' : ''].join(' '),\n\t\t\t\tid: (layout as IUnknownLayout).text || (layout as IUnknownLayout).lang || (layout as IUnknownLayout).layout,\n\t\t\t\tdescription: layoutInfo.description + (picked ? ' (Current layout)' : ''),\n\t\t\t\tpicked: !isAutoDetect && areKeyboardLayoutsEqual(currentLayout, layout)\n\t\t\t};\n\t\t}).sort((a: IQuickPickItem, b: IQuickPickItem) => {\n\t\t\treturn a.label < b.label ? -1 : (a.label > b.label ? 1 : 0);\n\t\t});\n\n\t\tif (picks.length > 0) {\n\t\t\tconst platform = isMacintosh ? 'Mac' : isWindows ? 'Win' : 'Linux';\n\t\t\tpicks.unshift({ type: 'separator', label: nls.localize('layoutPicks', \"Keyboard Layouts ({0})\", platform) });\n\t\t}\n\n\t\tconst configureKeyboardLayout: IQuickPickItem = { label: nls.localize('configureKeyboardLayout', \"Configure Keyboard Layout\") };\n\n\t\tpicks.unshift(configureKeyboardLayout);\n\n\t\t// Offer to \"Auto Detect\"\n\t\tconst autoDetectMode: IQuickPickItem = {\n\t\t\tlabel: nls.localize('autoDetect', \"Auto Detect\"),\n\t\t\tdescription: isAutoDetect ? `Current: ${parseKeyboardLayoutDescription(currentLayout).label}` : undefined,\n\t\t\tpicked: isAutoDetect ? true : undefined\n\t\t};\n\n\t\tpicks.unshift(autoDetectMode);\n\n\t\tconst pick = await quickInputService.pick(picks, { placeHolder: nls.localize('pickKeyboardLayout', \"Select Keyboard Layout\"), matchOnDescription: true });\n\t\tif (!pick) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (pick === autoDetectMode) {\n\t\t\t// set keymap service to auto mode\n\t\t\tconfigurationService.updateValue('keyboard.layout', 'autodetect');\n\t\t\treturn;\n\t\t}\n\n\t\tif (pick === configureKeyboardLayout) {\n\t\t\tconst file = environmentService.keyboardLayoutResource;\n\n\t\t\tawait fileService.stat(file).then(undefined, () => {\n\t\t\t\treturn fileService.createFile(file, VSBuffer.fromString(DEFAULT_CONTENT));\n\t\t\t}).then((stat): Promise<IEditorPane | undefined> | undefined => {\n\t\t\t\tif (!stat) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn editorService.openEditor({\n\t\t\t\t\tresource: stat.resource,\n\t\t\t\t\tlanguageId: 'jsonc',\n\t\t\t\t\toptions: { pinned: true }\n\t\t\t\t});\n\t\t\t}, (error) => {\n\t\t\t\tthrow new Error(nls.localize('fail.createSettings', \"Unable to create '{0}' ({1}).\", file.toString(), error));\n\t\t\t});\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconfigurationService.updateValue('keyboard.layout', getKeyboardLayoutId((<LayoutQuickPickItem>pick).layout));\n\t}\n});\n"]}