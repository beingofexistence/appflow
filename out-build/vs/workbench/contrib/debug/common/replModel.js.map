{"version":3,"sources":["vs/workbench/contrib/debug/common/replModel.ts"],"names":[],"mappings":"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","file":"replModel.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from 'vs/base/common/event';\nimport severity from 'vs/base/common/severity';\nimport { isObject, isString } from 'vs/base/common/types';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport * as nls from 'vs/nls';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IDebugConfiguration, IDebugSession, IExpression, INestingReplElement, IReplElement, IReplElementSource, IStackFrame } from 'vs/workbench/contrib/debug/common/debug';\nimport { ExpressionContainer } from 'vs/workbench/contrib/debug/common/debugModel';\n\nconst MAX_REPL_LENGTH = 10000;\nlet topReplElementCounter = 0;\nconst getUniqueId = () => `topReplElement:${topReplElementCounter++}`;\n\n/**\n * General case of data from DAP the `output` event. {@link ReplVariableElement}\n * is used instead only if there is a `variablesReference` with no `output` text.\n */\nexport class ReplOutputElement implements INestingReplElement {\n\n\tprivate _count = 1;\n\tprivate _onDidChangeCount = new Emitter<void>();\n\n\tconstructor(\n\t\tpublic session: IDebugSession,\n\t\tprivate id: string,\n\t\tpublic value: string,\n\t\tpublic severity: severity,\n\t\tpublic sourceData?: IReplElementSource,\n\t\tpublic readonly expression?: IExpression,\n\t) {\n\t}\n\n\ttoString(includeSource = false): string {\n\t\tlet valueRespectCount = this.value;\n\t\tfor (let i = 1; i < this.count; i++) {\n\t\t\tvalueRespectCount += (valueRespectCount.endsWith('\\n') ? '' : '\\n') + this.value;\n\t\t}\n\t\tconst sourceStr = (this.sourceData && includeSource) ? ` ${this.sourceData.source.name}` : '';\n\t\treturn valueRespectCount + sourceStr;\n\t}\n\n\tgetId(): string {\n\t\treturn this.id;\n\t}\n\n\tgetChildren(): Promise<IReplElement[]> {\n\t\treturn this.expression?.getChildren() || Promise.resolve([]);\n\t}\n\n\tset count(value: number) {\n\t\tthis._count = value;\n\t\tthis._onDidChangeCount.fire();\n\t}\n\n\tget count(): number {\n\t\treturn this._count;\n\t}\n\n\tget onDidChangeCount(): Event<void> {\n\t\treturn this._onDidChangeCount.event;\n\t}\n\n\tget hasChildren() {\n\t\treturn !!this.expression?.hasChildren;\n\t}\n}\n\n/** Top-level variable logged via DAP output when there's no `output` string */\nexport class ReplVariableElement implements INestingReplElement {\n\tpublic readonly hasChildren: boolean;\n\tprivate readonly id = generateUuid();\n\n\tconstructor(\n\t\tpublic readonly expression: IExpression,\n\t\tpublic readonly severity: severity,\n\t\tpublic readonly sourceData?: IReplElementSource,\n\t) {\n\t\tthis.hasChildren = expression.hasChildren;\n\t}\n\n\tgetChildren(): IReplElement[] | Promise<IReplElement[]> {\n\t\treturn this.expression.getChildren();\n\t}\n\n\ttoString(): string {\n\t\treturn this.expression.toString();\n\t}\n\n\tgetId(): string {\n\t\treturn this.id;\n\t}\n}\n\nexport class RawObjectReplElement implements IExpression, INestingReplElement {\n\n\tprivate static readonly MAX_CHILDREN = 1000; // upper bound of children per value\n\n\tconstructor(private id: string, public name: string, public valueObj: any, public sourceData?: IReplElementSource, public annotation?: string) { }\n\n\tgetId(): string {\n\t\treturn this.id;\n\t}\n\n\tget value(): string {\n\t\tif (this.valueObj === null) {\n\t\t\treturn 'null';\n\t\t} else if (Array.isArray(this.valueObj)) {\n\t\t\treturn `Array[${this.valueObj.length}]`;\n\t\t} else if (isObject(this.valueObj)) {\n\t\t\treturn 'Object';\n\t\t} else if (isString(this.valueObj)) {\n\t\t\treturn `\"${this.valueObj}\"`;\n\t\t}\n\n\t\treturn String(this.valueObj) || '';\n\t}\n\n\tget hasChildren(): boolean {\n\t\treturn (Array.isArray(this.valueObj) && this.valueObj.length > 0) || (isObject(this.valueObj) && Object.getOwnPropertyNames(this.valueObj).length > 0);\n\t}\n\n\tevaluateLazy(): Promise<void> {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\n\tgetChildren(): Promise<IExpression[]> {\n\t\tlet result: IExpression[] = [];\n\t\tif (Array.isArray(this.valueObj)) {\n\t\t\tresult = (<any[]>this.valueObj).slice(0, RawObjectReplElement.MAX_CHILDREN)\n\t\t\t\t.map((v, index) => new RawObjectReplElement(`${this.id}:${index}`, String(index), v));\n\t\t} else if (isObject(this.valueObj)) {\n\t\t\tresult = Object.getOwnPropertyNames(this.valueObj).slice(0, RawObjectReplElement.MAX_CHILDREN)\n\t\t\t\t.map((key, index) => new RawObjectReplElement(`${this.id}:${index}`, key, this.valueObj[key]));\n\t\t}\n\n\t\treturn Promise.resolve(result);\n\t}\n\n\ttoString(): string {\n\t\treturn `${this.name}\\n${this.value}`;\n\t}\n}\n\nexport class ReplEvaluationInput implements IReplElement {\n\tprivate id: string;\n\n\tconstructor(public value: string) {\n\t\tthis.id = generateUuid();\n\t}\n\n\ttoString(): string {\n\t\treturn this.value;\n\t}\n\n\tgetId(): string {\n\t\treturn this.id;\n\t}\n}\n\nexport class ReplEvaluationResult extends ExpressionContainer implements IReplElement {\n\tprivate _available = true;\n\n\tget available(): boolean {\n\t\treturn this._available;\n\t}\n\n\tconstructor(public readonly originalExpression: string) {\n\t\tsuper(undefined, undefined, 0, generateUuid());\n\t}\n\n\toverride async evaluateExpression(expression: string, session: IDebugSession | undefined, stackFrame: IStackFrame | undefined, context: string): Promise<boolean> {\n\t\tconst result = await super.evaluateExpression(expression, session, stackFrame, context);\n\t\tthis._available = result;\n\n\t\treturn result;\n\t}\n\n\toverride toString(): string {\n\t\treturn `${this.value}`;\n\t}\n}\n\nexport class ReplGroup implements INestingReplElement {\n\n\tprivate children: IReplElement[] = [];\n\tprivate id: string;\n\tprivate ended = false;\n\tstatic COUNTER = 0;\n\n\tconstructor(\n\t\tpublic name: string,\n\t\tpublic autoExpand: boolean,\n\t\tpublic sourceData?: IReplElementSource\n\t) {\n\t\tthis.id = `replGroup:${ReplGroup.COUNTER++}`;\n\t}\n\n\tget hasChildren() {\n\t\treturn true;\n\t}\n\n\tgetId(): string {\n\t\treturn this.id;\n\t}\n\n\ttoString(includeSource = false): string {\n\t\tconst sourceStr = (includeSource && this.sourceData) ? ` ${this.sourceData.source.name}` : '';\n\t\treturn this.name + sourceStr;\n\t}\n\n\taddChild(child: IReplElement): void {\n\t\tconst lastElement = this.children.length ? this.children[this.children.length - 1] : undefined;\n\t\tif (lastElement instanceof ReplGroup && !lastElement.hasEnded) {\n\t\t\tlastElement.addChild(child);\n\t\t} else {\n\t\t\tthis.children.push(child);\n\t\t}\n\t}\n\n\tgetChildren(): IReplElement[] {\n\t\treturn this.children;\n\t}\n\n\tend(): void {\n\t\tconst lastElement = this.children.length ? this.children[this.children.length - 1] : undefined;\n\t\tif (lastElement instanceof ReplGroup && !lastElement.hasEnded) {\n\t\t\tlastElement.end();\n\t\t} else {\n\t\t\tthis.ended = true;\n\t\t}\n\t}\n\n\tget hasEnded(): boolean {\n\t\treturn this.ended;\n\t}\n}\n\nfunction areSourcesEqual(first: IReplElementSource | undefined, second: IReplElementSource | undefined): boolean {\n\tif (!first && !second) {\n\t\treturn true;\n\t}\n\tif (first && second) {\n\t\treturn first.column === second.column && first.lineNumber === second.lineNumber && first.source.uri.toString() === second.source.uri.toString();\n\t}\n\n\treturn false;\n}\n\nexport interface INewReplElementData {\n\toutput: string;\n\texpression?: IExpression;\n\tsev: severity;\n\tsource?: IReplElementSource;\n}\n\nexport class ReplModel {\n\tprivate replElements: IReplElement[] = [];\n\tprivate readonly _onDidChangeElements = new Emitter<void>();\n\treadonly onDidChangeElements = this._onDidChangeElements.event;\n\n\tconstructor(private readonly configurationService: IConfigurationService) { }\n\n\tgetReplElements(): IReplElement[] {\n\t\treturn this.replElements;\n\t}\n\n\tasync addReplExpression(session: IDebugSession, stackFrame: IStackFrame | undefined, name: string): Promise<void> {\n\t\tthis.addReplElement(new ReplEvaluationInput(name));\n\t\tconst result = new ReplEvaluationResult(name);\n\t\tawait result.evaluateExpression(name, session, stackFrame, 'repl');\n\t\tthis.addReplElement(result);\n\t}\n\n\tappendToRepl(session: IDebugSession, { output, expression, sev, source }: INewReplElementData): void {\n\t\tconst clearAnsiSequence = '\\u001b[2J';\n\t\tconst clearAnsiIndex = output.lastIndexOf(clearAnsiSequence);\n\t\tif (clearAnsiIndex !== -1) {\n\t\t\t// [2J is the ansi escape sequence for clearing the display http://ascii-table.com/ansi-escape-sequences.php\n\t\t\tthis.removeReplExpressions();\n\t\t\tthis.appendToRepl(session, { output: nls.localize('consoleCleared', \"Console was cleared\"), sev: severity.Ignore });\n\t\t\toutput = output.substring(clearAnsiIndex + clearAnsiSequence.length);\n\t\t}\n\n\t\tif (expression) {\n\t\t\t// if there is an output string, prefer to show that, since the DA could\n\t\t\t// have formatted it nicely e.g. with ANSI color codes.\n\t\t\tthis.addReplElement(output\n\t\t\t\t? new ReplOutputElement(session, getUniqueId(), output, sev, source, expression)\n\t\t\t\t: new ReplVariableElement(expression, sev, source));\n\t\t\treturn;\n\t\t}\n\n\t\tconst previousElement = this.replElements.length ? this.replElements[this.replElements.length - 1] : undefined;\n\t\tif (previousElement instanceof ReplOutputElement && previousElement.severity === sev) {\n\t\t\tconst config = this.configurationService.getValue<IDebugConfiguration>('debug');\n\t\t\tif (previousElement.value === output && areSourcesEqual(previousElement.sourceData, source) && config.console.collapseIdenticalLines) {\n\t\t\t\tpreviousElement.count++;\n\t\t\t\t// No need to fire an event, just the count updates and badge will adjust automatically\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!previousElement.value.endsWith('\\n') && !previousElement.value.endsWith('\\r\\n') && previousElement.count === 1) {\n\t\t\t\tthis.replElements[this.replElements.length - 1] = new ReplOutputElement(\n\t\t\t\t\tsession, getUniqueId(), previousElement.value + output, sev, source);\n\t\t\t\tthis._onDidChangeElements.fire();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst element = new ReplOutputElement(session, getUniqueId(), output, sev, source);\n\t\tthis.addReplElement(element);\n\t}\n\n\tstartGroup(name: string, autoExpand: boolean, sourceData?: IReplElementSource): void {\n\t\tconst group = new ReplGroup(name, autoExpand, sourceData);\n\t\tthis.addReplElement(group);\n\t}\n\n\tendGroup(): void {\n\t\tconst lastElement = this.replElements[this.replElements.length - 1];\n\t\tif (lastElement instanceof ReplGroup) {\n\t\t\tlastElement.end();\n\t\t}\n\t}\n\n\tprivate addReplElement(newElement: IReplElement): void {\n\t\tconst lastElement = this.replElements.length ? this.replElements[this.replElements.length - 1] : undefined;\n\t\tif (lastElement instanceof ReplGroup && !lastElement.hasEnded) {\n\t\t\tlastElement.addChild(newElement);\n\t\t} else {\n\t\t\tthis.replElements.push(newElement);\n\t\t\tif (this.replElements.length > MAX_REPL_LENGTH) {\n\t\t\t\tthis.replElements.splice(0, this.replElements.length - MAX_REPL_LENGTH);\n\t\t\t}\n\t\t}\n\n\t\tthis._onDidChangeElements.fire();\n\t}\n\n\tremoveReplExpressions(): void {\n\t\tif (this.replElements.length > 0) {\n\t\t\tthis.replElements = [];\n\t\t\tthis._onDidChangeElements.fire();\n\t\t}\n\t}\n\n\t/** Returns a new REPL model that's a copy of this one. */\n\tclone() {\n\t\tconst newRepl = new ReplModel(this.configurationService);\n\t\tnewRepl.replElements = this.replElements.slice();\n\t\treturn newRepl;\n\t}\n}\n"]}