{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/debug/node/terminals.ts"],"names":[],"mappings":"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","file":"terminals.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as cp from 'child_process';\nimport { getDriveLetter } from 'vs/base/common/extpath';\nimport * as platform from 'vs/base/common/platform';\n\nfunction spawnAsPromised(command: string, args: string[]): Promise<string> {\n\treturn new Promise((resolve, reject) => {\n\t\tlet stdout = '';\n\t\tconst child = cp.spawn(command, args);\n\t\tif (child.pid) {\n\t\t\tchild.stdout.on('data', (data: Buffer) => {\n\t\t\t\tstdout += data.toString();\n\t\t\t});\n\t\t}\n\t\tchild.on('error', err => {\n\t\t\treject(err);\n\t\t});\n\t\tchild.on('close', code => {\n\t\t\tresolve(stdout);\n\t\t});\n\t});\n}\n\nexport async function hasChildProcesses(processId: number | undefined): Promise<boolean> {\n\tif (processId) {\n\n\t\t// if shell has at least one child process, assume that shell is busy\n\t\tif (platform.isWindows) {\n\t\t\tconst windowsProcessTree = await import('@vscode/windows-process-tree');\n\t\t\treturn new Promise<boolean>(resolve => {\n\t\t\t\twindowsProcessTree.getProcessTree(processId, processTree => {\n\t\t\t\t\tresolve(!!processTree && processTree.children.length > 0);\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn spawnAsPromised('/usr/bin/pgrep', ['-lP', String(processId)]).then(stdout => {\n\t\t\t\tconst r = stdout.trim();\n\t\t\t\tif (r.length === 0 || r.indexOf(' tmux') >= 0) { // ignore 'tmux'; see #43683\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}, error => {\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\t}\n\t// fall back to safe side\n\treturn Promise.resolve(true);\n}\n\nconst enum ShellType { cmd, powershell, bash }\n\n\nexport function prepareCommand(shell: string, args: string[], argsCanBeInterpretedByShell: boolean, cwd?: string, env?: { [key: string]: string | null }): string {\n\n\tshell = shell.trim().toLowerCase();\n\n\t// try to determine the shell type\n\tlet shellType;\n\tif (shell.indexOf('powershell') >= 0 || shell.indexOf('pwsh') >= 0) {\n\t\tshellType = ShellType.powershell;\n\t} else if (shell.indexOf('cmd.exe') >= 0) {\n\t\tshellType = ShellType.cmd;\n\t} else if (shell.indexOf('bash') >= 0) {\n\t\tshellType = ShellType.bash;\n\t} else if (platform.isWindows) {\n\t\tshellType = ShellType.cmd; // pick a good default for Windows\n\t} else {\n\t\tshellType = ShellType.bash;\t// pick a good default for anything else\n\t}\n\n\tlet quote: (s: string) => string;\n\t// begin command with a space to avoid polluting shell history\n\tlet command = ' ';\n\n\tswitch (shellType) {\n\n\t\tcase ShellType.powershell:\n\n\t\t\tquote = (s: string) => {\n\t\t\t\ts = s.replace(/\\'/g, '\\'\\'');\n\t\t\t\tif (s.length > 0 && s.charAt(s.length - 1) === '\\\\') {\n\t\t\t\t\treturn `'${s}\\\\'`;\n\t\t\t\t}\n\t\t\t\treturn `'${s}'`;\n\t\t\t};\n\n\t\t\tif (cwd) {\n\t\t\t\tconst driveLetter = getDriveLetter(cwd);\n\t\t\t\tif (driveLetter) {\n\t\t\t\t\tcommand += `${driveLetter}:; `;\n\t\t\t\t}\n\t\t\t\tcommand += `cd ${quote(cwd)}; `;\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tfor (const key in env) {\n\t\t\t\t\tconst value = env[key];\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tcommand += `Remove-Item env:${key}; `;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcommand += `\\${env:${key}}='${value}'; `;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (args.length > 0) {\n\t\t\t\tconst arg = args.shift()!;\n\t\t\t\tconst cmd = argsCanBeInterpretedByShell ? arg : quote(arg);\n\t\t\t\tcommand += (cmd[0] === '\\'') ? `& ${cmd} ` : `${cmd} `;\n\t\t\t\tfor (const a of args) {\n\t\t\t\t\tcommand += (a === '<' || a === '>' || argsCanBeInterpretedByShell) ? a : quote(a);\n\t\t\t\t\tcommand += ' ';\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ShellType.cmd:\n\n\t\t\tquote = (s: string) => {\n\t\t\t\t// Note: Wrapping in cmd /C \"...\" complicates the escaping.\n\t\t\t\t// cmd /C \"node -e \"console.log(process.argv)\" \"\"\"A^>0\"\"\"\" # prints \"A>0\"\n\t\t\t\t// cmd /C \"node -e \"console.log(process.argv)\" \"foo^> bar\"\" # prints foo> bar\n\t\t\t\t// Outside of the cmd /C, it could be a simple quoting, but here, the ^ is needed too\n\t\t\t\ts = s.replace(/\\\"/g, '\"\"');\n\t\t\t\ts = s.replace(/([><!^&|])/g, '^$1');\n\t\t\t\treturn (' \"'.split('').some(char => s.includes(char)) || s.length === 0) ? `\"${s}\"` : s;\n\t\t\t};\n\n\t\t\tif (cwd) {\n\t\t\t\tconst driveLetter = getDriveLetter(cwd);\n\t\t\t\tif (driveLetter) {\n\t\t\t\t\tcommand += `${driveLetter}: && `;\n\t\t\t\t}\n\t\t\t\tcommand += `cd ${quote(cwd)} && `;\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tcommand += 'cmd /C \"';\n\t\t\t\tfor (const key in env) {\n\t\t\t\t\tlet value = env[key];\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tcommand += `set \"${key}=\" && `;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalue = value.replace(/[&^|<>]/g, s => `^${s}`);\n\t\t\t\t\t\tcommand += `set \"${key}=${value}\" && `;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const a of args) {\n\t\t\t\tcommand += (a === '<' || a === '>' || argsCanBeInterpretedByShell) ? a : quote(a);\n\t\t\t\tcommand += ' ';\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tcommand += '\"';\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ShellType.bash: {\n\n\t\t\tquote = (s: string) => {\n\t\t\t\ts = s.replace(/([\"'\\\\\\$!><#()\\[\\]*&^| ;{}`])/g, '\\\\$1');\n\t\t\t\treturn s.length === 0 ? `\"\"` : s;\n\t\t\t};\n\n\t\t\tconst hardQuote = (s: string) => {\n\t\t\t\treturn /[^\\w@%\\/+=,.:^-]/.test(s) ? `'${s.replace(/'/g, '\\'\\\\\\'\\'')}'` : s;\n\t\t\t};\n\n\t\t\tif (cwd) {\n\t\t\t\tcommand += `cd ${quote(cwd)} ; `;\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tcommand += '/usr/bin/env';\n\t\t\t\tfor (const key in env) {\n\t\t\t\t\tconst value = env[key];\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tcommand += ` -u ${hardQuote(key)}`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcommand += ` ${hardQuote(`${key}=${value}`)}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcommand += ' ';\n\t\t\t}\n\t\t\tfor (const a of args) {\n\t\t\t\tcommand += (a === '<' || a === '>' || argsCanBeInterpretedByShell) ? a : quote(a);\n\t\t\t\tcommand += ' ';\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn command;\n}\n"]}