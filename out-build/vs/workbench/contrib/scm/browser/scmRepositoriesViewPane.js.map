{"version":3,"sources":["vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts"],"names":[],"mappings":"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","file":"scmRepositoriesViewPane.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./media/scm';\nimport { localize } from 'vs/nls';\nimport { ViewPane, IViewPaneOptions } from 'vs/workbench/browser/parts/views/viewPane';\nimport { append, $ } from 'vs/base/browser/dom';\nimport { IListVirtualDelegate, IListContextMenuEvent, IListEvent } from 'vs/base/browser/ui/list/list';\nimport { ISCMRepository, ISCMViewService } from 'vs/workbench/contrib/scm/common/scm';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { WorkbenchList } from 'vs/platform/list/browser/listService';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IViewDescriptorService } from 'vs/workbench/common/views';\nimport { SIDE_BAR_BACKGROUND } from 'vs/workbench/common/theme';\nimport { IOpenerService } from 'vs/platform/opener/common/opener';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { RepositoryRenderer } from 'vs/workbench/contrib/scm/browser/scmRepositoryRenderer';\nimport { collectContextMenuActions, getActionViewItemProvider } from 'vs/workbench/contrib/scm/browser/util';\nimport { Orientation } from 'vs/base/browser/ui/sash/sash';\nimport { Iterable } from 'vs/base/common/iterator';\n\nclass ListDelegate implements IListVirtualDelegate<ISCMRepository> {\n\n\tgetHeight(): number {\n\t\treturn 22;\n\t}\n\n\tgetTemplateId(): string {\n\t\treturn RepositoryRenderer.TEMPLATE_ID;\n\t}\n}\n\nexport class SCMRepositoriesViewPane extends ViewPane {\n\n\tprivate list!: WorkbenchList<ISCMRepository>;\n\n\tconstructor(\n\t\toptions: IViewPaneOptions,\n\t\t@ISCMViewService protected scmViewService: ISCMViewService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IViewDescriptorService viewDescriptorService: IViewDescriptorService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@ITelemetryService telemetryService: ITelemetryService\n\t) {\n\t\tsuper(options, keybindingService, contextMenuService, configurationService, contextKeyService, viewDescriptorService, instantiationService, openerService, themeService, telemetryService);\n\t}\n\n\tprotected override renderBody(container: HTMLElement): void {\n\t\tsuper.renderBody(container);\n\n\t\tconst listContainer = append(container, $('.scm-view.scm-repositories-view'));\n\n\t\tconst delegate = new ListDelegate();\n\t\tconst renderer = this.instantiationService.createInstance(RepositoryRenderer, getActionViewItemProvider(this.instantiationService));\n\t\tconst identityProvider = { getId: (r: ISCMRepository) => r.provider.id };\n\n\t\tthis.list = this.instantiationService.createInstance(WorkbenchList, `SCM Main`, listContainer, delegate, [renderer], {\n\t\t\tidentityProvider,\n\t\t\thorizontalScrolling: false,\n\t\t\toverrideStyles: {\n\t\t\t\tlistBackground: SIDE_BAR_BACKGROUND\n\t\t\t},\n\t\t\taccessibilityProvider: {\n\t\t\t\tgetAriaLabel(r: ISCMRepository) {\n\t\t\t\t\treturn r.provider.label;\n\t\t\t\t},\n\t\t\t\tgetWidgetAriaLabel() {\n\t\t\t\t\treturn localize('scm', \"Source Control Repositories\");\n\t\t\t\t}\n\t\t\t}\n\t\t}) as WorkbenchList<ISCMRepository>;\n\n\t\tthis._register(this.list);\n\t\tthis._register(this.list.onDidChangeSelection(this.onListSelectionChange, this));\n\t\tthis._register(this.list.onContextMenu(this.onListContextMenu, this));\n\n\t\tthis._register(this.scmViewService.onDidChangeRepositories(this.onDidChangeRepositories, this));\n\t\tthis._register(this.scmViewService.onDidChangeVisibleRepositories(this.updateListSelection, this));\n\n\t\tif (this.orientation === Orientation.VERTICAL) {\n\t\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\t\tif (e.affectsConfiguration('scm.repositories.visible')) {\n\t\t\t\t\tthis.updateBodySize();\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tthis.onDidChangeRepositories();\n\t\tthis.updateListSelection();\n\t}\n\n\tprivate onDidChangeRepositories(): void {\n\t\tthis.list.splice(0, this.list.length, this.scmViewService.repositories);\n\t\tthis.updateBodySize();\n\t}\n\n\toverride focus(): void {\n\t\tthis.list.domFocus();\n\t}\n\n\tprotected override layoutBody(height: number, width: number): void {\n\t\tsuper.layoutBody(height, width);\n\t\tthis.list.layout(height, width);\n\t}\n\n\tprivate updateBodySize(): void {\n\t\tif (this.orientation === Orientation.HORIZONTAL) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst visibleCount = this.configurationService.getValue<number>('scm.repositories.visible');\n\t\tconst empty = this.list.length === 0;\n\t\tconst size = Math.min(this.list.length, visibleCount) * 22;\n\n\t\tthis.minimumBodySize = visibleCount === 0 ? 22 : size;\n\t\tthis.maximumBodySize = visibleCount === 0 ? Number.POSITIVE_INFINITY : empty ? Number.POSITIVE_INFINITY : size;\n\t}\n\n\tprivate onListContextMenu(e: IListContextMenuEvent<ISCMRepository>): void {\n\t\tif (!e.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst provider = e.element.provider;\n\t\tconst menus = this.scmViewService.menus.getRepositoryMenus(provider);\n\t\tconst menu = menus.repositoryMenu;\n\t\tconst actions = collectContextMenuActions(menu);\n\n\t\tthis.contextMenuService.showContextMenu({\n\t\t\tgetAnchor: () => e.anchor,\n\t\t\tgetActions: () => actions,\n\t\t\tgetActionsContext: () => provider\n\t\t});\n\t}\n\n\tprivate onListSelectionChange(e: IListEvent<ISCMRepository>): void {\n\t\tif (e.browserEvent && e.elements.length > 0) {\n\t\t\tconst scrollTop = this.list.scrollTop;\n\t\t\tthis.scmViewService.visibleRepositories = e.elements;\n\t\t\tthis.list.scrollTop = scrollTop;\n\t\t}\n\t}\n\n\tprivate updateListSelection(): void {\n\t\tconst oldSelection = this.list.getSelection();\n\t\tconst oldSet = new Set(Iterable.map(oldSelection, i => this.list.element(i)));\n\t\tconst set = new Set(this.scmViewService.visibleRepositories);\n\t\tconst added = new Set(Iterable.filter(set, r => !oldSet.has(r)));\n\t\tconst removed = new Set(Iterable.filter(oldSet, r => !set.has(r)));\n\n\t\tif (added.size === 0 && removed.size === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst selection = oldSelection\n\t\t\t.filter(i => !removed.has(this.list.element(i)));\n\n\t\tfor (let i = 0; i < this.list.length; i++) {\n\t\t\tif (added.has(this.list.element(i))) {\n\t\t\t\tselection.push(i);\n\t\t\t}\n\t\t}\n\n\t\tthis.list.setSelection(selection);\n\n\t\tif (selection.length > 0 && selection.indexOf(this.list.getFocus()[0]) === -1) {\n\t\t\tthis.list.setAnchor(selection[0]);\n\t\t\tthis.list.setFocus([selection[0]]);\n\t\t}\n\t}\n}\n"]}