{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/customEditor/common/customTextEditorModel.ts"],"names":[],"mappings":"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","file":"customTextEditorModel.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IMarkdownString } from 'vs/base/common/htmlContent';\nimport { Disposable, IReference } from 'vs/base/common/lifecycle';\nimport { isEqual } from 'vs/base/common/resources';\nimport { URI } from 'vs/base/common/uri';\nimport { IResolvedTextEditorModel, ITextModelService } from 'vs/editor/common/services/resolverService';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IRevertOptions, ISaveOptions } from 'vs/workbench/common/editor';\nimport { ICustomEditorModel } from 'vs/workbench/contrib/customEditor/common/customEditor';\nimport { ITextFileEditorModel, ITextFileService, TextFileEditorModelState } from 'vs/workbench/services/textfile/common/textfiles';\n\nexport class CustomTextEditorModel extends Disposable implements ICustomEditorModel {\n\n\tpublic static async create(\n\t\tinstantiationService: IInstantiationService,\n\t\tviewType: string,\n\t\tresource: URI\n\t): Promise<CustomTextEditorModel> {\n\t\treturn instantiationService.invokeFunction(async accessor => {\n\t\t\tconst textModelResolverService = accessor.get(ITextModelService);\n\t\t\tconst model = await textModelResolverService.createModelReference(resource);\n\t\t\treturn instantiationService.createInstance(CustomTextEditorModel, viewType, resource, model);\n\t\t});\n\t}\n\n\tprivate readonly _textFileModel: ITextFileEditorModel | undefined;\n\n\tprivate readonly _onDidChangeOrphaned = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeOrphaned = this._onDidChangeOrphaned.event;\n\n\tprivate readonly _onDidChangeReadonly = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeReadonly = this._onDidChangeReadonly.event;\n\n\tconstructor(\n\t\tpublic readonly viewType: string,\n\t\tprivate readonly _resource: URI,\n\t\tprivate readonly _model: IReference<IResolvedTextEditorModel>,\n\t\t@ITextFileService private readonly textFileService: ITextFileService\n\t) {\n\t\tsuper();\n\n\t\tthis._register(_model);\n\n\t\tthis._textFileModel = this.textFileService.files.get(_resource);\n\t\tif (this._textFileModel) {\n\t\t\tthis._register(this._textFileModel.onDidChangeOrphaned(() => this._onDidChangeOrphaned.fire()));\n\t\t\tthis._register(this._textFileModel.onDidChangeReadonly(() => this._onDidChangeReadonly.fire()));\n\t\t}\n\n\t\tthis._register(this.textFileService.files.onDidChangeDirty(e => {\n\t\t\tif (isEqual(this.resource, e.resource)) {\n\t\t\t\tthis._onDidChangeDirty.fire();\n\t\t\t\tthis._onDidChangeContent.fire();\n\t\t\t}\n\t\t}));\n\t}\n\n\tpublic get resource() {\n\t\treturn this._resource;\n\t}\n\n\tpublic isReadonly(): boolean | IMarkdownString {\n\t\treturn this._model.object.isReadonly();\n\t}\n\n\tpublic get backupId() {\n\t\treturn undefined;\n\t}\n\n\tpublic isDirty(): boolean {\n\t\treturn this.textFileService.isDirty(this.resource);\n\t}\n\n\tpublic isOrphaned(): boolean {\n\t\treturn !!this._textFileModel?.hasState(TextFileEditorModelState.ORPHAN);\n\t}\n\n\tprivate readonly _onDidChangeDirty: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidChangeDirty: Event<void> = this._onDidChangeDirty.event;\n\n\tprivate readonly _onDidChangeContent: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidChangeContent: Event<void> = this._onDidChangeContent.event;\n\n\tpublic async revert(options?: IRevertOptions) {\n\t\treturn this.textFileService.revert(this.resource, options);\n\t}\n\n\tpublic saveCustomEditor(options?: ISaveOptions): Promise<URI | undefined> {\n\t\treturn this.textFileService.save(this.resource, options);\n\t}\n\n\tpublic async saveCustomEditorAs(resource: URI, targetResource: URI, options?: ISaveOptions): Promise<boolean> {\n\t\treturn !!await this.textFileService.saveAs(resource, targetResource, options);\n\t}\n}\n"]}