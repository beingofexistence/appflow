{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/audioCues/browser/audioCueLineFeatureContribution.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IAmBzF,IAAM,IAAI,GAAV,MAAM,IACZ,SAAQ,eAAG;QAgBX,YACiB,CAAmC,EAC5B,CAA0C,EAC/C,CAAqC,EAChC,CAA2C;YAElE,KAAK,EAAE,CAAC;YALyB,MAAC,GAAD,CAAC,CAAiB;YACX,MAAC,GAAD,CAAC,CAAwB;YAC9B,MAAC,GAAD,CAAC,CAAmB;YACf,MAAC,GAAD,CAAC,CAAyB;YAlBlD,MAAC,GAAO,IAAI,CAAC,CAAC,CAAS,IAAI,eAAG,EAAc,CAAC,CAAC;YAE9C,MAAC,GAAyB;gBAC1C,IAAI,CAAC,CAAC,CAAoB,cAAc,CAAC,iBAAiB,EAAE,qBAAG,CAAM,KAAK,EAAE,wBAAc,CAAC,KAAK,CAAC;gBACjG,IAAI,CAAC,CAAC,CAAoB,cAAc,CAAC,iBAAiB,EAAE,qBAAG,CAAM,OAAO,EAAE,wBAAc,CAAC,OAAO,CAAC;gBACrG,IAAI,CAAC,CAAC,CAAoB,cAAc,CAAC,qBAAqB,CAAC;gBAC/D,IAAI,CAAC,CAAC,CAAoB,cAAc,CAAC,qBAAqB,CAAC;aAC/D,CAAC;YAEe,MAAC,GAAgB,IAAI,WAAG,CAA4C,CAAC,GAAG,EAAE,EAAE,CAAC,IAAA,gCAAmB,EAChH,IAAI,CAAC,CAAC,CAAe,gBAAgB,CAAC,GAAG,CAAC,EAC1C,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC,CAAe,SAAS,CAAC,GAAG,CAAC,CACzC,CAAC,CAAC;YAUF,MAAM,4BAA4B,GAAG,IAAA,oBAAO,EAC3C,CAAC,MAAM,EAAE,EAAE,CAAC,gDAAgD,CAAC,IAAI,CAAC,CAAC,CAAQ,IAAI,CAAC,CAAC,OAAO,EAAE,EAAE,CAC3F,IAAI,CAAC,CAAC,CAAc,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CACtD,CACD,CAAC;YAEF,MAAM,sBAAsB,GAAG,IAAA,gCAAmB,EACjD,IAAI,CAAC,CAAC,CAAa,uBAAuB,EAC1C,CAAC,CAAC,EAAE,EAAE;gBACL,MAAM,uBAAuB,GAC5B,IAAI,CAAC,CAAC,CAAa,uBAAuB,CAAC;gBAE5C,MAAM,MAAM,GAAG,IAAA,mBAAG,EAAU,uBAAuB,CAAC;oBACnD,CAAC,CAAC,uBAAuB,CAAC,iBAAiB,EAAE;oBAC7C,CAAC,CAAC,IAAA,mBAAG,EAAU,uBAAuB,CAAC;wBACtC,CAAC,CAAC,uBAAuB;wBACzB,CAAC,CAAC,SAAS,CAAC;gBAEd,OAAO,MAAM,IAAI,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;YACvF,CAAC,CACD,CAAC;YAEF,IAAI,CAAC,CAAC,CACL,IAAA,oBAAO,EAAC,MAAM,CAAC,EAAE;gBAChB,0CAA0C;gBAC1C,IAAI,CAAC,CAAC,CAAK,KAAK,EAAE,CAAC;gBAEnB,IAAI,CAAC,4BAA4B,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;oBAC/C,OAAO;iBACP;gBAED,MAAM,YAAY,GAAG,sBAAsB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACzD,IAAI,YAAY,EAAE;oBACjB,IAAI,CAAC,CAAC,CAA0B,YAAY,CAAC,MAAM,EAAE,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAK,CAAC;iBACrF;YACF,CAAC,CAAC,CACF,CAAC;QACH,CAAC;QAEO,CAAC,CACR,MAAmB,EACnB,WAAuB,EACvB,KAAU;YAEV,MAAM,WAAW,GAAG,IAAA,gCAAmB,EACtC,MAAM,CAAC,yBAAyB,EAChC,CAAC,IAAI,EAAE,EAAE;gBACR,qEAAqE;gBACrE,IACC,IAAI;oBACJ,IAAI,CAAC,MAAM,wCAAgC;oBAC3C,IAAI,CAAC,MAAM,sCAA8B,EACxC;oBACD,4FAA4F;oBAC5F,OAAO,SAAS,CAAC;iBACjB;gBACD,OAAO,MAAM,CAAC,WAAW,EAAE,CAAC;YAC7B,CAAC,CACD,CAAC;YACF,MAAM,iBAAiB,GAAG,IAAA,gCAAmB,EAAC,WAAW,EAAE,IAAI,CAAC,CAAC,CAAqB,QAAQ,CAAC,mCAAmC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;YACtJ,MAAM,QAAQ,GAAG,IAAA,sCAAyB,EACzC,WAAW,CAAC,kBAAkB,CAAC,IAAI,CAAC,WAAW,CAAC,EAChD,IAAI,EACJ,KAAK,CACL,CAAC;YAEF,MAAM,aAAa,GAAG,IAAI,CAAC,CAAC,CAAQ,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE;gBACnD,MAAM,gBAAgB,GAAG,OAAO,CAAC,kBAAkB,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;gBACzE,MAAM,gBAAgB,GAAG,IAAA,wBAAW,EACnC,EAAE,SAAS,EAAE,mBAAmB,OAAO,CAAC,QAAQ,CAAC,IAAI,EAAE,EAAE,EACzD,CAAC,MAAM,EAAE,EAAE;oBACV,IAAI,CAAC,IAAI,CAAC,CAAC,CAAc,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;wBAC5D,OAAO,KAAK,CAAC;qBACb;oBACD,MAAM,QAAQ,GAAG,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;oBAChD,IAAI,CAAC,QAAQ,EAAE;wBACd,OAAO,KAAK,CAAC;qBACb;oBACD,OAAO,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;gBAC1D,CAAC,CACD,CAAC;gBACF,OAAO,IAAA,wBAAW,EACjB,EAAE,SAAS,EAAE,iCAAiC,OAAO,CAAC,QAAQ,CAAC,IAAI,EAAE,EAAE,EACvE,CAAC,MAAM,EAAE,EAAE,CACV,OAAO,CAAC,mBAAmB,IAAI,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC;oBACnD,CAAC,CAAC,CAAC,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,gBAAgB,CAAC,GAAG,EAAE,CAAC;oBAC1D,CAAC,CAAC,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,CACjC,CAAC;YACH,CAAC,CAAC,CAAC;YAEH,MAAM,KAAK,GAAG,IAAA,oBAAO,EACpB,CAAC,MAAM,EAAE,EAAE,CAAC,0BAA0B,CAAA,CAAC;gBACtC,UAAU,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC;gBAC1C,aAAa,EAAE,IAAI,GAAG,CACrB,IAAI,CAAC,CAAC,CAAQ,GAAG,CAAC,CAAC,OAAO,EAAE,GAAG,EAAE,EAAE,CAAC;oBACnC,OAAO;oBACP,aAAa,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC;iBAC/B,CAAC,CACF;aACD,CAAC,CACF,CAAC;YAEF,KAAK,CAAC,GAAG,CACR,IAAA,yBAAY,EAAC,KAAK,EAAE,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,EAAE,EAAE;gBAC/C,kCAAkC;gBAClC,MAAM,WAAW,GAAG,IAAI,CAAC,CAAC,CAAQ,MAAM,CACvC,OAAO,CAAC,EAAE,CACT,QAAQ,EAAE,aAAa,CAAC,GAAG,CAAC,OAAO,CAAC;oBACpC,CAAC,CAAC,SAAS,EAAE,aAAa,EAAE,GAAG,CAAC,OAAO,CAAC,IAAI,QAAQ,CAAC,UAAU,KAAK,SAAS,CAAC,UAAU,CAAC,CAC1F,CAAC;gBAEF,IAAI,CAAC,CAAC,CAAe,aAAa,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,CAAC,CAAC,CACF,CAAC;QACH,CAAC;KACD,CAAA;IA5IY,oBAAI;mBAAJ,IAAI;QAkBd,WAAA,mBAAG,CAAA;QACH,WAAA,mBAAG,CAAA;QACH,WAAA,qBAAG,CAAA;QACH,WAAA,mBAAG,CAAA;OArBO,IAAI,CA4IhB;IAeD,IAAM,iBAAiB,GAAvB,MAAM,iBAAiB;QAGtB,YACiB,QAAa,EACZ,CAAwB,EACzB,CAAmC;YAFnC,aAAQ,GAAR,QAAQ,CAAK;YACZ,MAAC,GAAD,CAAC,CAAuB;YACR,MAAC,GAAD,CAAC,CAAiB;YALpC,wBAAmB,GAAG,IAAI,CAAC;YACnC,MAAC,GAAuB,CAAC,CAAC;QAM9B,CAAC;QAEL,kBAAkB,CAAC,MAAmB,EAAE,KAAiB;YACxD,OAAO,IAAA,gCAAmB,EACzB,aAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAa,eAAe,EAAE,CAAC,WAAW,EAAE,EAAE,CAChE,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,CAC9D,EACD,GAAG,EAAE,CAAC,sDAAsD,CAAA,CAAC;gBAC5D,SAAS,EAAE,CAAC,QAAQ,EAAE,EAAE;oBACvB,MAAM,WAAW,GAAG,QAAQ,CAAC,UAAU,KAAK,IAAI,CAAC,CAAC,CAAa;oBAC/D,IAAI,CAAC,CAAC,GAAe,QAAQ,CAAC,UAAU,CAAC;oBACzC,MAAM,SAAS,GAAG,IAAI,CAAC,CAAC;yBACtB,IAAI,CAAC,EAAE,QAAQ,EAAE,KAAK,CAAC,GAAG,EAAE,CAAC;yBAC7B,IAAI,CACJ,CAAC,CAAC,EAAE,EAAE;wBACL,MAAM,MAAM,GAAG,CAAC,CAAC,QAAQ,KAAK,IAAI,CAAC,CAAC,IAAW,CAAC,CAAC,eAAe,IAAI,QAAQ,CAAC,UAAU,IAAI,QAAQ,CAAC,UAAU,IAAI,CAAC,CAAC,aAAa,CAAC;wBAClI,OAAO,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,QAAQ,CAAC,UAAU,IAAI,CAAC,CAAC,aAAa,IAAI,CAAC,CAAC,WAAW,IAAI,QAAQ,CAAC,MAAM,IAAI,CAAC,CAAC,SAAS,IAAI,QAAQ,CAAC,MAAM,CAAC,CAAC;oBACxJ,CAAC,CAAC,CAAC;oBACL,OAAO,SAAS,CAAC;gBAClB,CAAC;aACD,CAAC,CACF,CAAC;QACH,CAAC;KACD,CAAA;IA/BK,iBAAiB;QAMpB,WAAA,aAAG,CAAA;OANA,iBAAiB,CA+BtB;IAED,MAAM,qBAAqB;QAA3B;YACiB,aAAQ,GAAG,qBAAG,CAAM,UAAU,CAAC;QAwBhD,CAAC;QAtBA,kBAAkB,CAAC,MAAmB,EAAE,KAAiB;YACxD,MAAM,iBAAiB,GAAG,aAAG,CAAe,GAAG,CAAC,MAAM,CAAC,CAAC;YACxD,IAAI,CAAC,iBAAiB,EAAE;gBACvB,OAAO,IAAA,4BAAe,EAAC;oBACtB,SAAS,EAAE,GAAG,EAAE,CAAC,KAAK;iBACtB,CAAC,CAAC;aACH;YAED,MAAM,YAAY,GAAG,IAAA,kCAAqB,EACzC,iBAAiB,CAAC,eAAe,EAAE,IAAI,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CACjE,CAAC;YACF,OAAO,YAAY,CAAC,GAAG,CAAmB,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;gBACjD,SAAS,EAAE,CAAC,QAAQ,EAAE,EAAE;oBACvB,MAAM,YAAY,GAAG,CAAC,CAAC,KAAK,EAAE,eAAe,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;oBACnE,MAAM,UAAU,GAAG,CAAC,YAAY;wBAC/B,CAAC,CAAC,KAAK;wBACP,CAAC,CAAC,YAAY,CAAC,WAAW;4BAC1B,YAAY,CAAC,eAAe,KAAK,QAAQ,CAAC,UAAU,CAAC;oBACtD,OAAO,UAAU,CAAC;gBACnB,CAAC;aACD,CAAC,CAAC,CAAC;QACL,CAAC;KACD;IAED,IAAM,qBAAqB,GAA3B,MAAM,qBAAqB;QAG1B,YAA2B,CAAkC;YAAjB,MAAC,GAAD,CAAC,CAAgB;YAF7C,aAAQ,GAAG,qBAAG,CAAM,KAAK,CAAC;QAEiC,CAAC;QAE5E,kBAAkB,CAAC,MAAmB,EAAE,KAAiB;YACxD,OAAO,IAAA,gCAAmB,EACzB,IAAI,CAAC,CAAC,CAAY,QAAQ,EAAE,CAAC,sBAAsB,EACnD,GAAG,EAAE,CAAC,kEAAkE,CAAA,CAAC;gBACxE,SAAS,EAAE,CAAC,QAAQ,EAAE,EAAE;oBACvB,MAAM,WAAW,GAAG,IAAI,CAAC,CAAC;yBACxB,QAAQ,EAAE;yBACV,cAAc,CAAC,EAAE,GAAG,EAAE,KAAK,CAAC,GAAG,EAAE,UAAU,EAAE,QAAQ,CAAC,UAAU,EAAE,CAAC,CAAC;oBACtE,MAAM,cAAc,GAAG,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC;oBAC9C,OAAO,cAAc,CAAC;gBACvB,CAAC;aACD,CAAC,CACF,CAAC;QACH,CAAC;KACD,CAAA;IAnBK,qBAAqB;QAGb,WAAA,WAAG,CAAA;OAHX,qBAAqB,CAmB1B","file":"audioCueLineFeatureContribution.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CachedFunction } from 'vs/base/common/cache';\nimport { Event } from 'vs/base/common/event';\nimport { Disposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { IObservable, autorun, autorunDelta, constObservable, debouncedObservable, derived, derivedOpts, observableFromEvent, observableFromPromise, wasEventTriggeredRecently } from 'vs/base/common/observable';\nimport { ICodeEditor, isCodeEditor, isDiffEditor } from 'vs/editor/browser/editorBrowser';\nimport { Position } from 'vs/editor/common/core/position';\nimport { CursorChangeReason } from 'vs/editor/common/cursorEvents';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { FoldingController } from 'vs/editor/contrib/folding/browser/folding';\nimport { AudioCue, IAudioCueService } from 'vs/platform/audioCues/browser/audioCueService';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IMarkerService, MarkerSeverity } from 'vs/platform/markers/common/markers';\nimport { IWorkbenchContribution } from 'vs/workbench/common/contributions';\nimport { IDebugService } from 'vs/workbench/contrib/debug/common/debug';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\n\nexport class AudioCueLineFeatureContribution\n\textends Disposable\n\timplements IWorkbenchContribution {\n\tprivate readonly store = this._register(new DisposableStore());\n\n\tprivate readonly features: LineFeature[] = [\n\t\tthis.instantiationService.createInstance(MarkerLineFeature, AudioCue.error, MarkerSeverity.Error),\n\t\tthis.instantiationService.createInstance(MarkerLineFeature, AudioCue.warning, MarkerSeverity.Warning),\n\t\tthis.instantiationService.createInstance(FoldedAreaLineFeature),\n\t\tthis.instantiationService.createInstance(BreakpointLineFeature),\n\t];\n\n\tprivate readonly isEnabledCache = new CachedFunction<AudioCue, IObservable<boolean>>((cue) => observableFromEvent(\n\t\tthis.audioCueService.onEnabledChanged(cue),\n\t\t() => this.audioCueService.isEnabled(cue)\n\t));\n\n\tconstructor(\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IAudioCueService private readonly audioCueService: IAudioCueService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\n\t\tconst someAudioCueFeatureIsEnabled = derived(\n\t\t\t(reader) => /** @description someAudioCueFeatureIsEnabled */ this.features.some((feature) =>\n\t\t\t\tthis.isEnabledCache.get(feature.audioCue).read(reader)\n\t\t\t)\n\t\t);\n\n\t\tconst activeEditorObservable = observableFromEvent(\n\t\t\tthis.editorService.onDidActiveEditorChange,\n\t\t\t(_) => {\n\t\t\t\tconst activeTextEditorControl =\n\t\t\t\t\tthis.editorService.activeTextEditorControl;\n\n\t\t\t\tconst editor = isDiffEditor(activeTextEditorControl)\n\t\t\t\t\t? activeTextEditorControl.getOriginalEditor()\n\t\t\t\t\t: isCodeEditor(activeTextEditorControl)\n\t\t\t\t\t\t? activeTextEditorControl\n\t\t\t\t\t\t: undefined;\n\n\t\t\t\treturn editor && editor.hasModel() ? { editor, model: editor.getModel() } : undefined;\n\t\t\t}\n\t\t);\n\n\t\tthis._register(\n\t\t\tautorun(reader => {\n\t\t\t\t/** @description updateAudioCuesEnabled */\n\t\t\t\tthis.store.clear();\n\n\t\t\t\tif (!someAudioCueFeatureIsEnabled.read(reader)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst activeEditor = activeEditorObservable.read(reader);\n\t\t\t\tif (activeEditor) {\n\t\t\t\t\tthis.registerAudioCuesForEditor(activeEditor.editor, activeEditor.model, this.store);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n\n\tprivate registerAudioCuesForEditor(\n\t\teditor: ICodeEditor,\n\t\teditorModel: ITextModel,\n\t\tstore: DisposableStore\n\t): void {\n\t\tconst curPosition = observableFromEvent(\n\t\t\teditor.onDidChangeCursorPosition,\n\t\t\t(args) => {\n\t\t\t\t/** @description editor.onDidChangeCursorPosition (caused by user) */\n\t\t\t\tif (\n\t\t\t\t\targs &&\n\t\t\t\t\targs.reason !== CursorChangeReason.Explicit &&\n\t\t\t\t\targs.reason !== CursorChangeReason.NotSet\n\t\t\t\t) {\n\t\t\t\t\t// Ignore cursor changes caused by navigation (e.g. which happens when execution is paused).\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn editor.getPosition();\n\t\t\t}\n\t\t);\n\t\tconst debouncedPosition = debouncedObservable(curPosition, this._configurationService.getValue('audioCues.debouncePositionChanges') ? 300 : 0, store);\n\t\tconst isTyping = wasEventTriggeredRecently(\n\t\t\teditorModel.onDidChangeContent.bind(editorModel),\n\t\t\t1000,\n\t\t\tstore\n\t\t);\n\n\t\tconst featureStates = this.features.map((feature) => {\n\t\t\tconst lineFeatureState = feature.getObservableState(editor, editorModel);\n\t\t\tconst isFeaturePresent = derivedOpts(\n\t\t\t\t{ debugName: `isPresentInLine:${feature.audioCue.name}` },\n\t\t\t\t(reader) => {\n\t\t\t\t\tif (!this.isEnabledCache.get(feature.audioCue).read(reader)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tconst position = debouncedPosition.read(reader);\n\t\t\t\t\tif (!position) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn lineFeatureState.read(reader).isPresent(position);\n\t\t\t\t}\n\t\t\t);\n\t\t\treturn derivedOpts(\n\t\t\t\t{ debugName: `typingDebouncedFeatureState:\\n${feature.audioCue.name}` },\n\t\t\t\t(reader) =>\n\t\t\t\t\tfeature.debounceWhileTyping && isTyping.read(reader)\n\t\t\t\t\t\t? (debouncedPosition.read(reader), isFeaturePresent.get())\n\t\t\t\t\t\t: isFeaturePresent.read(reader)\n\t\t\t);\n\t\t});\n\n\t\tconst state = derived(\n\t\t\t(reader) => /** @description states */({\n\t\t\t\tlineNumber: debouncedPosition.read(reader),\n\t\t\t\tfeatureStates: new Map(\n\t\t\t\t\tthis.features.map((feature, idx) => [\n\t\t\t\t\t\tfeature,\n\t\t\t\t\t\tfeatureStates[idx].read(reader),\n\t\t\t\t\t])\n\t\t\t\t),\n\t\t\t})\n\t\t);\n\n\t\tstore.add(\n\t\t\tautorunDelta(state, ({ lastValue, newValue }) => {\n\t\t\t\t/** @description Play Audio Cue */\n\t\t\t\tconst newFeatures = this.features.filter(\n\t\t\t\t\tfeature =>\n\t\t\t\t\t\tnewValue?.featureStates.get(feature) &&\n\t\t\t\t\t\t(!lastValue?.featureStates?.get(feature) || newValue.lineNumber !== lastValue.lineNumber)\n\t\t\t\t);\n\n\t\t\t\tthis.audioCueService.playAudioCues(newFeatures.map(f => f.audioCue));\n\t\t\t})\n\t\t);\n\t}\n}\n\ninterface LineFeature {\n\taudioCue: AudioCue;\n\tdebounceWhileTyping?: boolean;\n\tgetObservableState(\n\t\teditor: ICodeEditor,\n\t\tmodel: ITextModel\n\t): IObservable<LineFeatureState>;\n}\n\ninterface LineFeatureState {\n\tisPresent(position: Position): boolean;\n}\n\nclass MarkerLineFeature implements LineFeature {\n\tpublic readonly debounceWhileTyping = true;\n\tprivate _previousLine: number = 0;\n\tconstructor(\n\t\tpublic readonly audioCue: AudioCue,\n\t\tprivate readonly severity: MarkerSeverity,\n\t\t@IMarkerService private readonly markerService: IMarkerService,\n\n\t) { }\n\n\tgetObservableState(editor: ICodeEditor, model: ITextModel): IObservable<LineFeatureState> {\n\t\treturn observableFromEvent<LineFeatureState>(\n\t\t\tEvent.filter(this.markerService.onMarkerChanged, (changedUris) =>\n\t\t\t\tchangedUris.some((u) => u.toString() === model.uri.toString())\n\t\t\t),\n\t\t\t() => /** @description this.markerService.onMarkerChanged */({\n\t\t\t\tisPresent: (position) => {\n\t\t\t\t\tconst lineChanged = position.lineNumber !== this._previousLine;\n\t\t\t\t\tthis._previousLine = position.lineNumber;\n\t\t\t\t\tconst hasMarker = this.markerService\n\t\t\t\t\t\t.read({ resource: model.uri })\n\t\t\t\t\t\t.some(\n\t\t\t\t\t\t\t(m) => {\n\t\t\t\t\t\t\t\tconst onLine = m.severity === this.severity && m.startLineNumber <= position.lineNumber && position.lineNumber <= m.endLineNumber;\n\t\t\t\t\t\t\t\treturn lineChanged ? onLine : onLine && (position.lineNumber <= m.endLineNumber && m.startColumn <= position.column && m.endColumn >= position.column);\n\t\t\t\t\t\t\t});\n\t\t\t\t\treturn hasMarker;\n\t\t\t\t},\n\t\t\t})\n\t\t);\n\t}\n}\n\nclass FoldedAreaLineFeature implements LineFeature {\n\tpublic readonly audioCue = AudioCue.foldedArea;\n\n\tgetObservableState(editor: ICodeEditor, model: ITextModel): IObservable<LineFeatureState> {\n\t\tconst foldingController = FoldingController.get(editor);\n\t\tif (!foldingController) {\n\t\t\treturn constObservable({\n\t\t\t\tisPresent: () => false,\n\t\t\t});\n\t\t}\n\n\t\tconst foldingModel = observableFromPromise(\n\t\t\tfoldingController.getFoldingModel() ?? Promise.resolve(undefined)\n\t\t);\n\t\treturn foldingModel.map<LineFeatureState>((v) => ({\n\t\t\tisPresent: (position) => {\n\t\t\t\tconst regionAtLine = v.value?.getRegionAtLine(position.lineNumber);\n\t\t\t\tconst hasFolding = !regionAtLine\n\t\t\t\t\t? false\n\t\t\t\t\t: regionAtLine.isCollapsed &&\n\t\t\t\t\tregionAtLine.startLineNumber === position.lineNumber;\n\t\t\t\treturn hasFolding;\n\t\t\t},\n\t\t}));\n\t}\n}\n\nclass BreakpointLineFeature implements LineFeature {\n\tpublic readonly audioCue = AudioCue.break;\n\n\tconstructor(@IDebugService private readonly debugService: IDebugService) { }\n\n\tgetObservableState(editor: ICodeEditor, model: ITextModel): IObservable<LineFeatureState> {\n\t\treturn observableFromEvent<LineFeatureState>(\n\t\t\tthis.debugService.getModel().onDidChangeBreakpoints,\n\t\t\t() => /** @description debugService.getModel().onDidChangeBreakpoints */({\n\t\t\t\tisPresent: (position) => {\n\t\t\t\t\tconst breakpoints = this.debugService\n\t\t\t\t\t\t.getModel()\n\t\t\t\t\t\t.getBreakpoints({ uri: model.uri, lineNumber: position.lineNumber });\n\t\t\t\t\tconst hasBreakpoints = breakpoints.length > 0;\n\t\t\t\t\treturn hasBreakpoints;\n\t\t\t\t},\n\t\t\t})\n\t\t);\n\t}\n}\n"]}