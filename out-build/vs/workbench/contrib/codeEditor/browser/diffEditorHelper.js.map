{"version":3,"sources":["vs/workbench/contrib/codeEditor/browser/diffEditorHelper.ts"],"names":[],"mappings":"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","file":"diffEditorHelper.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\nimport { autorunWithStore, observableFromEvent } from 'vs/base/common/observable';\nimport { IDiffEditor } from 'vs/editor/browser/editorBrowser';\nimport { registerDiffEditorContribution } from 'vs/editor/browser/editorExtensions';\nimport { ICodeEditorService } from 'vs/editor/browser/services/codeEditorService';\nimport { AccessibleDiffViewerNext, AccessibleDiffViewerPrev } from 'vs/editor/browser/widget/diffEditor/diffEditor.contribution';\nimport { DiffEditorWidget } from 'vs/editor/browser/widget/diffEditor/diffEditorWidget';\nimport { EmbeddedDiffEditorWidget } from 'vs/editor/browser/widget/embeddedCodeEditorWidget';\nimport { IDiffEditorContribution } from 'vs/editor/common/editorCommon';\nimport { localize } from 'vs/nls';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { ContextKeyEqualsExpr } from 'vs/platform/contextkey/common/contextkey';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { INotificationService, Severity } from 'vs/platform/notification/common/notification';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { FloatingEditorClickWidget } from 'vs/workbench/browser/codeeditor';\nimport { Extensions, IConfigurationMigrationRegistry } from 'vs/workbench/common/configuration';\nimport { AccessibilityVerbositySettingId } from 'vs/workbench/contrib/accessibility/browser/accessibilityConfiguration';\nimport { AccessibleViewType, IAccessibleViewService } from 'vs/workbench/contrib/accessibility/browser/accessibleView';\nimport { AccessibilityHelpAction } from 'vs/workbench/contrib/accessibility/browser/accessibleViewActions';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\n\nclass DiffEditorHelperContribution extends Disposable implements IDiffEditorContribution {\n\tpublic static readonly ID = 'editor.contrib.diffEditorHelper';\n\n\tconstructor(\n\t\tprivate readonly _diffEditor: IDiffEditor,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(createScreenReaderHelp());\n\n\t\tconst isEmbeddedDiffEditor = this._diffEditor instanceof EmbeddedDiffEditorWidget;\n\n\t\tif (!isEmbeddedDiffEditor) {\n\t\t\tconst computationResult = observableFromEvent(e => this._diffEditor.onDidUpdateDiff(e), () => this._diffEditor.getDiffComputationResult());\n\t\t\tconst onlyWhiteSpaceChange = computationResult.map(r => r && !r.identical && r.changes2.length === 0);\n\n\t\t\tthis._register(autorunWithStore((reader, store) => {\n\t\t\t\t/** @description update state */\n\t\t\t\tif (onlyWhiteSpaceChange.read(reader)) {\n\t\t\t\t\tconst helperWidget = store.add(this._instantiationService.createInstance(\n\t\t\t\t\t\tFloatingEditorClickWidget,\n\t\t\t\t\t\tthis._diffEditor.getModifiedEditor(),\n\t\t\t\t\t\tlocalize('hintWhitespace', \"Show Whitespace Differences\"),\n\t\t\t\t\t\tnull\n\t\t\t\t\t));\n\t\t\t\t\tstore.add(helperWidget.onClick(() => {\n\t\t\t\t\t\tthis._configurationService.updateValue('diffEditor.ignoreTrimWhitespace', false);\n\t\t\t\t\t}));\n\t\t\t\t\thelperWidget.render();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tthis._register(this._diffEditor.onDidUpdateDiff(() => {\n\t\t\t\tconst diffComputationResult = this._diffEditor.getDiffComputationResult();\n\n\t\t\t\tif (diffComputationResult && diffComputationResult.quitEarly) {\n\t\t\t\t\tthis._notificationService.prompt(\n\t\t\t\t\t\tSeverity.Warning,\n\t\t\t\t\t\tlocalize('hintTimeout', \"The diff algorithm was stopped early (after {0} ms.)\", this._diffEditor.maxComputationTime),\n\t\t\t\t\t\t[{\n\t\t\t\t\t\t\tlabel: localize('removeTimeout', \"Remove Limit\"),\n\t\t\t\t\t\t\trun: () => {\n\t\t\t\t\t\t\t\tthis._configurationService.updateValue('diffEditor.maxComputationTime', 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}],\n\t\t\t\t\t\t{}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n}\n\nfunction createScreenReaderHelp(): IDisposable {\n\treturn AccessibilityHelpAction.addImplementation(105, 'diff-editor', async (accessor) => {\n\t\tconst accessibleViewService = accessor.get(IAccessibleViewService);\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst codeEditorService = accessor.get(ICodeEditorService);\n\t\tconst keybindingService = accessor.get(IKeybindingService);\n\n\t\tconst next = keybindingService.lookupKeybinding(AccessibleDiffViewerNext.id)?.getAriaLabel();\n\t\tconst previous = keybindingService.lookupKeybinding(AccessibleDiffViewerPrev.id)?.getAriaLabel();\n\n\t\tif (!(editorService.activeTextEditorControl instanceof DiffEditorWidget)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst codeEditor = codeEditorService.getActiveCodeEditor() || codeEditorService.getFocusedCodeEditor();\n\t\tif (!codeEditor) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst keys = ['audioCues.diffLineDeleted', 'audioCues.diffLineInserted', 'audioCues.diffLineModified'];\n\n\t\taccessibleViewService.show({\n\t\t\tverbositySettingKey: AccessibilityVerbositySettingId.DiffEditor,\n\t\t\tprovideContent: () => [\n\t\t\t\tlocalize('msg1', \"You are in a diff editor.\"),\n\t\t\t\tlocalize('msg2', \"Press {0} or {1} to view the next or previous diff in the diff review mode that is optimized for screen readers.\", next, previous),\n\t\t\t\tlocalize('msg3', \"To control which audio cues should be played, the following settings can be configured: {0}.\", keys.join(', ')),\n\t\t\t].join('\\n\\n'),\n\t\t\tonClose: () => {\n\t\t\t\tcodeEditor.focus();\n\t\t\t},\n\t\t\toptions: { type: AccessibleViewType.Help }\n\t\t});\n\t}, ContextKeyEqualsExpr.create('isInDiffEditor', true));\n}\n\nregisterDiffEditorContribution(DiffEditorHelperContribution.ID, DiffEditorHelperContribution);\n\nRegistry.as<IConfigurationMigrationRegistry>(Extensions.ConfigurationMigration)\n\t.registerConfigurationMigrations([{\n\t\tkey: 'diffEditor.experimental.collapseUnchangedRegions',\n\t\tmigrateFn: (value, accessor) => {\n\t\t\treturn [\n\t\t\t\t['diffEditor.hideUnchangedRegions.enabled', { value }],\n\t\t\t\t['diffEditor.experimental.collapseUnchangedRegions', { value: undefined }]\n\t\t\t];\n\t\t}\n\t}]);\n"]}