{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/codeEditor/browser/editorLineNumberMenu.ts"],"names":[],"mappings":"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","file":"editorLineNumberMenu.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IAction, Separator } from 'vs/base/common/actions';\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\nimport { isMacintosh } from 'vs/base/common/platform';\nimport { ICodeEditor, IEditorMouseEvent, MouseTargetType } from 'vs/editor/browser/editorBrowser';\nimport { registerEditorContribution, EditorContributionInstantiation } from 'vs/editor/browser/editorExtensions';\nimport { IEditorContribution } from 'vs/editor/common/editorCommon';\nimport { IMenuService, MenuId, MenuItemAction, SubmenuItemAction } from 'vs/platform/actions/common/actions';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { TextEditorSelectionSource } from 'vs/platform/editor/common/editor';\nimport { IInstantiationService, ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { Registry } from 'vs/platform/registry/common/platform';\n\nexport interface IGutterActionsGenerator {\n\t(context: { lineNumber: number; editor: ICodeEditor; accessor: ServicesAccessor }, result: { push(action: IAction, group?: string): void }): void;\n}\n\nexport class GutterActionsRegistryImpl {\n\tprivate _registeredGutterActionsGenerators: Set<IGutterActionsGenerator> = new Set();\n\n\t/**\n\t *\n\t * This exists solely to allow the debug and test contributions to add actions to the gutter context menu\n\t * which cannot be trivially expressed using when clauses and therefore cannot be statically registered.\n\t * If you want an action to show up in the gutter context menu, you should generally use MenuId.EditorLineNumberMenu instead.\n\t */\n\tpublic registerGutterActionsGenerator(gutterActionsGenerator: IGutterActionsGenerator): IDisposable {\n\t\tthis._registeredGutterActionsGenerators.add(gutterActionsGenerator);\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tthis._registeredGutterActionsGenerators.delete(gutterActionsGenerator);\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic getGutterActionsGenerators(): IGutterActionsGenerator[] {\n\t\treturn Array.from(this._registeredGutterActionsGenerators.values());\n\t}\n}\n\nRegistry.add('gutterActionsRegistry', new GutterActionsRegistryImpl());\nexport const GutterActionsRegistry: GutterActionsRegistryImpl = Registry.as('gutterActionsRegistry');\n\nexport class EditorLineNumberContextMenu extends Disposable implements IEditorContribution {\n\tstatic readonly ID = 'workbench.contrib.editorLineNumberContextMenu';\n\n\tconstructor(\n\t\tprivate readonly editor: ICodeEditor,\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService,\n\t\t@IMenuService private readonly menuService: IMenuService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(this.editor.onMouseDown((e: IEditorMouseEvent) => this.doShow(e, false)));\n\n\t}\n\n\tpublic show(e: IEditorMouseEvent) {\n\t\tthis.doShow(e, true);\n\t}\n\n\tprivate doShow(e: IEditorMouseEvent, force: boolean) {\n\t\tconst model = this.editor.getModel();\n\n\t\t// on macOS ctrl+click is interpreted as right click\n\t\tif (!e.event.rightButton && !(isMacintosh && e.event.leftButton && e.event.ctrlKey) && !force\n\t\t\t|| e.target.type !== MouseTargetType.GUTTER_LINE_NUMBERS && e.target.type !== MouseTargetType.GUTTER_GLYPH_MARGIN\n\t\t\t|| !e.target.position || !model\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lineNumber = e.target.position.lineNumber;\n\n\t\tconst contextKeyService = this.contextKeyService.createOverlay([['editorLineNumber', lineNumber]]);\n\t\tconst menu = this.menuService.createMenu(MenuId.EditorLineNumberContext, contextKeyService);\n\n\t\tconst allActions: [string, (IAction | MenuItemAction | SubmenuItemAction)[]][] = [];\n\n\t\tthis.instantiationService.invokeFunction(accessor => {\n\t\t\tfor (const generator of GutterActionsRegistry.getGutterActionsGenerators()) {\n\t\t\t\tconst collectedActions = new Map<string, IAction[]>();\n\t\t\t\tgenerator({ lineNumber, editor: this.editor, accessor }, {\n\t\t\t\t\tpush: (action: IAction, group: string = 'navigation') => {\n\t\t\t\t\t\tconst actions = (collectedActions.get(group) ?? []);\n\t\t\t\t\t\tactions.push(action);\n\t\t\t\t\t\tcollectedActions.set(group, actions);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tfor (const [group, actions] of collectedActions.entries()) {\n\t\t\t\t\tallActions.push([group, actions]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tallActions.sort((a, b) => a[0].localeCompare(b[0]));\n\n\t\t\tconst menuActions = menu.getActions({ arg: { lineNumber, uri: model.uri }, shouldForwardArgs: true });\n\t\t\tallActions.push(...menuActions);\n\n\t\t\t// if the current editor selections do not contain the target line number,\n\t\t\t// set the selection to the clicked line number\n\t\t\tif (e.target.type === MouseTargetType.GUTTER_LINE_NUMBERS) {\n\t\t\t\tconst currentSelections = this.editor.getSelections();\n\t\t\t\tconst lineRange = {\n\t\t\t\t\tstartLineNumber: lineNumber,\n\t\t\t\t\tendLineNumber: lineNumber,\n\t\t\t\t\tstartColumn: 1,\n\t\t\t\t\tendColumn: model.getLineLength(lineNumber) + 1\n\t\t\t\t};\n\t\t\t\tconst containsSelection = currentSelections?.some(selection => !selection.isEmpty() && selection.intersectRanges(lineRange) !== null);\n\t\t\t\tif (!containsSelection) {\n\t\t\t\t\tthis.editor.setSelection(lineRange, TextEditorSelectionSource.PROGRAMMATIC);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.contextMenuService.showContextMenu({\n\t\t\t\tgetAnchor: () => e.event,\n\t\t\t\tgetActions: () => Separator.join(...allActions.map((a) => a[1])),\n\t\t\t\tonHide: () => menu.dispose(),\n\t\t\t});\n\t\t});\n\t}\n}\n\nregisterEditorContribution(EditorLineNumberContextMenu.ID, EditorLineNumberContextMenu, EditorContributionInstantiation.AfterFirstRender);\n"]}