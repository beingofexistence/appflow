{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/webviewView/browser/webviewViewPane.ts"],"names":[],"mappings":"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","file":"webviewViewPane.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { addDisposableListener, Dimension, EventType, findParentWithClass } from 'vs/base/browser/dom';\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { Emitter } from 'vs/base/common/event';\nimport { DisposableStore, IDisposable, MutableDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { MenuId } from 'vs/platform/actions/common/actions';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { IOpenerService } from 'vs/platform/opener/common/opener';\nimport { IProgressService } from 'vs/platform/progress/common/progress';\nimport { IStorageService, StorageScope, StorageTarget } from 'vs/platform/storage/common/storage';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { ViewPane, ViewPaneShowActions } from 'vs/workbench/browser/parts/views/viewPane';\nimport { IViewletViewOptions } from 'vs/workbench/browser/parts/views/viewsViewlet';\nimport { Memento, MementoObject } from 'vs/workbench/common/memento';\nimport { IViewBadge, IViewDescriptorService, IViewsService } from 'vs/workbench/common/views';\nimport { ExtensionKeyedWebviewOriginStore, IOverlayWebview, IWebviewService, WebviewContentPurpose } from 'vs/workbench/contrib/webview/browser/webview';\nimport { WebviewWindowDragMonitor } from 'vs/workbench/contrib/webview/browser/webviewWindowDragMonitor';\nimport { IWebviewViewService, WebviewView } from 'vs/workbench/contrib/webviewView/browser/webviewViewService';\nimport { IActivityService, NumberBadge } from 'vs/workbench/services/activity/common/activity';\nimport { IExtensionService } from 'vs/workbench/services/extensions/common/extensions';\n\ndeclare const ResizeObserver: any;\n\nconst storageKeys = {\n\twebviewState: 'webviewState',\n} as const;\n\nexport class WebviewViewPane extends ViewPane {\n\n\tprivate static _originStore?: ExtensionKeyedWebviewOriginStore;\n\n\tprivate static getOriginStore(storageService: IStorageService): ExtensionKeyedWebviewOriginStore {\n\t\tthis._originStore ??= new ExtensionKeyedWebviewOriginStore('webviewViews.origins', storageService);\n\t\treturn this._originStore;\n\t}\n\n\tprivate readonly _webview = this._register(new MutableDisposable<IOverlayWebview>());\n\tprivate readonly _webviewDisposables = this._register(new DisposableStore());\n\tprivate _activated = false;\n\n\tprivate _container?: HTMLElement;\n\tprivate _rootContainer?: HTMLElement;\n\tprivate _resizeObserver?: any;\n\n\tprivate readonly defaultTitle: string;\n\tprivate setTitle: string | undefined;\n\n\tprivate badge: IViewBadge | undefined;\n\tprivate activity: IDisposable | undefined;\n\n\tprivate readonly memento: Memento;\n\tprivate readonly viewState: MementoObject;\n\tprivate readonly extensionId?: ExtensionIdentifier;\n\n\tprivate _repositionTimeout?: any;\n\n\tconstructor(\n\t\toptions: IViewletViewOptions,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IViewDescriptorService viewDescriptorService: IViewDescriptorService,\n\t\t@IActivityService private readonly activityService: IActivityService,\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IViewsService private readonly viewService: IViewsService,\n\t\t@IWebviewService private readonly webviewService: IWebviewService,\n\t\t@IWebviewViewService private readonly webviewViewService: IWebviewViewService,\n\t) {\n\t\tsuper({ ...options, titleMenuId: MenuId.ViewTitle, showActions: ViewPaneShowActions.WhenExpanded }, keybindingService, contextMenuService, configurationService, contextKeyService, viewDescriptorService, instantiationService, openerService, themeService, telemetryService);\n\t\tthis.extensionId = options.fromExtensionId;\n\t\tthis.defaultTitle = this.title;\n\n\t\tthis.memento = new Memento(`webviewView.${this.id}`, storageService);\n\t\tthis.viewState = this.memento.getMemento(StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\n\t\tthis._register(this.onDidChangeBodyVisibility(() => this.updateTreeVisibility()));\n\n\t\tthis._register(this.webviewViewService.onNewResolverRegistered(e => {\n\t\t\tif (e.viewType === this.id) {\n\t\t\t\t// Potentially re-activate if we have a new resolver\n\t\t\t\tthis.updateTreeVisibility();\n\t\t\t}\n\t\t}));\n\n\t\tthis.updateTreeVisibility();\n\t}\n\n\tprivate readonly _onDidChangeVisibility = this._register(new Emitter<boolean>());\n\treadonly onDidChangeVisibility = this._onDidChangeVisibility.event;\n\n\tprivate readonly _onDispose = this._register(new Emitter<void>());\n\treadonly onDispose = this._onDispose.event;\n\n\toverride dispose() {\n\t\tthis._onDispose.fire();\n\n\t\tclearTimeout(this._repositionTimeout);\n\n\t\tsuper.dispose();\n\t}\n\n\toverride focus(): void {\n\t\tsuper.focus();\n\t\tthis._webview.value?.focus();\n\t}\n\n\tprotected override renderBody(container: HTMLElement): void {\n\t\tsuper.renderBody(container);\n\n\t\tthis._container = container;\n\t\tthis._rootContainer = undefined;\n\n\t\tif (!this._resizeObserver) {\n\t\t\tthis._resizeObserver = new ResizeObserver(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.layoutWebview();\n\t\t\t\t}, 0);\n\t\t\t});\n\n\t\t\tthis._register(toDisposable(() => {\n\t\t\t\tthis._resizeObserver.disconnect();\n\t\t\t}));\n\t\t\tthis._resizeObserver.observe(container);\n\t\t}\n\t}\n\n\tpublic override saveState() {\n\t\tif (this._webview.value) {\n\t\t\tthis.viewState[storageKeys.webviewState] = this._webview.value.state;\n\t\t}\n\n\t\tthis.memento.saveMemento();\n\t\tsuper.saveState();\n\t}\n\n\tprotected override layoutBody(height: number, width: number): void {\n\t\tsuper.layoutBody(height, width);\n\n\t\tthis.layoutWebview(new Dimension(width, height));\n\t}\n\n\tprivate updateTreeVisibility() {\n\t\tif (this.isBodyVisible()) {\n\t\t\tthis.activate();\n\t\t\tthis._webview.value?.claim(this, undefined);\n\t\t} else {\n\t\t\tthis._webview.value?.release(this);\n\t\t}\n\t}\n\n\tprivate activate() {\n\t\tif (this._activated) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._activated = true;\n\n\t\tconst origin = this.extensionId ? WebviewViewPane.getOriginStore(this.storageService).getOrigin(this.id, this.extensionId) : undefined;\n\t\tconst webview = this.webviewService.createWebviewOverlay({\n\t\t\torigin,\n\t\t\tprovidedViewType: this.id,\n\t\t\ttitle: this.title,\n\t\t\toptions: { purpose: WebviewContentPurpose.WebviewView },\n\t\t\tcontentOptions: {},\n\t\t\textension: this.extensionId ? { id: this.extensionId } : undefined\n\t\t});\n\t\twebview.state = this.viewState[storageKeys.webviewState];\n\t\tthis._webview.value = webview;\n\n\t\tif (this._container) {\n\t\t\tthis.layoutWebview();\n\t\t}\n\n\t\tthis._webviewDisposables.add(toDisposable(() => {\n\t\t\tthis._webview.value?.release(this);\n\t\t}));\n\n\t\tthis._webviewDisposables.add(webview.onDidUpdateState(() => {\n\t\t\tthis.viewState[storageKeys.webviewState] = webview.state;\n\t\t}));\n\n\t\t// Re-dispatch all drag events back to the drop target to support view drag drop\n\t\tfor (const event of [EventType.DRAG, EventType.DRAG_END, EventType.DRAG_ENTER, EventType.DRAG_LEAVE, EventType.DRAG_START]) {\n\t\t\tthis._webviewDisposables.add(addDisposableListener(this._webview.value.container!, event, e => {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\tthis.dropTargetElement.dispatchEvent(new DragEvent(e.type, e));\n\t\t\t}));\n\t\t}\n\n\t\tthis._webviewDisposables.add(new WebviewWindowDragMonitor(() => this._webview.value));\n\n\t\tconst source = this._webviewDisposables.add(new CancellationTokenSource());\n\n\t\tthis.withProgress(async () => {\n\t\t\tawait this.extensionService.activateByEvent(`onView:${this.id}`);\n\n\t\t\tconst self = this;\n\t\t\tconst webviewView: WebviewView = {\n\t\t\t\twebview,\n\t\t\t\tonDidChangeVisibility: this.onDidChangeBodyVisibility,\n\t\t\t\tonDispose: this.onDispose,\n\n\t\t\t\tget title(): string | undefined { return self.setTitle; },\n\t\t\t\tset title(value: string | undefined) { self.updateTitle(value); },\n\n\t\t\t\tget description(): string | undefined { return self.titleDescription; },\n\t\t\t\tset description(value: string | undefined) { self.updateTitleDescription(value); },\n\n\t\t\t\tget badge(): IViewBadge | undefined { return self.badge; },\n\t\t\t\tset badge(badge: IViewBadge | undefined) { self.updateBadge(badge); },\n\n\t\t\t\tdispose: () => {\n\t\t\t\t\t// Only reset and clear the webview itself. Don't dispose of the view container\n\t\t\t\t\tthis._activated = false;\n\t\t\t\t\tthis._webview.clear();\n\t\t\t\t\tthis._webviewDisposables.clear();\n\t\t\t\t},\n\n\t\t\t\tshow: (preserveFocus) => {\n\t\t\t\t\tthis.viewService.openView(this.id, !preserveFocus);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tawait this.webviewViewService.resolve(this.id, webviewView, source.token);\n\t\t});\n\t}\n\n\tprotected override updateTitle(value: string | undefined) {\n\t\tthis.setTitle = value;\n\t\tsuper.updateTitle(typeof value === 'string' ? value : this.defaultTitle);\n\t}\n\n\tprotected updateBadge(badge: IViewBadge | undefined) {\n\n\t\tif (this.badge?.value === badge?.value &&\n\t\t\tthis.badge?.tooltip === badge?.tooltip) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.activity) {\n\t\t\tthis.activity.dispose();\n\t\t\tthis.activity = undefined;\n\t\t}\n\n\t\tthis.badge = badge;\n\t\tif (badge) {\n\t\t\tconst activity = {\n\t\t\t\tbadge: new NumberBadge(badge.value, () => badge.tooltip),\n\t\t\t\tpriority: 150\n\t\t\t};\n\t\t\tthis.activityService.showViewActivity(this.id, activity);\n\t\t}\n\t}\n\n\tprivate async withProgress(task: () => Promise<void>): Promise<void> {\n\t\treturn this.progressService.withProgress({ location: this.id, delay: 500 }, task);\n\t}\n\n\toverride onDidScrollRoot() {\n\t\tthis.layoutWebview();\n\t}\n\n\tprivate doLayoutWebview(dimension?: Dimension) {\n\t\tconst webviewEntry = this._webview.value;\n\t\tif (!this._container || !webviewEntry) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._rootContainer || !this._rootContainer.isConnected) {\n\t\t\tthis._rootContainer = this.findRootContainer(this._container);\n\t\t}\n\n\t\twebviewEntry.layoutWebviewOverElement(this._container, dimension, this._rootContainer);\n\t}\n\n\tprivate layoutWebview(dimension?: Dimension) {\n\t\tthis.doLayoutWebview(dimension);\n\t\t// Temporary fix for https://github.com/microsoft/vscode/issues/110450\n\t\t// There is an animation that lasts about 200ms, update the webview positioning once this animation is complete.\n\t\tclearTimeout(this._repositionTimeout);\n\t\tthis._repositionTimeout = setTimeout(() => this.doLayoutWebview(dimension), 200);\n\t}\n\n\tprivate findRootContainer(container: HTMLElement): HTMLElement | undefined {\n\t\treturn findParentWithClass(container, 'monaco-scrollable-element') ?? undefined;\n\t}\n}\n"]}