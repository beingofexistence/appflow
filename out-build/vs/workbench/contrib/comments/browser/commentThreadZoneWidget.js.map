{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/comments/browser/commentThreadZoneWidget.ts"],"names":[],"mappings":"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","file":"commentThreadZoneWidget.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from 'vs/base/browser/dom';\nimport { Color } from 'vs/base/common/color';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IDisposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { ICodeEditor, IEditorMouseEvent, MouseTargetType } from 'vs/editor/browser/editorBrowser';\nimport { IPosition } from 'vs/editor/common/core/position';\nimport { IRange, Range } from 'vs/editor/common/core/range';\nimport * as languages from 'vs/editor/common/languages';\nimport { ZoneWidget } from 'vs/editor/contrib/zoneWidget/browser/zoneWidget';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IColorTheme, IThemeService } from 'vs/platform/theme/common/themeService';\nimport { CommentGlyphWidget } from 'vs/workbench/contrib/comments/browser/commentGlyphWidget';\nimport { ICommentService } from 'vs/workbench/contrib/comments/browser/commentService';\nimport { ICommentThreadWidget } from 'vs/workbench/contrib/comments/common/commentThreadWidget';\nimport { EDITOR_FONT_DEFAULTS, EditorOption, IEditorOptions } from 'vs/editor/common/config/editorOptions';\nimport { ServiceCollection } from 'vs/platform/instantiation/common/serviceCollection';\nimport { CommentThreadWidget } from 'vs/workbench/contrib/comments/browser/commentThreadWidget';\nimport { ICellRange } from 'vs/workbench/contrib/notebook/common/notebookRange';\nimport { commentThreadStateBackgroundColorVar, commentThreadStateColorVar, getCommentThreadStateBorderColor } from 'vs/workbench/contrib/comments/browser/commentColors';\nimport { peekViewBorder } from 'vs/editor/contrib/peekView/browser/peekView';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\n\nfunction getCommentThreadWidgetStateColor(thread: languages.CommentThreadState | undefined, theme: IColorTheme): Color | undefined {\n\treturn getCommentThreadStateBorderColor(thread, theme) ?? theme.getColor(peekViewBorder);\n}\n\nexport function parseMouseDownInfoFromEvent(e: IEditorMouseEvent) {\n\tconst range = e.target.range;\n\n\tif (!range) {\n\t\treturn null;\n\t}\n\n\tif (!e.event.leftButton) {\n\t\treturn null;\n\t}\n\n\tif (e.target.type !== MouseTargetType.GUTTER_LINE_DECORATIONS) {\n\t\treturn null;\n\t}\n\n\tconst data = e.target.detail;\n\tconst gutterOffsetX = data.offsetX - data.glyphMarginWidth - data.lineNumbersWidth - data.glyphMarginLeft;\n\n\t// don't collide with folding and git decorations\n\tif (gutterOffsetX > 20) {\n\t\treturn null;\n\t}\n\n\treturn { lineNumber: range.startLineNumber };\n}\n\nexport function isMouseUpEventDragFromMouseDown(mouseDownInfo: { lineNumber: number } | null, e: IEditorMouseEvent) {\n\tif (!mouseDownInfo) {\n\t\treturn null;\n\t}\n\n\tconst { lineNumber } = mouseDownInfo;\n\n\tconst range = e.target.range;\n\n\tif (!range) {\n\t\treturn null;\n\t}\n\n\treturn lineNumber;\n}\n\nexport function isMouseUpEventMatchMouseDown(mouseDownInfo: { lineNumber: number } | null, e: IEditorMouseEvent) {\n\tif (!mouseDownInfo) {\n\t\treturn null;\n\t}\n\n\tconst { lineNumber } = mouseDownInfo;\n\n\tconst range = e.target.range;\n\n\tif (!range || range.startLineNumber !== lineNumber) {\n\t\treturn null;\n\t}\n\n\tif (e.target.type !== MouseTargetType.GUTTER_LINE_DECORATIONS) {\n\t\treturn null;\n\t}\n\n\treturn lineNumber;\n}\n\nexport class ReviewZoneWidget extends ZoneWidget implements ICommentThreadWidget {\n\tprivate _commentThreadWidget!: CommentThreadWidget;\n\tprivate readonly _onDidClose = new Emitter<ReviewZoneWidget | undefined>();\n\tprivate readonly _onDidCreateThread = new Emitter<ReviewZoneWidget>();\n\tprivate _isExpanded?: boolean;\n\tprivate _initialCollapsibleState?: languages.CommentThreadCollapsibleState;\n\tprivate _commentGlyph?: CommentGlyphWidget;\n\tprivate readonly _globalToDispose = new DisposableStore();\n\tprivate _commentThreadDisposables: IDisposable[] = [];\n\tprivate _contextKeyService: IContextKeyService;\n\tprivate _scopedInstantiationService: IInstantiationService;\n\n\tpublic get owner(): string {\n\t\treturn this._owner;\n\t}\n\tpublic get commentThread(): languages.CommentThread {\n\t\treturn this._commentThread;\n\t}\n\n\tpublic get expanded(): boolean | undefined {\n\t\treturn this._isExpanded;\n\t}\n\n\tprivate _commentOptions: languages.CommentOptions | undefined;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\tprivate _owner: string,\n\t\tprivate _commentThread: languages.CommentThread,\n\t\tprivate _pendingComment: string | undefined,\n\t\tprivate _pendingEdits: { [key: number]: string } | undefined,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IThemeService private themeService: IThemeService,\n\t\t@ICommentService private commentService: ICommentService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService\n\t) {\n\t\tsuper(editor, { keepEditorSelection: true, isAccessible: true });\n\t\tthis._contextKeyService = contextKeyService.createScoped(this.domNode);\n\n\t\tthis._scopedInstantiationService = instantiationService.createChild(new ServiceCollection(\n\t\t\t[IContextKeyService, this._contextKeyService]\n\t\t));\n\n\t\tconst controller = this.commentService.getCommentController(this._owner);\n\t\tif (controller) {\n\t\t\tthis._commentOptions = controller.options;\n\t\t}\n\n\t\tthis._initialCollapsibleState = _commentThread.initialCollapsibleState;\n\t\tthis._isExpanded = _commentThread.initialCollapsibleState === languages.CommentThreadCollapsibleState.Expanded;\n\t\tthis._commentThreadDisposables = [];\n\t\tthis.create();\n\n\t\tthis._globalToDispose.add(this.themeService.onDidColorThemeChange(this._applyTheme, this));\n\t\tthis._globalToDispose.add(this.editor.onDidChangeConfiguration(e => {\n\t\t\tif (e.hasChanged(EditorOption.fontInfo)) {\n\t\t\t\tthis._applyTheme(this.themeService.getColorTheme());\n\t\t\t}\n\t\t}));\n\t\tthis._applyTheme(this.themeService.getColorTheme());\n\n\t}\n\n\tpublic get onDidClose(): Event<ReviewZoneWidget | undefined> {\n\t\treturn this._onDidClose.event;\n\t}\n\n\tpublic get onDidCreateThread(): Event<ReviewZoneWidget> {\n\t\treturn this._onDidCreateThread.event;\n\t}\n\n\tpublic getPosition(): IPosition | undefined {\n\t\tif (this.position) {\n\t\t\treturn this.position;\n\t\t}\n\n\t\tif (this._commentGlyph) {\n\t\t\treturn this._commentGlyph.getPosition().position ?? undefined;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprotected override revealRange() {\n\t\t// we don't do anything here as we always do the reveal ourselves.\n\t}\n\n\tpublic reveal(commentUniqueId?: number, focus: boolean = false) {\n\t\tif (!this._isExpanded) {\n\t\t\tthis.show(this.arrowPosition(this._commentThread.range), 2);\n\t\t}\n\n\t\tif (commentUniqueId !== undefined) {\n\t\t\tconst height = this.editor.getLayoutInfo().height;\n\t\t\tconst coords = this._commentThreadWidget.getCommentCoords(commentUniqueId);\n\t\t\tif (coords) {\n\t\t\t\tlet scrollTop: number = 1;\n\t\t\t\tif (this._commentThread.range) {\n\t\t\t\t\tconst commentThreadCoords = coords.thread;\n\t\t\t\t\tconst commentCoords = coords.comment;\n\t\t\t\t\tscrollTop = this.editor.getTopForLineNumber(this._commentThread.range.startLineNumber) - height / 2 + commentCoords.top - commentThreadCoords.top;\n\t\t\t\t}\n\t\t\t\tthis.editor.setScrollTop(scrollTop);\n\t\t\t\tif (focus) {\n\t\t\t\t\tthis._commentThreadWidget.focus();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.editor.revealRangeInCenter(this._commentThread.range ?? new Range(1, 1, 1, 1));\n\t\tif (focus) {\n\t\t\tthis._commentThreadWidget.focus();\n\t\t}\n\t}\n\n\tpublic getPendingComments(): { newComment: string | undefined; edits: { [key: number]: string } } {\n\t\treturn {\n\t\t\tnewComment: this._commentThreadWidget.getPendingComment(),\n\t\t\tedits: this._commentThreadWidget.getPendingEdits()\n\t\t};\n\t}\n\n\tprotected _fillContainer(container: HTMLElement): void {\n\t\tthis.setCssClass('review-widget');\n\t\tthis._commentThreadWidget = this._scopedInstantiationService.createInstance(\n\t\t\tCommentThreadWidget,\n\t\t\tcontainer,\n\t\t\tthis._owner,\n\t\t\tthis.editor.getModel()!.uri,\n\t\t\tthis._contextKeyService,\n\t\t\tthis._scopedInstantiationService,\n\t\t\tthis._commentThread as unknown as languages.CommentThread<IRange | ICellRange>,\n\t\t\tthis._pendingComment,\n\t\t\tthis._pendingEdits,\n\t\t\t{ editor: this.editor, codeBlockFontSize: '', codeBlockFontFamily: this.configurationService.getValue<IEditorOptions>('editor').fontFamily || EDITOR_FONT_DEFAULTS.fontFamily },\n\t\t\tthis._commentOptions,\n\t\t\t{\n\t\t\t\tactionRunner: () => {\n\t\t\t\t\tif (!this._commentThread.comments || !this._commentThread.comments.length) {\n\t\t\t\t\t\tconst newPosition = this.getPosition();\n\n\t\t\t\t\t\tif (newPosition) {\n\t\t\t\t\t\t\tconst originalRange = this._commentThread.range;\n\t\t\t\t\t\t\tif (!originalRange) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlet range: Range;\n\n\t\t\t\t\t\t\tif (newPosition.lineNumber !== originalRange.endLineNumber) {\n\t\t\t\t\t\t\t\t// The widget could have moved as a result of editor changes.\n\t\t\t\t\t\t\t\t// We need to try to calculate the new, more correct, range for the comment.\n\t\t\t\t\t\t\t\tconst distance = newPosition.lineNumber - originalRange.endLineNumber;\n\t\t\t\t\t\t\t\trange = new Range(originalRange.startLineNumber + distance, originalRange.startColumn, originalRange.endLineNumber + distance, originalRange.endColumn);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trange = new Range(originalRange.startLineNumber, originalRange.startColumn, originalRange.endLineNumber, originalRange.endColumn);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.commentService.updateCommentThreadTemplate(this.owner, this._commentThread.commentThreadHandle, range);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcollapse: () => {\n\t\t\t\t\tthis.collapse();\n\t\t\t\t}\n\t\t\t}\n\t\t) as unknown as CommentThreadWidget<IRange>;\n\n\t\tthis._disposables.add(this._commentThreadWidget);\n\t}\n\n\tprivate arrowPosition(range: IRange | undefined): IPosition | undefined {\n\t\tif (!range) {\n\t\t\treturn undefined;\n\t\t}\n\t\t// Arrow on top edge of zone widget will be at the start of the line if range is multi-line, else at midpoint of range (rounding rightwards)\n\t\treturn { lineNumber: range.endLineNumber, column: range.endLineNumber === range.startLineNumber ? (range.startColumn + range.endColumn + 1) / 2 : 1 };\n\t}\n\n\tprivate deleteCommentThread(): void {\n\t\tthis.dispose();\n\t\tthis.commentService.disposeCommentThread(this.owner, this._commentThread.threadId);\n\t}\n\n\tpublic collapse() {\n\t\tthis._commentThread.collapsibleState = languages.CommentThreadCollapsibleState.Collapsed;\n\t}\n\n\tpublic expand() {\n\t\tthis._commentThread.collapsibleState = languages.CommentThreadCollapsibleState.Expanded;\n\t}\n\n\tpublic getGlyphPosition(): number {\n\t\tif (this._commentGlyph) {\n\t\t\treturn this._commentGlyph.getPosition().position!.lineNumber;\n\t\t}\n\t\treturn 0;\n\t}\n\n\ttoggleExpand() {\n\t\tif (this._isExpanded) {\n\t\t\tthis._commentThread.collapsibleState = languages.CommentThreadCollapsibleState.Collapsed;\n\t\t} else {\n\t\t\tthis._commentThread.collapsibleState = languages.CommentThreadCollapsibleState.Expanded;\n\t\t}\n\t}\n\n\tasync update(commentThread: languages.CommentThread<IRange>) {\n\t\tif (this._commentThread !== commentThread) {\n\t\t\tthis._commentThreadDisposables.forEach(disposable => disposable.dispose());\n\t\t\tthis._commentThread = commentThread;\n\t\t\tthis._commentThreadDisposables = [];\n\t\t\tthis.bindCommentThreadListeners();\n\t\t}\n\n\t\tthis._commentThreadWidget.updateCommentThread(commentThread);\n\n\t\t// Move comment glyph widget and show position if the line has changed.\n\t\tconst lineNumber = this._commentThread.range?.endLineNumber ?? 1;\n\t\tlet shouldMoveWidget = false;\n\t\tif (this._commentGlyph) {\n\t\t\tthis._commentGlyph.setThreadState(commentThread.state);\n\t\t\tif (this._commentGlyph.getPosition().position!.lineNumber !== lineNumber) {\n\t\t\t\tshouldMoveWidget = true;\n\t\t\t\tthis._commentGlyph.setLineNumber(lineNumber);\n\t\t\t}\n\t\t}\n\n\t\tif (shouldMoveWidget && this._isExpanded) {\n\t\t\tthis.show(this.arrowPosition(this._commentThread.range), 2);\n\t\t}\n\n\t\tif (this._commentThread.collapsibleState === languages.CommentThreadCollapsibleState.Expanded) {\n\t\t\tthis.show(this.arrowPosition(this._commentThread.range), 2);\n\t\t} else {\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\tprotected override _onWidth(widthInPixel: number): void {\n\t\tthis._commentThreadWidget.layout(widthInPixel);\n\t}\n\n\tprotected override _doLayout(heightInPixel: number, widthInPixel: number): void {\n\t\tthis._commentThreadWidget.layout(widthInPixel);\n\t}\n\n\tdisplay(range: IRange | undefined) {\n\t\tif (range) {\n\t\t\tthis._commentGlyph = new CommentGlyphWidget(this.editor, range?.endLineNumber ?? -1);\n\t\t\tthis._commentGlyph.setThreadState(this._commentThread.state);\n\t\t}\n\n\t\tthis._commentThreadWidget.display(this.editor.getOption(EditorOption.lineHeight));\n\t\tthis._disposables.add(this._commentThreadWidget.onDidResize(dimension => {\n\t\t\tthis._refresh(dimension);\n\t\t}));\n\t\tif ((this._commentThread.collapsibleState === languages.CommentThreadCollapsibleState.Expanded) || (range === undefined)) {\n\t\t\tthis.show(this.arrowPosition(range), 2);\n\t\t}\n\n\t\t// If this is a new comment thread awaiting user input then we need to reveal it.\n\t\tif (this._commentThread.canReply && this._commentThread.isTemplate && (!this._commentThread.comments || (this._commentThread.comments.length === 0))) {\n\t\t\tthis.reveal();\n\t\t}\n\n\t\tthis.bindCommentThreadListeners();\n\t}\n\n\tprivate bindCommentThreadListeners() {\n\t\tthis._commentThreadDisposables.push(this._commentThread.onDidChangeComments(async _ => {\n\t\t\tawait this.update(this._commentThread);\n\t\t}));\n\n\t\tthis._commentThreadDisposables.push(this._commentThread.onDidChangeRange(range => {\n\t\t\t// Move comment glyph widget and show position if the line has changed.\n\t\t\tconst lineNumber = this._commentThread.range?.startLineNumber ?? 1;\n\t\t\tlet shouldMoveWidget = false;\n\t\t\tif (this._commentGlyph) {\n\t\t\t\tif (this._commentGlyph.getPosition().position!.lineNumber !== lineNumber) {\n\t\t\t\t\tshouldMoveWidget = true;\n\t\t\t\t\tthis._commentGlyph.setLineNumber(lineNumber);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (shouldMoveWidget && this._isExpanded) {\n\t\t\t\tthis.show(this.arrowPosition(this._commentThread.range), 2);\n\t\t\t}\n\t\t}));\n\n\t\tthis._commentThreadDisposables.push(this._commentThread.onDidChangeCollapsibleState(state => {\n\t\t\tif (state === languages.CommentThreadCollapsibleState.Expanded && !this._isExpanded) {\n\t\t\t\tthis.show(this.arrowPosition(this._commentThread.range), 2);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (state === languages.CommentThreadCollapsibleState.Collapsed && this._isExpanded) {\n\t\t\t\tthis.hide();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}));\n\n\t\tif (this._initialCollapsibleState === undefined) {\n\t\t\tconst onDidChangeInitialCollapsibleState = this._commentThread.onDidChangeInitialCollapsibleState(state => {\n\t\t\t\t// File comments always start expanded\n\t\t\t\tthis._initialCollapsibleState = this._commentThread.range ? state : languages.CommentThreadCollapsibleState.Expanded;\n\t\t\t\tthis._commentThread.collapsibleState = this._initialCollapsibleState;\n\t\t\t\tonDidChangeInitialCollapsibleState.dispose();\n\t\t\t});\n\t\t\tthis._commentThreadDisposables.push(onDidChangeInitialCollapsibleState);\n\t\t}\n\n\n\t\tthis._commentThreadDisposables.push(this._commentThread.onDidChangeState(() => {\n\t\t\tconst borderColor =\n\t\t\t\tgetCommentThreadWidgetStateColor(this._commentThread.state, this.themeService.getColorTheme()) || Color.transparent;\n\t\t\tthis.style({\n\t\t\t\tframeColor: borderColor,\n\t\t\t\tarrowColor: borderColor,\n\t\t\t});\n\t\t\tthis.container?.style.setProperty(commentThreadStateColorVar, `${borderColor}`);\n\t\t\tthis.container?.style.setProperty(commentThreadStateBackgroundColorVar, `${borderColor.transparent(.1)}`);\n\t\t}));\n\t}\n\n\tasync submitComment(): Promise<void> {\n\t\treturn this._commentThreadWidget.submitComment();\n\t}\n\n\t_refresh(dimensions: dom.Dimension) {\n\t\tif (dimensions.height === 0 && dimensions.width === 0) {\n\t\t\tthis.commentThread.collapsibleState = languages.CommentThreadCollapsibleState.Collapsed;\n\t\t\treturn;\n\t\t}\n\t\tif (this._isExpanded) {\n\t\t\tthis._commentThreadWidget.layout();\n\n\t\t\tconst headHeight = Math.ceil(this.editor.getOption(EditorOption.lineHeight) * 1.2);\n\t\t\tconst lineHeight = this.editor.getOption(EditorOption.lineHeight);\n\t\t\tconst arrowHeight = Math.round(lineHeight / 3);\n\t\t\tconst frameThickness = Math.round(lineHeight / 9) * 2;\n\n\t\t\tconst computedLinesNumber = Math.ceil((headHeight + dimensions.height + arrowHeight + frameThickness + 8 /** margin bottom to avoid margin collapse */) / lineHeight);\n\n\t\t\tif (this._viewZone?.heightInLines === computedLinesNumber) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentPosition = this.getPosition();\n\n\t\t\tif (this._viewZone && currentPosition && currentPosition.lineNumber !== this._viewZone.afterLineNumber && this._viewZone.afterLineNumber !== 0) {\n\t\t\t\tthis._viewZone.afterLineNumber = currentPosition.lineNumber;\n\t\t\t}\n\n\t\t\tif (!this._commentThread.comments || !this._commentThread.comments.length) {\n\t\t\t\tthis._commentThreadWidget.focusCommentEditor();\n\t\t\t}\n\n\t\t\tthis._relayout(computedLinesNumber);\n\t\t}\n\t}\n\n\tprivate _applyTheme(theme: IColorTheme) {\n\t\tconst borderColor = getCommentThreadWidgetStateColor(this._commentThread.state, this.themeService.getColorTheme()) || Color.transparent;\n\t\tthis.style({\n\t\t\tarrowColor: borderColor,\n\t\t\tframeColor: borderColor\n\t\t});\n\t\tconst fontInfo = this.editor.getOption(EditorOption.fontInfo);\n\n\t\t// Editor decorations should also be responsive to theme changes\n\t\tthis._commentThreadWidget.applyTheme(theme, fontInfo);\n\t}\n\n\toverride show(rangeOrPos: IRange | IPosition | undefined, heightInLines: number): void {\n\t\tthis._isExpanded = true;\n\t\tsuper.show(rangeOrPos ?? new Range(0, 0, 0, 0), heightInLines);\n\t\tthis._commentThread.collapsibleState = languages.CommentThreadCollapsibleState.Expanded;\n\t\tthis._refresh(this._commentThreadWidget.getDimensions());\n\t}\n\n\toverride hide() {\n\t\tif (this._isExpanded) {\n\t\t\tthis._isExpanded = false;\n\t\t\t// Focus the container so that the comment editor will be blurred before it is hidden\n\t\t\tif (this.editor.hasWidgetFocus()) {\n\t\t\t\tthis.editor.focus();\n\t\t\t}\n\n\t\t\tif (!this._commentThread.comments || !this._commentThread.comments.length) {\n\t\t\t\tthis.deleteCommentThread();\n\t\t\t}\n\t\t}\n\t\tsuper.hide();\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\n\t\tif (this._commentGlyph) {\n\t\t\tthis._commentGlyph.dispose();\n\t\t\tthis._commentGlyph = undefined;\n\t\t}\n\n\t\tthis._globalToDispose.dispose();\n\t\tthis._commentThreadDisposables.forEach(global => global.dispose());\n\t\tthis._onDidClose.fire(undefined);\n\t}\n}\n"]}