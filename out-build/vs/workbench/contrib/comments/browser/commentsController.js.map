{"version":3,"sources":["vs/workbench/contrib/comments/browser/commentsController.ts"],"names":[],"mappings":"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","file":"commentsController.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Action, IAction } from 'vs/base/common/actions';\nimport { coalesce } from 'vs/base/common/arrays';\nimport { findFirstIdxMonotonousOrArrLen } from 'vs/base/common/arraysFind';\nimport { CancelablePromise, createCancelablePromise, Delayer } from 'vs/base/common/async';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { DisposableStore, dispose, IDisposable } from 'vs/base/common/lifecycle';\nimport 'vs/css!./media/review';\nimport { ICodeEditor, IEditorMouseEvent } from 'vs/editor/browser/editorBrowser';\nimport { ICodeEditorService } from 'vs/editor/browser/services/codeEditorService';\nimport { IRange, Range } from 'vs/editor/common/core/range';\nimport { EditorType, IDiffEditor, IEditorContribution } from 'vs/editor/common/editorCommon';\nimport { IModelDecorationOptions, IModelDeltaDecoration } from 'vs/editor/common/model';\nimport { ModelDecorationOptions } from 'vs/editor/common/model/textModel';\nimport * as languages from 'vs/editor/common/languages';\nimport * as nls from 'vs/nls';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IQuickInputService, IQuickPickItem, QuickPickInput } from 'vs/platform/quickinput/common/quickInput';\nimport { CommentGlyphWidget } from 'vs/workbench/contrib/comments/browser/commentGlyphWidget';\nimport { ICommentInfo, ICommentService } from 'vs/workbench/contrib/comments/browser/commentService';\nimport { isMouseUpEventDragFromMouseDown, parseMouseDownInfoFromEvent, ReviewZoneWidget } from 'vs/workbench/contrib/comments/browser/commentThreadZoneWidget';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { EmbeddedCodeEditorWidget } from 'vs/editor/browser/widget/embeddedCodeEditorWidget';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { IViewsService } from 'vs/workbench/common/views';\nimport { COMMENTS_VIEW_ID } from 'vs/workbench/contrib/comments/browser/commentsTreeViewer';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { COMMENTS_SECTION, ICommentsConfiguration } from 'vs/workbench/contrib/comments/common/commentsConfiguration';\nimport { COMMENTEDITOR_DECORATION_KEY } from 'vs/workbench/contrib/comments/browser/commentReply';\nimport { Emitter } from 'vs/base/common/event';\nimport { IContextKey, IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { Position } from 'vs/editor/common/core/position';\nimport { CommentThreadRangeDecorator } from 'vs/workbench/contrib/comments/browser/commentThreadRangeDecorator';\nimport { ICursorSelectionChangedEvent } from 'vs/editor/common/cursorEvents';\nimport { CommentsPanel } from 'vs/workbench/contrib/comments/browser/commentsView';\nimport { status } from 'vs/base/browser/ui/aria/aria';\nimport { CommentContextKeys } from 'vs/workbench/contrib/comments/common/commentContextKeys';\n\nexport const ID = 'editor.contrib.review';\n\ninterface CommentRangeAction {\n\townerId: string;\n\textensionId: string | undefined;\n\tlabel: string | undefined;\n\tcommentingRangesInfo: languages.CommentingRanges;\n}\n\nclass CommentingRangeDecoration implements IModelDeltaDecoration {\n\tprivate _decorationId: string | undefined;\n\tprivate _startLineNumber: number;\n\tprivate _endLineNumber: number;\n\n\tpublic get id(): string | undefined {\n\t\treturn this._decorationId;\n\t}\n\n\tpublic set id(id: string | undefined) {\n\t\tthis._decorationId = id;\n\t}\n\n\tpublic get range(): IRange {\n\t\treturn {\n\t\t\tstartLineNumber: this._startLineNumber, startColumn: 1,\n\t\t\tendLineNumber: this._endLineNumber, endColumn: 1\n\t\t};\n\t}\n\n\tconstructor(private _editor: ICodeEditor, private _ownerId: string, private _extensionId: string | undefined, private _label: string | undefined, private _range: IRange, public readonly options: ModelDecorationOptions, private commentingRangesInfo: languages.CommentingRanges, public readonly isHover: boolean = false) {\n\t\tthis._startLineNumber = _range.startLineNumber;\n\t\tthis._endLineNumber = _range.endLineNumber;\n\t}\n\n\tpublic getCommentAction(): CommentRangeAction {\n\t\treturn {\n\t\t\textensionId: this._extensionId,\n\t\t\tlabel: this._label,\n\t\t\townerId: this._ownerId,\n\t\t\tcommentingRangesInfo: this.commentingRangesInfo\n\t\t};\n\t}\n\n\tpublic getOriginalRange() {\n\t\treturn this._range;\n\t}\n\n\tpublic getActiveRange() {\n\t\treturn this.id ? this._editor.getModel()!.getDecorationRange(this.id) : undefined;\n\t}\n}\n\nclass CommentingRangeDecorator {\n\tpublic static description = 'commenting-range-decorator';\n\tprivate decorationOptions: ModelDecorationOptions;\n\tprivate hoverDecorationOptions: ModelDecorationOptions;\n\tprivate multilineDecorationOptions: ModelDecorationOptions;\n\tprivate commentingRangeDecorations: CommentingRangeDecoration[] = [];\n\tprivate decorationIds: string[] = [];\n\tprivate _editor: ICodeEditor | undefined;\n\tprivate _infos: ICommentInfo[] | undefined;\n\tprivate _lastHover: number = -1;\n\tprivate _lastSelection: Range | undefined;\n\tprivate _lastSelectionCursor: number | undefined;\n\tprivate _onDidChangeDecorationsCount: Emitter<number> = new Emitter();\n\tpublic readonly onDidChangeDecorationsCount = this._onDidChangeDecorationsCount.event;\n\n\tconstructor() {\n\t\tconst decorationOptions: IModelDecorationOptions = {\n\t\t\tdescription: CommentingRangeDecorator.description,\n\t\t\tisWholeLine: true,\n\t\t\tlinesDecorationsClassName: 'comment-range-glyph comment-diff-added'\n\t\t};\n\n\t\tthis.decorationOptions = ModelDecorationOptions.createDynamic(decorationOptions);\n\n\t\tconst hoverDecorationOptions: IModelDecorationOptions = {\n\t\t\tdescription: CommentingRangeDecorator.description,\n\t\t\tisWholeLine: true,\n\t\t\tlinesDecorationsClassName: `comment-range-glyph line-hover`\n\t\t};\n\n\t\tthis.hoverDecorationOptions = ModelDecorationOptions.createDynamic(hoverDecorationOptions);\n\n\t\tconst multilineDecorationOptions: IModelDecorationOptions = {\n\t\t\tdescription: CommentingRangeDecorator.description,\n\t\t\tisWholeLine: true,\n\t\t\tlinesDecorationsClassName: `comment-range-glyph multiline-add`\n\t\t};\n\n\t\tthis.multilineDecorationOptions = ModelDecorationOptions.createDynamic(multilineDecorationOptions);\n\t}\n\n\tpublic updateHover(hoverLine?: number) {\n\t\tif (this._editor && this._infos && (hoverLine !== this._lastHover)) {\n\t\t\tthis._doUpdate(this._editor, this._infos, hoverLine);\n\t\t}\n\t\tthis._lastHover = hoverLine ?? -1;\n\t}\n\n\tpublic updateSelection(cursorLine: number, range: Range = new Range(0, 0, 0, 0)) {\n\t\tthis._lastSelection = range.isEmpty() ? undefined : range;\n\t\tthis._lastSelectionCursor = range.isEmpty() ? undefined : cursorLine;\n\t\t// Some scenarios:\n\t\t// Selection is made. Emphasis should show on the drag/selection end location.\n\t\t// Selection is made, then user clicks elsewhere. We should still show the decoration.\n\t\tif (this._editor && this._infos) {\n\t\t\tthis._doUpdate(this._editor, this._infos, cursorLine, range);\n\t\t}\n\t}\n\n\tpublic update(editor: ICodeEditor | undefined, commentInfos: ICommentInfo[], cursorLine?: number, range?: Range) {\n\t\tif (editor) {\n\t\t\tthis._editor = editor;\n\t\t\tthis._infos = commentInfos;\n\t\t\tthis._doUpdate(editor, commentInfos, cursorLine, range);\n\t\t}\n\t}\n\n\tprivate _lineHasThread(editor: ICodeEditor, lineRange: Range) {\n\t\treturn editor.getDecorationsInRange(lineRange)?.find(decoration => decoration.options.description === CommentGlyphWidget.description);\n\t}\n\n\tprivate _doUpdate(editor: ICodeEditor, commentInfos: ICommentInfo[], emphasisLine: number = -1, selectionRange: Range | undefined = this._lastSelection) {\n\t\tconst model = editor.getModel();\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If there's still a selection, use that.\n\t\temphasisLine = this._lastSelectionCursor ?? emphasisLine;\n\n\t\tconst commentingRangeDecorations: CommentingRangeDecoration[] = [];\n\t\tfor (const info of commentInfos) {\n\t\t\tinfo.commentingRanges.ranges.forEach(range => {\n\t\t\t\tconst rangeObject = new Range(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn);\n\t\t\t\tlet intersectingSelectionRange = selectionRange ? rangeObject.intersectRanges(selectionRange) : undefined;\n\t\t\t\tif ((selectionRange && (emphasisLine >= 0) && intersectingSelectionRange)\n\t\t\t\t\t// If there's only one selection line, then just drop into the else if and show an emphasis line.\n\t\t\t\t\t&& !((intersectingSelectionRange.startLineNumber === intersectingSelectionRange.endLineNumber)\n\t\t\t\t\t\t&& (emphasisLine === intersectingSelectionRange.startLineNumber))) {\n\t\t\t\t\t// The emphasisLine should be within the commenting range, even if the selection range stretches\n\t\t\t\t\t// outside of the commenting range.\n\t\t\t\t\t// Clip the emphasis and selection ranges to the commenting range\n\t\t\t\t\tlet intersectingEmphasisRange: Range;\n\t\t\t\t\tif (emphasisLine <= intersectingSelectionRange.startLineNumber) {\n\t\t\t\t\t\tintersectingEmphasisRange = intersectingSelectionRange.collapseToStart();\n\t\t\t\t\t\tintersectingSelectionRange = new Range(intersectingSelectionRange.startLineNumber + 1, 1, intersectingSelectionRange.endLineNumber, 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tintersectingEmphasisRange = new Range(intersectingSelectionRange.endLineNumber, 1, intersectingSelectionRange.endLineNumber, 1);\n\t\t\t\t\t\tintersectingSelectionRange = new Range(intersectingSelectionRange.startLineNumber, 1, intersectingSelectionRange.endLineNumber - 1, 1);\n\t\t\t\t\t}\n\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.owner, info.extensionId, info.label, intersectingSelectionRange, this.multilineDecorationOptions, info.commentingRanges, true));\n\n\t\t\t\t\tif (!this._lineHasThread(editor, intersectingEmphasisRange)) {\n\t\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.owner, info.extensionId, info.label, intersectingEmphasisRange, this.hoverDecorationOptions, info.commentingRanges, true));\n\t\t\t\t\t}\n\n\t\t\t\t\tconst beforeRangeEndLine = Math.min(intersectingEmphasisRange.startLineNumber, intersectingSelectionRange.startLineNumber) - 1;\n\t\t\t\t\tconst hasBeforeRange = rangeObject.startLineNumber <= beforeRangeEndLine;\n\t\t\t\t\tconst afterRangeStartLine = Math.max(intersectingEmphasisRange.endLineNumber, intersectingSelectionRange.endLineNumber) + 1;\n\t\t\t\t\tconst hasAfterRange = rangeObject.endLineNumber >= afterRangeStartLine;\n\t\t\t\t\tif (hasBeforeRange) {\n\t\t\t\t\t\tconst beforeRange = new Range(range.startLineNumber, 1, beforeRangeEndLine, 1);\n\t\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.owner, info.extensionId, info.label, beforeRange, this.decorationOptions, info.commentingRanges, true));\n\t\t\t\t\t}\n\t\t\t\t\tif (hasAfterRange) {\n\t\t\t\t\t\tconst afterRange = new Range(afterRangeStartLine, 1, range.endLineNumber, 1);\n\t\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.owner, info.extensionId, info.label, afterRange, this.decorationOptions, info.commentingRanges, true));\n\t\t\t\t\t}\n\t\t\t\t} else if ((rangeObject.startLineNumber <= emphasisLine) && (emphasisLine <= rangeObject.endLineNumber)) {\n\t\t\t\t\tif (rangeObject.startLineNumber < emphasisLine) {\n\t\t\t\t\t\tconst beforeRange = new Range(range.startLineNumber, 1, emphasisLine - 1, 1);\n\t\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.owner, info.extensionId, info.label, beforeRange, this.decorationOptions, info.commentingRanges, true));\n\t\t\t\t\t}\n\t\t\t\t\tconst emphasisRange = new Range(emphasisLine, 1, emphasisLine, 1);\n\t\t\t\t\tif (!this._lineHasThread(editor, emphasisRange)) {\n\t\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.owner, info.extensionId, info.label, emphasisRange, this.hoverDecorationOptions, info.commentingRanges, true));\n\t\t\t\t\t}\n\t\t\t\t\tif (emphasisLine < rangeObject.endLineNumber) {\n\t\t\t\t\t\tconst afterRange = new Range(emphasisLine + 1, 1, range.endLineNumber, 1);\n\t\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.owner, info.extensionId, info.label, afterRange, this.decorationOptions, info.commentingRanges, true));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.owner, info.extensionId, info.label, range, this.decorationOptions, info.commentingRanges));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\teditor.changeDecorations((accessor) => {\n\t\t\tthis.decorationIds = accessor.deltaDecorations(this.decorationIds, commentingRangeDecorations);\n\t\t\tcommentingRangeDecorations.forEach((decoration, index) => decoration.id = this.decorationIds[index]);\n\t\t});\n\n\t\tconst rangesDifference = this.commentingRangeDecorations.length - commentingRangeDecorations.length;\n\t\tthis.commentingRangeDecorations = commentingRangeDecorations;\n\t\tif (rangesDifference) {\n\t\t\tthis._onDidChangeDecorationsCount.fire(this.commentingRangeDecorations.length);\n\t\t}\n\t}\n\n\tprivate areRangesIntersectingOrTouchingByLine(a: Range, b: Range) {\n\t\t// Check if `a` is before `b`\n\t\tif (a.endLineNumber < (b.startLineNumber - 1)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check if `b` is before `a`\n\t\tif ((b.endLineNumber + 1) < a.startLineNumber) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// These ranges must intersect\n\t\treturn true;\n\t}\n\n\tpublic getMatchedCommentAction(commentRange: Range | undefined): CommentRangeAction[] {\n\t\tif (commentRange === undefined) {\n\t\t\tconst foundInfos = this._infos?.filter(info => info.commentingRanges.fileComments);\n\t\t\tif (foundInfos) {\n\t\t\t\treturn foundInfos.map(foundInfo => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\townerId: foundInfo.owner,\n\t\t\t\t\t\textensionId: foundInfo.extensionId,\n\t\t\t\t\t\tlabel: foundInfo.label,\n\t\t\t\t\t\tcommentingRangesInfo: foundInfo.commentingRanges\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\t// keys is ownerId\n\t\tconst foundHoverActions = new Map<string, { range: Range; action: CommentRangeAction }>();\n\t\tfor (const decoration of this.commentingRangeDecorations) {\n\t\t\tconst range = decoration.getActiveRange();\n\t\t\tif (range && this.areRangesIntersectingOrTouchingByLine(range, commentRange)) {\n\t\t\t\t// We can have several commenting ranges that match from the same owner because of how\n\t\t\t\t// the line hover and selection decoration is done.\n\t\t\t\t// The ranges must be merged so that we can see if the new commentRange fits within them.\n\t\t\t\tconst action = decoration.getCommentAction();\n\t\t\t\tconst alreadyFoundInfo = foundHoverActions.get(action.ownerId);\n\t\t\t\tif (alreadyFoundInfo?.action.commentingRangesInfo === action.commentingRangesInfo) {\n\t\t\t\t\t// Merge ranges.\n\t\t\t\t\tconst newRange = new Range(\n\t\t\t\t\t\trange.startLineNumber < alreadyFoundInfo.range.startLineNumber ? range.startLineNumber : alreadyFoundInfo.range.startLineNumber,\n\t\t\t\t\t\trange.startColumn < alreadyFoundInfo.range.startColumn ? range.startColumn : alreadyFoundInfo.range.startColumn,\n\t\t\t\t\t\trange.endLineNumber > alreadyFoundInfo.range.endLineNumber ? range.endLineNumber : alreadyFoundInfo.range.endLineNumber,\n\t\t\t\t\t\trange.endColumn > alreadyFoundInfo.range.endColumn ? range.endColumn : alreadyFoundInfo.range.endColumn\n\t\t\t\t\t);\n\t\t\t\t\tfoundHoverActions.set(action.ownerId, { range: newRange, action });\n\t\t\t\t} else {\n\t\t\t\t\tfoundHoverActions.set(action.ownerId, { range, action });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn Array.from(foundHoverActions.values()).filter(action => {\n\t\t\treturn (action.range.startLineNumber <= commentRange.startLineNumber) && (commentRange.endLineNumber <= action.range.endLineNumber);\n\t\t}).map(actions => actions.action);\n\t}\n\n\tpublic getNearestCommentingRange(findPosition: Position, reverse?: boolean): Range | undefined {\n\t\tlet findPositionContainedWithin: Range | undefined;\n\t\tlet decorations: CommentingRangeDecoration[];\n\t\tif (reverse) {\n\t\t\tdecorations = [];\n\t\t\tfor (let i = this.commentingRangeDecorations.length - 1; i >= 0; i--) {\n\t\t\t\tdecorations.push(this.commentingRangeDecorations[i]);\n\t\t\t}\n\t\t} else {\n\t\t\tdecorations = this.commentingRangeDecorations;\n\t\t}\n\t\tfor (const decoration of decorations) {\n\t\t\tconst range = decoration.getActiveRange();\n\t\t\tif (!range) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (findPositionContainedWithin && this.areRangesIntersectingOrTouchingByLine(range, findPositionContainedWithin)) {\n\t\t\t\tfindPositionContainedWithin = Range.plusRange(findPositionContainedWithin, range);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (range.startLineNumber <= findPosition.lineNumber && findPosition.lineNumber <= range.endLineNumber) {\n\t\t\t\tfindPositionContainedWithin = new Range(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!reverse && range.endLineNumber < findPosition.lineNumber) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (reverse && range.startLineNumber > findPosition.lineNumber) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\treturn range;\n\t\t}\n\t\treturn decorations[0].getActiveRange() ?? undefined;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.commentingRangeDecorations = [];\n\t}\n}\n\nexport class CommentController implements IEditorContribution {\n\tprivate readonly globalToDispose = new DisposableStore();\n\tprivate readonly localToDispose = new DisposableStore();\n\tprivate editor: ICodeEditor | undefined;\n\tprivate _commentWidgets: ReviewZoneWidget[];\n\tprivate _commentInfos: ICommentInfo[];\n\tprivate _commentingRangeDecorator!: CommentingRangeDecorator;\n\tprivate _commentThreadRangeDecorator!: CommentThreadRangeDecorator;\n\tprivate mouseDownInfo: { lineNumber: number } | null = null;\n\tprivate _commentingRangeSpaceReserved = false;\n\tprivate _computePromise: CancelablePromise<Array<ICommentInfo | null>> | null;\n\tprivate _addInProgress!: boolean;\n\tprivate _emptyThreadsToAddQueue: [Range | undefined, IEditorMouseEvent | undefined][] = [];\n\tprivate _computeCommentingRangePromise!: CancelablePromise<ICommentInfo[]> | null;\n\tprivate _computeCommentingRangeScheduler!: Delayer<Array<ICommentInfo | null>> | null;\n\tprivate _pendingNewCommentCache: { [key: string]: { [key: string]: string } };\n\tprivate _pendingEditsCache: { [key: string]: { [key: string]: { [key: number]: string } } }; // owner -> threadId -> uniqueIdInThread -> pending comment\n\tprivate _editorDisposables: IDisposable[] = [];\n\tprivate _activeCursorHasCommentingRange: IContextKey<boolean>;\n\tprivate _activeEditorHasCommentingRange: IContextKey<boolean>;\n\tprivate _hasRespondedToEditorChange: boolean = false;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@ICommentService private readonly commentService: ICommentService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ICodeEditorService private readonly codeEditorService: ICodeEditorService,\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService,\n\t\t@IQuickInputService private readonly quickInputService: IQuickInputService,\n\t\t@IViewsService private readonly viewsService: IViewsService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IEditorService private readonly editorService: IEditorService\n\t) {\n\t\tthis._commentInfos = [];\n\t\tthis._commentWidgets = [];\n\t\tthis._pendingNewCommentCache = {};\n\t\tthis._pendingEditsCache = {};\n\t\tthis._computePromise = null;\n\t\tthis._activeCursorHasCommentingRange = CommentContextKeys.activeCursorHasCommentingRange.bindTo(contextKeyService);\n\t\tthis._activeEditorHasCommentingRange = CommentContextKeys.activeEditorHasCommentingRange.bindTo(contextKeyService);\n\n\t\tif (editor instanceof EmbeddedCodeEditorWidget) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.editor = editor;\n\n\t\tthis._commentingRangeDecorator = new CommentingRangeDecorator();\n\t\tthis.globalToDispose.add(this._commentingRangeDecorator.onDidChangeDecorationsCount(count => {\n\t\t\tif (count === 0) {\n\t\t\t\tthis.clearEditorListeners();\n\t\t\t} else if (this._editorDisposables.length === 0) {\n\t\t\t\tthis.registerEditorListeners();\n\t\t\t}\n\t\t}));\n\n\t\tthis.globalToDispose.add(this._commentThreadRangeDecorator = new CommentThreadRangeDecorator(this.commentService));\n\n\t\tthis.globalToDispose.add(this.commentService.onDidDeleteDataProvider(ownerId => {\n\t\t\tif (ownerId) {\n\t\t\t\tdelete this._pendingNewCommentCache[ownerId];\n\t\t\t\tdelete this._pendingEditsCache[ownerId];\n\t\t\t} else {\n\t\t\t\tthis._pendingNewCommentCache = {};\n\t\t\t\tthis._pendingEditsCache = {};\n\t\t\t}\n\t\t\tthis.beginCompute();\n\t\t}));\n\t\tthis.globalToDispose.add(this.commentService.onDidSetDataProvider(_ => this.beginComputeAndHandleEditorChange()));\n\t\tthis.globalToDispose.add(this.commentService.onDidUpdateCommentingRanges(_ => this.beginComputeAndHandleEditorChange()));\n\n\t\tthis.globalToDispose.add(this.commentService.onDidSetResourceCommentInfos(e => {\n\t\t\tconst editorURI = this.editor && this.editor.hasModel() && this.editor.getModel().uri;\n\t\t\tif (editorURI && editorURI.toString() === e.resource.toString()) {\n\t\t\t\tthis.setComments(e.commentInfos.filter(commentInfo => commentInfo !== null));\n\t\t\t}\n\t\t}));\n\n\t\tthis.globalToDispose.add(this.commentService.onDidChangeCommentingEnabled(e => {\n\t\t\tif (e) {\n\t\t\t\tthis.registerEditorListeners();\n\t\t\t\tthis.beginCompute();\n\t\t\t} else {\n\t\t\t\tthis.tryUpdateReservedSpace();\n\t\t\t\tthis.clearEditorListeners();\n\t\t\t\tthis._commentingRangeDecorator.update(this.editor, []);\n\t\t\t\tthis._commentThreadRangeDecorator.update(this.editor, []);\n\t\t\t\tdispose(this._commentWidgets);\n\t\t\t\tthis._commentWidgets = [];\n\t\t\t}\n\t\t}));\n\n\t\tthis.globalToDispose.add(this.editor.onDidChangeModel(_ => this.onModelChanged()));\n\t\tthis.globalToDispose.add(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration('diffEditor.renderSideBySide')) {\n\t\t\t\tthis.beginCompute();\n\t\t\t}\n\t\t}));\n\n\t\tthis.onModelChanged();\n\t\tthis.codeEditorService.registerDecorationType('comment-controller', COMMENTEDITOR_DECORATION_KEY, {});\n\t\tthis.commentService.registerContinueOnCommentProvider({\n\t\t\tprovideContinueOnComments: () => {\n\t\t\t\tconst pendingComments: languages.PendingCommentThread[] = [];\n\t\t\t\tif (this._commentWidgets) {\n\t\t\t\t\tfor (const zone of this._commentWidgets) {\n\t\t\t\t\t\tconst zonePendingComments = zone.getPendingComments();\n\t\t\t\t\t\tconst pendingNewComment = zonePendingComments.newComment;\n\t\t\t\t\t\tif (!pendingNewComment || !zone.commentThread.range) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet lastCommentBody;\n\t\t\t\t\t\tif (zone.commentThread.comments && zone.commentThread.comments.length) {\n\t\t\t\t\t\t\tconst lastComment = zone.commentThread.comments[zone.commentThread.comments.length - 1];\n\t\t\t\t\t\t\tif (typeof lastComment.body === 'string') {\n\t\t\t\t\t\t\t\tlastCommentBody = lastComment.body;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlastCommentBody = lastComment.body.value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (pendingNewComment !== lastCommentBody) {\n\t\t\t\t\t\t\tpendingComments.push({\n\t\t\t\t\t\t\t\towner: zone.owner,\n\t\t\t\t\t\t\t\turi: zone.editor.getModel()!.uri,\n\t\t\t\t\t\t\t\trange: zone.commentThread.range,\n\t\t\t\t\t\t\t\tbody: pendingNewComment\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn pendingComments;\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate registerEditorListeners() {\n\t\tthis._editorDisposables = [];\n\t\tif (!this.editor) {\n\t\t\treturn;\n\t\t}\n\t\tthis._editorDisposables.push(this.editor.onMouseMove(e => this.onEditorMouseMove(e)));\n\t\tthis._editorDisposables.push(this.editor.onDidChangeCursorPosition(e => this.onEditorChangeCursorPosition(e.position)));\n\t\tthis._editorDisposables.push(this.editor.onDidFocusEditorWidget(() => this.onEditorChangeCursorPosition(this.editor?.getPosition() ?? null)));\n\t\tthis._editorDisposables.push(this.editor.onDidChangeCursorSelection(e => this.onEditorChangeCursorSelection(e)));\n\t\tthis._editorDisposables.push(this.editor.onDidBlurEditorWidget(() => this.onEditorChangeCursorSelection()));\n\t}\n\n\tprivate clearEditorListeners() {\n\t\tdispose(this._editorDisposables);\n\t\tthis._editorDisposables = [];\n\t}\n\n\tprivate onEditorMouseMove(e: IEditorMouseEvent): void {\n\t\tconst position = e.target.position?.lineNumber;\n\t\tif (e.event.leftButton.valueOf() && position && this.mouseDownInfo) {\n\t\t\tthis._commentingRangeDecorator.updateSelection(position, new Range(this.mouseDownInfo.lineNumber, 1, position, 1));\n\t\t} else {\n\t\t\tthis._commentingRangeDecorator.updateHover(position);\n\t\t}\n\t}\n\n\tprivate onEditorChangeCursorSelection(e?: ICursorSelectionChangedEvent): void {\n\t\tconst position = this.editor?.getPosition()?.lineNumber;\n\t\tif (position) {\n\t\t\tthis._commentingRangeDecorator.updateSelection(position, e?.selection);\n\t\t}\n\t}\n\n\tprivate onEditorChangeCursorPosition(e: Position | null) {\n\t\tconst decorations = e ? this.editor?.getDecorationsInRange(Range.fromPositions(e, { column: -1, lineNumber: e.lineNumber })) : undefined;\n\t\tlet hasCommentingRange = false;\n\t\tif (decorations) {\n\t\t\tfor (const decoration of decorations) {\n\t\t\t\tif (decoration.options.description === CommentGlyphWidget.description) {\n\t\t\t\t\t// We don't allow multiple comments on the same line.\n\t\t\t\t\thasCommentingRange = false;\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (decoration.options.description === CommentingRangeDecorator.description) {\n\t\t\t\t\thasCommentingRange = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._activeCursorHasCommentingRange.set(hasCommentingRange);\n\t}\n\n\tprivate isEditorInlineOriginal(testEditor: ICodeEditor): boolean {\n\t\tif (this.configurationService.getValue<boolean>('diffEditor.renderSideBySide')) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst foundEditor = this.editorService.visibleTextEditorControls.find(editor => {\n\t\t\tif (editor.getEditorType() === EditorType.IDiffEditor) {\n\t\t\t\tconst diffEditor = editor as IDiffEditor;\n\t\t\t\treturn diffEditor.getOriginalEditor() === testEditor;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\treturn !!foundEditor;\n\t}\n\n\tprivate beginCompute(): Promise<void> {\n\t\tthis._computePromise = createCancelablePromise(token => {\n\t\t\tconst editorURI = this.editor && this.editor.hasModel() && this.editor.getModel().uri;\n\n\t\t\tif (editorURI) {\n\t\t\t\treturn this.commentService.getDocumentComments(editorURI);\n\t\t\t}\n\n\t\t\treturn Promise.resolve([]);\n\t\t});\n\n\t\treturn this._computePromise.then(commentInfos => {\n\t\t\tthis.setComments(coalesce(commentInfos));\n\t\t\tthis._computePromise = null;\n\t\t}, error => console.log(error));\n\t}\n\n\tprivate beginComputeCommentingRanges() {\n\t\tif (this._computeCommentingRangeScheduler) {\n\t\t\tif (this._computeCommentingRangePromise) {\n\t\t\t\tthis._computeCommentingRangePromise.cancel();\n\t\t\t\tthis._computeCommentingRangePromise = null;\n\t\t\t}\n\n\t\t\tthis._computeCommentingRangeScheduler.trigger(() => {\n\t\t\t\tconst editorURI = this.editor && this.editor.hasModel() && this.editor.getModel().uri;\n\n\t\t\t\tif (editorURI) {\n\t\t\t\t\treturn this.commentService.getDocumentComments(editorURI);\n\t\t\t\t}\n\n\t\t\t\treturn Promise.resolve([]);\n\t\t\t}).then(commentInfos => {\n\t\t\t\tif (this.commentService.isCommentingEnabled) {\n\t\t\t\t\tconst meaningfulCommentInfos = coalesce(commentInfos);\n\t\t\t\t\tthis._commentingRangeDecorator.update(this.editor, meaningfulCommentInfos, this.editor?.getPosition()?.lineNumber, this.editor?.getSelection() ?? undefined);\n\t\t\t\t}\n\t\t\t}, (err) => {\n\t\t\t\tonUnexpectedError(err);\n\t\t\t\treturn null;\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic static get(editor: ICodeEditor): CommentController | null {\n\t\treturn editor.getContribution<CommentController>(ID);\n\t}\n\n\tpublic revealCommentThread(threadId: string, commentUniqueId: number, fetchOnceIfNotExist: boolean, focus: boolean): void {\n\t\tconst commentThreadWidget = this._commentWidgets.filter(widget => widget.commentThread.threadId === threadId);\n\t\tif (commentThreadWidget.length === 1) {\n\t\t\tcommentThreadWidget[0].reveal(commentUniqueId, focus);\n\t\t} else if (fetchOnceIfNotExist) {\n\t\t\tif (this._computePromise) {\n\t\t\t\tthis._computePromise.then(_ => {\n\t\t\t\t\tthis.revealCommentThread(threadId, commentUniqueId, false, focus);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.beginCompute().then(_ => {\n\t\t\t\t\tthis.revealCommentThread(threadId, commentUniqueId, false, focus);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic collapseAll(): void {\n\t\tfor (const widget of this._commentWidgets) {\n\t\t\twidget.collapse();\n\t\t}\n\t}\n\n\tpublic expandAll(): void {\n\t\tfor (const widget of this._commentWidgets) {\n\t\t\twidget.expand();\n\t\t}\n\t}\n\n\tpublic expandUnresolved(): void {\n\t\tfor (const widget of this._commentWidgets) {\n\t\t\tif (widget.commentThread.state === languages.CommentThreadState.Unresolved) {\n\t\t\t\twidget.expand();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic nextCommentThread(): void {\n\t\tthis._findNearestCommentThread();\n\t}\n\n\tprivate _findNearestCommentThread(reverse?: boolean): void {\n\t\tif (!this._commentWidgets.length || !this.editor?.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst after = this.editor.getSelection().getEndPosition();\n\t\tconst sortedWidgets = this._commentWidgets.sort((a, b) => {\n\t\t\tif (reverse) {\n\t\t\t\tconst temp = a;\n\t\t\t\ta = b;\n\t\t\t\tb = temp;\n\t\t\t}\n\t\t\tif (a.commentThread.range === undefined) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (b.commentThread.range === undefined) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (a.commentThread.range.startLineNumber < b.commentThread.range.startLineNumber) {\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tif (a.commentThread.range.startLineNumber > b.commentThread.range.startLineNumber) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\tif (a.commentThread.range.startColumn < b.commentThread.range.startColumn) {\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tif (a.commentThread.range.startColumn > b.commentThread.range.startColumn) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t});\n\n\t\tconst idx = findFirstIdxMonotonousOrArrLen(sortedWidgets, widget => {\n\t\t\tconst lineValueOne = reverse ? after.lineNumber : (widget.commentThread.range?.startLineNumber ?? 0);\n\t\t\tconst lineValueTwo = reverse ? (widget.commentThread.range?.startLineNumber ?? 0) : after.lineNumber;\n\t\t\tconst columnValueOne = reverse ? after.column : (widget.commentThread.range?.startColumn ?? 0);\n\t\t\tconst columnValueTwo = reverse ? (widget.commentThread.range?.startColumn ?? 0) : after.column;\n\t\t\tif (lineValueOne > lineValueTwo) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (lineValueOne < lineValueTwo) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (columnValueOne > columnValueTwo) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tlet nextWidget: ReviewZoneWidget;\n\t\tif (idx === this._commentWidgets.length) {\n\t\t\tnextWidget = this._commentWidgets[0];\n\t\t} else {\n\t\t\tnextWidget = sortedWidgets[idx];\n\t\t}\n\t\tthis.editor.setSelection(nextWidget.commentThread.range ?? new Range(1, 1, 1, 1));\n\t\tnextWidget.reveal(undefined, true);\n\t}\n\n\tpublic previousCommentThread(): void {\n\t\tthis._findNearestCommentThread(true);\n\t}\n\n\tprivate _findNearestCommentingRange(reverse?: boolean): void {\n\t\tif (!this.editor?.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst after = this.editor.getSelection().getEndPosition();\n\t\tconst range = this._commentingRangeDecorator.getNearestCommentingRange(after, reverse);\n\t\tif (range) {\n\t\t\tconst position = reverse ? range.getEndPosition() : range.getStartPosition();\n\t\t\tthis.editor.setPosition(position);\n\t\t\tthis.editor.revealLineInCenterIfOutsideViewport(position.lineNumber);\n\t\t}\n\t}\n\n\tpublic nextCommentingRange(): void {\n\t\tthis._findNearestCommentingRange();\n\t}\n\n\tpublic previousCommentingRange(): void {\n\t\tthis._findNearestCommentingRange(true);\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.globalToDispose.dispose();\n\t\tthis.localToDispose.dispose();\n\t\tdispose(this._editorDisposables);\n\t\tdispose(this._commentWidgets);\n\n\t\tthis.editor = null!; // Strict null override - nulling out in dispose\n\t}\n\n\tpublic onModelChanged(): void {\n\t\tthis.localToDispose.clear();\n\n\t\tthis.removeCommentWidgetsAndStoreCache();\n\t\tif (!this.editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._hasRespondedToEditorChange = false;\n\n\t\tthis.localToDispose.add(this.editor.onMouseDown(e => this.onEditorMouseDown(e)));\n\t\tthis.localToDispose.add(this.editor.onMouseUp(e => this.onEditorMouseUp(e)));\n\t\tif (this._editorDisposables.length) {\n\t\t\tthis.clearEditorListeners();\n\t\t\tthis.registerEditorListeners();\n\t\t}\n\n\t\tthis._computeCommentingRangeScheduler = new Delayer<ICommentInfo[]>(200);\n\t\tthis.localToDispose.add({\n\t\t\tdispose: () => {\n\t\t\t\tthis._computeCommentingRangeScheduler?.cancel();\n\t\t\t\tthis._computeCommentingRangeScheduler = null;\n\t\t\t}\n\t\t});\n\t\tthis.localToDispose.add(this.editor.onDidChangeModelContent(async () => {\n\t\t\tthis.beginComputeCommentingRanges();\n\t\t}));\n\t\tthis.localToDispose.add(this.commentService.onDidUpdateCommentThreads(async e => {\n\t\t\tconst editorURI = this.editor && this.editor.hasModel() && this.editor.getModel().uri;\n\t\t\tif (!editorURI || !this.commentService.isCommentingEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._computePromise) {\n\t\t\t\tawait this._computePromise;\n\t\t\t}\n\n\t\t\tconst commentInfo = this._commentInfos.filter(info => info.owner === e.owner);\n\t\t\tif (!commentInfo || !commentInfo.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst added = e.added.filter(thread => thread.resource && thread.resource === editorURI.toString());\n\t\t\tconst removed = e.removed.filter(thread => thread.resource && thread.resource === editorURI.toString());\n\t\t\tconst changed = e.changed.filter(thread => thread.resource && thread.resource === editorURI.toString());\n\t\t\tconst pending = e.pending.filter(pending => pending.uri.toString() === editorURI.toString());\n\n\t\t\tremoved.forEach(thread => {\n\t\t\t\tconst matchedZones = this._commentWidgets.filter(zoneWidget => zoneWidget.owner === e.owner && zoneWidget.commentThread.threadId === thread.threadId && zoneWidget.commentThread.threadId !== '');\n\t\t\t\tif (matchedZones.length) {\n\t\t\t\t\tconst matchedZone = matchedZones[0];\n\t\t\t\t\tconst index = this._commentWidgets.indexOf(matchedZone);\n\t\t\t\t\tthis._commentWidgets.splice(index, 1);\n\t\t\t\t\tmatchedZone.dispose();\n\t\t\t\t}\n\t\t\t\tconst infosThreads = this._commentInfos.filter(info => info.owner === e.owner)[0].threads;\n\t\t\t\tfor (let i = 0; i < infosThreads.length; i++) {\n\t\t\t\t\tif (infosThreads[i] === thread) {\n\t\t\t\t\t\tinfosThreads.splice(i, 1);\n\t\t\t\t\t\ti--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tchanged.forEach(thread => {\n\t\t\t\tconst matchedZones = this._commentWidgets.filter(zoneWidget => zoneWidget.owner === e.owner && zoneWidget.commentThread.threadId === thread.threadId);\n\t\t\t\tif (matchedZones.length) {\n\t\t\t\t\tconst matchedZone = matchedZones[0];\n\t\t\t\t\tmatchedZone.update(thread);\n\t\t\t\t\tthis.openCommentsView(thread);\n\t\t\t\t}\n\t\t\t});\n\t\t\tadded.forEach(thread => {\n\t\t\t\tconst matchedZones = this._commentWidgets.filter(zoneWidget => zoneWidget.owner === e.owner && zoneWidget.commentThread.threadId === thread.threadId);\n\t\t\t\tif (matchedZones.length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst matchedNewCommentThreadZones = this._commentWidgets.filter(zoneWidget => zoneWidget.owner === e.owner && zoneWidget.commentThread.commentThreadHandle === -1 && Range.equalsRange(zoneWidget.commentThread.range, thread.range));\n\n\t\t\t\tif (matchedNewCommentThreadZones.length) {\n\t\t\t\t\tmatchedNewCommentThreadZones[0].update(thread);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst continueOnCommentText = (thread.range ? this.commentService.removeContinueOnComment({ owner: e.owner, uri: editorURI, range: thread.range })?.body : undefined);\n\t\t\t\tconst pendingCommentText = (this._pendingNewCommentCache[e.owner] && this._pendingNewCommentCache[e.owner][thread.threadId!])\n\t\t\t\t\t?? continueOnCommentText;\n\t\t\t\tconst pendingEdits = this._pendingEditsCache[e.owner] && this._pendingEditsCache[e.owner][thread.threadId!];\n\t\t\t\tthis.displayCommentThread(e.owner, thread, pendingCommentText, pendingEdits);\n\t\t\t\tthis._commentInfos.filter(info => info.owner === e.owner)[0].threads.push(thread);\n\t\t\t\tthis.tryUpdateReservedSpace();\n\t\t\t});\n\t\t\tpending.forEach(thread => {\n\t\t\t\tthis.commentService.createCommentThreadTemplate(thread.owner, thread.uri, Range.lift(thread.range));\n\t\t\t});\n\t\t\tthis._commentThreadRangeDecorator.update(this.editor, commentInfo);\n\t\t}));\n\n\t\tthis.beginComputeAndHandleEditorChange();\n\t}\n\n\tprivate beginComputeAndHandleEditorChange(): void {\n\t\tthis.beginCompute().then(() => {\n\t\t\tif (!this._hasRespondedToEditorChange) {\n\t\t\t\tif (this._commentInfos.some(commentInfo => commentInfo.commentingRanges.ranges.length > 0 || commentInfo.commentingRanges.fileComments)) {\n\t\t\t\t\tthis._hasRespondedToEditorChange = true;\n\t\t\t\t\tthis._activeEditorHasCommentingRange.set(true);\n\t\t\t\t\tstatus(nls.localize('hasCommentRanges', \"Editor has commenting ranges.\"));\n\t\t\t\t} else {\n\t\t\t\t\tthis._activeEditorHasCommentingRange.set(false);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async openCommentsView(thread: languages.CommentThread) {\n\t\tif (thread.comments && (thread.comments.length > 0)) {\n\t\t\tconst openViewState = this.configurationService.getValue<ICommentsConfiguration>(COMMENTS_SECTION).openView;\n\t\t\tif (openViewState === 'file') {\n\t\t\t\treturn this.viewsService.openView(COMMENTS_VIEW_ID);\n\t\t\t} else if (openViewState === 'firstFile' || (openViewState === 'firstFileUnresolved' && thread.state === languages.CommentThreadState.Unresolved)) {\n\t\t\t\tconst hasShownView = this.viewsService.getViewWithId<CommentsPanel>(COMMENTS_VIEW_ID)?.hasRendered;\n\t\t\t\tif (!hasShownView) {\n\t\t\t\t\treturn this.viewsService.openView(COMMENTS_VIEW_ID);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate displayCommentThread(owner: string, thread: languages.CommentThread, pendingComment: string | undefined, pendingEdits: { [key: number]: string } | undefined): void {\n\t\tif (!this.editor?.getModel()) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.isEditorInlineOriginal(this.editor)) {\n\t\t\treturn;\n\t\t}\n\t\tconst zoneWidget = this.instantiationService.createInstance(ReviewZoneWidget, this.editor, owner, thread, pendingComment, pendingEdits);\n\t\tzoneWidget.display(thread.range);\n\t\tthis._commentWidgets.push(zoneWidget);\n\t\tthis.openCommentsView(thread);\n\t}\n\n\tprivate onEditorMouseDown(e: IEditorMouseEvent): void {\n\t\tthis.mouseDownInfo = parseMouseDownInfoFromEvent(e);\n\t}\n\n\tprivate onEditorMouseUp(e: IEditorMouseEvent): void {\n\t\tconst matchedLineNumber = isMouseUpEventDragFromMouseDown(this.mouseDownInfo, e);\n\t\tthis.mouseDownInfo = null;\n\n\t\tif (!this.editor || matchedLineNumber === null || !e.target.element) {\n\t\t\treturn;\n\t\t}\n\t\tconst mouseUpIsOnDecorator = (e.target.element.className.indexOf('comment-range-glyph') >= 0);\n\n\t\tconst lineNumber = e.target.position!.lineNumber;\n\t\tlet range: Range | undefined;\n\t\tlet selection: Range | null | undefined;\n\t\t// Check for drag along gutter decoration\n\t\tif ((matchedLineNumber !== lineNumber)) {\n\t\t\tif (matchedLineNumber > lineNumber) {\n\t\t\t\tselection = new Range(matchedLineNumber, this.editor.getModel()!.getLineLength(matchedLineNumber) + 1, lineNumber, 1);\n\t\t\t} else {\n\t\t\t\tselection = new Range(matchedLineNumber, 1, lineNumber, this.editor.getModel()!.getLineLength(lineNumber) + 1);\n\t\t\t}\n\t\t} else if (mouseUpIsOnDecorator) {\n\t\t\tselection = this.editor.getSelection();\n\t\t}\n\n\t\t// Check for selection at line number.\n\t\tif (selection && (selection.startLineNumber <= lineNumber) && (lineNumber <= selection.endLineNumber)) {\n\t\t\trange = selection;\n\t\t\tthis.editor.setSelection(new Range(selection.endLineNumber, 1, selection.endLineNumber, 1));\n\t\t} else if (mouseUpIsOnDecorator) {\n\t\t\trange = new Range(lineNumber, 1, lineNumber, 1);\n\t\t}\n\n\t\tif (range) {\n\t\t\tthis.addOrToggleCommentAtLine(range, e);\n\t\t}\n\t}\n\n\tpublic async addOrToggleCommentAtLine(commentRange: Range | undefined, e: IEditorMouseEvent | undefined): Promise<void> {\n\t\t// If an add is already in progress, queue the next add and process it after the current one finishes to\n\t\t// prevent empty comment threads from being added to the same line.\n\t\tif (!this._addInProgress) {\n\t\t\tthis._addInProgress = true;\n\t\t\t// The widget's position is undefined until the widget has been displayed, so rely on the glyph position instead\n\t\t\tconst existingCommentsAtLine = this._commentWidgets.filter(widget => widget.getGlyphPosition() === (commentRange ? commentRange.endLineNumber : 0));\n\t\t\tif (existingCommentsAtLine.length) {\n\t\t\t\tconst allExpanded = existingCommentsAtLine.every(widget => widget.expanded);\n\t\t\t\texistingCommentsAtLine.forEach(allExpanded ? widget => widget.collapse() : widget => widget.expand());\n\t\t\t\tthis.processNextThreadToAdd();\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis.addCommentAtLine(commentRange, e);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._emptyThreadsToAddQueue.push([commentRange, e]);\n\t\t}\n\t}\n\n\tprivate processNextThreadToAdd(): void {\n\t\tthis._addInProgress = false;\n\t\tconst info = this._emptyThreadsToAddQueue.shift();\n\t\tif (info) {\n\t\t\tthis.addOrToggleCommentAtLine(info[0], info[1]);\n\t\t}\n\t}\n\n\tpublic addCommentAtLine(range: Range | undefined, e: IEditorMouseEvent | undefined): Promise<void> {\n\t\tconst newCommentInfos = this._commentingRangeDecorator.getMatchedCommentAction(range);\n\t\tif (!newCommentInfos.length || !this.editor?.hasModel()) {\n\t\t\tthis._addInProgress = false;\n\t\t\tif (!newCommentInfos.length) {\n\t\t\t\tthrow new Error('There are no commenting ranges at the current position.');\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tif (newCommentInfos.length > 1) {\n\t\t\tif (e && range) {\n\t\t\t\tthis.contextMenuService.showContextMenu({\n\t\t\t\t\tgetAnchor: () => e.event,\n\t\t\t\t\tgetActions: () => this.getContextMenuActions(newCommentInfos, range),\n\t\t\t\t\tgetActionsContext: () => newCommentInfos.length ? newCommentInfos[0] : undefined,\n\t\t\t\t\tonHide: () => { this._addInProgress = false; }\n\t\t\t\t});\n\n\t\t\t\treturn Promise.resolve();\n\t\t\t} else {\n\t\t\t\tconst picks = this.getCommentProvidersQuickPicks(newCommentInfos);\n\t\t\t\treturn this.quickInputService.pick(picks, { placeHolder: nls.localize('pickCommentService', \"Select Comment Provider\"), matchOnDescription: true }).then(pick => {\n\t\t\t\t\tif (!pick) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst commentInfos = newCommentInfos.filter(info => info.ownerId === pick.id);\n\n\t\t\t\t\tif (commentInfos.length) {\n\t\t\t\t\t\tconst { ownerId } = commentInfos[0];\n\t\t\t\t\t\tthis.addCommentAtLine2(range, ownerId);\n\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\tthis._addInProgress = false;\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tconst { ownerId } = newCommentInfos[0]!;\n\t\t\tthis.addCommentAtLine2(range, ownerId);\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tprivate getCommentProvidersQuickPicks(commentInfos: { ownerId: string; extensionId: string | undefined; label: string | undefined; commentingRangesInfo: languages.CommentingRanges | undefined }[]) {\n\t\tconst picks: QuickPickInput[] = commentInfos.map((commentInfo) => {\n\t\t\tconst { ownerId, extensionId, label } = commentInfo;\n\n\t\t\treturn <IQuickPickItem>{\n\t\t\t\tlabel: label || extensionId,\n\t\t\t\tid: ownerId\n\t\t\t};\n\t\t});\n\n\t\treturn picks;\n\t}\n\n\tprivate getContextMenuActions(commentInfos: { ownerId: string; extensionId: string | undefined; label: string | undefined; commentingRangesInfo: languages.CommentingRanges }[], commentRange: Range): IAction[] {\n\t\tconst actions: IAction[] = [];\n\n\t\tcommentInfos.forEach(commentInfo => {\n\t\t\tconst { ownerId, extensionId, label } = commentInfo;\n\n\t\t\tactions.push(new Action(\n\t\t\t\t'addCommentThread',\n\t\t\t\t`${label || extensionId}`,\n\t\t\t\tundefined,\n\t\t\t\ttrue,\n\t\t\t\t() => {\n\t\t\t\t\tthis.addCommentAtLine2(commentRange, ownerId);\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t));\n\t\t});\n\t\treturn actions;\n\t}\n\n\tpublic addCommentAtLine2(range: Range | undefined, ownerId: string) {\n\t\tif (!this.editor) {\n\t\t\treturn;\n\t\t}\n\t\tthis.commentService.createCommentThreadTemplate(ownerId, this.editor.getModel()!.uri, range);\n\t\tthis.processNextThreadToAdd();\n\t\treturn;\n\t}\n\n\tprivate getExistingCommentEditorOptions(editor: ICodeEditor) {\n\t\tconst lineDecorationsWidth: number = editor.getOption(EditorOption.lineDecorationsWidth);\n\t\tlet extraEditorClassName: string[] = [];\n\t\tconst configuredExtraClassName = editor.getRawOptions().extraEditorClassName;\n\t\tif (configuredExtraClassName) {\n\t\t\textraEditorClassName = configuredExtraClassName.split(' ');\n\t\t}\n\t\treturn { lineDecorationsWidth, extraEditorClassName };\n\t}\n\n\tprivate getWithoutCommentsEditorOptions(editor: ICodeEditor, extraEditorClassName: string[], startingLineDecorationsWidth: number) {\n\t\tlet lineDecorationsWidth = startingLineDecorationsWidth;\n\t\tconst inlineCommentPos = extraEditorClassName.findIndex(name => name === 'inline-comment');\n\t\tif (inlineCommentPos >= 0) {\n\t\t\textraEditorClassName.splice(inlineCommentPos, 1);\n\t\t}\n\n\t\tconst options = editor.getOptions();\n\t\tif (options.get(EditorOption.folding) && options.get(EditorOption.showFoldingControls) !== 'never') {\n\t\t\tlineDecorationsWidth += 11; // 11 comes from https://github.com/microsoft/vscode/blob/94ee5f58619d59170983f453fe78f156c0cc73a3/src/vs/workbench/contrib/comments/browser/media/review.css#L485\n\t\t}\n\t\tlineDecorationsWidth -= 24;\n\t\treturn { extraEditorClassName, lineDecorationsWidth };\n\t}\n\n\tprivate getWithCommentsEditorOptions(editor: ICodeEditor, extraEditorClassName: string[], startingLineDecorationsWidth: number) {\n\t\tlet lineDecorationsWidth = startingLineDecorationsWidth;\n\t\tconst options = editor.getOptions();\n\t\tif (options.get(EditorOption.folding) && options.get(EditorOption.showFoldingControls) !== 'never') {\n\t\t\tlineDecorationsWidth -= 11;\n\t\t}\n\t\tlineDecorationsWidth += 24;\n\t\textraEditorClassName.push('inline-comment');\n\t\treturn { lineDecorationsWidth, extraEditorClassName };\n\t}\n\n\tprivate updateEditorLayoutOptions(editor: ICodeEditor, extraEditorClassName: string[], lineDecorationsWidth: number) {\n\t\teditor.updateOptions({\n\t\t\textraEditorClassName: extraEditorClassName.join(' '),\n\t\t\tlineDecorationsWidth: lineDecorationsWidth\n\t\t});\n\t}\n\n\tprivate tryUpdateReservedSpace() {\n\t\tif (!this.editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst hasCommentsOrRanges = this._commentInfos.some(info => {\n\t\t\tconst hasRanges = Boolean(info.commentingRanges && (Array.isArray(info.commentingRanges) ? info.commentingRanges : info.commentingRanges.ranges).length);\n\t\t\treturn hasRanges || (info.threads.length > 0);\n\t\t});\n\n\t\tif (hasCommentsOrRanges && !this._commentingRangeSpaceReserved && this.commentService.isCommentingEnabled) {\n\t\t\tthis._commentingRangeSpaceReserved = true;\n\t\t\tconst { lineDecorationsWidth, extraEditorClassName } = this.getExistingCommentEditorOptions(this.editor);\n\t\t\tconst newOptions = this.getWithCommentsEditorOptions(this.editor, extraEditorClassName, lineDecorationsWidth);\n\t\t\tthis.updateEditorLayoutOptions(this.editor, newOptions.extraEditorClassName, newOptions.lineDecorationsWidth);\n\t\t} else if ((!hasCommentsOrRanges || !this.commentService.isCommentingEnabled) && this._commentingRangeSpaceReserved) {\n\t\t\tthis._commentingRangeSpaceReserved = false;\n\t\t\tconst { lineDecorationsWidth, extraEditorClassName } = this.getExistingCommentEditorOptions(this.editor);\n\t\t\tconst newOptions = this.getWithoutCommentsEditorOptions(this.editor, extraEditorClassName, lineDecorationsWidth);\n\t\t\tthis.updateEditorLayoutOptions(this.editor, newOptions.extraEditorClassName, newOptions.lineDecorationsWidth);\n\t\t}\n\t}\n\n\tprivate setComments(commentInfos: ICommentInfo[]): void {\n\t\tif (!this.editor || !this.commentService.isCommentingEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._commentInfos = commentInfos;\n\t\tthis.tryUpdateReservedSpace();\n\t\t// create viewzones\n\t\tthis.removeCommentWidgetsAndStoreCache();\n\n\t\tthis._commentInfos.forEach(info => {\n\t\t\tconst providerCacheStore = this._pendingNewCommentCache[info.owner];\n\t\t\tconst providerEditsCacheStore = this._pendingEditsCache[info.owner];\n\t\t\tinfo.threads = info.threads.filter(thread => !thread.isDisposed);\n\t\t\tinfo.threads.forEach(thread => {\n\t\t\t\tlet pendingComment: string | undefined = undefined;\n\t\t\t\tif (providerCacheStore) {\n\t\t\t\t\tpendingComment = providerCacheStore[thread.threadId!];\n\t\t\t\t}\n\n\t\t\t\tlet pendingEdits: { [key: number]: string } | undefined = undefined;\n\t\t\t\tif (providerEditsCacheStore) {\n\t\t\t\t\tpendingEdits = providerEditsCacheStore[thread.threadId!];\n\t\t\t\t}\n\n\t\t\t\tif (pendingComment || pendingEdits) {\n\t\t\t\t\tthread.collapsibleState = languages.CommentThreadCollapsibleState.Expanded;\n\t\t\t\t}\n\n\t\t\t\tthis.displayCommentThread(info.owner, thread, pendingComment, pendingEdits);\n\t\t\t});\n\t\t\tinfo.pendingCommentThreads?.forEach(thread => {\n\t\t\t\tthis.commentService.createCommentThreadTemplate(thread.owner, thread.uri, Range.lift(thread.range));\n\t\t\t});\n\t\t});\n\n\t\tthis._commentingRangeDecorator.update(this.editor, this._commentInfos);\n\t\tthis._commentThreadRangeDecorator.update(this.editor, this._commentInfos);\n\t}\n\n\tpublic closeWidget(): void {\n\t\tthis._commentWidgets?.forEach(widget => widget.hide());\n\t\tif (this.editor) {\n\t\t\tthis.editor.focus();\n\t\t\tthis.editor.revealRangeInCenter(this.editor.getSelection()!);\n\t\t}\n\t}\n\n\tprivate removeCommentWidgetsAndStoreCache() {\n\t\tif (this._commentWidgets) {\n\t\t\tthis._commentWidgets.forEach(zone => {\n\t\t\t\tconst pendingComments = zone.getPendingComments();\n\t\t\t\tconst pendingNewComment = pendingComments.newComment;\n\t\t\t\tconst providerNewCommentCacheStore = this._pendingNewCommentCache[zone.owner];\n\n\t\t\t\tlet lastCommentBody;\n\t\t\t\tif (zone.commentThread.comments && zone.commentThread.comments.length) {\n\t\t\t\t\tconst lastComment = zone.commentThread.comments[zone.commentThread.comments.length - 1];\n\t\t\t\t\tif (typeof lastComment.body === 'string') {\n\t\t\t\t\t\tlastCommentBody = lastComment.body;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlastCommentBody = lastComment.body.value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (pendingNewComment && (pendingNewComment !== lastCommentBody)) {\n\t\t\t\t\tif (!providerNewCommentCacheStore) {\n\t\t\t\t\t\tthis._pendingNewCommentCache[zone.owner] = {};\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._pendingNewCommentCache[zone.owner][zone.commentThread.threadId!] = pendingNewComment;\n\t\t\t\t} else {\n\t\t\t\t\tif (providerNewCommentCacheStore) {\n\t\t\t\t\t\tdelete providerNewCommentCacheStore[zone.commentThread.threadId!];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst pendingEdits = pendingComments.edits;\n\t\t\t\tconst providerEditsCacheStore = this._pendingEditsCache[zone.owner];\n\t\t\t\tif (Object.keys(pendingEdits).length > 0) {\n\t\t\t\t\tif (!providerEditsCacheStore) {\n\t\t\t\t\t\tthis._pendingEditsCache[zone.owner] = {};\n\t\t\t\t\t}\n\t\t\t\t\tthis._pendingEditsCache[zone.owner][zone.commentThread.threadId!] = pendingEdits;\n\t\t\t\t} else if (providerEditsCacheStore) {\n\t\t\t\t\tdelete providerEditsCacheStore[zone.commentThread.threadId!];\n\t\t\t\t}\n\n\t\t\t\tzone.dispose();\n\t\t\t});\n\t\t}\n\n\t\tthis._commentWidgets = [];\n\t}\n}\n"]}