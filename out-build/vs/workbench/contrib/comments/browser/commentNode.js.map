{"version":3,"sources":["vs/workbench/contrib/comments/browser/commentNode.ts"],"names":[],"mappings":"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","file":"commentNode.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport * as dom from 'vs/base/browser/dom';\nimport * as languages from 'vs/editor/common/languages';\nimport { ActionsOrientation, ActionBar } from 'vs/base/browser/ui/actionbar/actionbar';\nimport { Action, IActionRunner, IAction, Separator, ActionRunner } from 'vs/base/common/actions';\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { IModelService } from 'vs/editor/common/services/model';\nimport { ILanguageService } from 'vs/editor/common/languages/language';\nimport { MarkdownRenderer } from 'vs/editor/contrib/markdownRenderer/browser/markdownRenderer';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ICommentService } from 'vs/workbench/contrib/comments/browser/commentService';\nimport { SimpleCommentEditor } from 'vs/workbench/contrib/comments/browser/simpleCommentEditor';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { ToolBar } from 'vs/base/browser/ui/toolbar/toolbar';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { AnchorAlignment } from 'vs/base/browser/ui/contextview/contextview';\nimport { ToggleReactionsAction, ReactionAction, ReactionActionViewItem } from './reactionsAction';\nimport { ICommentThreadWidget } from 'vs/workbench/contrib/comments/common/commentThreadWidget';\nimport { MenuItemAction, SubmenuItemAction, IMenu, MenuId } from 'vs/platform/actions/common/actions';\nimport { MenuEntryActionViewItem, SubmenuEntryActionViewItem } from 'vs/platform/actions/browser/menuEntryActionViewItem';\nimport { IContextKeyService, IContextKey } from 'vs/platform/contextkey/common/contextkey';\nimport { CommentFormActions } from 'vs/workbench/contrib/comments/browser/commentFormActions';\nimport { MOUSE_CURSOR_TEXT_CSS_CLASS_NAME } from 'vs/base/browser/ui/mouseCursor/mouseCursor';\nimport { ActionViewItem } from 'vs/base/browser/ui/actionbar/actionViewItems';\nimport { DropdownMenuActionViewItem } from 'vs/base/browser/ui/dropdown/dropdownActionViewItem';\nimport { Codicon } from 'vs/base/common/codicons';\nimport { ThemeIcon } from 'vs/base/common/themables';\nimport { MarshalledId } from 'vs/base/common/marshallingIds';\nimport { TimestampWidget } from 'vs/workbench/contrib/comments/browser/timestamp';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IMarkdownString } from 'vs/base/common/htmlContent';\nimport { IRange } from 'vs/editor/common/core/range';\nimport { ICellRange } from 'vs/workbench/contrib/notebook/common/notebookRange';\nimport { CommentMenus } from 'vs/workbench/contrib/comments/browser/commentMenus';\nimport { Scrollable, ScrollbarVisibility } from 'vs/base/common/scrollable';\nimport { SmoothScrollableElement } from 'vs/base/browser/ui/scrollbar/scrollableElement';\nimport { DomEmitter } from 'vs/base/browser/event';\nimport { CommentContextKeys } from 'vs/workbench/contrib/comments/common/commentContextKeys';\nimport { FileAccess } from 'vs/base/common/network';\nimport { COMMENTS_SECTION, ICommentsConfiguration } from 'vs/workbench/contrib/comments/common/commentsConfiguration';\nimport { StandardMouseEvent } from 'vs/base/browser/mouseEvent';\nimport { IAccessibilityService } from 'vs/platform/accessibility/common/accessibility';\n\nclass CommentsActionRunner extends ActionRunner {\n\tprotected override async runAction(action: IAction, context: any[]): Promise<void> {\n\t\tawait action.run(...context);\n\t}\n}\n\nexport class CommentNode<T extends IRange | ICellRange> extends Disposable {\n\tprivate _domNode: HTMLElement;\n\tprivate _body: HTMLElement;\n\tprivate _md: HTMLElement | undefined;\n\tprivate _plainText: HTMLElement | undefined;\n\tprivate _clearTimeout: any;\n\n\tprivate _editAction: Action | null = null;\n\tprivate _commentEditContainer: HTMLElement | null = null;\n\tprivate _commentDetailsContainer: HTMLElement;\n\tprivate _actionsToolbarContainer!: HTMLElement;\n\tprivate _reactionsActionBar?: ActionBar;\n\tprivate _reactionActionsContainer?: HTMLElement;\n\tprivate _commentEditor: SimpleCommentEditor | null = null;\n\tprivate _commentEditorDisposables: IDisposable[] = [];\n\tprivate _commentEditorModel: ITextModel | null = null;\n\tprivate _isPendingLabel!: HTMLElement;\n\tprivate _timestamp: HTMLElement | undefined;\n\tprivate _timestampWidget: TimestampWidget | undefined;\n\tprivate _contextKeyService: IContextKeyService;\n\tprivate _commentContextValue: IContextKey<string>;\n\tprivate _commentMenus: CommentMenus;\n\n\tprivate _scrollable!: Scrollable;\n\tprivate _scrollableElement!: SmoothScrollableElement;\n\n\tprotected actionRunner?: IActionRunner;\n\tprotected toolbar: ToolBar | undefined;\n\tprivate _commentFormActions: CommentFormActions | null = null;\n\tprivate _commentEditorActions: CommentFormActions | null = null;\n\n\tprivate readonly _onDidClick = new Emitter<CommentNode<T>>();\n\n\tpublic get domNode(): HTMLElement {\n\t\treturn this._domNode;\n\t}\n\n\tpublic isEditing: boolean = false;\n\n\tconstructor(\n\t\tprivate commentThread: languages.CommentThread<T>,\n\t\tpublic comment: languages.Comment,\n\t\tprivate pendingEdit: string | undefined,\n\t\tprivate owner: string,\n\t\tprivate resource: URI,\n\t\tprivate parentThread: ICommentThreadWidget,\n\t\tprivate markdownRenderer: MarkdownRenderer,\n\t\t@IInstantiationService private instantiationService: IInstantiationService,\n\t\t@ICommentService private commentService: ICommentService,\n\t\t@IModelService private modelService: IModelService,\n\t\t@ILanguageService private languageService: ILanguageService,\n\t\t@INotificationService private notificationService: INotificationService,\n\t\t@IContextMenuService private contextMenuService: IContextMenuService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IConfigurationService private configurationService: IConfigurationService,\n\t\t@IAccessibilityService private accessibilityService: IAccessibilityService\n\t) {\n\t\tsuper();\n\n\t\tthis._domNode = dom.$('div.review-comment');\n\t\tthis._contextKeyService = contextKeyService.createScoped(this._domNode);\n\t\tthis._commentContextValue = CommentContextKeys.commentContext.bindTo(this._contextKeyService);\n\t\tif (this.comment.contextValue) {\n\t\t\tthis._commentContextValue.set(this.comment.contextValue);\n\t\t}\n\t\tthis._commentMenus = this.commentService.getCommentMenus(this.owner);\n\n\t\tthis._domNode.tabIndex = -1;\n\t\tconst avatar = dom.append(this._domNode, dom.$('div.avatar-container'));\n\t\tif (comment.userIconPath) {\n\t\t\tconst img = <HTMLImageElement>dom.append(avatar, dom.$('img.avatar'));\n\t\t\timg.src = FileAccess.uriToBrowserUri(URI.revive(comment.userIconPath)).toString(true);\n\t\t\timg.onerror = _ => img.remove();\n\t\t}\n\t\tthis._commentDetailsContainer = dom.append(this._domNode, dom.$('.review-comment-contents'));\n\n\t\tthis.createHeader(this._commentDetailsContainer);\n\t\tthis._body = document.createElement(`div`);\n\t\tthis._body.classList.add('comment-body', MOUSE_CURSOR_TEXT_CSS_CLASS_NAME);\n\t\tif (configurationService.getValue<ICommentsConfiguration | undefined>(COMMENTS_SECTION)?.maxHeight !== false) {\n\t\t\tthis._body.classList.add('comment-body-max-height');\n\t\t}\n\n\t\tthis.createScroll(this._commentDetailsContainer, this._body);\n\t\tthis.updateCommentBody(this.comment.body);\n\n\t\tif (this.comment.commentReactions && this.comment.commentReactions.length && this.comment.commentReactions.filter(reaction => !!reaction.count).length) {\n\t\t\tthis.createReactionsContainer(this._commentDetailsContainer);\n\t\t}\n\n\t\tthis._domNode.setAttribute('aria-label', `${comment.userName}, ${this.commentBodyValue}`);\n\t\tthis._domNode.setAttribute('role', 'treeitem');\n\t\tthis._clearTimeout = null;\n\n\t\tthis._register(dom.addDisposableListener(this._domNode, dom.EventType.CLICK, () => this.isEditing || this._onDidClick.fire(this)));\n\t\tthis._register(dom.addDisposableListener(this._domNode, dom.EventType.CONTEXT_MENU, e => {\n\t\t\treturn this.onContextMenu(e);\n\t\t}));\n\n\t\tif (pendingEdit) {\n\t\t\tthis.switchToEditMode();\n\t\t}\n\t\tthis._register(this.accessibilityService.onDidChangeScreenReaderOptimized(() => {\n\t\t\tthis.toggleToolbarHidden(true);\n\t\t}));\n\t}\n\n\tprivate createScroll(container: HTMLElement, body: HTMLElement) {\n\t\tthis._scrollable = new Scrollable({\n\t\t\tforceIntegerValues: true,\n\t\t\tsmoothScrollDuration: 125,\n\t\t\tscheduleAtNextAnimationFrame: cb => dom.scheduleAtNextAnimationFrame(cb)\n\t\t});\n\t\tthis._scrollableElement = this._register(new SmoothScrollableElement(body, {\n\t\t\thorizontal: ScrollbarVisibility.Visible,\n\t\t\tvertical: ScrollbarVisibility.Visible\n\t\t}, this._scrollable));\n\n\t\tthis._register(this._scrollableElement.onScroll(e => {\n\t\t\tif (e.scrollLeftChanged) {\n\t\t\t\tbody.scrollLeft = e.scrollLeft;\n\t\t\t}\n\t\t\tif (e.scrollTopChanged) {\n\t\t\t\tbody.scrollTop = e.scrollTop;\n\t\t\t}\n\t\t}));\n\n\t\tconst onDidScrollViewContainer = this._register(new DomEmitter(body, 'scroll')).event;\n\t\tthis._register(onDidScrollViewContainer(_ => {\n\t\t\tconst position = this._scrollableElement.getScrollPosition();\n\t\t\tconst scrollLeft = Math.abs(body.scrollLeft - position.scrollLeft) <= 1 ? undefined : body.scrollLeft;\n\t\t\tconst scrollTop = Math.abs(body.scrollTop - position.scrollTop) <= 1 ? undefined : body.scrollTop;\n\n\t\t\tif (scrollLeft !== undefined || scrollTop !== undefined) {\n\t\t\t\tthis._scrollableElement.setScrollPosition({ scrollLeft, scrollTop });\n\t\t\t}\n\t\t}));\n\n\t\tcontainer.appendChild(this._scrollableElement.getDomNode());\n\t}\n\n\tprivate updateCommentBody(body: string | IMarkdownString) {\n\t\tthis._body.innerText = '';\n\t\tthis._md = undefined;\n\t\tthis._plainText = undefined;\n\t\tif (typeof body === 'string') {\n\t\t\tthis._plainText = dom.append(this._body, dom.$('.comment-body-plainstring'));\n\t\t\tthis._plainText.innerText = body;\n\t\t} else {\n\t\t\tthis._md = this.markdownRenderer.render(body).element;\n\t\t\tthis._body.appendChild(this._md);\n\t\t}\n\t}\n\n\tpublic get onDidClick(): Event<CommentNode<T>> {\n\t\treturn this._onDidClick.event;\n\t}\n\n\tprivate createTimestamp(container: HTMLElement) {\n\t\tthis._timestamp = dom.append(container, dom.$('span.timestamp-container'));\n\t\tthis.updateTimestamp(this.comment.timestamp);\n\t}\n\n\tprivate updateTimestamp(raw?: string) {\n\t\tif (!this._timestamp) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timestamp = raw !== undefined ? new Date(raw) : undefined;\n\t\tif (!timestamp) {\n\t\t\tthis._timestampWidget?.dispose();\n\t\t} else {\n\t\t\tif (!this._timestampWidget) {\n\t\t\t\tthis._timestampWidget = new TimestampWidget(this.configurationService, this._timestamp, timestamp);\n\t\t\t\tthis._register(this._timestampWidget);\n\t\t\t} else {\n\t\t\t\tthis._timestampWidget.setTimestamp(timestamp);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate createHeader(commentDetailsContainer: HTMLElement): void {\n\t\tconst header = dom.append(commentDetailsContainer, dom.$(`div.comment-title.${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`));\n\t\tconst infoContainer = dom.append(header, dom.$('comment-header-info'));\n\t\tconst author = dom.append(infoContainer, dom.$('strong.author'));\n\t\tauthor.innerText = this.comment.userName;\n\t\tthis.createTimestamp(infoContainer);\n\t\tthis._isPendingLabel = dom.append(infoContainer, dom.$('span.isPending'));\n\n\t\tif (this.comment.label) {\n\t\t\tthis._isPendingLabel.innerText = this.comment.label;\n\t\t} else {\n\t\t\tthis._isPendingLabel.innerText = '';\n\t\t}\n\n\t\tthis._actionsToolbarContainer = dom.append(header, dom.$('.comment-actions'));\n\t\tthis.toggleToolbarHidden(true);\n\t\tthis.createActionsToolbar();\n\t}\n\n\tprivate toggleToolbarHidden(hidden: boolean) {\n\t\tif (hidden && !this.accessibilityService.isScreenReaderOptimized()) {\n\t\t\tthis._actionsToolbarContainer.classList.add('hidden');\n\t\t} else {\n\t\t\tthis._actionsToolbarContainer.classList.remove('hidden');\n\t\t}\n\t}\n\n\tprivate getToolbarActions(menu: IMenu): { primary: IAction[]; secondary: IAction[] } {\n\t\tconst contributedActions = menu.getActions({ shouldForwardArgs: true });\n\t\tconst primary: IAction[] = [];\n\t\tconst secondary: IAction[] = [];\n\t\tconst result = { primary, secondary };\n\t\tfillInActions(contributedActions, result, false, g => /^inline/.test(g));\n\t\treturn result;\n\t}\n\n\tprivate get commentNodeContext() {\n\t\treturn [{\n\t\t\tthread: this.commentThread,\n\t\t\tcommentUniqueId: this.comment.uniqueIdInThread,\n\t\t\t$mid: MarshalledId.CommentNode\n\t\t},\n\t\t{\n\t\t\tcommentControlHandle: this.commentThread.controllerHandle,\n\t\t\tcommentThreadHandle: this.commentThread.commentThreadHandle,\n\t\t\t$mid: MarshalledId.CommentThread\n\t\t}];\n\t}\n\n\tprivate createToolbar() {\n\t\tthis.toolbar = new ToolBar(this._actionsToolbarContainer, this.contextMenuService, {\n\t\t\tactionViewItemProvider: action => {\n\t\t\t\tif (action.id === ToggleReactionsAction.ID) {\n\t\t\t\t\treturn new DropdownMenuActionViewItem(\n\t\t\t\t\t\taction,\n\t\t\t\t\t\t(<ToggleReactionsAction>action).menuActions,\n\t\t\t\t\t\tthis.contextMenuService,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tactionViewItemProvider: action => this.actionViewItemProvider(action as Action),\n\t\t\t\t\t\t\tactionRunner: this.actionRunner,\n\t\t\t\t\t\t\tclassNames: ['toolbar-toggle-pickReactions', ...ThemeIcon.asClassNameArray(Codicon.reactions)],\n\t\t\t\t\t\t\tanchorAlignmentProvider: () => AnchorAlignment.RIGHT\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn this.actionViewItemProvider(action as Action);\n\t\t\t},\n\t\t\torientation: ActionsOrientation.HORIZONTAL\n\t\t});\n\n\t\tthis.toolbar.context = this.commentNodeContext;\n\t\tthis.toolbar.actionRunner = new CommentsActionRunner();\n\n\t\tthis.registerActionBarListeners(this._actionsToolbarContainer);\n\t\tthis._register(this.toolbar);\n\t}\n\n\tprivate createActionsToolbar() {\n\t\tconst actions: IAction[] = [];\n\n\t\tconst hasReactionHandler = this.commentService.hasReactionHandler(this.owner);\n\n\t\tif (hasReactionHandler) {\n\t\t\tconst toggleReactionAction = this.createReactionPicker(this.comment.commentReactions || []);\n\t\t\tactions.push(toggleReactionAction);\n\t\t}\n\n\t\tconst menu = this._commentMenus.getCommentTitleActions(this.comment, this._contextKeyService);\n\t\tthis._register(menu);\n\t\tthis._register(menu.onDidChange(e => {\n\t\t\tconst { primary, secondary } = this.getToolbarActions(menu);\n\t\t\tif (!this.toolbar && (primary.length || secondary.length)) {\n\t\t\t\tthis.createToolbar();\n\t\t\t}\n\n\t\t\tthis.toolbar!.setActions(primary, secondary);\n\t\t}));\n\n\t\tconst { primary, secondary } = this.getToolbarActions(menu);\n\t\tactions.push(...primary);\n\n\t\tif (actions.length || secondary.length) {\n\t\t\tthis.createToolbar();\n\t\t\tthis.toolbar!.setActions(actions, secondary);\n\t\t}\n\t}\n\n\tactionViewItemProvider(action: Action) {\n\t\tlet options = {};\n\t\tif (action.id === ToggleReactionsAction.ID) {\n\t\t\toptions = { label: false, icon: true };\n\t\t} else {\n\t\t\toptions = { label: false, icon: true };\n\t\t}\n\n\t\tif (action.id === ReactionAction.ID) {\n\t\t\tconst item = new ReactionActionViewItem(action);\n\t\t\treturn item;\n\t\t} else if (action instanceof MenuItemAction) {\n\t\t\treturn this.instantiationService.createInstance(MenuEntryActionViewItem, action, undefined);\n\t\t} else if (action instanceof SubmenuItemAction) {\n\t\t\treturn this.instantiationService.createInstance(SubmenuEntryActionViewItem, action, undefined);\n\t\t} else {\n\t\t\tconst item = new ActionViewItem({}, action, options);\n\t\t\treturn item;\n\t\t}\n\t}\n\n\tasync submitComment(): Promise<void> {\n\t\tif (this._commentEditor && this._commentFormActions) {\n\t\t\tthis._commentFormActions.triggerDefaultAction();\n\t\t}\n\t}\n\n\tprivate createReactionPicker(reactionGroup: languages.CommentReaction[]): ToggleReactionsAction {\n\t\tconst toggleReactionAction = this._register(new ToggleReactionsAction(() => {\n\t\t\ttoggleReactionActionViewItem?.show();\n\t\t}, nls.localize('commentToggleReaction', \"Toggle Reaction\")));\n\n\t\tlet reactionMenuActions: Action[] = [];\n\t\tif (reactionGroup && reactionGroup.length) {\n\t\t\treactionMenuActions = reactionGroup.map((reaction) => {\n\t\t\t\treturn new Action(`reaction.command.${reaction.label}`, `${reaction.label}`, '', true, async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait this.commentService.toggleReaction(this.owner, this.resource, this.commentThread, this.comment, reaction);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconst error = e.message\n\t\t\t\t\t\t\t? nls.localize('commentToggleReactionError', \"Toggling the comment reaction failed: {0}.\", e.message)\n\t\t\t\t\t\t\t: nls.localize('commentToggleReactionDefaultError', \"Toggling the comment reaction failed\");\n\t\t\t\t\t\tthis.notificationService.error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\ttoggleReactionAction.menuActions = reactionMenuActions;\n\n\t\tconst toggleReactionActionViewItem: DropdownMenuActionViewItem = new DropdownMenuActionViewItem(\n\t\t\ttoggleReactionAction,\n\t\t\t(<ToggleReactionsAction>toggleReactionAction).menuActions,\n\t\t\tthis.contextMenuService,\n\t\t\t{\n\t\t\t\tactionViewItemProvider: action => {\n\t\t\t\t\tif (action.id === ToggleReactionsAction.ID) {\n\t\t\t\t\t\treturn toggleReactionActionViewItem;\n\t\t\t\t\t}\n\t\t\t\t\treturn this.actionViewItemProvider(action as Action);\n\t\t\t\t},\n\t\t\t\tactionRunner: this.actionRunner,\n\t\t\t\tclassNames: 'toolbar-toggle-pickReactions',\n\t\t\t\tanchorAlignmentProvider: () => AnchorAlignment.RIGHT\n\t\t\t}\n\t\t);\n\n\t\treturn toggleReactionAction;\n\t}\n\n\tprivate createReactionsContainer(commentDetailsContainer: HTMLElement): void {\n\t\tthis._reactionActionsContainer = dom.append(commentDetailsContainer, dom.$('div.comment-reactions'));\n\t\tthis._reactionsActionBar = new ActionBar(this._reactionActionsContainer, {\n\t\t\tactionViewItemProvider: action => {\n\t\t\t\tif (action.id === ToggleReactionsAction.ID) {\n\t\t\t\t\treturn new DropdownMenuActionViewItem(\n\t\t\t\t\t\taction,\n\t\t\t\t\t\t(<ToggleReactionsAction>action).menuActions,\n\t\t\t\t\t\tthis.contextMenuService,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tactionViewItemProvider: action => this.actionViewItemProvider(action as Action),\n\t\t\t\t\t\t\tactionRunner: this.actionRunner,\n\t\t\t\t\t\t\tclassNames: ['toolbar-toggle-pickReactions', ...ThemeIcon.asClassNameArray(Codicon.reactions)],\n\t\t\t\t\t\t\tanchorAlignmentProvider: () => AnchorAlignment.RIGHT\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn this.actionViewItemProvider(action as Action);\n\t\t\t}\n\t\t});\n\t\tthis._register(this._reactionsActionBar);\n\n\t\tconst hasReactionHandler = this.commentService.hasReactionHandler(this.owner);\n\t\tthis.comment.commentReactions!.filter(reaction => !!reaction.count).map(reaction => {\n\t\t\tconst action = new ReactionAction(`reaction.${reaction.label}`, `${reaction.label}`, reaction.hasReacted && (reaction.canEdit || hasReactionHandler) ? 'active' : '', (reaction.canEdit || hasReactionHandler), async () => {\n\t\t\t\ttry {\n\t\t\t\t\tawait this.commentService.toggleReaction(this.owner, this.resource, this.commentThread, this.comment, reaction);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet error: string;\n\n\t\t\t\t\tif (reaction.hasReacted) {\n\t\t\t\t\t\terror = e.message\n\t\t\t\t\t\t\t? nls.localize('commentDeleteReactionError', \"Deleting the comment reaction failed: {0}.\", e.message)\n\t\t\t\t\t\t\t: nls.localize('commentDeleteReactionDefaultError', \"Deleting the comment reaction failed\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\terror = e.message\n\t\t\t\t\t\t\t? nls.localize('commentAddReactionError', \"Deleting the comment reaction failed: {0}.\", e.message)\n\t\t\t\t\t\t\t: nls.localize('commentAddReactionDefaultError', \"Deleting the comment reaction failed\");\n\t\t\t\t\t}\n\t\t\t\t\tthis.notificationService.error(error);\n\t\t\t\t}\n\t\t\t}, reaction.iconPath, reaction.count);\n\n\t\t\tthis._reactionsActionBar?.push(action, { label: true, icon: true });\n\t\t});\n\n\t\tif (hasReactionHandler) {\n\t\t\tconst toggleReactionAction = this.createReactionPicker(this.comment.commentReactions || []);\n\t\t\tthis._reactionsActionBar.push(toggleReactionAction, { label: false, icon: true });\n\t\t}\n\t}\n\n\tget commentBodyValue(): string {\n\t\treturn (typeof this.comment.body === 'string') ? this.comment.body : this.comment.body.value;\n\t}\n\n\tprivate createCommentEditor(editContainer: HTMLElement): void {\n\t\tconst container = dom.append(editContainer, dom.$('.edit-textarea'));\n\t\tthis._commentEditor = this.instantiationService.createInstance(SimpleCommentEditor, container, SimpleCommentEditor.getEditorOptions(this.configurationService), this._contextKeyService, this.parentThread);\n\t\tconst resource = URI.parse(`comment:commentinput-${this.comment.uniqueIdInThread}-${Date.now()}.md`);\n\t\tthis._commentEditorModel = this.modelService.createModel('', this.languageService.createByFilepathOrFirstLine(resource), resource, false);\n\n\t\tthis._commentEditor.setModel(this._commentEditorModel);\n\t\tthis._commentEditor.setValue(this.pendingEdit ?? this.commentBodyValue);\n\t\tthis.pendingEdit = undefined;\n\t\tthis._commentEditor.layout({ width: container.clientWidth - 14, height: 90 });\n\t\tthis._commentEditor.focus();\n\n\t\tdom.scheduleAtNextAnimationFrame(() => {\n\t\t\tthis._commentEditor!.layout({ width: container.clientWidth - 14, height: 90 });\n\t\t\tthis._commentEditor!.focus();\n\t\t});\n\n\t\tconst lastLine = this._commentEditorModel.getLineCount();\n\t\tconst lastColumn = this._commentEditorModel.getLineLength(lastLine) + 1;\n\t\tthis._commentEditor.setSelection(new Selection(lastLine, lastColumn, lastLine, lastColumn));\n\n\t\tconst commentThread = this.commentThread;\n\t\tcommentThread.input = {\n\t\t\turi: this._commentEditor.getModel()!.uri,\n\t\t\tvalue: this.commentBodyValue\n\t\t};\n\t\tthis.commentService.setActiveCommentThread(commentThread);\n\n\t\tthis._commentEditorDisposables.push(this._commentEditor.onDidFocusEditorWidget(() => {\n\t\t\tcommentThread.input = {\n\t\t\t\turi: this._commentEditor!.getModel()!.uri,\n\t\t\t\tvalue: this.commentBodyValue\n\t\t\t};\n\t\t\tthis.commentService.setActiveCommentThread(commentThread);\n\t\t}));\n\n\t\tthis._commentEditorDisposables.push(this._commentEditor.onDidChangeModelContent(e => {\n\t\t\tif (commentThread.input && this._commentEditor && this._commentEditor.getModel()!.uri === commentThread.input.uri) {\n\t\t\t\tconst newVal = this._commentEditor.getValue();\n\t\t\t\tif (newVal !== commentThread.input.value) {\n\t\t\t\t\tconst input = commentThread.input;\n\t\t\t\t\tinput.value = newVal;\n\t\t\t\t\tcommentThread.input = input;\n\t\t\t\t\tthis.commentService.setActiveCommentThread(commentThread);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._commentEditor);\n\t\tthis._register(this._commentEditorModel);\n\t}\n\n\tgetPendingEdit(): string | undefined {\n\t\tconst model = this._commentEditor?.getModel();\n\t\tif (model && model.getValueLength() > 0) {\n\t\t\treturn model.getValue();\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate removeCommentEditor() {\n\t\tthis.isEditing = false;\n\t\tif (this._editAction) {\n\t\t\tthis._editAction.enabled = true;\n\t\t}\n\t\tthis._body.classList.remove('hidden');\n\n\t\tthis._commentEditorModel?.dispose();\n\n\t\tthis._commentEditorDisposables.forEach(dispose => dispose.dispose());\n\t\tthis._commentEditorDisposables = [];\n\t\tif (this._commentEditor) {\n\t\t\tthis._commentEditor.dispose();\n\t\t\tthis._commentEditor = null;\n\t\t}\n\n\t\tthis._commentEditContainer!.remove();\n\t}\n\n\tlayout() {\n\t\tthis._commentEditor?.layout();\n\t\tconst scrollWidth = this._body.scrollWidth;\n\t\tconst width = dom.getContentWidth(this._body);\n\t\tconst scrollHeight = this._body.scrollHeight;\n\t\tconst height = dom.getContentHeight(this._body) + 4;\n\t\tthis._scrollableElement.setScrollDimensions({ width, scrollWidth, height, scrollHeight });\n\t}\n\n\tpublic switchToEditMode() {\n\t\tif (this.isEditing) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isEditing = true;\n\t\tthis._body.classList.add('hidden');\n\t\tthis._commentEditContainer = dom.append(this._commentDetailsContainer, dom.$('.edit-container'));\n\t\tthis.createCommentEditor(this._commentEditContainer);\n\n\t\tconst formActions = dom.append(this._commentEditContainer, dom.$('.form-actions'));\n\t\tconst otherActions = dom.append(formActions, dom.$('.other-actions'));\n\t\tthis.createCommentWidgetFormActions(otherActions);\n\t\tconst editorActions = dom.append(formActions, dom.$('.editor-actions'));\n\t\tthis.createCommentWidgetEditorActions(editorActions);\n\n\t}\n\n\tprivate createCommentWidgetFormActions(container: HTMLElement) {\n\t\tconst menus = this.commentService.getCommentMenus(this.owner);\n\t\tconst menu = menus.getCommentActions(this.comment, this._contextKeyService);\n\n\t\tthis._register(menu);\n\t\tthis._register(menu.onDidChange(() => {\n\t\t\tthis._commentFormActions?.setActions(menu);\n\t\t}));\n\n\t\tthis._commentFormActions = new CommentFormActions(container, (action: IAction): void => {\n\t\t\tconst text = this._commentEditor!.getValue();\n\n\t\t\taction.run({\n\t\t\t\tthread: this.commentThread,\n\t\t\t\tcommentUniqueId: this.comment.uniqueIdInThread,\n\t\t\t\ttext: text,\n\t\t\t\t$mid: MarshalledId.CommentThreadNode\n\t\t\t});\n\n\t\t\tthis.removeCommentEditor();\n\t\t});\n\n\t\tthis._register(this._commentFormActions);\n\t\tthis._commentFormActions.setActions(menu);\n\t}\n\n\tprivate createCommentWidgetEditorActions(container: HTMLElement) {\n\t\tconst menus = this.commentService.getCommentMenus(this.owner);\n\t\tconst menu = menus.getCommentEditorActions(this._contextKeyService);\n\n\t\tthis._register(menu);\n\t\tthis._register(menu.onDidChange(() => {\n\t\t\tthis._commentEditorActions?.setActions(menu);\n\t\t}));\n\n\t\tthis._commentEditorActions = new CommentFormActions(container, (action: IAction): void => {\n\t\t\tconst text = this._commentEditor!.getValue();\n\n\t\t\taction.run({\n\t\t\t\tthread: this.commentThread,\n\t\t\t\tcommentUniqueId: this.comment.uniqueIdInThread,\n\t\t\t\ttext: text,\n\t\t\t\t$mid: MarshalledId.CommentThreadNode\n\t\t\t});\n\n\t\t\tthis._commentEditor?.focus();\n\t\t});\n\n\t\tthis._register(this._commentEditorActions);\n\t\tthis._commentEditorActions.setActions(menu, true);\n\t}\n\n\tsetFocus(focused: boolean, visible: boolean = false) {\n\t\tif (focused) {\n\t\t\tthis._domNode.focus();\n\t\t\tthis.toggleToolbarHidden(false);\n\t\t\tthis._actionsToolbarContainer.classList.add('tabfocused');\n\t\t\tthis._domNode.tabIndex = 0;\n\t\t\tif (this.comment.mode === languages.CommentMode.Editing) {\n\t\t\t\tthis._commentEditor?.focus();\n\t\t\t}\n\t\t} else {\n\t\t\tif (this._actionsToolbarContainer.classList.contains('tabfocused') && !this._actionsToolbarContainer.classList.contains('mouseover')) {\n\t\t\t\tthis.toggleToolbarHidden(true);\n\t\t\t\tthis._domNode.tabIndex = -1;\n\t\t\t}\n\t\t\tthis._actionsToolbarContainer.classList.remove('tabfocused');\n\t\t}\n\t}\n\n\tprivate registerActionBarListeners(actionsContainer: HTMLElement): void {\n\t\tthis._register(dom.addDisposableListener(this._domNode, 'mouseenter', () => {\n\t\t\tthis.toggleToolbarHidden(false);\n\t\t\tactionsContainer.classList.add('mouseover');\n\t\t}));\n\t\tthis._register(dom.addDisposableListener(this._domNode, 'mouseleave', () => {\n\t\t\tif (actionsContainer.classList.contains('mouseover') && !actionsContainer.classList.contains('tabfocused')) {\n\t\t\t\tthis.toggleToolbarHidden(true);\n\t\t\t}\n\t\t\tactionsContainer.classList.remove('mouseover');\n\t\t}));\n\t}\n\n\tupdate(newComment: languages.Comment) {\n\n\t\tif (newComment.body !== this.comment.body) {\n\t\t\tthis.updateCommentBody(newComment.body);\n\t\t}\n\n\t\tconst isChangingMode: boolean = newComment.mode !== undefined && newComment.mode !== this.comment.mode;\n\n\t\tthis.comment = newComment;\n\n\t\tif (isChangingMode) {\n\t\t\tif (newComment.mode === languages.CommentMode.Editing) {\n\t\t\t\tthis.switchToEditMode();\n\t\t\t} else {\n\t\t\t\tthis.removeCommentEditor();\n\t\t\t}\n\t\t}\n\n\t\tif (newComment.label) {\n\t\t\tthis._isPendingLabel.innerText = newComment.label;\n\t\t} else {\n\t\t\tthis._isPendingLabel.innerText = '';\n\t\t}\n\n\t\t// update comment reactions\n\t\tthis._reactionActionsContainer?.remove();\n\n\t\tthis._reactionsActionBar?.clear();\n\n\t\tif (this.comment.commentReactions && this.comment.commentReactions.some(reaction => !!reaction.count)) {\n\t\t\tthis.createReactionsContainer(this._commentDetailsContainer);\n\t\t}\n\n\t\tif (this.comment.contextValue) {\n\t\t\tthis._commentContextValue.set(this.comment.contextValue);\n\t\t} else {\n\t\t\tthis._commentContextValue.reset();\n\t\t}\n\n\t\tif (this.comment.timestamp) {\n\t\t\tthis.updateTimestamp(this.comment.timestamp);\n\t\t}\n\t}\n\n\n\tprivate onContextMenu(e: MouseEvent) {\n\t\tconst event = new StandardMouseEvent(e);\n\n\t\tthis.contextMenuService.showContextMenu({\n\t\t\tgetAnchor: () => event,\n\t\t\tmenuId: MenuId.CommentThreadCommentContext,\n\t\t\tmenuActionOptions: { shouldForwardArgs: true },\n\t\t\tcontextKeyService: this._contextKeyService,\n\t\t\tactionRunner: new CommentsActionRunner(),\n\t\t\tgetActionsContext: () => {\n\t\t\t\treturn this.commentNodeContext;\n\t\t\t},\n\t\t});\n\t}\n\n\tfocus() {\n\t\tthis.domNode.focus();\n\t\tif (!this._clearTimeout) {\n\t\t\tthis.domNode.classList.add('focus');\n\t\t\tthis._clearTimeout = setTimeout(() => {\n\t\t\t\tthis.domNode.classList.remove('focus');\n\t\t\t}, 3000);\n\t\t}\n\t}\n}\n\nfunction fillInActions(groups: [string, Array<MenuItemAction | SubmenuItemAction>][], target: IAction[] | { primary: IAction[]; secondary: IAction[] }, useAlternativeActions: boolean, isPrimaryGroup: (group: string) => boolean = group => group === 'navigation'): void {\n\tfor (const tuple of groups) {\n\t\tlet [group, actions] = tuple;\n\t\tif (useAlternativeActions) {\n\t\t\tactions = actions.map(a => (a instanceof MenuItemAction) && !!a.alt ? a.alt : a);\n\t\t}\n\n\t\tif (isPrimaryGroup(group)) {\n\t\t\tconst to = Array.isArray(target) ? target : target.primary;\n\n\t\t\tto.unshift(...actions);\n\t\t} else {\n\t\t\tconst to = Array.isArray(target) ? target : target.secondary;\n\n\t\t\tif (to.length > 0) {\n\t\t\t\tto.push(new Separator());\n\t\t\t}\n\n\t\t\tto.push(...actions);\n\t\t}\n\t}\n}\n"]}