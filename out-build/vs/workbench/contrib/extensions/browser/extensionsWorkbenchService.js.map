{"version":3,"sources":["vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts"],"names":[],"mappings":"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","file":"extensionsWorkbenchService.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport * as semver from 'vs/base/common/semver/semver';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { index } from 'vs/base/common/arrays';\nimport { CancelablePromise, Promises, ThrottledDelayer, createCancelablePromise } from 'vs/base/common/async';\nimport { CancellationError, isCancellationError } from 'vs/base/common/errors';\nimport { Disposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { IPager, singlePagePager } from 'vs/base/common/paging';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport {\n\tIExtensionGalleryService, ILocalExtension, IGalleryExtension, IQueryOptions,\n\tInstallExtensionEvent, DidUninstallExtensionEvent, InstallOperation, InstallOptions, WEB_EXTENSION_TAG, InstallExtensionResult,\n\tIExtensionsControlManifest, InstallVSIXOptions, IExtensionInfo, IExtensionQueryOptions, IDeprecationInfo, isTargetPlatformCompatible\n} from 'vs/platform/extensionManagement/common/extensionManagement';\nimport { IWorkbenchExtensionEnablementService, EnablementState, IExtensionManagementServerService, IExtensionManagementServer, IWorkbenchExtensionManagementService, DefaultIconPath } from 'vs/workbench/services/extensionManagement/common/extensionManagement';\nimport { getGalleryExtensionTelemetryData, getLocalExtensionTelemetryData, areSameExtensions, groupByExtension, ExtensionKey, getGalleryExtensionId } from 'vs/platform/extensionManagement/common/extensionManagementUtil';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IHostService } from 'vs/workbench/services/host/browser/host';\nimport { URI } from 'vs/base/common/uri';\nimport { IExtension, ExtensionState, IExtensionsWorkbenchService, AutoUpdateConfigurationKey, AutoCheckUpdatesConfigurationKey, HasOutdatedExtensionsContext } from 'vs/workbench/contrib/extensions/common/extensions';\nimport { IEditorService, SIDE_GROUP, ACTIVE_GROUP } from 'vs/workbench/services/editor/common/editorService';\nimport { IURLService, IURLHandler, IOpenURLOptions } from 'vs/platform/url/common/url';\nimport { ExtensionsInput, IExtensionEditorOptions } from 'vs/workbench/contrib/extensions/common/extensionsInput';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IProgressOptions, IProgressService, ProgressLocation } from 'vs/platform/progress/common/progress';\nimport { INotificationService, Severity } from 'vs/platform/notification/common/notification';\nimport * as resources from 'vs/base/common/resources';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { IStorageService, StorageScope } from 'vs/platform/storage/common/storage';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IExtensionManifest, ExtensionType, IExtension as IPlatformExtension, TargetPlatform, ExtensionIdentifier, IExtensionIdentifier, IExtensionDescription, isApplicationScopedExtension } from 'vs/platform/extensions/common/extensions';\nimport { ILanguageService } from 'vs/editor/common/languages/language';\nimport { IProductService } from 'vs/platform/product/common/productService';\nimport { FileAccess } from 'vs/base/common/network';\nimport { IIgnoredExtensionsManagementService } from 'vs/platform/userDataSync/common/ignoredExtensions';\nimport { IUserDataAutoSyncService } from 'vs/platform/userDataSync/common/userDataSync';\nimport { IContextKey, IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { isBoolean, isUndefined } from 'vs/base/common/types';\nimport { IExtensionManifestPropertiesService } from 'vs/workbench/services/extensions/common/extensionManifestPropertiesService';\nimport { IExtensionService, IExtensionsStatus, toExtension, toExtensionDescription } from 'vs/workbench/services/extensions/common/extensions';\nimport { ExtensionEditor } from 'vs/workbench/contrib/extensions/browser/extensionEditor';\nimport { isWeb, language } from 'vs/base/common/platform';\nimport { getLocale } from 'vs/platform/languagePacks/common/languagePacks';\nimport { ILocaleService } from 'vs/workbench/services/localization/common/locale';\nimport { TelemetryTrustedValue } from 'vs/platform/telemetry/common/telemetryUtils';\nimport { ILifecycleService, LifecyclePhase } from 'vs/workbench/services/lifecycle/common/lifecycle';\nimport { IUserDataProfileService } from 'vs/workbench/services/userDataProfile/common/userDataProfile';\n\ninterface IExtensionStateProvider<T> {\n\t(extension: Extension): T;\n}\n\ninterface InstalledExtensionsEvent {\n\treadonly extensionIds: TelemetryTrustedValue<string>;\n\treadonly count: number;\n}\ntype ExtensionsLoadClassification = {\n\towner: 'digitarald';\n\tcomment: 'Helps to understand which extensions are the most actively used.';\n\treadonly extensionIds: { classification: 'PublicNonPersonalData'; purpose: 'FeatureInsight'; comment: 'The list of extension ids that are installed.' };\n\treadonly count: { classification: 'PublicNonPersonalData'; purpose: 'FeatureInsight'; comment: 'The number of extensions that are installed.' };\n};\n\nexport class Extension implements IExtension {\n\n\tpublic enablementState: EnablementState = EnablementState.EnabledGlobally;\n\n\tconstructor(\n\t\tprivate stateProvider: IExtensionStateProvider<ExtensionState>,\n\t\tprivate runtimeStateProvider: IExtensionStateProvider<string | undefined>,\n\t\tpublic readonly server: IExtensionManagementServer | undefined,\n\t\tpublic local: ILocalExtension | undefined,\n\t\tpublic gallery: IGalleryExtension | undefined,\n\t\t@IExtensionGalleryService private readonly galleryService: IExtensionGalleryService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IProductService private readonly productService: IProductService\n\t) { }\n\n\tget type(): ExtensionType {\n\t\treturn this.local ? this.local.type : ExtensionType.User;\n\t}\n\n\tget isBuiltin(): boolean {\n\t\treturn this.local ? this.local.isBuiltin : false;\n\t}\n\n\tget name(): string {\n\t\treturn this.gallery ? this.gallery.name : this.local!.manifest.name;\n\t}\n\n\tget displayName(): string {\n\t\tif (this.gallery) {\n\t\t\treturn this.gallery.displayName || this.gallery.name;\n\t\t}\n\n\t\treturn this.local!.manifest.displayName || this.local!.manifest.name;\n\t}\n\n\tget identifier(): IExtensionIdentifier {\n\t\tif (this.gallery) {\n\t\t\treturn this.gallery.identifier;\n\t\t}\n\t\treturn this.local!.identifier;\n\t}\n\n\tget uuid(): string | undefined {\n\t\treturn this.gallery ? this.gallery.identifier.uuid : this.local!.identifier.uuid;\n\t}\n\n\tget publisher(): string {\n\t\treturn this.gallery ? this.gallery.publisher : this.local!.manifest.publisher;\n\t}\n\n\tget publisherDisplayName(): string {\n\t\tif (this.gallery) {\n\t\t\treturn this.gallery.publisherDisplayName || this.gallery.publisher;\n\t\t}\n\n\t\tif (this.local?.publisherDisplayName) {\n\t\t\treturn this.local.publisherDisplayName;\n\t\t}\n\n\t\treturn this.local!.manifest.publisher;\n\t}\n\n\tget publisherUrl(): URI | undefined {\n\t\tif (!this.productService.extensionsGallery || !this.gallery) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn resources.joinPath(URI.parse(this.productService.extensionsGallery.publisherUrl), this.publisher);\n\t}\n\n\tget publisherDomain(): { link: string; verified: boolean } | undefined {\n\t\treturn this.gallery?.publisherDomain;\n\t}\n\n\tget publisherSponsorLink(): URI | undefined {\n\t\treturn this.gallery?.publisherSponsorLink ? URI.parse(this.gallery.publisherSponsorLink) : undefined;\n\t}\n\n\tget version(): string {\n\t\treturn this.local ? this.local.manifest.version : this.latestVersion;\n\t}\n\n\tget pinned(): boolean {\n\t\treturn !!this.local?.pinned;\n\t}\n\n\tget latestVersion(): string {\n\t\treturn this.gallery ? this.gallery.version : this.local!.manifest.version;\n\t}\n\n\tget description(): string {\n\t\treturn this.gallery ? this.gallery.description : this.local!.manifest.description || '';\n\t}\n\n\tget url(): string | undefined {\n\t\tif (!this.productService.extensionsGallery || !this.gallery) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn `${this.productService.extensionsGallery.itemUrl}?itemName=${this.publisher}.${this.name}`;\n\t}\n\n\tget iconUrl(): string {\n\t\treturn this.galleryIconUrl || this.localIconUrl || this.defaultIconUrl;\n\t}\n\n\tget iconUrlFallback(): string {\n\t\treturn this.galleryIconUrlFallback || this.localIconUrl || this.defaultIconUrl;\n\t}\n\n\tprivate get localIconUrl(): string | null {\n\t\tif (this.local && this.local.manifest.icon) {\n\t\t\treturn FileAccess.uriToBrowserUri(resources.joinPath(this.local.location, this.local.manifest.icon)).toString(true);\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate get galleryIconUrl(): string | null {\n\t\treturn this.gallery?.assets.icon ? this.gallery.assets.icon.uri : null;\n\t}\n\n\tprivate get galleryIconUrlFallback(): string | null {\n\t\treturn this.gallery?.assets.icon ? this.gallery.assets.icon.fallbackUri : null;\n\t}\n\n\tprivate get defaultIconUrl(): string {\n\t\tif (this.type === ExtensionType.System && this.local) {\n\t\t\tif (this.local.manifest && this.local.manifest.contributes) {\n\t\t\t\tif (Array.isArray(this.local.manifest.contributes.themes) && this.local.manifest.contributes.themes.length) {\n\t\t\t\t\treturn FileAccess.asBrowserUri('vs/workbench/contrib/extensions/browser/media/theme-icon.png').toString(true);\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(this.local.manifest.contributes.grammars) && this.local.manifest.contributes.grammars.length) {\n\t\t\t\t\treturn FileAccess.asBrowserUri('vs/workbench/contrib/extensions/browser/media/language-icon.svg').toString(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn DefaultIconPath;\n\t}\n\n\tget repository(): string | undefined {\n\t\treturn this.gallery && this.gallery.assets.repository ? this.gallery.assets.repository.uri : undefined;\n\t}\n\n\tget licenseUrl(): string | undefined {\n\t\treturn this.gallery && this.gallery.assets.license ? this.gallery.assets.license.uri : undefined;\n\t}\n\n\tget state(): ExtensionState {\n\t\treturn this.stateProvider(this);\n\t}\n\n\tpublic isMalicious: boolean = false;\n\tpublic deprecationInfo: IDeprecationInfo | undefined;\n\n\tget installCount(): number | undefined {\n\t\treturn this.gallery ? this.gallery.installCount : undefined;\n\t}\n\n\tget rating(): number | undefined {\n\t\treturn this.gallery ? this.gallery.rating : undefined;\n\t}\n\n\tget ratingCount(): number | undefined {\n\t\treturn this.gallery ? this.gallery.ratingCount : undefined;\n\t}\n\n\tget outdated(): boolean {\n\t\ttry {\n\t\t\tif (!this.gallery || !this.local) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// Do not allow updating system extensions in stable\n\t\t\tif (this.type === ExtensionType.System && this.productService.quality === 'stable') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (!this.local.preRelease && this.gallery.properties.isPreReleaseVersion) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (semver.gt(this.latestVersion, this.version)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this.outdatedTargetPlatform) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t/* Ignore */\n\t\t}\n\t\treturn false;\n\t}\n\n\tget outdatedTargetPlatform(): boolean {\n\t\treturn !!this.local && !!this.gallery\n\t\t\t&& ![TargetPlatform.UNDEFINED, TargetPlatform.WEB].includes(this.local.targetPlatform)\n\t\t\t&& this.gallery.properties.targetPlatform !== TargetPlatform.WEB\n\t\t\t&& this.local.targetPlatform !== this.gallery.properties.targetPlatform\n\t\t\t&& semver.eq(this.latestVersion, this.version);\n\t}\n\n\tget reloadRequiredStatus(): string | undefined {\n\t\treturn this.runtimeStateProvider(this);\n\t}\n\n\tget telemetryData(): any {\n\t\tconst { local, gallery } = this;\n\n\t\tif (gallery) {\n\t\t\treturn getGalleryExtensionTelemetryData(gallery);\n\t\t} else {\n\t\t\treturn getLocalExtensionTelemetryData(local!);\n\t\t}\n\t}\n\n\tget preview(): boolean {\n\t\treturn this.local?.manifest.preview ?? this.gallery?.preview ?? false;\n\t}\n\n\tget hasPreReleaseVersion(): boolean {\n\t\treturn !!this.gallery?.hasPreReleaseVersion;\n\t}\n\n\tget hasReleaseVersion(): boolean {\n\t\treturn !!this.gallery?.hasReleaseVersion;\n\t}\n\n\tprivate getLocal(): ILocalExtension | undefined {\n\t\treturn this.local && !this.outdated ? this.local : undefined;\n\t}\n\n\tasync getManifest(token: CancellationToken): Promise<IExtensionManifest | null> {\n\t\tconst local = this.getLocal();\n\t\tif (local) {\n\t\t\treturn local.manifest;\n\t\t}\n\n\t\tif (this.gallery) {\n\t\t\tif (this.gallery.assets.manifest) {\n\t\t\t\treturn this.galleryService.getManifest(this.gallery, token);\n\t\t\t}\n\t\t\tthis.logService.error(nls.localize('Manifest is not found', \"Manifest is not found\"), this.identifier.id);\n\t\t\treturn null;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thasReadme(): boolean {\n\t\tif (this.local && this.local.readmeUrl) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.gallery && this.gallery.assets.readme) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.type === ExtensionType.System;\n\t}\n\n\tasync getReadme(token: CancellationToken): Promise<string> {\n\t\tconst local = this.getLocal();\n\t\tif (local?.readmeUrl) {\n\t\t\tconst content = await this.fileService.readFile(local.readmeUrl);\n\t\t\treturn content.value.toString();\n\t\t}\n\n\t\tif (this.gallery) {\n\t\t\tif (this.gallery.assets.readme) {\n\t\t\t\treturn this.galleryService.getReadme(this.gallery, token);\n\t\t\t}\n\t\t\tthis.telemetryService.publicLog('extensions:NotFoundReadMe', this.telemetryData);\n\t\t}\n\n\t\tif (this.type === ExtensionType.System) {\n\t\t\treturn Promise.resolve(`# ${this.displayName || this.name}\n**Notice:** This extension is bundled with Visual Studio Code. It can be disabled but not uninstalled.\n## Features\n${this.description}\n`);\n\t\t}\n\n\t\treturn Promise.reject(new Error('not available'));\n\t}\n\n\thasChangelog(): boolean {\n\t\tif (this.local && this.local.changelogUrl) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.gallery && this.gallery.assets.changelog) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.type === ExtensionType.System;\n\t}\n\n\tasync getChangelog(token: CancellationToken): Promise<string> {\n\t\tconst local = this.getLocal();\n\t\tif (local?.changelogUrl) {\n\t\t\tconst content = await this.fileService.readFile(local.changelogUrl);\n\t\t\treturn content.value.toString();\n\t\t}\n\n\t\tif (this.gallery?.assets.changelog) {\n\t\t\treturn this.galleryService.getChangelog(this.gallery, token);\n\t\t}\n\n\t\tif (this.type === ExtensionType.System) {\n\t\t\treturn Promise.resolve('Please check the [VS Code Release Notes](command:update.showCurrentReleaseNotes) for changes to the built-in extensions.');\n\t\t}\n\n\t\treturn Promise.reject(new Error('not available'));\n\t}\n\n\tget categories(): readonly string[] {\n\t\tconst { local, gallery } = this;\n\t\tif (local && local.manifest.categories && !this.outdated) {\n\t\t\treturn local.manifest.categories;\n\t\t}\n\t\tif (gallery) {\n\t\t\treturn gallery.categories;\n\t\t}\n\t\treturn [];\n\t}\n\n\tget tags(): readonly string[] {\n\t\tconst { gallery } = this;\n\t\tif (gallery) {\n\t\t\treturn gallery.tags.filter(tag => !tag.startsWith('_'));\n\t\t}\n\t\treturn [];\n\t}\n\n\tget dependencies(): string[] {\n\t\tconst { local, gallery } = this;\n\t\tif (local && local.manifest.extensionDependencies && !this.outdated) {\n\t\t\treturn local.manifest.extensionDependencies;\n\t\t}\n\t\tif (gallery) {\n\t\t\treturn gallery.properties.dependencies || [];\n\t\t}\n\t\treturn [];\n\t}\n\n\tget extensionPack(): string[] {\n\t\tconst { local, gallery } = this;\n\t\tif (local && local.manifest.extensionPack && !this.outdated) {\n\t\t\treturn local.manifest.extensionPack;\n\t\t}\n\t\tif (gallery) {\n\t\t\treturn gallery.properties.extensionPack || [];\n\t\t}\n\t\treturn [];\n\t}\n}\n\nclass Extensions extends Disposable {\n\n\tstatic updateExtensionFromControlManifest(extension: Extension, extensionsControlManifest: IExtensionsControlManifest): void {\n\t\textension.isMalicious = extensionsControlManifest.malicious.some(identifier => areSameExtensions(extension.identifier, identifier));\n\t\textension.deprecationInfo = extensionsControlManifest.deprecated ? extensionsControlManifest.deprecated[extension.identifier.id.toLowerCase()] : undefined;\n\t}\n\n\tprivate readonly _onChange = this._register(new Emitter<{ extension: Extension; operation?: InstallOperation } | undefined>());\n\tget onChange() { return this._onChange.event; }\n\n\tprivate readonly _onReset = this._register(new Emitter<void>());\n\tget onReset() { return this._onReset.event; }\n\n\tprivate installing: Extension[] = [];\n\tprivate uninstalling: Extension[] = [];\n\tprivate installed: Extension[] = [];\n\n\tconstructor(\n\t\treadonly server: IExtensionManagementServer,\n\t\tprivate readonly stateProvider: IExtensionStateProvider<ExtensionState>,\n\t\tprivate readonly runtimeStateProvider: IExtensionStateProvider<string | undefined>,\n\t\t@IExtensionGalleryService private readonly galleryService: IExtensionGalleryService,\n\t\t@IWorkbenchExtensionEnablementService private readonly extensionEnablementService: IWorkbenchExtensionEnablementService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\t\tthis._register(server.extensionManagementService.onInstallExtension(e => this.onInstallExtension(e)));\n\t\tthis._register(server.extensionManagementService.onDidInstallExtensions(e => this.onDidInstallExtensions(e)));\n\t\tthis._register(server.extensionManagementService.onUninstallExtension(e => this.onUninstallExtension(e.identifier)));\n\t\tthis._register(server.extensionManagementService.onDidUninstallExtension(e => this.onDidUninstallExtension(e)));\n\t\tthis._register(server.extensionManagementService.onDidUpdateExtensionMetadata(e => this.onDidUpdateExtensionMetadata(e)));\n\t\tthis._register(server.extensionManagementService.onDidChangeProfile(() => this.reset()));\n\t\tthis._register(extensionEnablementService.onEnablementChanged(e => this.onEnablementChanged(e)));\n\t\tthis._register(Event.any(this.onChange, this.onReset)(() => this._local = undefined));\n\t}\n\n\tprivate _local: IExtension[] | undefined;\n\tget local(): IExtension[] {\n\t\tif (!this._local) {\n\t\t\tthis._local = [];\n\t\t\tfor (const extension of this.installed) {\n\t\t\t\tthis._local.push(extension);\n\t\t\t}\n\t\t\tfor (const extension of this.installing) {\n\t\t\t\tif (!this.installed.some(installed => areSameExtensions(installed.identifier, extension.identifier))) {\n\t\t\t\t\tthis._local.push(extension);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this._local;\n\t}\n\n\tasync queryInstalled(): Promise<IExtension[]> {\n\t\tawait this.fetchInstalledExtensions();\n\t\tthis._onChange.fire(undefined);\n\t\treturn this.local;\n\t}\n\n\tasync syncInstalledExtensionsWithGallery(galleryExtensions: IGalleryExtension[]): Promise<boolean> {\n\t\tlet hasChanged: boolean = false;\n\t\tconst extensions = await this.mapInstalledExtensionWithCompatibleGalleryExtension(galleryExtensions);\n\t\tfor (const [extension, gallery] of extensions) {\n\t\t\t// update metadata of the extension if it does not exist\n\t\t\tif (extension.local && !extension.local.identifier.uuid) {\n\t\t\t\textension.local = await this.updateMetadata(extension.local, gallery);\n\t\t\t}\n\t\t\tif (!extension.gallery || extension.gallery.version !== gallery.version || extension.gallery.properties.targetPlatform !== gallery.properties.targetPlatform) {\n\t\t\t\textension.gallery = gallery;\n\t\t\t\tthis._onChange.fire({ extension });\n\t\t\t\thasChanged = true;\n\t\t\t}\n\t\t}\n\t\treturn hasChanged;\n\t}\n\n\tprivate async mapInstalledExtensionWithCompatibleGalleryExtension(galleryExtensions: IGalleryExtension[]): Promise<[Extension, IGalleryExtension][]> {\n\t\tconst mappedExtensions = this.mapInstalledExtensionWithGalleryExtension(galleryExtensions);\n\t\tconst targetPlatform = await this.server.extensionManagementService.getTargetPlatform();\n\t\tconst compatibleGalleryExtensions: IGalleryExtension[] = [];\n\t\tconst compatibleGalleryExtensionsToFetch: IExtensionInfo[] = [];\n\t\tawait Promise.allSettled(mappedExtensions.map(async ([extension, gallery]) => {\n\t\t\tif (extension.local) {\n\t\t\t\tif (await this.galleryService.isExtensionCompatible(gallery, extension.local.preRelease, targetPlatform)) {\n\t\t\t\t\tcompatibleGalleryExtensions.push(gallery);\n\t\t\t\t} else {\n\t\t\t\t\tcompatibleGalleryExtensionsToFetch.push({ ...extension.local.identifier, preRelease: extension.local.preRelease });\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t\tif (compatibleGalleryExtensionsToFetch.length) {\n\t\t\tconst result = await this.galleryService.getExtensions(compatibleGalleryExtensionsToFetch, { targetPlatform, compatible: true, queryAllVersions: true }, CancellationToken.None);\n\t\t\tcompatibleGalleryExtensions.push(...result);\n\t\t}\n\t\treturn this.mapInstalledExtensionWithGalleryExtension(compatibleGalleryExtensions);\n\t}\n\n\tprivate mapInstalledExtensionWithGalleryExtension(galleryExtensions: IGalleryExtension[]): [Extension, IGalleryExtension][] {\n\t\tconst mappedExtensions: [Extension, IGalleryExtension][] = [];\n\t\tconst byUUID = new Map<string, IGalleryExtension>(), byID = new Map<string, IGalleryExtension>();\n\t\tfor (const gallery of galleryExtensions) {\n\t\t\tbyUUID.set(gallery.identifier.uuid, gallery);\n\t\t\tbyID.set(gallery.identifier.id.toLowerCase(), gallery);\n\t\t}\n\t\tfor (const installed of this.installed) {\n\t\t\tif (installed.uuid) {\n\t\t\t\tconst gallery = byUUID.get(installed.uuid);\n\t\t\t\tif (gallery) {\n\t\t\t\t\tmappedExtensions.push([installed, gallery]);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst gallery = byID.get(installed.identifier.id.toLowerCase());\n\t\t\tif (gallery) {\n\t\t\t\tmappedExtensions.push([installed, gallery]);\n\t\t\t}\n\t\t}\n\t\treturn mappedExtensions;\n\t}\n\n\tprivate async updateMetadata(localExtension: ILocalExtension, gallery: IGalleryExtension): Promise<ILocalExtension> {\n\t\tlet isPreReleaseVersion = false;\n\t\tif (localExtension.manifest.version !== gallery.version) {\n\t\t\ttype GalleryServiceMatchInstalledExtensionClassification = {\n\t\t\t\towner: 'sandy081';\n\t\t\t\tcomment: 'Report when a request is made to update metadata of an installed extension';\n\t\t\t};\n\t\t\tthis.telemetryService.publicLog2<{}, GalleryServiceMatchInstalledExtensionClassification>('galleryService:updateMetadata');\n\t\t\tconst galleryWithLocalVersion: IGalleryExtension | undefined = (await this.galleryService.getExtensions([{ ...localExtension.identifier, version: localExtension.manifest.version }], CancellationToken.None))[0];\n\t\t\tisPreReleaseVersion = !!galleryWithLocalVersion?.properties?.isPreReleaseVersion;\n\t\t}\n\t\treturn this.server.extensionManagementService.updateMetadata(localExtension, { id: gallery.identifier.uuid, publisherDisplayName: gallery.publisherDisplayName, publisherId: gallery.publisherId, isPreReleaseVersion });\n\t}\n\n\tcanInstall(galleryExtension: IGalleryExtension): Promise<boolean> {\n\t\treturn this.server.extensionManagementService.canInstall(galleryExtension);\n\t}\n\n\tprivate onInstallExtension(event: InstallExtensionEvent): void {\n\t\tconst { source } = event;\n\t\tif (source && !URI.isUri(source)) {\n\t\t\tconst extension = this.installed.filter(e => areSameExtensions(e.identifier, source.identifier))[0]\n\t\t\t\t|| this.instantiationService.createInstance(Extension, this.stateProvider, this.runtimeStateProvider, this.server, undefined, source);\n\t\t\tthis.installing.push(extension);\n\t\t\tthis._onChange.fire({ extension });\n\t\t}\n\t}\n\n\tprivate async fetchInstalledExtensions(): Promise<void> {\n\t\tconst extensionsControlManifest = await this.server.extensionManagementService.getExtensionsControlManifest();\n\t\tconst all = await this.migrateIgnoredAutoUpdateExtensions(await this.server.extensionManagementService.getInstalled());\n\n\t\t// dedup user and system extensions by giving priority to user extensions.\n\t\tconst installed = groupByExtension(all, r => r.identifier).reduce((result, extensions) => {\n\t\t\tconst extension = extensions.length === 1 ? extensions[0]\n\t\t\t\t: extensions.find(e => e.type === ExtensionType.User) || extensions.find(e => e.type === ExtensionType.System);\n\t\t\tresult.push(extension!);\n\t\t\treturn result;\n\t\t}, []);\n\n\t\tconst byId = index(this.installed, e => e.local ? e.local.identifier.id : e.identifier.id);\n\t\tthis.installed = installed.map(local => {\n\t\t\tconst extension = byId[local.identifier.id] || this.instantiationService.createInstance(Extension, this.stateProvider, this.runtimeStateProvider, this.server, local, undefined);\n\t\t\textension.local = local;\n\t\t\textension.enablementState = this.extensionEnablementService.getEnablementState(local);\n\t\t\tExtensions.updateExtensionFromControlManifest(extension, extensionsControlManifest);\n\t\t\treturn extension;\n\t\t});\n\t}\n\n\tprivate async migrateIgnoredAutoUpdateExtensions(extensions: ILocalExtension[]): Promise<ILocalExtension[]> {\n\t\tconst ignoredAutoUpdateExtensions = JSON.parse(this.storageService.get('extensions.ignoredAutoUpdateExtension', StorageScope.PROFILE, '[]') || '[]');\n\t\tif (!ignoredAutoUpdateExtensions.length) {\n\t\t\treturn extensions;\n\t\t}\n\t\tconst result = await Promise.all(extensions.map(extension => {\n\t\t\tif (ignoredAutoUpdateExtensions.indexOf(new ExtensionKey(extension.identifier, extension.manifest.version).toString()) !== -1) {\n\t\t\t\treturn this.server.extensionManagementService.updateMetadata(extension, { pinned: true });\n\t\t\t}\n\t\t\treturn extension;\n\t\t}));\n\t\tthis.storageService.remove('extensions.ignoredAutoUpdateExtension', StorageScope.PROFILE);\n\t\treturn result;\n\t}\n\n\tprivate async reset(): Promise<void> {\n\t\tthis.installed = [];\n\t\tthis.installing = [];\n\t\tthis.uninstalling = [];\n\t\tawait this.fetchInstalledExtensions();\n\t\tthis._onReset.fire();\n\t}\n\n\tprivate async onDidInstallExtensions(results: readonly InstallExtensionResult[]): Promise<void> {\n\t\tfor (const event of results) {\n\t\t\tconst { local, source } = event;\n\t\t\tconst gallery = source && !URI.isUri(source) ? source : undefined;\n\t\t\tconst location = source && URI.isUri(source) ? source : undefined;\n\t\t\tconst installingExtension = gallery ? this.installing.filter(e => areSameExtensions(e.identifier, gallery.identifier))[0] : null;\n\t\t\tthis.installing = installingExtension ? this.installing.filter(e => e !== installingExtension) : this.installing;\n\n\t\t\tlet extension: Extension | undefined = installingExtension ? installingExtension\n\t\t\t\t: (location || local) ? this.instantiationService.createInstance(Extension, this.stateProvider, this.runtimeStateProvider, this.server, local, undefined)\n\t\t\t\t\t: undefined;\n\t\t\tif (extension) {\n\t\t\t\tif (local) {\n\t\t\t\t\tconst installed = this.installed.filter(e => areSameExtensions(e.identifier, extension!.identifier))[0];\n\t\t\t\t\tif (installed) {\n\t\t\t\t\t\textension = installed;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.installed.push(extension);\n\t\t\t\t\t}\n\t\t\t\t\textension.local = local;\n\t\t\t\t\tif (!extension.gallery) {\n\t\t\t\t\t\textension.gallery = gallery;\n\t\t\t\t\t}\n\t\t\t\t\tExtensions.updateExtensionFromControlManifest(extension, await this.server.extensionManagementService.getExtensionsControlManifest());\n\t\t\t\t\textension.enablementState = this.extensionEnablementService.getEnablementState(local);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._onChange.fire(!local || !extension ? undefined : { extension, operation: event.operation });\n\t\t\tif (extension && extension.local && !extension.gallery) {\n\t\t\t\tawait this.syncInstalledExtensionWithGallery(extension);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async onDidUpdateExtensionMetadata(local: ILocalExtension): Promise<void> {\n\t\tconst extension = this.installed.find(e => areSameExtensions(e.identifier, local.identifier));\n\t\tif (extension?.local) {\n\t\t\tconst hasChanged = extension.local.pinned !== local.pinned;\n\t\t\textension.local = local;\n\t\t\tif (hasChanged) {\n\t\t\t\tthis._onChange.fire({ extension });\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async syncInstalledExtensionWithGallery(extension: Extension): Promise<void> {\n\t\tif (!this.galleryService.isEnabled()) {\n\t\t\treturn;\n\t\t}\n\t\ttype GalleryServiceMatchInstalledExtensionClassification = {\n\t\t\towner: 'sandy081';\n\t\t\tcomment: 'Report when a request is made to match installed extension with gallery';\n\t\t};\n\t\tthis.telemetryService.publicLog2<{}, GalleryServiceMatchInstalledExtensionClassification>('galleryService:matchInstalledExtension');\n\t\tconst [compatible] = await this.galleryService.getExtensions([{ ...extension.identifier, preRelease: extension.local?.preRelease }], { compatible: true, targetPlatform: await this.server.extensionManagementService.getTargetPlatform() }, CancellationToken.None);\n\t\tif (compatible) {\n\t\t\textension.gallery = compatible;\n\t\t\tthis._onChange.fire({ extension });\n\t\t}\n\t}\n\n\tprivate onUninstallExtension(identifier: IExtensionIdentifier): void {\n\t\tconst extension = this.installed.filter(e => areSameExtensions(e.identifier, identifier))[0];\n\t\tif (extension) {\n\t\t\tconst uninstalling = this.uninstalling.filter(e => areSameExtensions(e.identifier, identifier))[0] || extension;\n\t\t\tthis.uninstalling = [uninstalling, ...this.uninstalling.filter(e => !areSameExtensions(e.identifier, identifier))];\n\t\t\tthis._onChange.fire(uninstalling ? { extension: uninstalling } : undefined);\n\t\t}\n\t}\n\n\tprivate onDidUninstallExtension({ identifier, error }: DidUninstallExtensionEvent): void {\n\t\tconst uninstalled = this.uninstalling.find(e => areSameExtensions(e.identifier, identifier)) || this.installed.find(e => areSameExtensions(e.identifier, identifier));\n\t\tthis.uninstalling = this.uninstalling.filter(e => !areSameExtensions(e.identifier, identifier));\n\t\tif (!error) {\n\t\t\tthis.installed = this.installed.filter(e => !areSameExtensions(e.identifier, identifier));\n\t\t}\n\t\tif (uninstalled) {\n\t\t\tthis._onChange.fire({ extension: uninstalled });\n\t\t}\n\t}\n\n\tprivate onEnablementChanged(platformExtensions: readonly IPlatformExtension[]) {\n\t\tconst extensions = this.local.filter(e => platformExtensions.some(p => areSameExtensions(e.identifier, p.identifier)));\n\t\tfor (const extension of extensions) {\n\t\t\tif (extension.local) {\n\t\t\t\tconst enablementState = this.extensionEnablementService.getEnablementState(extension.local);\n\t\t\t\tif (enablementState !== extension.enablementState) {\n\t\t\t\t\t(extension as Extension).enablementState = enablementState;\n\t\t\t\t\tthis._onChange.fire({ extension: extension as Extension });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetExtensionState(extension: Extension): ExtensionState {\n\t\tif (extension.gallery && this.installing.some(e => !!e.gallery && areSameExtensions(e.gallery.identifier, extension.gallery!.identifier))) {\n\t\t\treturn ExtensionState.Installing;\n\t\t}\n\t\tif (this.uninstalling.some(e => areSameExtensions(e.identifier, extension.identifier))) {\n\t\t\treturn ExtensionState.Uninstalling;\n\t\t}\n\t\tconst local = this.installed.filter(e => e === extension || (e.gallery && extension.gallery && areSameExtensions(e.gallery.identifier, extension.gallery.identifier)))[0];\n\t\treturn local ? ExtensionState.Installed : ExtensionState.Uninstalled;\n\t}\n}\n\nexport class ExtensionsWorkbenchService extends Disposable implements IExtensionsWorkbenchService, IURLHandler {\n\n\tprivate static readonly UpdatesCheckInterval = 1000 * 60 * 60 * 12; // 12 hours\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate hasOutdatedExtensionsContextKey: IContextKey<boolean>;\n\n\tprivate readonly localExtensions: Extensions | null = null;\n\tprivate readonly remoteExtensions: Extensions | null = null;\n\tprivate readonly webExtensions: Extensions | null = null;\n\tprivate readonly extensionsServers: Extensions[] = [];\n\n\tprivate updatesCheckDelayer: ThrottledDelayer<void>;\n\tprivate autoUpdateDelayer: ThrottledDelayer<void>;\n\n\tprivate readonly _onChange: Emitter<IExtension | undefined> = new Emitter<IExtension | undefined>();\n\tget onChange(): Event<IExtension | undefined> { return this._onChange.event; }\n\n\tprivate readonly _onReset = new Emitter<void>();\n\tget onReset() { return this._onReset.event; }\n\n\treadonly preferPreReleases = this.productService.quality !== 'stable';\n\n\tprivate installing: IExtension[] = [];\n\tprivate tasksInProgress: CancelablePromise<any>[] = [];\n\n\treadonly whenInitialized: Promise<void>;\n\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IWorkbenchExtensionManagementService private readonly extensionManagementService: IWorkbenchExtensionManagementService,\n\t\t@IExtensionGalleryService private readonly galleryService: IExtensionGalleryService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IURLService urlService: IURLService,\n\t\t@IWorkbenchExtensionEnablementService private readonly extensionEnablementService: IWorkbenchExtensionEnablementService,\n\t\t@IHostService private readonly hostService: IHostService,\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t\t@IExtensionManagementServerService private readonly extensionManagementServerService: IExtensionManagementServerService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IIgnoredExtensionsManagementService private readonly extensionsSyncManagementService: IIgnoredExtensionsManagementService,\n\t\t@IUserDataAutoSyncService private readonly userDataAutoSyncService: IUserDataAutoSyncService,\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IExtensionManifestPropertiesService private readonly extensionManifestPropertiesService: IExtensionManifestPropertiesService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t\t@ILocaleService private readonly localeService: ILocaleService,\n\t\t@ILifecycleService private readonly lifecycleService: ILifecycleService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IUserDataProfileService private readonly userDataProfileService: IUserDataProfileService,\n\t) {\n\t\tsuper();\n\t\tconst preferPreReleasesValue = configurationService.getValue('_extensions.preferPreReleases');\n\t\tif (!isUndefined(preferPreReleasesValue)) {\n\t\t\tthis.preferPreReleases = !!preferPreReleasesValue;\n\t\t}\n\t\tthis.hasOutdatedExtensionsContextKey = HasOutdatedExtensionsContext.bindTo(contextKeyService);\n\t\tif (extensionManagementServerService.localExtensionManagementServer) {\n\t\t\tthis.localExtensions = this._register(instantiationService.createInstance(Extensions, extensionManagementServerService.localExtensionManagementServer, ext => this.getExtensionState(ext), ext => this.getReloadStatus(ext)));\n\t\t\tthis._register(this.localExtensions.onChange(e => this.onDidChangeExtensions(e?.extension)));\n\t\t\tthis._register(this.localExtensions.onReset(e => this.reset()));\n\t\t\tthis.extensionsServers.push(this.localExtensions);\n\t\t}\n\t\tif (extensionManagementServerService.remoteExtensionManagementServer) {\n\t\t\tthis.remoteExtensions = this._register(instantiationService.createInstance(Extensions, extensionManagementServerService.remoteExtensionManagementServer, ext => this.getExtensionState(ext), ext => this.getReloadStatus(ext)));\n\t\t\tthis._register(this.remoteExtensions.onChange(e => this.onDidChangeExtensions(e?.extension)));\n\t\t\tthis._register(this.remoteExtensions.onReset(e => this.reset()));\n\t\t\tthis.extensionsServers.push(this.remoteExtensions);\n\t\t}\n\t\tif (extensionManagementServerService.webExtensionManagementServer) {\n\t\t\tthis.webExtensions = this._register(instantiationService.createInstance(Extensions, extensionManagementServerService.webExtensionManagementServer, ext => this.getExtensionState(ext), ext => this.getReloadStatus(ext)));\n\t\t\tthis._register(this.webExtensions.onChange(e => this.onDidChangeExtensions(e?.extension)));\n\t\t\tthis._register(this.webExtensions.onReset(e => this.reset()));\n\t\t\tthis.extensionsServers.push(this.webExtensions);\n\t\t}\n\n\t\tthis.updatesCheckDelayer = new ThrottledDelayer<void>(ExtensionsWorkbenchService.UpdatesCheckInterval);\n\t\tthis.autoUpdateDelayer = new ThrottledDelayer<void>(1000);\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis.updatesCheckDelayer.cancel();\n\t\t\tthis.autoUpdateDelayer.cancel();\n\t\t}));\n\n\t\turlService.registerHandler(this);\n\n\t\tthis.whenInitialized = this.initialize();\n\t}\n\n\tprivate async initialize(): Promise<void> {\n\t\t// initialize local extensions\n\t\tawait Promise.all([this.queryLocal(), this.extensionService.whenInstalledExtensionsRegistered()]);\n\t\tif (this._store.isDisposed) {\n\t\t\treturn;\n\t\t}\n\t\tthis.onDidChangeRunningExtensions(this.extensionService.extensions, []);\n\t\tthis._register(this.extensionService.onDidChangeExtensions(({ added, removed }) => this.onDidChangeRunningExtensions(added, removed)));\n\n\t\tawait this.lifecycleService.when(LifecyclePhase.Eventually);\n\t\tif (this._store.isDisposed) {\n\t\t\treturn;\n\t\t}\n\t\tthis.initializeAutoUpdate();\n\t\tthis.reportInstalledExtensionsTelemetry();\n\t\tthis._register(Event.debounce(this.onChange, () => undefined, 100)(() => this.reportProgressFromOtherSources()));\n\t}\n\n\tprivate initializeAutoUpdate(): void {\n\t\t// Register listeners for auto updates\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(AutoUpdateConfigurationKey)) {\n\t\t\t\tif (this.isAutoUpdateEnabled()) {\n\t\t\t\t\tthis.checkForUpdates();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (e.affectsConfiguration(AutoCheckUpdatesConfigurationKey)) {\n\t\t\t\tif (this.isAutoCheckUpdatesEnabled()) {\n\t\t\t\t\tthis.checkForUpdates();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.extensionEnablementService.onEnablementChanged(platformExtensions => {\n\t\t\tif (this.getAutoUpdateValue() === 'onlyEnabledExtensions' && platformExtensions.some(e => this.extensionEnablementService.isEnabled(e))) {\n\t\t\t\tthis.checkForUpdates();\n\t\t\t}\n\t\t}));\n\t\tthis._register(Event.debounce(this.onChange, () => undefined, 100)(() => this.hasOutdatedExtensionsContextKey.set(this.outdated.length > 0)));\n\n\t\t// Update AutoUpdate Contexts\n\t\tthis.hasOutdatedExtensionsContextKey.set(this.outdated.length > 0);\n\n\t\t// Check for updates\n\t\tthis.eventuallyCheckForUpdates(true);\n\n\t\tif (isWeb) {\n\t\t\tthis.syncPinnedBuiltinExtensions();\n\t\t\t// Always auto update builtin extensions in web\n\t\t\tif (!this.isAutoUpdateEnabled()) {\n\t\t\t\tthis.autoUpdateBuiltinExtensions();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate reportInstalledExtensionsTelemetry() {\n\t\tconst extensionIds = this.installed.filter(extension =>\n\t\t\t!extension.isBuiltin &&\n\t\t\t(extension.enablementState === EnablementState.EnabledWorkspace ||\n\t\t\t\textension.enablementState === EnablementState.EnabledGlobally))\n\t\t\t.map(extension => ExtensionIdentifier.toKey(extension.identifier.id));\n\t\tthis.telemetryService.publicLog2<InstalledExtensionsEvent, ExtensionsLoadClassification>('installedExtensions', { extensionIds: new TelemetryTrustedValue(extensionIds.join(';')), count: extensionIds.length });\n\t}\n\n\tprivate async onDidChangeRunningExtensions(added: ReadonlyArray<IExtensionDescription>, removed: ReadonlyArray<IExtensionDescription>): Promise<void> {\n\t\tconst changedExtensions: IExtension[] = [];\n\t\tconst extsNotInstalled: IExtensionInfo[] = [];\n\t\tfor (const desc of added) {\n\t\t\tconst extension = this.installed.find(e => areSameExtensions({ id: desc.identifier.value, uuid: desc.uuid }, e.identifier));\n\t\t\tif (extension) {\n\t\t\t\tchangedExtensions.push(extension);\n\t\t\t} else {\n\t\t\t\textsNotInstalled.push({ id: desc.identifier.value, uuid: desc.uuid });\n\t\t\t}\n\t\t}\n\t\tif (extsNotInstalled.length) {\n\t\t\tconst extensions = await this.getExtensions(extsNotInstalled, CancellationToken.None);\n\t\t\tfor (const extension of extensions) {\n\t\t\t\tchangedExtensions.push(extension);\n\t\t\t}\n\t\t}\n\t\tfor (const changedExtension of changedExtensions) {\n\t\t\tthis._onChange.fire(changedExtension);\n\t\t}\n\t}\n\n\tprivate reset(): void {\n\t\tfor (const task of this.tasksInProgress) {\n\t\t\ttask.cancel();\n\t\t}\n\t\tthis.tasksInProgress = [];\n\t\tthis.installing = [];\n\t\tthis.onDidChangeExtensions();\n\t\tthis._onReset.fire();\n\t}\n\n\tprivate onDidChangeExtensions(extension?: IExtension): void {\n\t\tthis._installed = undefined;\n\t\tthis._local = undefined;\n\t\tthis._onChange.fire(extension);\n\t}\n\n\tprivate _local: IExtension[] | undefined;\n\tget local(): IExtension[] {\n\t\tif (!this._local) {\n\t\t\tif (this.extensionsServers.length === 1) {\n\t\t\t\tthis._local = this.installed;\n\t\t\t} else {\n\t\t\t\tthis._local = [];\n\t\t\t\tconst byId = groupByExtension(this.installed, r => r.identifier);\n\t\t\t\tfor (const extensions of byId) {\n\t\t\t\t\tthis._local.push(this.getPrimaryExtension(extensions));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this._local;\n\t}\n\n\tprivate _installed: IExtension[] | undefined;\n\tget installed(): IExtension[] {\n\t\tif (!this._installed) {\n\t\t\tthis._installed = [];\n\t\t\tfor (const extensions of this.extensionsServers) {\n\t\t\t\tfor (const extension of extensions.local) {\n\t\t\t\t\tthis._installed.push(extension);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this._installed;\n\t}\n\n\tget outdated(): IExtension[] {\n\t\treturn this.installed.filter(e => e.outdated && e.local && e.state === ExtensionState.Installed);\n\t}\n\n\tasync queryLocal(server?: IExtensionManagementServer): Promise<IExtension[]> {\n\t\tif (server) {\n\t\t\tif (this.localExtensions && this.extensionManagementServerService.localExtensionManagementServer === server) {\n\t\t\t\treturn this.localExtensions.queryInstalled();\n\t\t\t}\n\t\t\tif (this.remoteExtensions && this.extensionManagementServerService.remoteExtensionManagementServer === server) {\n\t\t\t\treturn this.remoteExtensions.queryInstalled();\n\t\t\t}\n\t\t\tif (this.webExtensions && this.extensionManagementServerService.webExtensionManagementServer === server) {\n\t\t\t\treturn this.webExtensions.queryInstalled();\n\t\t\t}\n\t\t}\n\n\t\tif (this.localExtensions) {\n\t\t\ttry {\n\t\t\t\tawait this.localExtensions.queryInstalled();\n\t\t\t}\n\t\t\tcatch (error) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t}\n\t\tif (this.remoteExtensions) {\n\t\t\ttry {\n\t\t\t\tawait this.remoteExtensions.queryInstalled();\n\t\t\t}\n\t\t\tcatch (error) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t}\n\t\tif (this.webExtensions) {\n\t\t\ttry {\n\t\t\t\tawait this.webExtensions.queryInstalled();\n\t\t\t}\n\t\t\tcatch (error) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t}\n\t\treturn this.local;\n\t}\n\n\tqueryGallery(token: CancellationToken): Promise<IPager<IExtension>>;\n\tqueryGallery(options: IQueryOptions, token: CancellationToken): Promise<IPager<IExtension>>;\n\tasync queryGallery(arg1: any, arg2?: any): Promise<IPager<IExtension>> {\n\t\tif (!this.galleryService.isEnabled()) {\n\t\t\treturn singlePagePager([]);\n\t\t}\n\n\t\tconst options: IQueryOptions = CancellationToken.isCancellationToken(arg1) ? {} : arg1;\n\t\tconst token: CancellationToken = CancellationToken.isCancellationToken(arg1) ? arg1 : arg2;\n\t\toptions.text = options.text ? this.resolveQueryText(options.text) : options.text;\n\t\toptions.includePreRelease = isUndefined(options.includePreRelease) ? this.preferPreReleases : options.includePreRelease;\n\n\t\tconst extensionsControlManifest = await this.extensionManagementService.getExtensionsControlManifest();\n\t\tconst pager = await this.galleryService.query(options, token);\n\t\tthis.syncInstalledExtensionsWithGallery(pager.firstPage);\n\t\treturn {\n\t\t\tfirstPage: pager.firstPage.map(gallery => this.fromGallery(gallery, extensionsControlManifest)),\n\t\t\ttotal: pager.total,\n\t\t\tpageSize: pager.pageSize,\n\t\t\tgetPage: async (pageIndex, token) => {\n\t\t\t\tconst page = await pager.getPage(pageIndex, token);\n\t\t\t\tthis.syncInstalledExtensionsWithGallery(page);\n\t\t\t\treturn page.map(gallery => this.fromGallery(gallery, extensionsControlManifest));\n\t\t\t}\n\t\t};\n\t}\n\n\tgetExtensions(extensionInfos: IExtensionInfo[], token: CancellationToken): Promise<IExtension[]>;\n\tgetExtensions(extensionInfos: IExtensionInfo[], options: IExtensionQueryOptions, token: CancellationToken): Promise<IExtension[]>;\n\tasync getExtensions(extensionInfos: IExtensionInfo[], arg1: any, arg2?: any): Promise<IExtension[]> {\n\t\tif (!this.galleryService.isEnabled()) {\n\t\t\treturn [];\n\t\t}\n\n\t\textensionInfos.forEach(e => e.preRelease = e.preRelease ?? this.preferPreReleases);\n\t\tconst extensionsControlManifest = await this.extensionManagementService.getExtensionsControlManifest();\n\t\tconst galleryExtensions = await this.galleryService.getExtensions(extensionInfos, arg1, arg2);\n\t\tthis.syncInstalledExtensionsWithGallery(galleryExtensions);\n\t\treturn galleryExtensions.map(gallery => this.fromGallery(gallery, extensionsControlManifest));\n\t}\n\n\tprivate resolveQueryText(text: string): string {\n\t\ttext = text.replace(/@web/g, `tag:\"${WEB_EXTENSION_TAG}\"`);\n\n\t\tconst extensionRegex = /\\bext:([^\\s]+)\\b/g;\n\t\tif (extensionRegex.test(text)) {\n\t\t\ttext = text.replace(extensionRegex, (m, ext) => {\n\n\t\t\t\t// Get curated keywords\n\t\t\t\tconst lookup = this.productService.extensionKeywords || {};\n\t\t\t\tconst keywords = lookup[ext] || [];\n\n\t\t\t\t// Get mode name\n\t\t\t\tconst languageId = this.languageService.guessLanguageIdByFilepathOrFirstLine(URI.file(`.${ext}`));\n\t\t\t\tconst languageName = languageId && this.languageService.getLanguageName(languageId);\n\t\t\t\tconst languageTag = languageName ? ` tag:\"${languageName}\"` : '';\n\n\t\t\t\t// Construct a rich query\n\t\t\t\treturn `tag:\"__ext_${ext}\" tag:\"__ext_.${ext}\" ${keywords.map(tag => `tag:\"${tag}\"`).join(' ')}${languageTag} tag:\"${ext}\"`;\n\t\t\t});\n\t\t}\n\t\treturn text.substr(0, 350);\n\t}\n\n\tprivate fromGallery(gallery: IGalleryExtension, extensionsControlManifest: IExtensionsControlManifest): IExtension {\n\t\tlet extension = this.getInstalledExtensionMatchingGallery(gallery);\n\t\tif (!extension) {\n\t\t\textension = this.instantiationService.createInstance(Extension, ext => this.getExtensionState(ext), ext => this.getReloadStatus(ext), undefined, undefined, gallery);\n\t\t\tExtensions.updateExtensionFromControlManifest(<Extension>extension, extensionsControlManifest);\n\t\t}\n\t\treturn extension;\n\t}\n\n\tprivate getInstalledExtensionMatchingGallery(gallery: IGalleryExtension): IExtension | null {\n\t\tfor (const installed of this.local) {\n\t\t\tif (installed.identifier.uuid) { // Installed from Gallery\n\t\t\t\tif (installed.identifier.uuid === gallery.identifier.uuid) {\n\t\t\t\t\treturn installed;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (areSameExtensions(installed.identifier, gallery.identifier)) { // Installed from other sources\n\t\t\t\t\treturn installed;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tasync open(extension: IExtension | string, options?: IExtensionEditorOptions): Promise<void> {\n\t\tif (typeof extension === 'string') {\n\t\t\tconst id = extension;\n\t\t\textension = this.installed.find(e => areSameExtensions(e.identifier, { id })) ?? (await this.getExtensions([{ id: extension }], CancellationToken.None))[0];\n\t\t}\n\t\tif (!extension) {\n\t\t\tthrow new Error(`Extension not found. ${extension}`);\n\t\t}\n\t\tconst editor = await this.editorService.openEditor(this.instantiationService.createInstance(ExtensionsInput, extension), options, options?.sideByside ? SIDE_GROUP : ACTIVE_GROUP);\n\t\tif (options?.tab && editor instanceof ExtensionEditor) {\n\t\t\tawait editor.openTab(options.tab);\n\t\t}\n\t}\n\n\tgetExtensionStatus(extension: IExtension): IExtensionsStatus | undefined {\n\t\tconst extensionsStatus = this.extensionService.getExtensionsStatus();\n\t\tfor (const id of Object.keys(extensionsStatus)) {\n\t\t\tif (areSameExtensions({ id }, extension.identifier)) {\n\t\t\t\treturn extensionsStatus[id];\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate getReloadStatus(extension: IExtension): string | undefined {\n\t\tconst isUninstalled = extension.state === ExtensionState.Uninstalled;\n\t\tconst runningExtension = this.extensionService.extensions.find(e => areSameExtensions({ id: e.identifier.value, uuid: e.uuid }, extension!.identifier));\n\n\t\tif (isUninstalled) {\n\t\t\tconst canRemoveRunningExtension = runningExtension && this.extensionService.canRemoveExtension(runningExtension);\n\t\t\tconst isSameExtensionRunning = runningExtension && (!extension.server || extension.server === this.extensionManagementServerService.getExtensionManagementServer(toExtension(runningExtension)));\n\t\t\tif (!canRemoveRunningExtension && isSameExtensionRunning) {\n\t\t\t\treturn nls.localize('postUninstallTooltip', \"Please reload Visual Studio Code to complete the uninstallation of this extension.\");\n\t\t\t}\n\t\t\treturn undefined;\n\t\t}\n\t\tif (extension.local) {\n\t\t\tconst isSameExtensionRunning = runningExtension && extension.server === this.extensionManagementServerService.getExtensionManagementServer(toExtension(runningExtension));\n\t\t\tconst isEnabled = this.extensionEnablementService.isEnabled(extension.local);\n\n\t\t\t// Extension is running\n\t\t\tif (runningExtension) {\n\t\t\t\tif (isEnabled) {\n\t\t\t\t\t// No Reload is required if extension can run without reload\n\t\t\t\t\tif (this.extensionService.canAddExtension(toExtensionDescription(extension.local))) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\tconst runningExtensionServer = this.extensionManagementServerService.getExtensionManagementServer(toExtension(runningExtension));\n\n\t\t\t\t\tif (isSameExtensionRunning) {\n\t\t\t\t\t\t// Different version or target platform of same extension is running. Requires reload to run the current version\n\t\t\t\t\t\tif (!runningExtension.isUnderDevelopment && (extension.version !== runningExtension.version || extension.local.targetPlatform !== runningExtension.targetPlatform)) {\n\t\t\t\t\t\t\treturn nls.localize('postUpdateTooltip', \"Please reload Visual Studio Code to enable the updated extension.\");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.extensionsServers.length > 1) {\n\t\t\t\t\t\t\tconst extensionInOtherServer = this.installed.filter(e => areSameExtensions(e.identifier, extension!.identifier) && e.server !== extension!.server)[0];\n\t\t\t\t\t\t\tif (extensionInOtherServer) {\n\t\t\t\t\t\t\t\t// This extension prefers to run on UI/Local side but is running in remote\n\t\t\t\t\t\t\t\tif (runningExtensionServer === this.extensionManagementServerService.remoteExtensionManagementServer && this.extensionManifestPropertiesService.prefersExecuteOnUI(extension.local!.manifest) && extensionInOtherServer.server === this.extensionManagementServerService.localExtensionManagementServer) {\n\t\t\t\t\t\t\t\t\treturn nls.localize('enable locally', \"Please reload Visual Studio Code to enable this extension locally.\");\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// This extension prefers to run on Workspace/Remote side but is running in local\n\t\t\t\t\t\t\t\tif (runningExtensionServer === this.extensionManagementServerService.localExtensionManagementServer && this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(extension.local!.manifest) && extensionInOtherServer.server === this.extensionManagementServerService.remoteExtensionManagementServer) {\n\t\t\t\t\t\t\t\t\treturn nls.localize('enable remote', \"Please reload Visual Studio Code to enable this extension in {0}.\", this.extensionManagementServerService.remoteExtensionManagementServer?.label);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif (extension.server === this.extensionManagementServerService.localExtensionManagementServer && runningExtensionServer === this.extensionManagementServerService.remoteExtensionManagementServer) {\n\t\t\t\t\t\t\t// This extension prefers to run on UI/Local side but is running in remote\n\t\t\t\t\t\t\tif (this.extensionManifestPropertiesService.prefersExecuteOnUI(extension.local!.manifest)) {\n\t\t\t\t\t\t\t\treturn nls.localize('postEnableTooltip', \"Please reload Visual Studio Code to enable this extension.\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (extension.server === this.extensionManagementServerService.remoteExtensionManagementServer && runningExtensionServer === this.extensionManagementServerService.localExtensionManagementServer) {\n\t\t\t\t\t\t\t// This extension prefers to run on Workspace/Remote side but is running in local\n\t\t\t\t\t\t\tif (this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(extension.local!.manifest)) {\n\t\t\t\t\t\t\t\treturn nls.localize('postEnableTooltip', \"Please reload Visual Studio Code to enable this extension.\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn undefined;\n\t\t\t\t} else {\n\t\t\t\t\tif (isSameExtensionRunning) {\n\t\t\t\t\t\treturn nls.localize('postDisableTooltip', \"Please reload Visual Studio Code to disable this extension.\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\t// Extension is not running\n\t\t\telse {\n\t\t\t\tif (isEnabled && !this.extensionService.canAddExtension(toExtensionDescription(extension.local))) {\n\t\t\t\t\treturn nls.localize('postEnableTooltip', \"Please reload Visual Studio Code to enable this extension.\");\n\t\t\t\t}\n\n\t\t\t\tconst otherServer = extension.server ? extension.server === this.extensionManagementServerService.localExtensionManagementServer ? this.extensionManagementServerService.remoteExtensionManagementServer : this.extensionManagementServerService.localExtensionManagementServer : null;\n\t\t\t\tif (otherServer && extension.enablementState === EnablementState.DisabledByExtensionKind) {\n\t\t\t\t\tconst extensionInOtherServer = this.local.filter(e => areSameExtensions(e.identifier, extension!.identifier) && e.server === otherServer)[0];\n\t\t\t\t\t// Same extension in other server exists and\n\t\t\t\t\tif (extensionInOtherServer && extensionInOtherServer.local && this.extensionEnablementService.isEnabled(extensionInOtherServer.local)) {\n\t\t\t\t\t\treturn nls.localize('postEnableTooltip', \"Please reload Visual Studio Code to enable this extension.\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate getPrimaryExtension(extensions: IExtension[]): IExtension {\n\t\tif (extensions.length === 1) {\n\t\t\treturn extensions[0];\n\t\t}\n\n\t\tconst enabledExtensions = extensions.filter(e => e.local && this.extensionEnablementService.isEnabled(e.local));\n\t\tif (enabledExtensions.length === 1) {\n\t\t\treturn enabledExtensions[0];\n\t\t}\n\n\t\tconst extensionsToChoose = enabledExtensions.length ? enabledExtensions : extensions;\n\t\tconst manifest = extensionsToChoose.find(e => e.local && e.local.manifest)?.local?.manifest;\n\n\t\t// Manifest is not found which should not happen.\n\t\t// In which case return the first extension.\n\t\tif (!manifest) {\n\t\t\treturn extensionsToChoose[0];\n\t\t}\n\n\t\tconst extensionKinds = this.extensionManifestPropertiesService.getExtensionKind(manifest);\n\n\t\tlet extension = extensionsToChoose.find(extension => {\n\t\t\tfor (const extensionKind of extensionKinds) {\n\t\t\t\tswitch (extensionKind) {\n\t\t\t\t\tcase 'ui':\n\t\t\t\t\t\t/* UI extension is chosen only if it is installed locally */\n\t\t\t\t\t\tif (extension.server === this.extensionManagementServerService.localExtensionManagementServer) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\tcase 'workspace':\n\t\t\t\t\t\t/* Choose remote workspace extension if exists */\n\t\t\t\t\t\tif (extension.server === this.extensionManagementServerService.remoteExtensionManagementServer) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\tcase 'web':\n\t\t\t\t\t\t/* Choose web extension if exists */\n\t\t\t\t\t\tif (extension.server === this.extensionManagementServerService.webExtensionManagementServer) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tif (!extension && this.extensionManagementServerService.localExtensionManagementServer) {\n\t\t\textension = extensionsToChoose.find(extension => {\n\t\t\t\tfor (const extensionKind of extensionKinds) {\n\t\t\t\t\tswitch (extensionKind) {\n\t\t\t\t\t\tcase 'workspace':\n\t\t\t\t\t\t\t/* Choose local workspace extension if exists */\n\t\t\t\t\t\t\tif (extension.server === this.extensionManagementServerService.localExtensionManagementServer) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\tcase 'web':\n\t\t\t\t\t\t\t/* Choose local web extension if exists */\n\t\t\t\t\t\t\tif (extension.server === this.extensionManagementServerService.localExtensionManagementServer) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\n\t\tif (!extension && this.extensionManagementServerService.webExtensionManagementServer) {\n\t\t\textension = extensionsToChoose.find(extension => {\n\t\t\t\tfor (const extensionKind of extensionKinds) {\n\t\t\t\t\tswitch (extensionKind) {\n\t\t\t\t\t\tcase 'web':\n\t\t\t\t\t\t\t/* Choose web extension if exists */\n\t\t\t\t\t\t\tif (extension.server === this.extensionManagementServerService.webExtensionManagementServer) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\n\t\tif (!extension && this.extensionManagementServerService.remoteExtensionManagementServer) {\n\t\t\textension = extensionsToChoose.find(extension => {\n\t\t\t\tfor (const extensionKind of extensionKinds) {\n\t\t\t\t\tswitch (extensionKind) {\n\t\t\t\t\t\tcase 'web':\n\t\t\t\t\t\t\t/* Choose remote web extension if exists */\n\t\t\t\t\t\t\tif (extension.server === this.extensionManagementServerService.remoteExtensionManagementServer) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\n\t\treturn extension || extensions[0];\n\t}\n\n\tprivate getExtensionState(extension: Extension): ExtensionState {\n\t\tif (this.installing.some(i => areSameExtensions(i.identifier, extension.identifier) && (!extension.server || i.server === extension.server))) {\n\t\t\treturn ExtensionState.Installing;\n\t\t}\n\t\tif (this.remoteExtensions) {\n\t\t\tconst state = this.remoteExtensions.getExtensionState(extension);\n\t\t\tif (state !== ExtensionState.Uninstalled) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t}\n\t\tif (this.webExtensions) {\n\t\t\tconst state = this.webExtensions.getExtensionState(extension);\n\t\t\tif (state !== ExtensionState.Uninstalled) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t}\n\t\tif (this.localExtensions) {\n\t\t\treturn this.localExtensions.getExtensionState(extension);\n\t\t}\n\t\treturn ExtensionState.Uninstalled;\n\t}\n\n\tasync checkForUpdates(onlyBuiltin?: boolean): Promise<void> {\n\t\tif (!this.galleryService.isEnabled()) {\n\t\t\treturn;\n\t\t}\n\t\tconst extensions: Extensions[] = [];\n\t\tif (this.localExtensions) {\n\t\t\textensions.push(this.localExtensions);\n\t\t}\n\t\tif (this.remoteExtensions) {\n\t\t\textensions.push(this.remoteExtensions);\n\t\t}\n\t\tif (this.webExtensions) {\n\t\t\textensions.push(this.webExtensions);\n\t\t}\n\t\tif (!extensions.length) {\n\t\t\treturn;\n\t\t}\n\t\tconst infos: IExtensionInfo[] = [];\n\t\tfor (const installed of this.local) {\n\t\t\tif (onlyBuiltin && !installed.isBuiltin) {\n\t\t\t\t// Skip if check updates only for builtin extensions and current extension is not builtin.\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (installed.isBuiltin && !installed.pinned && (installed.type === ExtensionType.System || !installed.local?.identifier.uuid)) {\n\t\t\t\t// Skip checking updates for a builtin extension if it is a system extension or if it does not has Marketplace identifier\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tinfos.push({ ...installed.identifier, preRelease: !!installed.local?.preRelease });\n\t\t}\n\t\tif (infos.length) {\n\t\t\tconst targetPlatform = await extensions[0].server.extensionManagementService.getTargetPlatform();\n\t\t\ttype GalleryServiceUpdatesCheckClassification = {\n\t\t\t\towner: 'sandy081';\n\t\t\t\tcomment: 'Report when a request is made to check for updates of extensions';\n\t\t\t\treadonly count: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Number of extensions to check update' };\n\t\t\t};\n\t\t\ttype GalleryServiceUpdatesCheckEvent = {\n\t\t\t\treadonly count: number;\n\t\t\t};\n\t\t\tthis.telemetryService.publicLog2<GalleryServiceUpdatesCheckEvent, GalleryServiceUpdatesCheckClassification>('galleryService:checkingForUpdates', {\n\t\t\t\tcount: infos.length,\n\t\t\t});\n\t\t\tconst galleryExtensions = await this.galleryService.getExtensions(infos, { targetPlatform, compatible: true }, CancellationToken.None);\n\t\t\tif (galleryExtensions.length) {\n\t\t\t\tawait this.syncInstalledExtensionsWithGallery(galleryExtensions);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async syncInstalledExtensionsWithGallery(gallery: IGalleryExtension[]): Promise<void> {\n\t\tconst extensions: Extensions[] = [];\n\t\tif (this.localExtensions) {\n\t\t\textensions.push(this.localExtensions);\n\t\t}\n\t\tif (this.remoteExtensions) {\n\t\t\textensions.push(this.remoteExtensions);\n\t\t}\n\t\tif (this.webExtensions) {\n\t\t\textensions.push(this.webExtensions);\n\t\t}\n\t\tif (!extensions.length) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = await Promise.allSettled(extensions.map(extensions => extensions.syncInstalledExtensionsWithGallery(gallery)));\n\t\tif (this.isAutoUpdateEnabled() && result.some(r => r.status === 'fulfilled' && r.value)) {\n\t\t\tthis.eventuallyAutoUpdateExtensions();\n\t\t}\n\t}\n\n\tprivate getAutoUpdateValue(): boolean | 'onlyEnabledExtensions' {\n\t\tconst autoUpdate = this.configurationService.getValue<boolean | 'onlyEnabledExtensions'>(AutoUpdateConfigurationKey);\n\t\treturn isBoolean(autoUpdate) || autoUpdate === 'onlyEnabledExtensions' ? autoUpdate : true;\n\t}\n\n\tprivate isAutoUpdateEnabled(): boolean {\n\t\treturn this.getAutoUpdateValue() !== false;\n\t}\n\n\tprivate isAutoCheckUpdatesEnabled(): boolean {\n\t\treturn this.configurationService.getValue(AutoCheckUpdatesConfigurationKey);\n\t}\n\n\tprivate eventuallyCheckForUpdates(immediate = false): void {\n\t\tthis.updatesCheckDelayer.trigger(async () => {\n\t\t\tif (this.isAutoUpdateEnabled() || this.isAutoCheckUpdatesEnabled()) {\n\t\t\t\tawait this.checkForUpdates();\n\t\t\t}\n\t\t\tthis.eventuallyCheckForUpdates();\n\t\t}, immediate ? 0 : ExtensionsWorkbenchService.UpdatesCheckInterval).then(undefined, err => null);\n\t}\n\n\tprivate eventuallyAutoUpdateExtensions(): void {\n\t\tthis.autoUpdateDelayer.trigger(() => this.autoUpdateExtensions())\n\t\t\t.then(undefined, err => null);\n\t}\n\n\tprivate async autoUpdateBuiltinExtensions(): Promise<void> {\n\t\tawait this.checkForUpdates(true);\n\t\tconst toUpdate = this.outdated.filter(e => e.isBuiltin);\n\t\tawait Promises.settled(toUpdate.map(e => this.install(e, e.local?.preRelease ? { installPreReleaseVersion: true } : undefined)));\n\t}\n\n\tprivate async syncPinnedBuiltinExtensions(): Promise<void> {\n\t\tconst infos: IExtensionInfo[] = [];\n\t\tfor (const installed of this.local) {\n\t\t\tif (installed.isBuiltin && installed.pinned && installed.local?.identifier.uuid) {\n\t\t\t\tinfos.push({ ...installed.identifier, version: installed.version });\n\t\t\t}\n\t\t}\n\t\tif (infos.length) {\n\t\t\tconst galleryExtensions = await this.galleryService.getExtensions(infos, CancellationToken.None);\n\t\t\tif (galleryExtensions.length) {\n\t\t\t\tawait this.syncInstalledExtensionsWithGallery(galleryExtensions);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate autoUpdateExtensions(): Promise<any> {\n\t\tif (!this.isAutoUpdateEnabled()) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst toUpdate = this.outdated.filter(e => !e.pinned &&\n\t\t\t(this.getAutoUpdateValue() === true || (e.local && this.extensionEnablementService.isEnabled(e.local)))\n\t\t);\n\n\t\treturn Promises.settled(toUpdate.map(e => this.install(e, e.local?.preRelease ? { installPreReleaseVersion: true } : undefined)));\n\t}\n\n\tasync pinExtension(extension: IExtension, pinned: boolean): Promise<void> {\n\t\tif (!extension.local) {\n\t\t\tthrow new Error('Only installed extensions can be pinned');\n\t\t}\n\t\tawait this.extensionManagementService.updateMetadata(extension.local, { pinned });\n\t}\n\n\tasync canInstall(extension: IExtension): Promise<boolean> {\n\t\tif (!(extension instanceof Extension)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (extension.isMalicious) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (extension.deprecationInfo?.disallowInstall) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!extension.gallery) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.localExtensions && await this.localExtensions.canInstall(extension.gallery)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.remoteExtensions && await this.remoteExtensions.canInstall(extension.gallery)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.webExtensions && await this.webExtensions.canInstall(extension.gallery)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tinstall(extension: URI | IExtension, installOptions?: InstallOptions | InstallVSIXOptions, progressLocation?: ProgressLocation): Promise<IExtension> {\n\t\treturn this.doInstall(extension, async () => {\n\t\t\tif (extension instanceof URI) {\n\t\t\t\treturn this.installFromVSIX(extension, installOptions);\n\t\t\t}\n\t\t\tif (extension.isMalicious) {\n\t\t\t\tthrow new Error(nls.localize('malicious', \"This extension is reported to be problematic.\"));\n\t\t\t}\n\t\t\tif (!extension.gallery) {\n\t\t\t\tthrow new Error('Missing gallery');\n\t\t\t}\n\t\t\treturn this.installFromGallery(extension, extension.gallery, installOptions);\n\t\t}, progressLocation);\n\t}\n\n\tasync installInServer(extension: IExtension, server: IExtensionManagementServer): Promise<void> {\n\t\tawait this.doInstall(extension, async () => {\n\t\t\tconst local = extension.local;\n\t\t\tif (!local) {\n\t\t\t\tthrow new Error('Extension not found');\n\t\t\t}\n\t\t\tif (!extension.gallery) {\n\t\t\t\textension = (await this.getExtensions([{ ...extension.identifier, preRelease: local.preRelease }], CancellationToken.None))[0] ?? extension;\n\t\t\t}\n\t\t\tif (extension.gallery) {\n\t\t\t\treturn server.extensionManagementService.installFromGallery(extension.gallery, { installPreReleaseVersion: local.preRelease });\n\t\t\t}\n\n\t\t\tconst targetPlatform = await server.extensionManagementService.getTargetPlatform();\n\t\t\tif (!isTargetPlatformCompatible(local.targetPlatform, [local.targetPlatform], targetPlatform)) {\n\t\t\t\tthrow new Error(nls.localize('incompatible', \"Can't install '{0}' extension because it is not compatible.\", extension.identifier.id));\n\t\t\t}\n\n\t\t\tconst vsix = await this.extensionManagementService.zip(local);\n\t\t\ttry {\n\t\t\t\treturn await server.extensionManagementService.install(vsix);\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tawait this.fileService.del(vsix);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tcanSetLanguage(extension: IExtension): boolean {\n\t\tif (!isWeb) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!extension.gallery) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst locale = getLocale(extension.gallery);\n\t\tif (!locale) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync setLanguage(extension: IExtension): Promise<void> {\n\t\tif (!this.canSetLanguage(extension)) {\n\t\t\tthrow new Error('Can not set language');\n\t\t}\n\t\tconst locale = getLocale(extension.gallery!);\n\t\tif (locale === language) {\n\t\t\treturn;\n\t\t}\n\t\tconst localizedLanguageName = extension.gallery?.properties?.localizedLanguages?.[0];\n\t\treturn this.localeService.setLocale({ id: locale, galleryExtension: extension.gallery, extensionId: extension.identifier.id, label: localizedLanguageName ?? extension.displayName });\n\t}\n\n\tsetEnablement(extensions: IExtension | IExtension[], enablementState: EnablementState): Promise<void> {\n\t\textensions = Array.isArray(extensions) ? extensions : [extensions];\n\t\treturn this.promptAndSetEnablement(extensions, enablementState);\n\t}\n\n\tuninstall(extension: IExtension): Promise<void> {\n\t\tconst ext = extension.local ? extension : this.local.filter(e => areSameExtensions(e.identifier, extension.identifier))[0];\n\t\tconst toUninstall: ILocalExtension | null = ext && ext.local ? ext.local : null;\n\n\t\tif (!toUninstall) {\n\t\t\treturn Promise.reject(new Error('Missing local'));\n\t\t}\n\t\treturn this.withProgress({\n\t\t\tlocation: ProgressLocation.Extensions,\n\t\t\ttitle: nls.localize('uninstallingExtension', 'Uninstalling extension....'),\n\t\t\tsource: `${toUninstall.identifier.id}`\n\t\t}, () => this.extensionManagementService.uninstall(toUninstall).then(() => undefined));\n\t}\n\n\tasync installVersion(extension: IExtension, version: string, installOptions: InstallOptions = {}): Promise<IExtension> {\n\t\treturn this.doInstall(extension, async () => {\n\t\t\tif (!extension.gallery) {\n\t\t\t\tthrow new Error('Missing gallery');\n\t\t\t}\n\n\t\t\tconst targetPlatform = extension.server ? await extension.server.extensionManagementService.getTargetPlatform() : undefined;\n\t\t\tconst [gallery] = await this.galleryService.getExtensions([{ id: extension.gallery.identifier.id, version }], { targetPlatform }, CancellationToken.None);\n\t\t\tif (!gallery) {\n\t\t\t\tthrow new Error(nls.localize('not found', \"Unable to install extension '{0}' because the requested version '{1}' is not found.\", extension.gallery!.identifier.id, version));\n\t\t\t}\n\n\t\t\tinstallOptions.installGivenVersion = true;\n\t\t\treturn this.installFromGallery(extension, gallery, installOptions);\n\t\t});\n\t}\n\n\treinstall(extension: IExtension): Promise<IExtension> {\n\t\treturn this.doInstall(extension, () => {\n\t\t\tconst ext = extension.local ? extension : this.local.filter(e => areSameExtensions(e.identifier, extension.identifier))[0];\n\t\t\tconst toReinstall: ILocalExtension | null = ext && ext.local ? ext.local : null;\n\t\t\tif (!toReinstall) {\n\t\t\t\tthrow new Error('Missing local');\n\t\t\t}\n\t\t\treturn this.extensionManagementService.reinstallFromGallery(toReinstall);\n\t\t});\n\t}\n\n\tisExtensionIgnoredToSync(extension: IExtension): boolean {\n\t\treturn extension.local ? !this.isInstalledExtensionSynced(extension.local)\n\t\t\t: this.extensionsSyncManagementService.hasToNeverSyncExtension(extension.identifier.id);\n\t}\n\n\tasync toggleExtensionIgnoredToSync(extension: IExtension): Promise<void> {\n\t\tconst isIgnored = this.isExtensionIgnoredToSync(extension);\n\t\tif (extension.local && isIgnored) {\n\t\t\t(<Extension>extension).local = await this.updateSynchronizingInstalledExtension(extension.local, true);\n\t\t\tthis._onChange.fire(extension);\n\t\t} else {\n\t\t\tthis.extensionsSyncManagementService.updateIgnoredExtensions(extension.identifier.id, !isIgnored);\n\t\t}\n\t\tawait this.userDataAutoSyncService.triggerSync(['IgnoredExtensionsUpdated'], false, false);\n\t}\n\n\tasync toggleApplyExtensionToAllProfiles(extension: IExtension): Promise<void> {\n\t\tif (!extension.local || isApplicationScopedExtension(extension.local.manifest) || extension.isBuiltin) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.extensionManagementService.toggleAppliationScope(extension.local, this.userDataProfileService.currentProfile.extensionsResource);\n\t}\n\n\tprivate isInstalledExtensionSynced(extension: ILocalExtension): boolean {\n\t\tif (extension.isMachineScoped) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this.extensionsSyncManagementService.hasToAlwaysSyncExtension(extension.identifier.id)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn !this.extensionsSyncManagementService.hasToNeverSyncExtension(extension.identifier.id);\n\t}\n\n\tasync updateSynchronizingInstalledExtension(extension: ILocalExtension, sync: boolean): Promise<ILocalExtension> {\n\t\tconst isMachineScoped = !sync;\n\t\tif (extension.isMachineScoped !== isMachineScoped) {\n\t\t\textension = await this.extensionManagementService.updateMetadata(extension, { isMachineScoped });\n\t\t}\n\t\tif (sync) {\n\t\t\tthis.extensionsSyncManagementService.updateIgnoredExtensions(extension.identifier.id, false);\n\t\t}\n\t\treturn extension;\n\t}\n\n\tprivate doInstall(extension: IExtension | URI, installTask: () => Promise<ILocalExtension>, progressLocation?: ProgressLocation): Promise<IExtension> {\n\t\tconst title = extension instanceof URI ? nls.localize('installing extension', 'Installing extension....') : nls.localize('installing named extension', \"Installing '{0}' extension....\", extension.displayName);\n\t\treturn this.withProgress({\n\t\t\tlocation: progressLocation ?? ProgressLocation.Extensions,\n\t\t\ttitle\n\t\t}, async () => {\n\t\t\ttry {\n\t\t\t\tif (!(extension instanceof URI)) {\n\t\t\t\t\tthis.installing.push(extension);\n\t\t\t\t\tthis._onChange.fire(extension);\n\t\t\t\t}\n\t\t\t\tconst local = await installTask();\n\t\t\t\treturn await this.waitAndGetInstalledExtension(local.identifier);\n\t\t\t} finally {\n\t\t\t\tif (!(extension instanceof URI)) {\n\t\t\t\t\tthis.installing = this.installing.filter(e => e !== extension);\n\t\t\t\t\t// Trigger the change without passing the extension because it is replaced by a new instance.\n\t\t\t\t\tthis._onChange.fire(undefined);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async installFromVSIX(vsix: URI, installOptions?: InstallVSIXOptions): Promise<ILocalExtension> {\n\t\tconst manifest = await this.extensionManagementService.getManifest(vsix);\n\t\tconst existingExtension = this.local.find(local => areSameExtensions(local.identifier, { id: getGalleryExtensionId(manifest.publisher, manifest.name) }));\n\t\tif (existingExtension && existingExtension.latestVersion !== manifest.version) {\n\t\t\tinstallOptions = installOptions || {};\n\t\t\tinstallOptions.installGivenVersion = true;\n\t\t}\n\t\treturn this.extensionManagementService.installVSIX(vsix, manifest, installOptions);\n\t}\n\n\tprivate installFromGallery(extension: IExtension, gallery: IGalleryExtension, installOptions?: InstallOptions): Promise<ILocalExtension> {\n\t\tif (extension.local) {\n\t\t\treturn this.extensionManagementService.updateFromGallery(gallery, extension.local, installOptions);\n\t\t} else {\n\t\t\treturn this.extensionManagementService.installFromGallery(gallery, installOptions);\n\t\t}\n\t}\n\n\tprivate async waitAndGetInstalledExtension(identifier: IExtensionIdentifier): Promise<IExtension> {\n\t\tlet installedExtension = this.local.find(local => areSameExtensions(local.identifier, identifier));\n\t\tif (!installedExtension) {\n\t\t\tawait Event.toPromise(Event.filter(this.onChange, e => !!e && this.local.some(local => areSameExtensions(local.identifier, identifier))));\n\t\t}\n\t\tinstalledExtension = this.local.find(local => areSameExtensions(local.identifier, identifier));\n\t\tif (!installedExtension) {\n\t\t\t// This should not happen\n\t\t\tthrow new Error('Extension should have been installed');\n\t\t}\n\t\treturn installedExtension;\n\t}\n\n\tprivate promptAndSetEnablement(extensions: IExtension[], enablementState: EnablementState): Promise<any> {\n\t\tconst enable = enablementState === EnablementState.EnabledGlobally || enablementState === EnablementState.EnabledWorkspace;\n\t\tif (enable) {\n\t\t\tconst allDependenciesAndPackedExtensions = this.getExtensionsRecursively(extensions, this.local, enablementState, { dependencies: true, pack: true });\n\t\t\treturn this.checkAndSetEnablement(extensions, allDependenciesAndPackedExtensions, enablementState);\n\t\t} else {\n\t\t\tconst packedExtensions = this.getExtensionsRecursively(extensions, this.local, enablementState, { dependencies: false, pack: true });\n\t\t\tif (packedExtensions.length) {\n\t\t\t\treturn this.checkAndSetEnablement(extensions, packedExtensions, enablementState);\n\t\t\t}\n\t\t\treturn this.checkAndSetEnablement(extensions, [], enablementState);\n\t\t}\n\t}\n\n\tprivate checkAndSetEnablement(extensions: IExtension[], otherExtensions: IExtension[], enablementState: EnablementState): Promise<any> {\n\t\tconst allExtensions = [...extensions, ...otherExtensions];\n\t\tconst enable = enablementState === EnablementState.EnabledGlobally || enablementState === EnablementState.EnabledWorkspace;\n\t\tif (!enable) {\n\t\t\tfor (const extension of extensions) {\n\t\t\t\tconst dependents = this.getDependentsAfterDisablement(extension, allExtensions, this.local);\n\t\t\t\tif (dependents.length) {\n\t\t\t\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\t\t\t\tthis.notificationService.prompt(Severity.Error, this.getDependentsErrorMessage(extension, allExtensions, dependents), [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: nls.localize('disable all', 'Disable All'),\n\t\t\t\t\t\t\t\trun: async () => {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tawait this.checkAndSetEnablement(dependents, [extension], enablementState);\n\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t], {\n\t\t\t\t\t\t\tonCancel: () => reject(new CancellationError())\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.doSetEnablement(allExtensions, enablementState);\n\t}\n\n\tprivate getExtensionsRecursively(extensions: IExtension[], installed: IExtension[], enablementState: EnablementState, options: { dependencies: boolean; pack: boolean }, checked: IExtension[] = []): IExtension[] {\n\t\tconst toCheck = extensions.filter(e => checked.indexOf(e) === -1);\n\t\tif (toCheck.length) {\n\t\t\tfor (const extension of toCheck) {\n\t\t\t\tchecked.push(extension);\n\t\t\t}\n\t\t\tconst extensionsToEanbleOrDisable = installed.filter(i => {\n\t\t\t\tif (checked.indexOf(i) !== -1) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst enable = enablementState === EnablementState.EnabledGlobally || enablementState === EnablementState.EnabledWorkspace;\n\t\t\t\tconst isExtensionEnabled = i.enablementState === EnablementState.EnabledGlobally || i.enablementState === EnablementState.EnabledWorkspace;\n\t\t\t\tif (enable === isExtensionEnabled) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn (enable || !i.isBuiltin) // Include all Extensions for enablement and only non builtin extensions for disablement\n\t\t\t\t\t&& (options.dependencies || options.pack)\n\t\t\t\t\t&& extensions.some(extension =>\n\t\t\t\t\t\t(options.dependencies && extension.dependencies.some(id => areSameExtensions({ id }, i.identifier)))\n\t\t\t\t\t\t|| (options.pack && extension.extensionPack.some(id => areSameExtensions({ id }, i.identifier)))\n\t\t\t\t\t);\n\t\t\t});\n\t\t\tif (extensionsToEanbleOrDisable.length) {\n\t\t\t\textensionsToEanbleOrDisable.push(...this.getExtensionsRecursively(extensionsToEanbleOrDisable, installed, enablementState, options, checked));\n\t\t\t}\n\t\t\treturn extensionsToEanbleOrDisable;\n\t\t}\n\t\treturn [];\n\t}\n\n\tprivate getDependentsAfterDisablement(extension: IExtension, extensionsToDisable: IExtension[], installed: IExtension[]): IExtension[] {\n\t\treturn installed.filter(i => {\n\t\t\tif (i.dependencies.length === 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (i === extension) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (!this.extensionEnablementService.isEnabledEnablementState(i.enablementState)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (extensionsToDisable.indexOf(i) !== -1) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn i.dependencies.some(dep => [extension, ...extensionsToDisable].some(d => areSameExtensions(d.identifier, { id: dep })));\n\t\t});\n\t}\n\n\tprivate getDependentsErrorMessage(extension: IExtension, allDisabledExtensions: IExtension[], dependents: IExtension[]): string {\n\t\tfor (const e of [extension, ...allDisabledExtensions]) {\n\t\t\tconst dependentsOfTheExtension = dependents.filter(d => d.dependencies.some(id => areSameExtensions({ id }, e.identifier)));\n\t\t\tif (dependentsOfTheExtension.length) {\n\t\t\t\treturn this.getErrorMessageForDisablingAnExtensionWithDependents(e, dependentsOfTheExtension);\n\t\t\t}\n\t\t}\n\t\treturn '';\n\t}\n\n\tprivate getErrorMessageForDisablingAnExtensionWithDependents(extension: IExtension, dependents: IExtension[]): string {\n\t\tif (dependents.length === 1) {\n\t\t\treturn nls.localize('singleDependentError', \"Cannot disable '{0}' extension alone. '{1}' extension depends on this. Do you want to disable all these extensions?\", extension.displayName, dependents[0].displayName);\n\t\t}\n\t\tif (dependents.length === 2) {\n\t\t\treturn nls.localize('twoDependentsError', \"Cannot disable '{0}' extension alone. '{1}' and '{2}' extensions depend on this. Do you want to disable all these extensions?\",\n\t\t\t\textension.displayName, dependents[0].displayName, dependents[1].displayName);\n\t\t}\n\t\treturn nls.localize('multipleDependentsError', \"Cannot disable '{0}' extension alone. '{1}', '{2}' and other extensions depend on this. Do you want to disable all these extensions?\",\n\t\t\textension.displayName, dependents[0].displayName, dependents[1].displayName);\n\t}\n\n\tprivate async doSetEnablement(extensions: IExtension[], enablementState: EnablementState): Promise<boolean[]> {\n\t\tconst changed = await this.extensionEnablementService.setEnablement(extensions.map(e => e.local!), enablementState);\n\t\tfor (let i = 0; i < changed.length; i++) {\n\t\t\tif (changed[i]) {\n\t\t\t\t/* __GDPR__\n\t\t\t\t\"extension:enable\" : {\n\t\t\t\t\t\"owner\": \"sandy081\",\n\t\t\t\t\t\"${include}\": [\n\t\t\t\t\t\t\"${GalleryExtensionTelemetryData}\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\t*/\n\t\t\t\t/* __GDPR__\n\t\t\t\t\"extension:disable\" : {\n\t\t\t\t\t\"owner\": \"sandy081\",\n\t\t\t\t\t\"${include}\": [\n\t\t\t\t\t\t\"${GalleryExtensionTelemetryData}\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\t*/\n\t\t\t\tthis.telemetryService.publicLog(enablementState === EnablementState.EnabledGlobally || enablementState === EnablementState.EnabledWorkspace ? 'extension:enable' : 'extension:disable', extensions[i].telemetryData);\n\t\t\t}\n\t\t}\n\t\treturn changed;\n\t}\n\n\t// Current service reports progress when installing/uninstalling extensions\n\t// This is to report progress for other sources of extension install/uninstall changes\n\t// Since we cannot differentiate between the two, we report progress for all extension install/uninstall changes\n\tprivate _activityCallBack: ((value: void) => void) | undefined;\n\tprivate reportProgressFromOtherSources(): void {\n\t\tif (this.installed.some(e => e.state === ExtensionState.Installing || e.state === ExtensionState.Uninstalling)) {\n\t\t\tif (!this._activityCallBack) {\n\t\t\t\tthis.withProgress({ location: ProgressLocation.Extensions }, () => new Promise(resolve => this._activityCallBack = resolve));\n\t\t\t}\n\t\t} else {\n\t\t\tthis._activityCallBack?.();\n\t\t\tthis._activityCallBack = undefined;\n\t\t}\n\t}\n\n\tprivate withProgress<T>(options: IProgressOptions, task: () => Promise<T>): Promise<T> {\n\t\treturn this.progressService.withProgress(options, async () => {\n\t\t\tconst cancelableTask = createCancelablePromise(() => task());\n\t\t\tthis.tasksInProgress.push(cancelableTask);\n\t\t\ttry {\n\t\t\t\treturn await cancelableTask;\n\t\t\t} finally {\n\t\t\t\tconst index = this.tasksInProgress.indexOf(cancelableTask);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tthis.tasksInProgress.splice(index, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate onError(err: any): void {\n\t\tif (isCancellationError(err)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst message = err && err.message || '';\n\n\t\tif (/getaddrinfo ENOTFOUND|getaddrinfo ENOENT|connect EACCES|connect ECONNREFUSED/.test(message)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.notificationService.error(err);\n\t}\n\n\thandleURL(uri: URI, options?: IOpenURLOptions): Promise<boolean> {\n\t\tif (!/^extension/.test(uri.path)) {\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tthis.onOpenExtensionUrl(uri);\n\t\treturn Promise.resolve(true);\n\t}\n\n\tprivate onOpenExtensionUrl(uri: URI): void {\n\t\tconst match = /^extension\\/([^/]+)$/.exec(uri.path);\n\n\t\tif (!match) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst extensionId = match[1];\n\n\t\tthis.queryLocal().then(async local => {\n\t\t\tlet extension = local.find(local => areSameExtensions(local.identifier, { id: extensionId }));\n\t\t\tif (!extension) {\n\t\t\t\t[extension] = await this.getExtensions([{ id: extensionId }], { source: 'uri' }, CancellationToken.None);\n\t\t\t}\n\t\t\tif (extension) {\n\t\t\t\tawait this.hostService.focus();\n\t\t\t\tawait this.open(extension);\n\t\t\t}\n\t\t}).then(undefined, error => this.onError(error));\n\t}\n\n}\n"]}