{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatInputPart.ts"],"names":[],"mappings":"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","file":"chatInputPart.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from 'vs/base/browser/dom';\nimport { IHistoryNavigationWidget } from 'vs/base/browser/history';\nimport * as aria from 'vs/base/browser/ui/aria/aria';\nimport { Emitter } from 'vs/base/common/event';\nimport { HistoryNavigator } from 'vs/base/common/history';\nimport { Disposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { IModelService } from 'vs/editor/common/services/model';\nimport { localize } from 'vs/nls';\nimport { MenuWorkbenchToolBar } from 'vs/platform/actions/browser/toolbar';\nimport { MenuId } from 'vs/platform/actions/common/actions';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IContextKey, IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { registerAndCreateHistoryNavigationContext } from 'vs/platform/history/browser/contextScopedHistoryWidget';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ServiceCollection } from 'vs/platform/instantiation/common/serviceCollection';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { DEFAULT_FONT_FAMILY } from 'vs/workbench/browser/style';\nimport { getSimpleCodeEditorWidgetOptions, getSimpleEditorOptions } from 'vs/workbench/contrib/codeEditor/browser/simpleEditorOptions';\nimport { IChatExecuteActionContext } from 'vs/workbench/contrib/chat/browser/actions/chatExecuteActions';\nimport { IChatWidget } from 'vs/workbench/contrib/chat/browser/chat';\nimport { ChatFollowups } from 'vs/workbench/contrib/chat/browser/chatFollowups';\nimport { CONTEXT_CHAT_INPUT_HAS_TEXT, CONTEXT_IN_CHAT_INPUT } from 'vs/workbench/contrib/chat/common/chatContextKeys';\nimport { IChatReplyFollowup } from 'vs/workbench/contrib/chat/common/chatService';\nimport { IChatWidgetHistoryService } from 'vs/workbench/contrib/chat/common/chatWidgetHistoryService';\nimport { AccessibilityVerbositySettingId } from 'vs/workbench/contrib/accessibility/browser/accessibilityConfiguration';\nimport { IAccessibilityService } from 'vs/platform/accessibility/common/accessibility';\nimport { isMacintosh } from 'vs/base/common/platform';\nimport { AccessibilityCommandId } from 'vs/workbench/contrib/accessibility/common/accessibilityCommands';\n\nconst $ = dom.$;\n\nconst INPUT_EDITOR_MAX_HEIGHT = 250;\n\nexport class ChatInputPart extends Disposable implements IHistoryNavigationWidget {\n\tstatic readonly INPUT_SCHEME = 'chatSessionInput';\n\tprivate static _counter = 0;\n\n\tprivate _onDidChangeHeight = this._register(new Emitter<void>());\n\treadonly onDidChangeHeight = this._onDidChangeHeight.event;\n\n\tprivate _onDidFocus = this._register(new Emitter<void>());\n\treadonly onDidFocus = this._onDidFocus.event;\n\n\tprivate _onDidBlur = this._register(new Emitter<void>());\n\treadonly onDidBlur = this._onDidBlur.event;\n\n\tprivate _onDidAcceptFollowup = this._register(new Emitter<IChatReplyFollowup>());\n\treadonly onDidAcceptFollowup = this._onDidAcceptFollowup.event;\n\n\tprivate inputEditorHeight = 0;\n\tprivate container!: HTMLElement;\n\n\tprivate followupsContainer!: HTMLElement;\n\tprivate followupsDisposables = this._register(new DisposableStore());\n\n\tprivate _inputEditor!: CodeEditorWidget;\n\tprivate _inputEditorElement!: HTMLElement;\n\n\tprivate toolbar!: MenuWorkbenchToolBar;\n\n\tget inputEditor() {\n\t\treturn this._inputEditor;\n\t}\n\n\tprivate history: HistoryNavigator<string>;\n\tprivate setHistoryNavigationEnablement!: (enabled: boolean) => void;\n\tprivate inputModel: ITextModel | undefined;\n\tprivate inputEditorHasText: IContextKey<boolean>;\n\tprivate providerId: string | undefined;\n\n\treadonly inputUri = URI.parse(`${ChatInputPart.INPUT_SCHEME}:input-${ChatInputPart._counter++}`);\n\n\tconstructor(\n\t\t// private readonly editorOptions: ChatEditorOptions, // TODO this should be used\n\t\tprivate readonly options: { renderFollowups: boolean; renderStyle?: 'default' | 'compact' },\n\t\t@IChatWidgetHistoryService private readonly historyService: IChatWidgetHistoryService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@IAccessibilityService private readonly accessibilityService: IAccessibilityService\n\t) {\n\t\tsuper();\n\n\t\tthis.inputEditorHasText = CONTEXT_CHAT_INPUT_HAS_TEXT.bindTo(contextKeyService);\n\t\tthis.history = new HistoryNavigator([], 5);\n\t\tthis._register(this.historyService.onDidClearHistory(() => this.history.clear()));\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(AccessibilityVerbositySettingId.Chat)) {\n\t\t\t\tthis.inputEditor.updateOptions({ ariaLabel: this._getAriaLabel() });\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _getAriaLabel(): string {\n\t\tconst verbose = this.configurationService.getValue<boolean>(AccessibilityVerbositySettingId.Chat);\n\t\tif (verbose) {\n\t\t\tconst kbLabel = this.keybindingService.lookupKeybinding(AccessibilityCommandId.OpenAccessibilityHelp)?.getLabel();\n\t\t\treturn kbLabel ? localize('actions.chat.accessibiltyHelp', \"Chat Input,  Type to ask questions or type / for topics, press enter to send out the request. Use {0} for Chat Accessibility Help.\", kbLabel) : localize('chatInput.accessibilityHelpNoKb', \"Chat Input,  Type code here and press Enter to run. Use the Chat Accessibility Help command for more information.\");\n\t\t}\n\t\treturn localize('chatInput', \"Chat Input\");\n\t}\n\n\tsetState(providerId: string, inputValue: string): void {\n\t\tthis.providerId = providerId;\n\t\tconst history = this.historyService.getHistory(providerId);\n\t\tthis.history = new HistoryNavigator(history, 50);\n\n\t\tthis.setValue(inputValue);\n\t}\n\n\tget element(): HTMLElement {\n\t\treturn this.container;\n\t}\n\n\tshowPreviousValue(): void {\n\t\tthis.navigateHistory(true);\n\t}\n\n\tshowNextValue(): void {\n\t\tthis.navigateHistory(false);\n\t}\n\n\tprivate navigateHistory(previous: boolean): void {\n\t\tconst historyInput = (previous ?\n\t\t\t(this.history.previous() ?? this.history.first()) : this.history.next())\n\t\t\t?? '';\n\n\t\taria.status(historyInput);\n\t\tthis.setValue(historyInput);\n\t\tthis.setHistoryNavigationEnablement(true);\n\t}\n\n\tsetValue(value: string): void {\n\t\tthis.inputEditor.setValue(value);\n\t\t// always leave cursor at the end\n\t\tthis.inputEditor.setPosition({ lineNumber: 1, column: value.length + 1 });\n\t}\n\n\tfocus() {\n\t\tthis._inputEditor.focus();\n\t}\n\n\thasFocus(): boolean {\n\t\treturn this._inputEditor.hasWidgetFocus();\n\t}\n\n\tasync acceptInput(query?: string | IChatReplyFollowup): Promise<void> {\n\t\tconst editorValue = this._inputEditor.getValue();\n\t\tif (!query && editorValue) {\n\t\t\t// Followups and programmatic messages don't go to history\n\t\t\tthis.history.add(editorValue);\n\t\t}\n\n\t\tif (this.accessibilityService.isScreenReaderOptimized() && isMacintosh) {\n\t\t\tthis._acceptInputForVoiceover();\n\t\t} else {\n\t\t\tthis._inputEditor.focus();\n\t\t\tthis._inputEditor.setValue('');\n\t\t}\n\t}\n\n\tprivate _acceptInputForVoiceover(): void {\n\t\tconst domNode = this._inputEditor.getDomNode();\n\t\tif (!domNode) {\n\t\t\treturn;\n\t\t}\n\t\t// Remove the input editor from the DOM temporarily to prevent VoiceOver\n\t\t// from reading the cleared text (the request) to the user.\n\t\tthis._inputEditorElement.removeChild(domNode);\n\t\tthis._inputEditor.setValue('');\n\t\tthis._inputEditorElement.appendChild(domNode);\n\t\tthis._inputEditor.focus();\n\t}\n\n\trender(container: HTMLElement, initialValue: string, widget: IChatWidget) {\n\t\tthis.container = dom.append(container, $('.interactive-input-part'));\n\n\t\tthis.followupsContainer = dom.append(this.container, $('.interactive-input-followups'));\n\t\tconst inputAndSideToolbar = dom.append(this.container, $('.interactive-input-and-side-toolbar'));\n\t\tconst inputContainer = dom.append(inputAndSideToolbar, $('.interactive-input-and-execute-toolbar'));\n\n\t\tconst inputScopedContextKeyService = this._register(this.contextKeyService.createScoped(inputContainer));\n\t\tCONTEXT_IN_CHAT_INPUT.bindTo(inputScopedContextKeyService).set(true);\n\t\tconst scopedInstantiationService = this.instantiationService.createChild(new ServiceCollection([IContextKeyService, inputScopedContextKeyService]));\n\n\t\tconst { historyNavigationBackwardsEnablement, historyNavigationForwardsEnablement } = this._register(registerAndCreateHistoryNavigationContext(inputScopedContextKeyService, this));\n\t\tthis.setHistoryNavigationEnablement = enabled => {\n\t\t\thistoryNavigationBackwardsEnablement.set(enabled);\n\t\t\thistoryNavigationForwardsEnablement.set(enabled);\n\t\t};\n\n\t\tconst options = getSimpleEditorOptions(this.configurationService);\n\t\toptions.readOnly = false;\n\t\toptions.ariaLabel = this._getAriaLabel();\n\t\toptions.fontFamily = DEFAULT_FONT_FAMILY;\n\t\toptions.fontSize = 13;\n\t\toptions.lineHeight = 20;\n\t\toptions.padding = this.options.renderStyle === 'compact' ? { top: 2, bottom: 2 } : { top: 8, bottom: 8 };\n\t\toptions.cursorWidth = 1;\n\t\toptions.wrappingStrategy = 'advanced';\n\t\toptions.bracketPairColorization = { enabled: false };\n\t\toptions.suggest = { showIcons: false };\n\t\toptions.scrollbar = { ...(options.scrollbar ?? {}), vertical: 'hidden' };\n\n\t\tthis._inputEditorElement = dom.append(inputContainer, $('.interactive-input-editor'));\n\t\tthis._inputEditor = this._register(scopedInstantiationService.createInstance(CodeEditorWidget, this._inputEditorElement, options, getSimpleCodeEditorWidgetOptions()));\n\n\t\tthis._register(this._inputEditor.onDidChangeModelContent(() => {\n\t\t\tconst currentHeight = Math.min(this._inputEditor.getContentHeight(), INPUT_EDITOR_MAX_HEIGHT);\n\t\t\tif (currentHeight !== this.inputEditorHeight) {\n\t\t\t\tthis.inputEditorHeight = currentHeight;\n\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t}\n\n\t\t\t// Only allow history navigation when the input is empty.\n\t\t\t// (If this model change happened as a result of a history navigation, this is canceled out by a call in this.navigateHistory)\n\t\t\tconst model = this._inputEditor.getModel();\n\t\t\tconst inputHasText = !!model && model.getValueLength() > 0;\n\t\t\tthis.setHistoryNavigationEnablement(!inputHasText);\n\t\t\tthis.inputEditorHasText.set(inputHasText);\n\t\t}));\n\t\tthis._register(this._inputEditor.onDidFocusEditorText(() => {\n\t\t\tthis._onDidFocus.fire();\n\t\t\tinputContainer.classList.toggle('focused', true);\n\t\t}));\n\t\tthis._register(this._inputEditor.onDidBlurEditorText(() => {\n\t\t\tinputContainer.classList.toggle('focused', false);\n\n\t\t\tthis._onDidBlur.fire();\n\t\t}));\n\n\t\tthis.toolbar = this._register(this.instantiationService.createInstance(MenuWorkbenchToolBar, inputContainer, MenuId.ChatExecute, {\n\t\t\tmenuOptions: {\n\t\t\t\tshouldForwardArgs: true\n\t\t\t}\n\t\t}));\n\t\tthis.toolbar.getElement().classList.add('interactive-execute-toolbar');\n\t\tthis.toolbar.context = <IChatExecuteActionContext>{ widget };\n\n\t\tif (this.options.renderStyle === 'compact') {\n\t\t\tconst toolbarSide = this._register(this.instantiationService.createInstance(MenuWorkbenchToolBar, inputAndSideToolbar, MenuId.ChatInputSide, {\n\t\t\t\tmenuOptions: {\n\t\t\t\t\tshouldForwardArgs: true\n\t\t\t\t}\n\t\t\t}));\n\t\t\ttoolbarSide.getElement().classList.add('chat-side-toolbar');\n\t\t\ttoolbarSide.context = <IChatExecuteActionContext>{ widget };\n\t\t}\n\n\t\tthis.inputModel = this.modelService.getModel(this.inputUri) || this.modelService.createModel('', null, this.inputUri, true);\n\t\tthis.inputModel.updateOptions({ bracketColorizationOptions: { enabled: false, independentColorPoolPerBracketType: false } });\n\t\tthis._inputEditor.setModel(this.inputModel);\n\t\tif (initialValue) {\n\t\t\tthis.inputModel.setValue(initialValue);\n\t\t\tconst lineNumber = this.inputModel.getLineCount();\n\t\t\tthis._inputEditor.setPosition({ lineNumber, column: this.inputModel.getLineMaxColumn(lineNumber) });\n\t\t}\n\t}\n\n\tasync renderFollowups(items?: IChatReplyFollowup[]): Promise<void> {\n\t\tif (!this.options.renderFollowups) {\n\t\t\treturn;\n\t\t}\n\t\tthis.followupsDisposables.clear();\n\t\tdom.clearNode(this.followupsContainer);\n\n\t\tif (items && items.length > 0) {\n\t\t\tthis.followupsDisposables.add(new ChatFollowups(this.followupsContainer, items, undefined, followup => this._onDidAcceptFollowup.fire(followup), this.contextKeyService));\n\t\t}\n\t}\n\n\tlayout(height: number, width: number): number {\n\t\treturn this._layout(height, width);\n\t}\n\n\tprivate _layout(height: number, width: number, allowRecurse = true): number {\n\t\tconst followupsHeight = this.followupsContainer.offsetHeight;\n\n\t\tconst inputPartBorder = 1;\n\t\tconst inputPartHorizontalPadding = 40;\n\t\tconst inputPartVerticalPadding = 24;\n\t\tconst inputEditorHeight = Math.min(this._inputEditor.getContentHeight(), height - followupsHeight - inputPartHorizontalPadding - inputPartBorder, INPUT_EDITOR_MAX_HEIGHT);\n\n\t\tconst inputEditorBorder = 2;\n\t\tconst inputPartHeight = followupsHeight + inputEditorHeight + inputPartVerticalPadding + inputPartBorder + inputEditorBorder;\n\n\t\tconst editorBorder = 2;\n\t\tconst editorPadding = 8;\n\t\tconst executeToolbarWidth = this.toolbar.getItemsWidth();\n\t\tconst sideToolbarWidth = this.options.renderStyle === 'compact' ? 20 : 0;\n\n\t\tconst initialEditorScrollWidth = this._inputEditor.getScrollWidth();\n\t\tthis._inputEditor.layout({ width: width - inputPartHorizontalPadding - editorBorder - editorPadding - executeToolbarWidth - sideToolbarWidth, height: inputEditorHeight });\n\n\t\tif (allowRecurse && initialEditorScrollWidth < 10) {\n\t\t\t// This is probably the initial layout. Now that the editor is layed out with its correct width, it should report the correct contentHeight\n\t\t\treturn this._layout(height, width, false);\n\t\t}\n\n\t\treturn inputPartHeight;\n\t}\n\n\tsaveState(): void {\n\t\tconst inputHistory = this.history.getHistory();\n\t\tthis.historyService.saveHistory(this.providerId!, inputHistory);\n\t}\n}\n"]}