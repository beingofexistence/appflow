{"version":3,"sources":["vs/workbench/contrib/chat/browser/actions/chatCodeblockActions.ts"],"names":[],"mappings":"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","file":"chatCodeblockActions.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { Codicon } from 'vs/base/common/codicons';\nimport { KeyCode, KeyMod } from 'vs/base/common/keyCodes';\nimport { ICodeEditor, isCodeEditor, isDiffEditor } from 'vs/editor/browser/editorBrowser';\nimport { ServicesAccessor } from 'vs/editor/browser/editorExtensions';\nimport { IBulkEditService, ResourceTextEdit } from 'vs/editor/browser/services/bulkEditService';\nimport { ICodeEditorService } from 'vs/editor/browser/services/codeEditorService';\nimport { Range } from 'vs/editor/common/core/range';\nimport { RelatedContextItem, WorkspaceEdit } from 'vs/editor/common/languages';\nimport { ILanguageService } from 'vs/editor/common/languages/language';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { ILanguageFeaturesService } from 'vs/editor/common/services/languageFeatures';\nimport { CopyAction } from 'vs/editor/contrib/clipboard/browser/clipboard';\nimport { localize } from 'vs/nls';\nimport { Action2, MenuId, registerAction2 } from 'vs/platform/actions/common/actions';\nimport { IClipboardService } from 'vs/platform/clipboard/common/clipboardService';\nimport { KeybindingWeight } from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport { TerminalLocation } from 'vs/platform/terminal/common/terminal';\nimport { IUntitledTextResourceEditorInput } from 'vs/workbench/common/editor';\nimport { CHAT_CATEGORY } from 'vs/workbench/contrib/chat/browser/actions/chatActions';\nimport { IChatWidgetService } from 'vs/workbench/contrib/chat/browser/chat';\nimport { CONTEXT_IN_CHAT_SESSION, CONTEXT_PROVIDER_EXISTS } from 'vs/workbench/contrib/chat/common/chatContextKeys';\nimport { IChatCopyAction, IChatService, IChatUserActionEvent, InteractiveSessionCopyKind } from 'vs/workbench/contrib/chat/common/chatService';\nimport { IChatResponseViewModel, isResponseVM } from 'vs/workbench/contrib/chat/common/chatViewModel';\nimport { insertCell } from 'vs/workbench/contrib/notebook/browser/controller/cellOperations';\nimport { INotebookEditor } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\nimport { CellKind, NOTEBOOK_EDITOR_ID } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { ITerminalEditorService, ITerminalGroupService, ITerminalService } from 'vs/workbench/contrib/terminal/browser/terminal';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { ITextFileService } from 'vs/workbench/services/textfile/common/textfiles';\n\nexport interface IChatCodeBlockActionContext {\n\tcode: string;\n\tlanguageId: string;\n\tcodeBlockIndex: number;\n\telement: IChatResponseViewModel;\n}\n\nexport function isCodeBlockActionContext(thing: unknown): thing is IChatCodeBlockActionContext {\n\treturn typeof thing === 'object' && thing !== null && 'code' in thing && 'element' in thing;\n}\n\nabstract class ChatCodeBlockAction extends Action2 {\n\trun(accessor: ServicesAccessor, ...args: any[]) {\n\t\tlet context = args[0];\n\t\tif (!isCodeBlockActionContext(context)) {\n\t\t\tconst codeEditorService = accessor.get(ICodeEditorService);\n\t\t\tconst editor = codeEditorService.getFocusedCodeEditor() || codeEditorService.getActiveCodeEditor();\n\t\t\tif (!editor) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcontext = getContextFromEditor(editor, accessor);\n\t\t\tif (!isCodeBlockActionContext(context)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\treturn this.runWithContext(accessor, context);\n\t}\n\n\tabstract runWithContext(accessor: ServicesAccessor, context: IChatCodeBlockActionContext): any;\n}\n\nexport function registerChatCodeBlockActions() {\n\tregisterAction2(class CopyCodeBlockAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.copyCodeBlock',\n\t\t\t\ttitle: {\n\t\t\t\t\tvalue: localize('interactive.copyCodeBlock.label', \"Copy\"),\n\t\t\t\t\toriginal: 'Copy'\n\t\t\t\t},\n\t\t\t\tf1: false,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\ticon: Codicon.copy,\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ChatCodeBlock,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\trun(accessor: ServicesAccessor, ...args: any[]) {\n\t\t\tconst context = args[0];\n\t\t\tif (!isCodeBlockActionContext(context)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (context.element.errorDetails?.responseIsFiltered) {\n\t\t\t\t// When run from command palette\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst clipboardService = accessor.get(IClipboardService);\n\t\t\tclipboardService.writeText(context.code);\n\n\t\t\tconst chatService = accessor.get(IChatService);\n\t\t\tchatService.notifyUserAction(<IChatUserActionEvent>{\n\t\t\t\tproviderId: context.element.providerId,\n\t\t\t\taction: <IChatCopyAction>{\n\t\t\t\t\tkind: 'copy',\n\t\t\t\t\tresponseId: context.element.providerResponseId,\n\t\t\t\t\tcodeBlockIndex: context.codeBlockIndex,\n\t\t\t\t\tcopyType: InteractiveSessionCopyKind.Toolbar,\n\t\t\t\t\tcopiedCharacters: context.code.length,\n\t\t\t\t\ttotalCharacters: context.code.length,\n\t\t\t\t\tcopiedText: context.code,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tCopyAction?.addImplementation(50000, 'chat-codeblock', (accessor) => {\n\t\t// get active code editor\n\t\tconst editor = accessor.get(ICodeEditorService).getFocusedCodeEditor();\n\t\tif (!editor) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst editorModel = editor.getModel();\n\t\tif (!editorModel) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst context = getContextFromEditor(editor, accessor);\n\t\tif (!context) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst noSelection = editor.getSelections()?.length === 1 && editor.getSelection()?.isEmpty();\n\t\tconst copiedText = noSelection ?\n\t\t\teditorModel.getValue() :\n\t\t\teditor.getSelections()?.reduce((acc, selection) => acc + editorModel.getValueInRange(selection), '') ?? '';\n\t\tconst totalCharacters = editorModel.getValueLength();\n\n\t\t// Report copy to extensions\n\t\tif (context.element.providerResponseId) {\n\t\t\tconst chatService = accessor.get(IChatService);\n\t\t\tchatService.notifyUserAction({\n\t\t\t\tproviderId: context.element.providerId,\n\t\t\t\taction: {\n\t\t\t\t\tkind: 'copy',\n\t\t\t\t\tcodeBlockIndex: context.codeBlockIndex,\n\t\t\t\t\tresponseId: context.element.providerResponseId,\n\t\t\t\t\tcopyType: InteractiveSessionCopyKind.Action,\n\t\t\t\t\tcopiedText,\n\t\t\t\t\tcopiedCharacters: copiedText.length,\n\t\t\t\t\ttotalCharacters,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Copy full cell if no selection, otherwise fall back on normal editor implementation\n\t\tif (noSelection) {\n\t\t\taccessor.get(IClipboardService).writeText(context.code);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t});\n\n\tregisterAction2(class InsertCodeBlockAction extends ChatCodeBlockAction {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.insertCodeBlock',\n\t\t\t\ttitle: {\n\t\t\t\t\tvalue: localize('interactive.insertCodeBlock.label', \"Insert at Cursor\"),\n\t\t\t\t\toriginal: 'Insert at Cursor'\n\t\t\t\t},\n\t\t\t\tprecondition: CONTEXT_PROVIDER_EXISTS,\n\t\t\t\tf1: true,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\ticon: Codicon.insert,\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ChatCodeBlock,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\toverride async runWithContext(accessor: ServicesAccessor, context: IChatCodeBlockActionContext) {\n\t\t\tconst editorService = accessor.get(IEditorService);\n\t\t\tconst textFileService = accessor.get(ITextFileService);\n\n\t\t\tif (context.element.errorDetails?.responseIsFiltered) {\n\t\t\t\t// When run from command palette\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (editorService.activeEditorPane?.getId() === NOTEBOOK_EDITOR_ID) {\n\t\t\t\treturn this.handleNotebookEditor(accessor, editorService.activeEditorPane.getControl() as INotebookEditor, context);\n\t\t\t}\n\n\t\t\tlet activeEditorControl = editorService.activeTextEditorControl;\n\t\t\tif (isDiffEditor(activeEditorControl)) {\n\t\t\t\tactiveEditorControl = activeEditorControl.getOriginalEditor().hasTextFocus() ? activeEditorControl.getOriginalEditor() : activeEditorControl.getModifiedEditor();\n\t\t\t}\n\n\t\t\tif (!isCodeEditor(activeEditorControl)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst activeModel = activeEditorControl.getModel();\n\t\t\tif (!activeModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if model is editable, currently only support untitled and text file\n\t\t\tconst activeTextModel = textFileService.files.get(activeModel.uri) ?? textFileService.untitled.get(activeModel.uri);\n\t\t\tif (!activeTextModel || activeTextModel.isReadonly()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.handleTextEditor(accessor, activeEditorControl, activeModel, context);\n\t\t}\n\n\t\tprivate async handleNotebookEditor(accessor: ServicesAccessor, notebookEditor: INotebookEditor, context: IChatCodeBlockActionContext) {\n\t\t\tif (!notebookEditor.hasModel()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (notebookEditor.isReadOnly) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (notebookEditor.activeCodeEditor?.hasTextFocus()) {\n\t\t\t\tconst codeEditor = notebookEditor.activeCodeEditor;\n\t\t\t\tconst textModel = codeEditor.getModel();\n\n\t\t\t\tif (textModel) {\n\t\t\t\t\treturn this.handleTextEditor(accessor, codeEditor, textModel, context);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst languageService = accessor.get(ILanguageService);\n\t\t\tconst focusRange = notebookEditor.getFocus();\n\t\t\tconst next = Math.max(focusRange.end - 1, 0);\n\t\t\tinsertCell(languageService, notebookEditor, next, CellKind.Code, 'below', context.code, true);\n\t\t\tthis.notifyUserAction(accessor, context);\n\t\t}\n\n\t\tprivate async handleTextEditor(accessor: ServicesAccessor, codeEditor: ICodeEditor, activeModel: ITextModel, chatCodeBlockActionContext: IChatCodeBlockActionContext) {\n\t\t\tthis.notifyUserAction(accessor, chatCodeBlockActionContext);\n\n\t\t\tconst bulkEditService = accessor.get(IBulkEditService);\n\t\t\tconst codeEditorService = accessor.get(ICodeEditorService);\n\n\t\t\tconst mappedEditsProviders = accessor.get(ILanguageFeaturesService).mappedEditsProvider.ordered(activeModel);\n\n\t\t\t// try applying workspace edit that was returned by a MappedEditsProvider, else simply insert at selection\n\n\t\t\tlet workspaceEdit: WorkspaceEdit | null = null;\n\n\t\t\tif (mappedEditsProviders.length > 0) {\n\t\t\t\tconst mostRelevantProvider = mappedEditsProviders[0];\n\n\t\t\t\tconst selections = codeEditor.getSelections() ?? [];\n\t\t\t\tconst mappedEditsContext = {\n\t\t\t\t\tselections,\n\t\t\t\t\trelated: [] as RelatedContextItem[], // TODO@ulugbekna: we do have not yet decided what to populate this with\n\t\t\t\t};\n\t\t\t\tconst cancellationTokenSource = new CancellationTokenSource();\n\n\t\t\t\tworkspaceEdit = await mostRelevantProvider.provideMappedEdits(\n\t\t\t\t\tactiveModel,\n\t\t\t\t\t[chatCodeBlockActionContext.code],\n\t\t\t\t\tmappedEditsContext,\n\t\t\t\t\tcancellationTokenSource.token);\n\t\t\t}\n\n\t\t\tif (workspaceEdit) {\n\t\t\t\tawait bulkEditService.apply(workspaceEdit);\n\t\t\t} else {\n\t\t\t\tconst activeSelection = codeEditor.getSelection() ?? new Range(activeModel.getLineCount(), 1, activeModel.getLineCount(), 1);\n\t\t\t\tawait bulkEditService.apply([new ResourceTextEdit(activeModel.uri, {\n\t\t\t\t\trange: activeSelection,\n\t\t\t\t\ttext: chatCodeBlockActionContext.code,\n\t\t\t\t})]);\n\t\t\t}\n\t\t\tcodeEditorService.listCodeEditors().find(editor => editor.getModel()?.uri.toString() === activeModel.uri.toString())?.focus();\n\t\t}\n\n\t\tprivate notifyUserAction(accessor: ServicesAccessor, context: IChatCodeBlockActionContext) {\n\t\t\tconst chatService = accessor.get(IChatService);\n\t\t\tchatService.notifyUserAction(<IChatUserActionEvent>{\n\t\t\t\tproviderId: context.element.providerId,\n\t\t\t\taction: {\n\t\t\t\t\tkind: 'insert',\n\t\t\t\t\tresponseId: context.element.providerResponseId,\n\t\t\t\t\tcodeBlockIndex: context.codeBlockIndex,\n\t\t\t\t\ttotalCharacters: context.code.length,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t});\n\n\tregisterAction2(class InsertIntoNewFileAction extends ChatCodeBlockAction {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.insertIntoNewFile',\n\t\t\t\ttitle: {\n\t\t\t\t\tvalue: localize('interactive.insertIntoNewFile.label', \"Insert Into New File\"),\n\t\t\t\t\toriginal: 'Insert Into New File'\n\t\t\t\t},\n\t\t\t\tprecondition: CONTEXT_PROVIDER_EXISTS,\n\t\t\t\tf1: true,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\ticon: Codicon.newFile,\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ChatCodeBlock,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\tisHiddenByDefault: true,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\toverride async runWithContext(accessor: ServicesAccessor, context: IChatCodeBlockActionContext) {\n\t\t\tif (context.element.errorDetails?.responseIsFiltered) {\n\t\t\t\t// When run from command palette\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst editorService = accessor.get(IEditorService);\n\t\t\tconst chatService = accessor.get(IChatService);\n\t\t\teditorService.openEditor(<IUntitledTextResourceEditorInput>{ contents: context.code, languageId: context.languageId, resource: undefined });\n\n\t\t\tchatService.notifyUserAction(<IChatUserActionEvent>{\n\t\t\t\tproviderId: context.element.providerId,\n\t\t\t\taction: {\n\t\t\t\t\tkind: 'insert',\n\t\t\t\t\tresponseId: context.element.providerResponseId,\n\t\t\t\t\tcodeBlockIndex: context.codeBlockIndex,\n\t\t\t\t\ttotalCharacters: context.code.length,\n\t\t\t\t\tnewFile: true\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterAction2(class RunInTerminalAction extends ChatCodeBlockAction {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.runInTerminal',\n\t\t\t\ttitle: {\n\t\t\t\t\tvalue: localize('interactive.runInTerminal.label', \"Run in Terminal\"),\n\t\t\t\t\toriginal: 'Run in Terminal'\n\t\t\t\t},\n\t\t\t\tprecondition: CONTEXT_PROVIDER_EXISTS,\n\t\t\t\tf1: true,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\ticon: Codicon.terminal,\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ChatCodeBlock,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\tisHiddenByDefault: true,\n\t\t\t\t},\n\t\t\t\tkeybinding: {\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.Enter,\n\t\t\t\t\tmac: {\n\t\t\t\t\t\tprimary: KeyMod.WinCtrl | KeyCode.Enter,\n\t\t\t\t\t},\n\t\t\t\t\tweight: KeybindingWeight.EditorContrib,\n\t\t\t\t\twhen: CONTEXT_IN_CHAT_SESSION\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\toverride async runWithContext(accessor: ServicesAccessor, context: IChatCodeBlockActionContext) {\n\t\t\tif (context.element.errorDetails?.responseIsFiltered) {\n\t\t\t\t// When run from command palette\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst chatService = accessor.get(IChatService);\n\t\t\tconst terminalService = accessor.get(ITerminalService);\n\t\t\tconst editorService = accessor.get(IEditorService);\n\t\t\tconst terminalEditorService = accessor.get(ITerminalEditorService);\n\t\t\tconst terminalGroupService = accessor.get(ITerminalGroupService);\n\n\t\t\tlet terminal = await terminalService.getActiveOrCreateInstance();\n\n\t\t\t// isFeatureTerminal = debug terminal or task terminal\n\t\t\tconst unusableTerminal = terminal.xterm?.isStdinDisabled || terminal.shellLaunchConfig.isFeatureTerminal;\n\t\t\tterminal = unusableTerminal ? await terminalService.createTerminal() : terminal;\n\n\t\t\tterminalService.setActiveInstance(terminal);\n\t\t\tawait terminal.focusWhenReady(true);\n\t\t\tif (terminal.target === TerminalLocation.Editor) {\n\t\t\t\tconst existingEditors = editorService.findEditors(terminal.resource);\n\t\t\t\tterminalEditorService.openEditor(terminal, { viewColumn: existingEditors?.[0].groupId });\n\t\t\t} else {\n\t\t\t\tterminalGroupService.showPanel(true);\n\t\t\t}\n\n\t\t\tterminal.sendText(context.code, false, true);\n\n\t\t\tchatService.notifyUserAction(<IChatUserActionEvent>{\n\t\t\t\tproviderId: context.element.providerId,\n\t\t\t\taction: {\n\t\t\t\t\tkind: 'runInTerminal',\n\t\t\t\t\tresponseId: context.element.providerResponseId,\n\t\t\t\t\tcodeBlockIndex: context.codeBlockIndex,\n\t\t\t\t\tlanguageId: context.languageId,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tfunction navigateCodeBlocks(accessor: ServicesAccessor, reverse?: boolean): void {\n\t\tconst codeEditorService = accessor.get(ICodeEditorService);\n\t\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\t\tconst widget = chatWidgetService.lastFocusedWidget;\n\t\tif (!widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = codeEditorService.getFocusedCodeEditor();\n\t\tconst editorUri = editor?.getModel()?.uri;\n\t\tconst curCodeBlockInfo = editorUri ? widget.getCodeBlockInfoForEditor(editorUri) : undefined;\n\t\tconst focused = !widget.inputEditor.hasWidgetFocus() && widget.getFocus();\n\t\tconst focusedResponse = isResponseVM(focused) ? focused : undefined;\n\n\t\tconst currentResponse = curCodeBlockInfo ?\n\t\t\tcurCodeBlockInfo.element :\n\t\t\t(focusedResponse ?? widget.viewModel?.getItems().reverse().find((item): item is IChatResponseViewModel => isResponseVM(item)));\n\t\tif (!currentResponse) {\n\t\t\treturn;\n\t\t}\n\n\t\twidget.reveal(currentResponse);\n\t\tconst responseCodeblocks = widget.getCodeBlockInfosForResponse(currentResponse);\n\t\tconst focusIdx = curCodeBlockInfo ?\n\t\t\t(curCodeBlockInfo.codeBlockIndex + (reverse ? -1 : 1) + responseCodeblocks.length) % responseCodeblocks.length :\n\t\t\treverse ? responseCodeblocks.length - 1 : 0;\n\n\t\tresponseCodeblocks[focusIdx]?.focus();\n\t}\n\n\tregisterAction2(class NextCodeBlockAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.nextCodeBlock',\n\t\t\t\ttitle: {\n\t\t\t\t\tvalue: localize('interactive.nextCodeBlock.label', \"Next Code Block\"),\n\t\t\t\t\toriginal: 'Next Code Block'\n\t\t\t\t},\n\t\t\t\tkeybinding: {\n\t\t\t\t\tprimary: KeyCode.F9,\n\t\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\t\twhen: CONTEXT_IN_CHAT_SESSION,\n\t\t\t\t},\n\t\t\t\tprecondition: CONTEXT_PROVIDER_EXISTS,\n\t\t\t\tf1: true,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t});\n\t\t}\n\n\t\trun(accessor: ServicesAccessor, ...args: any[]) {\n\t\t\tnavigateCodeBlocks(accessor);\n\t\t}\n\t});\n\n\tregisterAction2(class PreviousCodeBlockAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.previousCodeBlock',\n\t\t\t\ttitle: {\n\t\t\t\t\tvalue: localize('interactive.previousCodeBlock.label', \"Previous Code Block\"),\n\t\t\t\t\toriginal: 'Previous Code Block'\n\t\t\t\t},\n\t\t\t\tkeybinding: {\n\t\t\t\t\tprimary: KeyMod.Shift | KeyCode.F9,\n\t\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\t\twhen: CONTEXT_IN_CHAT_SESSION,\n\t\t\t\t},\n\t\t\t\tprecondition: CONTEXT_PROVIDER_EXISTS,\n\t\t\t\tf1: true,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t});\n\t\t}\n\n\t\trun(accessor: ServicesAccessor, ...args: any[]) {\n\t\t\tnavigateCodeBlocks(accessor, true);\n\t\t}\n\t});\n}\n\nfunction getContextFromEditor(editor: ICodeEditor, accessor: ServicesAccessor): IChatCodeBlockActionContext | undefined {\n\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\tconst model = editor.getModel();\n\tif (!model) {\n\t\treturn;\n\t}\n\n\tconst widget = chatWidgetService.lastFocusedWidget;\n\tif (!widget) {\n\t\treturn;\n\t}\n\n\tconst codeBlockInfo = widget.getCodeBlockInfoForEditor(model.uri);\n\tif (!codeBlockInfo) {\n\t\treturn;\n\t}\n\n\treturn {\n\t\telement: codeBlockInfo.element,\n\t\tcodeBlockIndex: codeBlockInfo.codeBlockIndex,\n\t\tcode: editor.getValue(),\n\t\tlanguageId: editor.getModel()!.getLanguageId(),\n\t};\n}\n"]}