{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/chat/browser/chatQuick.ts"],"names":[],"mappings":"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","file":"chatQuick.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from 'vs/base/browser/dom';\nimport { Orientation, Sash } from 'vs/base/browser/ui/sash/sash';\nimport { disposableTimeout } from 'vs/base/common/async';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { Emitter } from 'vs/base/common/event';\nimport { Disposable, DisposableStore, IDisposable, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ServiceCollection } from 'vs/platform/instantiation/common/serviceCollection';\nimport { ILayoutService } from 'vs/platform/layout/browser/layoutService';\nimport { IQuickInputService, IQuickWidget } from 'vs/platform/quickinput/common/quickInput';\nimport { inputBackground, quickInputBackground, quickInputForeground } from 'vs/platform/theme/common/colorRegistry';\nimport { IChatWidgetService, IQuickChatService } from 'vs/workbench/contrib/chat/browser/chat';\nimport { IChatViewOptions } from 'vs/workbench/contrib/chat/browser/chatViewPane';\nimport { ChatWidget } from 'vs/workbench/contrib/chat/browser/chatWidget';\nimport { ChatModel } from 'vs/workbench/contrib/chat/common/chatModel';\nimport { IChatService } from 'vs/workbench/contrib/chat/common/chatService';\n\nexport class QuickChatService extends Disposable implements IQuickChatService {\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidClose = this._register(new Emitter<void>());\n\treadonly onDidClose = this._onDidClose.event;\n\n\tprivate _input: IQuickWidget | undefined;\n\t// TODO@TylerLeonhardt: support multiple chat providers eventually\n\tprivate _currentChat: QuickChat | undefined;\n\tprivate _container: HTMLElement | undefined;\n\n\tconstructor(\n\t\t@IQuickInputService private readonly quickInputService: IQuickInputService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\t}\n\n\tget enabled(): boolean {\n\t\treturn this.chatService.getProviderInfos().length > 0;\n\t}\n\n\tget focused(): boolean {\n\t\tconst widget = this._input?.widget as HTMLElement | undefined;\n\t\tif (!widget) {\n\t\t\treturn false;\n\t\t}\n\t\treturn dom.isAncestor(document.activeElement, widget);\n\t}\n\n\ttoggle(providerId?: string, query?: string | undefined): void {\n\t\t// If the input is already shown, hide it. This provides a toggle behavior of the quick pick\n\t\tif (this.focused) {\n\t\t\tthis.close();\n\t\t} else {\n\t\t\tthis.open(providerId, query);\n\t\t}\n\t}\n\n\topen(providerId?: string, query?: string | undefined): void {\n\t\tif (this._input) {\n\t\t\treturn this.focus();\n\t\t}\n\n\t\t// Check if any providers are available. If not, show nothing\n\t\t// This shouldn't be needed because of the precondition, but just in case\n\t\tconst providerInfo = providerId\n\t\t\t? this.chatService.getProviderInfos().find(info => info.id === providerId)\n\t\t\t: this.chatService.getProviderInfos()[0];\n\t\tif (!providerInfo) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst disposableStore = new DisposableStore();\n\n\t\tthis._input = this.quickInputService.createQuickWidget();\n\t\tthis._input.contextKey = 'chatInputVisible';\n\t\tthis._input.ignoreFocusOut = true;\n\t\tdisposableStore.add(this._input);\n\n\t\tthis._container ??= dom.$('.interactive-session');\n\t\tthis._input.widget = this._container;\n\n\t\tthis._input.show();\n\t\tif (!this._currentChat) {\n\t\t\tthis._currentChat = this.instantiationService.createInstance(QuickChat, {\n\t\t\t\tproviderId: providerInfo.id,\n\t\t\t});\n\n\t\t\t// show needs to come after the quickpick is shown\n\t\t\tthis._currentChat.render(this._container);\n\t\t} else {\n\t\t\tthis._currentChat.show();\n\t\t}\n\n\t\tdisposableStore.add(this._input.onDidHide(() => {\n\t\t\tdisposableStore.dispose();\n\t\t\tthis._currentChat!.hide();\n\t\t\tthis._input = undefined;\n\t\t\tthis._onDidClose.fire();\n\t\t}));\n\n\t\tthis._currentChat.focus();\n\n\t\tif (query) {\n\t\t\tthis._currentChat.setValue(query);\n\t\t\tthis._currentChat.acceptInput();\n\t\t}\n\t}\n\tfocus(): void {\n\t\tthis._currentChat?.focus();\n\t}\n\tclose(): void {\n\t\tthis._input?.dispose();\n\t\tthis._input = undefined;\n\t}\n\tasync openInChatView(): Promise<void> {\n\t\tawait this._currentChat?.openChatView();\n\t\tthis.close();\n\t}\n}\n\nclass QuickChat extends Disposable {\n\t// TODO@TylerLeonhardt: be responsive to window size\n\tstatic DEFAULT_MIN_HEIGHT = 200;\n\tprivate static readonly DEFAULT_HEIGHT_OFFSET = 100;\n\n\tprivate widget!: ChatWidget;\n\tprivate sash!: Sash;\n\tprivate model: ChatModel | undefined;\n\tprivate _currentQuery: string | undefined;\n\tprivate maintainScrollTimer: MutableDisposable<IDisposable> = this._register(new MutableDisposable<IDisposable>());\n\tprivate _deferUpdatingDynamicLayout: boolean = false;\n\n\tconstructor(\n\t\tprivate readonly _options: IChatViewOptions,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t\t@IChatWidgetService private readonly _chatWidgetService: IChatWidgetService,\n\t\t@ILayoutService private readonly layoutService: ILayoutService\n\t) {\n\t\tsuper();\n\t}\n\n\tclear() {\n\t\tthis.model?.dispose();\n\t\tthis.model = undefined;\n\t\tthis.updateModel();\n\t\tthis.widget.inputEditor.setValue('');\n\t}\n\n\tfocus(): void {\n\t\tif (this.widget) {\n\t\t\tthis.widget.focusInput();\n\t\t\tconst value = this.widget.inputEditor.getValue();\n\t\t\tif (value) {\n\t\t\t\tthis.widget.inputEditor.setSelection({\n\t\t\t\t\tstartLineNumber: 1,\n\t\t\t\t\tstartColumn: 1,\n\t\t\t\t\tendLineNumber: 1,\n\t\t\t\t\tendColumn: value.length + 1\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\thide(): void {\n\t\tthis.widget.setVisible(false);\n\t\t// Maintain scroll position for a short time so that if the user re-shows the chat\n\t\t// the same scroll position will be used.\n\t\tthis.maintainScrollTimer.value = disposableTimeout(() => {\n\t\t\t// At this point, clear this mutable disposable which will be our signal that\n\t\t\t// the timer has expired and we should stop maintaining scroll position\n\t\t\tthis.maintainScrollTimer.clear();\n\t\t}, 30 * 1000); // 30 seconds\n\t}\n\n\tshow(): void {\n\t\tthis.widget.setVisible(true);\n\t\t// If the mutable disposable is set, then we are keeping the existing scroll position\n\t\t// so we should not update the layout.\n\t\tif (this._deferUpdatingDynamicLayout) {\n\t\t\tthis._deferUpdatingDynamicLayout = false;\n\t\t\tthis.widget.updateDynamicChatTreeItemLayout(2, this.maxHeight);\n\t\t}\n\t\tif (!this.maintainScrollTimer.value) {\n\t\t\tthis.widget.layoutDynamicChatTreeItemMode();\n\t\t}\n\t}\n\n\trender(parent: HTMLElement): void {\n\t\tif (this.widget) {\n\t\t\tthrow new Error('Cannot render quick chat twice');\n\t\t}\n\t\tconst scopedInstantiationService = this.instantiationService.createChild(\n\t\t\tnew ServiceCollection([\n\t\t\t\tIContextKeyService,\n\t\t\t\tthis._register(this.contextKeyService.createScoped(parent))\n\t\t\t])\n\t\t);\n\t\tthis.widget = this._register(\n\t\t\tscopedInstantiationService.createInstance(\n\t\t\t\tChatWidget,\n\t\t\t\t{ resource: true, renderInputOnTop: true, renderStyle: 'compact' },\n\t\t\t\t{\n\t\t\t\t\tlistForeground: quickInputForeground,\n\t\t\t\t\tlistBackground: quickInputBackground,\n\t\t\t\t\tinputEditorBackground: inputBackground,\n\t\t\t\t\tresultEditorBackground: quickInputBackground\n\t\t\t\t}));\n\t\tthis.widget.render(parent);\n\t\tthis.widget.setVisible(true);\n\t\tthis.widget.setDynamicChatTreeItemLayout(2, this.maxHeight);\n\t\tthis.updateModel();\n\t\tthis.sash = this._register(new Sash(parent, { getHorizontalSashTop: () => parent.offsetHeight }, { orientation: Orientation.HORIZONTAL }));\n\t\tthis.registerListeners(parent);\n\t}\n\n\tprivate get maxHeight(): number {\n\t\treturn this.layoutService.dimension.height - QuickChat.DEFAULT_HEIGHT_OFFSET;\n\t}\n\n\tprivate registerListeners(parent: HTMLElement): void {\n\t\tthis._register(this.layoutService.onDidLayout(() => {\n\t\t\tif (this.widget.visible) {\n\t\t\t\tthis.widget.updateDynamicChatTreeItemLayout(2, this.maxHeight);\n\t\t\t} else {\n\t\t\t\t// If the chat is not visible, then we should defer updating the layout\n\t\t\t\t// because it relies on offsetHeight which only works correctly\n\t\t\t\t// when the chat is visible.\n\t\t\t\tthis._deferUpdatingDynamicLayout = true;\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.widget.inputEditor.onDidChangeModelContent((e) => {\n\t\t\tthis._currentQuery = this.widget.inputEditor.getValue();\n\t\t}));\n\t\tthis._register(this.widget.onDidClear(() => this.clear()));\n\t\tthis._register(this.widget.onDidChangeHeight((e) => this.sash.layout()));\n\t\tconst width = parent.offsetWidth;\n\t\tthis._register(this.sash.onDidStart(() => {\n\t\t\tthis.widget.isDynamicChatTreeItemLayoutEnabled = false;\n\t\t}));\n\t\tthis._register(this.sash.onDidChange((e) => {\n\t\t\tif (e.currentY < QuickChat.DEFAULT_MIN_HEIGHT || e.currentY > this.maxHeight) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.widget.layout(e.currentY, width);\n\t\t\tthis.sash.layout();\n\t\t}));\n\t\tthis._register(this.sash.onDidReset(() => {\n\t\t\tthis.widget.isDynamicChatTreeItemLayoutEnabled = true;\n\t\t\tthis.widget.layoutDynamicChatTreeItemMode();\n\t\t}));\n\t}\n\n\tasync acceptInput(): Promise<void> {\n\t\treturn this.widget.acceptInput();\n\t}\n\n\tasync openChatView(): Promise<void> {\n\t\tconst widget = await this._chatWidgetService.revealViewForProvider(this._options.providerId);\n\t\tif (!widget?.viewModel || !this.model) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const request of this.model.getRequests()) {\n\t\t\tif (request.response?.response.value || request.response?.errorDetails) {\n\t\t\t\tthis.chatService.addCompleteRequest(widget.viewModel.sessionId,\n\t\t\t\t\trequest.message as string,\n\t\t\t\t\t{\n\t\t\t\t\t\tmessage: request.response.response.value,\n\t\t\t\t\t\terrorDetails: request.response.errorDetails,\n\t\t\t\t\t\tfollowups: request.response.followups\n\t\t\t\t\t});\n\t\t\t} else if (request.message) {\n\n\t\t\t}\n\t\t}\n\n\t\tconst value = this.widget.inputEditor.getValue();\n\t\tif (value) {\n\t\t\twidget.inputEditor.setValue(value);\n\t\t}\n\t\twidget.focusInput();\n\t}\n\n\tsetValue(value: string): void {\n\t\tthis.widget.inputEditor.setValue(value);\n\t\tthis.focus();\n\t}\n\n\tprivate updateModel(): void {\n\t\tthis.model ??= this.chatService.startSession(this._options.providerId, CancellationToken.None);\n\t\tif (!this.model) {\n\t\t\tthrow new Error('Could not start chat session');\n\t\t}\n\n\t\tthis.widget.setModel(this.model, { inputValue: this._currentQuery });\n\t}\n}\n"]}