{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatListRenderer.ts"],"names":[],"mappings":"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","file":"chatListRenderer.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from 'vs/base/browser/dom';\nimport { IActionViewItemOptions } from 'vs/base/browser/ui/actionbar/actionViewItems';\nimport { AriaRole } from 'vs/base/browser/ui/aria/aria';\nimport { renderIcon } from 'vs/base/browser/ui/iconLabel/iconLabels';\nimport { IListVirtualDelegate } from 'vs/base/browser/ui/list/list';\nimport { IListAccessibilityProvider } from 'vs/base/browser/ui/list/listWidget';\nimport { ITreeCompressionDelegate } from 'vs/base/browser/ui/tree/asyncDataTree';\nimport { ICompressedTreeNode } from 'vs/base/browser/ui/tree/compressedObjectTreeModel';\nimport { ICompressibleTreeRenderer } from 'vs/base/browser/ui/tree/objectTree';\nimport { IAsyncDataSource, ITreeNode, ITreeRenderer } from 'vs/base/browser/ui/tree/tree';\nimport { IAction } from 'vs/base/common/actions';\nimport { IntervalTimer } from 'vs/base/common/async';\nimport { Codicon } from 'vs/base/common/codicons';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { FuzzyScore } from 'vs/base/common/filters';\nimport { IMarkdownString, MarkdownString } from 'vs/base/common/htmlContent';\nimport { Disposable, DisposableStore, IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { ResourceMap } from 'vs/base/common/map';\nimport { marked } from 'vs/base/common/marked/marked';\nimport { FileAccess } from 'vs/base/common/network';\nimport { ThemeIcon } from 'vs/base/common/themables';\nimport { URI } from 'vs/base/common/uri';\nimport { EditorExtensionsRegistry } from 'vs/editor/browser/editorExtensions';\nimport { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';\nimport { EDITOR_FONT_DEFAULTS, IEditorOptions } from 'vs/editor/common/config/editorOptions';\nimport { Range } from 'vs/editor/common/core/range';\nimport { ILanguageService } from 'vs/editor/common/languages/language';\nimport { PLAINTEXT_LANGUAGE_ID } from 'vs/editor/common/languages/modesRegistry';\nimport { EndOfLinePreference, ITextModel } from 'vs/editor/common/model';\nimport { IModelService } from 'vs/editor/common/services/model';\nimport { BracketMatchingController } from 'vs/editor/contrib/bracketMatching/browser/bracketMatching';\nimport { ContextMenuController } from 'vs/editor/contrib/contextmenu/browser/contextmenu';\nimport { IMarkdownRenderResult, MarkdownRenderer } from 'vs/editor/contrib/markdownRenderer/browser/markdownRenderer';\nimport { ViewportSemanticTokensContribution } from 'vs/editor/contrib/semanticTokens/browser/viewportSemanticTokens';\nimport { SmartSelectController } from 'vs/editor/contrib/smartSelect/browser/smartSelect';\nimport { WordHighlighterContribution } from 'vs/editor/contrib/wordHighlighter/browser/wordHighlighter';\nimport { localize } from 'vs/nls';\nimport { IAccessibilityService } from 'vs/platform/accessibility/common/accessibility';\nimport { IMenuEntryActionViewItemOptions, MenuEntryActionViewItem } from 'vs/platform/actions/browser/menuEntryActionViewItem';\nimport { MenuWorkbenchToolBar } from 'vs/platform/actions/browser/toolbar';\nimport { MenuId, MenuItemAction } from 'vs/platform/actions/common/actions';\nimport { ICommandService } from 'vs/platform/commands/common/commands';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { FileKind } from 'vs/platform/files/common/files';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { ServiceCollection } from 'vs/platform/instantiation/common/serviceCollection';\nimport { WorkbenchCompressibleAsyncDataTree } from 'vs/platform/list/browser/listService';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { defaultButtonStyles } from 'vs/platform/theme/browser/defaultStyles';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { IResourceLabel, ResourceLabels } from 'vs/workbench/browser/labels';\nimport { AccessibilityVerbositySettingId } from 'vs/workbench/contrib/accessibility/browser/accessibilityConfiguration';\nimport { IAccessibleViewService } from 'vs/workbench/contrib/accessibility/browser/accessibleView';\nimport { IChatCodeBlockActionContext } from 'vs/workbench/contrib/chat/browser/actions/chatCodeblockActions';\nimport { ChatTreeItem, IChatCodeBlockInfo, IChatFileTreeInfo } from 'vs/workbench/contrib/chat/browser/chat';\nimport { ChatFollowups } from 'vs/workbench/contrib/chat/browser/chatFollowups';\nimport { ChatEditorOptions } from 'vs/workbench/contrib/chat/browser/chatOptions';\nimport { CONTEXT_REQUEST, CONTEXT_RESPONSE, CONTEXT_RESPONSE_FILTERED, CONTEXT_RESPONSE_HAS_PROVIDER_ID, CONTEXT_RESPONSE_VOTE } from 'vs/workbench/contrib/chat/common/chatContextKeys';\nimport { IChatReplyFollowup, IChatResponseProgressFileTreeData, IChatService, ISlashCommand, InteractiveSessionVoteDirection } from 'vs/workbench/contrib/chat/common/chatService';\nimport { IChatResponseMarkdownRenderData, IChatResponseRenderData, IChatResponseViewModel, IChatWelcomeMessageViewModel, isRequestVM, isResponseVM, isWelcomeVM } from 'vs/workbench/contrib/chat/common/chatViewModel';\nimport { IWordCountResult, getNWords } from 'vs/workbench/contrib/chat/common/chatWordCounter';\nimport { MenuPreventer } from 'vs/workbench/contrib/codeEditor/browser/menuPreventer';\nimport { SelectionClipboardContributionID } from 'vs/workbench/contrib/codeEditor/browser/selectionClipboard';\nimport { getSimpleEditorOptions } from 'vs/workbench/contrib/codeEditor/browser/simpleEditorOptions';\nimport { createFileIconThemableTreeContainerScope } from 'vs/workbench/contrib/files/browser/views/explorerView';\nimport { IFilesConfiguration } from 'vs/workbench/contrib/files/common/files';\nimport { IOpenerService } from 'vs/platform/opener/common/opener';\nimport { distinct } from 'vs/base/common/arrays';\nimport { IPlaceholderMarkdownString } from 'vs/workbench/contrib/chat/common/chatModel';\n\nconst $ = dom.$;\n\ninterface IChatListItemTemplate {\n\trowContainer: HTMLElement;\n\ttitleToolbar: MenuWorkbenchToolBar;\n\tavatar: HTMLElement;\n\tusername: HTMLElement;\n\tvalue: HTMLElement;\n\tcontextKeyService: IContextKeyService;\n\ttemplateDisposables: IDisposable;\n\telementDisposables: DisposableStore;\n}\n\ninterface IItemHeightChangeParams {\n\telement: ChatTreeItem;\n\theight: number;\n}\n\nconst forceVerboseLayoutTracing = false;\n\nexport interface IChatRendererDelegate {\n\tgetListLength(): number;\n\tgetSlashCommands(): ISlashCommand[];\n}\n\nexport interface IChatListItemRendererOptions {\n\treadonly renderStyle?: 'default' | 'compact';\n}\n\nexport class ChatListItemRenderer extends Disposable implements ITreeRenderer<ChatTreeItem, FuzzyScore, IChatListItemTemplate> {\n\tstatic readonly ID = 'item';\n\n\tprivate readonly codeBlocksByResponseId = new Map<string, IChatCodeBlockInfo[]>();\n\tprivate readonly codeBlocksByEditorUri = new ResourceMap<IChatCodeBlockInfo>();\n\n\tprivate readonly fileTreesByResponseId = new Map<string, IChatFileTreeInfo[]>();\n\tprivate readonly focusedFileTreesByResponseId = new Map<string, number>();\n\n\tprivate readonly renderer: MarkdownRenderer;\n\n\tprotected readonly _onDidClickFollowup = this._register(new Emitter<IChatReplyFollowup>());\n\treadonly onDidClickFollowup: Event<IChatReplyFollowup> = this._onDidClickFollowup.event;\n\n\tprotected readonly _onDidChangeItemHeight = this._register(new Emitter<IItemHeightChangeParams>());\n\treadonly onDidChangeItemHeight: Event<IItemHeightChangeParams> = this._onDidChangeItemHeight.event;\n\n\tprivate readonly _editorPool: EditorPool;\n\tprivate readonly _treePool: TreePool;\n\n\tprivate _currentLayoutWidth: number = 0;\n\tprivate _isVisible = true;\n\tprivate _onDidChangeVisibility = this._register(new Emitter<boolean>());\n\n\tconstructor(\n\t\tprivate readonly editorOptions: ChatEditorOptions,\n\t\tprivate readonly rendererOptions: IChatListItemRendererOptions,\n\t\tprivate readonly delegate: IChatRendererDelegate,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IConfigurationService private readonly configService: IConfigurationService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@ICommandService private readonly commandService: ICommandService,\n\t\t@IOpenerService private readonly openerService: IOpenerService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IChatService private readonly chatService: IChatService\n\t) {\n\t\tsuper();\n\t\tthis.renderer = this.instantiationService.createInstance(MarkdownRenderer, {});\n\t\tthis._editorPool = this._register(this.instantiationService.createInstance(EditorPool, this.editorOptions));\n\t\tthis._treePool = this._register(this.instantiationService.createInstance(TreePool, this._onDidChangeVisibility.event));\n\t}\n\n\tget templateId(): string {\n\t\treturn ChatListItemRenderer.ID;\n\t}\n\n\tprivate traceLayout(method: string, message: string) {\n\t\tif (forceVerboseLayoutTracing) {\n\t\t\tthis.logService.info(`ChatListItemRenderer#${method}: ${message}`);\n\t\t} else {\n\t\t\tthis.logService.trace(`ChatListItemRenderer#${method}: ${message}`);\n\t\t}\n\t}\n\n\tprivate progressiveRenderEnabled(): boolean {\n\t\treturn !this.configService.getValue('interactive.experimental.disableProgressiveRendering');\n\t}\n\n\tprivate getProgressiveRenderRate(element: IChatResponseViewModel): number {\n\t\tconst configuredRate = this.configService.getValue('interactive.experimental.progressiveRenderingRate');\n\t\tif (typeof configuredRate === 'number') {\n\t\t\treturn configuredRate;\n\t\t}\n\n\t\tif (element.isComplete) {\n\t\t\treturn 60;\n\t\t}\n\n\t\tif (element.contentUpdateTimings && element.contentUpdateTimings.impliedWordLoadRate) {\n\t\t\t// This doesn't account for dead time after the last update. When the previous update is the final one and the model is only waiting for followupQuestions, that's good.\n\t\t\t// When there was one quick update and then you are waiting longer for the next one, that's not good since the rate should be decreasing.\n\t\t\t// If it's an issue, we can change this to be based on the total time from now to the beginning.\n\t\t\tconst rateBoost = 1.5;\n\t\t\treturn element.contentUpdateTimings.impliedWordLoadRate * rateBoost;\n\t\t}\n\n\t\treturn 8;\n\t}\n\n\tgetCodeBlockInfosForResponse(response: IChatResponseViewModel): IChatCodeBlockInfo[] {\n\t\tconst codeBlocks = this.codeBlocksByResponseId.get(response.id);\n\t\treturn codeBlocks ?? [];\n\t}\n\n\tgetCodeBlockInfoForEditor(uri: URI): IChatCodeBlockInfo | undefined {\n\t\treturn this.codeBlocksByEditorUri.get(uri);\n\t}\n\n\tgetFileTreeInfosForResponse(response: IChatResponseViewModel): IChatFileTreeInfo[] {\n\t\tconst fileTrees = this.fileTreesByResponseId.get(response.id);\n\t\treturn fileTrees ?? [];\n\t}\n\n\tgetLastFocusedFileTreeForResponse(response: IChatResponseViewModel): IChatFileTreeInfo | undefined {\n\t\tconst fileTrees = this.fileTreesByResponseId.get(response.id);\n\t\tconst lastFocusedFileTreeIndex = this.focusedFileTreesByResponseId.get(response.id);\n\t\tif (fileTrees?.length && lastFocusedFileTreeIndex !== undefined && lastFocusedFileTreeIndex < fileTrees.length) {\n\t\t\treturn fileTrees[lastFocusedFileTreeIndex];\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tsetVisible(visible: boolean): void {\n\t\tthis._isVisible = visible;\n\t\tthis._onDidChangeVisibility.fire(visible);\n\t}\n\n\tlayout(width: number): void {\n\t\tthis._currentLayoutWidth = width - 40; // TODO Padding\n\t\tthis._editorPool.inUse.forEach(editor => {\n\t\t\teditor.layout(this._currentLayoutWidth);\n\t\t});\n\t}\n\n\trenderTemplate(container: HTMLElement): IChatListItemTemplate {\n\t\tconst templateDisposables = new DisposableStore();\n\t\tconst rowContainer = dom.append(container, $('.interactive-item-container'));\n\t\tif (this.rendererOptions.renderStyle === 'compact') {\n\t\t\trowContainer.classList.add('interactive-item-compact');\n\t\t}\n\t\tconst header = dom.append(rowContainer, $('.header'));\n\t\tconst user = dom.append(header, $('.user'));\n\t\tconst avatar = dom.append(user, $('.avatar'));\n\t\tconst username = dom.append(user, $('h3.username'));\n\t\tconst value = dom.append(rowContainer, $('.value'));\n\t\tconst elementDisposables = new DisposableStore();\n\n\t\tconst contextKeyService = templateDisposables.add(this.contextKeyService.createScoped(rowContainer));\n\t\tconst scopedInstantiationService = this.instantiationService.createChild(new ServiceCollection([IContextKeyService, contextKeyService]));\n\t\tconst titleToolbar = templateDisposables.add(scopedInstantiationService.createInstance(MenuWorkbenchToolBar, header, MenuId.ChatMessageTitle, {\n\t\t\tmenuOptions: {\n\t\t\t\tshouldForwardArgs: true\n\t\t\t},\n\t\t\tactionViewItemProvider: (action: IAction, options: IActionViewItemOptions) => {\n\t\t\t\tif (action instanceof MenuItemAction && (action.item.id === 'workbench.action.chat.voteDown' || action.item.id === 'workbench.action.chat.voteUp')) {\n\t\t\t\t\treturn scopedInstantiationService.createInstance(ChatVoteButton, action, options as IMenuEntryActionViewItemOptions);\n\t\t\t\t}\n\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}));\n\n\n\t\tconst template: IChatListItemTemplate = { avatar, username, value, rowContainer, elementDisposables, titleToolbar, templateDisposables, contextKeyService };\n\t\treturn template;\n\t}\n\n\trenderElement(node: ITreeNode<ChatTreeItem, FuzzyScore>, index: number, templateData: IChatListItemTemplate): void {\n\t\tconst { element } = node;\n\t\tconst kind = isRequestVM(element) ? 'request' :\n\t\t\tisResponseVM(element) ? 'response' :\n\t\t\t\t'welcome';\n\t\tthis.traceLayout('renderElement', `${kind}, index=${index}`);\n\n\t\tCONTEXT_RESPONSE.bindTo(templateData.contextKeyService).set(isResponseVM(element));\n\t\tCONTEXT_REQUEST.bindTo(templateData.contextKeyService).set(isRequestVM(element));\n\t\tCONTEXT_RESPONSE_HAS_PROVIDER_ID.bindTo(templateData.contextKeyService).set(isResponseVM(element) && !!element.providerResponseId);\n\t\tif (isResponseVM(element)) {\n\t\t\tCONTEXT_RESPONSE_VOTE.bindTo(templateData.contextKeyService).set(element.vote === InteractiveSessionVoteDirection.Up ? 'up' : element.vote === InteractiveSessionVoteDirection.Down ? 'down' : '');\n\t\t} else {\n\t\t\tCONTEXT_RESPONSE_VOTE.bindTo(templateData.contextKeyService).set('');\n\t\t}\n\n\t\ttemplateData.titleToolbar.context = element;\n\n\t\tconst isFiltered = !!(isResponseVM(element) && element.errorDetails?.responseIsFiltered);\n\t\tCONTEXT_RESPONSE_FILTERED.bindTo(templateData.contextKeyService).set(isFiltered);\n\n\t\ttemplateData.rowContainer.classList.toggle('interactive-request', isRequestVM(element));\n\t\ttemplateData.rowContainer.classList.toggle('interactive-response', isResponseVM(element));\n\t\ttemplateData.rowContainer.classList.toggle('interactive-welcome', isWelcomeVM(element));\n\t\ttemplateData.rowContainer.classList.toggle('filtered-response', isFiltered);\n\t\ttemplateData.username.textContent = element.username;\n\n\t\tif (element.avatarIconUri) {\n\t\t\tconst avatarIcon = dom.$<HTMLImageElement>('img.icon');\n\t\t\tavatarIcon.src = FileAccess.uriToBrowserUri(element.avatarIconUri).toString(true);\n\t\t\ttemplateData.avatar.replaceChildren(avatarIcon);\n\t\t} else {\n\t\t\tconst defaultIcon = isRequestVM(element) ? Codicon.account : Codicon.hubot;\n\t\t\tconst avatarIcon = dom.$(ThemeIcon.asCSSSelector(defaultIcon));\n\t\t\ttemplateData.avatar.replaceChildren(avatarIcon);\n\t\t}\n\n\t\t// Do a progressive render if\n\t\t// - This the last response in the list\n\t\t// - And it is not a placeholder response (\"Thinking...\")\n\t\t// - And the response is not complete\n\t\t//   - Or, we previously started a progressive rendering of this element (if the element is complete, we will finish progressive rendering with a very fast rate)\n\t\t// - And, the feature is not disabled in configuration\n\t\tif (isResponseVM(element) && index === this.delegate.getListLength() - 1 && !element.isPlaceholder && (!element.isComplete || element.renderData) && this.progressiveRenderEnabled()) {\n\t\t\tthis.traceLayout('renderElement', `start progressive render ${kind}, index=${index}`);\n\t\t\tconst progressiveRenderingDisposables = templateData.elementDisposables.add(new DisposableStore());\n\t\t\tconst timer = templateData.elementDisposables.add(new IntervalTimer());\n\t\t\tconst runProgressiveRender = (initial?: boolean) => {\n\t\t\t\ttry {\n\t\t\t\t\tif (this.doNextProgressiveRender(element, index, templateData, !!initial, progressiveRenderingDisposables)) {\n\t\t\t\t\t\ttimer.cancel();\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\t// Kill the timer if anything went wrong, avoid getting stuck in a nasty rendering loop.\n\t\t\t\t\ttimer.cancel();\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t};\n\t\t\ttimer.cancelAndSet(runProgressiveRender, 50);\n\t\t\trunProgressiveRender(true);\n\t\t} else if (isResponseVM(element)) {\n\t\t\tthis.basicRenderElement(element.response.value, element, index, templateData);\n\t\t} else if (isRequestVM(element)) {\n\t\t\tthis.basicRenderElement([new MarkdownString(element.messageText)], element, index, templateData);\n\t\t} else {\n\t\t\tthis.renderWelcomeMessage(element, templateData);\n\t\t}\n\t}\n\n\tprivate basicRenderElement(value: ReadonlyArray<IMarkdownString | IChatResponseProgressFileTreeData>, element: ChatTreeItem, index: number, templateData: IChatListItemTemplate) {\n\t\tconst fillInIncompleteTokens = isResponseVM(element) && (!element.isComplete || element.isCanceled || element.errorDetails?.responseIsFiltered || element.errorDetails?.responseIsIncomplete);\n\n\t\tdom.clearNode(templateData.value);\n\t\tlet fileTreeIndex = 0;\n\t\tfor (const data of value) {\n\t\t\tconst result = 'value' in data\n\t\t\t\t? this.renderMarkdown(data, element, templateData.elementDisposables, templateData, fillInIncompleteTokens)\n\t\t\t\t: this.renderTreeData(data, element, templateData.elementDisposables, templateData, fileTreeIndex++);\n\t\t\ttemplateData.value.appendChild(result.element);\n\t\t\ttemplateData.elementDisposables.add(result);\n\t\t}\n\n\t\tif (isResponseVM(element) && element.errorDetails?.message) {\n\t\t\tconst icon = element.errorDetails.responseIsFiltered ? Codicon.info : Codicon.error;\n\t\t\tconst errorDetails = dom.append(templateData.value, $('.interactive-response-error-details', undefined, renderIcon(icon)));\n\t\t\terrorDetails.appendChild($('span', undefined, element.errorDetails.message));\n\t\t}\n\n\t\tif (isResponseVM(element) && element.commandFollowups?.length) {\n\t\t\tconst followupsContainer = dom.append(templateData.value, $('.interactive-response-followups'));\n\t\t\ttemplateData.elementDisposables.add(new ChatFollowups(\n\t\t\t\tfollowupsContainer,\n\t\t\t\telement.commandFollowups,\n\t\t\t\tdefaultButtonStyles,\n\t\t\t\tfollowup => {\n\t\t\t\t\tthis.chatService.notifyUserAction({\n\t\t\t\t\t\tproviderId: element.providerId,\n\t\t\t\t\t\taction: {\n\t\t\t\t\t\t\tkind: 'command',\n\t\t\t\t\t\t\tcommand: followup\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn this.commandService.executeCommand(followup.commandId, ...(followup.args ?? []));\n\t\t\t\t},\n\t\t\t\ttemplateData.contextKeyService));\n\t\t}\n\n\t\tconst newHeight = templateData.rowContainer.offsetHeight;\n\t\tconst fireEvent = !element.currentRenderedHeight || element.currentRenderedHeight !== newHeight;\n\t\telement.currentRenderedHeight = newHeight;\n\t\tif (fireEvent) {\n\t\t\tconst disposable = this._register(dom.scheduleAtNextAnimationFrame(() => {\n\t\t\t\tdisposable.dispose();\n\t\t\t\tthis._onDidChangeItemHeight.fire({ element, height: newHeight });\n\t\t\t}));\n\t\t}\n\t}\n\n\tprivate renderWelcomeMessage(element: IChatWelcomeMessageViewModel, templateData: IChatListItemTemplate) {\n\t\tdom.clearNode(templateData.value);\n\t\tconst slashCommands = this.delegate.getSlashCommands();\n\n\t\tfor (const item of element.content) {\n\t\t\tif (Array.isArray(item)) {\n\t\t\t\ttemplateData.elementDisposables.add(new ChatFollowups(\n\t\t\t\t\ttemplateData.value,\n\t\t\t\t\titem,\n\t\t\t\t\tundefined,\n\t\t\t\t\tfollowup => this._onDidClickFollowup.fire(followup),\n\t\t\t\t\ttemplateData.contextKeyService));\n\t\t\t} else {\n\t\t\t\tconst result = this.renderMarkdown(item as IMarkdownString, element, templateData.elementDisposables, templateData);\n\t\t\t\tfor (const codeElement of result.element.querySelectorAll('code')) {\n\t\t\t\t\tif (codeElement.textContent && slashCommands.find(command => codeElement.textContent === `/${command.command}`)) {\n\t\t\t\t\t\tcodeElement.classList.add('interactive-slash-command');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttemplateData.value.appendChild(result.element);\n\t\t\t\ttemplateData.elementDisposables.add(result);\n\t\t\t}\n\t\t}\n\n\t\tconst newHeight = templateData.rowContainer.offsetHeight;\n\t\tconst fireEvent = !element.currentRenderedHeight || element.currentRenderedHeight !== newHeight;\n\t\telement.currentRenderedHeight = newHeight;\n\t\tif (fireEvent) {\n\t\t\tconst disposable = this._register(dom.scheduleAtNextAnimationFrame(() => {\n\t\t\t\tdisposable.dispose();\n\t\t\t\tthis._onDidChangeItemHeight.fire({ element, height: newHeight });\n\t\t\t}));\n\t\t}\n\t}\n\n\t/**\n\t *\t@returns true if progressive rendering should be considered complete- the element's data is fully rendered or the view is not visible\n\t */\n\tprivate doNextProgressiveRender(element: IChatResponseViewModel, index: number, templateData: IChatListItemTemplate, isInRenderElement: boolean, disposables: DisposableStore): boolean {\n\t\tif (!this._isVisible) {\n\t\t\treturn true;\n\t\t}\n\n\t\tdisposables.clear();\n\n\t\tlet isFullyRendered = false;\n\t\tif (element.isCanceled) {\n\t\t\tthis.traceLayout('runProgressiveRender', `canceled, index=${index}`);\n\t\t\telement.renderData = undefined;\n\t\t\tthis.basicRenderElement(element.response.value, element, index, templateData);\n\t\t\tisFullyRendered = true;\n\t\t} else {\n\t\t\t// Figure out what we need to render in addition to what has already been rendered\n\t\t\tconst currentResponseData = element.response.value;\n\t\t\telement.renderData ??= { renderedParts: [] };\n\t\t\tconst renderedParts = element.renderData.renderedParts;\n\t\t\tconst wordCountResults: IWordCountResult[] = [];\n\t\t\tconst partsToRender: IChatResponseRenderData['renderedParts'] = [];\n\n\t\t\tcurrentResponseData.forEach((part, index) => {\n\t\t\t\tconst renderedPart = renderedParts[index];\n\t\t\t\t// Is this part completely new?\n\t\t\t\tif (!renderedPart) {\n\t\t\t\t\tif (isInteractiveProgressTreeData(part)) {\n\t\t\t\t\t\tpartsToRender[index] = part;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst wordCountResult = this.getDataForProgressiveRender(element, part, { renderedWordCount: 0, lastRenderTime: 0 });\n\t\t\t\t\t\tif (wordCountResult !== undefined) {\n\t\t\t\t\t\t\tpartsToRender[index] = {\n\t\t\t\t\t\t\t\trenderedWordCount: wordCountResult.actualWordCount,\n\t\t\t\t\t\t\t\tlastRenderTime: Date.now(),\n\t\t\t\t\t\t\t\tisFullyRendered: wordCountResult.isFullString,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\twordCountResults[index] = wordCountResult;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Did this part go from being a placeholder string to resolved tree data?\n\t\t\t\telse if (isInteractiveProgressTreeData(part) && !isInteractiveProgressTreeData(renderedPart)) {\n\t\t\t\t\tpartsToRender[index] = part;\n\t\t\t\t}\n\n\t\t\t\t// Did this part's content change?\n\t\t\t\telse if (!isInteractiveProgressTreeData(part) && !isInteractiveProgressTreeData(renderedPart)) {\n\t\t\t\t\tconst wordCountResult = this.getDataForProgressiveRender(element, part, renderedPart);\n\t\t\t\t\t// Check if there are any new words to render\n\t\t\t\t\tif (wordCountResult !== undefined && renderedPart.renderedWordCount !== wordCountResult?.actualWordCount) {\n\t\t\t\t\t\tpartsToRender[index] = {\n\t\t\t\t\t\t\trenderedWordCount: wordCountResult.actualWordCount,\n\t\t\t\t\t\t\tlastRenderTime: Date.now(),\n\t\t\t\t\t\t\tisFullyRendered: wordCountResult.isFullString,\n\t\t\t\t\t\t};\n\t\t\t\t\t\twordCountResults[index] = wordCountResult;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tisFullyRendered = partsToRender.length === 0;\n\n\t\t\tif (isFullyRendered && element.isComplete) {\n\t\t\t\t// Response is done and content is rendered, so do a normal render\n\t\t\t\tthis.traceLayout('runProgressiveRender', `end progressive render, index=${index} and clearing renderData, response is complete, index=${index}`);\n\t\t\t\telement.renderData = undefined;\n\t\t\t\tdisposables.clear();\n\t\t\t\tthis.basicRenderElement(element.response.value, element, index, templateData);\n\t\t\t} else if (!isFullyRendered) {\n\t\t\t\tlet hasRenderedOneMarkdownBlock = false;\n\t\t\t\tpartsToRender.forEach((partToRender, index) => {\n\t\t\t\t\tif (!partToRender) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet result;\n\t\t\t\t\tif (isInteractiveProgressTreeData(partToRender)) {\n\t\t\t\t\t\tresult = this.renderTreeData(partToRender, element, disposables, templateData, index);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Avoid doing progressive rendering for multiple markdown parts simultaneously\n\t\t\t\t\telse if (!hasRenderedOneMarkdownBlock) {\n\t\t\t\t\t\tconst { value } = wordCountResults[index];\n\t\t\t\t\t\tconst isPlaceholder = isPlaceholderMarkdown(currentResponseData[index]);\n\t\t\t\t\t\tresult = isPlaceholder\n\t\t\t\t\t\t\t? this.renderPlaceholder(new MarkdownString(value), templateData)\n\t\t\t\t\t\t\t: this.renderMarkdown(new MarkdownString(value), element, disposables, templateData, true);\n\t\t\t\t\t\thasRenderedOneMarkdownBlock = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!result) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Doing the progressive render\n\t\t\t\t\trenderedParts[index] = partToRender;\n\t\t\t\t\tconst existingElement = templateData.value.children[index];\n\t\t\t\t\tif (existingElement) {\n\t\t\t\t\t\ttemplateData.value.replaceChild(result.element, existingElement);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttemplateData.value.appendChild(result.element);\n\t\t\t\t\t}\n\t\t\t\t\tdisposables.add(result);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Nothing new to render, not done, keep waiting\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t// Some render happened - update the height\n\t\tconst height = templateData.rowContainer.offsetHeight;\n\t\telement.currentRenderedHeight = height;\n\t\tif (!isInRenderElement) {\n\t\t\tthis._onDidChangeItemHeight.fire({ element, height: templateData.rowContainer.offsetHeight });\n\t\t}\n\n\t\treturn isFullyRendered;\n\t}\n\n\tprivate renderTreeData(data: IChatResponseProgressFileTreeData, element: ChatTreeItem, disposables: DisposableStore, templateData: IChatListItemTemplate, treeDataIndex: number): { element: HTMLElement; dispose: () => void } {\n\t\tconst ref = this._treePool.get();\n\t\tconst tree = ref.object;\n\n\t\tconst treeDisposables = new DisposableStore();\n\t\ttreeDisposables.add(tree.onDidOpen((e) => {\n\t\t\tif (e.element && !('children' in e.element)) {\n\t\t\t\tthis.openerService.open(e.element.uri);\n\t\t\t}\n\t\t}));\n\t\ttreeDisposables.add(tree.onDidChangeCollapseState(() => {\n\t\t\tthis._onDidChangeItemHeight.fire({ element, height: templateData.rowContainer.offsetHeight });\n\t\t}));\n\t\ttreeDisposables.add(tree.onContextMenu((e) => {\n\t\t\te.browserEvent.preventDefault();\n\t\t\te.browserEvent.stopPropagation();\n\t\t}));\n\n\t\ttree.setInput(data).then(() => {\n\t\t\tif (!ref.isStale()) {\n\t\t\t\ttree.layout();\n\t\t\t\tthis._onDidChangeItemHeight.fire({ element, height: templateData.rowContainer.offsetHeight });\n\t\t\t}\n\t\t});\n\n\t\tif (isResponseVM(element)) {\n\t\t\tconst fileTreeFocusInfo = {\n\t\t\t\ttreeDataId: data.uri.toString(),\n\t\t\t\ttreeIndex: treeDataIndex,\n\t\t\t\tfocus() {\n\t\t\t\t\ttree.domFocus();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\ttreeDisposables.add(tree.onDidFocus(() => {\n\t\t\t\tthis.focusedFileTreesByResponseId.set(element.id, fileTreeFocusInfo.treeIndex);\n\t\t\t}));\n\n\t\t\tconst fileTrees = this.fileTreesByResponseId.get(element.id) ?? [];\n\t\t\tfileTrees.push(fileTreeFocusInfo);\n\t\t\tthis.fileTreesByResponseId.set(element.id, distinct(fileTrees, (v) => v.treeDataId));\n\t\t\tdisposables.add(toDisposable(() => this.fileTreesByResponseId.set(element.id, fileTrees.filter(v => v.treeDataId !== data.uri.toString()))));\n\t\t}\n\n\t\treturn {\n\t\t\telement: tree.getHTMLElement().parentElement!,\n\t\t\tdispose: () => {\n\t\t\t\ttreeDisposables.dispose();\n\t\t\t\tref.dispose();\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate renderPlaceholder(markdown: IMarkdownString, templateData: IChatListItemTemplate): IMarkdownRenderResult {\n\t\tconst codicon = $('.interactive-response-codicon-details', undefined, renderIcon({ id: 'sync~spin' }));\n\t\tcodicon.classList.add('interactive-response-placeholder-codicon');\n\t\tconst result = dom.append(templateData.value, codicon);\n\n\t\tconst content = this.renderer.render(markdown);\n\t\tcontent.element.className = 'interactive-response-placeholder-content';\n\t\tresult.appendChild(content.element);\n\n\t\treturn { element: result, dispose: () => content.dispose() };\n\t}\n\n\tprivate renderMarkdown(markdown: IMarkdownString, element: ChatTreeItem, disposables: DisposableStore, templateData: IChatListItemTemplate, fillInIncompleteTokens = false): IMarkdownRenderResult {\n\t\tconst disposablesList: IDisposable[] = [];\n\t\tlet codeBlockIndex = 0;\n\n\t\t// TODO if the slash commands stay completely dynamic, this isn't quite right\n\t\tconst slashCommands = this.delegate.getSlashCommands();\n\t\tconst usedSlashCommand = slashCommands.find(s => markdown.value.startsWith(`/${s.command} `));\n\t\tconst toRender = usedSlashCommand ? markdown.value.slice(usedSlashCommand.command.length + 2) : markdown.value;\n\t\tmarkdown = new MarkdownString(toRender, {\n\t\t\tisTrusted: {\n\t\t\t\t// Disable all other config options except isTrusted\n\t\t\t\tenabledCommands: typeof markdown.isTrusted === 'object' ? markdown.isTrusted?.enabledCommands : [] ?? []\n\t\t\t}\n\t\t});\n\n\t\tconst codeblocks: IChatCodeBlockInfo[] = [];\n\t\tconst result = this.renderer.render(markdown, {\n\t\t\tfillInIncompleteTokens,\n\t\t\tcodeBlockRendererSync: (languageId, text) => {\n\t\t\t\tconst data = { languageId, text, codeBlockIndex: codeBlockIndex++, element, parentContextKeyService: templateData.contextKeyService };\n\t\t\t\tconst ref = this.renderCodeBlock(data, disposables);\n\n\t\t\t\t// Attach this after updating text/layout of the editor, so it should only be fired when the size updates later (horizontal scrollbar, wrapping)\n\t\t\t\t// not during a renderElement OR a progressive render (when we will be firing this event anyway at the end of the render)\n\t\t\t\tdisposables.add(ref.object.onDidChangeContentHeight(() => {\n\t\t\t\t\tref.object.layout(this._currentLayoutWidth);\n\t\t\t\t\tthis._onDidChangeItemHeight.fire({ element, height: templateData.rowContainer.offsetHeight });\n\t\t\t\t}));\n\n\t\t\t\tif (isResponseVM(element)) {\n\t\t\t\t\tconst info: IChatCodeBlockInfo = {\n\t\t\t\t\t\tcodeBlockIndex: data.codeBlockIndex,\n\t\t\t\t\t\telement,\n\t\t\t\t\t\tfocus() {\n\t\t\t\t\t\t\tref.object.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tcodeblocks.push(info);\n\t\t\t\t\tthis.codeBlocksByEditorUri.set(ref.object.textModel.uri, info);\n\t\t\t\t\tdisposables.add(toDisposable(() => this.codeBlocksByEditorUri.delete(ref.object.textModel.uri)));\n\t\t\t\t}\n\t\t\t\tdisposablesList.push(ref);\n\t\t\t\treturn ref.object.element;\n\t\t\t}\n\t\t});\n\n\t\tif (isResponseVM(element)) {\n\t\t\tthis.codeBlocksByResponseId.set(element.id, codeblocks);\n\t\t\tdisposables.add(toDisposable(() => this.codeBlocksByResponseId.delete(element.id)));\n\t\t}\n\n\t\tif (usedSlashCommand) {\n\t\t\tconst slashCommandElement = $('span.interactive-slash-command', { title: usedSlashCommand.detail }, `/${usedSlashCommand.command} `);\n\t\t\tif (result.element.firstChild?.nodeName.toLowerCase() === 'p') {\n\t\t\t\tresult.element.firstChild.insertBefore(slashCommandElement, result.element.firstChild.firstChild);\n\t\t\t} else {\n\t\t\t\tresult.element.insertBefore($('p', undefined, slashCommandElement), result.element.firstChild);\n\t\t\t}\n\t\t}\n\n\t\tdisposablesList.reverse().forEach(d => disposables.add(d));\n\t\treturn result;\n\t}\n\n\tprivate renderCodeBlock(data: IChatResultCodeBlockData, disposables: DisposableStore): IDisposableReference<IChatResultCodeBlockPart> {\n\t\tconst ref = this._editorPool.get();\n\t\tconst editorInfo = ref.object;\n\t\teditorInfo.render(data, this._currentLayoutWidth);\n\n\t\treturn ref;\n\t}\n\n\tprivate getDataForProgressiveRender(element: IChatResponseViewModel, data: IMarkdownString, renderData: Pick<IChatResponseMarkdownRenderData, 'lastRenderTime' | 'renderedWordCount'>): IWordCountResult | undefined {\n\t\tconst rate = this.getProgressiveRenderRate(element);\n\t\tconst numWordsToRender = renderData.lastRenderTime === 0 ?\n\t\t\t1 :\n\t\t\trenderData.renderedWordCount +\n\t\t\t// Additional words to render beyond what's already rendered\n\t\t\tMath.floor((Date.now() - renderData.lastRenderTime) / 1000 * rate);\n\n\t\tif (numWordsToRender === renderData.renderedWordCount) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn getNWords(data.value, numWordsToRender);\n\t}\n\n\tdisposeElement(node: ITreeNode<ChatTreeItem, FuzzyScore>, index: number, templateData: IChatListItemTemplate): void {\n\t\ttemplateData.elementDisposables.clear();\n\t}\n\n\tdisposeTemplate(templateData: IChatListItemTemplate): void {\n\t\ttemplateData.templateDisposables.dispose();\n\t}\n}\n\nexport class ChatListDelegate implements IListVirtualDelegate<ChatTreeItem> {\n\tconstructor(\n\t\t@ILogService private readonly logService: ILogService\n\t) { }\n\n\tprivate _traceLayout(method: string, message: string) {\n\t\tif (forceVerboseLayoutTracing) {\n\t\t\tthis.logService.info(`ChatListDelegate#${method}: ${message}`);\n\t\t} else {\n\t\t\tthis.logService.trace(`ChatListDelegate#${method}: ${message}`);\n\t\t}\n\t}\n\n\tgetHeight(element: ChatTreeItem): number {\n\t\tconst kind = isRequestVM(element) ? 'request' : 'response';\n\t\tconst height = ('currentRenderedHeight' in element ? element.currentRenderedHeight : undefined) ?? 200;\n\t\tthis._traceLayout('getHeight', `${kind}, height=${height}`);\n\t\treturn height;\n\t}\n\n\tgetTemplateId(element: ChatTreeItem): string {\n\t\treturn ChatListItemRenderer.ID;\n\t}\n\n\thasDynamicHeight(element: ChatTreeItem): boolean {\n\t\treturn true;\n\t}\n}\n\nexport class ChatAccessibilityProvider implements IListAccessibilityProvider<ChatTreeItem> {\n\n\tconstructor(\n\t\t@IAccessibleViewService private readonly _accessibleViewService: IAccessibleViewService\n\t) {\n\n\t}\n\tgetWidgetRole(): AriaRole {\n\t\treturn 'list';\n\t}\n\n\tgetRole(element: ChatTreeItem): AriaRole | undefined {\n\t\treturn 'listitem';\n\t}\n\n\tgetWidgetAriaLabel(): string {\n\t\treturn localize('chat', \"Chat\");\n\t}\n\n\tgetAriaLabel(element: ChatTreeItem): string {\n\t\tif (isRequestVM(element)) {\n\t\t\treturn element.messageText;\n\t\t}\n\n\t\tif (isResponseVM(element)) {\n\t\t\treturn this._getLabelWithCodeBlockCount(element);\n\t\t}\n\n\t\tif (isWelcomeVM(element)) {\n\t\t\treturn element.content.map(c => 'value' in c ? c.value : c.map(followup => followup.message).join('\\n')).join('\\n');\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tprivate _getLabelWithCodeBlockCount(element: IChatResponseViewModel): string {\n\t\tconst accessibleViewHint = this._accessibleViewService.getOpenAriaHint(AccessibilityVerbositySettingId.Chat);\n\t\tlet label: string = '';\n\t\tlet commandFollowUpInfo;\n\t\tconst commandFollowupLength = element.commandFollowups?.length ?? 0;\n\t\tswitch (commandFollowupLength) {\n\t\t\tcase 0:\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tcommandFollowUpInfo = localize('commandFollowUpInfo', \"Command: {0}\", element.commandFollowups![0].title);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tcommandFollowUpInfo = localize('commandFollowUpInfoMany', \"Commands: {0}\", element.commandFollowups!.map(followup => followup.title).join(', '));\n\t\t}\n\t\tconst fileTreeCount = element.response.value.filter((v) => !('value' in v))?.length ?? 0;\n\t\tlet fileTreeCountHint = '';\n\t\tswitch (fileTreeCount) {\n\t\t\tcase 0:\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tfileTreeCountHint = localize('singleFileTreeHint', \"1 file tree\");\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tfileTreeCountHint = localize('multiFileTreeHint', \"{0} file trees\", fileTreeCount);\n\t\t\t\tbreak;\n\t\t}\n\t\tconst codeBlockCount = marked.lexer(element.response.asString()).filter(token => token.type === 'code')?.length ?? 0;\n\t\tswitch (codeBlockCount) {\n\t\t\tcase 0:\n\t\t\t\tlabel = accessibleViewHint ? localize('noCodeBlocksHint', \"{0} {1} {2}\", fileTreeCountHint, element.response.asString(), accessibleViewHint) : localize('noCodeBlocks', \"{0} {1}\", fileTreeCountHint, element.response.asString());\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tlabel = accessibleViewHint ? localize('singleCodeBlockHint', \"{0} 1 code block: {1} {2}\", fileTreeCountHint, element.response.asString(), accessibleViewHint) : localize('singleCodeBlock', \"{0} 1 code block: {1}\", fileTreeCountHint, element.response.asString());\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlabel = accessibleViewHint ? localize('multiCodeBlockHint', \"{0} {1} code blocks: {2}\", fileTreeCountHint, codeBlockCount, element.response.asString(), accessibleViewHint) : localize('multiCodeBlock', \"{0} {1} code blocks\", fileTreeCountHint, codeBlockCount, element.response.asString());\n\t\t\t\tbreak;\n\t\t}\n\t\treturn commandFollowUpInfo ? commandFollowUpInfo + ', ' + label : label;\n\t}\n}\n\ninterface IChatResultCodeBlockData {\n\ttext: string;\n\tlanguageId: string;\n\tcodeBlockIndex: number;\n\telement: ChatTreeItem;\n\tparentContextKeyService: IContextKeyService;\n}\n\ninterface IChatResultCodeBlockPart {\n\treadonly onDidChangeContentHeight: Event<number>;\n\treadonly element: HTMLElement;\n\treadonly textModel: ITextModel;\n\tlayout(width: number): void;\n\trender(data: IChatResultCodeBlockData, width: number): void;\n\tfocus(): void;\n\tdispose(): void;\n}\n\nconst defaultCodeblockPadding = 10;\n\nclass CodeBlockPart extends Disposable implements IChatResultCodeBlockPart {\n\tprivate readonly _onDidChangeContentHeight = this._register(new Emitter<number>());\n\tpublic readonly onDidChangeContentHeight = this._onDidChangeContentHeight.event;\n\n\tprivate readonly editor: CodeEditorWidget;\n\tprivate readonly toolbar: MenuWorkbenchToolBar;\n\tprivate readonly contextKeyService: IContextKeyService;\n\n\tpublic readonly textModel: ITextModel;\n\tpublic readonly element: HTMLElement;\n\n\tprivate currentScrollWidth = 0;\n\n\tconstructor(\n\t\tprivate readonly options: ChatEditorOptions,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IAccessibilityService private readonly accessibilityService: IAccessibilityService\n\t) {\n\t\tsuper();\n\t\tthis.element = $('.interactive-result-editor-wrapper');\n\t\tthis.contextKeyService = this._register(contextKeyService.createScoped(this.element));\n\t\tconst scopedInstantiationService = instantiationService.createChild(new ServiceCollection([IContextKeyService, this.contextKeyService]));\n\t\tthis.toolbar = this._register(scopedInstantiationService.createInstance(MenuWorkbenchToolBar, this.element, MenuId.ChatCodeBlock, {\n\t\t\tmenuOptions: {\n\t\t\t\tshouldForwardArgs: true\n\t\t\t}\n\t\t}));\n\n\t\tthis._configureForScreenReader();\n\t\tthis._register(this.accessibilityService.onDidChangeScreenReaderOptimized(() => this._configureForScreenReader()));\n\t\tthis._register(this.configurationService.onDidChangeConfiguration((e) => {\n\t\t\tif (e.affectedKeys.has(AccessibilityVerbositySettingId.Chat)) {\n\t\t\t\tthis._configureForScreenReader();\n\t\t\t}\n\t\t}));\n\t\tconst editorElement = dom.append(this.element, $('.interactive-result-editor'));\n\t\tthis.editor = this._register(scopedInstantiationService.createInstance(CodeEditorWidget, editorElement, {\n\t\t\t...getSimpleEditorOptions(this.configurationService),\n\t\t\treadOnly: true,\n\t\t\tlineNumbers: 'off',\n\t\t\tselectOnLineNumbers: true,\n\t\t\tscrollBeyondLastLine: false,\n\t\t\tlineDecorationsWidth: 8,\n\t\t\tdragAndDrop: false,\n\t\t\tpadding: { top: defaultCodeblockPadding, bottom: defaultCodeblockPadding },\n\t\t\tmouseWheelZoom: false,\n\t\t\tscrollbar: {\n\t\t\t\talwaysConsumeMouseWheel: false\n\t\t\t},\n\t\t\tariaLabel: localize('chat.codeBlockHelp', 'Code block'),\n\t\t\t...this.getEditorOptionsFromConfig()\n\t\t}, {\n\t\t\tisSimpleWidget: true,\n\t\t\tcontributions: EditorExtensionsRegistry.getSomeEditorContributions([\n\t\t\t\tMenuPreventer.ID,\n\t\t\t\tSelectionClipboardContributionID,\n\t\t\t\tContextMenuController.ID,\n\n\t\t\t\tWordHighlighterContribution.ID,\n\t\t\t\tViewportSemanticTokensContribution.ID,\n\t\t\t\tBracketMatchingController.ID,\n\t\t\t\tSmartSelectController.ID,\n\t\t\t])\n\t\t}));\n\n\t\tthis._register(this.options.onDidChange(() => {\n\t\t\tthis.editor.updateOptions(this.getEditorOptionsFromConfig());\n\t\t}));\n\n\t\tthis._register(this.editor.onDidScrollChange(e => {\n\t\t\tthis.currentScrollWidth = e.scrollWidth;\n\t\t}));\n\t\tthis._register(this.editor.onDidContentSizeChange(e => {\n\t\t\tif (e.contentHeightChanged) {\n\t\t\t\tthis._onDidChangeContentHeight.fire(e.contentHeight);\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.editor.onDidBlurEditorWidget(() => {\n\t\t\tthis.element.classList.remove('focused');\n\t\t\tWordHighlighterContribution.get(this.editor)?.stopHighlighting();\n\t\t}));\n\t\tthis._register(this.editor.onDidFocusEditorWidget(() => {\n\t\t\tthis.element.classList.add('focused');\n\t\t\tWordHighlighterContribution.get(this.editor)?.restoreViewState(true);\n\t\t}));\n\n\t\tthis.textModel = this._register(this.modelService.createModel('', null, undefined));\n\t\tthis.editor.setModel(this.textModel);\n\t}\n\n\tfocus(): void {\n\t\tthis.editor.focus();\n\t}\n\n\tprivate updatePaddingForLayout() {\n\t\t// scrollWidth = \"the width of the content that needs to be scrolled\"\n\t\t// contentWidth = \"the width of the area where content is displayed\"\n\t\tconst horizontalScrollbarVisible = this.currentScrollWidth > this.editor.getLayoutInfo().contentWidth;\n\t\tconst scrollbarHeight = this.editor.getLayoutInfo().horizontalScrollbarHeight;\n\t\tconst bottomPadding = horizontalScrollbarVisible ?\n\t\t\tMath.max(defaultCodeblockPadding - scrollbarHeight, 2) :\n\t\t\tdefaultCodeblockPadding;\n\t\tthis.editor.updateOptions({ padding: { top: defaultCodeblockPadding, bottom: bottomPadding } });\n\t}\n\n\tprivate _configureForScreenReader(): void {\n\t\tconst toolbarElt = this.toolbar.getElement();\n\t\tif (this.accessibilityService.isScreenReaderOptimized()) {\n\t\t\ttoolbarElt.style.display = 'block';\n\t\t\ttoolbarElt.ariaLabel = this.configurationService.getValue(AccessibilityVerbositySettingId.Chat) ? localize('chat.codeBlock.toolbarVerbose', 'Toolbar for code block which can be reached via tab') : localize('chat.codeBlock.toolbar', 'Code block toolbar');\n\t\t} else {\n\t\t\ttoolbarElt.style.display = '';\n\t\t}\n\n\t}\n\n\tprivate getEditorOptionsFromConfig(): IEditorOptions {\n\t\treturn {\n\t\t\twordWrap: this.options.configuration.resultEditor.wordWrap,\n\t\t\tfontLigatures: this.options.configuration.resultEditor.fontLigatures,\n\t\t\tbracketPairColorization: this.options.configuration.resultEditor.bracketPairColorization,\n\t\t\tfontFamily: this.options.configuration.resultEditor.fontFamily === 'default' ?\n\t\t\t\tEDITOR_FONT_DEFAULTS.fontFamily :\n\t\t\t\tthis.options.configuration.resultEditor.fontFamily,\n\t\t\tfontSize: this.options.configuration.resultEditor.fontSize,\n\t\t\tfontWeight: this.options.configuration.resultEditor.fontWeight,\n\t\t\tlineHeight: this.options.configuration.resultEditor.lineHeight,\n\t\t};\n\t}\n\n\tlayout(width: number): void {\n\t\tconst realContentHeight = this.editor.getContentHeight();\n\t\tconst editorBorder = 2;\n\t\tthis.editor.layout({ width: width - editorBorder, height: realContentHeight });\n\t\tthis.updatePaddingForLayout();\n\t}\n\n\trender(data: IChatResultCodeBlockData, width: number): void {\n\t\tthis.contextKeyService.updateParent(data.parentContextKeyService);\n\n\t\tif (this.options.configuration.resultEditor.wordWrap === 'on') {\n\t\t\t// Intialize the editor with the new proper width so that getContentHeight\n\t\t\t// will be computed correctly in the next call to layout()\n\t\t\tthis.layout(width);\n\t\t}\n\n\t\tconst text = this.fixCodeText(data.text, data.languageId);\n\t\tthis.setText(text);\n\n\t\tconst vscodeLanguageId = this.languageService.getLanguageIdByLanguageName(data.languageId) ?? undefined;\n\t\tthis.setLanguage(vscodeLanguageId);\n\n\t\tthis.layout(width);\n\t\tthis.editor.updateOptions({ ariaLabel: localize('chat.codeBlockLabel', \"Code block {0}\", data.codeBlockIndex + 1) });\n\t\tthis.toolbar.context = <IChatCodeBlockActionContext>{\n\t\t\tcode: data.text,\n\t\t\tcodeBlockIndex: data.codeBlockIndex,\n\t\t\telement: data.element,\n\t\t\tlanguageId: vscodeLanguageId\n\t\t};\n\n\t\tif (isResponseVM(data.element) && data.element.errorDetails?.responseIsFiltered) {\n\t\t\tdom.hide(this.toolbar.getElement());\n\t\t} else {\n\t\t\tdom.show(this.toolbar.getElement());\n\t\t}\n\t}\n\n\tprivate fixCodeText(text: string, languageId: string): string {\n\t\tif (languageId === 'php') {\n\t\t\tif (!text.trim().startsWith('<')) {\n\t\t\t\treturn `<?php\\n${text}\\n?>`;\n\t\t\t}\n\t\t}\n\n\t\treturn text;\n\t}\n\n\tprivate setText(newText: string): void {\n\t\tconst currentText = this.textModel.getValue(EndOfLinePreference.LF);\n\t\tif (newText === currentText) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (newText.startsWith(currentText)) {\n\t\t\tconst text = newText.slice(currentText.length);\n\t\t\tconst lastLine = this.textModel.getLineCount();\n\t\t\tconst lastCol = this.textModel.getLineMaxColumn(lastLine);\n\t\t\tthis.textModel.applyEdits([{ range: new Range(lastLine, lastCol, lastLine, lastCol), text }]);\n\t\t} else {\n\t\t\t// console.log(`Failed to optimize setText`);\n\t\t\tthis.textModel.setValue(newText);\n\t\t}\n\t}\n\n\tprivate setLanguage(vscodeLanguageId: string | undefined): void {\n\t\tthis.textModel.setLanguage(vscodeLanguageId ?? PLAINTEXT_LANGUAGE_ID);\n\t}\n}\n\ninterface IDisposableReference<T> extends IDisposable {\n\tobject: T;\n\tisStale: () => boolean;\n}\n\nclass EditorPool extends Disposable {\n\tprivate _pool: ResourcePool<IChatResultCodeBlockPart>;\n\n\tpublic get inUse(): ReadonlySet<IChatResultCodeBlockPart> {\n\t\treturn this._pool.inUse;\n\t}\n\n\tconstructor(\n\t\tprivate readonly options: ChatEditorOptions,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\t\tthis._pool = this._register(new ResourcePool(() => this.editorFactory()));\n\n\t\t// TODO listen to changes on options\n\t}\n\n\tprivate editorFactory(): IChatResultCodeBlockPart {\n\t\treturn this.instantiationService.createInstance(CodeBlockPart, this.options);\n\t}\n\n\tget(): IDisposableReference<IChatResultCodeBlockPart> {\n\t\tconst object = this._pool.get();\n\t\tlet stale = false;\n\t\treturn {\n\t\t\tobject,\n\t\t\tisStale: () => stale,\n\t\t\tdispose: () => {\n\t\t\t\tstale = true;\n\t\t\t\tthis._pool.release(object);\n\t\t\t}\n\t\t};\n\t}\n}\n\nclass TreePool extends Disposable {\n\tprivate _pool: ResourcePool<WorkbenchCompressibleAsyncDataTree<IChatResponseProgressFileTreeData, IChatResponseProgressFileTreeData, void>>;\n\n\tpublic get inUse(): ReadonlySet<WorkbenchCompressibleAsyncDataTree<IChatResponseProgressFileTreeData, IChatResponseProgressFileTreeData, void>> {\n\t\treturn this._pool.inUse;\n\t}\n\n\tconstructor(\n\t\tprivate _onDidChangeVisibility: Event<boolean>,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IConfigurationService private readonly configService: IConfigurationService,\n\t\t@IThemeService private readonly themeService: IThemeService,\n\t) {\n\t\tsuper();\n\t\tthis._pool = this._register(new ResourcePool(() => this.treeFactory()));\n\t}\n\n\tprivate treeFactory(): WorkbenchCompressibleAsyncDataTree<IChatResponseProgressFileTreeData, IChatResponseProgressFileTreeData, void> {\n\t\tconst resourceLabels = this.instantiationService.createInstance(ResourceLabels, { onDidChangeVisibility: this._onDidChangeVisibility });\n\n\t\tconst container = $('.interactive-response-progress-tree');\n\t\tcreateFileIconThemableTreeContainerScope(container, this.themeService);\n\n\t\tconst tree = <WorkbenchCompressibleAsyncDataTree<IChatResponseProgressFileTreeData, IChatResponseProgressFileTreeData>>this.instantiationService.createInstance(\n\t\t\tWorkbenchCompressibleAsyncDataTree,\n\t\t\t'ChatListRenderer',\n\t\t\tcontainer,\n\t\t\tnew ChatListTreeDelegate(),\n\t\t\tnew ChatListTreeCompressionDelegate(),\n\t\t\t[new ChatListTreeRenderer(resourceLabels, this.configService.getValue('explorer.decorations'))],\n\t\t\tnew ChatListTreeDataSource(),\n\t\t\t{\n\t\t\t\tcollapseByDefault: () => false,\n\t\t\t\texpandOnlyOnTwistieClick: () => false,\n\t\t\t\tidentityProvider: {\n\t\t\t\t\tgetId: (e: IChatResponseProgressFileTreeData) => e.uri.toString()\n\t\t\t\t},\n\t\t\t\taccessibilityProvider: {\n\t\t\t\t\tgetAriaLabel: (element: IChatResponseProgressFileTreeData) => element.label,\n\t\t\t\t\tgetWidgetAriaLabel: () => localize('treeAriaLabel', \"File Tree\")\n\t\t\t\t},\n\t\t\t\talwaysConsumeMouseWheel: false\n\t\t\t});\n\n\t\treturn tree;\n\t}\n\n\tget(): IDisposableReference<WorkbenchCompressibleAsyncDataTree<IChatResponseProgressFileTreeData, IChatResponseProgressFileTreeData, void>> {\n\t\tconst object = this._pool.get();\n\t\tlet stale = false;\n\t\treturn {\n\t\t\tobject,\n\t\t\tisStale: () => stale,\n\t\t\tdispose: () => {\n\t\t\t\tstale = true;\n\t\t\t\tthis._pool.release(object);\n\t\t\t}\n\t\t};\n\t}\n}\n\n// TODO does something in lifecycle.ts cover this?\n\nclass ResourcePool<T extends IDisposable> extends Disposable {\n\tprivate readonly pool: T[] = [];\n\n\tprivate _inUse = new Set<T>;\n\tpublic get inUse(): ReadonlySet<T> {\n\t\treturn this._inUse;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _itemFactory: () => T,\n\t) {\n\t\tsuper();\n\t}\n\n\tget(): T {\n\t\tif (this.pool.length > 0) {\n\t\t\tconst item = this.pool.pop()!;\n\t\t\tthis._inUse.add(item);\n\t\t\treturn item;\n\t\t}\n\n\t\tconst item = this._register(this._itemFactory());\n\t\tthis._inUse.add(item);\n\t\treturn item;\n\t}\n\n\trelease(item: T): void {\n\t\tthis._inUse.delete(item);\n\t\tthis.pool.push(item);\n\t}\n}\n\nclass ChatVoteButton extends MenuEntryActionViewItem {\n\toverride render(container: HTMLElement): void {\n\t\tsuper.render(container);\n\t\tcontainer.classList.toggle('checked', this.action.checked);\n\t}\n}\n\nclass ChatListTreeDelegate implements IListVirtualDelegate<IChatResponseProgressFileTreeData> {\n\tstatic readonly ITEM_HEIGHT = 22;\n\n\tgetHeight(element: IChatResponseProgressFileTreeData): number {\n\t\treturn ChatListTreeDelegate.ITEM_HEIGHT;\n\t}\n\n\tgetTemplateId(element: IChatResponseProgressFileTreeData): string {\n\t\treturn 'chatListTreeTemplate';\n\t}\n}\n\nclass ChatListTreeCompressionDelegate implements ITreeCompressionDelegate<IChatResponseProgressFileTreeData> {\n\tisIncompressible(element: IChatResponseProgressFileTreeData): boolean {\n\t\treturn !element.children;\n\t}\n}\n\ninterface IChatListTreeRendererTemplate {\n\ttemplateDisposables: DisposableStore;\n\tlabel: IResourceLabel;\n}\n\nclass ChatListTreeRenderer implements ICompressibleTreeRenderer<IChatResponseProgressFileTreeData, void, IChatListTreeRendererTemplate> {\n\ttemplateId: string = 'chatListTreeTemplate';\n\n\tconstructor(private labels: ResourceLabels, private decorations: IFilesConfiguration['explorer']['decorations']) { }\n\n\trenderCompressedElements(element: ITreeNode<ICompressedTreeNode<IChatResponseProgressFileTreeData>, void>, index: number, templateData: IChatListTreeRendererTemplate, height: number | undefined): void {\n\t\ttemplateData.label.element.style.display = 'flex';\n\t\tconst label = element.element.elements.map((e) => e.label);\n\t\ttemplateData.label.setResource({ resource: element.element.elements[0].uri, name: label }, {\n\t\t\ttitle: element.element.elements[0].label,\n\t\t\tfileKind: element.children ? FileKind.FOLDER : FileKind.FILE,\n\t\t\textraClasses: ['explorer-item'],\n\t\t\tfileDecorations: this.decorations\n\t\t});\n\t}\n\trenderTemplate(container: HTMLElement): IChatListTreeRendererTemplate {\n\t\tconst templateDisposables = new DisposableStore();\n\t\tconst label = templateDisposables.add(this.labels.create(container, { supportHighlights: true }));\n\t\treturn { templateDisposables, label };\n\t}\n\trenderElement(element: ITreeNode<IChatResponseProgressFileTreeData, void>, index: number, templateData: IChatListTreeRendererTemplate, height: number | undefined): void {\n\t\ttemplateData.label.element.style.display = 'flex';\n\t\tconst hasExtension = /\\.[^/.]+$/.test(element.element.label);\n\t\tif (!element.children.length && hasExtension) {\n\t\t\ttemplateData.label.setFile(element.element.uri, {\n\t\t\t\tfileKind: FileKind.FILE,\n\t\t\t\thidePath: true,\n\t\t\t\tfileDecorations: this.decorations,\n\t\t\t});\n\t\t} else {\n\t\t\ttemplateData.label.setResource({ resource: element.element.uri, name: element.element.label }, {\n\t\t\t\ttitle: element.element.label,\n\t\t\t\tfileKind: FileKind.FOLDER,\n\t\t\t\tfileDecorations: this.decorations\n\t\t\t});\n\t\t}\n\t}\n\tdisposeTemplate(templateData: IChatListTreeRendererTemplate): void {\n\t\ttemplateData.templateDisposables.dispose();\n\t}\n}\n\nclass ChatListTreeDataSource implements IAsyncDataSource<IChatResponseProgressFileTreeData, IChatResponseProgressFileTreeData> {\n\thasChildren(element: IChatResponseProgressFileTreeData): boolean {\n\t\treturn !!element.children;\n\t}\n\n\tasync getChildren(element: IChatResponseProgressFileTreeData): Promise<Iterable<IChatResponseProgressFileTreeData>> {\n\t\treturn element.children ?? [];\n\t}\n}\n\nfunction isInteractiveProgressTreeData(item: IChatResponseProgressFileTreeData | IChatResponseMarkdownRenderData | IMarkdownString): item is IChatResponseProgressFileTreeData {\n\treturn 'label' in item;\n}\n\nfunction isPlaceholderMarkdown(item: IPlaceholderMarkdownString | IMarkdownString | IChatResponseProgressFileTreeData): item is IPlaceholderMarkdownString {\n\treturn 'isPlaceholder' in item;\n}\n"]}