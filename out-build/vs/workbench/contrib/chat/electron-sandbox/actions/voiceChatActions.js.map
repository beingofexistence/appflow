{"version":3,"sources":["vs/workbench/contrib/chat/electron-sandbox/actions/voiceChatActions.ts"],"names":[],"mappings":"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","file":"voiceChatActions.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./media/voiceChatActions';\nimport { Event } from 'vs/base/common/event';\nimport { firstOrDefault } from 'vs/base/common/arrays';\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { Codicon } from 'vs/base/common/codicons';\nimport { DisposableStore, toDisposable } from 'vs/base/common/lifecycle';\nimport { equalsIgnoreCase } from 'vs/base/common/strings';\nimport { ServicesAccessor } from 'vs/editor/browser/editorExtensions';\nimport { localize } from 'vs/nls';\nimport { Action2, MenuId, registerAction2 } from 'vs/platform/actions/common/actions';\nimport { ContextKeyExpr, IContextKeyService, RawContextKey } from 'vs/platform/contextkey/common/contextkey';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { spinningLoading } from 'vs/platform/theme/common/iconRegistry';\nimport { CHAT_CATEGORY } from 'vs/workbench/contrib/chat/browser/actions/chatActions';\nimport { IChatWidget, IChatWidgetService, IQuickChatService } from 'vs/workbench/contrib/chat/browser/chat';\nimport { IChatService } from 'vs/workbench/contrib/chat/common/chatService';\nimport { IWorkbenchVoiceRecognitionService } from 'vs/workbench/services/voiceRecognition/electron-sandbox/workbenchVoiceRecognitionService';\nimport { MENU_INLINE_CHAT_WIDGET } from 'vs/workbench/contrib/inlineChat/common/inlineChat';\nimport { CONTEXT_PROVIDER_EXISTS } from 'vs/workbench/contrib/chat/common/chatContextKeys';\nimport { InlineChatController } from 'vs/workbench/contrib/inlineChat/browser/inlineChatController';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { getCodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { ICommandService } from 'vs/platform/commands/common/commands';\nimport { process } from 'vs/base/parts/sandbox/electron-sandbox/globals';\nimport product from 'vs/platform/product/common/product';\nimport { ActiveEditorContext } from 'vs/workbench/common/contextkeys';\nimport { IViewsService } from 'vs/workbench/common/views';\nimport { IChatContributionService } from 'vs/workbench/contrib/chat/common/chatContributionService';\nimport { KeybindingWeight } from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport { KeyCode } from 'vs/base/common/keyCodes';\nimport { isExecuteActionContext } from 'vs/workbench/contrib/chat/browser/actions/chatExecuteActions';\nimport { IWorkbenchLayoutService, Parts } from 'vs/workbench/services/layout/browser/layoutService';\n\nconst CONTEXT_VOICE_CHAT_GETTING_READY = new RawContextKey<boolean>('voiceChatGettingReady', false, { type: 'boolean', description: localize('voiceChatGettingReady', \"True when getting ready for receiving voice input from the microphone for voice chat.\") });\nconst CONTEXT_VOICE_CHAT_IN_PROGRESS = new RawContextKey<boolean>('voiceChatInProgress', false, { type: 'boolean', description: localize('voiceChatInProgress', \"True when voice recording from microphone is in progress for voice chat.\") });\n\nconst CONTEXT_QUICK_VOICE_CHAT_IN_PROGRESS = new RawContextKey<boolean>('quickVoiceChatInProgress', false, { type: 'boolean', description: localize('quickVoiceChatInProgress', \"True when voice recording from microphone is in progress for quick chat.\") });\nconst CONTEXT_INLINE_VOICE_CHAT_IN_PROGRESS = new RawContextKey<boolean>('inlineVoiceChatInProgress', false, { type: 'boolean', description: localize('inlineVoiceChatInProgress', \"True when voice recording from microphone is in progress for inline chat.\") });\nconst CONTEXT_VOICE_CHAT_IN_VIEW_IN_PROGRESS = new RawContextKey<boolean>('voiceChatInViewInProgress', false, { type: 'boolean', description: localize('voiceChatInViewInProgress', \"True when voice recording from microphone is in progress in the chat view.\") });\nconst CONTEXT_VOICE_CHAT_IN_EDITOR_IN_PROGRESS = new RawContextKey<boolean>('voiceChatInEditorInProgress', false, { type: 'boolean', description: localize('voiceChatInEditorInProgress', \"True when voice recording from microphone is in progress in the chat editor.\") });\n\ntype VoiceChatSessionContext = 'inline' | 'quick' | 'view' | 'editor';\n\ninterface IVoiceChatSessionController {\n\n\treadonly onDidAcceptInput: Event<unknown>;\n\treadonly onDidCancelInput: Event<unknown>;\n\n\treadonly context: VoiceChatSessionContext;\n\n\tfocusInput(): void;\n\tacceptInput(): void;\n\tupdateInput(text: string): void;\n}\n\nclass VoiceChatSessionControllerFactory {\n\n\tstatic create(accessor: ServicesAccessor, context: 'inline'): Promise<IVoiceChatSessionController | undefined>;\n\tstatic create(accessor: ServicesAccessor, context: 'quick'): Promise<IVoiceChatSessionController | undefined>;\n\tstatic create(accessor: ServicesAccessor, context: 'view'): Promise<IVoiceChatSessionController | undefined>;\n\tstatic create(accessor: ServicesAccessor, context: 'focussed'): Promise<IVoiceChatSessionController | undefined>;\n\tstatic async create(accessor: ServicesAccessor, context: 'inline' | 'quick' | 'view' | 'focussed'): Promise<IVoiceChatSessionController | undefined> {\n\t\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\t\tconst chatService = accessor.get(IChatService);\n\t\tconst viewsService = accessor.get(IViewsService);\n\t\tconst chatContributionService = accessor.get(IChatContributionService);\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst quickChatService = accessor.get(IQuickChatService);\n\t\tconst layoutService = accessor.get(IWorkbenchLayoutService);\n\n\t\t// Currently Focussed Context\n\t\tif (context === 'focussed') {\n\n\t\t\t// Try with the chat widget service, which currently\n\t\t\t// only supports the chat view and quick chat\n\t\t\t// https://github.com/microsoft/vscode/issues/191191\n\t\t\tconst chatInput = chatWidgetService.lastFocusedWidget;\n\t\t\tif (chatInput?.hasInputFocus()) {\n\t\t\t\t// Unfortunately there does not seem to be a better way\n\t\t\t\t// to figure out if the chat widget is in a part or picker\n\t\t\t\tif (\n\t\t\t\t\tlayoutService.hasFocus(Parts.SIDEBAR_PART) ||\n\t\t\t\t\tlayoutService.hasFocus(Parts.PANEL_PART) ||\n\t\t\t\t\tlayoutService.hasFocus(Parts.AUXILIARYBAR_PART)\n\t\t\t\t) {\n\t\t\t\t\treturn VoiceChatSessionControllerFactory.doCreateForChatView(chatInput, viewsService, chatContributionService);\n\t\t\t\t}\n\n\t\t\t\tif (layoutService.hasFocus(Parts.EDITOR_PART)) {\n\t\t\t\t\treturn VoiceChatSessionControllerFactory.doCreateForChatEditor(chatInput, viewsService, chatContributionService);\n\t\t\t\t}\n\n\t\t\t\treturn VoiceChatSessionControllerFactory.doCreateForQuickChat(chatInput, quickChatService);\n\t\t\t}\n\n\t\t\t// Try with the inline chat\n\t\t\tconst activeCodeEditor = getCodeEditor(editorService.activeTextEditorControl);\n\t\t\tif (activeCodeEditor) {\n\t\t\t\tconst inlineChat = InlineChatController.get(activeCodeEditor);\n\t\t\t\tif (inlineChat?.hasFocus()) {\n\t\t\t\t\treturn VoiceChatSessionControllerFactory.doCreateForInlineChat(inlineChat);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// View Chat\n\t\tif (context === 'view') {\n\t\t\tconst provider = firstOrDefault(chatService.getProviderInfos());\n\t\t\tif (provider) {\n\t\t\t\tconst chatView = await chatWidgetService.revealViewForProvider(provider.id);\n\t\t\t\tif (chatView) {\n\t\t\t\t\treturn VoiceChatSessionControllerFactory.doCreateForChatView(chatView, viewsService, chatContributionService);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Inline Chat\n\t\tif (context === 'inline') {\n\t\t\tconst activeCodeEditor = getCodeEditor(editorService.activeTextEditorControl);\n\t\t\tif (activeCodeEditor) {\n\t\t\t\tconst inlineChat = InlineChatController.get(activeCodeEditor);\n\t\t\t\tif (inlineChat) {\n\t\t\t\t\treturn VoiceChatSessionControllerFactory.doCreateForInlineChat(inlineChat);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Quick Chat\n\t\tif (context === 'quick') {\n\t\t\tquickChatService.open();\n\n\t\t\tconst quickChat = chatWidgetService.lastFocusedWidget;\n\t\t\tif (quickChat) {\n\t\t\t\treturn VoiceChatSessionControllerFactory.doCreateForQuickChat(quickChat, quickChatService);\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate static doCreateForChatView(chatView: IChatWidget, viewsService: IViewsService, chatContributionService: IChatContributionService): IVoiceChatSessionController {\n\t\treturn VoiceChatSessionControllerFactory.doCreateForChatViewOrEditor('view', chatView, viewsService, chatContributionService);\n\t}\n\n\tprivate static doCreateForChatEditor(chatView: IChatWidget, viewsService: IViewsService, chatContributionService: IChatContributionService): IVoiceChatSessionController {\n\t\treturn VoiceChatSessionControllerFactory.doCreateForChatViewOrEditor('editor', chatView, viewsService, chatContributionService);\n\t}\n\n\tprivate static doCreateForChatViewOrEditor(context: 'view' | 'editor', chatView: IChatWidget, viewsService: IViewsService, chatContributionService: IChatContributionService): IVoiceChatSessionController {\n\t\treturn {\n\t\t\tcontext,\n\t\t\tonDidAcceptInput: chatView.onDidAcceptInput,\n\t\t\t// TODO@bpasero cancellation needs to work better for chat editors that are not view bound\n\t\t\tonDidCancelInput: Event.filter(viewsService.onDidChangeViewVisibility, e => e.id === chatContributionService.getViewIdForProvider(chatView.providerId)),\n\t\t\tfocusInput: () => chatView.focusInput(),\n\t\t\tacceptInput: () => chatView.acceptInput(),\n\t\t\tupdateInput: text => chatView.updateInput(text)\n\t\t};\n\t}\n\n\tprivate static doCreateForQuickChat(quickChat: IChatWidget, quickChatService: IQuickChatService): IVoiceChatSessionController {\n\t\treturn {\n\t\t\tcontext: 'quick',\n\t\t\tonDidAcceptInput: quickChat.onDidAcceptInput,\n\t\t\tonDidCancelInput: quickChatService.onDidClose,\n\t\t\tfocusInput: () => quickChat.focusInput(),\n\t\t\tacceptInput: () => quickChat.acceptInput(),\n\t\t\tupdateInput: text => quickChat.updateInput(text)\n\t\t};\n\t}\n\n\tprivate static doCreateForInlineChat(inlineChat: InlineChatController,): IVoiceChatSessionController {\n\t\tconst inlineChatSession = inlineChat.run();\n\n\t\treturn {\n\t\t\tcontext: 'inline',\n\t\t\tonDidAcceptInput: inlineChat.onDidAcceptInput,\n\t\t\tonDidCancelInput: Event.any(\n\t\t\t\tinlineChat.onDidCancelInput,\n\t\t\t\tEvent.fromPromise(inlineChatSession)\n\t\t\t),\n\t\t\tfocusInput: () => inlineChat.focus(),\n\t\t\tacceptInput: () => inlineChat.acceptInput(),\n\t\t\tupdateInput: text => inlineChat.updateInput(text)\n\t\t};\n\t}\n}\n\ninterface ActiveVoiceChatSession {\n\treadonly controller: IVoiceChatSessionController;\n\treadonly disposables: DisposableStore;\n}\n\nclass VoiceChatSessions {\n\n\tprivate static instance: VoiceChatSessions | undefined = undefined;\n\tstatic getInstance(instantiationService: IInstantiationService): VoiceChatSessions {\n\t\tif (!VoiceChatSessions.instance) {\n\t\t\tVoiceChatSessions.instance = instantiationService.createInstance(VoiceChatSessions);\n\t\t}\n\n\t\treturn VoiceChatSessions.instance;\n\t}\n\n\tprivate voiceChatInProgressKey = CONTEXT_VOICE_CHAT_IN_PROGRESS.bindTo(this.contextKeyService);\n\tprivate voiceChatGettingReadyKey = CONTEXT_VOICE_CHAT_GETTING_READY.bindTo(this.contextKeyService);\n\n\tprivate quickVoiceChatInProgressKey = CONTEXT_QUICK_VOICE_CHAT_IN_PROGRESS.bindTo(this.contextKeyService);\n\tprivate inlineVoiceChatInProgressKey = CONTEXT_INLINE_VOICE_CHAT_IN_PROGRESS.bindTo(this.contextKeyService);\n\tprivate voiceChatInViewInProgressKey = CONTEXT_VOICE_CHAT_IN_VIEW_IN_PROGRESS.bindTo(this.contextKeyService);\n\tprivate voiceChatInEditorInProgressKey = CONTEXT_VOICE_CHAT_IN_EDITOR_IN_PROGRESS.bindTo(this.contextKeyService);\n\n\tprivate currentVoiceChatSession: ActiveVoiceChatSession | undefined = undefined;\n\tprivate voiceChatSessionIds = 0;\n\n\tconstructor(\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IWorkbenchVoiceRecognitionService private readonly voiceRecognitionService: IWorkbenchVoiceRecognitionService\n\t) { }\n\n\tasync start(controller: IVoiceChatSessionController): Promise<void> {\n\t\tthis.stop();\n\n\t\tconst voiceChatSessionId = ++this.voiceChatSessionIds;\n\t\tthis.currentVoiceChatSession = {\n\t\t\tcontroller,\n\t\t\tdisposables: new DisposableStore()\n\t\t};\n\n\t\tconst cts = new CancellationTokenSource();\n\t\tthis.currentVoiceChatSession.disposables.add(toDisposable(() => cts.dispose(true)));\n\n\t\tthis.currentVoiceChatSession.disposables.add(controller.onDidAcceptInput(() => this.stop(voiceChatSessionId, controller.context)));\n\t\tthis.currentVoiceChatSession.disposables.add(controller.onDidCancelInput(() => this.stop(voiceChatSessionId, controller.context)));\n\n\t\tcontroller.updateInput('');\n\t\tcontroller.focusInput();\n\n\t\tthis.voiceChatGettingReadyKey.set(true);\n\n\t\tconst onDidTranscribe = await this.voiceRecognitionService.transcribe(cts.token, {\n\t\t\tonDidCancel: () => this.stop(voiceChatSessionId, controller.context)\n\t\t});\n\n\t\tif (cts.token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.voiceChatGettingReadyKey.set(false);\n\t\tthis.voiceChatInProgressKey.set(true);\n\n\t\tswitch (controller.context) {\n\t\t\tcase 'inline':\n\t\t\t\tthis.inlineVoiceChatInProgressKey.set(true);\n\t\t\t\tbreak;\n\t\t\tcase 'quick':\n\t\t\t\tthis.quickVoiceChatInProgressKey.set(true);\n\t\t\t\tbreak;\n\t\t\tcase 'view':\n\t\t\t\tthis.voiceChatInViewInProgressKey.set(true);\n\t\t\t\tbreak;\n\t\t\tcase 'editor':\n\t\t\t\tthis.voiceChatInEditorInProgressKey.set(true);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.registerTranscriptionListener(this.currentVoiceChatSession, onDidTranscribe);\n\t}\n\n\tprivate registerTranscriptionListener(session: ActiveVoiceChatSession, onDidTranscribe: Event<string>) {\n\t\tlet lastText: string | undefined = undefined;\n\t\tlet lastTextSimilarCount = 0;\n\n\t\tsession.disposables.add(onDidTranscribe(text => {\n\t\t\tif (!text && lastText) {\n\t\t\t\ttext = lastText;\n\t\t\t}\n\n\t\t\tif (text) {\n\t\t\t\tif (lastText && this.isSimilarTranscription(text, lastText)) {\n\t\t\t\t\tlastTextSimilarCount++;\n\t\t\t\t} else {\n\t\t\t\t\tlastTextSimilarCount = 0;\n\t\t\t\t\tlastText = text;\n\t\t\t\t}\n\n\t\t\t\tif (lastTextSimilarCount >= 2) {\n\t\t\t\t\tsession.controller.acceptInput();\n\t\t\t\t} else {\n\t\t\t\t\tsession.controller.updateInput(text);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate isSimilarTranscription(textA: string, textB: string): boolean {\n\n\t\t// Attempt to compare the 2 strings in a way to see\n\t\t// if they are similar or not. As such we:\n\t\t// - ignore trailing punctuation\n\t\t// - collapse all whitespace\n\t\t// - compare case insensitive\n\n\t\treturn equalsIgnoreCase(\n\t\t\ttextA.replace(/[.,;:!?]+$/, '').replace(/\\s+/g, ''),\n\t\t\ttextB.replace(/[.,;:!?]+$/, '').replace(/\\s+/g, '')\n\t\t);\n\t}\n\n\tstop(voiceChatSessionId = this.voiceChatSessionIds, context?: VoiceChatSessionContext): void {\n\t\tif (\n\t\t\t!this.currentVoiceChatSession ||\n\t\t\tthis.voiceChatSessionIds !== voiceChatSessionId ||\n\t\t\t(context && this.currentVoiceChatSession.controller.context !== context)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentVoiceChatSession.disposables.dispose();\n\t\tthis.currentVoiceChatSession = undefined;\n\n\t\tthis.voiceChatGettingReadyKey.set(false);\n\t\tthis.voiceChatInProgressKey.set(false);\n\n\t\tthis.quickVoiceChatInProgressKey.set(false);\n\t\tthis.inlineVoiceChatInProgressKey.set(false);\n\t\tthis.voiceChatInViewInProgressKey.set(false);\n\t\tthis.voiceChatInEditorInProgressKey.set(false);\n\t}\n\n\taccept(voiceChatSessionId = this.voiceChatSessionIds): void {\n\t\tif (\n\t\t\t!this.currentVoiceChatSession ||\n\t\t\tthis.voiceChatSessionIds !== voiceChatSessionId\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentVoiceChatSession.controller.acceptInput();\n\t}\n}\n\nclass VoiceChatInChatViewAction extends Action2 {\n\n\tstatic readonly ID = 'workbench.action.chat.voiceChatInChatView';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: VoiceChatInChatViewAction.ID,\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('workbench.action.chat.voiceChatInView.label', \"Voice Chat in Chat View\"),\n\t\t\t\toriginal: 'Voice Chat in Chat View'\n\t\t\t},\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tprecondition: CONTEXT_PROVIDER_EXISTS,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\n\t\tconst controller = await VoiceChatSessionControllerFactory.create(accessor, 'view');\n\t\tif (controller) {\n\t\t\tVoiceChatSessions.getInstance(instantiationService).start(controller);\n\t\t}\n\t}\n}\n\nclass InlineVoiceChatAction extends Action2 {\n\n\tstatic readonly ID = 'workbench.action.chat.inlineVoiceChat';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: InlineVoiceChatAction.ID,\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('workbench.action.chat.inlineVoiceChat', \"Inline Voice Chat\"),\n\t\t\t\toriginal: 'Inline Voice Chat'\n\t\t\t},\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tprecondition: ContextKeyExpr.and(CONTEXT_PROVIDER_EXISTS, ActiveEditorContext),\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\n\t\tconst controller = await VoiceChatSessionControllerFactory.create(accessor, 'inline');\n\t\tif (controller) {\n\t\t\tVoiceChatSessions.getInstance(instantiationService).start(controller);\n\t\t}\n\t}\n}\n\nclass QuickVoiceChatAction extends Action2 {\n\n\tstatic readonly ID = 'workbench.action.chat.quickVoiceChat';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: QuickVoiceChatAction.ID,\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('workbench.action.chat.quickVoiceChat.label', \"Quick Voice Chat\"),\n\t\t\t\toriginal: 'Quick Voice Chat'\n\t\t\t},\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tprecondition: CONTEXT_PROVIDER_EXISTS,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\n\t\tconst controller = await VoiceChatSessionControllerFactory.create(accessor, 'quick');\n\t\tif (controller) {\n\t\t\tVoiceChatSessions.getInstance(instantiationService).start(controller);\n\t\t}\n\t}\n}\n\nclass StartVoiceChatAction extends Action2 {\n\n\tstatic readonly ID = 'workbench.action.chat.startVoiceChat';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: StartVoiceChatAction.ID,\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('workbench.action.chat.startVoiceChat', \"Start Voice Chat\"),\n\t\t\t\toriginal: 'Start Voice Chat'\n\t\t\t},\n\t\t\ticon: Codicon.mic,\n\t\t\tprecondition: CONTEXT_VOICE_CHAT_GETTING_READY.negate(),\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.ChatExecute,\n\t\t\t\twhen: ContextKeyExpr.and(CONTEXT_VOICE_CHAT_IN_VIEW_IN_PROGRESS.negate(), CONTEXT_QUICK_VOICE_CHAT_IN_PROGRESS.negate(), CONTEXT_VOICE_CHAT_IN_EDITOR_IN_PROGRESS.negate()),\n\t\t\t\tgroup: 'navigation',\n\t\t\t\torder: -1\n\t\t\t}, {\n\t\t\t\tid: MENU_INLINE_CHAT_WIDGET,\n\t\t\t\twhen: CONTEXT_INLINE_VOICE_CHAT_IN_PROGRESS.negate(),\n\t\t\t\tgroup: 'main',\n\t\t\t\torder: -1\n\t\t\t}]\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, context: unknown): Promise<void> {\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\tconst commandService = accessor.get(ICommandService);\n\n\t\tif (isExecuteActionContext(context)) {\n\t\t\t// if we already get a context when the action is executed\n\t\t\t// from a toolbar within the chat widget, then make sure\n\t\t\t// to move focus into the input field so that the controller\n\t\t\t// is properly retrieved\n\t\t\t// TODO@bpasero this will actually not work if the button\n\t\t\t// is clicked from the inline editor while focus is in a\n\t\t\t// chat input field in a view or picker\n\t\t\tcontext.widget.focusInput();\n\t\t}\n\n\t\tconst controller = await VoiceChatSessionControllerFactory.create(accessor, 'focussed');\n\t\tif (controller) {\n\t\t\tVoiceChatSessions.getInstance(instantiationService).start(controller);\n\t\t} else {\n\t\t\t// fallback to Quick Voice Chat command\n\t\t\tcommandService.executeCommand(QuickVoiceChatAction.ID);\n\t\t}\n\t}\n}\n\nclass StopVoiceChatAction extends Action2 {\n\n\tstatic readonly ID = 'workbench.action.chat.stopVoiceChat';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: StopVoiceChatAction.ID,\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('workbench.action.chat.stopVoiceChat.label', \"Stop Voice Chat\"),\n\t\t\t\toriginal: 'Stop Voice Chat'\n\t\t\t},\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tf1: true,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib + 100,\n\t\t\t\twhen: CONTEXT_VOICE_CHAT_IN_PROGRESS,\n\t\t\t\tprimary: KeyCode.Escape\n\t\t\t},\n\t\t\tprecondition: CONTEXT_VOICE_CHAT_IN_PROGRESS\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor): void {\n\t\tVoiceChatSessions.getInstance(accessor.get(IInstantiationService)).stop();\n\t}\n}\n\nclass StopVoiceChatInChatViewAction extends Action2 {\n\n\tstatic readonly ID = 'workbench.action.chat.stopVoiceChatInChatView';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: StopVoiceChatInChatViewAction.ID,\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('workbench.action.chat.stopVoiceChatInChatView.label', \"Stop Voice Chat (Chat View)\"),\n\t\t\t\toriginal: 'Stop Voice Chat (Chat View)'\n\t\t\t},\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib + 100,\n\t\t\t\twhen: CONTEXT_VOICE_CHAT_IN_VIEW_IN_PROGRESS,\n\t\t\t\tprimary: KeyCode.Escape\n\t\t\t},\n\t\t\tprecondition: CONTEXT_VOICE_CHAT_IN_VIEW_IN_PROGRESS,\n\t\t\ticon: spinningLoading,\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.ChatExecute,\n\t\t\t\twhen: CONTEXT_VOICE_CHAT_IN_VIEW_IN_PROGRESS,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\torder: -1\n\t\t\t}]\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor): void {\n\t\tVoiceChatSessions.getInstance(accessor.get(IInstantiationService)).stop(undefined, 'view');\n\t}\n}\n\nclass StopVoiceChatInChatEditorAction extends Action2 {\n\n\tstatic readonly ID = 'workbench.action.chat.stopVoiceChatInChatEditor';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: StopVoiceChatInChatEditorAction.ID,\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('workbench.action.chat.stopVoiceChatInChatEditor.label', \"Stop Voice Chat (Chat Editor)\"),\n\t\t\t\toriginal: 'Stop Voice Chat (Chat Editor)'\n\t\t\t},\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib + 100,\n\t\t\t\twhen: CONTEXT_VOICE_CHAT_IN_EDITOR_IN_PROGRESS,\n\t\t\t\tprimary: KeyCode.Escape\n\t\t\t},\n\t\t\tprecondition: CONTEXT_VOICE_CHAT_IN_EDITOR_IN_PROGRESS,\n\t\t\ticon: spinningLoading,\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.ChatExecute,\n\t\t\t\twhen: CONTEXT_VOICE_CHAT_IN_EDITOR_IN_PROGRESS,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\torder: -1\n\t\t\t}]\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor): void {\n\t\tVoiceChatSessions.getInstance(accessor.get(IInstantiationService)).stop(undefined, 'editor');\n\t}\n}\n\nclass StopQuickVoiceChatAction extends Action2 {\n\n\tstatic readonly ID = 'workbench.action.chat.stopQuickVoiceChat';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: StopQuickVoiceChatAction.ID,\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('workbench.action.chat.stopQuickVoiceChat.label', \"Stop Voice Chat (Quick Chat)\"),\n\t\t\t\toriginal: 'Stop Voice Chat (Quick Chat)'\n\t\t\t},\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib + 100,\n\t\t\t\twhen: CONTEXT_QUICK_VOICE_CHAT_IN_PROGRESS,\n\t\t\t\tprimary: KeyCode.Escape\n\t\t\t},\n\t\t\tprecondition: CONTEXT_QUICK_VOICE_CHAT_IN_PROGRESS,\n\t\t\ticon: spinningLoading,\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.ChatExecute,\n\t\t\t\twhen: CONTEXT_QUICK_VOICE_CHAT_IN_PROGRESS,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\torder: -1\n\t\t\t}]\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor): void {\n\t\tVoiceChatSessions.getInstance(accessor.get(IInstantiationService)).stop(undefined, 'quick');\n\t}\n}\n\nclass StopInlineVoiceChatAction extends Action2 {\n\n\tstatic readonly ID = 'workbench.action.chat.stopInlineVoiceChat';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: StopInlineVoiceChatAction.ID,\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('workbench.action.chat.stopInlineVoiceChat.label', \"Stop Voice Chat (Inline Editor)\"),\n\t\t\t\toriginal: 'Stop Voice Chat (Inline Editor)'\n\t\t\t},\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib + 100,\n\t\t\t\twhen: CONTEXT_INLINE_VOICE_CHAT_IN_PROGRESS,\n\t\t\t\tprimary: KeyCode.Escape\n\t\t\t},\n\t\t\tprecondition: CONTEXT_INLINE_VOICE_CHAT_IN_PROGRESS,\n\t\t\ticon: spinningLoading,\n\t\t\tmenu: [{\n\t\t\t\tid: MENU_INLINE_CHAT_WIDGET,\n\t\t\t\twhen: CONTEXT_INLINE_VOICE_CHAT_IN_PROGRESS,\n\t\t\t\tgroup: 'main',\n\t\t\t\torder: -1\n\t\t\t}]\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor): void {\n\t\tVoiceChatSessions.getInstance(accessor.get(IInstantiationService)).stop(undefined, 'inline');\n\t}\n}\n\nclass StopVoiceChatAndSubmitAction extends Action2 {\n\n\tstatic readonly ID = 'workbench.action.chat.stopVoiceChatAndSubmit';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: StopVoiceChatAndSubmitAction.ID,\n\t\t\ttitle: {\n\t\t\t\tvalue: localize('workbench.action.chat.stopAndAcceptVoiceChat.label', \"Stop Voice Chat and Submit\"),\n\t\t\t\toriginal: 'Stop Voice Chat and Submit'\n\t\t\t},\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tf1: true,\n\t\t\tprecondition: CONTEXT_VOICE_CHAT_IN_PROGRESS\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor): void {\n\t\tVoiceChatSessions.getInstance(accessor.get(IInstantiationService)).accept();\n\t}\n}\n\nexport function registerVoiceChatActions() {\n\tif (typeof process.env.VSCODE_VOICE_MODULE_PATH === 'string' && product.quality !== 'stable') { // TODO@bpasero package\n\t\tregisterAction2(VoiceChatInChatViewAction);\n\t\tregisterAction2(QuickVoiceChatAction);\n\t\tregisterAction2(InlineVoiceChatAction);\n\n\t\tregisterAction2(StartVoiceChatAction);\n\t\tregisterAction2(StopVoiceChatAction);\n\t\tregisterAction2(StopVoiceChatAndSubmitAction);\n\n\t\tregisterAction2(StopVoiceChatInChatViewAction);\n\t\tregisterAction2(StopVoiceChatInChatEditorAction);\n\t\tregisterAction2(StopQuickVoiceChatAction);\n\t\tregisterAction2(StopInlineVoiceChatAction);\n\t}\n}\n"]}