{"version":3,"sources":["vs/workbench/contrib/deprecatedExtensionMigrator/browser/deprecatedExtensionMigrator.contribution.ts"],"names":[],"mappings":"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","file":"deprecatedExtensionMigrator.contribution.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Action } from 'vs/base/common/actions';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { isDefined } from 'vs/base/common/types';\nimport { localize } from 'vs/nls';\nimport { ConfigurationTarget, IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { INotificationService, Severity } from 'vs/platform/notification/common/notification';\nimport { IOpenerService } from 'vs/platform/opener/common/opener';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { IStorageService, StorageScope, StorageTarget } from 'vs/platform/storage/common/storage';\nimport { Extensions as WorkbenchExtensions, IWorkbenchContributionsRegistry } from 'vs/workbench/common/contributions';\nimport { IExtensionsWorkbenchService } from 'vs/workbench/contrib/extensions/common/extensions';\nimport { EnablementState } from 'vs/workbench/services/extensionManagement/common/extensionManagement';\nimport { LifecyclePhase } from 'vs/workbench/services/lifecycle/common/lifecycle';\n\nclass DeprecatedExtensionMigratorContribution {\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IExtensionsWorkbenchService private readonly extensionsWorkbenchService: IExtensionsWorkbenchService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IOpenerService private readonly openerService: IOpenerService\n\t) {\n\t\tthis.init().catch(onUnexpectedError);\n\t}\n\n\tprivate async init(): Promise<void> {\n\t\tconst bracketPairColorizerId = 'coenraads.bracket-pair-colorizer';\n\n\t\tawait this.extensionsWorkbenchService.queryLocal();\n\t\tconst extension = this.extensionsWorkbenchService.installed.find(e => e.identifier.id === bracketPairColorizerId);\n\t\tif (\n\t\t\t!extension ||\n\t\t\t((extension.enablementState !== EnablementState.EnabledGlobally) &&\n\t\t\t\t(extension.enablementState !== EnablementState.EnabledWorkspace))\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst state = await this.getState();\n\t\tconst disablementLogEntry = state.disablementLog.some(d => d.extensionId === bracketPairColorizerId);\n\n\t\tif (disablementLogEntry) {\n\t\t\treturn;\n\t\t}\n\n\t\tstate.disablementLog.push({ extensionId: bracketPairColorizerId, disablementDateTime: new Date().getTime() });\n\t\tawait this.setState(state);\n\n\t\tawait this.extensionsWorkbenchService.setEnablement(extension, EnablementState.DisabledGlobally);\n\n\t\tconst nativeBracketPairColorizationEnabledKey = 'editor.bracketPairColorization.enabled';\n\t\tconst bracketPairColorizationEnabled = !!this.configurationService.inspect(nativeBracketPairColorizationEnabledKey).user;\n\n\t\tthis.notificationService.notify({\n\t\t\tmessage: localize('bracketPairColorizer.notification', \"The extension 'Bracket pair Colorizer' got disabled because it was deprecated.\"),\n\t\t\tseverity: Severity.Info,\n\t\t\tactions: {\n\t\t\t\tprimary: [\n\t\t\t\t\tnew Action('', localize('bracketPairColorizer.notification.action.uninstall', \"Uninstall Extension\"), undefined, undefined, () => {\n\t\t\t\t\t\tthis.extensionsWorkbenchService.uninstall(extension);\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tsecondary: [\n\t\t\t\t\t!bracketPairColorizationEnabled ? new Action('', localize('bracketPairColorizer.notification.action.enableNative', \"Enable Native Bracket Pair Colorization\"), undefined, undefined, () => {\n\t\t\t\t\t\tthis.configurationService.updateValue(nativeBracketPairColorizationEnabledKey, true, ConfigurationTarget.USER);\n\t\t\t\t\t}) : undefined,\n\t\t\t\t\tnew Action('', localize('bracketPairColorizer.notification.action.showMoreInfo', \"More Info\"), undefined, undefined, () => {\n\t\t\t\t\t\tthis.openerService.open('https://github.com/microsoft/vscode/issues/155179');\n\t\t\t\t\t}),\n\t\t\t\t].filter(isDefined),\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate readonly storageKey = 'deprecatedExtensionMigrator.state';\n\n\tprivate async getState(): Promise<State> {\n\t\tconst jsonStr = await this.storageService.get(this.storageKey, StorageScope.APPLICATION, '');\n\t\tif (jsonStr === '') {\n\t\t\treturn { disablementLog: [] };\n\t\t}\n\t\treturn JSON.parse(jsonStr) as State;\n\t}\n\n\tprivate async setState(state: State): Promise<void> {\n\t\tconst json = JSON.stringify(state);\n\t\tawait this.storageService.store(this.storageKey, json, StorageScope.APPLICATION, StorageTarget.USER);\n\t}\n}\n\ninterface State {\n\tdisablementLog: {\n\t\textensionId: string;\n\t\tdisablementDateTime: number;\n\t}[];\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(DeprecatedExtensionMigratorContribution, LifecyclePhase.Restored);\n"]}