{"version":3,"sources":["vs/workbench/contrib/update/browser/releaseNotesEditor.ts"],"names":[],"mappings":"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","file":"releaseNotesEditor.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./media/releasenoteseditor';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { escapeMarkdownSyntaxTokens } from 'vs/base/common/htmlContent';\nimport { KeybindingParser } from 'vs/base/common/keybindingParser';\nimport { escape } from 'vs/base/common/strings';\nimport { URI } from 'vs/base/common/uri';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { TokenizationRegistry } from 'vs/editor/common/languages';\nimport { generateTokensCSSForColorMap } from 'vs/editor/common/languages/supports/tokenization';\nimport { ILanguageService } from 'vs/editor/common/languages/language';\nimport * as nls from 'vs/nls';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { IOpenerService } from 'vs/platform/opener/common/opener';\nimport { IProductService } from 'vs/platform/product/common/productService';\nimport { asTextOrError, IRequestService } from 'vs/platform/request/common/request';\nimport { DEFAULT_MARKDOWN_STYLES, renderMarkdownDocument } from 'vs/workbench/contrib/markdown/browser/markdownDocumentRenderer';\nimport { WebviewInput } from 'vs/workbench/contrib/webviewPanel/browser/webviewEditorInput';\nimport { IWebviewWorkbenchService } from 'vs/workbench/contrib/webviewPanel/browser/webviewWorkbenchService';\nimport { IEditorGroupsService } from 'vs/workbench/services/editor/common/editorGroupsService';\nimport { ACTIVE_GROUP, IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { IExtensionService } from 'vs/workbench/services/extensions/common/extensions';\nimport { getTelemetryLevel, supportsTelemetry } from 'vs/platform/telemetry/common/telemetryUtils';\nimport { IConfigurationChangeEvent, IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { TelemetryLevel } from 'vs/platform/telemetry/common/telemetry';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\n\nexport class ReleaseNotesManager {\n\n\tprivate readonly _releaseNotesCache = new Map<string, Promise<string>>();\n\n\tprivate _currentReleaseNotes: WebviewInput | undefined = undefined;\n\tprivate _lastText: string | undefined;\n\tprivate readonly disposables = new DisposableStore();\n\n\tpublic constructor(\n\t\t@IEnvironmentService private readonly _environmentService: IEnvironmentService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t\t@IRequestService private readonly _requestService: IRequestService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IEditorGroupsService private readonly _editorGroupService: IEditorGroupsService,\n\t\t@IWebviewWorkbenchService private readonly _webviewWorkbenchService: IWebviewWorkbenchService,\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@IProductService private readonly _productService: IProductService\n\t) {\n\t\tTokenizationRegistry.onDidChange(async () => {\n\t\t\tif (!this._currentReleaseNotes || !this._lastText) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst html = await this.renderBody(this._lastText);\n\t\t\tif (this._currentReleaseNotes) {\n\t\t\t\tthis._currentReleaseNotes.webview.setHtml(html);\n\t\t\t}\n\t\t});\n\n\t\t_configurationService.onDidChangeConfiguration(this.onDidChangeConfiguration, this, this.disposables);\n\t\t_webviewWorkbenchService.onDidChangeActiveWebviewEditor(this.onDidChangeActiveWebviewEditor, this, this.disposables);\n\t}\n\n\tpublic async show(version: string): Promise<boolean> {\n\t\tconst releaseNoteText = await this.loadReleaseNotes(version);\n\t\tthis._lastText = releaseNoteText;\n\t\tconst html = await this.renderBody(releaseNoteText);\n\t\tconst title = nls.localize('releaseNotesInputName', \"Release Notes: {0}\", version);\n\n\t\tconst activeEditorPane = this._editorService.activeEditorPane;\n\t\tif (this._currentReleaseNotes) {\n\t\t\tthis._currentReleaseNotes.setName(title);\n\t\t\tthis._currentReleaseNotes.webview.setHtml(html);\n\t\t\tthis._webviewWorkbenchService.revealWebview(this._currentReleaseNotes, activeEditorPane ? activeEditorPane.group : this._editorGroupService.activeGroup, false);\n\t\t} else {\n\t\t\tthis._currentReleaseNotes = this._webviewWorkbenchService.openWebview(\n\t\t\t\t{\n\t\t\t\t\ttitle,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\ttryRestoreScrollPosition: true,\n\t\t\t\t\t\tenableFindWidget: true,\n\t\t\t\t\t\tdisableServiceWorker: true,\n\t\t\t\t\t},\n\t\t\t\t\tcontentOptions: {\n\t\t\t\t\t\tlocalResourceRoots: [],\n\t\t\t\t\t\tallowScripts: true\n\t\t\t\t\t},\n\t\t\t\t\textension: undefined\n\t\t\t\t},\n\t\t\t\t'releaseNotes',\n\t\t\t\ttitle,\n\t\t\t\t{ group: ACTIVE_GROUP, preserveFocus: false });\n\n\t\t\tthis._currentReleaseNotes.webview.onDidClickLink(uri => this.onDidClickLink(URI.parse(uri)));\n\n\t\t\tconst disposables = new DisposableStore();\n\t\t\tdisposables.add(this._currentReleaseNotes.webview.onMessage(e => {\n\t\t\t\tif (e.message.type === 'showReleaseNotes') {\n\t\t\t\t\tthis._configurationService.updateValue('update.showReleaseNotes', e.message.value);\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tdisposables.add(this._currentReleaseNotes.onWillDispose(() => {\n\t\t\t\tdisposables.dispose();\n\t\t\t\tthis._currentReleaseNotes = undefined;\n\t\t\t}));\n\n\t\t\tthis._currentReleaseNotes.webview.setHtml(html);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate async loadReleaseNotes(version: string): Promise<string> {\n\t\tconst match = /^(\\d+\\.\\d+)\\./.exec(version);\n\t\tif (!match) {\n\t\t\tthrow new Error('not found');\n\t\t}\n\n\t\tconst versionLabel = match[1].replace(/\\./g, '_');\n\t\tconst baseUrl = 'https://code.visualstudio.com/raw';\n\t\tconst url = `${baseUrl}/v${versionLabel}.md`;\n\t\tconst unassigned = nls.localize('unassigned', \"unassigned\");\n\n\t\tconst escapeMdHtml = (text: string): string => {\n\t\t\treturn escape(text).replace(/\\\\/g, '\\\\\\\\');\n\t\t};\n\n\t\tconst patchKeybindings = (text: string): string => {\n\t\t\tconst kb = (match: string, kb: string) => {\n\t\t\t\tconst keybinding = this._keybindingService.lookupKeybinding(kb);\n\n\t\t\t\tif (!keybinding) {\n\t\t\t\t\treturn unassigned;\n\t\t\t\t}\n\n\t\t\t\treturn keybinding.getLabel() || unassigned;\n\t\t\t};\n\n\t\t\tconst kbstyle = (match: string, kb: string) => {\n\t\t\t\tconst keybinding = KeybindingParser.parseKeybinding(kb);\n\n\t\t\t\tif (!keybinding) {\n\t\t\t\t\treturn unassigned;\n\t\t\t\t}\n\n\t\t\t\tconst resolvedKeybindings = this._keybindingService.resolveKeybinding(keybinding);\n\n\t\t\t\tif (resolvedKeybindings.length === 0) {\n\t\t\t\t\treturn unassigned;\n\t\t\t\t}\n\n\t\t\t\treturn resolvedKeybindings[0].getLabel() || unassigned;\n\t\t\t};\n\n\t\t\tconst kbCode = (match: string, binding: string) => {\n\t\t\t\tconst resolved = kb(match, binding);\n\t\t\t\treturn resolved ? `<code title=\"${binding}\">${escapeMdHtml(resolved)}</code>` : resolved;\n\t\t\t};\n\n\t\t\tconst kbstyleCode = (match: string, binding: string) => {\n\t\t\t\tconst resolved = kbstyle(match, binding);\n\t\t\t\treturn resolved ? `<code title=\"${binding}\">${escapeMdHtml(resolved)}</code>` : resolved;\n\t\t\t};\n\n\t\t\treturn text\n\t\t\t\t.replace(/`kb\\(([a-z.\\d\\-]+)\\)`/gi, kbCode)\n\t\t\t\t.replace(/`kbstyle\\(([^\\)]+)\\)`/gi, kbstyleCode)\n\t\t\t\t.replace(/kb\\(([a-z.\\d\\-]+)\\)/gi, (match, binding) => escapeMarkdownSyntaxTokens(kb(match, binding)))\n\t\t\t\t.replace(/kbstyle\\(([^\\)]+)\\)/gi, (match, binding) => escapeMarkdownSyntaxTokens(kbstyle(match, binding)));\n\t\t};\n\n\t\tconst fetchReleaseNotes = async () => {\n\t\t\tlet text;\n\t\t\ttry {\n\t\t\t\ttext = await asTextOrError(await this._requestService.request({ url }, CancellationToken.None));\n\t\t\t} catch {\n\t\t\t\tthrow new Error('Failed to fetch release notes');\n\t\t\t}\n\n\t\t\tif (!text || !/^#\\s/.test(text)) { // release notes always starts with `#` followed by whitespace\n\t\t\t\tthrow new Error('Invalid release notes');\n\t\t\t}\n\n\t\t\treturn patchKeybindings(text);\n\t\t};\n\n\t\tif (!this._releaseNotesCache.has(version)) {\n\t\t\tthis._releaseNotesCache.set(version, (async () => {\n\t\t\t\ttry {\n\t\t\t\t\treturn await fetchReleaseNotes();\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthis._releaseNotesCache.delete(version);\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t})());\n\t\t}\n\n\t\treturn this._releaseNotesCache.get(version)!;\n\t}\n\n\tprivate onDidClickLink(uri: URI) {\n\t\tthis.addGAParameters(uri, 'ReleaseNotes')\n\t\t\t.then(updated => this._openerService.open(updated))\n\t\t\t.then(undefined, onUnexpectedError);\n\t}\n\n\tprivate async addGAParameters(uri: URI, origin: string, experiment = '1'): Promise<URI> {\n\t\tif (supportsTelemetry(this._productService, this._environmentService) && getTelemetryLevel(this._configurationService) === TelemetryLevel.USAGE) {\n\t\t\tif (uri.scheme === 'https' && uri.authority === 'code.visualstudio.com') {\n\t\t\t\treturn uri.with({ query: `${uri.query ? uri.query + '&' : ''}utm_source=VsCode&utm_medium=${encodeURIComponent(origin)}&utm_content=${encodeURIComponent(experiment)}` });\n\t\t\t}\n\t\t}\n\t\treturn uri;\n\t}\n\n\tprivate async renderBody(text: string) {\n\t\tconst nonce = generateUuid();\n\t\tconst content = await renderMarkdownDocument(text, this._extensionService, this._languageService, false);\n\t\tconst colorMap = TokenizationRegistry.getColorMap();\n\t\tconst css = colorMap ? generateTokensCSSForColorMap(colorMap) : '';\n\t\tconst showReleaseNotes = Boolean(this._configurationService.getValue<boolean>('update.showReleaseNotes'));\n\n\t\treturn `<!DOCTYPE html>\n\t\t<html>\n\t\t\t<head>\n\t\t\t\t<base href=\"https://code.visualstudio.com/raw/\">\n\t\t\t\t<meta http-equiv=\"Content-type\" content=\"text/html;charset=UTF-8\">\n\t\t\t\t<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; img-src https: data:; media-src https:; style-src 'nonce-${nonce}' https://code.visualstudio.com; script-src 'nonce-${nonce}';\">\n\t\t\t\t<style nonce=\"${nonce}\">\n\t\t\t\t\t${DEFAULT_MARKDOWN_STYLES}\n\t\t\t\t\t${css}\n\t\t\t\t\theader { display: flex; align-items: center; padding-top: 1em; }\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t\t${content}\n\t\t\t\t<script nonce=\"${nonce}\">\n\t\t\t\t\tconst vscode = acquireVsCodeApi();\n\t\t\t\t\tconst container = document.createElement('p');\n\t\t\t\t\tcontainer.style.display = 'flex';\n\t\t\t\t\tcontainer.style.alignItems = 'center';\n\n\t\t\t\t\tconst input = document.createElement('input');\n\t\t\t\t\tinput.type = 'checkbox';\n\t\t\t\t\tinput.id = 'showReleaseNotes';\n\t\t\t\t\tinput.checked = ${showReleaseNotes};\n\t\t\t\t\tcontainer.appendChild(input);\n\n\t\t\t\t\tconst label = document.createElement('label');\n\t\t\t\t\tlabel.htmlFor = 'showReleaseNotes';\n\t\t\t\t\tlabel.textContent = '${nls.localize('showOnUpdate', \"Show release notes after an update\")}';\n\t\t\t\t\tcontainer.appendChild(label);\n\n\t\t\t\t\tconst beforeElement = document.querySelector(\"body > h1\")?.nextElementSibling;\n\t\t\t\t\tif (beforeElement) {\n\t\t\t\t\t\tdocument.body.insertBefore(container, beforeElement);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdocument.body.appendChild(container);\n\t\t\t\t\t}\n\n\t\t\t\t\twindow.addEventListener('message', event => {\n\t\t\t\t\t\tif (event.data.type === 'showReleaseNotes') {\n\t\t\t\t\t\t\tinput.checked = event.data.value;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tinput.addEventListener('change', event => {\n\t\t\t\t\t\tvscode.postMessage({ type: 'showReleaseNotes', value: input.checked }, '*');\n\t\t\t\t\t});\n\t\t\t\t</script>\n\t\t\t</body>\n\t\t</html>`;\n\t}\n\n\tprivate onDidChangeConfiguration(e: IConfigurationChangeEvent): void {\n\t\tif (e.affectsConfiguration('update.showReleaseNotes')) {\n\t\t\tthis.updateWebview();\n\t\t}\n\t}\n\n\tprivate onDidChangeActiveWebviewEditor(input: WebviewInput | undefined): void {\n\t\tif (input && input === this._currentReleaseNotes) {\n\t\t\tthis.updateWebview();\n\t\t}\n\t}\n\n\tprivate updateWebview() {\n\t\tif (this._currentReleaseNotes) {\n\t\t\tthis._currentReleaseNotes.webview.postMessage({\n\t\t\t\ttype: 'showReleaseNotes',\n\t\t\t\tvalue: this._configurationService.getValue<boolean>('update.showReleaseNotes')\n\t\t\t});\n\t\t}\n\t}\n}\n"]}