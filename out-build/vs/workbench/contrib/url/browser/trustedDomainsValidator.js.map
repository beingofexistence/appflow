{"version":3,"sources":["vs/workbench/contrib/url/browser/trustedDomainsValidator.ts"],"names":[],"mappings":"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","file":"trustedDomainsValidator.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Schemas } from 'vs/base/common/network';\nimport Severity from 'vs/base/common/severity';\nimport { URI } from 'vs/base/common/uri';\nimport { localize } from 'vs/nls';\nimport { IDialogService } from 'vs/platform/dialogs/common/dialogs';\nimport { IOpenerService, matchesScheme, OpenOptions } from 'vs/platform/opener/common/opener';\nimport { IProductService } from 'vs/platform/product/common/productService';\nimport { IQuickInputService } from 'vs/platform/quickinput/common/quickInput';\nimport { IStorageService } from 'vs/platform/storage/common/storage';\nimport { IWorkbenchContribution } from 'vs/workbench/common/contributions';\nimport { configureOpenerTrustedDomainsHandler, readAuthenticationTrustedDomains, readStaticTrustedDomains, readWorkspaceTrustedDomains } from 'vs/workbench/contrib/url/browser/trustedDomains';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { IClipboardService } from 'vs/platform/clipboard/common/clipboardService';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IdleValue } from 'vs/base/common/async';\nimport { IAuthenticationService } from 'vs/workbench/services/authentication/common/authentication';\nimport { IWorkspaceContextService } from 'vs/platform/workspace/common/workspace';\nimport { testUrlMatchesGlob } from 'vs/workbench/contrib/url/common/urlGlob';\nimport { IWorkspaceTrustManagementService } from 'vs/platform/workspace/common/workspaceTrust';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\n\nexport class OpenerValidatorContributions implements IWorkbenchContribution {\n\n\tprivate _readWorkspaceTrustedDomainsResult: IdleValue<Promise<string[]>>;\n\tprivate _readAuthenticationTrustedDomainsResult: IdleValue<Promise<string[]>>;\n\n\tconstructor(\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@IDialogService private readonly _dialogService: IDialogService,\n\t\t@IProductService private readonly _productService: IProductService,\n\t\t@IQuickInputService private readonly _quickInputService: IQuickInputService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IClipboardService private readonly _clipboardService: IClipboardService,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IAuthenticationService private readonly _authenticationService: IAuthenticationService,\n\t\t@IWorkspaceContextService private readonly _workspaceContextService: IWorkspaceContextService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IWorkspaceTrustManagementService private readonly _workspaceTrustService: IWorkspaceTrustManagementService,\n\t) {\n\t\tthis._openerService.registerValidator({ shouldOpen: (uri, options) => this.validateLink(uri, options) });\n\n\t\tthis._readAuthenticationTrustedDomainsResult = new IdleValue(() =>\n\t\t\tthis._instantiationService.invokeFunction(readAuthenticationTrustedDomains));\n\t\tthis._authenticationService.onDidRegisterAuthenticationProvider(() => {\n\t\t\tthis._readAuthenticationTrustedDomainsResult?.dispose();\n\t\t\tthis._readAuthenticationTrustedDomainsResult = new IdleValue(() =>\n\t\t\t\tthis._instantiationService.invokeFunction(readAuthenticationTrustedDomains));\n\t\t});\n\n\t\tthis._readWorkspaceTrustedDomainsResult = new IdleValue(() =>\n\t\t\tthis._instantiationService.invokeFunction(readWorkspaceTrustedDomains));\n\t\tthis._workspaceContextService.onDidChangeWorkspaceFolders(() => {\n\t\t\tthis._readWorkspaceTrustedDomainsResult?.dispose();\n\t\t\tthis._readWorkspaceTrustedDomainsResult = new IdleValue(() =>\n\t\t\t\tthis._instantiationService.invokeFunction(readWorkspaceTrustedDomains));\n\t\t});\n\t}\n\n\tasync validateLink(resource: URI | string, openOptions?: OpenOptions): Promise<boolean> {\n\t\tif (!matchesScheme(resource, Schemas.http) && !matchesScheme(resource, Schemas.https)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (openOptions?.fromWorkspace && this._workspaceTrustService.isWorkspaceTrusted() && !this._configurationService.getValue('workbench.trustedDomains.promptInTrustedWorkspace')) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst originalResource = resource;\n\t\tlet resourceUri: URI;\n\t\tif (typeof resource === 'string') {\n\t\t\tresourceUri = URI.parse(resource);\n\t\t} else {\n\t\t\tresourceUri = resource;\n\t\t}\n\t\tconst { scheme, authority, path, query, fragment } = resourceUri;\n\n\t\tconst domainToOpen = `${scheme}://${authority}`;\n\t\tconst [workspaceDomains, userDomains] = await Promise.all([this._readWorkspaceTrustedDomainsResult.value, this._readAuthenticationTrustedDomainsResult.value]);\n\t\tconst { defaultTrustedDomains, trustedDomains, } = this._instantiationService.invokeFunction(readStaticTrustedDomains);\n\t\tconst allTrustedDomains = [...defaultTrustedDomains, ...trustedDomains, ...userDomains, ...workspaceDomains];\n\n\t\tif (isURLDomainTrusted(resourceUri, allTrustedDomains)) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\tlet formattedLink = `${scheme}://${authority}${path}`;\n\n\t\t\tconst linkTail = `${query ? '?' + query : ''}${fragment ? '#' + fragment : ''}`;\n\n\n\t\t\tconst remainingLength = Math.max(0, 60 - formattedLink.length);\n\t\t\tconst linkTailLengthToKeep = Math.min(Math.max(5, remainingLength), linkTail.length);\n\n\t\t\tif (linkTailLengthToKeep === linkTail.length) {\n\t\t\t\tformattedLink += linkTail;\n\t\t\t} else {\n\t\t\t\t// keep the first char ? or #\n\t\t\t\t// add ... and keep the tail end as much as possible\n\t\t\t\tformattedLink += linkTail.charAt(0) + '...' + linkTail.substring(linkTail.length - linkTailLengthToKeep + 1);\n\t\t\t}\n\n\t\t\tconst { result } = await this._dialogService.prompt<boolean>({\n\t\t\t\ttype: Severity.Info,\n\t\t\t\tmessage: localize(\n\t\t\t\t\t'openExternalLinkAt',\n\t\t\t\t\t'Do you want {0} to open the external website?',\n\t\t\t\t\tthis._productService.nameShort\n\t\t\t\t),\n\t\t\t\tdetail: typeof originalResource === 'string' ? originalResource : formattedLink,\n\t\t\t\tbuttons: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: localize({ key: 'open', comment: ['&& denotes a mnemonic'] }, '&&Open'),\n\t\t\t\t\t\trun: () => true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: localize({ key: 'copy', comment: ['&& denotes a mnemonic'] }, '&&Copy'),\n\t\t\t\t\t\trun: () => {\n\t\t\t\t\t\t\tthis._clipboardService.writeText(typeof originalResource === 'string' ? originalResource : resourceUri.toString(true));\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: localize({ key: 'configureTrustedDomains', comment: ['&& denotes a mnemonic'] }, 'Configure &&Trusted Domains'),\n\t\t\t\t\t\trun: async () => {\n\t\t\t\t\t\t\tconst pickedDomains = await configureOpenerTrustedDomainsHandler(\n\t\t\t\t\t\t\t\ttrustedDomains,\n\t\t\t\t\t\t\t\tdomainToOpen,\n\t\t\t\t\t\t\t\tresourceUri,\n\t\t\t\t\t\t\t\tthis._quickInputService,\n\t\t\t\t\t\t\t\tthis._storageService,\n\t\t\t\t\t\t\t\tthis._editorService,\n\t\t\t\t\t\t\t\tthis._telemetryService,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t// Trust all domains\n\t\t\t\t\t\t\tif (pickedDomains.indexOf('*') !== -1) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Trust current domain\n\t\t\t\t\t\t\tif (isURLDomainTrusted(resourceUri, pickedDomains)) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tcancelButton: {\n\t\t\t\t\trun: () => false\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn result;\n\t\t}\n\t}\n}\n\nconst rLocalhost = /^localhost(:\\d+)?$/i;\nconst r127 = /^127.0.0.1(:\\d+)?$/;\n\nfunction isLocalhostAuthority(authority: string) {\n\treturn rLocalhost.test(authority) || r127.test(authority);\n}\n\n/**\n * Case-normalize some case-insensitive URLs, such as github.\n */\nfunction normalizeURL(url: string | URI): string {\n\tconst caseInsensitiveAuthorities = ['github.com'];\n\ttry {\n\t\tconst parsed = typeof url === 'string' ? URI.parse(url, true) : url;\n\t\tif (caseInsensitiveAuthorities.includes(parsed.authority)) {\n\t\t\treturn parsed.with({ path: parsed.path.toLowerCase() }).toString(true);\n\t\t} else {\n\t\t\treturn parsed.toString(true);\n\t\t}\n\t} catch { return url.toString(); }\n}\n\n/**\n * Check whether a domain like https://www.microsoft.com matches\n * the list of trusted domains.\n *\n * - Schemes must match\n * - There's no subdomain matching. For example https://microsoft.com doesn't match https://www.microsoft.com\n * - Star matches all subdomains. For example https://*.microsoft.com matches https://www.microsoft.com and https://foo.bar.microsoft.com\n */\nexport function isURLDomainTrusted(url: URI, trustedDomains: string[]) {\n\turl = URI.parse(normalizeURL(url));\n\ttrustedDomains = trustedDomains.map(normalizeURL);\n\n\tif (isLocalhostAuthority(url.authority)) {\n\t\treturn true;\n\t}\n\n\tfor (let i = 0; i < trustedDomains.length; i++) {\n\t\tif (trustedDomains[i] === '*') {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (testUrlMatchesGlob(url, trustedDomains[i])) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n"]}