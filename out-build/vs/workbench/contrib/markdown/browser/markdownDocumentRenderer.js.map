{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/contrib/markdown/browser/markdownDocumentRenderer.ts"],"names":[],"mappings":"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","file":"markdownDocumentRenderer.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { hookDomPurifyHrefAndSrcSanitizer, basicMarkupHtmlTags } from 'vs/base/browser/dom';\nimport * as dompurify from 'vs/base/browser/dompurify/dompurify';\nimport { allowedMarkdownAttr } from 'vs/base/browser/markdownRenderer';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { marked } from 'vs/base/common/marked/marked';\nimport { Schemas } from 'vs/base/common/network';\nimport { ILanguageService } from 'vs/editor/common/languages/language';\nimport { tokenizeToString } from 'vs/editor/common/languages/textToHtmlTokenizer';\nimport { IExtensionService } from 'vs/workbench/services/extensions/common/extensions';\nimport { escape } from 'vs/base/common/strings';\n\nexport const DEFAULT_MARKDOWN_STYLES = `\nbody {\n\tpadding: 10px 20px;\n\tline-height: 22px;\n\tmax-width: 882px;\n\tmargin: 0 auto;\n}\n\nbody *:last-child {\n\tmargin-bottom: 0;\n}\n\nimg {\n\tmax-width: 100%;\n\tmax-height: 100%;\n}\n\na {\n\ttext-decoration: none;\n}\n\na:hover {\n\ttext-decoration: underline;\n}\n\na:focus,\ninput:focus,\nselect:focus,\ntextarea:focus {\n\toutline: 1px solid -webkit-focus-ring-color;\n\toutline-offset: -1px;\n}\n\nhr {\n\tborder: 0;\n\theight: 2px;\n\tborder-bottom: 2px solid;\n}\n\nh1 {\n\tpadding-bottom: 0.3em;\n\tline-height: 1.2;\n\tborder-bottom-width: 1px;\n\tborder-bottom-style: solid;\n}\n\nh1, h2, h3 {\n\tfont-weight: normal;\n}\n\ntable {\n\tborder-collapse: collapse;\n}\n\nth {\n\ttext-align: left;\n\tborder-bottom: 1px solid;\n}\n\nth,\ntd {\n\tpadding: 5px 10px;\n}\n\ntable > tbody > tr + tr > td {\n\tborder-top-width: 1px;\n\tborder-top-style: solid;\n}\n\nblockquote {\n\tmargin: 0 7px 0 5px;\n\tpadding: 0 16px 0 10px;\n\tborder-left-width: 5px;\n\tborder-left-style: solid;\n}\n\ncode {\n\tfont-family: \"SF Mono\", Monaco, Menlo, Consolas, \"Ubuntu Mono\", \"Liberation Mono\", \"DejaVu Sans Mono\", \"Courier New\", monospace;\n}\n\npre {\n\tpadding: 16px;\n\tborder-radius: 3px;\n\toverflow: auto;\n}\n\npre code {\n\tfont-family: var(--vscode-editor-font-family);\n\tfont-weight: var(--vscode-editor-font-weight);\n\tfont-size: var(--vscode-editor-font-size);\n\tline-height: 1.5;\n\tcolor: var(--vscode-editor-foreground);\n\ttab-size: 4;\n}\n\n.monaco-tokenized-source {\n\twhite-space: pre;\n}\n\n/** Theming */\n\n.pre {\n\tbackground-color: var(--vscode-textCodeBlock-background);\n}\n\n.vscode-high-contrast h1 {\n\tborder-color: rgb(0, 0, 0);\n}\n\n.vscode-light th {\n\tborder-color: rgba(0, 0, 0, 0.69);\n}\n\n.vscode-dark th {\n\tborder-color: rgba(255, 255, 255, 0.69);\n}\n\n.vscode-light h1,\n.vscode-light hr,\n.vscode-light td {\n\tborder-color: rgba(0, 0, 0, 0.18);\n}\n\n.vscode-dark h1,\n.vscode-dark hr,\n.vscode-dark td {\n\tborder-color: rgba(255, 255, 255, 0.18);\n}\n\n@media (forced-colors: active) and (prefers-color-scheme: light){\n\tbody {\n\t\tforced-color-adjust: none;\n\t}\n}\n\n@media (forced-colors: active) and (prefers-color-scheme: dark){\n\tbody {\n\t\tforced-color-adjust: none;\n\t}\n}\n`;\n\nconst allowedProtocols = [Schemas.http, Schemas.https, Schemas.command];\nfunction sanitize(documentContent: string, allowUnknownProtocols: boolean): string {\n\n\tconst hook = hookDomPurifyHrefAndSrcSanitizer(allowedProtocols, true);\n\n\ttry {\n\t\treturn dompurify.sanitize(documentContent, {\n\t\t\t...{\n\t\t\t\tALLOWED_TAGS: [\n\t\t\t\t\t...basicMarkupHtmlTags,\n\t\t\t\t\t'checkbox',\n\t\t\t\t\t'checklist',\n\t\t\t\t],\n\t\t\t\tALLOWED_ATTR: [\n\t\t\t\t\t...allowedMarkdownAttr,\n\t\t\t\t\t'data-command', 'name', 'id', 'role', 'tabindex',\n\t\t\t\t\t'x-dispatch',\n\t\t\t\t\t'required', 'checked', 'placeholder', 'when-checked', 'checked-on',\n\t\t\t\t],\n\t\t\t},\n\t\t\t...(allowUnknownProtocols ? { ALLOW_UNKNOWN_PROTOCOLS: true } : {}),\n\t\t});\n\t} finally {\n\t\thook.dispose();\n\t}\n}\n\n/**\n * Renders a string of markdown as a document.\n *\n * Uses VS Code's syntax highlighting code blocks.\n */\nexport async function renderMarkdownDocument(\n\ttext: string,\n\textensionService: IExtensionService,\n\tlanguageService: ILanguageService,\n\tshouldSanitize: boolean = true,\n\tallowUnknownProtocols: boolean = false,\n\ttoken?: CancellationToken,\n): Promise<string> {\n\n\tconst highlight = (code: string, lang: string | undefined, callback: ((error: any, code: string) => void) | undefined): any => {\n\t\tif (!callback) {\n\t\t\treturn code;\n\t\t}\n\n\t\tif (typeof lang !== 'string') {\n\t\t\tcallback(null, `<code>${escape(code)}</code>`);\n\t\t\treturn '';\n\t\t}\n\n\t\textensionService.whenInstalledExtensionsRegistered().then(async () => {\n\t\t\tif (token?.isCancellationRequested) {\n\t\t\t\tcallback(null, '');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst languageId = languageService.getLanguageIdByLanguageName(lang);\n\t\t\tconst html = await tokenizeToString(languageService, code, languageId);\n\t\t\tcallback(null, `<code>${html}</code>`);\n\t\t});\n\t\treturn '';\n\t};\n\n\treturn new Promise<string>((resolve, reject) => {\n\t\tmarked(text, { highlight }, (err, value) => err ? reject(err) : resolve(value));\n\t}).then(raw => {\n\t\tif (shouldSanitize) {\n\t\t\treturn sanitize(raw, allowUnknownProtocols);\n\t\t} else {\n\t\t\treturn raw;\n\t\t}\n\t});\n}\n"]}