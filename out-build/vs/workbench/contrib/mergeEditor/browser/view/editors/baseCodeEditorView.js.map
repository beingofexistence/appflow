{"version":3,"sources":["vs/workbench/contrib/mergeEditor/browser/view/editors/baseCodeEditorView.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IAiBzF,IAAM,IAAI,GAAV,MAAM,IAAmB,SAAQ,qBAAI;QAC3C,YACC,SAAwD,EACjC,oBAAyB,EACzB,oBAAyB;YAEhD,KAAK,CAAC,oBAAoB,EAAE,SAAS,EAAE,oBAAoB,CAAC,CAAC;YA+C7C,MAAC,GAAa,IAAA,oBAAO,EAAC,IAAI,EAAE,MAAM,CAAC,EAAE;gBACrD,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBAC9C,IAAI,CAAC,SAAS,EAAE;oBACf,OAAO,EAAE,CAAC;iBACV;gBACD,MAAM,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC;gBAC9B,MAAM,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC;gBAE7B,MAAM,uBAAuB,GAAG,SAAS,CAAC,uBAAuB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBAC/E,MAAM,yBAAyB,GAAG,SAAS,CAAC,yBAAyB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACnF,MAAM,mBAAmB,GAAG,IAAI,CAAC,CAAC,CAAmB,IAAI,CAAC,MAAM,CAAC,CAAC;gBAElE,MAAM,MAAM,GAA4B,EAAE,CAAC;gBAC3C,KAAK,MAAM,iBAAiB,IAAI,KAAK,CAAC,kBAAkB,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;oBAEtE,MAAM,KAAK,GAAG,iBAAiB,CAAC,SAAS,CAAC;oBAC1C,IAAI,CAAC,KAAK,EAAE;wBACX,SAAS;qBACT;oBAED,MAAM,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;oBAClE,IAAI,CAAC,iBAAiB,CAAC,aAAa,IAAI,SAAS,IAAI,CAAC,yBAAyB,EAAE;wBAChF,SAAS;qBACT;oBAED,MAAM,eAAe,GAAG,CAAC,oBAAoB,CAAC,CAAC;oBAC/C,IAAI,YAAY,GAA+D,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC5F,IAAI,SAAS,EAAE;wBACd,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;qBAChC;oBACD,IAAI,iBAAiB,KAAK,uBAAuB,EAAE;wBAClD,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;wBAChC,YAAY,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;qBAC5B;oBACD,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;oBAE7B,MAAM,kBAAkB,GAAG,SAAS,CAAC,mBAAmB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;oBAEtE,IAAI,kBAAkB,EAAE;wBACvB,KAAK,MAAM,IAAI,IAAI,iBAAiB,CAAC,aAAa,CAAC,kBAAkB,CAAC,EAAE;4BACvE,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,gBAAgB,EAAE,CAAC;4BACjD,IAAI,KAAK,EAAE;gCACV,MAAM,CAAC,IAAI,CAAC;oCACX,KAAK;oCACL,OAAO,EAAE;wCACR,SAAS,EAAE,wBAAwB;wCACnC,WAAW,EAAE,cAAc;wCAC3B,WAAW,EAAE,IAAI;qCACjB;iCACD,CAAC,CAAC;6BACH;4BAED,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,aAAa,EAAE;gCACvC,IAAI,mBAAmB,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE;oCACvD,MAAM,CAAC,IAAI,CAAC;wCACX,KAAK,EAAE,KAAK,CAAC,UAAU;wCACvB,OAAO,EAAE;4CACR,SAAS,EAAE,KAAK,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,mCAAmC,CAAC,CAAC,CAAC,6BAA6B;4CAC3G,WAAW,EAAE,cAAc;4CAC3B,eAAe,EAAE,IAAI;yCACrB;qCACD,CAAC,CAAC;iCACH;6BACD;yBACD;qBACD;oBAED,MAAM,CAAC,IAAI,CAAC;wBACX,KAAK,EAAE,KAAK,CAAC,uBAAuB,EAAE;wBACtC,OAAO,EAAE;4BACR,eAAe,EAAE,IAAI;4BACrB,cAAc,EAAE,eAAe,CAAC,IAAI,CAAC,GAAG,CAAC;4BACzC,YAAY;4BACZ,eAAe,EAAE,KAAK,CAAC,eAAe,GAAG,SAAS,CAAC,YAAY,EAAE;4BACjE,WAAW,EAAE,cAAc;4BAC3B,OAAO,EAAE;gCACR,QAAQ,EAAE,uBAAe,CAAC,MAAM;gCAChC,KAAK,EAAE,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC,aAAI,CAAqC,CAAC,CAAC,aAAI,EAAwC;6BAChH;4BACD,aAAa,EAAE,iBAAiB,CAAC,aAAa,CAAC,CAAC,CAAC;gCAChD,QAAQ,EAAE,yBAAiB,CAAC,MAAM;gCAClC,KAAK,EAAE,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC,aAAI,CAAqC,CAAC,CAAC,aAAI,EAAwC;6BAChH,CAAC,CAAC,CAAC,SAAS;yBACb;qBACD,CAAC,CAAC;iBACH;gBACD,OAAO,MAAM,CAAC;YACf,CAAC,CAAC,CAAC;YApIF,IAAI,CAAC,CAAC,CACL,IAAA,qBAAI,EAAoB,IAAI,EAAE,CAAC,SAAS,EAAE,SAAS,EAAE,EAAE,CAAC,SAAS,CAAC,CAClE,CAAC;YAEF,IAAI,CAAC,CAAC,CACL,oBAAoB,CAAC,cAAc,CAAC,qBAAI,EAAO,aAAG,CAAI,gBAAgB,EAAE,IAAI,CAAC,CAAC,CAAY,KAAK,CAAC,CAChG,CAAC;YAEF,IAAI,CAAC,CAAC,CACL,IAAA,6BAAgB,EAAC,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;gBAClC,qCAAqC;gBACrC,IAAI,IAAI,CAAC,CAAC,CAAiB,IAAI,CAAC,MAAM,CAAC,EAAE;oBACxC,KAAK,CAAC,GAAG,CAAC,IAAI,mBAAI,CAAS,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,CAAY,SAAS,EAAE;wBACpE,0BAA0B,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,EAAE,CAAC,EAAE;wBACjD,UAAU,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,EAAE,GAAG,MAAM,IAAI,YAAG,EAAiB,CAAC,CAAC,CAAC;qBACjE,CAAC,CAAC,CAAC;iBACJ;YACF,CAAC,CAAC,CACF,CAAC;YAEF,IAAI,CAAC,CAAC,CACL,IAAA,oBAAO,EAAC,MAAM,CAAC,EAAE;gBAChB,8CAA8C;gBAC9C,MAAM,EAAE,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACvC,IAAI,CAAC,EAAE,EAAE;oBACR,OAAO;iBACP;gBACD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBACpC,IAAA,SAAG,EAAG,IAAI,CAAC,CAAC,CAAY,KAAK,EAAE,GAAG,IAAA,gBAAG,EAAkB,IAAA,cAAQ,EAAC,CAAM,EAAE,IAAM,CAAC,CAAC,CAAC,CAAC;gBAElF,MAAM,mBAAmB,GAAG,EAAE,CAAC,mBAAmB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBAEhE,IAAI,IAAI,GAAqB,SAAS,CAAC;gBACvC,IAAI,mBAAmB,EAAE;oBACxB,MAAM,KAAK,GAAG,IAAA,cAAQ,EAAC,CAAa,EAAE,IAAoB,EAAE,mBAAmB,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;oBACvI,MAAM,OAAO,GAAG,IAAA,cAAQ,EAAC,CAAoB,EAAE,IAAsD,CAAC,CAAC;oBACvG,IAAI,GAAG,IAAA,OAAC,EAAC,MAAM,EAAE,EAAE,KAAK,EAAE,OAAO,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC;iBACnD;gBACD,IAAA,SAAG,EAAG,IAAI,CAAC,CAAC,CAAY,WAAW,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAC/D,CAAC,CAAC,CACF,CAAC;YAEF,IAAI,CAAC,CAAC,CAAS,IAAA,YAAI,EAAuB,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,CAAW,CAAC,CAAC;QAC3E,CAAC;KA0FD,CAAA;IA7IY,oBAAI;mBAAJ,IAAI;QAGd,WAAA,mBAAG,CAAA;QACH,WAAA,mBAAG,CAAA;OAJO,IAAI,CA6IhB","file":"baseCodeEditorView.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { h, reset } from 'vs/base/browser/dom';\nimport { renderLabelWithIcons } from 'vs/base/browser/ui/iconLabel/iconLabels';\nimport { BugIndicatingError } from 'vs/base/common/errors';\nimport { IObservable, autorun, autorunWithStore, derived } from 'vs/base/common/observable';\nimport { IModelDeltaDecoration, MinimapPosition, OverviewRulerLane } from 'vs/editor/common/model';\nimport { localize } from 'vs/nls';\nimport { MenuId } from 'vs/platform/actions/common/actions';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { applyObservableDecorations } from 'vs/workbench/contrib/mergeEditor/browser/utils';\nimport { handledConflictMinimapOverViewRulerColor, unhandledConflictMinimapOverViewRulerColor } from 'vs/workbench/contrib/mergeEditor/browser/view/colors';\nimport { EditorGutter } from 'vs/workbench/contrib/mergeEditor/browser/view/editorGutter';\nimport { MergeEditorViewModel } from 'vs/workbench/contrib/mergeEditor/browser/view/viewModel';\nimport { CodeEditorView, TitleMenu, createSelectionsAutorun } from './codeEditorView';\n\nexport class BaseCodeEditorView extends CodeEditorView {\n\tconstructor(\n\t\tviewModel: IObservable<MergeEditorViewModel | undefined>,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t) {\n\t\tsuper(instantiationService, viewModel, configurationService);\n\n\t\tthis._register(\n\t\t\tcreateSelectionsAutorun(this, (baseRange, viewModel) => baseRange)\n\t\t);\n\n\t\tthis._register(\n\t\t\tinstantiationService.createInstance(TitleMenu, MenuId.MergeBaseToolbar, this.htmlElements.title)\n\t\t);\n\n\t\tthis._register(\n\t\t\tautorunWithStore((reader, store) => {\n\t\t\t\t/** @description update checkboxes */\n\t\t\t\tif (this.checkboxesVisible.read(reader)) {\n\t\t\t\t\tstore.add(new EditorGutter(this.editor, this.htmlElements.gutterDiv, {\n\t\t\t\t\t\tgetIntersectingGutterItems: (range, reader) => [],\n\t\t\t\t\t\tcreateView: (item, target) => { throw new BugIndicatingError(); },\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tthis._register(\n\t\t\tautorun(reader => {\n\t\t\t\t/** @description update labels & text model */\n\t\t\t\tconst vm = this.viewModel.read(reader);\n\t\t\t\tif (!vm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.editor.setModel(vm.model.base);\n\t\t\t\treset(this.htmlElements.title, ...renderLabelWithIcons(localize('base', 'Base')));\n\n\t\t\t\tconst baseShowDiffAgainst = vm.baseShowDiffAgainst.read(reader);\n\n\t\t\t\tlet node: Node | undefined = undefined;\n\t\t\t\tif (baseShowDiffAgainst) {\n\t\t\t\t\tconst label = localize('compareWith', 'Comparing with {0}', baseShowDiffAgainst === 1 ? vm.model.input1.title : vm.model.input2.title);\n\t\t\t\t\tconst tooltip = localize('compareWithTooltip', 'Differences are highlighted with a background color.');\n\t\t\t\t\tnode = h('span', { title: tooltip }, [label]).root;\n\t\t\t\t}\n\t\t\t\treset(this.htmlElements.description, ...(node ? [node] : []));\n\t\t\t})\n\t\t);\n\n\t\tthis._register(applyObservableDecorations(this.editor, this.decorations));\n\t}\n\n\tprivate readonly decorations = derived(this, reader => {\n\t\tconst viewModel = this.viewModel.read(reader);\n\t\tif (!viewModel) {\n\t\t\treturn [];\n\t\t}\n\t\tconst model = viewModel.model;\n\t\tconst textModel = model.base;\n\n\t\tconst activeModifiedBaseRange = viewModel.activeModifiedBaseRange.read(reader);\n\t\tconst showNonConflictingChanges = viewModel.showNonConflictingChanges.read(reader);\n\t\tconst showDeletionMarkers = this.showDeletionMarkers.read(reader);\n\n\t\tconst result: IModelDeltaDecoration[] = [];\n\t\tfor (const modifiedBaseRange of model.modifiedBaseRanges.read(reader)) {\n\n\t\t\tconst range = modifiedBaseRange.baseRange;\n\t\t\tif (!range) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst isHandled = model.isHandled(modifiedBaseRange).read(reader);\n\t\t\tif (!modifiedBaseRange.isConflicting && isHandled && !showNonConflictingChanges) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst blockClassNames = ['merge-editor-block'];\n\t\t\tlet blockPadding: [top: number, right: number, bottom: number, left: number] = [0, 0, 0, 0];\n\t\t\tif (isHandled) {\n\t\t\t\tblockClassNames.push('handled');\n\t\t\t}\n\t\t\tif (modifiedBaseRange === activeModifiedBaseRange) {\n\t\t\t\tblockClassNames.push('focused');\n\t\t\t\tblockPadding = [0, 2, 0, 2];\n\t\t\t}\n\t\t\tblockClassNames.push('base');\n\n\t\t\tconst inputToDiffAgainst = viewModel.baseShowDiffAgainst.read(reader);\n\n\t\t\tif (inputToDiffAgainst) {\n\t\t\t\tfor (const diff of modifiedBaseRange.getInputDiffs(inputToDiffAgainst)) {\n\t\t\t\t\tconst range = diff.inputRange.toInclusiveRange();\n\t\t\t\t\tif (range) {\n\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclassName: `merge-editor-diff base`,\n\t\t\t\t\t\t\t\tdescription: 'Merge Editor',\n\t\t\t\t\t\t\t\tisWholeLine: true,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const diff2 of diff.rangeMappings) {\n\t\t\t\t\t\tif (showDeletionMarkers || !diff2.inputRange.isEmpty()) {\n\t\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\t\trange: diff2.inputRange,\n\t\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t\tclassName: diff2.inputRange.isEmpty() ? `merge-editor-diff-empty-word base` : `merge-editor-diff-word base`,\n\t\t\t\t\t\t\t\t\tdescription: 'Merge Editor',\n\t\t\t\t\t\t\t\t\tshowIfCollapsed: true,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.push({\n\t\t\t\trange: range.toInclusiveRangeOrEmpty(),\n\t\t\t\toptions: {\n\t\t\t\t\tshowIfCollapsed: true,\n\t\t\t\t\tblockClassName: blockClassNames.join(' '),\n\t\t\t\t\tblockPadding,\n\t\t\t\t\tblockIsAfterEnd: range.startLineNumber > textModel.getLineCount(),\n\t\t\t\t\tdescription: 'Merge Editor',\n\t\t\t\t\tminimap: {\n\t\t\t\t\t\tposition: MinimapPosition.Gutter,\n\t\t\t\t\t\tcolor: { id: isHandled ? handledConflictMinimapOverViewRulerColor : unhandledConflictMinimapOverViewRulerColor },\n\t\t\t\t\t},\n\t\t\t\t\toverviewRuler: modifiedBaseRange.isConflicting ? {\n\t\t\t\t\t\tposition: OverviewRulerLane.Center,\n\t\t\t\t\t\tcolor: { id: isHandled ? handledConflictMinimapOverViewRulerColor : unhandledConflictMinimapOverViewRulerColor },\n\t\t\t\t\t} : undefined\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t});\n}\n"]}