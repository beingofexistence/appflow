{"version":3,"sources":["vs/workbench/contrib/mergeEditor/browser/mergeMarkers/mergeMarkersController.ts"],"names":[],"mappings":"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","file":"mergeMarkersController.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { h } from 'vs/base/browser/dom';\nimport { Disposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { autorun, IObservable } from 'vs/base/common/observable';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';\nimport { MergeEditorViewModel } from 'vs/workbench/contrib/mergeEditor/browser/view/viewModel';\nimport * as nls from 'vs/nls';\n\nexport const conflictMarkers = {\n\tstart: '<<<<<<<',\n\tend: '>>>>>>>',\n};\n\nexport class MergeMarkersController extends Disposable {\n\tprivate readonly viewZoneIds: string[] = [];\n\tprivate readonly disposableStore = new DisposableStore();\n\n\tpublic constructor(\n\t\tpublic readonly editor: ICodeEditor,\n\t\tpublic readonly mergeEditorViewModel: IObservable<MergeEditorViewModel | undefined>,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(editor.onDidChangeModelContent(e => {\n\t\t\tthis.updateDecorations();\n\t\t}));\n\n\t\tthis._register(editor.onDidChangeModel(e => {\n\t\t\tthis.updateDecorations();\n\t\t}));\n\n\t\tthis.updateDecorations();\n\t}\n\n\tprivate updateDecorations() {\n\t\tconst model = this.editor.getModel();\n\t\tconst blocks = model ? getBlocks(model, { blockToRemoveStartLinePrefix: conflictMarkers.start, blockToRemoveEndLinePrefix: conflictMarkers.end }) : { blocks: [] };\n\n\t\tthis.editor.setHiddenAreas(blocks.blocks.map(b => b.lineRange.deltaEnd(-1).toRange()), this);\n\t\tthis.editor.changeViewZones(c => {\n\t\t\tthis.disposableStore.clear();\n\t\t\tfor (const id of this.viewZoneIds) {\n\t\t\t\tc.removeZone(id);\n\t\t\t}\n\t\t\tthis.viewZoneIds.length = 0;\n\t\t\tfor (const b of blocks.blocks) {\n\n\t\t\t\tconst startLine = model!.getLineContent(b.lineRange.startLineNumber).substring(0, 20);\n\t\t\t\tconst endLine = model!.getLineContent(b.lineRange.endLineNumberExclusive - 1).substring(0, 20);\n\n\t\t\t\tconst conflictingLinesCount = b.lineRange.lineCount - 2;\n\n\t\t\t\tconst domNode = h('div', [\n\t\t\t\t\th('div.conflict-zone-root', [\n\t\t\t\t\t\th('pre', [startLine]),\n\t\t\t\t\t\th('span.dots', ['...']),\n\t\t\t\t\t\th('pre', [endLine]),\n\t\t\t\t\t\th('span.text', [\n\t\t\t\t\t\t\tconflictingLinesCount === 1\n\t\t\t\t\t\t\t\t? nls.localize('conflictingLine', \"1 Conflicting Line\")\n\t\t\t\t\t\t\t\t: nls.localize('conflictingLines', \"{0} Conflicting Lines\", conflictingLinesCount)\n\t\t\t\t\t\t]),\n\t\t\t\t\t]),\n\t\t\t\t]).root;\n\t\t\t\tthis.viewZoneIds.push(c.addZone({\n\t\t\t\t\tafterLineNumber: b.lineRange.endLineNumberExclusive - 1,\n\t\t\t\t\tdomNode,\n\t\t\t\t\theightInLines: 1.5,\n\t\t\t\t}));\n\n\t\t\t\tconst updateWidth = () => {\n\t\t\t\t\tconst layoutInfo = this.editor.getLayoutInfo();\n\t\t\t\t\tdomNode.style.width = `${layoutInfo.contentWidth - layoutInfo.verticalScrollbarWidth}px`;\n\t\t\t\t};\n\n\t\t\t\tthis.disposableStore.add(\n\t\t\t\t\tthis.editor.onDidLayoutChange(() => {\n\t\t\t\t\t\tupdateWidth();\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\tupdateWidth();\n\n\n\t\t\t\tthis.disposableStore.add(autorun(reader => {\n\t\t\t\t\t/** @description update classname */\n\t\t\t\t\tconst vm = this.mergeEditorViewModel.read(reader);\n\t\t\t\t\tif (!vm) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst activeRange = vm.activeModifiedBaseRange.read(reader);\n\n\t\t\t\t\tconst classNames: string[] = [];\n\t\t\t\t\tclassNames.push('conflict-zone');\n\n\t\t\t\t\tif (activeRange) {\n\t\t\t\t\t\tconst activeRangeInResult = vm.model.getLineRangeInResult(activeRange.baseRange, reader);\n\t\t\t\t\t\tif (activeRangeInResult.intersects(b.lineRange)) {\n\t\t\t\t\t\t\tclassNames.push('focused');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tdomNode.className = classNames.join(' ');\n\t\t\t\t}));\n\t\t\t}\n\t\t});\n\t}\n}\n\n\nfunction getBlocks(document: ITextModel, configuration: ProjectionConfiguration): { blocks: Block[]; transformedContent: string } {\n\tconst blocks: Block[] = [];\n\tconst transformedContent: string[] = [];\n\n\tlet inBlock = false;\n\tlet startLineNumber = -1;\n\tlet curLine = 0;\n\n\tfor (const line of document.getLinesContent()) {\n\t\tcurLine++;\n\t\tif (!inBlock) {\n\t\t\tif (line.startsWith(configuration.blockToRemoveStartLinePrefix)) {\n\t\t\t\tinBlock = true;\n\t\t\t\tstartLineNumber = curLine;\n\t\t\t} else {\n\t\t\t\ttransformedContent.push(line);\n\t\t\t}\n\t\t} else {\n\t\t\tif (line.startsWith(configuration.blockToRemoveEndLinePrefix)) {\n\t\t\t\tinBlock = false;\n\t\t\t\tblocks.push(new Block(new LineRange(startLineNumber, curLine - startLineNumber + 1)));\n\t\t\t\ttransformedContent.push('');\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {\n\t\tblocks,\n\t\ttransformedContent: transformedContent.join('\\n')\n\t};\n}\n\nclass Block {\n\tconstructor(public readonly lineRange: LineRange) { }\n}\n\ninterface ProjectionConfiguration {\n\tblockToRemoveStartLinePrefix: string;\n\tblockToRemoveEndLinePrefix: string;\n}\n"]}