{"version":3,"sources":["vs/workbench/browser/window.ts"],"names":[],"mappings":"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","file":"window.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isSafari, setFullscreen } from 'vs/base/browser/browser';\nimport { addDisposableListener, addDisposableThrottledListener, detectFullscreen, EventHelper, EventType, windowOpenNoOpener, windowOpenPopup, windowOpenWithSuccess } from 'vs/base/browser/dom';\nimport { DomEmitter } from 'vs/base/browser/event';\nimport { HidDeviceData, requestHidDevice, requestSerialPort, requestUsbDevice, SerialPortData, UsbDeviceData } from 'vs/base/browser/deviceAccess';\nimport { timeout } from 'vs/base/common/async';\nimport { Event } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { Schemas } from 'vs/base/common/network';\nimport { isIOS, isMacintosh } from 'vs/base/common/platform';\nimport Severity from 'vs/base/common/severity';\nimport { URI } from 'vs/base/common/uri';\nimport { localize } from 'vs/nls';\nimport { CommandsRegistry } from 'vs/platform/commands/common/commands';\nimport { IDialogService, IPromptButton } from 'vs/platform/dialogs/common/dialogs';\nimport { registerWindowDriver } from 'vs/platform/driver/browser/driver';\nimport { IInstantiationService, ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { IOpenerService, matchesScheme } from 'vs/platform/opener/common/opener';\nimport { IProductService } from 'vs/platform/product/common/productService';\nimport { IBrowserWorkbenchEnvironmentService } from 'vs/workbench/services/environment/browser/environmentService';\nimport { IWorkbenchLayoutService } from 'vs/workbench/services/layout/browser/layoutService';\nimport { BrowserLifecycleService } from 'vs/workbench/services/lifecycle/browser/lifecycleService';\nimport { ILifecycleService } from 'vs/workbench/services/lifecycle/common/lifecycle';\nimport { IHostService } from 'vs/workbench/services/host/browser/host';\n\nexport class BrowserWindow extends Disposable {\n\n\tconstructor(\n\t\t@IOpenerService private readonly openerService: IOpenerService,\n\t\t@ILifecycleService private readonly lifecycleService: BrowserLifecycleService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@IBrowserWorkbenchEnvironmentService private readonly environmentService: IBrowserWorkbenchEnvironmentService,\n\t\t@IWorkbenchLayoutService private readonly layoutService: IWorkbenchLayoutService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IHostService private readonly hostService: IHostService\n\t) {\n\t\tsuper();\n\n\t\tthis.registerListeners();\n\t\tthis.create();\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Lifecycle\n\t\tthis._register(this.lifecycleService.onWillShutdown(() => this.onWillShutdown()));\n\n\t\t// Layout\n\t\tconst viewport = isIOS && window.visualViewport ? window.visualViewport /** Visual viewport */ : window /** Layout viewport */;\n\t\tthis._register(addDisposableListener(viewport, EventType.RESIZE, () => {\n\t\t\tthis.layoutService.layout();\n\n\t\t\t// Sometimes the keyboard appearing scrolls the whole workbench out of view, as a workaround scroll back into view #121206\n\t\t\tif (isIOS) {\n\t\t\t\twindow.scrollTo(0, 0);\n\t\t\t}\n\t\t}));\n\n\t\t// Prevent the back/forward gestures in macOS\n\t\tthis._register(addDisposableListener(this.layoutService.container, EventType.WHEEL, e => e.preventDefault(), { passive: false }));\n\n\t\t// Prevent native context menus in web\n\t\tthis._register(addDisposableListener(this.layoutService.container, EventType.CONTEXT_MENU, e => EventHelper.stop(e, true)));\n\n\t\t// Prevent default navigation on drop\n\t\tthis._register(addDisposableListener(this.layoutService.container, EventType.DROP, e => EventHelper.stop(e, true)));\n\n\t\t// Fullscreen (Browser)\n\t\tfor (const event of [EventType.FULLSCREEN_CHANGE, EventType.WK_FULLSCREEN_CHANGE]) {\n\t\t\tthis._register(addDisposableListener(document, event, () => setFullscreen(!!detectFullscreen())));\n\t\t}\n\n\t\t// Fullscreen (Native)\n\t\tthis._register(addDisposableThrottledListener(viewport, EventType.RESIZE, () => {\n\t\t\tsetFullscreen(!!detectFullscreen());\n\t\t}, undefined, isMacintosh ? 2000 /* adjust for macOS animation */ : 800 /* can be throttled */));\n\t}\n\n\tprivate onWillShutdown(): void {\n\n\t\t// Try to detect some user interaction with the workbench\n\t\t// when shutdown has happened to not show the dialog e.g.\n\t\t// when navigation takes a longer time.\n\t\tEvent.toPromise(Event.any(\n\t\t\tEvent.once(new DomEmitter(document.body, EventType.KEY_DOWN, true).event),\n\t\t\tEvent.once(new DomEmitter(document.body, EventType.MOUSE_DOWN, true).event)\n\t\t)).then(async () => {\n\n\t\t\t// Delay the dialog in case the user interacted\n\t\t\t// with the page before it transitioned away\n\t\t\tawait timeout(3000);\n\n\t\t\t// This should normally not happen, but if for some reason\n\t\t\t// the workbench was shutdown while the page is still there,\n\t\t\t// inform the user that only a reload can bring back a working\n\t\t\t// state.\n\t\t\tawait this.dialogService.prompt({\n\t\t\t\ttype: Severity.Error,\n\t\t\t\tmessage: localize('shutdownError', \"An unexpected error occurred that requires a reload of this page.\"),\n\t\t\t\tdetail: localize('shutdownErrorDetail', \"The workbench was unexpectedly disposed while running.\"),\n\t\t\t\tbuttons: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: localize({ key: 'reload', comment: ['&& denotes a mnemonic'] }, \"&&Reload\"),\n\t\t\t\t\t\trun: () => window.location.reload() // do not use any services at this point since they are likely not functional at this point\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate create(): void {\n\n\t\t// Handle open calls\n\t\tthis.setupOpenHandlers();\n\n\t\t// Label formatting\n\t\tthis.registerLabelFormatters();\n\n\t\t// Commands\n\t\tthis.registerCommands();\n\n\t\t// Smoke Test Driver\n\t\tthis.setupDriver();\n\t}\n\n\tprivate setupDriver(): void {\n\t\tif (this.environmentService.enableSmokeTestDriver) {\n\t\t\tregisterWindowDriver(this.instantiationService);\n\t\t}\n\t}\n\n\tprivate setupOpenHandlers(): void {\n\n\t\t// We need to ignore the `beforeunload` event while\n\t\t// we handle external links to open specifically for\n\t\t// the case of application protocols that e.g. invoke\n\t\t// vscode itself. We do not want to open these links\n\t\t// in a new window because that would leave a blank\n\t\t// window to the user, but using `window.location.href`\n\t\t// will trigger the `beforeunload`.\n\t\tthis.openerService.setDefaultExternalOpener({\n\t\t\topenExternal: async (href: string) => {\n\t\t\t\tlet isAllowedOpener = false;\n\t\t\t\tif (this.environmentService.options?.openerAllowedExternalUrlPrefixes) {\n\t\t\t\t\tfor (const trustedPopupPrefix of this.environmentService.options.openerAllowedExternalUrlPrefixes) {\n\t\t\t\t\t\tif (href.startsWith(trustedPopupPrefix)) {\n\t\t\t\t\t\t\tisAllowedOpener = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// HTTP(s): open in new window and deal with potential popup blockers\n\t\t\t\tif (matchesScheme(href, Schemas.http) || matchesScheme(href, Schemas.https)) {\n\t\t\t\t\tif (isSafari) {\n\t\t\t\t\t\tconst opened = windowOpenWithSuccess(href, !isAllowedOpener);\n\t\t\t\t\t\tif (!opened) {\n\t\t\t\t\t\t\tawait this.dialogService.prompt({\n\t\t\t\t\t\t\t\ttype: Severity.Warning,\n\t\t\t\t\t\t\t\tmessage: localize('unableToOpenExternal', \"The browser interrupted the opening of a new tab or window. Press 'Open' to open it anyway.\"),\n\t\t\t\t\t\t\t\tdetail: href,\n\t\t\t\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tlabel: localize({ key: 'open', comment: ['&& denotes a mnemonic'] }, \"&&Open\"),\n\t\t\t\t\t\t\t\t\t\trun: () => isAllowedOpener ? windowOpenPopup(href) : windowOpenNoOpener(href)\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tlabel: localize({ key: 'learnMore', comment: ['&& denotes a mnemonic'] }, \"&&Learn More\"),\n\t\t\t\t\t\t\t\t\t\trun: () => this.openerService.open(URI.parse('https://aka.ms/allow-vscode-popup'))\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\tcancelButton: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tisAllowedOpener\n\t\t\t\t\t\t\t? windowOpenPopup(href)\n\t\t\t\t\t\t\t: windowOpenNoOpener(href);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Anything else: set location to trigger protocol handler in the browser\n\t\t\t\t// but make sure to signal this as an expected unload and disable unload\n\t\t\t\t// handling explicitly to prevent the workbench from going down.\n\t\t\t\telse {\n\t\t\t\t\tconst invokeProtocolHandler = () => {\n\t\t\t\t\t\tthis.lifecycleService.withExpectedShutdown({ disableShutdownHandling: true }, () => window.location.href = href);\n\t\t\t\t\t};\n\n\t\t\t\t\tinvokeProtocolHandler();\n\n\t\t\t\t\tconst showProtocolUrlOpenedDialog = async () => {\n\t\t\t\t\t\tconst { downloadUrl } = this.productService;\n\t\t\t\t\t\tlet detail: string;\n\n\t\t\t\t\t\tconst buttons: IPromptButton<void>[] = [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: localize({ key: 'openExternalDialogButtonRetry.v2', comment: ['&& denotes a mnemonic'] }, \"&&Try Again\"),\n\t\t\t\t\t\t\t\trun: () => invokeProtocolHandler()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t];\n\n\t\t\t\t\t\tif (downloadUrl !== undefined) {\n\t\t\t\t\t\t\tdetail = localize(\n\t\t\t\t\t\t\t\t'openExternalDialogDetail.v2',\n\t\t\t\t\t\t\t\t\"We launched {0} on your computer.\\n\\nIf {1} did not launch, try again or install it below.\",\n\t\t\t\t\t\t\t\tthis.productService.nameLong,\n\t\t\t\t\t\t\t\tthis.productService.nameLong\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tbuttons.push({\n\t\t\t\t\t\t\t\tlabel: localize({ key: 'openExternalDialogButtonInstall.v3', comment: ['&& denotes a mnemonic'] }, \"&&Install\"),\n\t\t\t\t\t\t\t\trun: async () => {\n\t\t\t\t\t\t\t\t\tawait this.openerService.open(URI.parse(downloadUrl));\n\n\t\t\t\t\t\t\t\t\t// Re-show the dialog so that the user can come back after installing and try again\n\t\t\t\t\t\t\t\t\tshowProtocolUrlOpenedDialog();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdetail = localize(\n\t\t\t\t\t\t\t\t'openExternalDialogDetailNoInstall',\n\t\t\t\t\t\t\t\t\"We launched {0} on your computer.\\n\\nIf {1} did not launch, try again below.\",\n\t\t\t\t\t\t\t\tthis.productService.nameLong,\n\t\t\t\t\t\t\t\tthis.productService.nameLong\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// While this dialog shows, closing the tab will not display a confirmation dialog\n\t\t\t\t\t\t// to avoid showing the user two dialogs at once\n\t\t\t\t\t\tawait this.hostService.withExpectedShutdown(() => this.dialogService.prompt({\n\t\t\t\t\t\t\ttype: Severity.Info,\n\t\t\t\t\t\t\tmessage: localize('openExternalDialogTitle', \"All done. You can close this tab now.\"),\n\t\t\t\t\t\t\tdetail,\n\t\t\t\t\t\t\tbuttons,\n\t\t\t\t\t\t\tcancelButton: true\n\t\t\t\t\t\t}));\n\t\t\t\t\t};\n\n\t\t\t\t\t// We cannot know whether the protocol handler succeeded.\n\t\t\t\t\t// Display guidance in case it did not, e.g. the app is not installed locally.\n\t\t\t\t\tif (matchesScheme(href, this.productService.urlProtocol)) {\n\t\t\t\t\t\tawait showProtocolUrlOpenedDialog();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate registerLabelFormatters(): void {\n\t\tthis._register(this.labelService.registerFormatter({\n\t\t\tscheme: Schemas.vscodeUserData,\n\t\t\tpriority: true,\n\t\t\tformatting: {\n\t\t\t\tlabel: '(Settings) ${path}',\n\t\t\t\tseparator: '/',\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate registerCommands(): void {\n\n\t\t// Allow extensions to request USB devices in Web\n\t\tCommandsRegistry.registerCommand('workbench.experimental.requestUsbDevice', async (_accessor: ServicesAccessor, options?: { filters?: unknown[] }): Promise<UsbDeviceData | undefined> => {\n\t\t\treturn requestUsbDevice(options);\n\t\t});\n\n\t\t// Allow extensions to request Serial devices in Web\n\t\tCommandsRegistry.registerCommand('workbench.experimental.requestSerialPort', async (_accessor: ServicesAccessor, options?: { filters?: unknown[] }): Promise<SerialPortData | undefined> => {\n\t\t\treturn requestSerialPort(options);\n\t\t});\n\n\t\t// Allow extensions to request HID devices in Web\n\t\tCommandsRegistry.registerCommand('workbench.experimental.requestHidDevice', async (_accessor: ServicesAccessor, options?: { filters?: unknown[] }): Promise<HidDeviceData | undefined> => {\n\t\t\treturn requestHidDevice(options);\n\t\t});\n\t}\n}\n"]}