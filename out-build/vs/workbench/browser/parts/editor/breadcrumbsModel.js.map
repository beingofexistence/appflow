{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/browser/parts/editor/breadcrumbsModel.ts"],"names":[],"mappings":"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","file":"breadcrumbsModel.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { DisposableStore, MutableDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { isEqual, dirname } from 'vs/base/common/resources';\nimport { URI } from 'vs/base/common/uri';\nimport { IWorkspaceContextService, IWorkspaceFolder, WorkbenchState } from 'vs/platform/workspace/common/workspace';\nimport { Schemas } from 'vs/base/common/network';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { BreadcrumbsConfig } from 'vs/workbench/browser/parts/editor/breadcrumbs';\nimport { FileKind } from 'vs/platform/files/common/files';\nimport { IOutline, IOutlineService, OutlineTarget } from 'vs/workbench/services/outline/browser/outline';\nimport { IEditorPane } from 'vs/workbench/common/editor';\nimport { matchesSomeScheme } from 'vs/platform/opener/common/opener';\n\nexport class FileElement {\n\tconstructor(\n\t\treadonly uri: URI,\n\t\treadonly kind: FileKind\n\t) { }\n}\n\ntype FileInfo = { path: FileElement[]; folder?: IWorkspaceFolder };\n\nexport class OutlineElement2 {\n\tconstructor(\n\t\treadonly element: IOutline<any> | any,\n\t\treadonly outline: IOutline<any>\n\t) { }\n}\n\nexport class BreadcrumbsModel {\n\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate _fileInfo: FileInfo;\n\n\tprivate readonly _cfgFilePath: BreadcrumbsConfig<'on' | 'off' | 'last'>;\n\tprivate readonly _cfgSymbolPath: BreadcrumbsConfig<'on' | 'off' | 'last'>;\n\n\tprivate readonly _currentOutline = new MutableDisposable<IOutline<any>>();\n\tprivate readonly _outlineDisposables = new DisposableStore();\n\n\tprivate readonly _onDidUpdate = new Emitter<this>();\n\treadonly onDidUpdate: Event<this> = this._onDidUpdate.event;\n\n\tconstructor(\n\t\treadonly resource: URI,\n\t\teditor: IEditorPane | undefined,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IWorkspaceContextService private readonly _workspaceService: IWorkspaceContextService,\n\t\t@IOutlineService private readonly _outlineService: IOutlineService,\n\t) {\n\t\tthis._cfgFilePath = BreadcrumbsConfig.FilePath.bindTo(configurationService);\n\t\tthis._cfgSymbolPath = BreadcrumbsConfig.SymbolPath.bindTo(configurationService);\n\n\t\tthis._disposables.add(this._cfgFilePath.onDidChange(_ => this._onDidUpdate.fire(this)));\n\t\tthis._disposables.add(this._cfgSymbolPath.onDidChange(_ => this._onDidUpdate.fire(this)));\n\t\tthis._workspaceService.onDidChangeWorkspaceFolders(this._onDidChangeWorkspaceFolders, this, this._disposables);\n\t\tthis._fileInfo = this._initFilePathInfo(resource);\n\n\t\tif (editor) {\n\t\t\tthis._bindToEditor(editor);\n\t\t\tthis._disposables.add(_outlineService.onDidChange(() => this._bindToEditor(editor)));\n\t\t\tthis._disposables.add(editor.onDidChangeControl(() => this._bindToEditor(editor)));\n\t\t}\n\t\tthis._onDidUpdate.fire(this);\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis._cfgFilePath.dispose();\n\t\tthis._cfgSymbolPath.dispose();\n\t\tthis._currentOutline.dispose();\n\t\tthis._outlineDisposables.dispose();\n\t\tthis._onDidUpdate.dispose();\n\t}\n\n\tisRelative(): boolean {\n\t\treturn Boolean(this._fileInfo.folder);\n\t}\n\n\tgetElements(): ReadonlyArray<FileElement | OutlineElement2> {\n\t\tlet result: (FileElement | OutlineElement2)[] = [];\n\n\t\t// file path elements\n\t\tif (this._cfgFilePath.getValue() === 'on') {\n\t\t\tresult = result.concat(this._fileInfo.path);\n\t\t} else if (this._cfgFilePath.getValue() === 'last' && this._fileInfo.path.length > 0) {\n\t\t\tresult = result.concat(this._fileInfo.path.slice(-1));\n\t\t}\n\n\t\tif (this._cfgSymbolPath.getValue() === 'off') {\n\t\t\treturn result;\n\t\t}\n\n\t\tif (!this._currentOutline.value) {\n\t\t\treturn result;\n\t\t}\n\n\t\tconst breadcrumbsElements = this._currentOutline.value.config.breadcrumbsDataSource.getBreadcrumbElements();\n\t\tfor (let i = this._cfgSymbolPath.getValue() === 'last' && breadcrumbsElements.length > 0 ? breadcrumbsElements.length - 1 : 0; i < breadcrumbsElements.length; i++) {\n\t\t\tresult.push(new OutlineElement2(breadcrumbsElements[i], this._currentOutline.value));\n\t\t}\n\n\t\tif (breadcrumbsElements.length === 0 && !this._currentOutline.value.isEmpty) {\n\t\t\tresult.push(new OutlineElement2(this._currentOutline.value, this._currentOutline.value));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _initFilePathInfo(uri: URI): FileInfo {\n\n\t\tif (matchesSomeScheme(uri, Schemas.untitled, Schemas.data)) {\n\t\t\treturn {\n\t\t\t\tfolder: undefined,\n\t\t\t\tpath: []\n\t\t\t};\n\t\t}\n\n\t\tconst info: FileInfo = {\n\t\t\tfolder: this._workspaceService.getWorkspaceFolder(uri) ?? undefined,\n\t\t\tpath: []\n\t\t};\n\n\t\tlet uriPrefix: URI | null = uri;\n\t\twhile (uriPrefix && uriPrefix.path !== '/') {\n\t\t\tif (info.folder && isEqual(info.folder.uri, uriPrefix)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tinfo.path.unshift(new FileElement(uriPrefix, info.path.length === 0 ? FileKind.FILE : FileKind.FOLDER));\n\t\t\tconst prevPathLength = uriPrefix.path.length;\n\t\t\turiPrefix = dirname(uriPrefix);\n\t\t\tif (uriPrefix.path.length === prevPathLength) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (info.folder && this._workspaceService.getWorkbenchState() === WorkbenchState.WORKSPACE) {\n\t\t\tinfo.path.unshift(new FileElement(info.folder.uri, FileKind.ROOT_FOLDER));\n\t\t}\n\t\treturn info;\n\t}\n\n\tprivate _onDidChangeWorkspaceFolders() {\n\t\tthis._fileInfo = this._initFilePathInfo(this.resource);\n\t\tthis._onDidUpdate.fire(this);\n\t}\n\n\tprivate _bindToEditor(editor: IEditorPane): void {\n\t\tconst newCts = new CancellationTokenSource();\n\t\tthis._currentOutline.clear();\n\t\tthis._outlineDisposables.clear();\n\t\tthis._outlineDisposables.add(toDisposable(() => newCts.dispose(true)));\n\n\t\tthis._outlineService.createOutline(editor, OutlineTarget.Breadcrumbs, newCts.token).then(outline => {\n\t\t\tif (newCts.token.isCancellationRequested) {\n\t\t\t\t// cancelled: dispose new outline and reset\n\t\t\t\toutline?.dispose();\n\t\t\t\toutline = undefined;\n\t\t\t}\n\t\t\tthis._currentOutline.value = outline;\n\t\t\tthis._onDidUpdate.fire(this);\n\t\t\tif (outline) {\n\t\t\t\tthis._outlineDisposables.add(outline.onDidChange(() => this._onDidUpdate.fire(this)));\n\t\t\t}\n\n\t\t}).catch(err => {\n\t\t\tthis._onDidUpdate.fire(this);\n\t\t\tonUnexpectedError(err);\n\t\t});\n\t}\n}\n"]}