{"version":3,"sources":["file:///workspace/appflow/src/vs/code/browser/workbench/workbench.ts"],"names":[],"mappings":"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","file":"workbench.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isStandalone } from 'vs/base/browser/browser';\nimport { VSBuffer, decodeBase64, encodeBase64 } from 'vs/base/common/buffer';\nimport { Emitter } from 'vs/base/common/event';\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\nimport { parse } from 'vs/base/common/marshalling';\nimport { Schemas } from 'vs/base/common/network';\nimport { posix } from 'vs/base/common/path';\nimport { isEqual } from 'vs/base/common/resources';\nimport { ltrim } from 'vs/base/common/strings';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport product from 'vs/platform/product/common/product';\nimport { ISecretStorageProvider } from 'vs/platform/secrets/common/secrets';\nimport { isFolderToOpen, isWorkspaceToOpen } from 'vs/platform/window/common/window';\nimport type { IWorkbenchConstructionOptions } from 'vs/workbench/browser/web.api';\nimport { AuthenticationSessionInfo } from 'vs/workbench/services/authentication/browser/authenticationService';\nimport type { IWorkspace, IWorkspaceProvider } from 'vs/workbench/services/host/browser/browserHostService';\nimport type { IURLCallbackProvider } from 'vs/workbench/services/url/browser/urlService';\nimport { create } from 'vs/workbench/workbench.web.main';\n\ninterface ISecretStorageCrypto {\n\tseal(data: string): Promise<string>;\n\tunseal(data: string): Promise<string>;\n}\n\nclass TransparentCrypto implements ISecretStorageCrypto {\n\tasync seal(data: string): Promise<string> {\n\t\treturn data;\n\t}\n\n\tasync unseal(data: string): Promise<string> {\n\t\treturn data;\n\t}\n}\n\nconst enum AESConstants {\n\tALGORITHM = 'AES-GCM',\n\tKEY_LENGTH = 256,\n\tIV_LENGTH = 12,\n}\n\nclass ServerKeyedAESCrypto implements ISecretStorageCrypto {\n\tprivate _serverKey: Uint8Array | undefined;\n\n\t/** Gets whether the algorithm is supported; requires a secure context */\n\tpublic static supported() {\n\t\treturn !!crypto.subtle;\n\t}\n\n\tconstructor(private readonly authEndpoint: string) { }\n\n\tasync seal(data: string): Promise<string> {\n\t\t// Get a new key and IV on every change, to avoid the risk of reusing the same key and IV pair with AES-GCM\n\t\t// (see also: https://developer.mozilla.org/en-US/docs/Web/API/AesGcmParams#properties)\n\t\tconst iv = window.crypto.getRandomValues(new Uint8Array(AESConstants.IV_LENGTH));\n\t\t// crypto.getRandomValues isn't a good-enough PRNG to generate crypto keys, so we need to use crypto.subtle.generateKey and export the key instead\n\t\tconst clientKeyObj = await window.crypto.subtle.generateKey(\n\t\t\t{ name: AESConstants.ALGORITHM as const, length: AESConstants.KEY_LENGTH as const },\n\t\t\ttrue,\n\t\t\t['encrypt', 'decrypt']\n\t\t);\n\n\t\tconst clientKey = new Uint8Array(await window.crypto.subtle.exportKey('raw', clientKeyObj));\n\t\tconst key = await this.getKey(clientKey);\n\t\tconst dataUint8Array = new TextEncoder().encode(data);\n\t\tconst cipherText: ArrayBuffer = await window.crypto.subtle.encrypt(\n\t\t\t{ name: AESConstants.ALGORITHM as const, iv },\n\t\t\tkey,\n\t\t\tdataUint8Array\n\t\t);\n\n\t\t// Base64 encode the result and store the ciphertext, the key, and the IV in localStorage\n\t\t// Note that the clientKey and IV don't need to be secret\n\t\tconst result = new Uint8Array([...clientKey, ...iv, ...new Uint8Array(cipherText)]);\n\t\treturn encodeBase64(VSBuffer.wrap(result));\n\t}\n\n\tasync unseal(data: string): Promise<string> {\n\t\t// encrypted should contain, in order: the key (32-byte), the IV for AES-GCM (12-byte) and the ciphertext (which has the GCM auth tag at the end)\n\t\t// Minimum length must be 44 (key+IV length) + 16 bytes (1 block encrypted with AES - regardless of key size)\n\t\tconst dataUint8Array = decodeBase64(data);\n\n\t\tif (dataUint8Array.byteLength < 60) {\n\t\t\tthrow Error('Invalid length for the value for credentials.crypto');\n\t\t}\n\n\t\tconst keyLength = AESConstants.KEY_LENGTH / 8;\n\t\tconst clientKey = dataUint8Array.slice(0, keyLength);\n\t\tconst iv = dataUint8Array.slice(keyLength, keyLength + AESConstants.IV_LENGTH);\n\t\tconst cipherText = dataUint8Array.slice(keyLength + AESConstants.IV_LENGTH);\n\n\t\t// Do the decryption and parse the result as JSON\n\t\tconst key = await this.getKey(clientKey.buffer);\n\t\tconst decrypted = await window.crypto.subtle.decrypt(\n\t\t\t{ name: AESConstants.ALGORITHM as const, iv: iv.buffer },\n\t\t\tkey,\n\t\t\tcipherText.buffer\n\t\t);\n\n\t\treturn new TextDecoder().decode(new Uint8Array(decrypted));\n\t}\n\n\t/**\n\t * Given a clientKey, returns the CryptoKey object that is used to encrypt/decrypt the data.\n\t * The actual key is (clientKey XOR serverKey)\n\t */\n\tprivate async getKey(clientKey: Uint8Array): Promise<CryptoKey> {\n\t\tif (!clientKey || clientKey.byteLength !== AESConstants.KEY_LENGTH / 8) {\n\t\t\tthrow Error('Invalid length for clientKey');\n\t\t}\n\n\t\tconst serverKey = await this.getServerKeyPart();\n\t\tconst keyData = new Uint8Array(AESConstants.KEY_LENGTH / 8);\n\n\t\tfor (let i = 0; i < keyData.byteLength; i++) {\n\t\t\tkeyData[i] = clientKey[i]! ^ serverKey[i]!;\n\t\t}\n\n\t\treturn window.crypto.subtle.importKey(\n\t\t\t'raw',\n\t\t\tkeyData,\n\t\t\t{\n\t\t\t\tname: AESConstants.ALGORITHM as const,\n\t\t\t\tlength: AESConstants.KEY_LENGTH as const,\n\t\t\t},\n\t\t\ttrue,\n\t\t\t['encrypt', 'decrypt']\n\t\t);\n\t}\n\n\tprivate async getServerKeyPart(): Promise<Uint8Array> {\n\t\tif (this._serverKey) {\n\t\t\treturn this._serverKey;\n\t\t}\n\n\t\tlet attempt = 0;\n\t\tlet lastError: unknown | undefined;\n\n\t\twhile (attempt <= 3) {\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(this.authEndpoint, { credentials: 'include', method: 'POST' });\n\t\t\t\tif (!res.ok) {\n\t\t\t\t\tthrow new Error(res.statusText);\n\t\t\t\t}\n\t\t\t\tconst serverKey = new Uint8Array(await await res.arrayBuffer());\n\t\t\t\tif (serverKey.byteLength !== AESConstants.KEY_LENGTH / 8) {\n\t\t\t\t\tthrow Error(`The key retrieved by the server is not ${AESConstants.KEY_LENGTH} bit long.`);\n\t\t\t\t}\n\t\t\t\tthis._serverKey = serverKey;\n\t\t\t\treturn this._serverKey;\n\t\t\t} catch (e) {\n\t\t\t\tlastError = e;\n\t\t\t\tattempt++;\n\n\t\t\t\t// exponential backoff\n\t\t\t\tawait new Promise(resolve => setTimeout(resolve, attempt * attempt * 100));\n\t\t\t}\n\t\t}\n\n\t\tthrow lastError;\n\t}\n}\n\nexport class LocalStorageSecretStorageProvider implements ISecretStorageProvider {\n\tprivate readonly _storageKey = 'secrets.provider';\n\n\tprivate _secretsPromise: Promise<Record<string, string>> = this.load();\n\n\ttype: 'in-memory' | 'persisted' | 'unknown' = 'persisted';\n\n\tconstructor(\n\t\tprivate readonly crypto: ISecretStorageCrypto,\n\t) { }\n\n\tprivate async load(): Promise<Record<string, string>> {\n\t\tconst record = this.loadAuthSessionFromElement();\n\t\t// Get the secrets from localStorage\n\t\tconst encrypted = window.localStorage.getItem(this._storageKey);\n\t\tif (encrypted) {\n\t\t\ttry {\n\t\t\t\tconst decrypted = JSON.parse(await this.crypto.unseal(encrypted));\n\t\t\t\treturn { ...record, ...decrypted };\n\t\t\t} catch (err) {\n\t\t\t\t// TODO: send telemetry\n\t\t\t\tconsole.error('Failed to decrypt secrets from localStorage', err);\n\t\t\t\twindow.localStorage.removeItem(this._storageKey);\n\t\t\t}\n\t\t}\n\n\t\treturn record;\n\t}\n\n\tprivate loadAuthSessionFromElement(): Record<string, string> {\n\t\tlet authSessionInfo: (AuthenticationSessionInfo & { scopes: string[][] }) | undefined;\n\t\tconst authSessionElement = document.getElementById('vscode-workbench-auth-session');\n\t\tconst authSessionElementAttribute = authSessionElement ? authSessionElement.getAttribute('data-settings') : undefined;\n\t\tif (authSessionElementAttribute) {\n\t\t\ttry {\n\t\t\t\tauthSessionInfo = JSON.parse(authSessionElementAttribute);\n\t\t\t} catch (error) { /* Invalid session is passed. Ignore. */ }\n\t\t}\n\n\t\tif (!authSessionInfo) {\n\t\t\treturn {};\n\t\t}\n\n\t\tconst record: Record<string, string> = {};\n\n\t\t// Settings Sync Entry\n\t\trecord[`${product.urlProtocol}.loginAccount`] = JSON.stringify(authSessionInfo);\n\n\t\t// Auth extension Entry\n\t\tif (authSessionInfo.providerId !== 'github') {\n\t\t\tconsole.error(`Unexpected auth provider: ${authSessionInfo.providerId}. Expected 'github'.`);\n\t\t\treturn record;\n\t\t}\n\n\t\tconst authAccount = JSON.stringify({ extensionId: 'vscode.github-authentication', key: 'github.auth' });\n\t\trecord[authAccount] = JSON.stringify(authSessionInfo.scopes.map(scopes => ({\n\t\t\tid: authSessionInfo!.id,\n\t\t\tscopes,\n\t\t\taccessToken: authSessionInfo!.accessToken\n\t\t})));\n\n\t\treturn record;\n\t}\n\n\tasync get(key: string): Promise<string | undefined> {\n\t\tconst secrets = await this._secretsPromise;\n\t\treturn secrets[key];\n\t}\n\tasync set(key: string, value: string): Promise<void> {\n\t\tconst secrets = await this._secretsPromise;\n\t\tsecrets[key] = value;\n\t\tthis._secretsPromise = Promise.resolve(secrets);\n\t\tthis.save();\n\t}\n\tasync delete(key: string): Promise<void> {\n\t\tconst secrets = await this._secretsPromise;\n\t\tdelete secrets[key];\n\t\tthis._secretsPromise = Promise.resolve(secrets);\n\t\tthis.save();\n\t}\n\n\tprivate async save(): Promise<void> {\n\t\ttry {\n\t\t\tconst encrypted = await this.crypto.seal(JSON.stringify(await this._secretsPromise));\n\t\t\twindow.localStorage.setItem(this._storageKey, encrypted);\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\t\t}\n\t}\n}\n\n\nclass LocalStorageURLCallbackProvider extends Disposable implements IURLCallbackProvider {\n\n\tprivate static REQUEST_ID = 0;\n\n\tprivate static QUERY_KEYS: ('scheme' | 'authority' | 'path' | 'query' | 'fragment')[] = [\n\t\t'scheme',\n\t\t'authority',\n\t\t'path',\n\t\t'query',\n\t\t'fragment'\n\t];\n\n\tprivate readonly _onCallback = this._register(new Emitter<URI>());\n\treadonly onCallback = this._onCallback.event;\n\n\tprivate pendingCallbacks = new Set<number>();\n\tprivate lastTimeChecked = Date.now();\n\tprivate checkCallbacksTimeout: unknown | undefined = undefined;\n\tprivate onDidChangeLocalStorageDisposable: IDisposable | undefined;\n\n\tconstructor(private readonly _callbackRoute: string) {\n\t\tsuper();\n\t}\n\n\tcreate(options: Partial<UriComponents> = {}): URI {\n\t\tconst id = ++LocalStorageURLCallbackProvider.REQUEST_ID;\n\t\tconst queryParams: string[] = [`vscode-reqid=${id}`];\n\n\t\tfor (const key of LocalStorageURLCallbackProvider.QUERY_KEYS) {\n\t\t\tconst value = options[key];\n\n\t\t\tif (value) {\n\t\t\t\tqueryParams.push(`vscode-${key}=${encodeURIComponent(value)}`);\n\t\t\t}\n\t\t}\n\n\t\t// TODO@joao remove eventually\n\t\t// https://github.com/microsoft/vscode-dev/issues/62\n\t\t// https://github.com/microsoft/vscode/blob/159479eb5ae451a66b5dac3c12d564f32f454796/extensions/github-authentication/src/githubServer.ts#L50-L50\n\t\tif (!(options.authority === 'vscode.github-authentication' && options.path === '/dummy')) {\n\t\t\tconst key = `vscode-web.url-callbacks[${id}]`;\n\t\t\twindow.localStorage.removeItem(key);\n\n\t\t\tthis.pendingCallbacks.add(id);\n\t\t\tthis.startListening();\n\t\t}\n\n\t\treturn URI.parse(window.location.href).with({ path: this._callbackRoute, query: queryParams.join('&') });\n\t}\n\n\tprivate startListening(): void {\n\t\tif (this.onDidChangeLocalStorageDisposable) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst fn = () => this.onDidChangeLocalStorage();\n\t\twindow.addEventListener('storage', fn);\n\t\tthis.onDidChangeLocalStorageDisposable = { dispose: () => window.removeEventListener('storage', fn) };\n\t}\n\n\tprivate stopListening(): void {\n\t\tthis.onDidChangeLocalStorageDisposable?.dispose();\n\t\tthis.onDidChangeLocalStorageDisposable = undefined;\n\t}\n\n\t// this fires every time local storage changes, but we\n\t// don't want to check more often than once a second\n\tprivate async onDidChangeLocalStorage(): Promise<void> {\n\t\tconst ellapsed = Date.now() - this.lastTimeChecked;\n\n\t\tif (ellapsed > 1000) {\n\t\t\tthis.checkCallbacks();\n\t\t} else if (this.checkCallbacksTimeout === undefined) {\n\t\t\tthis.checkCallbacksTimeout = setTimeout(() => {\n\t\t\t\tthis.checkCallbacksTimeout = undefined;\n\t\t\t\tthis.checkCallbacks();\n\t\t\t}, 1000 - ellapsed);\n\t\t}\n\t}\n\n\tprivate checkCallbacks(): void {\n\t\tlet pendingCallbacks: Set<number> | undefined;\n\n\t\tfor (const id of this.pendingCallbacks) {\n\t\t\tconst key = `vscode-web.url-callbacks[${id}]`;\n\t\t\tconst result = window.localStorage.getItem(key);\n\n\t\t\tif (result !== null) {\n\t\t\t\ttry {\n\t\t\t\t\tthis._onCallback.fire(URI.revive(JSON.parse(result)));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t}\n\n\t\t\t\tpendingCallbacks = pendingCallbacks ?? new Set(this.pendingCallbacks);\n\t\t\t\tpendingCallbacks.delete(id);\n\t\t\t\twindow.localStorage.removeItem(key);\n\t\t\t}\n\t\t}\n\n\t\tif (pendingCallbacks) {\n\t\t\tthis.pendingCallbacks = pendingCallbacks;\n\n\t\t\tif (this.pendingCallbacks.size === 0) {\n\t\t\t\tthis.stopListening();\n\t\t\t}\n\t\t}\n\n\t\tthis.lastTimeChecked = Date.now();\n\t}\n}\n\nclass WorkspaceProvider implements IWorkspaceProvider {\n\n\tprivate static QUERY_PARAM_EMPTY_WINDOW = 'ew';\n\tprivate static QUERY_PARAM_FOLDER = 'folder';\n\tprivate static QUERY_PARAM_WORKSPACE = 'workspace';\n\n\tprivate static QUERY_PARAM_PAYLOAD = 'payload';\n\n\tstatic create(config: IWorkbenchConstructionOptions & { folderUri?: UriComponents; workspaceUri?: UriComponents }) {\n\t\tlet foundWorkspace = false;\n\t\tlet workspace: IWorkspace;\n\t\tlet payload = Object.create(null);\n\n\t\tconst query = new URL(document.location.href).searchParams;\n\t\tquery.forEach((value, key) => {\n\t\t\tswitch (key) {\n\n\t\t\t\t// Folder\n\t\t\t\tcase WorkspaceProvider.QUERY_PARAM_FOLDER:\n\t\t\t\t\tif (config.remoteAuthority && value.startsWith(posix.sep)) {\n\t\t\t\t\t\t// when connected to a remote and having a value\n\t\t\t\t\t\t// that is a path (begins with a `/`), assume this\n\t\t\t\t\t\t// is a vscode-remote resource as simplified URL.\n\t\t\t\t\t\tworkspace = { folderUri: URI.from({ scheme: Schemas.vscodeRemote, path: value, authority: config.remoteAuthority }) };\n\t\t\t\t\t} else {\n\t\t\t\t\t\tworkspace = { folderUri: URI.parse(value) };\n\t\t\t\t\t}\n\t\t\t\t\tfoundWorkspace = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Workspace\n\t\t\t\tcase WorkspaceProvider.QUERY_PARAM_WORKSPACE:\n\t\t\t\t\tif (config.remoteAuthority && value.startsWith(posix.sep)) {\n\t\t\t\t\t\t// when connected to a remote and having a value\n\t\t\t\t\t\t// that is a path (begins with a `/`), assume this\n\t\t\t\t\t\t// is a vscode-remote resource as simplified URL.\n\t\t\t\t\t\tworkspace = { workspaceUri: URI.from({ scheme: Schemas.vscodeRemote, path: value, authority: config.remoteAuthority }) };\n\t\t\t\t\t} else {\n\t\t\t\t\t\tworkspace = { workspaceUri: URI.parse(value) };\n\t\t\t\t\t}\n\t\t\t\t\tfoundWorkspace = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Empty\n\t\t\t\tcase WorkspaceProvider.QUERY_PARAM_EMPTY_WINDOW:\n\t\t\t\t\tworkspace = undefined;\n\t\t\t\t\tfoundWorkspace = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Payload\n\t\t\t\tcase WorkspaceProvider.QUERY_PARAM_PAYLOAD:\n\t\t\t\t\ttry {\n\t\t\t\t\t\tpayload = parse(value); // use marshalling#parse() to revive potential URIs\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error(error); // possible invalid JSON\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\t// If no workspace is provided through the URL, check for config\n\t\t// attribute from server\n\t\tif (!foundWorkspace) {\n\t\t\tif (config.folderUri) {\n\t\t\t\tworkspace = { folderUri: URI.revive(config.folderUri) };\n\t\t\t} else if (config.workspaceUri) {\n\t\t\t\tworkspace = { workspaceUri: URI.revive(config.workspaceUri) };\n\t\t\t}\n\t\t}\n\n\t\treturn new WorkspaceProvider(workspace, payload, config);\n\t}\n\n\treadonly trusted = true;\n\n\tprivate constructor(\n\t\treadonly workspace: IWorkspace,\n\t\treadonly payload: object,\n\t\tprivate readonly config: IWorkbenchConstructionOptions\n\t) {\n\t}\n\n\tasync open(workspace: IWorkspace, options?: { reuse?: boolean; payload?: object }): Promise<boolean> {\n\t\tif (options?.reuse && !options.payload && this.isSame(this.workspace, workspace)) {\n\t\t\treturn true; // return early if workspace and environment is not changing and we are reusing window\n\t\t}\n\n\t\tconst targetHref = this.createTargetUrl(workspace, options);\n\t\tif (targetHref) {\n\t\t\tif (options?.reuse) {\n\t\t\t\twindow.location.href = targetHref;\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tlet result;\n\t\t\t\tif (isStandalone()) {\n\t\t\t\t\tresult = window.open(targetHref, '_blank', 'toolbar=no'); // ensures to open another 'standalone' window!\n\t\t\t\t} else {\n\t\t\t\t\tresult = window.open(targetHref);\n\t\t\t\t}\n\n\t\t\t\treturn !!result;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate createTargetUrl(workspace: IWorkspace, options?: { reuse?: boolean; payload?: object }): string | undefined {\n\n\t\t// Empty\n\t\tlet targetHref: string | undefined = undefined;\n\t\tif (!workspace) {\n\t\t\ttargetHref = `${document.location.origin}${document.location.pathname}?${WorkspaceProvider.QUERY_PARAM_EMPTY_WINDOW}=true`;\n\t\t}\n\n\t\t// Folder\n\t\telse if (isFolderToOpen(workspace)) {\n\t\t\tconst queryParamFolder = this.encodeWorkspacePath(workspace.folderUri);\n\t\t\ttargetHref = `${document.location.origin}${document.location.pathname}?${WorkspaceProvider.QUERY_PARAM_FOLDER}=${queryParamFolder}`;\n\t\t}\n\n\t\t// Workspace\n\t\telse if (isWorkspaceToOpen(workspace)) {\n\t\t\tconst queryParamWorkspace = this.encodeWorkspacePath(workspace.workspaceUri);\n\t\t\ttargetHref = `${document.location.origin}${document.location.pathname}?${WorkspaceProvider.QUERY_PARAM_WORKSPACE}=${queryParamWorkspace}`;\n\t\t}\n\n\t\t// Append payload if any\n\t\tif (options?.payload) {\n\t\t\ttargetHref += `&${WorkspaceProvider.QUERY_PARAM_PAYLOAD}=${encodeURIComponent(JSON.stringify(options.payload))}`;\n\t\t}\n\n\t\treturn targetHref;\n\t}\n\n\tprivate encodeWorkspacePath(uri: URI): string {\n\t\tif (this.config.remoteAuthority && uri.scheme === Schemas.vscodeRemote) {\n\n\t\t\t// when connected to a remote and having a folder\n\t\t\t// or workspace for that remote, only use the path\n\t\t\t// as query value to form shorter, nicer URLs.\n\t\t\t// however, we still need to `encodeURIComponent`\n\t\t\t// to ensure to preserve special characters, such\n\t\t\t// as `+` in the path.\n\n\t\t\treturn encodeURIComponent(`${posix.sep}${ltrim(uri.path, posix.sep)}`).replaceAll('%2F', '/');\n\t\t}\n\n\t\treturn encodeURIComponent(uri.toString(true));\n\t}\n\n\tprivate isSame(workspaceA: IWorkspace, workspaceB: IWorkspace): boolean {\n\t\tif (!workspaceA || !workspaceB) {\n\t\t\treturn workspaceA === workspaceB; // both empty\n\t\t}\n\n\t\tif (isFolderToOpen(workspaceA) && isFolderToOpen(workspaceB)) {\n\t\t\treturn isEqual(workspaceA.folderUri, workspaceB.folderUri); // same workspace\n\t\t}\n\n\t\tif (isWorkspaceToOpen(workspaceA) && isWorkspaceToOpen(workspaceB)) {\n\t\t\treturn isEqual(workspaceA.workspaceUri, workspaceB.workspaceUri); // same workspace\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thasRemote(): boolean {\n\t\tif (this.workspace) {\n\t\t\tif (isFolderToOpen(this.workspace)) {\n\t\t\t\treturn this.workspace.folderUri.scheme === Schemas.vscodeRemote;\n\t\t\t}\n\n\t\t\tif (isWorkspaceToOpen(this.workspace)) {\n\t\t\t\treturn this.workspace.workspaceUri.scheme === Schemas.vscodeRemote;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n}\n\nfunction readCookie(name: string): string | undefined {\n\tconst cookies = document.cookie.split('; ');\n\tfor (const cookie of cookies) {\n\t\tif (cookie.startsWith(name + '=')) {\n\t\t\treturn cookie.substring(name.length + 1);\n\t\t}\n\t}\n\n\treturn undefined;\n}\n\n(function () {\n\n\t// Find config by checking for DOM\n\tconst configElement = document.getElementById('vscode-workbench-web-configuration');\n\tconst configElementAttribute = configElement ? configElement.getAttribute('data-settings') : undefined;\n\tif (!configElement || !configElementAttribute) {\n\t\tthrow new Error('Missing web configuration element');\n\t}\n\tconst originalConfig: IWorkbenchConstructionOptions & { folderUri?: UriComponents; workspaceUri?: UriComponents; callbackRoute: string } = JSON.parse(configElementAttribute);\n\tconst secretStorageKeyPath = readCookie('vscode-secret-key-path');\n\tconst secretStorageCrypto = secretStorageKeyPath && ServerKeyedAESCrypto.supported()\n\t\t? new ServerKeyedAESCrypto(secretStorageKeyPath) : new TransparentCrypto();\n\tconst config: IWorkbenchConstructionOptions & { folderUri?: UriComponents; workspaceUri?: UriComponents; callbackRoute: string } = {\n\t\t...originalConfig,\n\t\tremoteAuthority: window.location.host,\n\t};\n\n\t// Create workbench\n\tcreate(document.body, {\n\t\t...config,\n\t\twindowIndicator: config.windowIndicator ?? { label: '$(remote)', tooltip: `${product.nameShort} Web` },\n\t\tsettingsSyncOptions: config.settingsSyncOptions ? { enabled: config.settingsSyncOptions.enabled, } : undefined,\n\t\tworkspaceProvider: WorkspaceProvider.create(config),\n\t\turlCallbackProvider: new LocalStorageURLCallbackProvider(config.callbackRoute),\n\t\tsecretStorageProvider: config.remoteAuthority && !secretStorageKeyPath\n\t\t\t? undefined /* with a remote without embedder-preferred storage, store on the remote */\n\t\t\t: new LocalStorageSecretStorageProvider(secretStorageCrypto),\n\t});\n})();\n"]}