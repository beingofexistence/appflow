{"version":3,"sources":["file:///workspace/appflow/src/vs/platform/contextview/browser/contextMenuHandler.ts"],"names":[],"mappings":"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","file":"contextMenuHandler.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IContextMenuDelegate } from 'vs/base/browser/contextmenu';\nimport { $, addDisposableListener, EventType, getActiveElement, isAncestor, isHTMLElement } from 'vs/base/browser/dom';\nimport { StandardMouseEvent } from 'vs/base/browser/mouseEvent';\nimport { Menu } from 'vs/base/browser/ui/menu/menu';\nimport { ActionRunner, IRunEvent, WorkbenchActionExecutedClassification, WorkbenchActionExecutedEvent } from 'vs/base/common/actions';\nimport { isCancellationError } from 'vs/base/common/errors';\nimport { combinedDisposable, DisposableStore, IDisposable } from 'vs/base/common/lifecycle';\nimport { IContextViewService } from 'vs/platform/contextview/browser/contextView';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { defaultMenuStyles } from 'vs/platform/theme/browser/defaultStyles';\n\n\nexport interface IContextMenuHandlerOptions {\n\tblockMouse: boolean;\n}\n\nexport class ContextMenuHandler {\n\tprivate focusToReturn: HTMLElement | null = null;\n\tprivate lastContainer: HTMLElement | null = null;\n\tprivate block: HTMLElement | null = null;\n\tprivate blockDisposable: IDisposable | null = null;\n\tprivate options: IContextMenuHandlerOptions = { blockMouse: true };\n\n\tconstructor(\n\t\tprivate contextViewService: IContextViewService,\n\t\tprivate telemetryService: ITelemetryService,\n\t\tprivate notificationService: INotificationService,\n\t\tprivate keybindingService: IKeybindingService,\n\t) { }\n\n\tconfigure(options: IContextMenuHandlerOptions): void {\n\t\tthis.options = options;\n\t}\n\n\tshowContextMenu(delegate: IContextMenuDelegate): void {\n\t\tconst actions = delegate.getActions();\n\t\tif (!actions.length) {\n\t\t\treturn; // Don't render an empty context menu\n\t\t}\n\n\t\tthis.focusToReturn = document.activeElement as HTMLElement;\n\n\t\tlet menu: Menu | undefined;\n\n\t\tconst shadowRootElement = isHTMLElement(delegate.domForShadowRoot) ? delegate.domForShadowRoot : undefined;\n\t\tthis.contextViewService.showContextView({\n\t\t\tgetAnchor: () => delegate.getAnchor(),\n\t\t\tcanRelayout: false,\n\t\t\tanchorAlignment: delegate.anchorAlignment,\n\t\t\tanchorAxisAlignment: delegate.anchorAxisAlignment,\n\n\t\t\trender: (container) => {\n\t\t\t\tthis.lastContainer = container;\n\t\t\t\tconst className = delegate.getMenuClassName ? delegate.getMenuClassName() : '';\n\n\t\t\t\tif (className) {\n\t\t\t\t\tcontainer.className += ' ' + className;\n\t\t\t\t}\n\n\t\t\t\t// Render invisible div to block mouse interaction in the rest of the UI\n\t\t\t\tif (this.options.blockMouse) {\n\t\t\t\t\tthis.block = container.appendChild($('.context-view-block'));\n\t\t\t\t\tthis.block.style.position = 'fixed';\n\t\t\t\t\tthis.block.style.cursor = 'initial';\n\t\t\t\t\tthis.block.style.left = '0';\n\t\t\t\t\tthis.block.style.top = '0';\n\t\t\t\t\tthis.block.style.width = '100%';\n\t\t\t\t\tthis.block.style.height = '100%';\n\t\t\t\t\tthis.block.style.zIndex = '-1';\n\n\t\t\t\t\tthis.blockDisposable?.dispose();\n\t\t\t\t\tthis.blockDisposable = addDisposableListener(this.block, EventType.MOUSE_DOWN, e => e.stopPropagation());\n\t\t\t\t}\n\n\t\t\t\tconst menuDisposables = new DisposableStore();\n\n\t\t\t\tconst actionRunner = delegate.actionRunner || new ActionRunner();\n\t\t\t\tactionRunner.onWillRun(evt => this.onActionRun(evt, !delegate.skipTelemetry), this, menuDisposables);\n\t\t\t\tactionRunner.onDidRun(this.onDidActionRun, this, menuDisposables);\n\t\t\t\tmenu = new Menu(container, actions, {\n\t\t\t\t\tactionViewItemProvider: delegate.getActionViewItem,\n\t\t\t\t\tcontext: delegate.getActionsContext ? delegate.getActionsContext() : null,\n\t\t\t\t\tactionRunner,\n\t\t\t\t\tgetKeyBinding: delegate.getKeyBinding ? delegate.getKeyBinding : action => this.keybindingService.lookupKeybinding(action.id)\n\t\t\t\t},\n\t\t\t\t\tdefaultMenuStyles\n\t\t\t\t);\n\n\t\t\t\tmenu.onDidCancel(() => this.contextViewService.hideContextView(true), null, menuDisposables);\n\t\t\t\tmenu.onDidBlur(() => this.contextViewService.hideContextView(true), null, menuDisposables);\n\t\t\t\tmenuDisposables.add(addDisposableListener(window, EventType.BLUR, () => this.contextViewService.hideContextView(true)));\n\t\t\t\tmenuDisposables.add(addDisposableListener(window, EventType.MOUSE_DOWN, (e: MouseEvent) => {\n\t\t\t\t\tif (e.defaultPrevented) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst event = new StandardMouseEvent(e);\n\t\t\t\t\tlet element: HTMLElement | null = event.target;\n\n\t\t\t\t\t// Don't do anything as we are likely creating a context menu\n\t\t\t\t\tif (event.rightButton) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (element) {\n\t\t\t\t\t\tif (element === container) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\telement = element.parentElement;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.contextViewService.hideContextView(true);\n\t\t\t\t}));\n\n\t\t\t\treturn combinedDisposable(menuDisposables, menu);\n\t\t\t},\n\n\t\t\tfocus: () => {\n\t\t\t\tmenu?.focus(!!delegate.autoSelectFirstItem);\n\t\t\t},\n\n\t\t\tonHide: (didCancel?: boolean) => {\n\t\t\t\tdelegate.onHide?.(!!didCancel);\n\n\t\t\t\tif (this.block) {\n\t\t\t\t\tthis.block.remove();\n\t\t\t\t\tthis.block = null;\n\t\t\t\t}\n\n\t\t\t\tthis.blockDisposable?.dispose();\n\t\t\t\tthis.blockDisposable = null;\n\n\t\t\t\tif (!!this.lastContainer && (getActiveElement() === this.lastContainer || isAncestor(getActiveElement(), this.lastContainer))) {\n\t\t\t\t\tthis.focusToReturn?.focus();\n\t\t\t\t}\n\n\t\t\t\tthis.lastContainer = null;\n\t\t\t}\n\t\t}, shadowRootElement, !!shadowRootElement);\n\t}\n\n\tprivate onActionRun(e: IRunEvent, logTelemetry: boolean): void {\n\t\tif (logTelemetry) {\n\t\t\tthis.telemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>('workbenchActionExecuted', { id: e.action.id, from: 'contextMenu' });\n\t\t}\n\n\t\tthis.contextViewService.hideContextView(false);\n\t}\n\n\tprivate onDidActionRun(e: IRunEvent): void {\n\t\tif (e.error && !isCancellationError(e.error)) {\n\t\t\tthis.notificationService.error(e.error);\n\t\t}\n\t}\n}\n"]}