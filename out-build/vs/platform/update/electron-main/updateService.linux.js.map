{"version":3,"sources":["file:///workspace/appflow/src/vs/platform/update/electron-main/updateService.linux.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IAczF,IAAM,IAAI,GAAV,MAAM,IAAmB,SAAQ,4BAAI;QAE3C,YACwB,oBAA0B,EAC1B,oBAAyB,EACZ,CAAqB,EAChC,sBAA4B,EACpC,cAAmB,EACvB,UAAe,EACa,CAA2B,EACnD,cAAmB;YAEpC,KAAK,CAAC,oBAAoB,EAAE,oBAAoB,EAAE,sBAAsB,EAAE,cAAc,EAAE,UAAU,EAAE,cAAc,CAAC,CAAC;YAPlF,MAAC,GAAD,CAAC,CAAoB;YAIhB,MAAC,GAAD,CAAC,CAA0B;QAIrE,CAAC;QAES,CAAC,CAAkB,OAAe;YAC3C,OAAO,IAAA,4BAAI,EAAY,SAAS,OAAO,CAAC,IAAI,EAAE,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC,CAAc,CAAC;QAC/E,CAAC;QAES,CAAC,CAAiB,OAAY;YACvC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAI;gBACd,OAAO;aACP;YAED,IAAI,CAAC,CAAC,CAAQ,YAAG,CAAG,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC;YACjD,IAAI,CAAC,CAAC,CAAc,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC,EAAI,EAAE,gCAAiB,CAAC,IAAI,CAAC;iBACpE,IAAI,CAAiB,aAAG,CAAI;iBAC5B,IAAI,CAAC,MAAM,CAAC,EAAE;gBACd,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE;oBACxE,IAAI,CAAC,CAAC,CAAgB,UAAU,CAA0D,qBAAqB,EAAE,EAAE,QAAQ,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC;oBAE1I,IAAI,CAAC,CAAC,CAAQ,YAAG,CAAG,IAAI,4BAAoB,CAAC,CAAC;iBAC9C;qBAAM;oBACN,IAAI,CAAC,CAAC,CAAQ,YAAG,CAAG,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC;iBAClD;YACF,CAAC,CAAC;iBACD,IAAI,CAAC,SAAS,EAAE,GAAG,CAAC,EAAE;gBACtB,IAAI,CAAC,CAAC,CAAU,KAAK,CAAC,GAAG,CAAC,CAAC;gBAC3B,IAAI,CAAC,CAAC,CAAgB,UAAU,CAA0D,qBAAqB,EAAE,EAAE,QAAQ,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC;gBAC1I,yDAAyD;gBACzD,MAAM,OAAO,GAAuB,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;gBACjF,IAAI,CAAC,CAAC,CAAQ,YAAG,CAAG,IAAI,6BAAqB,OAAO,CAAC,CAAC,CAAC;YACxD,CAAC,CAAC,CAAC;QACL,CAAC;QAEkB,KAAK,CAAC,CAAC,CAAgB,KAA2B;YACpE,2FAA2F;YAC3F,qFAAqF;YACrF,IAAI,IAAI,CAAC,CAAC,CAAc,WAAW,IAAI,IAAI,CAAC,CAAC,CAAc,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE;gBAClF,IAAI,CAAC,CAAC,CAAqB,YAAY,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC,CAAc,WAAW,CAAC,CAAC;aACpF;iBAAM,IAAI,KAAK,CAAC,MAAM,CAAC,GAAG,EAAE;gBAC5B,IAAI,CAAC,CAAC,CAAqB,YAAY,CAAC,SAAS,EAAE,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;aACrE;YAED,IAAI,CAAC,CAAC,CAAQ,YAAG,CAAG,IAAI,4BAAoB,CAAC,CAAC;QAC/C,CAAC;KACD,CAAA;IAxDY,oBAAI;mBAAJ,IAAI;QAGd,WAAA,2BAAI,CAAA;QACJ,WAAA,mBAAG,CAAA;QACH,WAAA,eAAG,CAAA;QACH,WAAA,6BAAI,CAAA;QACJ,WAAA,aAAG,CAAA;QACH,WAAA,SAAG,CAAA;QACH,WAAA,4BAAI,CAAA;QACJ,WAAA,oBAAG,CAAA;OAVO,IAAI,CAwDhB","file":"updateService.linux.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IEnvironmentMainService } from 'vs/platform/environment/electron-main/environmentMainService';\nimport { ILifecycleMainService } from 'vs/platform/lifecycle/electron-main/lifecycleMainService';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { INativeHostMainService } from 'vs/platform/native/electron-main/nativeHostMainService';\nimport { IProductService } from 'vs/platform/product/common/productService';\nimport { asJson, IRequestService } from 'vs/platform/request/common/request';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { AvailableForDownload, IUpdate, State, UpdateType } from 'vs/platform/update/common/update';\nimport { AbstractUpdateService, createUpdateURL, UpdateNotAvailableClassification } from 'vs/platform/update/electron-main/abstractUpdateService';\n\nexport class LinuxUpdateService extends AbstractUpdateService {\n\n\tconstructor(\n\t\t@ILifecycleMainService lifecycleMainService: ILifecycleMainService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IEnvironmentMainService environmentMainService: IEnvironmentMainService,\n\t\t@IRequestService requestService: IRequestService,\n\t\t@ILogService logService: ILogService,\n\t\t@INativeHostMainService private readonly nativeHostMainService: INativeHostMainService,\n\t\t@IProductService productService: IProductService\n\t) {\n\t\tsuper(lifecycleMainService, configurationService, environmentMainService, requestService, logService, productService);\n\t}\n\n\tprotected buildUpdateFeedUrl(quality: string): string {\n\t\treturn createUpdateURL(`linux-${process.arch}`, quality, this.productService);\n\t}\n\n\tprotected doCheckForUpdates(context: any): void {\n\t\tif (!this.url) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setState(State.CheckingForUpdates(context));\n\t\tthis.requestService.request({ url: this.url }, CancellationToken.None)\n\t\t\t.then<IUpdate | null>(asJson)\n\t\t\t.then(update => {\n\t\t\t\tif (!update || !update.url || !update.version || !update.productVersion) {\n\t\t\t\t\tthis.telemetryService.publicLog2<{ explicit: boolean }, UpdateNotAvailableClassification>('update:notAvailable', { explicit: !!context });\n\n\t\t\t\t\tthis.setState(State.Idle(UpdateType.Archive));\n\t\t\t\t} else {\n\t\t\t\t\tthis.setState(State.AvailableForDownload(update));\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(undefined, err => {\n\t\t\t\tthis.logService.error(err);\n\t\t\t\tthis.telemetryService.publicLog2<{ explicit: boolean }, UpdateNotAvailableClassification>('update:notAvailable', { explicit: !!context });\n\t\t\t\t// only show message when explicitly checking for updates\n\t\t\t\tconst message: string | undefined = !!context ? (err.message || err) : undefined;\n\t\t\t\tthis.setState(State.Idle(UpdateType.Archive, message));\n\t\t\t});\n\t}\n\n\tprotected override async doDownloadUpdate(state: AvailableForDownload): Promise<void> {\n\t\t// Use the download URL if available as we don't currently detect the package type that was\n\t\t// installed and the website download page is more useful than the tarball generally.\n\t\tif (this.productService.downloadUrl && this.productService.downloadUrl.length > 0) {\n\t\t\tthis.nativeHostMainService.openExternal(undefined, this.productService.downloadUrl);\n\t\t} else if (state.update.url) {\n\t\t\tthis.nativeHostMainService.openExternal(undefined, state.update.url);\n\t\t}\n\n\t\tthis.setState(State.Idle(UpdateType.Archive));\n\t}\n}\n"]}