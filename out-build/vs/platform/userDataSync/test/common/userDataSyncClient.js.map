{"version":3,"sources":["file:///workspace/appflow/src/vs/platform/userDataSync/test/common/userDataSyncClient.ts"],"names":[],"mappings":"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","file":"userDataSyncClient.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { bufferToStream, VSBuffer } from 'vs/base/common/buffer';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { IStringDictionary } from 'vs/base/common/collections';\nimport { Emitter } from 'vs/base/common/event';\nimport { FormattingOptions } from 'vs/base/common/jsonFormatter';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { Schemas } from 'vs/base/common/network';\nimport { joinPath } from 'vs/base/common/resources';\nimport { URI } from 'vs/base/common/uri';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { IHeaders, IRequestContext, IRequestOptions } from 'vs/base/parts/request/common/request';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { ConfigurationService } from 'vs/platform/configuration/common/configurationService';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { GlobalExtensionEnablementService } from 'vs/platform/extensionManagement/common/extensionEnablementService';\nimport { DidUninstallExtensionEvent, IExtensionGalleryService, IExtensionManagementService, IGlobalExtensionEnablementService, InstallExtensionResult } from 'vs/platform/extensionManagement/common/extensionManagement';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { FileService } from 'vs/platform/files/common/fileService';\nimport { InMemoryFileSystemProvider } from 'vs/platform/files/common/inMemoryFilesystemProvider';\nimport { TestInstantiationService } from 'vs/platform/instantiation/test/common/instantiationServiceMock';\nimport { ILogService, NullLogService } from 'vs/platform/log/common/log';\nimport product from 'vs/platform/product/common/product';\nimport { IProductService } from 'vs/platform/product/common/productService';\nimport { IRequestService } from 'vs/platform/request/common/request';\nimport { InMemoryStorageService, IStorageService } from 'vs/platform/storage/common/storage';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport { NullTelemetryService } from 'vs/platform/telemetry/common/telemetryUtils';\nimport { IUriIdentityService } from 'vs/platform/uriIdentity/common/uriIdentity';\nimport { UriIdentityService } from 'vs/platform/uriIdentity/common/uriIdentityService';\nimport { ExtensionStorageService, IExtensionStorageService } from 'vs/platform/extensionManagement/common/extensionStorage';\nimport { IgnoredExtensionsManagementService, IIgnoredExtensionsManagementService } from 'vs/platform/userDataSync/common/ignoredExtensions';\nimport { ALL_SYNC_RESOURCES, getDefaultIgnoredSettings, IUserData, IUserDataSyncLocalStoreService, IUserDataSyncLogService, IUserDataSyncEnablementService, IUserDataSyncService, IUserDataSyncStoreManagementService, IUserDataSyncStoreService, IUserDataSyncUtilService, registerConfiguration, ServerResource, SyncResource, IUserDataSynchroniser, IUserDataResourceManifest, IUserDataCollectionManifest, USER_DATA_SYNC_SCHEME } from 'vs/platform/userDataSync/common/userDataSync';\nimport { IUserDataSyncAccountService, UserDataSyncAccountService } from 'vs/platform/userDataSync/common/userDataSyncAccount';\nimport { UserDataSyncLocalStoreService } from 'vs/platform/userDataSync/common/userDataSyncLocalStoreService';\nimport { IUserDataSyncMachinesService, UserDataSyncMachinesService } from 'vs/platform/userDataSync/common/userDataSyncMachines';\nimport { UserDataSyncEnablementService } from 'vs/platform/userDataSync/common/userDataSyncEnablementService';\nimport { UserDataSyncService } from 'vs/platform/userDataSync/common/userDataSyncService';\nimport { UserDataSyncStoreManagementService, UserDataSyncStoreService } from 'vs/platform/userDataSync/common/userDataSyncStoreService';\nimport { InMemoryUserDataProfilesService, IUserDataProfile, IUserDataProfilesService } from 'vs/platform/userDataProfile/common/userDataProfile';\nimport { NullPolicyService } from 'vs/platform/policy/common/policy';\nimport { IUserDataProfileStorageService } from 'vs/platform/userDataProfile/common/userDataProfileStorageService';\nimport { TestUserDataProfileStorageService } from 'vs/platform/userDataProfile/test/common/userDataProfileStorageService.test';\n\nexport class UserDataSyncClient extends Disposable {\n\n\treadonly instantiationService: TestInstantiationService;\n\n\tconstructor(readonly testServer: UserDataSyncTestServer = new UserDataSyncTestServer()) {\n\t\tsuper();\n\t\tthis.instantiationService = this._register(new TestInstantiationService());\n\t}\n\n\tasync setUp(empty: boolean = false): Promise<void> {\n\t\tthis._register(registerConfiguration());\n\n\t\tconst logService = this.instantiationService.stub(ILogService, new NullLogService());\n\n\t\tconst userRoamingDataHome = URI.file('userdata').with({ scheme: Schemas.inMemory });\n\t\tconst userDataSyncHome = joinPath(userRoamingDataHome, '.sync');\n\t\tconst environmentService = this.instantiationService.stub(IEnvironmentService, <Partial<IEnvironmentService>>{\n\t\t\tuserDataSyncHome,\n\t\t\tuserRoamingDataHome,\n\t\t\tcacheHome: joinPath(userRoamingDataHome, 'cache'),\n\t\t\targvResource: joinPath(userRoamingDataHome, 'argv.json'),\n\t\t\tsync: 'on',\n\t\t});\n\n\t\tthis.instantiationService.stub(IProductService, {\n\t\t\t_serviceBrand: undefined, ...product, ...{\n\t\t\t\t'configurationSync.store': {\n\t\t\t\t\turl: this.testServer.url,\n\t\t\t\t\tstableUrl: this.testServer.url,\n\t\t\t\t\tinsidersUrl: this.testServer.url,\n\t\t\t\t\tcanSwitch: false,\n\t\t\t\t\tauthenticationProviders: { 'test': { scopes: [] } }\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst fileService = this._register(new FileService(logService));\n\t\tthis._register(fileService.registerProvider(Schemas.inMemory, this._register(new InMemoryFileSystemProvider())));\n\t\tthis._register(fileService.registerProvider(USER_DATA_SYNC_SCHEME, this._register(new InMemoryFileSystemProvider())));\n\t\tthis.instantiationService.stub(IFileService, fileService);\n\n\t\tconst uriIdentityService = this._register(this.instantiationService.createInstance(UriIdentityService));\n\t\tthis.instantiationService.stub(IUriIdentityService, uriIdentityService);\n\n\t\tconst userDataProfilesService = this._register(new InMemoryUserDataProfilesService(environmentService, fileService, uriIdentityService, logService));\n\t\tthis.instantiationService.stub(IUserDataProfilesService, userDataProfilesService);\n\n\t\tconst storageService = this._register(new TestStorageService(userDataProfilesService.defaultProfile));\n\t\tthis.instantiationService.stub(IStorageService, this._register(storageService));\n\t\tthis.instantiationService.stub(IUserDataProfileStorageService, this._register(new TestUserDataProfileStorageService(storageService)));\n\n\t\tconst configurationService = this._register(new ConfigurationService(userDataProfilesService.defaultProfile.settingsResource, fileService, new NullPolicyService(), logService));\n\t\tawait configurationService.initialize();\n\t\tthis.instantiationService.stub(IConfigurationService, configurationService);\n\n\t\tthis.instantiationService.stub(IRequestService, this.testServer);\n\n\t\tthis.instantiationService.stub(IUserDataSyncLogService, logService);\n\t\tthis.instantiationService.stub(ITelemetryService, NullTelemetryService);\n\t\tthis.instantiationService.stub(IUserDataSyncStoreManagementService, this._register(this.instantiationService.createInstance(UserDataSyncStoreManagementService)));\n\t\tthis.instantiationService.stub(IUserDataSyncStoreService, this._register(this.instantiationService.createInstance(UserDataSyncStoreService)));\n\n\t\tconst userDataSyncAccountService: IUserDataSyncAccountService = this._register(this.instantiationService.createInstance(UserDataSyncAccountService));\n\t\tawait userDataSyncAccountService.updateAccount({ authenticationProviderId: 'authenticationProviderId', token: 'token' });\n\t\tthis.instantiationService.stub(IUserDataSyncAccountService, userDataSyncAccountService);\n\n\t\tthis.instantiationService.stub(IUserDataSyncMachinesService, this._register(this.instantiationService.createInstance(UserDataSyncMachinesService)));\n\t\tthis.instantiationService.stub(IUserDataSyncLocalStoreService, this._register(this.instantiationService.createInstance(UserDataSyncLocalStoreService)));\n\t\tthis.instantiationService.stub(IUserDataSyncUtilService, new TestUserDataSyncUtilService());\n\t\tthis.instantiationService.stub(IUserDataSyncEnablementService, this._register(this.instantiationService.createInstance(UserDataSyncEnablementService)));\n\n\t\tthis.instantiationService.stub(IExtensionManagementService, <Partial<IExtensionManagementService>>{\n\t\t\tasync getInstalled() { return []; },\n\t\t\tonDidInstallExtensions: new Emitter<readonly InstallExtensionResult[]>().event,\n\t\t\tonDidUninstallExtension: new Emitter<DidUninstallExtensionEvent>().event,\n\t\t});\n\t\tthis.instantiationService.stub(IGlobalExtensionEnablementService, this._register(this.instantiationService.createInstance(GlobalExtensionEnablementService)));\n\t\tthis.instantiationService.stub(IExtensionStorageService, this._register(this.instantiationService.createInstance(ExtensionStorageService)));\n\t\tthis.instantiationService.stub(IIgnoredExtensionsManagementService, this.instantiationService.createInstance(IgnoredExtensionsManagementService));\n\t\tthis.instantiationService.stub(IExtensionGalleryService, <Partial<IExtensionGalleryService>>{\n\t\t\tisEnabled() { return true; },\n\t\t\tasync getCompatibleExtension() { return null; }\n\t\t});\n\n\t\tthis.instantiationService.stub(IUserDataSyncService, this._register(this.instantiationService.createInstance(UserDataSyncService)));\n\n\t\tif (!empty) {\n\t\t\tawait fileService.writeFile(userDataProfilesService.defaultProfile.settingsResource, VSBuffer.fromString(JSON.stringify({})));\n\t\t\tawait fileService.writeFile(userDataProfilesService.defaultProfile.keybindingsResource, VSBuffer.fromString(JSON.stringify([])));\n\t\t\tawait fileService.writeFile(joinPath(userDataProfilesService.defaultProfile.snippetsHome, 'c.json'), VSBuffer.fromString(`{}`));\n\t\t\tawait fileService.writeFile(userDataProfilesService.defaultProfile.tasksResource, VSBuffer.fromString(`{}`));\n\t\t\tawait fileService.writeFile(environmentService.argvResource, VSBuffer.fromString(JSON.stringify({ 'locale': 'en' })));\n\t\t}\n\t\tawait configurationService.reloadConfiguration();\n\t}\n\n\tasync sync(): Promise<void> {\n\t\tawait (await this.instantiationService.get(IUserDataSyncService).createSyncTask(null)).run();\n\t}\n\n\tread(resource: SyncResource, collection?: string): Promise<IUserData> {\n\t\treturn this.instantiationService.get(IUserDataSyncStoreService).readResource(resource, null, collection);\n\t}\n\n\tasync getResourceManifest(): Promise<IUserDataResourceManifest | null> {\n\t\tconst manifest = await this.instantiationService.get(IUserDataSyncStoreService).manifest(null);\n\t\treturn manifest?.latest ?? null;\n\t}\n\n\tgetSynchronizer(source: SyncResource): IUserDataSynchroniser {\n\t\treturn (this.instantiationService.get(IUserDataSyncService) as UserDataSyncService).getOrCreateActiveProfileSynchronizer(this.instantiationService.get(IUserDataProfilesService).defaultProfile, undefined).enabled.find(s => s.resource === source)!;\n\t}\n\n}\n\nconst ALL_SERVER_RESOURCES: ServerResource[] = [...ALL_SYNC_RESOURCES, 'machines'];\n\nexport class UserDataSyncTestServer implements IRequestService {\n\n\t_serviceBrand: any;\n\n\treadonly url: string = 'http://host:3000';\n\tprivate session: string | null = null;\n\tprivate readonly collections = new Map<string, Map<ServerResource, IUserData>>();\n\tprivate readonly data = new Map<ServerResource, IUserData>();\n\n\tprivate _requests: { url: string; type: string; headers?: IHeaders }[] = [];\n\tget requests(): { url: string; type: string; headers?: IHeaders }[] { return this._requests; }\n\n\tprivate _requestsWithAllHeaders: { url: string; type: string; headers?: IHeaders }[] = [];\n\tget requestsWithAllHeaders(): { url: string; type: string; headers?: IHeaders }[] { return this._requestsWithAllHeaders; }\n\n\tprivate _responses: { status: number }[] = [];\n\tget responses(): { status: number }[] { return this._responses; }\n\treset(): void { this._requests = []; this._responses = []; this._requestsWithAllHeaders = []; }\n\n\tprivate manifestRef = 0;\n\tprivate collectionCounter = 0;\n\n\tconstructor(private readonly rateLimit = Number.MAX_SAFE_INTEGER, private readonly retryAfter?: number) { }\n\n\tasync resolveProxy(url: string): Promise<string | undefined> { return url; }\n\n\tasync request(options: IRequestOptions, token: CancellationToken): Promise<IRequestContext> {\n\t\tif (this._requests.length === this.rateLimit) {\n\t\t\treturn this.toResponse(429, this.retryAfter ? { 'retry-after': `${this.retryAfter}` } : undefined);\n\t\t}\n\t\tconst headers: IHeaders = {};\n\t\tif (options.headers) {\n\t\t\tif (options.headers['If-None-Match']) {\n\t\t\t\theaders['If-None-Match'] = options.headers['If-None-Match'];\n\t\t\t}\n\t\t\tif (options.headers['If-Match']) {\n\t\t\t\theaders['If-Match'] = options.headers['If-Match'];\n\t\t\t}\n\t\t}\n\t\tthis._requests.push({ url: options.url!, type: options.type!, headers });\n\t\tthis._requestsWithAllHeaders.push({ url: options.url!, type: options.type!, headers: options.headers });\n\t\tconst requestContext = await this.doRequest(options);\n\t\tthis._responses.push({ status: requestContext.res.statusCode! });\n\t\treturn requestContext;\n\t}\n\n\tprivate async doRequest(options: IRequestOptions): Promise<IRequestContext> {\n\t\tconst versionUrl = `${this.url}/v1/`;\n\t\tconst relativePath = options.url!.indexOf(versionUrl) === 0 ? options.url!.substring(versionUrl.length) : undefined;\n\t\tconst segments = relativePath ? relativePath.split('/') : [];\n\t\tif (options.type === 'GET' && segments.length === 1 && segments[0] === 'manifest') {\n\t\t\treturn this.getManifest(options.headers);\n\t\t}\n\t\tif (options.type === 'GET' && segments.length === 3 && segments[0] === 'resource') {\n\t\t\treturn this.getResourceData(undefined, segments[1], segments[2] === 'latest' ? undefined : segments[2], options.headers);\n\t\t}\n\t\tif (options.type === 'POST' && segments.length === 2 && segments[0] === 'resource') {\n\t\t\treturn this.writeData(undefined, segments[1], options.data, options.headers);\n\t\t}\n\t\t// resources in collection\n\t\tif (options.type === 'GET' && segments.length === 5 && segments[0] === 'collection' && segments[2] === 'resource') {\n\t\t\treturn this.getResourceData(segments[1], segments[3], segments[4] === 'latest' ? undefined : segments[4], options.headers);\n\t\t}\n\t\tif (options.type === 'POST' && segments.length === 4 && segments[0] === 'collection' && segments[2] === 'resource') {\n\t\t\treturn this.writeData(segments[1], segments[3], options.data, options.headers);\n\t\t}\n\t\tif (options.type === 'DELETE' && segments.length === 2 && segments[0] === 'resource') {\n\t\t\treturn this.deleteResourceData(undefined, segments[1]);\n\t\t}\n\t\tif (options.type === 'DELETE' && segments.length === 1 && segments[0] === 'resource') {\n\t\t\treturn this.clear(options.headers);\n\t\t}\n\t\tif (options.type === 'DELETE' && segments[0] === 'collection') {\n\t\t\treturn this.toResponse(204);\n\t\t}\n\t\tif (options.type === 'POST' && segments.length === 1 && segments[0] === 'collection') {\n\t\t\treturn this.createCollection();\n\t\t}\n\t\treturn this.toResponse(501);\n\t}\n\n\tprivate async getManifest(headers?: IHeaders): Promise<IRequestContext> {\n\t\tif (this.session) {\n\t\t\tconst latest: Record<ServerResource, string> = Object.create({});\n\t\t\tthis.data.forEach((value, key) => latest[key] = value.ref);\n\t\t\tlet collection: IUserDataCollectionManifest | undefined = undefined;\n\t\t\tif (this.collectionCounter) {\n\t\t\t\tcollection = {};\n\t\t\t\tfor (let collectionId = 1; collectionId <= this.collectionCounter; collectionId++) {\n\t\t\t\t\tconst collectionData = this.collections.get(`${collectionId}`);\n\t\t\t\t\tif (collectionData) {\n\t\t\t\t\t\tconst latest: Record<ServerResource, string> = Object.create({});\n\t\t\t\t\t\tcollectionData.forEach((value, key) => latest[key] = value.ref);\n\t\t\t\t\t\tcollection[`${collectionId}`] = { latest };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst manifest = { session: this.session, latest, collection };\n\t\t\treturn this.toResponse(200, { 'Content-Type': 'application/json', etag: `${this.manifestRef++}` }, JSON.stringify(manifest));\n\t\t}\n\t\treturn this.toResponse(204, { etag: `${this.manifestRef++}` });\n\t}\n\n\tprivate async getResourceData(collection: string | undefined, resource: string, ref?: string, headers: IHeaders = {}): Promise<IRequestContext> {\n\t\tconst collectionData = collection ? this.collections.get(collection) : this.data;\n\t\tif (!collectionData) {\n\t\t\treturn this.toResponse(501);\n\t\t}\n\n\t\tconst resourceKey = ALL_SERVER_RESOURCES.find(key => key === resource);\n\t\tif (resourceKey) {\n\t\t\tconst data = collectionData.get(resourceKey);\n\t\t\tif (ref && data?.ref !== ref) {\n\t\t\t\treturn this.toResponse(404);\n\t\t\t}\n\t\t\tif (!data) {\n\t\t\t\treturn this.toResponse(204, { etag: '0' });\n\t\t\t}\n\t\t\tif (headers['If-None-Match'] === data.ref) {\n\t\t\t\treturn this.toResponse(304);\n\t\t\t}\n\t\t\treturn this.toResponse(200, { etag: data.ref }, data.content || '');\n\t\t}\n\t\treturn this.toResponse(204);\n\t}\n\n\tprivate async writeData(collection: string | undefined, resource: string, content: string = '', headers: IHeaders = {}): Promise<IRequestContext> {\n\t\tif (!this.session) {\n\t\t\tthis.session = generateUuid();\n\t\t}\n\t\tconst collectionData = collection ? this.collections.get(collection) : this.data;\n\t\tif (!collectionData) {\n\t\t\treturn this.toResponse(501);\n\t\t}\n\t\tconst resourceKey = ALL_SERVER_RESOURCES.find(key => key === resource);\n\t\tif (resourceKey) {\n\t\t\tconst data = collectionData.get(resourceKey);\n\t\t\tif (headers['If-Match'] !== undefined && headers['If-Match'] !== (data ? data.ref : '0')) {\n\t\t\t\treturn this.toResponse(412);\n\t\t\t}\n\t\t\tconst ref = `${parseInt(data?.ref || '0') + 1}`;\n\t\t\tcollectionData.set(resourceKey, { ref, content });\n\t\t\treturn this.toResponse(200, { etag: ref });\n\t\t}\n\t\treturn this.toResponse(204);\n\t}\n\n\tprivate async deleteResourceData(collection: string | undefined, resource: string, headers: IHeaders = {}): Promise<IRequestContext> {\n\t\tconst collectionData = collection ? this.collections.get(collection) : this.data;\n\t\tif (!collectionData) {\n\t\t\treturn this.toResponse(501);\n\t\t}\n\n\t\tconst resourceKey = ALL_SERVER_RESOURCES.find(key => key === resource);\n\t\tif (resourceKey) {\n\t\t\tcollectionData.delete(resourceKey);\n\t\t\treturn this.toResponse(200);\n\t\t}\n\n\t\treturn this.toResponse(404);\n\t}\n\n\tprivate async createCollection(): Promise<IRequestContext> {\n\t\tconst collectionId = `${++this.collectionCounter}`;\n\t\tthis.collections.set(collectionId, new Map());\n\t\treturn this.toResponse(200, {}, collectionId);\n\t}\n\n\tasync clear(headers?: IHeaders): Promise<IRequestContext> {\n\t\tthis.collections.clear();\n\t\tthis.data.clear();\n\t\tthis.session = null;\n\t\tthis.collectionCounter = 0;\n\t\treturn this.toResponse(204);\n\t}\n\n\tprivate toResponse(statusCode: number, headers?: IHeaders, data?: string): IRequestContext {\n\t\treturn {\n\t\t\tres: {\n\t\t\t\theaders: headers || {},\n\t\t\t\tstatusCode\n\t\t\t},\n\t\t\tstream: bufferToStream(VSBuffer.fromString(data || ''))\n\t\t};\n\t}\n}\n\nexport class TestUserDataSyncUtilService implements IUserDataSyncUtilService {\n\n\t_serviceBrand: any;\n\n\tasync resolveDefaultIgnoredSettings(): Promise<string[]> {\n\t\treturn getDefaultIgnoredSettings();\n\t}\n\n\tasync resolveUserBindings(userbindings: string[]): Promise<IStringDictionary<string>> {\n\t\tconst keys: IStringDictionary<string> = {};\n\t\tfor (const keybinding of userbindings) {\n\t\t\tkeys[keybinding] = keybinding;\n\t\t}\n\t\treturn keys;\n\t}\n\n\tasync resolveFormattingOptions(file?: URI): Promise<FormattingOptions> {\n\t\treturn { eol: '\\n', insertSpaces: false, tabSize: 4 };\n\t}\n\n}\n\nclass TestStorageService extends InMemoryStorageService {\n\tconstructor(private readonly profileStorageProfile: IUserDataProfile) {\n\t\tsuper();\n\t}\n\toverride hasScope(profile: IUserDataProfile): boolean {\n\t\treturn this.profileStorageProfile.id === profile.id;\n\t}\n}\n"]}