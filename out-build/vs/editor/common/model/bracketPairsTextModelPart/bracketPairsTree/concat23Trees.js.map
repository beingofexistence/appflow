{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/common/model/bracketPairsTextModelPart/bracketPairsTree/concat23Trees.ts"],"names":[],"mappings":"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","file":"concat23Trees.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { AstNode, AstNodeKind, ListAstNode } from './ast';\n\n/**\n * Concatenates a list of (2,3) AstNode's into a single (2,3) AstNode.\n * This mutates the items of the input array!\n * If all items have the same height, this method has runtime O(items.length).\n * Otherwise, it has runtime O(items.length * max(log(items.length), items.max(i => i.height))).\n*/\nexport function concat23Trees(items: AstNode[]): AstNode | null {\n\tif (items.length === 0) {\n\t\treturn null;\n\t}\n\tif (items.length === 1) {\n\t\treturn items[0];\n\t}\n\n\tlet i = 0;\n\t/**\n\t * Reads nodes of same height and concatenates them to a single node.\n\t*/\n\tfunction readNode(): AstNode | null {\n\t\tif (i >= items.length) {\n\t\t\treturn null;\n\t\t}\n\t\tconst start = i;\n\t\tconst height = items[start].listHeight;\n\n\t\ti++;\n\t\twhile (i < items.length && items[i].listHeight === height) {\n\t\t\ti++;\n\t\t}\n\n\t\tif (i - start >= 2) {\n\t\t\treturn concat23TreesOfSameHeight(start === 0 && i === items.length ? items : items.slice(start, i), false);\n\t\t} else {\n\t\t\treturn items[start];\n\t\t}\n\t}\n\n\t// The items might not have the same height.\n\t// We merge all items by using a binary concat operator.\n\tlet first = readNode()!; // There must be a first item\n\tlet second = readNode();\n\tif (!second) {\n\t\treturn first;\n\t}\n\n\tfor (let item = readNode(); item; item = readNode()) {\n\t\t// Prefer concatenating smaller trees, as the runtime of concat depends on the tree height.\n\t\tif (heightDiff(first, second) <= heightDiff(second, item)) {\n\t\t\tfirst = concat(first, second);\n\t\t\tsecond = item;\n\t\t} else {\n\t\t\tsecond = concat(second, item);\n\t\t}\n\t}\n\n\tconst result = concat(first, second);\n\treturn result;\n}\n\nexport function concat23TreesOfSameHeight(items: AstNode[], createImmutableLists: boolean = false): AstNode | null {\n\tif (items.length === 0) {\n\t\treturn null;\n\t}\n\tif (items.length === 1) {\n\t\treturn items[0];\n\t}\n\n\tlet length = items.length;\n\t// All trees have same height, just create parent nodes.\n\twhile (length > 3) {\n\t\tconst newLength = length >> 1;\n\t\tfor (let i = 0; i < newLength; i++) {\n\t\t\tconst j = i << 1;\n\t\t\titems[i] = ListAstNode.create23(items[j], items[j + 1], j + 3 === length ? items[j + 2] : null, createImmutableLists);\n\t\t}\n\t\tlength = newLength;\n\t}\n\treturn ListAstNode.create23(items[0], items[1], length >= 3 ? items[2] : null, createImmutableLists);\n}\n\nfunction heightDiff(node1: AstNode, node2: AstNode): number {\n\treturn Math.abs(node1.listHeight - node2.listHeight);\n}\n\nfunction concat(node1: AstNode, node2: AstNode): AstNode {\n\tif (node1.listHeight === node2.listHeight) {\n\t\treturn ListAstNode.create23(node1, node2, null, false);\n\t}\n\telse if (node1.listHeight > node2.listHeight) {\n\t\t// node1 is the tree we want to insert into\n\t\treturn append(node1 as ListAstNode, node2);\n\t} else {\n\t\treturn prepend(node2 as ListAstNode, node1);\n\t}\n}\n\n/**\n * Appends the given node to the end of this (2,3) tree.\n * Returns the new root.\n*/\nfunction append(list: ListAstNode, nodeToAppend: AstNode): AstNode {\n\tlist = list.toMutable() as ListAstNode;\n\tlet curNode: AstNode = list;\n\tconst parents: ListAstNode[] = [];\n\tlet nodeToAppendOfCorrectHeight: AstNode | undefined;\n\twhile (true) {\n\t\t// assert nodeToInsert.listHeight <= curNode.listHeight\n\t\tif (nodeToAppend.listHeight === curNode.listHeight) {\n\t\t\tnodeToAppendOfCorrectHeight = nodeToAppend;\n\t\t\tbreak;\n\t\t}\n\t\t// assert 0 <= nodeToInsert.listHeight < curNode.listHeight\n\t\tif (curNode.kind !== AstNodeKind.List) {\n\t\t\tthrow new Error('unexpected');\n\t\t}\n\t\tparents.push(curNode);\n\t\t// assert 2 <= curNode.childrenLength <= 3\n\t\tcurNode = curNode.makeLastElementMutable()!;\n\t}\n\t// assert nodeToAppendOfCorrectHeight!.listHeight === curNode.listHeight\n\tfor (let i = parents.length - 1; i >= 0; i--) {\n\t\tconst parent = parents[i];\n\t\tif (nodeToAppendOfCorrectHeight) {\n\t\t\t// Can we take the element?\n\t\t\tif (parent.childrenLength >= 3) {\n\t\t\t\t// assert parent.childrenLength === 3 && parent.listHeight === nodeToAppendOfCorrectHeight.listHeight + 1\n\n\t\t\t\t// we need to split to maintain (2,3)-tree property.\n\t\t\t\t// Send the third element + the new element to the parent.\n\t\t\t\tnodeToAppendOfCorrectHeight = ListAstNode.create23(parent.unappendChild()!, nodeToAppendOfCorrectHeight, null, false);\n\t\t\t} else {\n\t\t\t\tparent.appendChildOfSameHeight(nodeToAppendOfCorrectHeight);\n\t\t\t\tnodeToAppendOfCorrectHeight = undefined;\n\t\t\t}\n\t\t} else {\n\t\t\tparent.handleChildrenChanged();\n\t\t}\n\t}\n\tif (nodeToAppendOfCorrectHeight) {\n\t\treturn ListAstNode.create23(list, nodeToAppendOfCorrectHeight, null, false);\n\t} else {\n\t\treturn list;\n\t}\n}\n\n/**\n * Prepends the given node to the end of this (2,3) tree.\n * Returns the new root.\n*/\nfunction prepend(list: ListAstNode, nodeToAppend: AstNode): AstNode {\n\tlist = list.toMutable() as ListAstNode;\n\tlet curNode: AstNode = list;\n\tconst parents: ListAstNode[] = [];\n\t// assert nodeToInsert.listHeight <= curNode.listHeight\n\twhile (nodeToAppend.listHeight !== curNode.listHeight) {\n\t\t// assert 0 <= nodeToInsert.listHeight < curNode.listHeight\n\t\tif (curNode.kind !== AstNodeKind.List) {\n\t\t\tthrow new Error('unexpected');\n\t\t}\n\t\tparents.push(curNode);\n\t\t// assert 2 <= curNode.childrenFast.length <= 3\n\t\tcurNode = curNode.makeFirstElementMutable()!;\n\t}\n\tlet nodeToPrependOfCorrectHeight: AstNode | undefined = nodeToAppend;\n\t// assert nodeToAppendOfCorrectHeight!.listHeight === curNode.listHeight\n\tfor (let i = parents.length - 1; i >= 0; i--) {\n\t\tconst parent = parents[i];\n\t\tif (nodeToPrependOfCorrectHeight) {\n\t\t\t// Can we take the element?\n\t\t\tif (parent.childrenLength >= 3) {\n\t\t\t\t// assert parent.childrenLength === 3 && parent.listHeight === nodeToAppendOfCorrectHeight.listHeight + 1\n\n\t\t\t\t// we need to split to maintain (2,3)-tree property.\n\t\t\t\t// Send the third element + the new element to the parent.\n\t\t\t\tnodeToPrependOfCorrectHeight = ListAstNode.create23(nodeToPrependOfCorrectHeight, parent.unprependChild()!, null, false);\n\t\t\t} else {\n\t\t\t\tparent.prependChildOfSameHeight(nodeToPrependOfCorrectHeight);\n\t\t\t\tnodeToPrependOfCorrectHeight = undefined;\n\t\t\t}\n\t\t} else {\n\t\t\tparent.handleChildrenChanged();\n\t\t}\n\t}\n\tif (nodeToPrependOfCorrectHeight) {\n\t\treturn ListAstNode.create23(nodeToPrependOfCorrectHeight, list, null, false);\n\t} else {\n\t\treturn list;\n\t}\n}\n"]}