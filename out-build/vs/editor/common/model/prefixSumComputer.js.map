{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/common/model/prefixSumComputer.ts"],"names":[],"mappings":"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","file":"prefixSumComputer.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { arrayInsert } from 'vs/base/common/arrays';\nimport { toUint32 } from 'vs/base/common/uint';\n\nexport class PrefixSumComputer {\n\n\t/**\n\t * values[i] is the value at index i\n\t */\n\tprivate values: Uint32Array;\n\n\t/**\n\t * prefixSum[i] = SUM(heights[j]), 0 <= j <= i\n\t */\n\tprivate prefixSum: Uint32Array;\n\n\t/**\n\t * prefixSum[i], 0 <= i <= prefixSumValidIndex can be trusted\n\t */\n\tprivate readonly prefixSumValidIndex: Int32Array;\n\n\tconstructor(values: Uint32Array) {\n\t\tthis.values = values;\n\t\tthis.prefixSum = new Uint32Array(values.length);\n\t\tthis.prefixSumValidIndex = new Int32Array(1);\n\t\tthis.prefixSumValidIndex[0] = -1;\n\t}\n\n\tpublic getCount(): number {\n\t\treturn this.values.length;\n\t}\n\n\tpublic insertValues(insertIndex: number, insertValues: Uint32Array): boolean {\n\t\tinsertIndex = toUint32(insertIndex);\n\t\tconst oldValues = this.values;\n\t\tconst oldPrefixSum = this.prefixSum;\n\t\tconst insertValuesLen = insertValues.length;\n\n\t\tif (insertValuesLen === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.values = new Uint32Array(oldValues.length + insertValuesLen);\n\t\tthis.values.set(oldValues.subarray(0, insertIndex), 0);\n\t\tthis.values.set(oldValues.subarray(insertIndex), insertIndex + insertValuesLen);\n\t\tthis.values.set(insertValues, insertIndex);\n\n\t\tif (insertIndex - 1 < this.prefixSumValidIndex[0]) {\n\t\t\tthis.prefixSumValidIndex[0] = insertIndex - 1;\n\t\t}\n\n\t\tthis.prefixSum = new Uint32Array(this.values.length);\n\t\tif (this.prefixSumValidIndex[0] >= 0) {\n\t\t\tthis.prefixSum.set(oldPrefixSum.subarray(0, this.prefixSumValidIndex[0] + 1));\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic setValue(index: number, value: number): boolean {\n\t\tindex = toUint32(index);\n\t\tvalue = toUint32(value);\n\n\t\tif (this.values[index] === value) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.values[index] = value;\n\t\tif (index - 1 < this.prefixSumValidIndex[0]) {\n\t\t\tthis.prefixSumValidIndex[0] = index - 1;\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic removeValues(startIndex: number, count: number): boolean {\n\t\tstartIndex = toUint32(startIndex);\n\t\tcount = toUint32(count);\n\n\t\tconst oldValues = this.values;\n\t\tconst oldPrefixSum = this.prefixSum;\n\n\t\tif (startIndex >= oldValues.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst maxCount = oldValues.length - startIndex;\n\t\tif (count >= maxCount) {\n\t\t\tcount = maxCount;\n\t\t}\n\n\t\tif (count === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.values = new Uint32Array(oldValues.length - count);\n\t\tthis.values.set(oldValues.subarray(0, startIndex), 0);\n\t\tthis.values.set(oldValues.subarray(startIndex + count), startIndex);\n\n\t\tthis.prefixSum = new Uint32Array(this.values.length);\n\t\tif (startIndex - 1 < this.prefixSumValidIndex[0]) {\n\t\t\tthis.prefixSumValidIndex[0] = startIndex - 1;\n\t\t}\n\t\tif (this.prefixSumValidIndex[0] >= 0) {\n\t\t\tthis.prefixSum.set(oldPrefixSum.subarray(0, this.prefixSumValidIndex[0] + 1));\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic getTotalSum(): number {\n\t\tif (this.values.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn this._getPrefixSum(this.values.length - 1);\n\t}\n\n\t/**\n\t * Returns the sum of the first `index + 1` many items.\n\t * @returns `SUM(0 <= j <= index, values[j])`.\n\t */\n\tpublic getPrefixSum(index: number): number {\n\t\tif (index < 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tindex = toUint32(index);\n\t\treturn this._getPrefixSum(index);\n\t}\n\n\tprivate _getPrefixSum(index: number): number {\n\t\tif (index <= this.prefixSumValidIndex[0]) {\n\t\t\treturn this.prefixSum[index];\n\t\t}\n\n\t\tlet startIndex = this.prefixSumValidIndex[0] + 1;\n\t\tif (startIndex === 0) {\n\t\t\tthis.prefixSum[0] = this.values[0];\n\t\t\tstartIndex++;\n\t\t}\n\n\t\tif (index >= this.values.length) {\n\t\t\tindex = this.values.length - 1;\n\t\t}\n\n\t\tfor (let i = startIndex; i <= index; i++) {\n\t\t\tthis.prefixSum[i] = this.prefixSum[i - 1] + this.values[i];\n\t\t}\n\t\tthis.prefixSumValidIndex[0] = Math.max(this.prefixSumValidIndex[0], index);\n\t\treturn this.prefixSum[index];\n\t}\n\n\tpublic getIndexOf(sum: number): PrefixSumIndexOfResult {\n\t\tsum = Math.floor(sum);\n\n\t\t// Compute all sums (to get a fully valid prefixSum)\n\t\tthis.getTotalSum();\n\n\t\tlet low = 0;\n\t\tlet high = this.values.length - 1;\n\t\tlet mid = 0;\n\t\tlet midStop = 0;\n\t\tlet midStart = 0;\n\n\t\twhile (low <= high) {\n\t\t\tmid = low + ((high - low) / 2) | 0;\n\n\t\t\tmidStop = this.prefixSum[mid];\n\t\t\tmidStart = midStop - this.values[mid];\n\n\t\t\tif (sum < midStart) {\n\t\t\t\thigh = mid - 1;\n\t\t\t} else if (sum >= midStop) {\n\t\t\t\tlow = mid + 1;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn new PrefixSumIndexOfResult(mid, sum - midStart);\n\t}\n}\n\n/**\n * {@link getIndexOf} has an amortized runtime complexity of O(1).\n *\n * ({@link PrefixSumComputer.getIndexOf} is just  O(log n))\n*/\nexport class ConstantTimePrefixSumComputer {\n\tprivate _values: number[];\n\tprivate _isValid: boolean;\n\tprivate _validEndIndex: number;\n\n\t/**\n\t * _prefixSum[i] = SUM(values[j]), 0 <= j <= i\n\t */\n\tprivate _prefixSum: number[];\n\n\t/**\n\t * _indexBySum[sum] = idx => _prefixSum[idx - 1] <= sum < _prefixSum[idx]\n\t*/\n\tprivate _indexBySum: number[];\n\n\tconstructor(values: number[]) {\n\t\tthis._values = values;\n\t\tthis._isValid = false;\n\t\tthis._validEndIndex = -1;\n\t\tthis._prefixSum = [];\n\t\tthis._indexBySum = [];\n\t}\n\n\t/**\n\t * @returns SUM(0 <= j < values.length, values[j])\n\t */\n\tpublic getTotalSum(): number {\n\t\tthis._ensureValid();\n\t\treturn this._indexBySum.length;\n\t}\n\n\t/**\n\t * Returns the sum of the first `count` many items.\n\t * @returns `SUM(0 <= j < count, values[j])`.\n\t */\n\tpublic getPrefixSum(count: number): number {\n\t\tthis._ensureValid();\n\t\tif (count === 0) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn this._prefixSum[count - 1];\n\t}\n\n\t/**\n\t * @returns `result`, such that `getPrefixSum(result.index) + result.remainder = sum`\n\t */\n\tpublic getIndexOf(sum: number): PrefixSumIndexOfResult {\n\t\tthis._ensureValid();\n\t\tconst idx = this._indexBySum[sum];\n\t\tconst viewLinesAbove = idx > 0 ? this._prefixSum[idx - 1] : 0;\n\t\treturn new PrefixSumIndexOfResult(idx, sum - viewLinesAbove);\n\t}\n\n\tpublic removeValues(start: number, deleteCount: number): void {\n\t\tthis._values.splice(start, deleteCount);\n\t\tthis._invalidate(start);\n\t}\n\n\tpublic insertValues(insertIndex: number, insertArr: number[]): void {\n\t\tthis._values = arrayInsert(this._values, insertIndex, insertArr);\n\t\tthis._invalidate(insertIndex);\n\t}\n\n\tprivate _invalidate(index: number): void {\n\t\tthis._isValid = false;\n\t\tthis._validEndIndex = Math.min(this._validEndIndex, index - 1);\n\t}\n\n\tprivate _ensureValid(): void {\n\t\tif (this._isValid) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = this._validEndIndex + 1, len = this._values.length; i < len; i++) {\n\t\t\tconst value = this._values[i];\n\t\t\tconst sumAbove = i > 0 ? this._prefixSum[i - 1] : 0;\n\n\t\t\tthis._prefixSum[i] = sumAbove + value;\n\t\t\tfor (let j = 0; j < value; j++) {\n\t\t\t\tthis._indexBySum[sumAbove + j] = i;\n\t\t\t}\n\t\t}\n\n\t\t// trim things\n\t\tthis._prefixSum.length = this._values.length;\n\t\tthis._indexBySum.length = this._prefixSum[this._prefixSum.length - 1];\n\n\t\t// mark as valid\n\t\tthis._isValid = true;\n\t\tthis._validEndIndex = this._values.length - 1;\n\t}\n\n\tpublic setValue(index: number, value: number): void {\n\t\tif (this._values[index] === value) {\n\t\t\t// no change\n\t\t\treturn;\n\t\t}\n\t\tthis._values[index] = value;\n\t\tthis._invalidate(index);\n\t}\n}\n\n\nexport class PrefixSumIndexOfResult {\n\t_prefixSumIndexOfResultBrand: void = undefined;\n\n\tconstructor(\n\t\tpublic readonly index: number,\n\t\tpublic readonly remainder: number\n\t) {\n\t\tthis.index = index;\n\t\tthis.remainder = remainder;\n\t}\n}\n"]}