{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/common/services/markerDecorationsService.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IAmBzF,IAAM,IAAI,GAAV,MAAM,IAAyB,SAAQ,eAAG;QAShD,YACgB,YAAiB,EAChB,CAAoC;YAEpD,KAAK,EAAE,CAAC;YAFyB,MAAC,GAAD,CAAC,CAAkB;YAPpC,MAAC,GAAoB,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAkB,CAAC,CAAC;YACvE,sBAAiB,GAAsB,IAAI,CAAC,CAAC,CAAkB,KAAK,CAAC;YAE7D,MAAC,GAAoB,IAAI,SAAG,EAA6B,CAAC;YAO1E,YAAY,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAa,KAAK,CAAC,CAAC,CAAC;YACrE,IAAI,CAAC,CAAC,CAAS,YAAY,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,EAAc,IAAI,CAAC,CAAC,CAAC;YACpE,IAAI,CAAC,CAAC,CAAS,YAAY,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,EAAgB,IAAI,CAAC,CAAC,CAAC;YACxE,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,CAAC,CAAc,eAAe,CAAC,IAAI,CAAC,CAAC,EAAoB,IAAI,CAAC,CAAC,CAAC;QACrF,CAAC;QAEQ,OAAO;YACf,KAAK,CAAC,OAAO,EAAE,CAAC;YAChB,IAAI,CAAC,CAAC,CAAkB,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;YAC1D,IAAI,CAAC,CAAC,CAAkB,KAAK,EAAE,CAAC;QACjC,CAAC;QAED,SAAS,CAAC,GAAQ,EAAE,UAA4B;YAC/C,MAAM,iBAAiB,GAAG,IAAI,CAAC,CAAC,CAAkB,GAAG,CAAC,GAAG,CAAC,CAAC;YAC3D,OAAO,iBAAiB,CAAC,CAAC,CAAC,CAAC,iBAAiB,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QACrF,CAAC;QAED,cAAc,CAAC,GAAQ;YACtB,MAAM,iBAAiB,GAAG,IAAI,CAAC,CAAC,CAAkB,GAAG,CAAC,GAAG,CAAC,CAAC;YAC3D,OAAO,iBAAiB,CAAC,CAAC,CAAC,iBAAiB,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;QAChE,CAAC;QAEO,CAAC,CAAmB,gBAAgC;YAC3D,gBAAgB,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,EAAE;gBACrC,MAAM,iBAAiB,GAAG,IAAI,CAAC,CAAC,CAAkB,GAAG,CAAC,QAAQ,CAAC,CAAC;gBAChE,IAAI,iBAAiB,EAAE;oBACtB,IAAI,CAAC,CAAC,CAAkB,iBAAiB,CAAC,CAAC;iBAC3C;YACF,CAAC,CAAC,CAAC;QACJ,CAAC;QAEO,CAAC,CAAa,KAAiB;YACtC,MAAM,iBAAiB,GAAG,IAAI,iBAAiB,CAAC,KAAK,CAAC,CAAC;YACvD,IAAI,CAAC,CAAC,CAAkB,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,iBAAiB,CAAC,CAAC;YAC1D,IAAI,CAAC,CAAC,CAAkB,iBAAiB,CAAC,CAAC;QAC5C,CAAC;QAEO,CAAC,CAAe,KAAiB;YACxC,MAAM,iBAAiB,GAAG,IAAI,CAAC,CAAC,CAAkB,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YACjE,IAAI,iBAAiB,EAAE;gBACtB,iBAAiB,CAAC,OAAO,EAAE,CAAC;gBAC5B,IAAI,CAAC,CAAC,CAAkB,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;aAC1C;YAED,kDAAkD;YAClD,IAAI,KAAK,CAAC,GAAG,CAAC,MAAM,KAAK,iBAAO,CAAC,QAAQ;mBACrC,KAAK,CAAC,GAAG,CAAC,MAAM,KAAK,iBAAO,CAAC,QAAQ;mBACrC,KAAK,CAAC,GAAG,CAAC,MAAM,KAAK,iBAAO,CAAC,MAAM,EAAE;gBACxC,IAAI,CAAC,CAAC,EAAe,IAAI,CAAC,EAAE,QAAQ,EAAE,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAc,MAAM,CAAC,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;aAChJ;QACF,CAAC;QAEO,CAAC,CAAkB,iBAAoC;YAC9D,yCAAyC;YACzC,MAAM,OAAO,GAAG,IAAI,CAAC,CAAC,CAAc,IAAI,CAAC,EAAE,QAAQ,EAAE,iBAAiB,CAAC,KAAK,CAAC,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC;YAC/F,IAAI,iBAAiB,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE;gBACtC,IAAI,CAAC,CAAC,CAAkB,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;aACtD;QACF,CAAC;KACD,CAAA;IAzEY,oBAAI;mBAAJ,IAAI;QAUd,WAAA,WAAG,CAAA;QACH,WAAA,aAAG,CAAA;OAXO,IAAI,CAyEhB;IAED,MAAM,iBAAkB,SAAQ,eAAG;QAIlC,YACU,KAAiB;YAE1B,KAAK,EAAE,CAAC;YAFC,UAAK,GAAL,KAAK,CAAY;YAHV,MAAC,GAAM,IAAI,SAAG,EAAiD,CAAC;YAMhF,IAAI,CAAC,CAAC,CAAS,IAAA,eAAG,EAAU,GAAG,EAAE;gBAChC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAI,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;gBACzD,IAAI,CAAC,CAAC,CAAI,KAAK,EAAE,CAAC;YACnB,CAAC,CAAC,CAAC,CAAC;QACL,CAAC;QAEM,MAAM,CAAC,OAAkB;YAE/B,gFAAgF;YAChF,uFAAuF;YAEvF,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,IAAA,gBAAE,EAAO,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC,CAAI,IAAI,EAAE,CAAC,EAAE,IAAI,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC;YAEjF,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,IAAI,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE;gBAC/C,OAAO,KAAK,CAAC;aACb;YAED,MAAM,MAAM,GAAa,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAI,GAAG,CAAC,MAAM,CAAE,CAAC,CAAC;YACvE,MAAM,cAAc,GAA4B,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE;gBAClE,OAAO;oBACN,KAAK,EAAE,IAAI,CAAC,CAAC,CAAsB,IAAI,CAAC,KAAK,EAAE,MAAM,CAAC;oBACtD,OAAO,EAAE,IAAI,CAAC,CAAC,CAAuB,MAAM,CAAC;iBAC7C,CAAC;YACH,CAAC,CAAC,CAAC;YAEH,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,MAAM,EAAE,cAAc,CAAC,CAAC;YAChE,KAAK,MAAM,aAAa,IAAI,OAAO,EAAE;gBACpC,IAAI,CAAC,CAAC,CAAI,MAAM,CAAC,aAAa,CAAC,CAAC;aAChC;YACD,KAAK,IAAI,KAAK,GAAG,CAAC,EAAE,KAAK,GAAG,GAAG,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;gBAChD,IAAI,CAAC,CAAC,CAAI,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;aACxC;YACD,OAAO,IAAI,CAAC;QACb,CAAC;QAED,SAAS,CAAC,UAA4B;YACrC,OAAO,IAAI,CAAC,CAAC,CAAI,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;QACxC,CAAC;QAED,UAAU;YACT,MAAM,GAAG,GAAuB,EAAE,CAAC;YACnC,IAAI,CAAC,CAAC,CAAI,OAAO,CAAC,CAAC,EAAE,EAAE,MAAM,EAAE,EAAE;gBAChC,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,EAAE,CAAC,CAAC;gBAChD,IAAI,KAAK,EAAE;oBACV,GAAG,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC;iBAC1B;YACF,CAAC,CAAC,CAAC;YACH,OAAO,GAAG,CAAC;QACZ,CAAC;QAEO,CAAC,CAAsB,KAAiB,EAAE,SAAkB;YAEnE,IAAI,GAAG,GAAG,WAAG,CAAG,IAAI,CAAC,SAAS,CAAC,CAAC;YAEhC,IAAI,SAAS,CAAC,QAAQ,KAAK,wBAAc,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,CAAa,SAAS,gCAAwB,IAAI,CAAC,IAAI,CAAC,CAAC,CAAa,SAAS,+BAAuB,EAAE;gBAChK,yCAAyC;gBACzC,qCAAqC;gBACrC,GAAG,GAAG,GAAG,CAAC,cAAc,CAAC,GAAG,CAAC,eAAe,EAAE,GAAG,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC;aACnE;YAED,GAAG,GAAG,KAAK,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;YAE/B,IAAI,GAAG,CAAC,OAAO,EAAE,EAAE;gBAClB,MAAM,SAAS,GAAG,KAAK,CAAC,8BAA8B,CAAC,GAAG,CAAC,eAAe,CAAC;oBAC1E,KAAK,CAAC,gBAAgB,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;gBAE7C,IAAI,SAAS,KAAK,CAAC,IAAI,GAAG,CAAC,SAAS,IAAI,SAAS,EAAE;oBAClD,2BAA2B;oBAC3B,qDAAqD;oBACrD,OAAO,GAAG,CAAC;iBACX;gBAED,MAAM,IAAI,GAAG,KAAK,CAAC,iBAAiB,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC,CAAC;gBAC7D,IAAI,IAAI,EAAE;oBACT,GAAG,GAAG,IAAI,WAAG,CAAG,GAAG,CAAC,eAAe,EAAE,IAAI,CAAC,WAAW,EAAE,GAAG,CAAC,aAAa,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;iBAC1F;aACD;iBAAM,IAAI,SAAS,CAAC,SAAS,KAAK,MAAM,CAAC,SAAS,IAAI,SAAS,CAAC,WAAW,KAAK,CAAC,IAAI,GAAG,CAAC,eAAe,KAAK,GAAG,CAAC,aAAa,EAAE;gBAChI,MAAM,SAAS,GAAG,KAAK,CAAC,+BAA+B,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;gBACnF,IAAI,SAAS,GAAG,GAAG,CAAC,SAAS,EAAE;oBAC9B,GAAG,GAAG,IAAI,WAAG,CAAG,GAAG,CAAC,eAAe,EAAE,SAAS,EAAE,GAAG,CAAC,aAAa,EAAE,GAAG,CAAC,SAAS,CAAC,CAAC;oBAClF,SAAS,CAAC,WAAW,GAAG,SAAS,CAAC;iBAClC;aACD;YACD,OAAO,GAAG,CAAC;QACZ,CAAC;QAEO,CAAC,CAAuB,MAAe;YAE9C,IAAI,SAA6B,CAAC;YAClC,IAAI,KAAK,GAA2B,SAAS,CAAC;YAC9C,IAAI,MAAc,CAAC;YACnB,IAAI,eAAe,GAAuB,SAAS,CAAC;YACpD,IAAI,OAAmD,CAAC;YAExD,QAAQ,MAAM,CAAC,QAAQ,EAAE;gBACxB,KAAK,wBAAc,CAAC,IAAI;oBACvB,IAAI,IAAI,CAAC,CAAC,CAAa,MAAM,+BAAuB,EAAE;wBACrD,SAAS,GAAG,SAAS,CAAC;qBACtB;yBAAM,IAAI,IAAI,CAAC,CAAC,CAAa,MAAM,gCAAwB,EAAE;wBAC7D,SAAS,qEAAwC,CAAC;qBAClD;yBAAM;wBACN,SAAS,uDAAiC,CAAC;qBAC3C;oBACD,MAAM,GAAG,CAAC,CAAC;oBACX,MAAM;gBACP,KAAK,wBAAc,CAAC,IAAI;oBACvB,SAAS,uDAAiC,CAAC;oBAC3C,KAAK,GAAG,IAAA,kBAAG,EAAc,yBAAG,CAAe,CAAC;oBAC5C,MAAM,GAAG,EAAE,CAAC;oBACZ,OAAO,GAAG;wBACT,KAAK,EAAE,IAAA,kBAAG,EAAc,mBAAG,CAAS;wBACpC,QAAQ,EAAE,uBAAe,CAAC,MAAM;qBAChC,CAAC;oBACF,MAAM;gBACP,KAAK,wBAAc,CAAC,OAAO;oBAC1B,SAAS,6DAAoC,CAAC;oBAC9C,KAAK,GAAG,IAAA,kBAAG,EAAc,yBAAG,CAAkB,CAAC;oBAC/C,MAAM,GAAG,EAAE,CAAC;oBACZ,OAAO,GAAG;wBACT,KAAK,EAAE,IAAA,kBAAG,EAAc,mBAAG,CAAY;wBACvC,QAAQ,EAAE,uBAAe,CAAC,MAAM;qBAChC,CAAC;oBACF,MAAM;gBACP,KAAK,wBAAc,CAAC,KAAK,CAAC;gBAC1B;oBACC,SAAS,yDAAkC,CAAC;oBAC5C,KAAK,GAAG,IAAA,kBAAG,EAAc,yBAAG,CAAgB,CAAC;oBAC7C,MAAM,GAAG,EAAE,CAAC;oBACZ,OAAO,GAAG;wBACT,KAAK,EAAE,IAAA,kBAAG,EAAc,mBAAG,CAAU;wBACrC,QAAQ,EAAE,uBAAe,CAAC,MAAM;qBAChC,CAAC;oBACF,MAAM;aACP;YAED,IAAI,MAAM,CAAC,IAAI,EAAE;gBAChB,IAAI,MAAM,CAAC,IAAI,CAAC,OAAO,+BAAuB,KAAK,CAAC,CAAC,EAAE;oBACtD,eAAe,kFAA8C,CAAC;iBAC9D;gBACD,IAAI,MAAM,CAAC,IAAI,CAAC,OAAO,8BAAsB,KAAK,CAAC,CAAC,EAAE;oBACrD,eAAe,gFAA6C,CAAC;iBAC7D;aACD;YAED,OAAO;gBACN,WAAW,EAAE,mBAAmB;gBAChC,UAAU,4DAAoD;gBAC9D,SAAS;gBACT,eAAe,EAAE,IAAI;gBACrB,aAAa,EAAE;oBACd,KAAK;oBACL,QAAQ,EAAE,yBAAiB,CAAC,KAAK;iBACjC;gBACD,OAAO;gBACP,MAAM;gBACN,eAAe;aACf,CAAC;QACH,CAAC;QAEO,CAAC,CAAa,MAAe,EAAE,GAAc;YACpD,IAAI,MAAM,CAAC,IAAI,EAAE;gBAChB,OAAO,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;aACrC;YACD,OAAO,KAAK,CAAC;QACd,CAAC;KACD","file":"markerDecorationsService.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IMarkerService, IMarker, MarkerSeverity, MarkerTag } from 'vs/platform/markers/common/markers';\nimport { Disposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport { IModelDeltaDecoration, ITextModel, IModelDecorationOptions, TrackedRangeStickiness, OverviewRulerLane, IModelDecoration, MinimapPosition, IModelDecorationMinimapOptions } from 'vs/editor/common/model';\nimport { ClassName } from 'vs/editor/common/model/intervalTree';\nimport { themeColorFromId } from 'vs/platform/theme/common/themeService';\nimport { ThemeColor } from 'vs/base/common/themables';\nimport { overviewRulerWarning, overviewRulerInfo, overviewRulerError } from 'vs/editor/common/core/editorColorRegistry';\nimport { IModelService } from 'vs/editor/common/services/model';\nimport { Range } from 'vs/editor/common/core/range';\nimport { IMarkerDecorationsService } from 'vs/editor/common/services/markerDecorations';\nimport { Schemas } from 'vs/base/common/network';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { minimapInfo, minimapWarning, minimapError } from 'vs/platform/theme/common/colorRegistry';\nimport { BidirectionalMap, ResourceMap } from 'vs/base/common/map';\nimport { diffSets } from 'vs/base/common/collections';\n\nexport class MarkerDecorationsService extends Disposable implements IMarkerDecorationsService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangeMarker = this._register(new Emitter<ITextModel>());\n\treadonly onDidChangeMarker: Event<ITextModel> = this._onDidChangeMarker.event;\n\n\tprivate readonly _markerDecorations = new ResourceMap<MarkerDecorations>();\n\n\tconstructor(\n\t\t@IModelService modelService: IModelService,\n\t\t@IMarkerService private readonly _markerService: IMarkerService\n\t) {\n\t\tsuper();\n\t\tmodelService.getModels().forEach(model => this._onModelAdded(model));\n\t\tthis._register(modelService.onModelAdded(this._onModelAdded, this));\n\t\tthis._register(modelService.onModelRemoved(this._onModelRemoved, this));\n\t\tthis._register(this._markerService.onMarkerChanged(this._handleMarkerChange, this));\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\t\tthis._markerDecorations.forEach(value => value.dispose());\n\t\tthis._markerDecorations.clear();\n\t}\n\n\tgetMarker(uri: URI, decoration: IModelDecoration): IMarker | null {\n\t\tconst markerDecorations = this._markerDecorations.get(uri);\n\t\treturn markerDecorations ? (markerDecorations.getMarker(decoration) || null) : null;\n\t}\n\n\tgetLiveMarkers(uri: URI): [Range, IMarker][] {\n\t\tconst markerDecorations = this._markerDecorations.get(uri);\n\t\treturn markerDecorations ? markerDecorations.getMarkers() : [];\n\t}\n\n\tprivate _handleMarkerChange(changedResources: readonly URI[]): void {\n\t\tchangedResources.forEach((resource) => {\n\t\t\tconst markerDecorations = this._markerDecorations.get(resource);\n\t\t\tif (markerDecorations) {\n\t\t\t\tthis._updateDecorations(markerDecorations);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _onModelAdded(model: ITextModel): void {\n\t\tconst markerDecorations = new MarkerDecorations(model);\n\t\tthis._markerDecorations.set(model.uri, markerDecorations);\n\t\tthis._updateDecorations(markerDecorations);\n\t}\n\n\tprivate _onModelRemoved(model: ITextModel): void {\n\t\tconst markerDecorations = this._markerDecorations.get(model.uri);\n\t\tif (markerDecorations) {\n\t\t\tmarkerDecorations.dispose();\n\t\t\tthis._markerDecorations.delete(model.uri);\n\t\t}\n\n\t\t// clean up markers for internal, transient models\n\t\tif (model.uri.scheme === Schemas.inMemory\n\t\t\t|| model.uri.scheme === Schemas.internal\n\t\t\t|| model.uri.scheme === Schemas.vscode) {\n\t\t\tthis._markerService?.read({ resource: model.uri }).map(marker => marker.owner).forEach(owner => this._markerService.remove(owner, [model.uri]));\n\t\t}\n\t}\n\n\tprivate _updateDecorations(markerDecorations: MarkerDecorations): void {\n\t\t// Limit to the first 500 errors/warnings\n\t\tconst markers = this._markerService.read({ resource: markerDecorations.model.uri, take: 500 });\n\t\tif (markerDecorations.update(markers)) {\n\t\t\tthis._onDidChangeMarker.fire(markerDecorations.model);\n\t\t}\n\t}\n}\n\nclass MarkerDecorations extends Disposable {\n\n\tprivate readonly _map = new BidirectionalMap<IMarker, /*decoration id*/string>();\n\n\tconstructor(\n\t\treadonly model: ITextModel\n\t) {\n\t\tsuper();\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis.model.deltaDecorations([...this._map.values()], []);\n\t\t\tthis._map.clear();\n\t\t}));\n\t}\n\n\tpublic update(markers: IMarker[]): boolean {\n\n\t\t// We use the fact that marker instances are not recreated when different owners\n\t\t// update. So we can compare references to find out what changed since the last update.\n\n\t\tconst { added, removed } = diffSets(new Set(this._map.keys()), new Set(markers));\n\n\t\tif (added.length === 0 && removed.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst oldIds: string[] = removed.map(marker => this._map.get(marker)!);\n\t\tconst newDecorations: IModelDeltaDecoration[] = added.map(marker => {\n\t\t\treturn {\n\t\t\t\trange: this._createDecorationRange(this.model, marker),\n\t\t\t\toptions: this._createDecorationOption(marker)\n\t\t\t};\n\t\t});\n\n\t\tconst ids = this.model.deltaDecorations(oldIds, newDecorations);\n\t\tfor (const removedMarker of removed) {\n\t\t\tthis._map.delete(removedMarker);\n\t\t}\n\t\tfor (let index = 0; index < ids.length; index++) {\n\t\t\tthis._map.set(added[index], ids[index]);\n\t\t}\n\t\treturn true;\n\t}\n\n\tgetMarker(decoration: IModelDecoration): IMarker | undefined {\n\t\treturn this._map.getKey(decoration.id);\n\t}\n\n\tgetMarkers(): [Range, IMarker][] {\n\t\tconst res: [Range, IMarker][] = [];\n\t\tthis._map.forEach((id, marker) => {\n\t\t\tconst range = this.model.getDecorationRange(id);\n\t\t\tif (range) {\n\t\t\t\tres.push([range, marker]);\n\t\t\t}\n\t\t});\n\t\treturn res;\n\t}\n\n\tprivate _createDecorationRange(model: ITextModel, rawMarker: IMarker): Range {\n\n\t\tlet ret = Range.lift(rawMarker);\n\n\t\tif (rawMarker.severity === MarkerSeverity.Hint && !this._hasMarkerTag(rawMarker, MarkerTag.Unnecessary) && !this._hasMarkerTag(rawMarker, MarkerTag.Deprecated)) {\n\t\t\t// * never render hints on multiple lines\n\t\t\t// * make enough space for three dots\n\t\t\tret = ret.setEndPosition(ret.startLineNumber, ret.startColumn + 2);\n\t\t}\n\n\t\tret = model.validateRange(ret);\n\n\t\tif (ret.isEmpty()) {\n\t\t\tconst maxColumn = model.getLineLastNonWhitespaceColumn(ret.startLineNumber) ||\n\t\t\t\tmodel.getLineMaxColumn(ret.startLineNumber);\n\n\t\t\tif (maxColumn === 1 || ret.endColumn >= maxColumn) {\n\t\t\t\t// empty line or behind eol\n\t\t\t\t// keep the range as is, it will be rendered 1ch wide\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tconst word = model.getWordAtPosition(ret.getStartPosition());\n\t\t\tif (word) {\n\t\t\t\tret = new Range(ret.startLineNumber, word.startColumn, ret.endLineNumber, word.endColumn);\n\t\t\t}\n\t\t} else if (rawMarker.endColumn === Number.MAX_VALUE && rawMarker.startColumn === 1 && ret.startLineNumber === ret.endLineNumber) {\n\t\t\tconst minColumn = model.getLineFirstNonWhitespaceColumn(rawMarker.startLineNumber);\n\t\t\tif (minColumn < ret.endColumn) {\n\t\t\t\tret = new Range(ret.startLineNumber, minColumn, ret.endLineNumber, ret.endColumn);\n\t\t\t\trawMarker.startColumn = minColumn;\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}\n\n\tprivate _createDecorationOption(marker: IMarker): IModelDecorationOptions {\n\n\t\tlet className: string | undefined;\n\t\tlet color: ThemeColor | undefined = undefined;\n\t\tlet zIndex: number;\n\t\tlet inlineClassName: string | undefined = undefined;\n\t\tlet minimap: IModelDecorationMinimapOptions | undefined;\n\n\t\tswitch (marker.severity) {\n\t\t\tcase MarkerSeverity.Hint:\n\t\t\t\tif (this._hasMarkerTag(marker, MarkerTag.Deprecated)) {\n\t\t\t\t\tclassName = undefined;\n\t\t\t\t} else if (this._hasMarkerTag(marker, MarkerTag.Unnecessary)) {\n\t\t\t\t\tclassName = ClassName.EditorUnnecessaryDecoration;\n\t\t\t\t} else {\n\t\t\t\t\tclassName = ClassName.EditorHintDecoration;\n\t\t\t\t}\n\t\t\t\tzIndex = 0;\n\t\t\t\tbreak;\n\t\t\tcase MarkerSeverity.Info:\n\t\t\t\tclassName = ClassName.EditorInfoDecoration;\n\t\t\t\tcolor = themeColorFromId(overviewRulerInfo);\n\t\t\t\tzIndex = 10;\n\t\t\t\tminimap = {\n\t\t\t\t\tcolor: themeColorFromId(minimapInfo),\n\t\t\t\t\tposition: MinimapPosition.Inline\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase MarkerSeverity.Warning:\n\t\t\t\tclassName = ClassName.EditorWarningDecoration;\n\t\t\t\tcolor = themeColorFromId(overviewRulerWarning);\n\t\t\t\tzIndex = 20;\n\t\t\t\tminimap = {\n\t\t\t\t\tcolor: themeColorFromId(minimapWarning),\n\t\t\t\t\tposition: MinimapPosition.Inline\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase MarkerSeverity.Error:\n\t\t\tdefault:\n\t\t\t\tclassName = ClassName.EditorErrorDecoration;\n\t\t\t\tcolor = themeColorFromId(overviewRulerError);\n\t\t\t\tzIndex = 30;\n\t\t\t\tminimap = {\n\t\t\t\t\tcolor: themeColorFromId(minimapError),\n\t\t\t\t\tposition: MinimapPosition.Inline\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (marker.tags) {\n\t\t\tif (marker.tags.indexOf(MarkerTag.Unnecessary) !== -1) {\n\t\t\t\tinlineClassName = ClassName.EditorUnnecessaryInlineDecoration;\n\t\t\t}\n\t\t\tif (marker.tags.indexOf(MarkerTag.Deprecated) !== -1) {\n\t\t\t\tinlineClassName = ClassName.EditorDeprecatedInlineDecoration;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tdescription: 'marker-decoration',\n\t\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\t\tclassName,\n\t\t\tshowIfCollapsed: true,\n\t\t\toverviewRuler: {\n\t\t\t\tcolor,\n\t\t\t\tposition: OverviewRulerLane.Right\n\t\t\t},\n\t\t\tminimap,\n\t\t\tzIndex,\n\t\t\tinlineClassName,\n\t\t};\n\t}\n\n\tprivate _hasMarkerTag(marker: IMarker, tag: MarkerTag): boolean {\n\t\tif (marker.tags) {\n\t\t\treturn marker.tags.indexOf(tag) >= 0;\n\t\t}\n\t\treturn false;\n\t}\n}\n"]}