{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/common/viewModelEventDispatcher.ts"],"names":[],"mappings":"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","file":"viewModelEventDispatcher.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ViewEventHandler } from 'vs/editor/common/viewEventHandler';\nimport { ViewEvent } from 'vs/editor/common/viewEvents';\nimport { IContentSizeChangedEvent } from 'vs/editor/common/editorCommon';\nimport { Emitter } from 'vs/base/common/event';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { CursorChangeReason } from 'vs/editor/common/cursorEvents';\nimport { IModelContentChangedEvent, IModelDecorationsChangedEvent, IModelLanguageChangedEvent, IModelLanguageConfigurationChangedEvent, IModelOptionsChangedEvent, IModelTokensChangedEvent } from 'vs/editor/common/textModelEvents';\n\nexport class ViewModelEventDispatcher extends Disposable {\n\n\tprivate readonly _onEvent = this._register(new Emitter<OutgoingViewModelEvent>());\n\tpublic readonly onEvent = this._onEvent.event;\n\n\tprivate readonly _eventHandlers: ViewEventHandler[];\n\tprivate _viewEventQueue: ViewEvent[] | null;\n\tprivate _isConsumingViewEventQueue: boolean;\n\tprivate _collector: ViewModelEventsCollector | null;\n\tprivate _collectorCnt: number;\n\tprivate _outgoingEvents: OutgoingViewModelEvent[];\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis._eventHandlers = [];\n\t\tthis._viewEventQueue = null;\n\t\tthis._isConsumingViewEventQueue = false;\n\t\tthis._collector = null;\n\t\tthis._collectorCnt = 0;\n\t\tthis._outgoingEvents = [];\n\t}\n\n\tpublic emitOutgoingEvent(e: OutgoingViewModelEvent): void {\n\t\tthis._addOutgoingEvent(e);\n\t\tthis._emitOutgoingEvents();\n\t}\n\n\tprivate _addOutgoingEvent(e: OutgoingViewModelEvent): void {\n\t\tfor (let i = 0, len = this._outgoingEvents.length; i < len; i++) {\n\t\t\tconst mergeResult = (this._outgoingEvents[i].kind === e.kind ? this._outgoingEvents[i].attemptToMerge(e) : null);\n\t\t\tif (mergeResult) {\n\t\t\t\tthis._outgoingEvents[i] = mergeResult;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t// not merged\n\t\tthis._outgoingEvents.push(e);\n\t}\n\n\tprivate _emitOutgoingEvents(): void {\n\t\twhile (this._outgoingEvents.length > 0) {\n\t\t\tif (this._collector || this._isConsumingViewEventQueue) {\n\t\t\t\t// right now collecting or emitting view events, so let's postpone emitting\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst event = this._outgoingEvents.shift()!;\n\t\t\tif (event.isNoOp()) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis._onEvent.fire(event);\n\t\t}\n\t}\n\n\tpublic addViewEventHandler(eventHandler: ViewEventHandler): void {\n\t\tfor (let i = 0, len = this._eventHandlers.length; i < len; i++) {\n\t\t\tif (this._eventHandlers[i] === eventHandler) {\n\t\t\t\tconsole.warn('Detected duplicate listener in ViewEventDispatcher', eventHandler);\n\t\t\t}\n\t\t}\n\t\tthis._eventHandlers.push(eventHandler);\n\t}\n\n\tpublic removeViewEventHandler(eventHandler: ViewEventHandler): void {\n\t\tfor (let i = 0; i < this._eventHandlers.length; i++) {\n\t\t\tif (this._eventHandlers[i] === eventHandler) {\n\t\t\t\tthis._eventHandlers.splice(i, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic beginEmitViewEvents(): ViewModelEventsCollector {\n\t\tthis._collectorCnt++;\n\t\tif (this._collectorCnt === 1) {\n\t\t\tthis._collector = new ViewModelEventsCollector();\n\t\t}\n\t\treturn this._collector!;\n\t}\n\n\tpublic endEmitViewEvents(): void {\n\t\tthis._collectorCnt--;\n\t\tif (this._collectorCnt === 0) {\n\t\t\tconst outgoingEvents = this._collector!.outgoingEvents;\n\t\t\tconst viewEvents = this._collector!.viewEvents;\n\t\t\tthis._collector = null;\n\n\t\t\tfor (const outgoingEvent of outgoingEvents) {\n\t\t\t\tthis._addOutgoingEvent(outgoingEvent);\n\t\t\t}\n\n\t\t\tif (viewEvents.length > 0) {\n\t\t\t\tthis._emitMany(viewEvents);\n\t\t\t}\n\t\t}\n\t\tthis._emitOutgoingEvents();\n\t}\n\n\tpublic emitSingleViewEvent(event: ViewEvent): void {\n\t\ttry {\n\t\t\tconst eventsCollector = this.beginEmitViewEvents();\n\t\t\teventsCollector.emitViewEvent(event);\n\t\t} finally {\n\t\t\tthis.endEmitViewEvents();\n\t\t}\n\t}\n\n\tprivate _emitMany(events: ViewEvent[]): void {\n\t\tif (this._viewEventQueue) {\n\t\t\tthis._viewEventQueue = this._viewEventQueue.concat(events);\n\t\t} else {\n\t\t\tthis._viewEventQueue = events;\n\t\t}\n\n\t\tif (!this._isConsumingViewEventQueue) {\n\t\t\tthis._consumeViewEventQueue();\n\t\t}\n\t}\n\n\tprivate _consumeViewEventQueue(): void {\n\t\ttry {\n\t\t\tthis._isConsumingViewEventQueue = true;\n\t\t\tthis._doConsumeQueue();\n\t\t} finally {\n\t\t\tthis._isConsumingViewEventQueue = false;\n\t\t}\n\t}\n\n\tprivate _doConsumeQueue(): void {\n\t\twhile (this._viewEventQueue) {\n\t\t\t// Empty event queue, as events might come in while sending these off\n\t\t\tconst events = this._viewEventQueue;\n\t\t\tthis._viewEventQueue = null;\n\n\t\t\t// Use a clone of the event handlers list, as they might remove themselves\n\t\t\tconst eventHandlers = this._eventHandlers.slice(0);\n\t\t\tfor (const eventHandler of eventHandlers) {\n\t\t\t\teventHandler.handleEvents(events);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport class ViewModelEventsCollector {\n\n\tpublic readonly viewEvents: ViewEvent[];\n\tpublic readonly outgoingEvents: OutgoingViewModelEvent[];\n\n\tconstructor() {\n\t\tthis.viewEvents = [];\n\t\tthis.outgoingEvents = [];\n\t}\n\n\tpublic emitViewEvent(event: ViewEvent) {\n\t\tthis.viewEvents.push(event);\n\t}\n\n\tpublic emitOutgoingEvent(e: OutgoingViewModelEvent): void {\n\t\tthis.outgoingEvents.push(e);\n\t}\n}\n\nexport type OutgoingViewModelEvent = (\n\tContentSizeChangedEvent\n\t| FocusChangedEvent\n\t| ScrollChangedEvent\n\t| ViewZonesChangedEvent\n\t| HiddenAreasChangedEvent\n\t| ReadOnlyEditAttemptEvent\n\t| CursorStateChangedEvent\n\t| ModelDecorationsChangedEvent\n\t| ModelLanguageChangedEvent\n\t| ModelLanguageConfigurationChangedEvent\n\t| ModelContentChangedEvent\n\t| ModelOptionsChangedEvent\n\t| ModelTokensChangedEvent\n);\n\nexport const enum OutgoingViewModelEventKind {\n\tContentSizeChanged,\n\tFocusChanged,\n\tScrollChanged,\n\tViewZonesChanged,\n\tHiddenAreasChanged,\n\tReadOnlyEditAttempt,\n\tCursorStateChanged,\n\tModelDecorationsChanged,\n\tModelLanguageChanged,\n\tModelLanguageConfigurationChanged,\n\tModelContentChanged,\n\tModelOptionsChanged,\n\tModelTokensChanged,\n}\n\nexport class ContentSizeChangedEvent implements IContentSizeChangedEvent {\n\n\tpublic readonly kind = OutgoingViewModelEventKind.ContentSizeChanged;\n\n\tprivate readonly _oldContentWidth: number;\n\tprivate readonly _oldContentHeight: number;\n\n\treadonly contentWidth: number;\n\treadonly contentHeight: number;\n\treadonly contentWidthChanged: boolean;\n\treadonly contentHeightChanged: boolean;\n\n\tconstructor(oldContentWidth: number, oldContentHeight: number, contentWidth: number, contentHeight: number) {\n\t\tthis._oldContentWidth = oldContentWidth;\n\t\tthis._oldContentHeight = oldContentHeight;\n\t\tthis.contentWidth = contentWidth;\n\t\tthis.contentHeight = contentHeight;\n\t\tthis.contentWidthChanged = (this._oldContentWidth !== this.contentWidth);\n\t\tthis.contentHeightChanged = (this._oldContentHeight !== this.contentHeight);\n\t}\n\n\tpublic isNoOp(): boolean {\n\t\treturn (!this.contentWidthChanged && !this.contentHeightChanged);\n\t}\n\n\tpublic attemptToMerge(other: OutgoingViewModelEvent): OutgoingViewModelEvent | null {\n\t\tif (other.kind !== this.kind) {\n\t\t\treturn null;\n\t\t}\n\t\treturn new ContentSizeChangedEvent(this._oldContentWidth, this._oldContentHeight, other.contentWidth, other.contentHeight);\n\t}\n}\n\nexport class FocusChangedEvent {\n\n\tpublic readonly kind = OutgoingViewModelEventKind.FocusChanged;\n\n\treadonly oldHasFocus: boolean;\n\treadonly hasFocus: boolean;\n\n\tconstructor(oldHasFocus: boolean, hasFocus: boolean) {\n\t\tthis.oldHasFocus = oldHasFocus;\n\t\tthis.hasFocus = hasFocus;\n\t}\n\n\tpublic isNoOp(): boolean {\n\t\treturn (this.oldHasFocus === this.hasFocus);\n\t}\n\n\tpublic attemptToMerge(other: OutgoingViewModelEvent): OutgoingViewModelEvent | null {\n\t\tif (other.kind !== this.kind) {\n\t\t\treturn null;\n\t\t}\n\t\treturn new FocusChangedEvent(this.oldHasFocus, other.hasFocus);\n\t}\n}\n\nexport class ScrollChangedEvent {\n\n\tpublic readonly kind = OutgoingViewModelEventKind.ScrollChanged;\n\n\tprivate readonly _oldScrollWidth: number;\n\tprivate readonly _oldScrollLeft: number;\n\tprivate readonly _oldScrollHeight: number;\n\tprivate readonly _oldScrollTop: number;\n\n\tpublic readonly scrollWidth: number;\n\tpublic readonly scrollLeft: number;\n\tpublic readonly scrollHeight: number;\n\tpublic readonly scrollTop: number;\n\n\tpublic readonly scrollWidthChanged: boolean;\n\tpublic readonly scrollLeftChanged: boolean;\n\tpublic readonly scrollHeightChanged: boolean;\n\tpublic readonly scrollTopChanged: boolean;\n\n\tconstructor(\n\t\toldScrollWidth: number, oldScrollLeft: number, oldScrollHeight: number, oldScrollTop: number,\n\t\tscrollWidth: number, scrollLeft: number, scrollHeight: number, scrollTop: number,\n\t) {\n\t\tthis._oldScrollWidth = oldScrollWidth;\n\t\tthis._oldScrollLeft = oldScrollLeft;\n\t\tthis._oldScrollHeight = oldScrollHeight;\n\t\tthis._oldScrollTop = oldScrollTop;\n\n\t\tthis.scrollWidth = scrollWidth;\n\t\tthis.scrollLeft = scrollLeft;\n\t\tthis.scrollHeight = scrollHeight;\n\t\tthis.scrollTop = scrollTop;\n\n\t\tthis.scrollWidthChanged = (this._oldScrollWidth !== this.scrollWidth);\n\t\tthis.scrollLeftChanged = (this._oldScrollLeft !== this.scrollLeft);\n\t\tthis.scrollHeightChanged = (this._oldScrollHeight !== this.scrollHeight);\n\t\tthis.scrollTopChanged = (this._oldScrollTop !== this.scrollTop);\n\t}\n\n\tpublic isNoOp(): boolean {\n\t\treturn (!this.scrollWidthChanged && !this.scrollLeftChanged && !this.scrollHeightChanged && !this.scrollTopChanged);\n\t}\n\n\tpublic attemptToMerge(other: OutgoingViewModelEvent): OutgoingViewModelEvent | null {\n\t\tif (other.kind !== this.kind) {\n\t\t\treturn null;\n\t\t}\n\t\treturn new ScrollChangedEvent(\n\t\t\tthis._oldScrollWidth, this._oldScrollLeft, this._oldScrollHeight, this._oldScrollTop,\n\t\t\tother.scrollWidth, other.scrollLeft, other.scrollHeight, other.scrollTop\n\t\t);\n\t}\n}\n\nexport class ViewZonesChangedEvent {\n\n\tpublic readonly kind = OutgoingViewModelEventKind.ViewZonesChanged;\n\n\tconstructor() {\n\t}\n\n\tpublic isNoOp(): boolean {\n\t\treturn false;\n\t}\n\n\tpublic attemptToMerge(other: OutgoingViewModelEvent): OutgoingViewModelEvent | null {\n\t\tif (other.kind !== this.kind) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this;\n\t}\n}\n\nexport class HiddenAreasChangedEvent {\n\n\tpublic readonly kind = OutgoingViewModelEventKind.HiddenAreasChanged;\n\n\tconstructor() {\n\t}\n\n\tpublic isNoOp(): boolean {\n\t\treturn false;\n\t}\n\n\tpublic attemptToMerge(other: OutgoingViewModelEvent): OutgoingViewModelEvent | null {\n\t\tif (other.kind !== this.kind) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this;\n\t}\n}\n\nexport class CursorStateChangedEvent {\n\n\tpublic readonly kind = OutgoingViewModelEventKind.CursorStateChanged;\n\n\tpublic readonly oldSelections: Selection[] | null;\n\tpublic readonly selections: Selection[];\n\tpublic readonly oldModelVersionId: number;\n\tpublic readonly modelVersionId: number;\n\tpublic readonly source: string;\n\tpublic readonly reason: CursorChangeReason;\n\tpublic readonly reachedMaxCursorCount: boolean;\n\n\tconstructor(oldSelections: Selection[] | null, selections: Selection[], oldModelVersionId: number, modelVersionId: number, source: string, reason: CursorChangeReason, reachedMaxCursorCount: boolean) {\n\t\tthis.oldSelections = oldSelections;\n\t\tthis.selections = selections;\n\t\tthis.oldModelVersionId = oldModelVersionId;\n\t\tthis.modelVersionId = modelVersionId;\n\t\tthis.source = source;\n\t\tthis.reason = reason;\n\t\tthis.reachedMaxCursorCount = reachedMaxCursorCount;\n\t}\n\n\tprivate static _selectionsAreEqual(a: Selection[] | null, b: Selection[] | null): boolean {\n\t\tif (!a && !b) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!a || !b) {\n\t\t\treturn false;\n\t\t}\n\t\tconst aLen = a.length;\n\t\tconst bLen = b.length;\n\t\tif (aLen !== bLen) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (let i = 0; i < aLen; i++) {\n\t\t\tif (!a[i].equalsSelection(b[i])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic isNoOp(): boolean {\n\t\treturn (\n\t\t\tCursorStateChangedEvent._selectionsAreEqual(this.oldSelections, this.selections)\n\t\t\t&& this.oldModelVersionId === this.modelVersionId\n\t\t);\n\t}\n\n\tpublic attemptToMerge(other: OutgoingViewModelEvent): OutgoingViewModelEvent | null {\n\t\tif (other.kind !== this.kind) {\n\t\t\treturn null;\n\t\t}\n\t\treturn new CursorStateChangedEvent(\n\t\t\tthis.oldSelections, other.selections, this.oldModelVersionId, other.modelVersionId, other.source, other.reason, this.reachedMaxCursorCount || other.reachedMaxCursorCount\n\t\t);\n\t}\n}\n\nexport class ReadOnlyEditAttemptEvent {\n\n\tpublic readonly kind = OutgoingViewModelEventKind.ReadOnlyEditAttempt;\n\n\tconstructor() {\n\t}\n\n\tpublic isNoOp(): boolean {\n\t\treturn false;\n\t}\n\n\tpublic attemptToMerge(other: OutgoingViewModelEvent): OutgoingViewModelEvent | null {\n\t\tif (other.kind !== this.kind) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this;\n\t}\n}\n\nexport class ModelDecorationsChangedEvent {\n\tpublic readonly kind = OutgoingViewModelEventKind.ModelDecorationsChanged;\n\n\tconstructor(\n\t\tpublic readonly event: IModelDecorationsChangedEvent\n\t) { }\n\n\tpublic isNoOp(): boolean {\n\t\treturn false;\n\t}\n\n\tpublic attemptToMerge(other: OutgoingViewModelEvent): OutgoingViewModelEvent | null {\n\t\treturn null;\n\t}\n}\n\nexport class ModelLanguageChangedEvent {\n\tpublic readonly kind = OutgoingViewModelEventKind.ModelLanguageChanged;\n\n\tconstructor(\n\t\tpublic readonly event: IModelLanguageChangedEvent\n\t) { }\n\n\tpublic isNoOp(): boolean {\n\t\treturn false;\n\t}\n\n\tpublic attemptToMerge(other: OutgoingViewModelEvent): OutgoingViewModelEvent | null {\n\t\treturn null;\n\t}\n}\n\nexport class ModelLanguageConfigurationChangedEvent {\n\tpublic readonly kind = OutgoingViewModelEventKind.ModelLanguageConfigurationChanged;\n\n\tconstructor(\n\t\tpublic readonly event: IModelLanguageConfigurationChangedEvent\n\t) { }\n\n\tpublic isNoOp(): boolean {\n\t\treturn false;\n\t}\n\n\tpublic attemptToMerge(other: OutgoingViewModelEvent): OutgoingViewModelEvent | null {\n\t\treturn null;\n\t}\n}\n\nexport class ModelContentChangedEvent {\n\tpublic readonly kind = OutgoingViewModelEventKind.ModelContentChanged;\n\n\tconstructor(\n\t\tpublic readonly event: IModelContentChangedEvent\n\t) { }\n\n\tpublic isNoOp(): boolean {\n\t\treturn false;\n\t}\n\n\tpublic attemptToMerge(other: OutgoingViewModelEvent): OutgoingViewModelEvent | null {\n\t\treturn null;\n\t}\n}\n\nexport class ModelOptionsChangedEvent {\n\tpublic readonly kind = OutgoingViewModelEventKind.ModelOptionsChanged;\n\n\tconstructor(\n\t\tpublic readonly event: IModelOptionsChangedEvent\n\t) { }\n\n\tpublic isNoOp(): boolean {\n\t\treturn false;\n\t}\n\n\tpublic attemptToMerge(other: OutgoingViewModelEvent): OutgoingViewModelEvent | null {\n\t\treturn null;\n\t}\n}\n\nexport class ModelTokensChangedEvent {\n\tpublic readonly kind = OutgoingViewModelEventKind.ModelTokensChanged;\n\n\tconstructor(\n\t\tpublic readonly event: IModelTokensChangedEvent\n\t) { }\n\n\tpublic isNoOp(): boolean {\n\t\treturn false;\n\t}\n\n\tpublic attemptToMerge(other: OutgoingViewModelEvent): OutgoingViewModelEvent | null {\n\t\treturn null;\n\t}\n}\n"]}