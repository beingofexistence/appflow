{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/common/modelLineProjectionData.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;IAShG;;;;;;;;;;;;;;;;;;;;;;;;OAwBG;IACH,MAAa,GAAG;QACf,YACQ,gBAAiC;QACxC;;WAEG;QACI,gBAA8C;QACrD;;;WAGG;QACI,YAAsB;QAC7B;;WAEG;QACI,yBAAmC,EACnC,uBAA+B;YAd/B,qBAAgB,GAAhB,gBAAgB,CAAiB;YAIjC,qBAAgB,GAAhB,gBAAgB,CAA8B;YAK9C,iBAAY,GAAZ,YAAY,CAAU;YAItB,8BAAyB,GAAzB,yBAAyB,CAAU;YACnC,4BAAuB,GAAvB,uBAAuB,CAAQ;QAEvC,CAAC;QAEM,kBAAkB;YACxB,OAAO,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC;QACjC,CAAC;QAEM,kBAAkB,CAAC,eAAuB;YAChD,IAAI,eAAe,GAAG,CAAC,EAAE;gBACxB,OAAO,IAAI,CAAC,uBAAuB,CAAC;aACpC;YACD,OAAO,CAAC,CAAC;QACV,CAAC;QAEM,aAAa,CAAC,eAAuB;YAC3C,wDAAwD;YACxD,MAAM,WAAW,GAAG,eAAe,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,eAAe,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACrF,MAAM,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC;YAErD,IAAI,UAAU,GAAG,SAAS,GAAG,WAAW,CAAC;YACzC,IAAI,eAAe,GAAG,CAAC,EAAE;gBACxB,UAAU,IAAI,IAAI,CAAC,uBAAuB,CAAC;aAC3C;YACD,OAAO,UAAU,CAAC;QACnB,CAAC;QAEM,kBAAkB,CAAC,eAAuB;YAChD,OAAO,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;QAC5C,CAAC;QAEM,sBAAsB,CAAC,eAAuB,EAAE,YAAoB;YAC1E,IAAI,eAAe,GAAG,CAAC,EAAE;gBACxB,YAAY,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,YAAY,GAAG,IAAI,CAAC,uBAAuB,CAAC,CAAC;aACxE;YAED,MAAM,0BAA0B,GAAG,eAAe,KAAK,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,eAAe,GAAG,CAAC,CAAC,GAAG,YAAY,CAAC;YAChI,IAAI,aAAa,GAAG,0BAA0B,CAAC;YAE/C,IAAI,IAAI,CAAC,gBAAgB,KAAK,IAAI,EAAE;gBACnC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBACtD,IAAI,aAAa,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,EAAE;wBAC7C,IAAI,aAAa,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAiB,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,EAAE;4BACxF,wCAAwC;4BACxC,aAAa,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;yBACzC;6BAAM;4BACN,aAAa,IAAI,IAAI,CAAC,gBAAiB,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC;yBAC1D;qBACD;yBAAM;wBACN,MAAM;qBACN;iBACD;aACD;YAED,OAAO,aAAa,CAAC;QACtB,CAAC;QAEM,yBAAyB,CAAC,WAAmB,EAAE,wCAAkD;YACvG,IAAI,+BAA+B,GAAG,WAAW,CAAC;YAClD,IAAI,IAAI,CAAC,gBAAgB,KAAK,IAAI,EAAE;gBACnC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBACtD,IAAI,WAAW,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,EAAE;wBAC3C,MAAM;qBACN;oBAED,IAAI,QAAQ,mCAA2B,IAAI,WAAW,KAAK,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,EAAE;wBACpF,MAAM;qBACN;oBAED,+BAA+B,IAAI,IAAI,CAAC,gBAAiB,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC;iBAC5E;aACD;YAED,OAAO,IAAI,CAAC,CAAC,CAA2C,+BAA+B,EAAE,QAAQ,CAAC,CAAC;QACpG,CAAC;QAEO,CAAC,CAA2C,2BAAmC,EAAE,wCAAkD;YAC1I,IAAI,GAAG,GAAG,CAAC,CAAC;YACZ,IAAI,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC;YACxC,IAAI,GAAG,GAAG,CAAC,CAAC;YACZ,IAAI,QAAQ,GAAG,CAAC,CAAC;YAEjB,OAAO,GAAG,IAAI,IAAI,EAAE;gBACnB,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;gBAEnC,MAAM,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;gBACvC,QAAQ,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBAEpD,IAAI,QAAQ,kCAA0B,EAAE;oBACvC,IAAI,2BAA2B,IAAI,QAAQ,EAAE;wBAC5C,IAAI,GAAG,GAAG,GAAG,CAAC,CAAC;qBACf;yBAAM,IAAI,2BAA2B,GAAG,OAAO,EAAE;wBACjD,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC;qBACd;yBAAM;wBACN,MAAM;qBACN;iBACD;qBAAM;oBACN,IAAI,2BAA2B,GAAG,QAAQ,EAAE;wBAC3C,IAAI,GAAG,GAAG,GAAG,CAAC,CAAC;qBACf;yBAAM,IAAI,2BAA2B,IAAI,OAAO,EAAE;wBAClD,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC;qBACd;yBAAM;wBACN,MAAM;qBACN;iBACD;aACD;YAED,IAAI,YAAY,GAAG,2BAA2B,GAAG,QAAQ,CAAC;YAC1D,IAAI,GAAG,GAAG,CAAC,EAAE;gBACZ,YAAY,IAAI,IAAI,CAAC,uBAAuB,CAAC;aAC7C;YAED,OAAO,IAAI,GAAG,CAAY,GAAG,EAAE,YAAY,CAAC,CAAC;QAC9C,CAAC;QAEM,uBAAuB,CAAC,eAAuB,EAAE,YAAoB,EAAE,QAA0B;YACvG,IAAI,IAAI,CAAC,gBAAgB,KAAK,IAAI,EAAE;gBACnC,MAAM,2BAA2B,GAAG,IAAI,CAAC,CAAC,CAA2C,eAAe,EAAE,YAAY,CAAC,CAAC;gBACpH,MAAM,+BAA+B,GAAG,IAAI,CAAC,CAAC,CAAoD,2BAA2B,EAAE,QAAQ,CAAC,CAAC;gBACzI,IAAI,+BAA+B,KAAK,2BAA2B,EAAE;oBACpE,gCAAgC;oBAChC,OAAO,IAAI,CAAC,CAAC,CAA2C,+BAA+B,EAAE,QAAQ,CAAC,CAAC;iBACnG;aACD;YAED,IAAI,QAAQ,kCAA0B,EAAE;gBACvC,IAAI,eAAe,GAAG,CAAC,IAAI,YAAY,KAAK,IAAI,CAAC,kBAAkB,CAAC,eAAe,CAAC,EAAE;oBACrF,OAAO,IAAI,GAAG,CAAY,eAAe,GAAG,CAAC,EAAE,IAAI,CAAC,kBAAkB,CAAC,eAAe,GAAG,CAAC,CAAC,CAAC,CAAC;iBAC7F;aACD;iBACI,IAAI,QAAQ,mCAA2B,EAAE;gBAC7C,MAAM,kBAAkB,GAAG,IAAI,CAAC,kBAAkB,EAAE,GAAG,CAAC,CAAC;gBACzD,IAAI,eAAe,GAAG,kBAAkB,IAAI,YAAY,KAAK,IAAI,CAAC,kBAAkB,CAAC,eAAe,CAAC,EAAE;oBACtG,OAAO,IAAI,GAAG,CAAY,eAAe,GAAG,CAAC,EAAE,IAAI,CAAC,kBAAkB,CAAC,eAAe,GAAG,CAAC,CAAC,CAAC,CAAC;iBAC7F;aACD;YAED,OAAO,IAAI,GAAG,CAAY,eAAe,EAAE,YAAY,CAAC,CAAC;QAC1D,CAAC;QAEO,CAAC,CAA2C,eAAuB,EAAE,YAAoB;YAChG,IAAI,eAAe,GAAG,CAAC,EAAE;gBACxB,YAAY,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,YAAY,GAAG,IAAI,CAAC,uBAAuB,CAAC,CAAC;aACxE;YACD,MAAM,MAAM,GAAG,CAAC,eAAe,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,eAAe,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,YAAY,CAAC;YACjG,OAAO,MAAM,CAAC;QACf,CAAC;QAEO,CAAC,CAAoD,2BAAmC,EAAE,QAA0B;YAC3H,MAAM,YAAY,GAAG,IAAI,CAAC,CAAC,CAAuB,2BAA2B,CAAC,CAAC;YAC/E,IAAI,CAAC,YAAY,EAAE;gBAClB,OAAO,2BAA2B,CAAC;aACnC;YAED,IAAI,QAAQ,kCAA0B,EAAE;gBACvC,IAAI,2BAA2B,KAAK,YAAY,CAAC,2BAA2B,GAAG,YAAY,CAAC,MAAM;uBAC9F,kBAAkB,CAAC,IAAI,CAAC,gBAAiB,CAAC,YAAY,CAAC,iBAAiB,CAAC,CAAC,WAAW,CAAC,EAAE;oBAC3F,OAAO,YAAY,CAAC,2BAA2B,GAAG,YAAY,CAAC,MAAM,CAAC;iBACtE;qBAAM;oBACN,IAAI,MAAM,GAAG,YAAY,CAAC,2BAA2B,CAAC;oBACtD,IAAI,iBAAiB,CAAC,IAAI,CAAC,gBAAiB,CAAC,YAAY,CAAC,iBAAiB,CAAC,CAAC,WAAW,CAAC,EAAE;wBAC1F,OAAO,MAAM,CAAC;qBACd;oBAED,IAAI,KAAK,GAAG,YAAY,CAAC,iBAAiB,GAAG,CAAC,CAAC;oBAC/C,OAAO,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC,gBAAiB,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,gBAAiB,CAAC,YAAY,CAAC,iBAAiB,CAAC,EAAE;wBAC9G,IAAI,kBAAkB,CAAC,IAAI,CAAC,gBAAiB,CAAC,KAAK,CAAC,CAAC,WAAW,CAAC,EAAE;4BAClE,MAAM;yBACN;wBACD,MAAM,IAAI,IAAI,CAAC,gBAAiB,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC;wBACvD,IAAI,iBAAiB,CAAC,IAAI,CAAC,gBAAiB,CAAC,KAAK,CAAC,CAAC,WAAW,CAAC,EAAE;4BACjE,MAAM;yBACN;wBACD,KAAK,EAAE,CAAC;qBACR;oBAED,OAAO,MAAM,CAAC;iBACd;aACD;iBAAM,IAAI,QAAQ,mCAA2B,IAAI,QAAQ,iDAAyC,EAAE;gBACpG,IAAI,MAAM,GAAG,YAAY,CAAC,2BAA2B,GAAG,YAAY,CAAC,MAAM,CAAC;gBAC5E,IAAI,KAAK,GAAG,YAAY,CAAC,iBAAiB,CAAC;gBAC3C,mDAAmD;gBACnD,OAAO,KAAK,GAAG,CAAC,GAAG,IAAI,CAAC,gBAAiB,CAAC,MAAM,IAAI,IAAI,CAAC,gBAAiB,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,IAAI,CAAC,gBAAiB,CAAC,KAAK,CAAC,EAAE;oBACxH,MAAM,IAAI,IAAI,CAAC,gBAAiB,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC;oBAC3D,KAAK,EAAE,CAAC;iBACR;gBACD,OAAO,MAAM,CAAC;aACd;iBAAM,IAAI,QAAQ,kCAA0B,IAAI,QAAQ,gDAAwC,EAAE;gBAClG,mBAAmB;gBACnB,IAAI,MAAM,GAAG,YAAY,CAAC,2BAA2B,CAAC;gBACtD,IAAI,KAAK,GAAG,YAAY,CAAC,iBAAiB,CAAC;gBAC3C,mDAAmD;gBACnD,OAAO,KAAK,GAAG,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,gBAAiB,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,IAAI,CAAC,gBAAiB,CAAC,KAAK,CAAC,EAAE;oBAC7F,MAAM,IAAI,IAAI,CAAC,gBAAiB,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC;oBAC3D,KAAK,EAAE,CAAC;iBACR;gBACD,OAAO,MAAM,CAAC;aACd;YAED,IAAA,YAAG,EAAS,QAAQ,CAAC,CAAC;QACvB,CAAC;QAEM,eAAe,CAAC,eAAuB,EAAE,YAAoB;YACnE,MAAM,MAAM,GAAG,IAAI,CAAC,CAAC,CAA2C,eAAe,EAAE,YAAY,CAAC,CAAC;YAC/F,MAAM,YAAY,GAAG,IAAI,CAAC,CAAC,CAAuB,MAAM,CAAC,CAAC;YAC1D,IAAI,CAAC,YAAY,EAAE;gBAClB,OAAO,IAAI,CAAC;aACZ;YACD,OAAO;gBACN,OAAO,EAAE,IAAI,CAAC,gBAAiB,CAAC,YAAY,CAAC,iBAAiB,CAAC;aAC/D,CAAC;QACH,CAAC;QAEO,CAAC,CAAuB,2BAAmC;YAClE,MAAM,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,CAAC;YAC/C,MAAM,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,CAAC;YAE/C,IAAI,gBAAgB,KAAK,IAAI,EAAE;gBAC9B,IAAI,6BAA6B,GAAG,CAAC,CAAC;gBACtC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,gBAAgB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBACjD,MAAM,MAAM,GAAG,gBAAiB,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC;oBACnD,MAAM,4CAA4C,GAAG,gBAAgB,CAAC,CAAC,CAAC,GAAG,6BAA6B,CAAC;oBACzG,MAAM,0CAA0C,GAAG,gBAAgB,CAAC,CAAC,CAAC,GAAG,6BAA6B,GAAG,MAAM,CAAC;oBAEhH,IAAI,4CAA4C,GAAG,2BAA2B,EAAE;wBAC/E,8BAA8B;wBAC9B,MAAM,CAAC,uDAAuD;qBAC9D;oBAED,IAAI,2BAA2B,IAAI,0CAA0C,EAAE;wBAC9E,2FAA2F;wBAC3F,OAAO;4BACN,iBAAiB,EAAE,CAAC;4BACpB,2BAA2B,EAAE,4CAA4C;4BACzE,MAAM;yBACN,CAAC;qBACF;oBAED,6BAA6B,IAAI,MAAM,CAAC;iBACxC;aACD;YAED,OAAO,SAAS,CAAC;QAClB,CAAC;KACD;IApQD,kBAoQC;IAED,SAAS,kBAAkB,CAAC,UAAsD;QACjF,IAAI,UAAU,KAAK,IAAI,IAAI,UAAU,KAAK,SAAS,EAAE;YAAE,OAAO,IAAI,CAAC;SAAE;QACrE,OAAO,UAAU,KAAK,+BAAuB,CAAC,KAAK,IAAI,UAAU,KAAK,+BAAuB,CAAC,IAAI,CAAC;IACpG,CAAC;IACD,SAAS,iBAAiB,CAAC,UAAsD;QAChF,IAAI,UAAU,KAAK,IAAI,IAAI,UAAU,KAAK,SAAS,EAAE;YAAE,OAAO,IAAI,CAAC;SAAE;QACrE,OAAO,UAAU,KAAK,+BAAuB,CAAC,IAAI,IAAI,UAAU,KAAK,+BAAuB,CAAC,IAAI,CAAC;IACnG,CAAC;IAED,MAAa,GAAG;QACf,YAA4B,OAA4B;YAA5B,YAAO,GAAP,OAAO,CAAqB;QAAI,CAAC;KAC7D;IAFD,kBAEC;IAED,MAAa,GAAG;QAIf,YAAY,eAAuB,EAAE,YAAoB;YACxD,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;YACvC,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;QAClC,CAAC;QAED,QAAQ;YACP,OAAO,GAAG,IAAI,CAAC,eAAe,IAAI,IAAI,CAAC,YAAY,EAAE,CAAC;QACvD,CAAC;QAED,UAAU,CAAC,cAAsB;YAChC,OAAO,IAAI,cAAG,CAAM,cAAc,GAAG,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC;QACnF,CAAC;KACD;IAhBD,kBAgBC","file":"modelLineProjectionData.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { assertNever } from 'vs/base/common/assert';\nimport { WrappingIndent } from 'vs/editor/common/config/editorOptions';\nimport { FontInfo } from 'vs/editor/common/config/fontInfo';\nimport { Position } from 'vs/editor/common/core/position';\nimport { InjectedTextCursorStops, InjectedTextOptions, PositionAffinity } from 'vs/editor/common/model';\nimport { LineInjectedText } from 'vs/editor/common/textModelEvents';\n\n/**\n * *input*:\n * ```\n * xxxxxxxxxxxxxxxxxxxxxxxxxxx\n * ```\n *\n * -> Applying injections `[i...i]`, *inputWithInjections*:\n * ```\n * xxxxxx[iiiiiiiiii]xxxxxxxxxxxxxxxxx[ii]xxxx\n * ```\n *\n * -> breaking at offsets `|` in `xxxxxx[iiiiiii|iii]xxxxxxxxxxx|xxxxxx[ii]xxxx|`:\n * ```\n * xxxxxx[iiiiiii\n * iii]xxxxxxxxxxx\n * xxxxxx[ii]xxxx\n * ```\n *\n * -> applying wrappedTextIndentLength, *output*:\n * ```\n * xxxxxx[iiiiiii\n *    iii]xxxxxxxxxxx\n *    xxxxxx[ii]xxxx\n * ```\n */\nexport class ModelLineProjectionData {\n\tconstructor(\n\t\tpublic injectionOffsets: number[] | null,\n\t\t/**\n\t\t * `injectionOptions.length` must equal `injectionOffsets.length`\n\t\t */\n\t\tpublic injectionOptions: InjectedTextOptions[] | null,\n\t\t/**\n\t\t * Refers to offsets after applying injections to the source.\n\t\t * The last break offset indicates the length of the source after applying injections.\n\t\t */\n\t\tpublic breakOffsets: number[],\n\t\t/**\n\t\t * Refers to offsets after applying injections\n\t\t */\n\t\tpublic breakOffsetsVisibleColumn: number[],\n\t\tpublic wrappedTextIndentLength: number\n\t) {\n\t}\n\n\tpublic getOutputLineCount(): number {\n\t\treturn this.breakOffsets.length;\n\t}\n\n\tpublic getMinOutputOffset(outputLineIndex: number): number {\n\t\tif (outputLineIndex > 0) {\n\t\t\treturn this.wrappedTextIndentLength;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tpublic getLineLength(outputLineIndex: number): number {\n\t\t// These offsets refer to model text with injected text.\n\t\tconst startOffset = outputLineIndex > 0 ? this.breakOffsets[outputLineIndex - 1] : 0;\n\t\tconst endOffset = this.breakOffsets[outputLineIndex];\n\n\t\tlet lineLength = endOffset - startOffset;\n\t\tif (outputLineIndex > 0) {\n\t\t\tlineLength += this.wrappedTextIndentLength;\n\t\t}\n\t\treturn lineLength;\n\t}\n\n\tpublic getMaxOutputOffset(outputLineIndex: number): number {\n\t\treturn this.getLineLength(outputLineIndex);\n\t}\n\n\tpublic translateToInputOffset(outputLineIndex: number, outputOffset: number): number {\n\t\tif (outputLineIndex > 0) {\n\t\t\toutputOffset = Math.max(0, outputOffset - this.wrappedTextIndentLength);\n\t\t}\n\n\t\tconst offsetInInputWithInjection = outputLineIndex === 0 ? outputOffset : this.breakOffsets[outputLineIndex - 1] + outputOffset;\n\t\tlet offsetInInput = offsetInInputWithInjection;\n\n\t\tif (this.injectionOffsets !== null) {\n\t\t\tfor (let i = 0; i < this.injectionOffsets.length; i++) {\n\t\t\t\tif (offsetInInput > this.injectionOffsets[i]) {\n\t\t\t\t\tif (offsetInInput < this.injectionOffsets[i] + this.injectionOptions![i].content.length) {\n\t\t\t\t\t\t// `inputOffset` is within injected text\n\t\t\t\t\t\toffsetInInput = this.injectionOffsets[i];\n\t\t\t\t\t} else {\n\t\t\t\t\t\toffsetInInput -= this.injectionOptions![i].content.length;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn offsetInInput;\n\t}\n\n\tpublic translateToOutputPosition(inputOffset: number, affinity: PositionAffinity = PositionAffinity.None): OutputPosition {\n\t\tlet inputOffsetInInputWithInjection = inputOffset;\n\t\tif (this.injectionOffsets !== null) {\n\t\t\tfor (let i = 0; i < this.injectionOffsets.length; i++) {\n\t\t\t\tif (inputOffset < this.injectionOffsets[i]) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (affinity !== PositionAffinity.Right && inputOffset === this.injectionOffsets[i]) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tinputOffsetInInputWithInjection += this.injectionOptions![i].content.length;\n\t\t\t}\n\t\t}\n\n\t\treturn this.offsetInInputWithInjectionsToOutputPosition(inputOffsetInInputWithInjection, affinity);\n\t}\n\n\tprivate offsetInInputWithInjectionsToOutputPosition(offsetInInputWithInjections: number, affinity: PositionAffinity = PositionAffinity.None): OutputPosition {\n\t\tlet low = 0;\n\t\tlet high = this.breakOffsets.length - 1;\n\t\tlet mid = 0;\n\t\tlet midStart = 0;\n\n\t\twhile (low <= high) {\n\t\t\tmid = low + ((high - low) / 2) | 0;\n\n\t\t\tconst midStop = this.breakOffsets[mid];\n\t\t\tmidStart = mid > 0 ? this.breakOffsets[mid - 1] : 0;\n\n\t\t\tif (affinity === PositionAffinity.Left) {\n\t\t\t\tif (offsetInInputWithInjections <= midStart) {\n\t\t\t\t\thigh = mid - 1;\n\t\t\t\t} else if (offsetInInputWithInjections > midStop) {\n\t\t\t\t\tlow = mid + 1;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (offsetInInputWithInjections < midStart) {\n\t\t\t\t\thigh = mid - 1;\n\t\t\t\t} else if (offsetInInputWithInjections >= midStop) {\n\t\t\t\t\tlow = mid + 1;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet outputOffset = offsetInInputWithInjections - midStart;\n\t\tif (mid > 0) {\n\t\t\toutputOffset += this.wrappedTextIndentLength;\n\t\t}\n\n\t\treturn new OutputPosition(mid, outputOffset);\n\t}\n\n\tpublic normalizeOutputPosition(outputLineIndex: number, outputOffset: number, affinity: PositionAffinity): OutputPosition {\n\t\tif (this.injectionOffsets !== null) {\n\t\t\tconst offsetInInputWithInjections = this.outputPositionToOffsetInInputWithInjections(outputLineIndex, outputOffset);\n\t\t\tconst normalizedOffsetInUnwrappedLine = this.normalizeOffsetInInputWithInjectionsAroundInjections(offsetInInputWithInjections, affinity);\n\t\t\tif (normalizedOffsetInUnwrappedLine !== offsetInInputWithInjections) {\n\t\t\t\t// injected text caused a change\n\t\t\t\treturn this.offsetInInputWithInjectionsToOutputPosition(normalizedOffsetInUnwrappedLine, affinity);\n\t\t\t}\n\t\t}\n\n\t\tif (affinity === PositionAffinity.Left) {\n\t\t\tif (outputLineIndex > 0 && outputOffset === this.getMinOutputOffset(outputLineIndex)) {\n\t\t\t\treturn new OutputPosition(outputLineIndex - 1, this.getMaxOutputOffset(outputLineIndex - 1));\n\t\t\t}\n\t\t}\n\t\telse if (affinity === PositionAffinity.Right) {\n\t\t\tconst maxOutputLineIndex = this.getOutputLineCount() - 1;\n\t\t\tif (outputLineIndex < maxOutputLineIndex && outputOffset === this.getMaxOutputOffset(outputLineIndex)) {\n\t\t\t\treturn new OutputPosition(outputLineIndex + 1, this.getMinOutputOffset(outputLineIndex + 1));\n\t\t\t}\n\t\t}\n\n\t\treturn new OutputPosition(outputLineIndex, outputOffset);\n\t}\n\n\tprivate outputPositionToOffsetInInputWithInjections(outputLineIndex: number, outputOffset: number): number {\n\t\tif (outputLineIndex > 0) {\n\t\t\toutputOffset = Math.max(0, outputOffset - this.wrappedTextIndentLength);\n\t\t}\n\t\tconst result = (outputLineIndex > 0 ? this.breakOffsets[outputLineIndex - 1] : 0) + outputOffset;\n\t\treturn result;\n\t}\n\n\tprivate normalizeOffsetInInputWithInjectionsAroundInjections(offsetInInputWithInjections: number, affinity: PositionAffinity): number {\n\t\tconst injectedText = this.getInjectedTextAtOffset(offsetInInputWithInjections);\n\t\tif (!injectedText) {\n\t\t\treturn offsetInInputWithInjections;\n\t\t}\n\n\t\tif (affinity === PositionAffinity.None) {\n\t\t\tif (offsetInInputWithInjections === injectedText.offsetInInputWithInjections + injectedText.length\n\t\t\t\t&& hasRightCursorStop(this.injectionOptions![injectedText.injectedTextIndex].cursorStops)) {\n\t\t\t\treturn injectedText.offsetInInputWithInjections + injectedText.length;\n\t\t\t} else {\n\t\t\t\tlet result = injectedText.offsetInInputWithInjections;\n\t\t\t\tif (hasLeftCursorStop(this.injectionOptions![injectedText.injectedTextIndex].cursorStops)) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\n\t\t\t\tlet index = injectedText.injectedTextIndex - 1;\n\t\t\t\twhile (index >= 0 && this.injectionOffsets![index] === this.injectionOffsets![injectedText.injectedTextIndex]) {\n\t\t\t\t\tif (hasRightCursorStop(this.injectionOptions![index].cursorStops)) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tresult -= this.injectionOptions![index].content.length;\n\t\t\t\t\tif (hasLeftCursorStop(this.injectionOptions![index].cursorStops)) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t} else if (affinity === PositionAffinity.Right || affinity === PositionAffinity.RightOfInjectedText) {\n\t\t\tlet result = injectedText.offsetInInputWithInjections + injectedText.length;\n\t\t\tlet index = injectedText.injectedTextIndex;\n\t\t\t// traverse all injected text that touch each other\n\t\t\twhile (index + 1 < this.injectionOffsets!.length && this.injectionOffsets![index + 1] === this.injectionOffsets![index]) {\n\t\t\t\tresult += this.injectionOptions![index + 1].content.length;\n\t\t\t\tindex++;\n\t\t\t}\n\t\t\treturn result;\n\t\t} else if (affinity === PositionAffinity.Left || affinity === PositionAffinity.LeftOfInjectedText) {\n\t\t\t// affinity is left\n\t\t\tlet result = injectedText.offsetInInputWithInjections;\n\t\t\tlet index = injectedText.injectedTextIndex;\n\t\t\t// traverse all injected text that touch each other\n\t\t\twhile (index - 1 >= 0 && this.injectionOffsets![index - 1] === this.injectionOffsets![index]) {\n\t\t\t\tresult -= this.injectionOptions![index - 1].content.length;\n\t\t\t\tindex--;\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\n\t\tassertNever(affinity);\n\t}\n\n\tpublic getInjectedText(outputLineIndex: number, outputOffset: number): InjectedText | null {\n\t\tconst offset = this.outputPositionToOffsetInInputWithInjections(outputLineIndex, outputOffset);\n\t\tconst injectedText = this.getInjectedTextAtOffset(offset);\n\t\tif (!injectedText) {\n\t\t\treturn null;\n\t\t}\n\t\treturn {\n\t\t\toptions: this.injectionOptions![injectedText.injectedTextIndex]\n\t\t};\n\t}\n\n\tprivate getInjectedTextAtOffset(offsetInInputWithInjections: number): { injectedTextIndex: number; offsetInInputWithInjections: number; length: number } | undefined {\n\t\tconst injectionOffsets = this.injectionOffsets;\n\t\tconst injectionOptions = this.injectionOptions;\n\n\t\tif (injectionOffsets !== null) {\n\t\t\tlet totalInjectedTextLengthBefore = 0;\n\t\t\tfor (let i = 0; i < injectionOffsets.length; i++) {\n\t\t\t\tconst length = injectionOptions![i].content.length;\n\t\t\t\tconst injectedTextStartOffsetInInputWithInjections = injectionOffsets[i] + totalInjectedTextLengthBefore;\n\t\t\t\tconst injectedTextEndOffsetInInputWithInjections = injectionOffsets[i] + totalInjectedTextLengthBefore + length;\n\n\t\t\t\tif (injectedTextStartOffsetInInputWithInjections > offsetInInputWithInjections) {\n\t\t\t\t\t// Injected text starts later.\n\t\t\t\t\tbreak; // All later injected texts have an even larger offset.\n\t\t\t\t}\n\n\t\t\t\tif (offsetInInputWithInjections <= injectedTextEndOffsetInInputWithInjections) {\n\t\t\t\t\t// Injected text ends after or with the given position (but also starts with or before it).\n\t\t\t\t\treturn {\n\t\t\t\t\t\tinjectedTextIndex: i,\n\t\t\t\t\t\toffsetInInputWithInjections: injectedTextStartOffsetInInputWithInjections,\n\t\t\t\t\t\tlength\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\ttotalInjectedTextLengthBefore += length;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n}\n\nfunction hasRightCursorStop(cursorStop: InjectedTextCursorStops | null | undefined): boolean {\n\tif (cursorStop === null || cursorStop === undefined) { return true; }\n\treturn cursorStop === InjectedTextCursorStops.Right || cursorStop === InjectedTextCursorStops.Both;\n}\nfunction hasLeftCursorStop(cursorStop: InjectedTextCursorStops | null | undefined): boolean {\n\tif (cursorStop === null || cursorStop === undefined) { return true; }\n\treturn cursorStop === InjectedTextCursorStops.Left || cursorStop === InjectedTextCursorStops.Both;\n}\n\nexport class InjectedText {\n\tconstructor(public readonly options: InjectedTextOptions) { }\n}\n\nexport class OutputPosition {\n\toutputLineIndex: number;\n\toutputOffset: number;\n\n\tconstructor(outputLineIndex: number, outputOffset: number) {\n\t\tthis.outputLineIndex = outputLineIndex;\n\t\tthis.outputOffset = outputOffset;\n\t}\n\n\ttoString(): string {\n\t\treturn `${this.outputLineIndex}:${this.outputOffset}`;\n\t}\n\n\ttoPosition(baseLineNumber: number): Position {\n\t\treturn new Position(baseLineNumber + this.outputLineIndex, this.outputOffset + 1);\n\t}\n}\n\nexport interface ILineBreaksComputerFactory {\n\tcreateLineBreaksComputer(fontInfo: FontInfo, tabSize: number, wrappingColumn: number, wrappingIndent: WrappingIndent, wordBreak: 'normal' | 'keepAll'): ILineBreaksComputer;\n}\n\nexport interface ILineBreaksComputer {\n\t/**\n\t * Pass in `previousLineBreakData` if the only difference is in breaking columns!!!\n\t */\n\taddRequest(lineText: string, injectedText: LineInjectedText[] | null, previousLineBreakData: ModelLineProjectionData | null): void;\n\tfinalize(): (ModelLineProjectionData | null)[];\n}\n"]}