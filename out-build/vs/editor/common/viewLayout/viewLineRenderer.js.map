{"version":3,"sources":["vs/editor/common/viewLayout/viewLineRenderer.ts"],"names":[],"mappings":"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","file":"viewLineRenderer.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport { CharCode } from 'vs/base/common/charCode';\nimport * as strings from 'vs/base/common/strings';\nimport { IViewLineTokens } from 'vs/editor/common/tokens/lineTokens';\nimport { StringBuilder } from 'vs/editor/common/core/stringBuilder';\nimport { LineDecoration, LineDecorationsNormalizer } from 'vs/editor/common/viewLayout/lineDecorations';\nimport { InlineDecorationType } from 'vs/editor/common/viewModel';\nimport { LinePart, LinePartMetadata } from 'vs/editor/common/viewLayout/linePart';\n\nexport const enum RenderWhitespace {\n\tNone = 0,\n\tBoundary = 1,\n\tSelection = 2,\n\tTrailing = 3,\n\tAll = 4\n}\n\nexport class LineRange {\n\t/**\n\t * Zero-based offset on which the range starts, inclusive.\n\t */\n\tpublic readonly startOffset: number;\n\n\t/**\n\t * Zero-based offset on which the range ends, inclusive.\n\t */\n\tpublic readonly endOffset: number;\n\n\tconstructor(startIndex: number, endIndex: number) {\n\t\tthis.startOffset = startIndex;\n\t\tthis.endOffset = endIndex;\n\t}\n\n\tpublic equals(otherLineRange: LineRange) {\n\t\treturn this.startOffset === otherLineRange.startOffset\n\t\t\t&& this.endOffset === otherLineRange.endOffset;\n\t}\n}\n\nexport class RenderLineInput {\n\n\tpublic readonly useMonospaceOptimizations: boolean;\n\tpublic readonly canUseHalfwidthRightwardsArrow: boolean;\n\tpublic readonly lineContent: string;\n\tpublic readonly continuesWithWrappedLine: boolean;\n\tpublic readonly isBasicASCII: boolean;\n\tpublic readonly containsRTL: boolean;\n\tpublic readonly fauxIndentLength: number;\n\tpublic readonly lineTokens: IViewLineTokens;\n\tpublic readonly lineDecorations: LineDecoration[];\n\tpublic readonly tabSize: number;\n\tpublic readonly startVisibleColumn: number;\n\tpublic readonly spaceWidth: number;\n\tpublic readonly renderSpaceWidth: number;\n\tpublic readonly renderSpaceCharCode: number;\n\tpublic readonly stopRenderingLineAfter: number;\n\tpublic readonly renderWhitespace: RenderWhitespace;\n\tpublic readonly renderControlCharacters: boolean;\n\tpublic readonly fontLigatures: boolean;\n\n\t/**\n\t * Defined only when renderWhitespace is 'selection'. Selections are non-overlapping,\n\t * and ordered by position within the line.\n\t */\n\tpublic readonly selectionsOnLine: LineRange[] | null;\n\n\tconstructor(\n\t\tuseMonospaceOptimizations: boolean,\n\t\tcanUseHalfwidthRightwardsArrow: boolean,\n\t\tlineContent: string,\n\t\tcontinuesWithWrappedLine: boolean,\n\t\tisBasicASCII: boolean,\n\t\tcontainsRTL: boolean,\n\t\tfauxIndentLength: number,\n\t\tlineTokens: IViewLineTokens,\n\t\tlineDecorations: LineDecoration[],\n\t\ttabSize: number,\n\t\tstartVisibleColumn: number,\n\t\tspaceWidth: number,\n\t\tmiddotWidth: number,\n\t\twsmiddotWidth: number,\n\t\tstopRenderingLineAfter: number,\n\t\trenderWhitespace: 'none' | 'boundary' | 'selection' | 'trailing' | 'all',\n\t\trenderControlCharacters: boolean,\n\t\tfontLigatures: boolean,\n\t\tselectionsOnLine: LineRange[] | null\n\t) {\n\t\tthis.useMonospaceOptimizations = useMonospaceOptimizations;\n\t\tthis.canUseHalfwidthRightwardsArrow = canUseHalfwidthRightwardsArrow;\n\t\tthis.lineContent = lineContent;\n\t\tthis.continuesWithWrappedLine = continuesWithWrappedLine;\n\t\tthis.isBasicASCII = isBasicASCII;\n\t\tthis.containsRTL = containsRTL;\n\t\tthis.fauxIndentLength = fauxIndentLength;\n\t\tthis.lineTokens = lineTokens;\n\t\tthis.lineDecorations = lineDecorations.sort(LineDecoration.compare);\n\t\tthis.tabSize = tabSize;\n\t\tthis.startVisibleColumn = startVisibleColumn;\n\t\tthis.spaceWidth = spaceWidth;\n\t\tthis.stopRenderingLineAfter = stopRenderingLineAfter;\n\t\tthis.renderWhitespace = (\n\t\t\trenderWhitespace === 'all'\n\t\t\t\t? RenderWhitespace.All\n\t\t\t\t: renderWhitespace === 'boundary'\n\t\t\t\t\t? RenderWhitespace.Boundary\n\t\t\t\t\t: renderWhitespace === 'selection'\n\t\t\t\t\t\t? RenderWhitespace.Selection\n\t\t\t\t\t\t: renderWhitespace === 'trailing'\n\t\t\t\t\t\t\t? RenderWhitespace.Trailing\n\t\t\t\t\t\t\t: RenderWhitespace.None\n\t\t);\n\t\tthis.renderControlCharacters = renderControlCharacters;\n\t\tthis.fontLigatures = fontLigatures;\n\t\tthis.selectionsOnLine = selectionsOnLine && selectionsOnLine.sort((a, b) => a.startOffset < b.startOffset ? -1 : 1);\n\n\t\tconst wsmiddotDiff = Math.abs(wsmiddotWidth - spaceWidth);\n\t\tconst middotDiff = Math.abs(middotWidth - spaceWidth);\n\t\tif (wsmiddotDiff < middotDiff) {\n\t\t\tthis.renderSpaceWidth = wsmiddotWidth;\n\t\t\tthis.renderSpaceCharCode = 0x2E31; // U+2E31 - WORD SEPARATOR MIDDLE DOT\n\t\t} else {\n\t\t\tthis.renderSpaceWidth = middotWidth;\n\t\t\tthis.renderSpaceCharCode = 0xB7; // U+00B7 - MIDDLE DOT\n\t\t}\n\t}\n\n\tprivate sameSelection(otherSelections: LineRange[] | null): boolean {\n\t\tif (this.selectionsOnLine === null) {\n\t\t\treturn otherSelections === null;\n\t\t}\n\n\t\tif (otherSelections === null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (otherSelections.length !== this.selectionsOnLine.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (let i = 0; i < this.selectionsOnLine.length; i++) {\n\t\t\tif (!this.selectionsOnLine[i].equals(otherSelections[i])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tpublic equals(other: RenderLineInput): boolean {\n\t\treturn (\n\t\t\tthis.useMonospaceOptimizations === other.useMonospaceOptimizations\n\t\t\t&& this.canUseHalfwidthRightwardsArrow === other.canUseHalfwidthRightwardsArrow\n\t\t\t&& this.lineContent === other.lineContent\n\t\t\t&& this.continuesWithWrappedLine === other.continuesWithWrappedLine\n\t\t\t&& this.isBasicASCII === other.isBasicASCII\n\t\t\t&& this.containsRTL === other.containsRTL\n\t\t\t&& this.fauxIndentLength === other.fauxIndentLength\n\t\t\t&& this.tabSize === other.tabSize\n\t\t\t&& this.startVisibleColumn === other.startVisibleColumn\n\t\t\t&& this.spaceWidth === other.spaceWidth\n\t\t\t&& this.renderSpaceWidth === other.renderSpaceWidth\n\t\t\t&& this.renderSpaceCharCode === other.renderSpaceCharCode\n\t\t\t&& this.stopRenderingLineAfter === other.stopRenderingLineAfter\n\t\t\t&& this.renderWhitespace === other.renderWhitespace\n\t\t\t&& this.renderControlCharacters === other.renderControlCharacters\n\t\t\t&& this.fontLigatures === other.fontLigatures\n\t\t\t&& LineDecoration.equalsArr(this.lineDecorations, other.lineDecorations)\n\t\t\t&& this.lineTokens.equals(other.lineTokens)\n\t\t\t&& this.sameSelection(other.selectionsOnLine)\n\t\t);\n\t}\n}\n\nconst enum CharacterMappingConstants {\n\tPART_INDEX_MASK = 0b11111111111111110000000000000000,\n\tCHAR_INDEX_MASK = 0b00000000000000001111111111111111,\n\n\tCHAR_INDEX_OFFSET = 0,\n\tPART_INDEX_OFFSET = 16\n}\n\nexport class DomPosition {\n\tconstructor(\n\t\tpublic readonly partIndex: number,\n\t\tpublic readonly charIndex: number\n\t) { }\n}\n\n/**\n * Provides a both direction mapping between a line's character and its rendered position.\n */\nexport class CharacterMapping {\n\n\tprivate static getPartIndex(partData: number): number {\n\t\treturn (partData & CharacterMappingConstants.PART_INDEX_MASK) >>> CharacterMappingConstants.PART_INDEX_OFFSET;\n\t}\n\n\tprivate static getCharIndex(partData: number): number {\n\t\treturn (partData & CharacterMappingConstants.CHAR_INDEX_MASK) >>> CharacterMappingConstants.CHAR_INDEX_OFFSET;\n\t}\n\n\tpublic readonly length: number;\n\tprivate readonly _data: Uint32Array;\n\tprivate readonly _horizontalOffset: Uint32Array;\n\n\tconstructor(length: number, partCount: number) {\n\t\tthis.length = length;\n\t\tthis._data = new Uint32Array(this.length);\n\t\tthis._horizontalOffset = new Uint32Array(this.length);\n\t}\n\n\tpublic setColumnInfo(column: number, partIndex: number, charIndex: number, horizontalOffset: number): void {\n\t\tconst partData = (\n\t\t\t(partIndex << CharacterMappingConstants.PART_INDEX_OFFSET)\n\t\t\t| (charIndex << CharacterMappingConstants.CHAR_INDEX_OFFSET)\n\t\t) >>> 0;\n\t\tthis._data[column - 1] = partData;\n\t\tthis._horizontalOffset[column - 1] = horizontalOffset;\n\t}\n\n\tpublic getHorizontalOffset(column: number): number {\n\t\tif (this._horizontalOffset.length === 0) {\n\t\t\t// No characters on this line\n\t\t\treturn 0;\n\t\t}\n\t\treturn this._horizontalOffset[column - 1];\n\t}\n\n\tprivate charOffsetToPartData(charOffset: number): number {\n\t\tif (this.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\t\tif (charOffset < 0) {\n\t\t\treturn this._data[0];\n\t\t}\n\t\tif (charOffset >= this.length) {\n\t\t\treturn this._data[this.length - 1];\n\t\t}\n\t\treturn this._data[charOffset];\n\t}\n\n\tpublic getDomPosition(column: number): DomPosition {\n\t\tconst partData = this.charOffsetToPartData(column - 1);\n\t\tconst partIndex = CharacterMapping.getPartIndex(partData);\n\t\tconst charIndex = CharacterMapping.getCharIndex(partData);\n\t\treturn new DomPosition(partIndex, charIndex);\n\t}\n\n\tpublic getColumn(domPosition: DomPosition, partLength: number): number {\n\t\tconst charOffset = this.partDataToCharOffset(domPosition.partIndex, partLength, domPosition.charIndex);\n\t\treturn charOffset + 1;\n\t}\n\n\tprivate partDataToCharOffset(partIndex: number, partLength: number, charIndex: number): number {\n\t\tif (this.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst searchEntry = (\n\t\t\t(partIndex << CharacterMappingConstants.PART_INDEX_OFFSET)\n\t\t\t| (charIndex << CharacterMappingConstants.CHAR_INDEX_OFFSET)\n\t\t) >>> 0;\n\n\t\tlet min = 0;\n\t\tlet max = this.length - 1;\n\t\twhile (min + 1 < max) {\n\t\t\tconst mid = ((min + max) >>> 1);\n\t\t\tconst midEntry = this._data[mid];\n\t\t\tif (midEntry === searchEntry) {\n\t\t\t\treturn mid;\n\t\t\t} else if (midEntry > searchEntry) {\n\t\t\t\tmax = mid;\n\t\t\t} else {\n\t\t\t\tmin = mid;\n\t\t\t}\n\t\t}\n\n\t\tif (min === max) {\n\t\t\treturn min;\n\t\t}\n\n\t\tconst minEntry = this._data[min];\n\t\tconst maxEntry = this._data[max];\n\n\t\tif (minEntry === searchEntry) {\n\t\t\treturn min;\n\t\t}\n\t\tif (maxEntry === searchEntry) {\n\t\t\treturn max;\n\t\t}\n\n\t\tconst minPartIndex = CharacterMapping.getPartIndex(minEntry);\n\t\tconst minCharIndex = CharacterMapping.getCharIndex(minEntry);\n\n\t\tconst maxPartIndex = CharacterMapping.getPartIndex(maxEntry);\n\t\tlet maxCharIndex: number;\n\n\t\tif (minPartIndex !== maxPartIndex) {\n\t\t\t// sitting between parts\n\t\t\tmaxCharIndex = partLength;\n\t\t} else {\n\t\t\tmaxCharIndex = CharacterMapping.getCharIndex(maxEntry);\n\t\t}\n\n\t\tconst minEntryDistance = charIndex - minCharIndex;\n\t\tconst maxEntryDistance = maxCharIndex - charIndex;\n\n\t\tif (minEntryDistance <= maxEntryDistance) {\n\t\t\treturn min;\n\t\t}\n\t\treturn max;\n\t}\n\n\tpublic inflate() {\n\t\tconst result: [number, number, number][] = [];\n\t\tfor (let i = 0; i < this.length; i++) {\n\t\t\tconst partData = this._data[i];\n\t\t\tconst partIndex = CharacterMapping.getPartIndex(partData);\n\t\t\tconst charIndex = CharacterMapping.getCharIndex(partData);\n\t\t\tconst visibleColumn = this._horizontalOffset[i];\n\t\t\tresult.push([partIndex, charIndex, visibleColumn]);\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport const enum ForeignElementType {\n\tNone = 0,\n\tBefore = 1,\n\tAfter = 2\n}\n\nexport class RenderLineOutput {\n\t_renderLineOutputBrand: void = undefined;\n\n\treadonly characterMapping: CharacterMapping;\n\treadonly containsRTL: boolean;\n\treadonly containsForeignElements: ForeignElementType;\n\n\tconstructor(characterMapping: CharacterMapping, containsRTL: boolean, containsForeignElements: ForeignElementType) {\n\t\tthis.characterMapping = characterMapping;\n\t\tthis.containsRTL = containsRTL;\n\t\tthis.containsForeignElements = containsForeignElements;\n\t}\n}\n\nexport function renderViewLine(input: RenderLineInput, sb: StringBuilder): RenderLineOutput {\n\tif (input.lineContent.length === 0) {\n\n\t\tif (input.lineDecorations.length > 0) {\n\t\t\t// This line is empty, but it contains inline decorations\n\t\t\tsb.appendString(`<span>`);\n\n\t\t\tlet beforeCount = 0;\n\t\t\tlet afterCount = 0;\n\t\t\tlet containsForeignElements = ForeignElementType.None;\n\t\t\tfor (const lineDecoration of input.lineDecorations) {\n\t\t\t\tif (lineDecoration.type === InlineDecorationType.Before || lineDecoration.type === InlineDecorationType.After) {\n\t\t\t\t\tsb.appendString(`<span class=\"`);\n\t\t\t\t\tsb.appendString(lineDecoration.className);\n\t\t\t\t\tsb.appendString(`\"></span>`);\n\n\t\t\t\t\tif (lineDecoration.type === InlineDecorationType.Before) {\n\t\t\t\t\t\tcontainsForeignElements |= ForeignElementType.Before;\n\t\t\t\t\t\tbeforeCount++;\n\t\t\t\t\t}\n\t\t\t\t\tif (lineDecoration.type === InlineDecorationType.After) {\n\t\t\t\t\t\tcontainsForeignElements |= ForeignElementType.After;\n\t\t\t\t\t\tafterCount++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsb.appendString(`</span>`);\n\n\t\t\tconst characterMapping = new CharacterMapping(1, beforeCount + afterCount);\n\t\t\tcharacterMapping.setColumnInfo(1, beforeCount, 0, 0);\n\n\t\t\treturn new RenderLineOutput(\n\t\t\t\tcharacterMapping,\n\t\t\t\tfalse,\n\t\t\t\tcontainsForeignElements\n\t\t\t);\n\t\t}\n\n\t\t// completely empty line\n\t\tsb.appendString('<span><span></span></span>');\n\t\treturn new RenderLineOutput(\n\t\t\tnew CharacterMapping(0, 0),\n\t\t\tfalse,\n\t\t\tForeignElementType.None\n\t\t);\n\t}\n\n\treturn _renderLine(resolveRenderLineInput(input), sb);\n}\n\nexport class RenderLineOutput2 {\n\tconstructor(\n\t\tpublic readonly characterMapping: CharacterMapping,\n\t\tpublic readonly html: string,\n\t\tpublic readonly containsRTL: boolean,\n\t\tpublic readonly containsForeignElements: ForeignElementType\n\t) {\n\t}\n}\n\nexport function renderViewLine2(input: RenderLineInput): RenderLineOutput2 {\n\tconst sb = new StringBuilder(10000);\n\tconst out = renderViewLine(input, sb);\n\treturn new RenderLineOutput2(out.characterMapping, sb.build(), out.containsRTL, out.containsForeignElements);\n}\n\nclass ResolvedRenderLineInput {\n\tconstructor(\n\t\tpublic readonly fontIsMonospace: boolean,\n\t\tpublic readonly canUseHalfwidthRightwardsArrow: boolean,\n\t\tpublic readonly lineContent: string,\n\t\tpublic readonly len: number,\n\t\tpublic readonly isOverflowing: boolean,\n\t\tpublic readonly overflowingCharCount: number,\n\t\tpublic readonly parts: LinePart[],\n\t\tpublic readonly containsForeignElements: ForeignElementType,\n\t\tpublic readonly fauxIndentLength: number,\n\t\tpublic readonly tabSize: number,\n\t\tpublic readonly startVisibleColumn: number,\n\t\tpublic readonly containsRTL: boolean,\n\t\tpublic readonly spaceWidth: number,\n\t\tpublic readonly renderSpaceCharCode: number,\n\t\tpublic readonly renderWhitespace: RenderWhitespace,\n\t\tpublic readonly renderControlCharacters: boolean,\n\t) {\n\t\t//\n\t}\n}\n\nfunction resolveRenderLineInput(input: RenderLineInput): ResolvedRenderLineInput {\n\tconst lineContent = input.lineContent;\n\n\tlet isOverflowing: boolean;\n\tlet overflowingCharCount: number;\n\tlet len: number;\n\n\tif (input.stopRenderingLineAfter !== -1 && input.stopRenderingLineAfter < lineContent.length) {\n\t\tisOverflowing = true;\n\t\toverflowingCharCount = lineContent.length - input.stopRenderingLineAfter;\n\t\tlen = input.stopRenderingLineAfter;\n\t} else {\n\t\tisOverflowing = false;\n\t\toverflowingCharCount = 0;\n\t\tlen = lineContent.length;\n\t}\n\n\tlet tokens = transformAndRemoveOverflowing(lineContent, input.containsRTL, input.lineTokens, input.fauxIndentLength, len);\n\tif (input.renderControlCharacters && !input.isBasicASCII) {\n\t\t// Calling `extractControlCharacters` before adding (possibly empty) line parts\n\t\t// for inline decorations. `extractControlCharacters` removes empty line parts.\n\t\ttokens = extractControlCharacters(lineContent, tokens);\n\t}\n\tif (input.renderWhitespace === RenderWhitespace.All ||\n\t\tinput.renderWhitespace === RenderWhitespace.Boundary ||\n\t\t(input.renderWhitespace === RenderWhitespace.Selection && !!input.selectionsOnLine) ||\n\t\t(input.renderWhitespace === RenderWhitespace.Trailing && !input.continuesWithWrappedLine)\n\t) {\n\t\ttokens = _applyRenderWhitespace(input, lineContent, len, tokens);\n\t}\n\tlet containsForeignElements = ForeignElementType.None;\n\tif (input.lineDecorations.length > 0) {\n\t\tfor (let i = 0, len = input.lineDecorations.length; i < len; i++) {\n\t\t\tconst lineDecoration = input.lineDecorations[i];\n\t\t\tif (lineDecoration.type === InlineDecorationType.RegularAffectingLetterSpacing) {\n\t\t\t\t// Pretend there are foreign elements... although not 100% accurate.\n\t\t\t\tcontainsForeignElements |= ForeignElementType.Before;\n\t\t\t} else if (lineDecoration.type === InlineDecorationType.Before) {\n\t\t\t\tcontainsForeignElements |= ForeignElementType.Before;\n\t\t\t} else if (lineDecoration.type === InlineDecorationType.After) {\n\t\t\t\tcontainsForeignElements |= ForeignElementType.After;\n\t\t\t}\n\t\t}\n\t\ttokens = _applyInlineDecorations(lineContent, len, tokens, input.lineDecorations);\n\t}\n\tif (!input.containsRTL) {\n\t\t// We can never split RTL text, as it ruins the rendering\n\t\ttokens = splitLargeTokens(lineContent, tokens, !input.isBasicASCII || input.fontLigatures);\n\t}\n\n\treturn new ResolvedRenderLineInput(\n\t\tinput.useMonospaceOptimizations,\n\t\tinput.canUseHalfwidthRightwardsArrow,\n\t\tlineContent,\n\t\tlen,\n\t\tisOverflowing,\n\t\toverflowingCharCount,\n\t\ttokens,\n\t\tcontainsForeignElements,\n\t\tinput.fauxIndentLength,\n\t\tinput.tabSize,\n\t\tinput.startVisibleColumn,\n\t\tinput.containsRTL,\n\t\tinput.spaceWidth,\n\t\tinput.renderSpaceCharCode,\n\t\tinput.renderWhitespace,\n\t\tinput.renderControlCharacters\n\t);\n}\n\n/**\n * In the rendering phase, characters are always looped until token.endIndex.\n * Ensure that all tokens end before `len` and the last one ends precisely at `len`.\n */\nfunction transformAndRemoveOverflowing(lineContent: string, lineContainsRTL: boolean, tokens: IViewLineTokens, fauxIndentLength: number, len: number): LinePart[] {\n\tconst result: LinePart[] = [];\n\tlet resultLen = 0;\n\n\t// The faux indent part of the line should have no token type\n\tif (fauxIndentLength > 0) {\n\t\tresult[resultLen++] = new LinePart(fauxIndentLength, '', 0, false);\n\t}\n\tlet startOffset = fauxIndentLength;\n\tfor (let tokenIndex = 0, tokensLen = tokens.getCount(); tokenIndex < tokensLen; tokenIndex++) {\n\t\tconst endIndex = tokens.getEndOffset(tokenIndex);\n\t\tif (endIndex <= fauxIndentLength) {\n\t\t\t// The faux indent part of the line should have no token type\n\t\t\tcontinue;\n\t\t}\n\t\tconst type = tokens.getClassName(tokenIndex);\n\t\tif (endIndex >= len) {\n\t\t\tconst tokenContainsRTL = (lineContainsRTL ? strings.containsRTL(lineContent.substring(startOffset, len)) : false);\n\t\t\tresult[resultLen++] = new LinePart(len, type, 0, tokenContainsRTL);\n\t\t\tbreak;\n\t\t}\n\t\tconst tokenContainsRTL = (lineContainsRTL ? strings.containsRTL(lineContent.substring(startOffset, endIndex)) : false);\n\t\tresult[resultLen++] = new LinePart(endIndex, type, 0, tokenContainsRTL);\n\t\tstartOffset = endIndex;\n\t}\n\n\treturn result;\n}\n\n/**\n * written as a const enum to get value inlining.\n */\nconst enum Constants {\n\tLongToken = 50\n}\n\n/**\n * See https://github.com/microsoft/vscode/issues/6885.\n * It appears that having very large spans causes very slow reading of character positions.\n * So here we try to avoid that.\n */\nfunction splitLargeTokens(lineContent: string, tokens: LinePart[], onlyAtSpaces: boolean): LinePart[] {\n\tlet lastTokenEndIndex = 0;\n\tconst result: LinePart[] = [];\n\tlet resultLen = 0;\n\n\tif (onlyAtSpaces) {\n\t\t// Split only at spaces => we need to walk each character\n\t\tfor (let i = 0, len = tokens.length; i < len; i++) {\n\t\t\tconst token = tokens[i];\n\t\t\tconst tokenEndIndex = token.endIndex;\n\t\t\tif (lastTokenEndIndex + Constants.LongToken < tokenEndIndex) {\n\t\t\t\tconst tokenType = token.type;\n\t\t\t\tconst tokenMetadata = token.metadata;\n\t\t\t\tconst tokenContainsRTL = token.containsRTL;\n\n\t\t\t\tlet lastSpaceOffset = -1;\n\t\t\t\tlet currTokenStart = lastTokenEndIndex;\n\t\t\t\tfor (let j = lastTokenEndIndex; j < tokenEndIndex; j++) {\n\t\t\t\t\tif (lineContent.charCodeAt(j) === CharCode.Space) {\n\t\t\t\t\t\tlastSpaceOffset = j;\n\t\t\t\t\t}\n\t\t\t\t\tif (lastSpaceOffset !== -1 && j - currTokenStart >= Constants.LongToken) {\n\t\t\t\t\t\t// Split at `lastSpaceOffset` + 1\n\t\t\t\t\t\tresult[resultLen++] = new LinePart(lastSpaceOffset + 1, tokenType, tokenMetadata, tokenContainsRTL);\n\t\t\t\t\t\tcurrTokenStart = lastSpaceOffset + 1;\n\t\t\t\t\t\tlastSpaceOffset = -1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (currTokenStart !== tokenEndIndex) {\n\t\t\t\t\tresult[resultLen++] = new LinePart(tokenEndIndex, tokenType, tokenMetadata, tokenContainsRTL);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresult[resultLen++] = token;\n\t\t\t}\n\n\t\t\tlastTokenEndIndex = tokenEndIndex;\n\t\t}\n\t} else {\n\t\t// Split anywhere => we don't need to walk each character\n\t\tfor (let i = 0, len = tokens.length; i < len; i++) {\n\t\t\tconst token = tokens[i];\n\t\t\tconst tokenEndIndex = token.endIndex;\n\t\t\tconst diff = (tokenEndIndex - lastTokenEndIndex);\n\t\t\tif (diff > Constants.LongToken) {\n\t\t\t\tconst tokenType = token.type;\n\t\t\t\tconst tokenMetadata = token.metadata;\n\t\t\t\tconst tokenContainsRTL = token.containsRTL;\n\t\t\t\tconst piecesCount = Math.ceil(diff / Constants.LongToken);\n\t\t\t\tfor (let j = 1; j < piecesCount; j++) {\n\t\t\t\t\tconst pieceEndIndex = lastTokenEndIndex + (j * Constants.LongToken);\n\t\t\t\t\tresult[resultLen++] = new LinePart(pieceEndIndex, tokenType, tokenMetadata, tokenContainsRTL);\n\t\t\t\t}\n\t\t\t\tresult[resultLen++] = new LinePart(tokenEndIndex, tokenType, tokenMetadata, tokenContainsRTL);\n\t\t\t} else {\n\t\t\t\tresult[resultLen++] = token;\n\t\t\t}\n\t\t\tlastTokenEndIndex = tokenEndIndex;\n\t\t}\n\t}\n\n\treturn result;\n}\n\nfunction isControlCharacter(charCode: number): boolean {\n\tif (charCode < 32) {\n\t\treturn (charCode !== CharCode.Tab);\n\t}\n\tif (charCode === 127) {\n\t\t// DEL\n\t\treturn true;\n\t}\n\n\tif (\n\t\t(charCode >= 0x202A && charCode <= 0x202E)\n\t\t|| (charCode >= 0x2066 && charCode <= 0x2069)\n\t\t|| (charCode >= 0x200E && charCode <= 0x200F)\n\t\t|| charCode === 0x061C\n\t) {\n\t\t// Unicode Directional Formatting Characters\n\t\t// LRE\tU+202A\tLEFT-TO-RIGHT EMBEDDING\n\t\t// RLE\tU+202B\tRIGHT-TO-LEFT EMBEDDING\n\t\t// PDF\tU+202C\tPOP DIRECTIONAL FORMATTING\n\t\t// LRO\tU+202D\tLEFT-TO-RIGHT OVERRIDE\n\t\t// RLO\tU+202E\tRIGHT-TO-LEFT OVERRIDE\n\t\t// LRI\tU+2066\tLEFT-TO-RIGHT ISOLATE\n\t\t// RLI\tU+2067\tRIGHT-TO-LEFT ISOLATE\n\t\t// FSI\tU+2068\tFIRST STRONG ISOLATE\n\t\t// PDI\tU+2069\tPOP DIRECTIONAL ISOLATE\n\t\t// LRM\tU+200E\tLEFT-TO-RIGHT MARK\n\t\t// RLM\tU+200F\tRIGHT-TO-LEFT MARK\n\t\t// ALM\tU+061C\tARABIC LETTER MARK\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nfunction extractControlCharacters(lineContent: string, tokens: LinePart[]): LinePart[] {\n\tconst result: LinePart[] = [];\n\tlet lastLinePart: LinePart = new LinePart(0, '', 0, false);\n\tlet charOffset = 0;\n\tfor (const token of tokens) {\n\t\tconst tokenEndIndex = token.endIndex;\n\t\tfor (; charOffset < tokenEndIndex; charOffset++) {\n\t\t\tconst charCode = lineContent.charCodeAt(charOffset);\n\t\t\tif (isControlCharacter(charCode)) {\n\t\t\t\tif (charOffset > lastLinePart.endIndex) {\n\t\t\t\t\t// emit previous part if it has text\n\t\t\t\t\tlastLinePart = new LinePart(charOffset, token.type, token.metadata, token.containsRTL);\n\t\t\t\t\tresult.push(lastLinePart);\n\t\t\t\t}\n\t\t\t\tlastLinePart = new LinePart(charOffset + 1, 'mtkcontrol', token.metadata, false);\n\t\t\t\tresult.push(lastLinePart);\n\t\t\t}\n\t\t}\n\t\tif (charOffset > lastLinePart.endIndex) {\n\t\t\t// emit previous part if it has text\n\t\t\tlastLinePart = new LinePart(tokenEndIndex, token.type, token.metadata, token.containsRTL);\n\t\t\tresult.push(lastLinePart);\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * Whitespace is rendered by \"replacing\" tokens with a special-purpose `mtkw` type that is later recognized in the rendering phase.\n * Moreover, a token is created for every visual indent because on some fonts the glyphs used for rendering whitespace (&rarr; or &middot;) do not have the same width as &nbsp;.\n * The rendering phase will generate `style=\"width:...\"` for these tokens.\n */\nfunction _applyRenderWhitespace(input: RenderLineInput, lineContent: string, len: number, tokens: LinePart[]): LinePart[] {\n\n\tconst continuesWithWrappedLine = input.continuesWithWrappedLine;\n\tconst fauxIndentLength = input.fauxIndentLength;\n\tconst tabSize = input.tabSize;\n\tconst startVisibleColumn = input.startVisibleColumn;\n\tconst useMonospaceOptimizations = input.useMonospaceOptimizations;\n\tconst selections = input.selectionsOnLine;\n\tconst onlyBoundary = (input.renderWhitespace === RenderWhitespace.Boundary);\n\tconst onlyTrailing = (input.renderWhitespace === RenderWhitespace.Trailing);\n\tconst generateLinePartForEachWhitespace = (input.renderSpaceWidth !== input.spaceWidth);\n\n\tconst result: LinePart[] = [];\n\tlet resultLen = 0;\n\tlet tokenIndex = 0;\n\tlet tokenType = tokens[tokenIndex].type;\n\tlet tokenContainsRTL = tokens[tokenIndex].containsRTL;\n\tlet tokenEndIndex = tokens[tokenIndex].endIndex;\n\tconst tokensLength = tokens.length;\n\n\tlet lineIsEmptyOrWhitespace = false;\n\tlet firstNonWhitespaceIndex = strings.firstNonWhitespaceIndex(lineContent);\n\tlet lastNonWhitespaceIndex: number;\n\tif (firstNonWhitespaceIndex === -1) {\n\t\tlineIsEmptyOrWhitespace = true;\n\t\tfirstNonWhitespaceIndex = len;\n\t\tlastNonWhitespaceIndex = len;\n\t} else {\n\t\tlastNonWhitespaceIndex = strings.lastNonWhitespaceIndex(lineContent);\n\t}\n\n\tlet wasInWhitespace = false;\n\tlet currentSelectionIndex = 0;\n\tlet currentSelection = selections && selections[currentSelectionIndex];\n\tlet tmpIndent = startVisibleColumn % tabSize;\n\tfor (let charIndex = fauxIndentLength; charIndex < len; charIndex++) {\n\t\tconst chCode = lineContent.charCodeAt(charIndex);\n\n\t\tif (currentSelection && charIndex >= currentSelection.endOffset) {\n\t\t\tcurrentSelectionIndex++;\n\t\t\tcurrentSelection = selections && selections[currentSelectionIndex];\n\t\t}\n\n\t\tlet isInWhitespace: boolean;\n\t\tif (charIndex < firstNonWhitespaceIndex || charIndex > lastNonWhitespaceIndex) {\n\t\t\t// in leading or trailing whitespace\n\t\t\tisInWhitespace = true;\n\t\t} else if (chCode === CharCode.Tab) {\n\t\t\t// a tab character is rendered both in all and boundary cases\n\t\t\tisInWhitespace = true;\n\t\t} else if (chCode === CharCode.Space) {\n\t\t\t// hit a space character\n\t\t\tif (onlyBoundary) {\n\t\t\t\t// rendering only boundary whitespace\n\t\t\t\tif (wasInWhitespace) {\n\t\t\t\t\tisInWhitespace = true;\n\t\t\t\t} else {\n\t\t\t\t\tconst nextChCode = (charIndex + 1 < len ? lineContent.charCodeAt(charIndex + 1) : CharCode.Null);\n\t\t\t\t\tisInWhitespace = (nextChCode === CharCode.Space || nextChCode === CharCode.Tab);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tisInWhitespace = true;\n\t\t\t}\n\t\t} else {\n\t\t\tisInWhitespace = false;\n\t\t}\n\n\t\t// If rendering whitespace on selection, check that the charIndex falls within a selection\n\t\tif (isInWhitespace && selections) {\n\t\t\tisInWhitespace = !!currentSelection && currentSelection.startOffset <= charIndex && currentSelection.endOffset > charIndex;\n\t\t}\n\n\t\t// If rendering only trailing whitespace, check that the charIndex points to trailing whitespace.\n\t\tif (isInWhitespace && onlyTrailing) {\n\t\t\tisInWhitespace = lineIsEmptyOrWhitespace || charIndex > lastNonWhitespaceIndex;\n\t\t}\n\n\t\tif (isInWhitespace && tokenContainsRTL) {\n\t\t\t// If the token contains RTL text, breaking it up into multiple line parts\n\t\t\t// to render whitespace might affect the browser's bidi layout.\n\t\t\t//\n\t\t\t// We render whitespace in such tokens only if the whitespace\n\t\t\t// is the leading or the trailing whitespace of the line,\n\t\t\t// which doesn't affect the browser's bidi layout.\n\t\t\tif (charIndex >= firstNonWhitespaceIndex && charIndex <= lastNonWhitespaceIndex) {\n\t\t\t\tisInWhitespace = false;\n\t\t\t}\n\t\t}\n\n\t\tif (wasInWhitespace) {\n\t\t\t// was in whitespace token\n\t\t\tif (!isInWhitespace || (!useMonospaceOptimizations && tmpIndent >= tabSize)) {\n\t\t\t\t// leaving whitespace token or entering a new indent\n\t\t\t\tif (generateLinePartForEachWhitespace) {\n\t\t\t\t\tconst lastEndIndex = (resultLen > 0 ? result[resultLen - 1].endIndex : fauxIndentLength);\n\t\t\t\t\tfor (let i = lastEndIndex + 1; i <= charIndex; i++) {\n\t\t\t\t\t\tresult[resultLen++] = new LinePart(i, 'mtkw', LinePartMetadata.IS_WHITESPACE, false);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresult[resultLen++] = new LinePart(charIndex, 'mtkw', LinePartMetadata.IS_WHITESPACE, false);\n\t\t\t\t}\n\t\t\t\ttmpIndent = tmpIndent % tabSize;\n\t\t\t}\n\t\t} else {\n\t\t\t// was in regular token\n\t\t\tif (charIndex === tokenEndIndex || (isInWhitespace && charIndex > fauxIndentLength)) {\n\t\t\t\tresult[resultLen++] = new LinePart(charIndex, tokenType, 0, tokenContainsRTL);\n\t\t\t\ttmpIndent = tmpIndent % tabSize;\n\t\t\t}\n\t\t}\n\n\t\tif (chCode === CharCode.Tab) {\n\t\t\ttmpIndent = tabSize;\n\t\t} else if (strings.isFullWidthCharacter(chCode)) {\n\t\t\ttmpIndent += 2;\n\t\t} else {\n\t\t\ttmpIndent++;\n\t\t}\n\n\t\twasInWhitespace = isInWhitespace;\n\n\t\twhile (charIndex === tokenEndIndex) {\n\t\t\ttokenIndex++;\n\t\t\tif (tokenIndex < tokensLength) {\n\t\t\t\ttokenType = tokens[tokenIndex].type;\n\t\t\t\ttokenContainsRTL = tokens[tokenIndex].containsRTL;\n\t\t\t\ttokenEndIndex = tokens[tokenIndex].endIndex;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tlet generateWhitespace = false;\n\tif (wasInWhitespace) {\n\t\t// was in whitespace token\n\t\tif (continuesWithWrappedLine && onlyBoundary) {\n\t\t\tconst lastCharCode = (len > 0 ? lineContent.charCodeAt(len - 1) : CharCode.Null);\n\t\t\tconst prevCharCode = (len > 1 ? lineContent.charCodeAt(len - 2) : CharCode.Null);\n\t\t\tconst isSingleTrailingSpace = (lastCharCode === CharCode.Space && (prevCharCode !== CharCode.Space && prevCharCode !== CharCode.Tab));\n\t\t\tif (!isSingleTrailingSpace) {\n\t\t\t\tgenerateWhitespace = true;\n\t\t\t}\n\t\t} else {\n\t\t\tgenerateWhitespace = true;\n\t\t}\n\t}\n\n\tif (generateWhitespace) {\n\t\tif (generateLinePartForEachWhitespace) {\n\t\t\tconst lastEndIndex = (resultLen > 0 ? result[resultLen - 1].endIndex : fauxIndentLength);\n\t\t\tfor (let i = lastEndIndex + 1; i <= len; i++) {\n\t\t\t\tresult[resultLen++] = new LinePart(i, 'mtkw', LinePartMetadata.IS_WHITESPACE, false);\n\t\t\t}\n\t\t} else {\n\t\t\tresult[resultLen++] = new LinePart(len, 'mtkw', LinePartMetadata.IS_WHITESPACE, false);\n\t\t}\n\t} else {\n\t\tresult[resultLen++] = new LinePart(len, tokenType, 0, tokenContainsRTL);\n\t}\n\n\treturn result;\n}\n\n/**\n * Inline decorations are \"merged\" on top of tokens.\n * Special care must be taken when multiple inline decorations are at play and they overlap.\n */\nfunction _applyInlineDecorations(lineContent: string, len: number, tokens: LinePart[], _lineDecorations: LineDecoration[]): LinePart[] {\n\t_lineDecorations.sort(LineDecoration.compare);\n\tconst lineDecorations = LineDecorationsNormalizer.normalize(lineContent, _lineDecorations);\n\tconst lineDecorationsLen = lineDecorations.length;\n\n\tlet lineDecorationIndex = 0;\n\tconst result: LinePart[] = [];\n\tlet resultLen = 0;\n\tlet lastResultEndIndex = 0;\n\tfor (let tokenIndex = 0, len = tokens.length; tokenIndex < len; tokenIndex++) {\n\t\tconst token = tokens[tokenIndex];\n\t\tconst tokenEndIndex = token.endIndex;\n\t\tconst tokenType = token.type;\n\t\tconst tokenMetadata = token.metadata;\n\t\tconst tokenContainsRTL = token.containsRTL;\n\n\t\twhile (lineDecorationIndex < lineDecorationsLen && lineDecorations[lineDecorationIndex].startOffset < tokenEndIndex) {\n\t\t\tconst lineDecoration = lineDecorations[lineDecorationIndex];\n\n\t\t\tif (lineDecoration.startOffset > lastResultEndIndex) {\n\t\t\t\tlastResultEndIndex = lineDecoration.startOffset;\n\t\t\t\tresult[resultLen++] = new LinePart(lastResultEndIndex, tokenType, tokenMetadata, tokenContainsRTL);\n\t\t\t}\n\n\t\t\tif (lineDecoration.endOffset + 1 <= tokenEndIndex) {\n\t\t\t\t// This line decoration ends before this token ends\n\t\t\t\tlastResultEndIndex = lineDecoration.endOffset + 1;\n\t\t\t\tresult[resultLen++] = new LinePart(lastResultEndIndex, tokenType + ' ' + lineDecoration.className, tokenMetadata | lineDecoration.metadata, tokenContainsRTL);\n\t\t\t\tlineDecorationIndex++;\n\t\t\t} else {\n\t\t\t\t// This line decoration continues on to the next token\n\t\t\t\tlastResultEndIndex = tokenEndIndex;\n\t\t\t\tresult[resultLen++] = new LinePart(lastResultEndIndex, tokenType + ' ' + lineDecoration.className, tokenMetadata | lineDecoration.metadata, tokenContainsRTL);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (tokenEndIndex > lastResultEndIndex) {\n\t\t\tlastResultEndIndex = tokenEndIndex;\n\t\t\tresult[resultLen++] = new LinePart(lastResultEndIndex, tokenType, tokenMetadata, tokenContainsRTL);\n\t\t}\n\t}\n\n\tconst lastTokenEndIndex = tokens[tokens.length - 1].endIndex;\n\tif (lineDecorationIndex < lineDecorationsLen && lineDecorations[lineDecorationIndex].startOffset === lastTokenEndIndex) {\n\t\twhile (lineDecorationIndex < lineDecorationsLen && lineDecorations[lineDecorationIndex].startOffset === lastTokenEndIndex) {\n\t\t\tconst lineDecoration = lineDecorations[lineDecorationIndex];\n\t\t\tresult[resultLen++] = new LinePart(lastResultEndIndex, lineDecoration.className, lineDecoration.metadata, false);\n\t\t\tlineDecorationIndex++;\n\t\t}\n\t}\n\n\treturn result;\n}\n\n/**\n * This function is on purpose not split up into multiple functions to allow runtime type inference (i.e. performance reasons).\n * Notice how all the needed data is fully resolved and passed in (i.e. no other calls).\n */\nfunction _renderLine(input: ResolvedRenderLineInput, sb: StringBuilder): RenderLineOutput {\n\tconst fontIsMonospace = input.fontIsMonospace;\n\tconst canUseHalfwidthRightwardsArrow = input.canUseHalfwidthRightwardsArrow;\n\tconst containsForeignElements = input.containsForeignElements;\n\tconst lineContent = input.lineContent;\n\tconst len = input.len;\n\tconst isOverflowing = input.isOverflowing;\n\tconst overflowingCharCount = input.overflowingCharCount;\n\tconst parts = input.parts;\n\tconst fauxIndentLength = input.fauxIndentLength;\n\tconst tabSize = input.tabSize;\n\tconst startVisibleColumn = input.startVisibleColumn;\n\tconst containsRTL = input.containsRTL;\n\tconst spaceWidth = input.spaceWidth;\n\tconst renderSpaceCharCode = input.renderSpaceCharCode;\n\tconst renderWhitespace = input.renderWhitespace;\n\tconst renderControlCharacters = input.renderControlCharacters;\n\n\tconst characterMapping = new CharacterMapping(len + 1, parts.length);\n\tlet lastCharacterMappingDefined = false;\n\n\tlet charIndex = 0;\n\tlet visibleColumn = startVisibleColumn;\n\tlet charOffsetInPart = 0; // the character offset in the current part\n\tlet charHorizontalOffset = 0; // the character horizontal position in terms of chars relative to line start\n\n\tlet partDisplacement = 0;\n\n\tif (containsRTL) {\n\t\tsb.appendString('<span dir=\"ltr\">');\n\t} else {\n\t\tsb.appendString('<span>');\n\t}\n\n\tfor (let partIndex = 0, tokensLen = parts.length; partIndex < tokensLen; partIndex++) {\n\n\t\tconst part = parts[partIndex];\n\t\tconst partEndIndex = part.endIndex;\n\t\tconst partType = part.type;\n\t\tconst partContainsRTL = part.containsRTL;\n\t\tconst partRendersWhitespace = (renderWhitespace !== RenderWhitespace.None && part.isWhitespace());\n\t\tconst partRendersWhitespaceWithWidth = partRendersWhitespace && !fontIsMonospace && (partType === 'mtkw'/*only whitespace*/ || !containsForeignElements);\n\t\tconst partIsEmptyAndHasPseudoAfter = (charIndex === partEndIndex && part.isPseudoAfter());\n\t\tcharOffsetInPart = 0;\n\n\t\tsb.appendString('<span ');\n\t\tif (partContainsRTL) {\n\t\t\tsb.appendString('style=\"unicode-bidi:isolate\" ');\n\t\t}\n\t\tsb.appendString('class=\"');\n\t\tsb.appendString(partRendersWhitespaceWithWidth ? 'mtkz' : partType);\n\t\tsb.appendASCIICharCode(CharCode.DoubleQuote);\n\n\t\tif (partRendersWhitespace) {\n\n\t\t\tlet partWidth = 0;\n\t\t\t{\n\t\t\t\tlet _charIndex = charIndex;\n\t\t\t\tlet _visibleColumn = visibleColumn;\n\n\t\t\t\tfor (; _charIndex < partEndIndex; _charIndex++) {\n\t\t\t\t\tconst charCode = lineContent.charCodeAt(_charIndex);\n\t\t\t\t\tconst charWidth = (charCode === CharCode.Tab ? (tabSize - (_visibleColumn % tabSize)) : 1) | 0;\n\t\t\t\t\tpartWidth += charWidth;\n\t\t\t\t\tif (_charIndex >= fauxIndentLength) {\n\t\t\t\t\t\t_visibleColumn += charWidth;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (partRendersWhitespaceWithWidth) {\n\t\t\t\tsb.appendString(' style=\"width:');\n\t\t\t\tsb.appendString(String(spaceWidth * partWidth));\n\t\t\t\tsb.appendString('px\"');\n\t\t\t}\n\t\t\tsb.appendASCIICharCode(CharCode.GreaterThan);\n\n\t\t\tfor (; charIndex < partEndIndex; charIndex++) {\n\t\t\t\tcharacterMapping.setColumnInfo(charIndex + 1, partIndex - partDisplacement, charOffsetInPart, charHorizontalOffset);\n\t\t\t\tpartDisplacement = 0;\n\t\t\t\tconst charCode = lineContent.charCodeAt(charIndex);\n\n\t\t\t\tlet producedCharacters: number;\n\t\t\t\tlet charWidth: number;\n\n\t\t\t\tif (charCode === CharCode.Tab) {\n\t\t\t\t\tproducedCharacters = (tabSize - (visibleColumn % tabSize)) | 0;\n\t\t\t\t\tcharWidth = producedCharacters;\n\n\t\t\t\t\tif (!canUseHalfwidthRightwardsArrow || charWidth > 1) {\n\t\t\t\t\t\tsb.appendCharCode(0x2192); // RIGHTWARDS ARROW\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsb.appendCharCode(0xFFEB); // HALFWIDTH RIGHTWARDS ARROW\n\t\t\t\t\t}\n\t\t\t\t\tfor (let space = 2; space <= charWidth; space++) {\n\t\t\t\t\t\tsb.appendCharCode(0xA0); // &nbsp;\n\t\t\t\t\t}\n\n\t\t\t\t} else { // must be CharCode.Space\n\t\t\t\t\tproducedCharacters = 2;\n\t\t\t\t\tcharWidth = 1;\n\n\t\t\t\t\tsb.appendCharCode(renderSpaceCharCode); // &middot; or word separator middle dot\n\t\t\t\t\tsb.appendCharCode(0x200C); // ZERO WIDTH NON-JOINER\n\t\t\t\t}\n\n\t\t\t\tcharOffsetInPart += producedCharacters;\n\t\t\t\tcharHorizontalOffset += charWidth;\n\t\t\t\tif (charIndex >= fauxIndentLength) {\n\t\t\t\t\tvisibleColumn += charWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tsb.appendASCIICharCode(CharCode.GreaterThan);\n\n\t\t\tfor (; charIndex < partEndIndex; charIndex++) {\n\t\t\t\tcharacterMapping.setColumnInfo(charIndex + 1, partIndex - partDisplacement, charOffsetInPart, charHorizontalOffset);\n\t\t\t\tpartDisplacement = 0;\n\t\t\t\tconst charCode = lineContent.charCodeAt(charIndex);\n\n\t\t\t\tlet producedCharacters = 1;\n\t\t\t\tlet charWidth = 1;\n\n\t\t\t\tswitch (charCode) {\n\t\t\t\t\tcase CharCode.Tab:\n\t\t\t\t\t\tproducedCharacters = (tabSize - (visibleColumn % tabSize));\n\t\t\t\t\t\tcharWidth = producedCharacters;\n\t\t\t\t\t\tfor (let space = 1; space <= producedCharacters; space++) {\n\t\t\t\t\t\t\tsb.appendCharCode(0xA0); // &nbsp;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase CharCode.Space:\n\t\t\t\t\t\tsb.appendCharCode(0xA0); // &nbsp;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase CharCode.LessThan:\n\t\t\t\t\t\tsb.appendString('&lt;');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase CharCode.GreaterThan:\n\t\t\t\t\t\tsb.appendString('&gt;');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase CharCode.Ampersand:\n\t\t\t\t\t\tsb.appendString('&amp;');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase CharCode.Null:\n\t\t\t\t\t\tif (renderControlCharacters) {\n\t\t\t\t\t\t\t// See https://unicode-table.com/en/blocks/control-pictures/\n\t\t\t\t\t\t\tsb.appendCharCode(9216);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsb.appendString('&#00;');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase CharCode.UTF8_BOM:\n\t\t\t\t\tcase CharCode.LINE_SEPARATOR:\n\t\t\t\t\tcase CharCode.PARAGRAPH_SEPARATOR:\n\t\t\t\t\tcase CharCode.NEXT_LINE:\n\t\t\t\t\t\tsb.appendCharCode(0xFFFD);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tif (strings.isFullWidthCharacter(charCode)) {\n\t\t\t\t\t\t\tcharWidth++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// See https://unicode-table.com/en/blocks/control-pictures/\n\t\t\t\t\t\tif (renderControlCharacters && charCode < 32) {\n\t\t\t\t\t\t\tsb.appendCharCode(9216 + charCode);\n\t\t\t\t\t\t} else if (renderControlCharacters && charCode === 127) {\n\t\t\t\t\t\t\t// DEL\n\t\t\t\t\t\t\tsb.appendCharCode(9249);\n\t\t\t\t\t\t} else if (renderControlCharacters && isControlCharacter(charCode)) {\n\t\t\t\t\t\t\tsb.appendString('[U+');\n\t\t\t\t\t\t\tsb.appendString(to4CharHex(charCode));\n\t\t\t\t\t\t\tsb.appendString(']');\n\t\t\t\t\t\t\tproducedCharacters = 8;\n\t\t\t\t\t\t\tcharWidth = producedCharacters;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsb.appendCharCode(charCode);\n\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcharOffsetInPart += producedCharacters;\n\t\t\t\tcharHorizontalOffset += charWidth;\n\t\t\t\tif (charIndex >= fauxIndentLength) {\n\t\t\t\t\tvisibleColumn += charWidth;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (partIsEmptyAndHasPseudoAfter) {\n\t\t\tpartDisplacement++;\n\t\t} else {\n\t\t\tpartDisplacement = 0;\n\t\t}\n\n\t\tif (charIndex >= len && !lastCharacterMappingDefined && part.isPseudoAfter()) {\n\t\t\tlastCharacterMappingDefined = true;\n\t\t\tcharacterMapping.setColumnInfo(charIndex + 1, partIndex, charOffsetInPart, charHorizontalOffset);\n\t\t}\n\n\t\tsb.appendString('</span>');\n\n\t}\n\n\tif (!lastCharacterMappingDefined) {\n\t\t// When getting client rects for the last character, we will position the\n\t\t// text range at the end of the span, insteaf of at the beginning of next span\n\t\tcharacterMapping.setColumnInfo(len + 1, parts.length - 1, charOffsetInPart, charHorizontalOffset);\n\t}\n\n\tif (isOverflowing) {\n\t\tsb.appendString('<span class=\"mtkoverflow\">');\n\t\tsb.appendString(nls.localize('showMore', \"Show more ({0})\", renderOverflowingCharCount(overflowingCharCount)));\n\t\tsb.appendString('</span>');\n\t}\n\n\tsb.appendString('</span>');\n\n\treturn new RenderLineOutput(characterMapping, containsRTL, containsForeignElements);\n}\n\nfunction to4CharHex(n: number): string {\n\treturn n.toString(16).toUpperCase().padStart(4, '0');\n}\n\nfunction renderOverflowingCharCount(n: number): string {\n\tif (n < 1024) {\n\t\treturn nls.localize('overflow.chars', \"{0} chars\", n);\n\t}\n\tif (n < 1024 * 1024) {\n\t\treturn `${(n / 1024).toFixed(1)} KB`;\n\t}\n\treturn `${(n / 1024 / 1024).toFixed(1)} MB`;\n}\n"]}