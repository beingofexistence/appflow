{"version":3,"sources":["vs/editor/contrib/codeAction/browser/codeActionController.ts"],"names":[],"mappings":"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","file":"codeActionController.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getDomNodePagePosition } from 'vs/base/browser/dom';\nimport { IAnchor } from 'vs/base/browser/ui/contextview/contextview';\nimport { IAction } from 'vs/base/common/actions';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { Lazy } from 'vs/base/common/lazy';\nimport { Disposable, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { IPosition, Position } from 'vs/editor/common/core/position';\nimport { IEditorContribution, ScrollType } from 'vs/editor/common/editorCommon';\nimport { CodeActionTriggerType } from 'vs/editor/common/languages';\nimport { ILanguageFeaturesService } from 'vs/editor/common/services/languageFeatures';\nimport { ApplyCodeActionReason, applyCodeAction } from 'vs/editor/contrib/codeAction/browser/codeAction';\nimport { CodeActionKeybindingResolver } from 'vs/editor/contrib/codeAction/browser/codeActionKeybindingResolver';\nimport { toMenuItems } from 'vs/editor/contrib/codeAction/browser/codeActionMenu';\nimport { LightBulbWidget } from 'vs/editor/contrib/codeAction/browser/lightBulbWidget';\nimport { MessageController } from 'vs/editor/contrib/message/browser/messageController';\nimport { localize } from 'vs/nls';\nimport { IActionListDelegate } from 'vs/platform/actionWidget/browser/actionList';\nimport { IActionWidgetService } from 'vs/platform/actionWidget/browser/actionWidget';\nimport { ICommandService } from 'vs/platform/commands/common/commands';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IMarkerService } from 'vs/platform/markers/common/markers';\nimport { IEditorProgressService } from 'vs/platform/progress/common/progress';\nimport { CodeActionAutoApply, CodeActionFilter, CodeActionItem, CodeActionSet, CodeActionTrigger, CodeActionTriggerSource } from '../common/types';\nimport { CodeActionModel, CodeActionsState } from './codeActionModel';\nimport { CancellationToken } from 'vs/base/common/cancellation';\n\n\ninterface IActionShowOptions {\n\treadonly includeDisabledActions?: boolean;\n\treadonly fromLightbulb?: boolean;\n}\n\nexport class CodeActionController extends Disposable implements IEditorContribution {\n\n\tpublic static readonly ID = 'editor.contrib.codeActionController';\n\n\tpublic static get(editor: ICodeEditor): CodeActionController | null {\n\t\treturn editor.getContribution<CodeActionController>(CodeActionController.ID);\n\t}\n\n\tprivate readonly _editor: ICodeEditor;\n\tprivate readonly _model: CodeActionModel;\n\n\tprivate readonly _lightBulbWidget: Lazy<LightBulbWidget | null>;\n\tprivate readonly _activeCodeActions = this._register(new MutableDisposable<CodeActionSet>());\n\tprivate _showDisabled = false;\n\n\tprivate readonly _resolver: CodeActionKeybindingResolver;\n\n\tprivate _disposed = false;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@IMarkerService markerService: IMarkerService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService,\n\t\t@IEditorProgressService progressService: IEditorProgressService,\n\t\t@ICommandService private readonly _commandService: ICommandService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IActionWidgetService private readonly _actionWidgetService: IActionWidgetService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._editor = editor;\n\n\t\tthis._model = this._register(new CodeActionModel(this._editor, languageFeaturesService.codeActionProvider, markerService, contextKeyService, progressService));\n\t\tthis._register(this._model.onDidChangeState(newState => this.update(newState)));\n\n\t\tthis._lightBulbWidget = new Lazy(() => {\n\t\t\tconst widget = this._editor.getContribution<LightBulbWidget>(LightBulbWidget.ID);\n\t\t\tif (widget) {\n\t\t\t\tthis._register(widget.onClick(e => this.showCodeActionList(e.actions, e, { includeDisabledActions: false, fromLightbulb: true })));\n\t\t\t}\n\t\t\treturn widget;\n\t\t});\n\n\t\tthis._resolver = instantiationService.createInstance(CodeActionKeybindingResolver);\n\n\t\tthis._register(this._editor.onDidLayoutChange(() => this._actionWidgetService.hide()));\n\t}\n\n\toverride dispose() {\n\t\tthis._disposed = true;\n\t\tsuper.dispose();\n\t}\n\n\tpublic showCodeActions(_trigger: CodeActionTrigger, actions: CodeActionSet, at: IAnchor | IPosition) {\n\t\treturn this.showCodeActionList(actions, at, { includeDisabledActions: false, fromLightbulb: false });\n\t}\n\n\tpublic hideCodeActions(): void {\n\t\tthis._actionWidgetService.hide();\n\t}\n\n\tpublic manualTriggerAtCurrentPosition(\n\t\tnotAvailableMessage: string,\n\t\ttriggerAction: CodeActionTriggerSource,\n\t\tfilter?: CodeActionFilter,\n\t\tautoApply?: CodeActionAutoApply,\n\t): void {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tMessageController.get(this._editor)?.closeMessage();\n\t\tconst triggerPosition = this._editor.getPosition();\n\t\tthis._trigger({ type: CodeActionTriggerType.Invoke, triggerAction, filter, autoApply, context: { notAvailableMessage, position: triggerPosition } });\n\t}\n\n\tprivate _trigger(trigger: CodeActionTrigger) {\n\t\treturn this._model.trigger(trigger);\n\t}\n\n\tprivate async _applyCodeAction(action: CodeActionItem, retrigger: boolean, preview: boolean): Promise<void> {\n\t\ttry {\n\t\t\tawait this._instantiationService.invokeFunction(applyCodeAction, action, ApplyCodeActionReason.FromCodeActions, { preview, editor: this._editor });\n\t\t} finally {\n\t\t\tif (retrigger) {\n\t\t\t\tthis._trigger({ type: CodeActionTriggerType.Auto, triggerAction: CodeActionTriggerSource.QuickFix, filter: {} });\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic hideLightBulbWidget(): void {\n\t\tthis._lightBulbWidget.rawValue?.hide();\n\t}\n\n\tprivate async update(newState: CodeActionsState.State): Promise<void> {\n\t\tif (newState.type !== CodeActionsState.Type.Triggered) {\n\t\t\tthis._lightBulbWidget.rawValue?.hide();\n\t\t\treturn;\n\t\t}\n\n\t\tlet actions: CodeActionSet;\n\t\ttry {\n\t\t\tactions = await newState.actions;\n\t\t} catch (e) {\n\t\t\tonUnexpectedError(e);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._lightBulbWidget.value?.update(actions, newState.trigger, newState.position);\n\n\t\tif (newState.trigger.type === CodeActionTriggerType.Invoke) {\n\t\t\tif (newState.trigger.filter?.include) { // Triggered for specific scope\n\t\t\t\t// Check to see if we want to auto apply.\n\n\t\t\t\tconst validActionToApply = this.tryGetValidActionToApply(newState.trigger, actions);\n\t\t\t\tif (validActionToApply) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis._lightBulbWidget.value?.hide();\n\t\t\t\t\t\tawait this._applyCodeAction(validActionToApply, false, false);\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tactions.dispose();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Check to see if there is an action that we would have applied were it not invalid\n\t\t\t\tif (newState.trigger.context) {\n\t\t\t\t\tconst invalidAction = this.getInvalidActionThatWouldHaveBeenApplied(newState.trigger, actions);\n\t\t\t\t\tif (invalidAction && invalidAction.action.disabled) {\n\t\t\t\t\t\tMessageController.get(this._editor)?.showMessage(invalidAction.action.disabled, newState.trigger.context.position);\n\t\t\t\t\t\tactions.dispose();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst includeDisabledActions = !!newState.trigger.filter?.include;\n\t\t\tif (newState.trigger.context) {\n\t\t\t\tif (!actions.allActions.length || !includeDisabledActions && !actions.validActions.length) {\n\t\t\t\t\tMessageController.get(this._editor)?.showMessage(newState.trigger.context.notAvailableMessage, newState.trigger.context.position);\n\t\t\t\t\tthis._activeCodeActions.value = actions;\n\t\t\t\t\tactions.dispose();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._activeCodeActions.value = actions;\n\t\t\tthis.showCodeActionList(actions, this.toCoords(newState.position), { includeDisabledActions, fromLightbulb: false });\n\t\t} else {\n\t\t\t// auto magically triggered\n\t\t\tif (this._actionWidgetService.isVisible) {\n\t\t\t\t// TODO: Figure out if we should update the showing menu?\n\t\t\t\tactions.dispose();\n\t\t\t} else {\n\t\t\t\tthis._activeCodeActions.value = actions;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getInvalidActionThatWouldHaveBeenApplied(trigger: CodeActionTrigger, actions: CodeActionSet): CodeActionItem | undefined {\n\t\tif (!actions.allActions.length) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif ((trigger.autoApply === CodeActionAutoApply.First && actions.validActions.length === 0)\n\t\t\t|| (trigger.autoApply === CodeActionAutoApply.IfSingle && actions.allActions.length === 1)\n\t\t) {\n\t\t\treturn actions.allActions.find(({ action }) => action.disabled);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate tryGetValidActionToApply(trigger: CodeActionTrigger, actions: CodeActionSet): CodeActionItem | undefined {\n\t\tif (!actions.validActions.length) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif ((trigger.autoApply === CodeActionAutoApply.First && actions.validActions.length > 0)\n\t\t\t|| (trigger.autoApply === CodeActionAutoApply.IfSingle && actions.validActions.length === 1)\n\t\t) {\n\t\t\treturn actions.validActions[0];\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tpublic async showCodeActionList(actions: CodeActionSet, at: IAnchor | IPosition, options: IActionShowOptions): Promise<void> {\n\t\tconst editorDom = this._editor.getDomNode();\n\t\tif (!editorDom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionsToShow = options.includeDisabledActions && (this._showDisabled || actions.validActions.length === 0) ? actions.allActions : actions.validActions;\n\t\tif (!actionsToShow.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst anchor = Position.isIPosition(at) ? this.toCoords(at) : at;\n\n\t\tconst delegate: IActionListDelegate<CodeActionItem> = {\n\t\t\tonSelect: async (action: CodeActionItem, preview?: boolean) => {\n\t\t\t\tthis._applyCodeAction(action, /* retrigger */ true, !!preview);\n\t\t\t\tthis._actionWidgetService.hide();\n\t\t\t},\n\t\t\tonHide: () => {\n\t\t\t\tthis._editor?.focus();\n\t\t\t},\n\t\t\tonFocus: async (action: CodeActionItem, token: CancellationToken) => {\n\t\t\t\tawait action.resolve(token);\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn { canPreview: !!action.action.edit?.edits.length };\n\t\t\t}\n\t\t};\n\n\t\tthis._actionWidgetService.show(\n\t\t\t'codeActionWidget',\n\t\t\ttrue,\n\t\t\ttoMenuItems(actionsToShow, this._shouldShowHeaders(), this._resolver.getResolver()),\n\t\t\tdelegate,\n\t\t\tanchor,\n\t\t\teditorDom,\n\t\t\tthis._getActionBarActions(actions, at, options));\n\t}\n\n\tprivate toCoords(position: IPosition): IAnchor {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn { x: 0, y: 0 };\n\t\t}\n\n\t\tthis._editor.revealPosition(position, ScrollType.Immediate);\n\t\tthis._editor.render();\n\n\t\t// Translate to absolute editor position\n\t\tconst cursorCoords = this._editor.getScrolledVisiblePosition(position);\n\t\tconst editorCoords = getDomNodePagePosition(this._editor.getDomNode());\n\t\tconst x = editorCoords.left + cursorCoords.left;\n\t\tconst y = editorCoords.top + cursorCoords.top + cursorCoords.height;\n\n\t\treturn { x, y };\n\t}\n\n\tprivate _shouldShowHeaders(): boolean {\n\t\tconst model = this._editor?.getModel();\n\t\treturn this._configurationService.getValue('editor.codeActionWidget.showHeaders', { resource: model?.uri });\n\t}\n\n\tprivate _getActionBarActions(actions: CodeActionSet, at: IAnchor | IPosition, options: IActionShowOptions): IAction[] {\n\t\tif (options.fromLightbulb) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst resultActions = actions.documentation.map((command): IAction => ({\n\t\t\tid: command.id,\n\t\t\tlabel: command.title,\n\t\t\ttooltip: command.tooltip ?? '',\n\t\t\tclass: undefined,\n\t\t\tenabled: true,\n\t\t\trun: () => this._commandService.executeCommand(command.id, ...(command.arguments ?? [])),\n\t\t}));\n\n\t\tif (options.includeDisabledActions && actions.validActions.length > 0 && actions.allActions.length !== actions.validActions.length) {\n\t\t\tresultActions.push(this._showDisabled ? {\n\t\t\t\tid: 'hideMoreActions',\n\t\t\t\tlabel: localize('hideMoreActions', 'Hide Disabled'),\n\t\t\t\tenabled: true,\n\t\t\t\ttooltip: '',\n\t\t\t\tclass: undefined,\n\t\t\t\trun: () => {\n\t\t\t\t\tthis._showDisabled = false;\n\t\t\t\t\treturn this.showCodeActionList(actions, at, options);\n\t\t\t\t}\n\t\t\t} : {\n\t\t\t\tid: 'showMoreActions',\n\t\t\t\tlabel: localize('showMoreActions', 'Show Disabled'),\n\t\t\t\tenabled: true,\n\t\t\t\ttooltip: '',\n\t\t\t\tclass: undefined,\n\t\t\t\trun: () => {\n\t\t\t\t\tthis._showDisabled = true;\n\t\t\t\t\treturn this.showCodeActionList(actions, at, options);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn resultActions;\n\t}\n}\n"]}