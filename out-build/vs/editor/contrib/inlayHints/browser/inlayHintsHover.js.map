{"version":3,"sources":["vs/editor/contrib/inlayHints/browser/inlayHintsHover.ts"],"names":[],"mappings":"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","file":"inlayHintsHover.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { AsyncIterableObject } from 'vs/base/common/async';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { IMarkdownString, isEmptyMarkdownString, MarkdownString } from 'vs/base/common/htmlContent';\nimport { ICodeEditor, IEditorMouseEvent, MouseTargetType } from 'vs/editor/browser/editorBrowser';\nimport { Position } from 'vs/editor/common/core/position';\nimport { IModelDecoration } from 'vs/editor/common/model';\nimport { ModelDecorationInjectedTextOptions } from 'vs/editor/common/model/textModel';\nimport { HoverAnchor, HoverForeignElementAnchor, IEditorHoverParticipant } from 'vs/editor/contrib/hover/browser/hoverTypes';\nimport { ILanguageService } from 'vs/editor/common/languages/language';\nimport { ITextModelService } from 'vs/editor/common/services/resolverService';\nimport { getHover } from 'vs/editor/contrib/hover/browser/getHover';\nimport { MarkdownHover, MarkdownHoverParticipant } from 'vs/editor/contrib/hover/browser/markdownHoverParticipant';\nimport { RenderedInlayHintLabelPart, InlayHintsController } from 'vs/editor/contrib/inlayHints/browser/inlayHintsController';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IOpenerService } from 'vs/platform/opener/common/opener';\nimport { ILanguageFeaturesService } from 'vs/editor/common/services/languageFeatures';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { localize } from 'vs/nls';\nimport * as platform from 'vs/base/common/platform';\nimport { asCommandLink } from 'vs/editor/contrib/inlayHints/browser/inlayHints';\nimport { isNonEmptyArray } from 'vs/base/common/arrays';\n\nclass InlayHintsHoverAnchor extends HoverForeignElementAnchor {\n\tconstructor(\n\t\treadonly part: RenderedInlayHintLabelPart,\n\t\towner: InlayHintsHover,\n\t\tinitialMousePosX: number | undefined,\n\t\tinitialMousePosY: number | undefined\n\t) {\n\t\tsuper(10, owner, part.item.anchor.range, initialMousePosX, initialMousePosY, true);\n\t}\n}\n\nexport class InlayHintsHover extends MarkdownHoverParticipant implements IEditorHoverParticipant<MarkdownHover> {\n\n\tpublic override readonly hoverOrdinal: number = 6;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@ILanguageService languageService: ILanguageService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@ITextModelService private readonly _resolverService: ITextModelService,\n\t\t@ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService,\n\t) {\n\t\tsuper(editor, languageService, openerService, configurationService, languageFeaturesService);\n\t}\n\n\tsuggestHoverAnchor(mouseEvent: IEditorMouseEvent): HoverAnchor | null {\n\t\tconst controller = InlayHintsController.get(this._editor);\n\t\tif (!controller) {\n\t\t\treturn null;\n\t\t}\n\t\tif (mouseEvent.target.type !== MouseTargetType.CONTENT_TEXT) {\n\t\t\treturn null;\n\t\t}\n\t\tconst options = mouseEvent.target.detail.injectedText?.options;\n\t\tif (!(options instanceof ModelDecorationInjectedTextOptions && options.attachedData instanceof RenderedInlayHintLabelPart)) {\n\t\t\treturn null;\n\t\t}\n\t\treturn new InlayHintsHoverAnchor(options.attachedData, this, mouseEvent.event.posx, mouseEvent.event.posy);\n\t}\n\n\toverride computeSync(): MarkdownHover[] {\n\t\treturn [];\n\t}\n\n\toverride computeAsync(anchor: HoverAnchor, _lineDecorations: IModelDecoration[], token: CancellationToken): AsyncIterableObject<MarkdownHover> {\n\t\tif (!(anchor instanceof InlayHintsHoverAnchor)) {\n\t\t\treturn AsyncIterableObject.EMPTY;\n\t\t}\n\n\t\treturn new AsyncIterableObject<MarkdownHover>(async executor => {\n\n\t\t\tconst { part } = anchor;\n\t\t\tawait part.item.resolve(token);\n\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// (1) Inlay Tooltip\n\t\t\tlet itemTooltip: IMarkdownString | undefined;\n\t\t\tif (typeof part.item.hint.tooltip === 'string') {\n\t\t\t\titemTooltip = new MarkdownString().appendText(part.item.hint.tooltip);\n\t\t\t} else if (part.item.hint.tooltip) {\n\t\t\t\titemTooltip = part.item.hint.tooltip;\n\t\t\t}\n\t\t\tif (itemTooltip) {\n\t\t\t\texecutor.emitOne(new MarkdownHover(this, anchor.range, [itemTooltip], false, 0));\n\t\t\t}\n\t\t\t// (1.2) Inlay dbl-click gesture\n\t\t\tif (isNonEmptyArray(part.item.hint.textEdits)) {\n\t\t\t\texecutor.emitOne(new MarkdownHover(this, anchor.range, [new MarkdownString().appendText(localize('hint.dbl', \"Double-click to insert\"))], false, 10001));\n\t\t\t}\n\n\t\t\t// (2) Inlay Label Part Tooltip\n\t\t\tlet partTooltip: IMarkdownString | undefined;\n\t\t\tif (typeof part.part.tooltip === 'string') {\n\t\t\t\tpartTooltip = new MarkdownString().appendText(part.part.tooltip);\n\t\t\t} else if (part.part.tooltip) {\n\t\t\t\tpartTooltip = part.part.tooltip;\n\t\t\t}\n\t\t\tif (partTooltip) {\n\t\t\t\texecutor.emitOne(new MarkdownHover(this, anchor.range, [partTooltip], false, 1));\n\t\t\t}\n\n\t\t\t// (2.2) Inlay Label Part Help Hover\n\t\t\tif (part.part.location || part.part.command) {\n\t\t\t\tlet linkHint: MarkdownString | undefined;\n\t\t\t\tconst useMetaKey = this._editor.getOption(EditorOption.multiCursorModifier) === 'altKey';\n\t\t\t\tconst kb = useMetaKey\n\t\t\t\t\t? platform.isMacintosh\n\t\t\t\t\t\t? localize('links.navigate.kb.meta.mac', \"cmd + click\")\n\t\t\t\t\t\t: localize('links.navigate.kb.meta', \"ctrl + click\")\n\t\t\t\t\t: platform.isMacintosh\n\t\t\t\t\t\t? localize('links.navigate.kb.alt.mac', \"option + click\")\n\t\t\t\t\t\t: localize('links.navigate.kb.alt', \"alt + click\");\n\n\t\t\t\tif (part.part.location && part.part.command) {\n\t\t\t\t\tlinkHint = new MarkdownString().appendText(localize('hint.defAndCommand', 'Go to Definition ({0}), right click for more', kb));\n\t\t\t\t} else if (part.part.location) {\n\t\t\t\t\tlinkHint = new MarkdownString().appendText(localize('hint.def', 'Go to Definition ({0})', kb));\n\t\t\t\t} else if (part.part.command) {\n\t\t\t\t\tlinkHint = new MarkdownString(`[${localize('hint.cmd', \"Execute Command\")}](${asCommandLink(part.part.command)} \"${part.part.command.title}\") (${kb})`, { isTrusted: true });\n\t\t\t\t}\n\t\t\t\tif (linkHint) {\n\t\t\t\t\texecutor.emitOne(new MarkdownHover(this, anchor.range, [linkHint], false, 10000));\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\t// (3) Inlay Label Part Location tooltip\n\t\t\tconst iterable = await this._resolveInlayHintLabelPartHover(part, token);\n\t\t\tfor await (const item of iterable) {\n\t\t\t\texecutor.emitOne(item);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async _resolveInlayHintLabelPartHover(part: RenderedInlayHintLabelPart, token: CancellationToken): Promise<AsyncIterableObject<MarkdownHover>> {\n\t\tif (!part.part.location) {\n\t\t\treturn AsyncIterableObject.EMPTY;\n\t\t}\n\t\tconst { uri, range } = part.part.location;\n\t\tconst ref = await this._resolverService.createModelReference(uri);\n\t\ttry {\n\t\t\tconst model = ref.object.textEditorModel;\n\t\t\tif (!this._languageFeaturesService.hoverProvider.has(model)) {\n\t\t\t\treturn AsyncIterableObject.EMPTY;\n\t\t\t}\n\t\t\treturn getHover(this._languageFeaturesService.hoverProvider, model, new Position(range.startLineNumber, range.startColumn), token)\n\t\t\t\t.filter(item => !isEmptyMarkdownString(item.hover.contents))\n\t\t\t\t.map(item => new MarkdownHover(this, part.item.anchor.range, item.hover.contents, false, 2 + item.ordinal));\n\t\t} finally {\n\t\t\tref.dispose();\n\t\t}\n\t}\n}\n"]}