{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/contrib/inlineProgress/browser/inlineProgress.ts"],"names":[],"mappings":"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","file":"inlineProgress.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from 'vs/base/browser/dom';\nimport { CancelablePromise, disposableTimeout } from 'vs/base/common/async';\nimport { Codicon } from 'vs/base/common/codicons';\nimport { Disposable, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { noBreakWhitespace } from 'vs/base/common/strings';\nimport { ThemeIcon } from 'vs/base/common/themables';\nimport 'vs/css!./inlineProgressWidget';\nimport { ContentWidgetPositionPreference, ICodeEditor, IContentWidget, IContentWidgetPosition } from 'vs/editor/browser/editorBrowser';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { IPosition } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\nimport { IEditorDecorationsCollection } from 'vs/editor/common/editorCommon';\nimport { TrackedRangeStickiness } from 'vs/editor/common/model';\nimport { ModelDecorationOptions } from 'vs/editor/common/model/textModel';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\n\nconst inlineProgressDecoration = ModelDecorationOptions.register({\n\tdescription: 'inline-progress-widget',\n\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\tshowIfCollapsed: true,\n\tafter: {\n\t\tcontent: noBreakWhitespace,\n\t\tinlineClassName: 'inline-editor-progress-decoration',\n\t\tinlineClassNameAffectsLetterSpacing: true,\n\t}\n});\n\n\nclass InlineProgressWidget extends Disposable implements IContentWidget {\n\tprivate static readonly baseId = 'editor.widget.inlineProgressWidget';\n\n\tallowEditorOverflow = false;\n\tsuppressMouseDown = true;\n\n\tprivate domNode!: HTMLElement;\n\n\tconstructor(\n\t\tprivate readonly typeId: string,\n\t\tprivate readonly editor: ICodeEditor,\n\t\tprivate readonly range: Range,\n\t\ttitle: string,\n\t\tprivate readonly delegate: InlineProgressDelegate,\n\t) {\n\t\tsuper();\n\n\t\tthis.create(title);\n\n\t\tthis.editor.addContentWidget(this);\n\t\tthis.editor.layoutContentWidget(this);\n\t}\n\n\tprivate create(title: string): void {\n\t\tthis.domNode = dom.$('.inline-progress-widget');\n\t\tthis.domNode.role = 'button';\n\t\tthis.domNode.title = title;\n\n\t\tconst iconElement = dom.$('span.icon');\n\t\tthis.domNode.append(iconElement);\n\n\t\ticonElement.classList.add(...ThemeIcon.asClassNameArray(Codicon.loading), 'codicon-modifier-spin');\n\n\t\tconst updateSize = () => {\n\t\t\tconst lineHeight = this.editor.getOption(EditorOption.lineHeight);\n\t\t\tthis.domNode.style.height = `${lineHeight}px`;\n\t\t\tthis.domNode.style.width = `${Math.ceil(0.8 * lineHeight)}px`;\n\t\t};\n\t\tupdateSize();\n\n\t\tthis._register(this.editor.onDidChangeConfiguration(c => {\n\t\t\tif (c.hasChanged(EditorOption.fontSize) || c.hasChanged(EditorOption.lineHeight)) {\n\t\t\t\tupdateSize();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(dom.addDisposableListener(this.domNode, dom.EventType.CLICK, e => {\n\t\t\tthis.delegate.cancel();\n\t\t}));\n\t}\n\n\tgetId(): string {\n\t\treturn InlineProgressWidget.baseId + '.' + this.typeId;\n\t}\n\n\tgetDomNode(): HTMLElement {\n\t\treturn this.domNode;\n\t}\n\n\tgetPosition(): IContentWidgetPosition | null {\n\t\treturn {\n\t\t\tposition: { lineNumber: this.range.startLineNumber, column: this.range.startColumn },\n\t\t\tpreference: [ContentWidgetPositionPreference.EXACT]\n\t\t};\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tthis.editor.removeContentWidget(this);\n\t}\n}\n\ninterface InlineProgressDelegate {\n\tcancel(): void;\n}\n\nexport class InlineProgressManager extends Disposable {\n\n\t/** Delay before showing the progress widget */\n\tprivate readonly _showDelay = 500; // ms\n\tprivate readonly _showPromise = this._register(new MutableDisposable());\n\n\tprivate readonly _currentDecorations: IEditorDecorationsCollection;\n\tprivate readonly _currentWidget = new MutableDisposable<InlineProgressWidget>();\n\n\tprivate _operationIdPool = 0;\n\tprivate _currentOperation?: number;\n\n\tconstructor(\n\t\treadonly id: string,\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._currentDecorations = _editor.createDecorationsCollection();\n\t}\n\n\tpublic async showWhile<R>(position: IPosition, title: string, promise: CancelablePromise<R>): Promise<R> {\n\t\tconst operationId = this._operationIdPool++;\n\t\tthis._currentOperation = operationId;\n\n\t\tthis.clear();\n\n\t\tthis._showPromise.value = disposableTimeout(() => {\n\t\t\tconst range = Range.fromPositions(position);\n\t\t\tconst decorationIds = this._currentDecorations.set([{\n\t\t\t\trange: range,\n\t\t\t\toptions: inlineProgressDecoration,\n\t\t\t}]);\n\n\t\t\tif (decorationIds.length > 0) {\n\t\t\t\tthis._currentWidget.value = this._instantiationService.createInstance(InlineProgressWidget, this.id, this._editor, range, title, promise);\n\t\t\t}\n\t\t}, this._showDelay);\n\n\t\ttry {\n\t\t\treturn await promise;\n\t\t} finally {\n\t\t\tif (this._currentOperation === operationId) {\n\t\t\t\tthis.clear();\n\t\t\t\tthis._currentOperation = undefined;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate clear() {\n\t\tthis._showPromise.clear();\n\t\tthis._currentDecorations.clear();\n\t\tthis._currentWidget.clear();\n\t}\n}\n"]}