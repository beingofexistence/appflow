{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/contrib/colorPicker/browser/colorHoverParticipant.ts"],"names":[],"mappings":"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","file":"colorHoverParticipant.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { AsyncIterableObject } from 'vs/base/common/async';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { Color, RGBA } from 'vs/base/common/color';\nimport { Disposable, DisposableStore, IDisposable } from 'vs/base/common/lifecycle';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { Range } from 'vs/editor/common/core/range';\nimport { IModelDecoration, ITextModel, TrackedRangeStickiness } from 'vs/editor/common/model';\nimport { DocumentColorProvider, IColorInformation } from 'vs/editor/common/languages';\nimport { getColorPresentations, getColors } from 'vs/editor/contrib/colorPicker/browser/color';\nimport { ColorDetector } from 'vs/editor/contrib/colorPicker/browser/colorDetector';\nimport { ColorPickerModel } from 'vs/editor/contrib/colorPicker/browser/colorPickerModel';\nimport { ColorPickerWidget } from 'vs/editor/contrib/colorPicker/browser/colorPickerWidget';\nimport { HoverAnchor, HoverAnchorType, IEditorHoverParticipant, IEditorHoverRenderContext, IHoverPart } from 'vs/editor/contrib/hover/browser/hoverTypes';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { ISingleEditOperation } from 'vs/editor/common/core/editOperation';\nimport { LanguageFeatureRegistry } from 'vs/editor/common/languageFeatureRegistry';\nimport { Dimension } from 'vs/base/browser/dom';\n\nexport class ColorHover implements IHoverPart {\n\n\t/**\n\t * Force the hover to always be rendered at this specific range,\n\t * even in the case of multiple hover parts.\n\t */\n\tpublic readonly forceShowAtRange: boolean = true;\n\n\tconstructor(\n\t\tpublic readonly owner: IEditorHoverParticipant<ColorHover>,\n\t\tpublic readonly range: Range,\n\t\tpublic readonly model: ColorPickerModel,\n\t\tpublic readonly provider: DocumentColorProvider\n\t) { }\n\n\tpublic isValidForHoverAnchor(anchor: HoverAnchor): boolean {\n\t\treturn (\n\t\t\tanchor.type === HoverAnchorType.Range\n\t\t\t&& this.range.startColumn <= anchor.range.startColumn\n\t\t\t&& this.range.endColumn >= anchor.range.endColumn\n\t\t);\n\t}\n}\n\nexport class ColorHoverParticipant implements IEditorHoverParticipant<ColorHover> {\n\n\tpublic readonly hoverOrdinal: number = 2;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IThemeService private readonly _themeService: IThemeService,\n\t) { }\n\n\tpublic computeSync(_anchor: HoverAnchor, _lineDecorations: IModelDecoration[]): ColorHover[] {\n\t\treturn [];\n\t}\n\n\tpublic computeAsync(anchor: HoverAnchor, lineDecorations: IModelDecoration[], token: CancellationToken): AsyncIterableObject<ColorHover> {\n\t\treturn AsyncIterableObject.fromPromise(this._computeAsync(anchor, lineDecorations, token));\n\t}\n\n\tprivate async _computeAsync(_anchor: HoverAnchor, lineDecorations: IModelDecoration[], _token: CancellationToken): Promise<ColorHover[]> {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn [];\n\t\t}\n\t\tconst colorDetector = ColorDetector.get(this._editor);\n\t\tif (!colorDetector) {\n\t\t\treturn [];\n\t\t}\n\t\tfor (const d of lineDecorations) {\n\t\t\tif (!colorDetector.isColorDecoration(d)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst colorData = colorDetector.getColorData(d.range.getStartPosition());\n\t\t\tif (colorData) {\n\t\t\t\tconst colorHover = await _createColorHover(this, this._editor.getModel(), colorData.colorInfo, colorData.provider);\n\t\t\t\treturn [colorHover];\n\t\t\t}\n\n\t\t}\n\t\treturn [];\n\t}\n\n\tpublic renderHoverParts(context: IEditorHoverRenderContext, hoverParts: ColorHover[]): IDisposable {\n\t\treturn renderHoverParts(this, this._editor, this._themeService, hoverParts, context);\n\t}\n}\n\nexport class StandaloneColorPickerHover {\n\tconstructor(\n\t\tpublic readonly owner: StandaloneColorPickerParticipant,\n\t\tpublic readonly range: Range,\n\t\tpublic readonly model: ColorPickerModel,\n\t\tpublic readonly provider: DocumentColorProvider\n\t) { }\n}\n\nexport class StandaloneColorPickerParticipant {\n\n\tpublic readonly hoverOrdinal: number = 2;\n\tprivate _color: Color | null = null;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IThemeService private readonly _themeService: IThemeService,\n\t) { }\n\n\tpublic async createColorHover(defaultColorInfo: IColorInformation, defaultColorProvider: DocumentColorProvider, colorProviderRegistry: LanguageFeatureRegistry<DocumentColorProvider>): Promise<{ colorHover: StandaloneColorPickerHover; foundInEditor: boolean } | null> {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn null;\n\t\t}\n\t\tconst colorDetector = ColorDetector.get(this._editor);\n\t\tif (!colorDetector) {\n\t\t\treturn null;\n\t\t}\n\t\tconst colors = await getColors(colorProviderRegistry, this._editor.getModel(), CancellationToken.None);\n\t\tlet foundColorInfo: IColorInformation | null = null;\n\t\tlet foundColorProvider: DocumentColorProvider | null = null;\n\t\tfor (const colorData of colors) {\n\t\t\tconst colorInfo = colorData.colorInfo;\n\t\t\tif (Range.containsRange(colorInfo.range, defaultColorInfo.range)) {\n\t\t\t\tfoundColorInfo = colorInfo;\n\t\t\t\tfoundColorProvider = colorData.provider;\n\t\t\t}\n\t\t}\n\t\tconst colorInfo = foundColorInfo ?? defaultColorInfo;\n\t\tconst colorProvider = foundColorProvider ?? defaultColorProvider;\n\t\tconst foundInEditor = !!foundColorInfo;\n\t\treturn { colorHover: await _createColorHover(this, this._editor.getModel(), colorInfo, colorProvider), foundInEditor: foundInEditor };\n\t}\n\n\tpublic async updateEditorModel(colorHoverData: StandaloneColorPickerHover): Promise<void> {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tconst colorPickerModel = colorHoverData.model;\n\t\tlet range = new Range(colorHoverData.range.startLineNumber, colorHoverData.range.startColumn, colorHoverData.range.endLineNumber, colorHoverData.range.endColumn);\n\t\tif (this._color) {\n\t\t\tawait _updateColorPresentations(this._editor.getModel(), colorPickerModel, this._color, range, colorHoverData);\n\t\t\trange = _updateEditorModel(this._editor, range, colorPickerModel);\n\t\t}\n\t}\n\n\tpublic renderHoverParts(context: IEditorHoverRenderContext, hoverParts: ColorHover[] | StandaloneColorPickerHover[]): IDisposable {\n\t\treturn renderHoverParts(this, this._editor, this._themeService, hoverParts, context);\n\t}\n\n\tpublic set color(color: Color | null) {\n\t\tthis._color = color;\n\t}\n\n\tpublic get color(): Color | null {\n\t\treturn this._color;\n\t}\n}\n\nasync function _createColorHover<T extends ColorHoverParticipant | StandaloneColorPickerParticipant>(participant: T, editorModel: ITextModel, colorInfo: IColorInformation, provider: DocumentColorProvider): Promise<T extends ColorHoverParticipant ? ColorHover : StandaloneColorPickerHover>;\nasync function _createColorHover(participant: ColorHoverParticipant | StandaloneColorPickerParticipant, editorModel: ITextModel, colorInfo: IColorInformation, provider: DocumentColorProvider): Promise<ColorHover | StandaloneColorPickerHover> {\n\tconst originalText = editorModel.getValueInRange(colorInfo.range);\n\tconst { red, green, blue, alpha } = colorInfo.color;\n\tconst rgba = new RGBA(Math.round(red * 255), Math.round(green * 255), Math.round(blue * 255), alpha);\n\tconst color = new Color(rgba);\n\n\tconst colorPresentations = await getColorPresentations(editorModel, colorInfo, provider, CancellationToken.None);\n\tconst model = new ColorPickerModel(color, [], 0);\n\tmodel.colorPresentations = colorPresentations || [];\n\tmodel.guessColorPresentation(color, originalText);\n\n\tif (participant instanceof ColorHoverParticipant) {\n\t\treturn new ColorHover(participant, Range.lift(colorInfo.range), model, provider);\n\t} else {\n\t\treturn new StandaloneColorPickerHover(participant, Range.lift(colorInfo.range), model, provider);\n\t}\n}\n\nfunction renderHoverParts(participant: ColorHoverParticipant | StandaloneColorPickerParticipant, editor: ICodeEditor, themeService: IThemeService, hoverParts: ColorHover[] | StandaloneColorPickerHover[], context: IEditorHoverRenderContext) {\n\tif (hoverParts.length === 0 || !editor.hasModel()) {\n\t\treturn Disposable.None;\n\t}\n\tif (context.setMinimumDimensions) {\n\t\tconst minimumHeight = editor.getOption(EditorOption.lineHeight) + 8;\n\t\tcontext.setMinimumDimensions(new Dimension(302, minimumHeight));\n\t}\n\n\tconst disposables = new DisposableStore();\n\tconst colorHover = hoverParts[0];\n\tconst editorModel = editor.getModel();\n\tconst model = colorHover.model;\n\tconst widget = disposables.add(new ColorPickerWidget(context.fragment, model, editor.getOption(EditorOption.pixelRatio), themeService, participant instanceof StandaloneColorPickerParticipant));\n\tcontext.setColorPicker(widget);\n\n\tlet editorUpdatedByColorPicker = false;\n\tlet range = new Range(colorHover.range.startLineNumber, colorHover.range.startColumn, colorHover.range.endLineNumber, colorHover.range.endColumn);\n\tif (participant instanceof StandaloneColorPickerParticipant) {\n\t\tconst color = hoverParts[0].model.color;\n\t\tparticipant.color = color;\n\t\t_updateColorPresentations(editorModel, model, color, range, colorHover);\n\t\tdisposables.add(model.onColorFlushed((color: Color) => {\n\t\t\tparticipant.color = color;\n\t\t}));\n\t} else {\n\t\tdisposables.add(model.onColorFlushed(async (color: Color) => {\n\t\t\tawait _updateColorPresentations(editorModel, model, color, range, colorHover);\n\t\t\teditorUpdatedByColorPicker = true;\n\t\t\trange = _updateEditorModel(editor, range, model, context);\n\t\t}));\n\t}\n\tdisposables.add(model.onDidChangeColor((color: Color) => {\n\t\t_updateColorPresentations(editorModel, model, color, range, colorHover);\n\t}));\n\tdisposables.add(editor.onDidChangeModelContent((e) => {\n\t\tif (editorUpdatedByColorPicker) {\n\t\t\teditorUpdatedByColorPicker = false;\n\t\t} else {\n\t\t\tcontext.hide();\n\t\t\teditor.focus();\n\t\t}\n\t}));\n\treturn disposables;\n}\n\nfunction _updateEditorModel(editor: ICodeEditor, range: Range, model: ColorPickerModel, context?: IEditorHoverRenderContext) {\n\tlet textEdits: ISingleEditOperation[];\n\tlet newRange: Range;\n\tif (model.presentation.textEdit) {\n\t\ttextEdits = [model.presentation.textEdit];\n\t\tnewRange = new Range(\n\t\t\tmodel.presentation.textEdit.range.startLineNumber,\n\t\t\tmodel.presentation.textEdit.range.startColumn,\n\t\t\tmodel.presentation.textEdit.range.endLineNumber,\n\t\t\tmodel.presentation.textEdit.range.endColumn\n\t\t);\n\t\tconst trackedRange = editor.getModel()!._setTrackedRange(null, newRange, TrackedRangeStickiness.GrowsOnlyWhenTypingAfter);\n\t\teditor.pushUndoStop();\n\t\teditor.executeEdits('colorpicker', textEdits);\n\t\tnewRange = editor.getModel()!._getTrackedRange(trackedRange) || newRange;\n\t} else {\n\t\ttextEdits = [{ range, text: model.presentation.label, forceMoveMarkers: false }];\n\t\tnewRange = range.setEndPosition(range.endLineNumber, range.startColumn + model.presentation.label.length);\n\t\teditor.pushUndoStop();\n\t\teditor.executeEdits('colorpicker', textEdits);\n\t}\n\n\tif (model.presentation.additionalTextEdits) {\n\t\ttextEdits = [...model.presentation.additionalTextEdits];\n\t\teditor.executeEdits('colorpicker', textEdits);\n\t\tif (context) {\n\t\t\tcontext.hide();\n\t\t}\n\t}\n\teditor.pushUndoStop();\n\treturn newRange;\n}\n\nasync function _updateColorPresentations(editorModel: ITextModel, colorPickerModel: ColorPickerModel, color: Color, range: Range, colorHover: ColorHover | StandaloneColorPickerHover) {\n\tconst colorPresentations = await getColorPresentations(editorModel, {\n\t\trange: range,\n\t\tcolor: {\n\t\t\tred: color.rgba.r / 255,\n\t\t\tgreen: color.rgba.g / 255,\n\t\t\tblue: color.rgba.b / 255,\n\t\t\talpha: color.rgba.a\n\t\t}\n\t}, colorHover.provider, CancellationToken.None);\n\tcolorPickerModel.colorPresentations = colorPresentations || [];\n}\n"]}