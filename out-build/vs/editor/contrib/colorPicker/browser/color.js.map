{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/contrib/colorPicker/browser/color.ts"],"names":[],"mappings":"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","file":"color.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { illegalArgument, onUnexpectedExternalError } from 'vs/base/common/errors';\nimport { URI } from 'vs/base/common/uri';\nimport { IRange, Range } from 'vs/editor/common/core/range';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { DocumentColorProvider, IColorInformation, IColorPresentation } from 'vs/editor/common/languages';\nimport { IModelService } from 'vs/editor/common/services/model';\nimport { CommandsRegistry } from 'vs/platform/commands/common/commands';\nimport { ILanguageFeaturesService } from 'vs/editor/common/services/languageFeatures';\nimport { LanguageFeatureRegistry } from 'vs/editor/common/languageFeatureRegistry';\nimport { DefaultDocumentColorProvider } from 'vs/editor/contrib/colorPicker/browser/defaultDocumentColorProvider';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { ServicesAccessor } from 'vs/editor/browser/editorExtensions';\n\nexport async function getColors(colorProviderRegistry: LanguageFeatureRegistry<DocumentColorProvider>, model: ITextModel, token: CancellationToken, isDefaultColorDecoratorsEnabled: boolean = true): Promise<IColorData[]> {\n\treturn _findColorData<IColorData>(new ColorDataCollector(), colorProviderRegistry, model, token, isDefaultColorDecoratorsEnabled);\n}\n\nexport function getColorPresentations(model: ITextModel, colorInfo: IColorInformation, provider: DocumentColorProvider, token: CancellationToken): Promise<IColorPresentation[] | null | undefined> {\n\treturn Promise.resolve(provider.provideColorPresentations(model, colorInfo, token));\n}\n\nexport interface IColorData {\n\tcolorInfo: IColorInformation;\n\tprovider: DocumentColorProvider;\n}\n\ninterface IExtColorData { range: IRange; color: [number, number, number, number] }\n\ninterface DataCollector<T> {\n\tcompute(provider: DocumentColorProvider, model: ITextModel, token: CancellationToken, result: T[]): Promise<boolean>;\n}\n\nclass ColorDataCollector implements DataCollector<IColorData> {\n\tconstructor() { }\n\tasync compute(provider: DocumentColorProvider, model: ITextModel, token: CancellationToken, colors: IColorData[]): Promise<boolean> {\n\t\tconst documentColors = await provider.provideDocumentColors(model, token);\n\t\tif (Array.isArray(documentColors)) {\n\t\t\tfor (const colorInfo of documentColors) {\n\t\t\t\tcolors.push({ colorInfo, provider });\n\t\t\t}\n\t\t}\n\t\treturn Array.isArray(documentColors);\n\t}\n}\n\nclass ExtColorDataCollector implements DataCollector<IExtColorData> {\n\tconstructor() { }\n\tasync compute(provider: DocumentColorProvider, model: ITextModel, token: CancellationToken, colors: IExtColorData[]): Promise<boolean> {\n\t\tconst documentColors = await provider.provideDocumentColors(model, token);\n\t\tif (Array.isArray(documentColors)) {\n\t\t\tfor (const colorInfo of documentColors) {\n\t\t\t\tcolors.push({ range: colorInfo.range, color: [colorInfo.color.red, colorInfo.color.green, colorInfo.color.blue, colorInfo.color.alpha] });\n\t\t\t}\n\t\t}\n\t\treturn Array.isArray(documentColors);\n\t}\n\n}\n\nclass ColorPresentationsCollector implements DataCollector<IColorPresentation> {\n\tconstructor(private colorInfo: IColorInformation) { }\n\tasync compute(provider: DocumentColorProvider, model: ITextModel, _token: CancellationToken, colors: IColorPresentation[]): Promise<boolean> {\n\t\tconst documentColors = await provider.provideColorPresentations(model, this.colorInfo, CancellationToken.None);\n\t\tif (Array.isArray(documentColors)) {\n\t\t\tcolors.push(...documentColors);\n\t\t}\n\t\treturn Array.isArray(documentColors);\n\t}\n}\n\nasync function _findColorData<T extends IColorPresentation | IExtColorData | IColorData>(collector: DataCollector<T>, colorProviderRegistry: LanguageFeatureRegistry<DocumentColorProvider>, model: ITextModel, token: CancellationToken, isDefaultColorDecoratorsEnabled: boolean): Promise<T[]> {\n\tlet validDocumentColorProviderFound = false;\n\tlet defaultProvider: DefaultDocumentColorProvider | undefined;\n\tconst colorData: T[] = [];\n\tconst documentColorProviders = colorProviderRegistry.ordered(model);\n\tfor (let i = documentColorProviders.length - 1; i >= 0; i--) {\n\t\tconst provider = documentColorProviders[i];\n\t\tif (provider instanceof DefaultDocumentColorProvider) {\n\t\t\tdefaultProvider = provider;\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tif (await collector.compute(provider, model, token, colorData)) {\n\t\t\t\t\tvalidDocumentColorProviderFound = true;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tonUnexpectedExternalError(e);\n\t\t\t}\n\t\t}\n\t}\n\tif (validDocumentColorProviderFound) {\n\t\treturn colorData;\n\t}\n\tif (defaultProvider && isDefaultColorDecoratorsEnabled) {\n\t\tawait collector.compute(defaultProvider, model, token, colorData);\n\t\treturn colorData;\n\t}\n\treturn [];\n}\n\nfunction _setupColorCommand(accessor: ServicesAccessor, resource: URI): { model: ITextModel; colorProviderRegistry: LanguageFeatureRegistry<DocumentColorProvider>; isDefaultColorDecoratorsEnabled: boolean } {\n\tconst { colorProvider: colorProviderRegistry } = accessor.get(ILanguageFeaturesService);\n\tconst model = accessor.get(IModelService).getModel(resource);\n\tif (!model) {\n\t\tthrow illegalArgument();\n\t}\n\tconst isDefaultColorDecoratorsEnabled = accessor.get(IConfigurationService).getValue<boolean>('editor.defaultColorDecorators', { resource });\n\treturn { model, colorProviderRegistry, isDefaultColorDecoratorsEnabled };\n}\n\nCommandsRegistry.registerCommand('_executeDocumentColorProvider', function (accessor, ...args) {\n\tconst [resource] = args;\n\tif (!(resource instanceof URI)) {\n\t\tthrow illegalArgument();\n\t}\n\tconst { model, colorProviderRegistry, isDefaultColorDecoratorsEnabled } = _setupColorCommand(accessor, resource);\n\treturn _findColorData<IExtColorData>(new ExtColorDataCollector(), colorProviderRegistry, model, CancellationToken.None, isDefaultColorDecoratorsEnabled);\n});\n\nCommandsRegistry.registerCommand('_executeColorPresentationProvider', function (accessor, ...args) {\n\tconst [color, context] = args;\n\tconst { uri, range } = context;\n\tif (!(uri instanceof URI) || !Array.isArray(color) || color.length !== 4 || !Range.isIRange(range)) {\n\t\tthrow illegalArgument();\n\t}\n\tconst { model, colorProviderRegistry, isDefaultColorDecoratorsEnabled } = _setupColorCommand(accessor, uri);\n\tconst [red, green, blue, alpha] = color;\n\treturn _findColorData<IColorPresentation>(new ColorPresentationsCollector({ range: range, color: { red, green, blue, alpha } }), colorProviderRegistry, model, CancellationToken.None, isDefaultColorDecoratorsEnabled);\n});\n"]}