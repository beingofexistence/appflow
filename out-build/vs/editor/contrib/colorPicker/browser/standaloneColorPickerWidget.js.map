{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/contrib/colorPicker/browser/standaloneColorPickerWidget.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;;IA2BzF,IAAM,GAAG,GAAT,MAAM,GAAgC,SAAQ,eAAG;;iBAEzC,OAAE,GAAG,gDAAH,AAAmD,CAAC;QAKpE,YACkB,CAAoB,EACjB,kBAAuB,EAC5B,CAAmC,EAC9B,CAAwC,EACrC,CAA2C,EACxC,CAA6C,EACxC,CAAmD;YAElF,KAAK,EAAE,CAAC;YARS,MAAC,GAAD,CAAC,CAAmB;YAEL,MAAC,GAAD,CAAC,CAAiB;YACb,MAAC,GAAD,CAAC,CAAsB;YACpB,MAAC,GAAD,CAAC,CAAyB;YACvB,MAAC,GAAD,CAAC,CAA2B;YACvB,MAAC,GAAD,CAAC,CAAiC;YAX3E,MAAC,GAAkE,IAAI,CAAC;YAc/E,IAAI,CAAC,CAAC,GAA+B,qCAAiB,CAAC,4BAA4B,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAC;YAC/G,IAAI,CAAC,CAAC,GAA+B,qCAAiB,CAAC,4BAA4B,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAC;QAChH,CAAC;QAEM,WAAW;YACjB,IAAI,CAAC,IAAI,CAAC,CAAC,CAAO,QAAQ,EAAE,EAAE;gBAC7B,OAAO;aACP;YACD,IAAI,CAAC,IAAI,CAAC,CAAC,CAA6B,GAAG,EAAE,EAAE;gBAC9C,IAAI,CAAC,CAAC,GAA8B,IAAI,GAAG,CAAyB,IAAI,CAAC,CAAC,EAAQ,IAAI,CAAC,CAAC,EAA8B,IAAI,CAAC,CAAC,EAA8B,IAAI,CAAC,CAAC,EAAsB,IAAI,CAAC,CAAC,EAAc,IAAI,CAAC,CAAC,EAAmB,IAAI,CAAC,CAAC,EAAwB,IAAI,CAAC,CAAC,CAA6B,CAAC;aACrS;iBAAM,IAAI,CAAC,IAAI,CAAC,CAAC,CAA6B,GAAG,EAAE,EAAE;gBACrD,IAAI,CAAC,CAAC,EAA6B,KAAK,EAAE,CAAC;aAC3C;QACF,CAAC;QAEM,IAAI;YACV,IAAI,CAAC,CAAC,CAA6B,GAAG,CAAC,KAAK,CAAC,CAAC;YAC9C,IAAI,CAAC,CAAC,CAA6B,GAAG,CAAC,KAAK,CAAC,CAAC;YAC9C,IAAI,CAAC,CAAC,EAA6B,IAAI,EAAE,CAAC;YAC1C,IAAI,CAAC,CAAC,CAAO,KAAK,EAAE,CAAC;QACtB,CAAC;QAEM,WAAW;YACjB,IAAI,CAAC,CAAC,EAA6B,YAAY,EAAE,CAAC;YAClD,IAAI,CAAC,IAAI,EAAE,CAAC;QACb,CAAC;QAEM,MAAM,CAAC,GAAG,CAAC,MAAmB;YACpC,OAAO,MAAM,CAAC,eAAe,CAAkC,KAAG,CAA6B,EAAE,CAAC,CAAC;QACpG,CAAC;;IA9CW,kBAAG;kBAAH,GAAG;QASb,WAAA,gBAAG,CAAA;QACH,WAAA,WAAG,CAAA;QACH,WAAA,gBAAG,CAAA;QACH,WAAA,mBAAG,CAAA;QACH,WAAA,sBAAG,CAAA;QACH,WAAA,mCAAG,CAAA;OAdO,GAAG,CA+Cf;IAED,IAAA,sBAAG,EAAwB,GAAG,CAA6B,EAAE,EAAE,GAAG,2DAA+E,CAAC;IAElJ,MAAM,OAAO,GAAG,CAAC,CAAC;IAClB,MAAM,kBAAkB,GAAG,EAAE,CAAC;IAEvB,IAAM,GAAG,GAAT,MAAM,GAA4B,SAAQ,eAAG;;iBAEnC,OAAE,GAAG,4CAAH,AAA+C,CAAC;QAalE,YACkB,CAAoB,EACpB,CAAmD,EACnD,CAAmD,EAC7C,qBAA0B,EAClC,CAAmC,EAC9B,CAAwC,EAClC,CAA8C,EACzC,CAAmD;YAElF,KAAK,EAAE,CAAC;YATS,MAAC,GAAD,CAAC,CAAmB;YACpB,MAAC,GAAD,CAAC,CAAkD;YACnD,MAAC,GAAD,CAAC,CAAkD;YAEpC,MAAC,GAAD,CAAC,CAAiB;YACb,MAAC,GAAD,CAAC,CAAsB;YACjB,MAAC,GAAD,CAAC,CAA4B;YACxB,MAAC,GAAD,CAAC,CAAiC;YApB1E,wBAAmB,GAAG,IAAI,CAAC;YAEnB,MAAC,GAAiC,SAAS,CAAC;YAGrD,MAAC,GAAoB,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YACnD,MAAC,GAAgD,IAAI,CAAC;YACtD,MAAC,GAAgC,KAAK,CAAC;YAE9B,MAAC,GAAW,IAAI,CAAC,CAAC,CAAS,IAAI,WAAG,EAAmC,CAAC,CAAC;YACxE,aAAQ,GAAG,IAAI,CAAC,CAAC,CAAS,KAAK,CAAC;YAa/C,IAAI,CAAC,CAAC,CAA6B,GAAG,CAAC,IAAI,CAAC,CAAC;YAC7C,IAAI,CAAC,CAAC,GAAmC,qBAAqB,CAAC,cAAc,CAAC,2BAAG,EAA+B,IAAI,CAAC,CAAC,CAAO,CAAC;YAC9H,IAAI,CAAC,CAAC,GAAW,IAAI,CAAC,CAAC,CAAO,aAAa,EAAE,EAAE,qBAAqB,EAAE,CAAC,UAAU,CAAC,QAAQ,CAAC;YAC3F,MAAM,eAAe,GAAG,IAAI,CAAC,CAAC,CAAO,YAAY,EAAE,CAAC;YACpD,MAAM,SAAS,GAAG,eAAe,CAAC,CAAC;gBAClC;oBACC,eAAe,EAAE,eAAe,CAAC,eAAe;oBAChD,WAAW,EAAE,eAAe,CAAC,WAAW;oBACxC,aAAa,EAAE,eAAe,CAAC,aAAa;oBAC5C,SAAS,EAAE,eAAe,CAAC,SAAS;iBACpC,CAAC,CAAC,CAAC,EAAE,eAAe,EAAE,CAAC,EAAE,aAAa,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,WAAW,EAAE,CAAC,EAAE,CAAC;YAC5E,MAAM,YAAY,GAAG,IAAI,CAAC,CAAC,CAAS,GAAG,CAAC,GAAG,CAAQ,IAAI,CAAC,CAAC,CAAK,CAAC,CAAC;YAChE,IAAI,CAAC,CAAC,CAAS,YAAY,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE;gBACzC,IAAI,CAAC,IAAI,EAAE,CAAC;YACb,CAAC,CAAC,CAAC,CAAC;YACJ,IAAI,CAAC,CAAC,CAAS,YAAY,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE;gBAC1C,IAAI,CAAC,KAAK,EAAE,CAAC;YACd,CAAC,CAAC,CAAC,CAAC;YACJ,0DAA0D;YAC1D,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,CAAC,CAAO,yBAAyB,CAAC,GAAG,EAAE;gBAC1D,uFAAuF;gBACvF,IAAI,CAAC,IAAI,CAAC,CAAC,EAAsB;oBAChC,IAAI,CAAC,IAAI,EAAE,CAAC;iBACZ;qBAAM;oBACN,IAAI,CAAC,CAAC,GAAuB,KAAK,CAAC;iBACnC;YACF,CAAC,CAAC,CAAC,CAAC;YACJ,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,CAAC,CAAO,WAAW,CAAC,CAAC,CAAC,EAAE,EAAE;gBAC7C,MAAM,SAAS,GAAG,CAAC,CAAC,MAAM,CAAC,OAAO,EAAE,SAAS,CAAC;gBAC9C,IAAI,SAAS,IAAI,SAAS,CAAC,QAAQ,CAAC,8BAA8B,CAAC,EAAE;oBACpE,IAAI,CAAC,IAAI,EAAE,CAAC;iBACZ;YACF,CAAC,CAAC,CAAC,CAAC;YACJ,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,EAAE;gBACvC,IAAI,CAAC,CAAC,CAAO,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,aAAa,CAAC,CAAC;YAClD,CAAC,CAAC,CAAC,CAAC;YACJ,IAAI,CAAC,CAAC,CAAM,SAAS,CAAC,CAAC;YACvB,IAAI,CAAC,CAAC,CAAK,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC;YAC/B,IAAI,CAAC,CAAC,CAAO,gBAAgB,CAAC,IAAI,CAAC,CAAC;QACrC,CAAC;QAEM,YAAY;YAClB,IAAI,IAAI,CAAC,CAAC,EAAY;gBACrB,IAAI,CAAC,CAAC,CAAiC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAW,CAAC;aAC3E;QACF,CAAC;QAEM,KAAK;YACX,OAAO,KAAG,CAAyB,EAAE,CAAC;QACvC,CAAC;QAEM,UAAU;YAChB,OAAO,IAAI,CAAC,CAAC,CAAK;QACnB,CAAC;QAEM,WAAW;YACjB,IAAI,CAAC,IAAI,CAAC,CAAC,EAAU;gBACpB,OAAO,IAAI,CAAC;aACZ;YACD,MAAM,kBAAkB,GAAG,IAAI,CAAC,CAAC,CAAO,SAAS,6BAAoB,CAAC,KAAK,CAAC;YAC5E,OAAO;gBACN,QAAQ,EAAE,IAAI,CAAC,CAAC;gBAChB,iBAAiB,EAAE,IAAI,CAAC,CAAC;gBACzB,UAAU,EAAE,kBAAkB,CAAC,CAAC,CAAC,8FAA8E,CAAC,CAAC,CAAC,8FAA8E;gBAChM,gBAAgB,+BAAuB;aACvC,CAAC;QACH,CAAC;QAEM,IAAI;YACV,IAAI,CAAC,OAAO,EAAE,CAAC;YACf,IAAI,CAAC,CAAC,CAA6B,GAAG,CAAC,KAAK,CAAC,CAAC;YAC9C,IAAI,CAAC,CAAC,CAA6B,GAAG,CAAC,KAAK,CAAC,CAAC;YAC9C,IAAI,CAAC,CAAC,CAAO,mBAAmB,CAAC,IAAI,CAAC,CAAC;YACvC,IAAI,CAAC,CAAC,CAAO,KAAK,EAAE,CAAC;QACtB,CAAC;QAEM,KAAK;YACX,IAAI,CAAC,CAAC,CAA6B,GAAG,CAAC,IAAI,CAAC,CAAC;YAC7C,IAAI,CAAC,CAAC,CAAK,KAAK,EAAE,CAAC;QACpB,CAAC;QAEO,KAAK,CAAC,CAAC,CAAM,SAAiB;YACrC,MAAM,kBAAkB,GAAG,MAAM,IAAI,CAAC,CAAC,CAAa,SAAS,CAAC,CAAC;YAC/D,IAAI,CAAC,kBAAkB,EAAE;gBACxB,OAAO;aACP;YACD,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,IAAI,2BAA2B,CAAC,kBAAkB,CAAC,MAAM,EAAE,kBAAkB,CAAC,aAAa,CAAC,CAAC,CAAC;QACnH,CAAC;QAEO,KAAK,CAAC,CAAC,CAAa,KAAa;YACxC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAO,QAAQ,EAAE,EAAE;gBAC7B,OAAO,IAAI,CAAC;aACZ;YACD,MAAM,SAAS,GAAsB;gBACpC,KAAK,EAAE,KAAK;gBACZ,KAAK,EAAE,EAAE,GAAG,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE;aAC9C,CAAC;YACF,MAAM,gBAAgB,GAA8E,MAAM,IAAI,CAAC,CAAC,CAAiC,gBAAgB,CAAC,SAAS,EAAE,IAAI,kCAAG,CAA0B,IAAI,CAAC,CAAC,EAAc,IAAI,CAAC,CAAC,CAA6B,EAAE,IAAI,CAAC,CAAC,CAAwB,aAAa,CAAC,CAAC;YACpT,IAAI,CAAC,gBAAgB,EAAE;gBACtB,OAAO,IAAI,CAAC;aACZ;YACD,OAAO,EAAE,MAAM,EAAE,gBAAgB,CAAC,UAAU,EAAE,aAAa,EAAE,gBAAgB,CAAC,aAAa,EAAE,CAAC;QAC/F,CAAC;QAEO,CAAC,CAAO,UAAe,EAAyB,aAAsB;YAC7E,MAAM,QAAQ,GAAG,QAAQ,CAAC,sBAAsB,EAAE,CAAC;YACnD,MAAM,SAAS,GAAG,IAAI,CAAC,CAAC,CAAS,IAAI,kBAAG,CAAkB,IAAI,CAAC,CAAC,CAAkB,CAAC,CAAC;YACpF,IAAI,iBAAgD,CAAC;YAErD,MAAM,OAAO,GAA8B;gBAC1C,QAAQ;gBACR,SAAS;gBACT,cAAc,EAAE,CAAC,MAAW,EAAgB,EAAE,CAAC,iBAAiB,GAAG,MAAM;gBACzE,iBAAiB,EAAE,GAAG,EAAE,GAAG,CAAC;gBAC5B,IAAI,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE;aACvB,CAAC;YAEF,IAAI,CAAC,CAAC,GAAa,UAAU,CAAC;YAC9B,IAAI,CAAC,CAAC,CAAS,IAAI,CAAC,CAAC,CAAiC,gBAAgB,CAAC,OAAO,EAAE,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YAC/F,IAAI,iBAAiB,KAAK,SAAS,EAAE;gBACpC,OAAO;aACP;YACD,IAAI,CAAC,CAAC,CAAK,SAAS,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC;YACxD,IAAI,CAAC,CAAC,CAAK,KAAK,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAO,aAAa,EAAE,CAAC,MAAM,GAAG,CAAC,EAAE,GAAG,CAAC,GAAG,IAAI,CAAC;YAC3F,IAAI,CAAC,CAAC,CAAK,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAO,aAAa,EAAE,CAAC,KAAK,GAAG,IAAI,EAAE,GAAG,CAAC,GAAG,IAAI,CAAC;YAC5F,IAAI,CAAC,CAAC,CAAK,QAAQ,GAAG,CAAC,CAAC;YACxB,IAAI,CAAC,CAAC,CAAK,WAAW,CAAC,QAAQ,CAAC,CAAC;YACjC,iBAAiB,CAAC,MAAM,EAAE,CAAC;YAE3B,MAAM,eAAe,GAAG,iBAAiB,CAAC,IAAI,CAAC;YAC/C,MAAM,kBAAkB,GAAG,eAAe,CAAC,aAAa,CAAC,OAAO,CAAC,WAAW,CAAC;YAC7E,MAAM,uBAAuB,GAAG,eAAe,CAAC,OAAO,CAAC,WAAW,GAAG,kBAAkB,GAAG,kBAAkB,GAAG,OAAO,CAAC;YACxH,MAAM,WAAW,GAAwB,iBAAiB,CAAC,IAAI,CAAC,WAAW,CAAC;YAC5E,WAAW,EAAE,SAAS,CAAC,GAAG,EAAE;gBAC3B,IAAI,CAAC,YAAY,EAAE,CAAC;gBACpB,IAAI,CAAC,IAAI,EAAE,CAAC;YACb,CAAC,CAAC,CAAC;YACH,MAAM,iBAAiB,GAAG,iBAAiB,CAAC,MAAM,CAAC;YACnD,MAAM,eAAe,GAAG,iBAAiB,CAAC,eAAe,CAAC;YAC1D,eAAe,CAAC,KAAK,CAAC,KAAK,GAAG,kBAAkB,GAAG,OAAO,GAAG,IAAI,CAAC;YAClE,MAAM,iBAAiB,GAAG,iBAAiB,CAAC,iBAAiB,CAAC;YAC9D,iBAAiB,CAAC,KAAK,CAAC,KAAK,GAAG,uBAAuB,GAAG,IAAI,CAAC;YAC/D,MAAM,WAAW,GAAG,iBAAiB,CAAC,MAAM,CAAC,WAAW,CAAC;YACzD,WAAW,EAAE,SAAS,CAAC,GAAG,EAAE;gBAC3B,IAAI,CAAC,IAAI,EAAE,CAAC;YACb,CAAC,CAAC,CAAC;YACH,kEAAkE;YAClE,IAAI,aAAa,EAAE;gBAClB,IAAI,WAAW,EAAE;oBAChB,WAAW,CAAC,MAAM,CAAC,WAAW,GAAG,SAAS,CAAC;iBAC3C;gBACD,IAAI,CAAC,CAAC,GAAuB,IAAI,CAAC;gBAClC,IAAI,CAAC,CAAC,CAAO,YAAY,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;aAC5C;YACD,IAAI,CAAC,CAAC,CAAO,mBAAmB,CAAC,IAAI,CAAC,CAAC;QACxC,CAAC;;IArLW,kBAAG;kBAAH,GAAG;QAmBb,WAAA,mBAAG,CAAA;QACH,WAAA,WAAG,CAAA;QACH,WAAA,gBAAG,CAAA;QACH,WAAA,sBAAG,CAAA;QACH,WAAA,mCAAG,CAAA;OAvBO,GAAG,CAsLf;IAED,MAAM,2BAA2B;QAChC,+HAA+H;QAC/H,YACiB,KAAU,EACV,aAAsB;YADtB,UAAK,GAAL,KAAK,CAAK;YACV,kBAAa,GAAb,aAAa,CAAS;QACnC,CAAC;KACL","file":"standaloneColorPickerWidget.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { IEditorHoverRenderContext } from 'vs/editor/contrib/hover/browser/hoverTypes';\nimport { ContentWidgetPositionPreference, ICodeEditor, IContentWidget, IContentWidgetPosition } from 'vs/editor/browser/editorBrowser';\nimport { PositionAffinity } from 'vs/editor/common/model';\nimport { Position } from 'vs/editor/common/core/position';\nimport { StandaloneColorPickerHover, StandaloneColorPickerParticipant } from 'vs/editor/contrib/colorPicker/browser/colorHoverParticipant';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { EditorHoverStatusBar } from 'vs/editor/contrib/hover/browser/contentHover';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { ColorPickerWidget, InsertButton } from 'vs/editor/contrib/colorPicker/browser/colorPickerWidget';\nimport { Emitter } from 'vs/base/common/event';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { IColorInformation } from 'vs/editor/common/languages';\nimport { ILanguageFeaturesService } from 'vs/editor/common/services/languageFeatures';\nimport { IEditorContribution } from 'vs/editor/common/editorCommon';\nimport { EditorContributionInstantiation, registerEditorContribution } from 'vs/editor/browser/editorExtensions';\nimport { EditorContextKeys } from 'vs/editor/common/editorContextKeys';\nimport { IContextKey, IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IRange } from 'vs/editor/common/core/range';\nimport { IModelService } from 'vs/editor/common/services/model';\nimport { ILanguageConfigurationService } from 'vs/editor/common/languages/languageConfigurationRegistry';\nimport { DefaultDocumentColorProvider } from 'vs/editor/contrib/colorPicker/browser/defaultDocumentColorProvider';\nimport * as dom from 'vs/base/browser/dom';\nimport 'vs/css!./colorPicker';\n\nexport class StandaloneColorPickerController extends Disposable implements IEditorContribution {\n\n\tpublic static ID = 'editor.contrib.standaloneColorPickerController';\n\tprivate _standaloneColorPickerWidget: StandaloneColorPickerWidget | null = null;\n\tprivate _standaloneColorPickerVisible: IContextKey<boolean>;\n\tprivate _standaloneColorPickerFocused: IContextKey<boolean>;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IContextKeyService _contextKeyService: IContextKeyService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ILanguageFeaturesService private readonly _languageFeatureService: ILanguageFeaturesService,\n\t\t@ILanguageConfigurationService private readonly _languageConfigurationService: ILanguageConfigurationService\n\t) {\n\t\tsuper();\n\t\tthis._standaloneColorPickerVisible = EditorContextKeys.standaloneColorPickerVisible.bindTo(_contextKeyService);\n\t\tthis._standaloneColorPickerFocused = EditorContextKeys.standaloneColorPickerFocused.bindTo(_contextKeyService);\n\t}\n\n\tpublic showOrFocus() {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this._standaloneColorPickerVisible.get()) {\n\t\t\tthis._standaloneColorPickerWidget = new StandaloneColorPickerWidget(this._editor, this._standaloneColorPickerVisible, this._standaloneColorPickerFocused, this._instantiationService, this._modelService, this._keybindingService, this._languageFeatureService, this._languageConfigurationService);\n\t\t} else if (!this._standaloneColorPickerFocused.get()) {\n\t\t\tthis._standaloneColorPickerWidget?.focus();\n\t\t}\n\t}\n\n\tpublic hide() {\n\t\tthis._standaloneColorPickerFocused.set(false);\n\t\tthis._standaloneColorPickerVisible.set(false);\n\t\tthis._standaloneColorPickerWidget?.hide();\n\t\tthis._editor.focus();\n\t}\n\n\tpublic insertColor() {\n\t\tthis._standaloneColorPickerWidget?.updateEditor();\n\t\tthis.hide();\n\t}\n\n\tpublic static get(editor: ICodeEditor) {\n\t\treturn editor.getContribution<StandaloneColorPickerController>(StandaloneColorPickerController.ID);\n\t}\n}\n\nregisterEditorContribution(StandaloneColorPickerController.ID, StandaloneColorPickerController, EditorContributionInstantiation.AfterFirstRender);\n\nconst PADDING = 8;\nconst CLOSE_BUTTON_WIDTH = 22;\n\nexport class StandaloneColorPickerWidget extends Disposable implements IContentWidget {\n\n\tstatic readonly ID = 'editor.contrib.standaloneColorPickerWidget';\n\treadonly allowEditorOverflow = true;\n\n\tprivate readonly _position: Position | undefined = undefined;\n\tprivate readonly _standaloneColorPickerParticipant: StandaloneColorPickerParticipant;\n\n\tprivate _body: HTMLElement = document.createElement('div');\n\tprivate _colorHover: StandaloneColorPickerHover | null = null;\n\tprivate _selectionSetInEditor: boolean = false;\n\n\tprivate readonly _onResult = this._register(new Emitter<StandaloneColorPickerResult>());\n\tpublic readonly onResult = this._onResult.event;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\tprivate readonly _standaloneColorPickerVisible: IContextKey<boolean>,\n\t\tprivate readonly _standaloneColorPickerFocused: IContextKey<boolean>,\n\t\t@IInstantiationService _instantiationService: IInstantiationService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t\t@ILanguageFeaturesService private readonly _languageFeaturesService: ILanguageFeaturesService,\n\t\t@ILanguageConfigurationService private readonly _languageConfigurationService: ILanguageConfigurationService\n\t) {\n\t\tsuper();\n\t\tthis._standaloneColorPickerVisible.set(true);\n\t\tthis._standaloneColorPickerParticipant = _instantiationService.createInstance(StandaloneColorPickerParticipant, this._editor);\n\t\tthis._position = this._editor._getViewModel()?.getPrimaryCursorState().modelState.position;\n\t\tconst editorSelection = this._editor.getSelection();\n\t\tconst selection = editorSelection ?\n\t\t\t{\n\t\t\t\tstartLineNumber: editorSelection.startLineNumber,\n\t\t\t\tstartColumn: editorSelection.startColumn,\n\t\t\t\tendLineNumber: editorSelection.endLineNumber,\n\t\t\t\tendColumn: editorSelection.endColumn\n\t\t\t} : { startLineNumber: 0, endLineNumber: 0, endColumn: 0, startColumn: 0 };\n\t\tconst focusTracker = this._register(dom.trackFocus(this._body));\n\t\tthis._register(focusTracker.onDidBlur(_ => {\n\t\t\tthis.hide();\n\t\t}));\n\t\tthis._register(focusTracker.onDidFocus(_ => {\n\t\t\tthis.focus();\n\t\t}));\n\t\t// When the cursor position changes, hide the color picker\n\t\tthis._register(this._editor.onDidChangeCursorPosition(() => {\n\t\t\t// Do not hide the color picker when the cursor changes position due to the keybindings\n\t\t\tif (!this._selectionSetInEditor) {\n\t\t\t\tthis.hide();\n\t\t\t} else {\n\t\t\t\tthis._selectionSetInEditor = false;\n\t\t\t}\n\t\t}));\n\t\tthis._register(this._editor.onMouseMove((e) => {\n\t\t\tconst classList = e.target.element?.classList;\n\t\t\tif (classList && classList.contains('colorpicker-color-decoration')) {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.onResult((result) => {\n\t\t\tthis._render(result.value, result.foundInEditor);\n\t\t}));\n\t\tthis._start(selection);\n\t\tthis._body.style.zIndex = '50';\n\t\tthis._editor.addContentWidget(this);\n\t}\n\n\tpublic updateEditor() {\n\t\tif (this._colorHover) {\n\t\t\tthis._standaloneColorPickerParticipant.updateEditorModel(this._colorHover);\n\t\t}\n\t}\n\n\tpublic getId(): string {\n\t\treturn StandaloneColorPickerWidget.ID;\n\t}\n\n\tpublic getDomNode(): HTMLElement {\n\t\treturn this._body;\n\t}\n\n\tpublic getPosition(): IContentWidgetPosition | null {\n\t\tif (!this._position) {\n\t\t\treturn null;\n\t\t}\n\t\tconst positionPreference = this._editor.getOption(EditorOption.hover).above;\n\t\treturn {\n\t\t\tposition: this._position,\n\t\t\tsecondaryPosition: this._position,\n\t\t\tpreference: positionPreference ? [ContentWidgetPositionPreference.ABOVE, ContentWidgetPositionPreference.BELOW] : [ContentWidgetPositionPreference.BELOW, ContentWidgetPositionPreference.ABOVE],\n\t\t\tpositionAffinity: PositionAffinity.None\n\t\t};\n\t}\n\n\tpublic hide(): void {\n\t\tthis.dispose();\n\t\tthis._standaloneColorPickerVisible.set(false);\n\t\tthis._standaloneColorPickerFocused.set(false);\n\t\tthis._editor.removeContentWidget(this);\n\t\tthis._editor.focus();\n\t}\n\n\tpublic focus(): void {\n\t\tthis._standaloneColorPickerFocused.set(true);\n\t\tthis._body.focus();\n\t}\n\n\tprivate async _start(selection: IRange) {\n\t\tconst computeAsyncResult = await this._computeAsync(selection);\n\t\tif (!computeAsyncResult) {\n\t\t\treturn;\n\t\t}\n\t\tthis._onResult.fire(new StandaloneColorPickerResult(computeAsyncResult.result, computeAsyncResult.foundInEditor));\n\t}\n\n\tprivate async _computeAsync(range: IRange): Promise<{ result: StandaloneColorPickerHover; foundInEditor: boolean } | null> {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn null;\n\t\t}\n\t\tconst colorInfo: IColorInformation = {\n\t\t\trange: range,\n\t\t\tcolor: { red: 0, green: 0, blue: 0, alpha: 1 }\n\t\t};\n\t\tconst colorHoverResult: { colorHover: StandaloneColorPickerHover; foundInEditor: boolean } | null = await this._standaloneColorPickerParticipant.createColorHover(colorInfo, new DefaultDocumentColorProvider(this._modelService, this._languageConfigurationService), this._languageFeaturesService.colorProvider);\n\t\tif (!colorHoverResult) {\n\t\t\treturn null;\n\t\t}\n\t\treturn { result: colorHoverResult.colorHover, foundInEditor: colorHoverResult.foundInEditor };\n\t}\n\n\tprivate _render(colorHover: StandaloneColorPickerHover, foundInEditor: boolean) {\n\t\tconst fragment = document.createDocumentFragment();\n\t\tconst statusBar = this._register(new EditorHoverStatusBar(this._keybindingService));\n\t\tlet colorPickerWidget: ColorPickerWidget | undefined;\n\n\t\tconst context: IEditorHoverRenderContext = {\n\t\t\tfragment,\n\t\t\tstatusBar,\n\t\t\tsetColorPicker: (widget: ColorPickerWidget) => colorPickerWidget = widget,\n\t\t\tonContentsChanged: () => { },\n\t\t\thide: () => this.hide()\n\t\t};\n\n\t\tthis._colorHover = colorHover;\n\t\tthis._register(this._standaloneColorPickerParticipant.renderHoverParts(context, [colorHover]));\n\t\tif (colorPickerWidget === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tthis._body.classList.add('standalone-colorpicker-body');\n\t\tthis._body.style.maxHeight = Math.max(this._editor.getLayoutInfo().height / 4, 250) + 'px';\n\t\tthis._body.style.maxWidth = Math.max(this._editor.getLayoutInfo().width * 0.66, 500) + 'px';\n\t\tthis._body.tabIndex = 0;\n\t\tthis._body.appendChild(fragment);\n\t\tcolorPickerWidget.layout();\n\n\t\tconst colorPickerBody = colorPickerWidget.body;\n\t\tconst saturationBoxWidth = colorPickerBody.saturationBox.domNode.clientWidth;\n\t\tconst widthOfOriginalColorBox = colorPickerBody.domNode.clientWidth - saturationBoxWidth - CLOSE_BUTTON_WIDTH - PADDING;\n\t\tconst enterButton: InsertButton | null = colorPickerWidget.body.enterButton;\n\t\tenterButton?.onClicked(() => {\n\t\t\tthis.updateEditor();\n\t\t\tthis.hide();\n\t\t});\n\t\tconst colorPickerHeader = colorPickerWidget.header;\n\t\tconst pickedColorNode = colorPickerHeader.pickedColorNode;\n\t\tpickedColorNode.style.width = saturationBoxWidth + PADDING + 'px';\n\t\tconst originalColorNode = colorPickerHeader.originalColorNode;\n\t\toriginalColorNode.style.width = widthOfOriginalColorBox + 'px';\n\t\tconst closeButton = colorPickerWidget.header.closeButton;\n\t\tcloseButton?.onClicked(() => {\n\t\t\tthis.hide();\n\t\t});\n\t\t// When found in the editor, highlight the selection in the editor\n\t\tif (foundInEditor) {\n\t\t\tif (enterButton) {\n\t\t\t\tenterButton.button.textContent = 'Replace';\n\t\t\t}\n\t\t\tthis._selectionSetInEditor = true;\n\t\t\tthis._editor.setSelection(colorHover.range);\n\t\t}\n\t\tthis._editor.layoutContentWidget(this);\n\t}\n}\n\nclass StandaloneColorPickerResult {\n\t// The color picker result consists of: an array of color results and a boolean indicating if the color was found in the editor\n\tconstructor(\n\t\tpublic readonly value: StandaloneColorPickerHover,\n\t\tpublic readonly foundInEditor: boolean\n\t) { }\n}\n"]}