{"version":3,"sources":["vs/editor/contrib/wordHighlighter/browser/wordHighlighter.ts"],"names":[],"mappings":"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","file":"wordHighlighter.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { alert } from 'vs/base/browser/ui/aria/aria';\nimport * as arrays from 'vs/base/common/arrays';\nimport { CancelablePromise, createCancelablePromise, first, timeout } from 'vs/base/common/async';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { onUnexpectedError, onUnexpectedExternalError } from 'vs/base/common/errors';\nimport { KeyCode, KeyMod } from 'vs/base/common/keyCodes';\nimport { Disposable, DisposableStore, IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { IActiveCodeEditor, ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { EditorAction, EditorContributionInstantiation, IActionOptions, registerEditorAction, registerEditorContribution, registerModelAndPositionCommand } from 'vs/editor/browser/editorExtensions';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { CursorChangeReason, ICursorPositionChangedEvent } from 'vs/editor/common/cursorEvents';\nimport { Position } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { IEditorContribution, IEditorDecorationsCollection } from 'vs/editor/common/editorCommon';\nimport { EditorContextKeys } from 'vs/editor/common/editorContextKeys';\nimport { IModelDeltaDecoration, ITextModel } from 'vs/editor/common/model';\nimport { DocumentHighlight, DocumentHighlightKind, DocumentHighlightProvider } from 'vs/editor/common/languages';\nimport * as nls from 'vs/nls';\nimport { IContextKey, IContextKeyService, RawContextKey } from 'vs/platform/contextkey/common/contextkey';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { KeybindingWeight } from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport { IWordAtPosition } from 'vs/editor/common/core/wordHelper';\nimport { LanguageFeatureRegistry } from 'vs/editor/common/languageFeatureRegistry';\nimport { ILanguageFeaturesService } from 'vs/editor/common/services/languageFeatures';\nimport { getHighlightDecorationOptions } from 'vs/editor/contrib/wordHighlighter/browser/highlightDecorations';\nimport { Iterable } from 'vs/base/common/iterator';\n\nconst ctxHasWordHighlights = new RawContextKey<boolean>('hasWordHighlights', false);\n\nexport function getOccurrencesAtPosition(registry: LanguageFeatureRegistry<DocumentHighlightProvider>, model: ITextModel, position: Position, token: CancellationToken): Promise<DocumentHighlight[] | null | undefined> {\n\n\tconst orderedByScore = registry.ordered(model);\n\n\t// in order of score ask the occurrences provider\n\t// until someone response with a good result\n\t// (good = none empty array)\n\treturn first<DocumentHighlight[] | null | undefined>(orderedByScore.map(provider => () => {\n\t\treturn Promise.resolve(provider.provideDocumentHighlights(model, position, token))\n\t\t\t.then(undefined, onUnexpectedExternalError);\n\t}), arrays.isNonEmptyArray);\n}\n\ninterface IOccurenceAtPositionRequest {\n\treadonly result: Promise<DocumentHighlight[]>;\n\tisValid(model: ITextModel, selection: Selection, decorations: IEditorDecorationsCollection): boolean;\n\tcancel(): void;\n}\n\nabstract class OccurenceAtPositionRequest implements IOccurenceAtPositionRequest {\n\n\tprivate readonly _wordRange: Range | null;\n\tprivate _result: CancelablePromise<DocumentHighlight[]> | null;\n\n\tconstructor(private readonly _model: ITextModel, private readonly _selection: Selection, private readonly _wordSeparators: string) {\n\t\tthis._wordRange = this._getCurrentWordRange(_model, _selection);\n\t\tthis._result = null;\n\t}\n\n\tget result() {\n\t\tif (!this._result) {\n\t\t\tthis._result = createCancelablePromise(token => this._compute(this._model, this._selection, this._wordSeparators, token));\n\t\t}\n\t\treturn this._result;\n\n\t}\n\n\tprotected abstract _compute(model: ITextModel, selection: Selection, wordSeparators: string, token: CancellationToken): Promise<DocumentHighlight[]>;\n\n\tprivate _getCurrentWordRange(model: ITextModel, selection: Selection): Range | null {\n\t\tconst word = model.getWordAtPosition(selection.getPosition());\n\t\tif (word) {\n\t\t\treturn new Range(selection.startLineNumber, word.startColumn, selection.startLineNumber, word.endColumn);\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic isValid(model: ITextModel, selection: Selection, decorations: IEditorDecorationsCollection): boolean {\n\n\t\tconst lineNumber = selection.startLineNumber;\n\t\tconst startColumn = selection.startColumn;\n\t\tconst endColumn = selection.endColumn;\n\t\tconst currentWordRange = this._getCurrentWordRange(model, selection);\n\n\t\tlet requestIsValid = Boolean(this._wordRange && this._wordRange.equalsRange(currentWordRange));\n\n\t\t// Even if we are on a different word, if that word is in the decorations ranges, the request is still valid\n\t\t// (Same symbol)\n\t\tfor (let i = 0, len = decorations.length; !requestIsValid && i < len; i++) {\n\t\t\tconst range = decorations.getRange(i);\n\t\t\tif (range && range.startLineNumber === lineNumber) {\n\t\t\t\tif (range.startColumn <= startColumn && range.endColumn >= endColumn) {\n\t\t\t\t\trequestIsValid = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn requestIsValid;\n\t}\n\n\tpublic cancel(): void {\n\t\tthis.result.cancel();\n\t}\n}\n\nclass SemanticOccurenceAtPositionRequest extends OccurenceAtPositionRequest {\n\n\tprivate readonly _providers: LanguageFeatureRegistry<DocumentHighlightProvider>;\n\n\tconstructor(model: ITextModel, selection: Selection, wordSeparators: string, providers: LanguageFeatureRegistry<DocumentHighlightProvider>) {\n\t\tsuper(model, selection, wordSeparators);\n\t\tthis._providers = providers;\n\t}\n\n\tprotected _compute(model: ITextModel, selection: Selection, wordSeparators: string, token: CancellationToken): Promise<DocumentHighlight[]> {\n\t\treturn getOccurrencesAtPosition(this._providers, model, selection.getPosition(), token).then(value => value || []);\n\t}\n}\n\nclass TextualOccurenceAtPositionRequest extends OccurenceAtPositionRequest {\n\n\tprivate readonly _selectionIsEmpty: boolean;\n\n\tconstructor(model: ITextModel, selection: Selection, wordSeparators: string) {\n\t\tsuper(model, selection, wordSeparators);\n\t\tthis._selectionIsEmpty = selection.isEmpty();\n\t}\n\n\tprotected _compute(model: ITextModel, selection: Selection, wordSeparators: string, token: CancellationToken): Promise<DocumentHighlight[]> {\n\t\treturn timeout(250, token).then(() => {\n\t\t\tif (!selection.isEmpty()) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst word = model.getWordAtPosition(selection.getPosition());\n\n\t\t\tif (!word || word.word.length > 1000) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tconst matches = model.findMatches(word.word, true, false, true, wordSeparators, false);\n\t\t\treturn matches.map(m => {\n\t\t\t\treturn {\n\t\t\t\t\trange: m.range,\n\t\t\t\t\tkind: DocumentHighlightKind.Text\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic override isValid(model: ITextModel, selection: Selection, decorations: IEditorDecorationsCollection): boolean {\n\t\tconst currentSelectionIsEmpty = selection.isEmpty();\n\t\tif (this._selectionIsEmpty !== currentSelectionIsEmpty) {\n\t\t\treturn false;\n\t\t}\n\t\treturn super.isValid(model, selection, decorations);\n\t}\n}\n\nfunction computeOccurencesAtPosition(registry: LanguageFeatureRegistry<DocumentHighlightProvider>, model: ITextModel, selection: Selection, wordSeparators: string): IOccurenceAtPositionRequest {\n\tif (registry.has(model)) {\n\t\treturn new SemanticOccurenceAtPositionRequest(model, selection, wordSeparators, registry);\n\t}\n\treturn new TextualOccurenceAtPositionRequest(model, selection, wordSeparators);\n}\n\nregisterModelAndPositionCommand('_executeDocumentHighlights', (accessor, model, position) => {\n\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\treturn getOccurrencesAtPosition(languageFeaturesService.documentHighlightProvider, model, position, CancellationToken.None);\n});\n\nclass WordHighlighter {\n\n\tprivate readonly editor: IActiveCodeEditor;\n\tprivate readonly providers: LanguageFeatureRegistry<DocumentHighlightProvider>;\n\tprivate occurrencesHighlight: boolean;\n\tprivate readonly model: ITextModel;\n\tprivate readonly decorations: IEditorDecorationsCollection;\n\tprivate readonly toUnhook = new DisposableStore();\n\n\tprivate workerRequestTokenId: number = 0;\n\tprivate workerRequest: IOccurenceAtPositionRequest | null;\n\tprivate workerRequestCompleted: boolean = false;\n\tprivate workerRequestValue: DocumentHighlight[] = [];\n\n\tprivate lastCursorPositionChangeTime: number = 0;\n\tprivate renderDecorationsTimer: any = -1;\n\n\tprivate readonly _hasWordHighlights: IContextKey<boolean>;\n\tprivate _ignorePositionChangeEvent: boolean;\n\n\tprivate readonly linkedHighlighters: () => Iterable<WordHighlighter | null>;\n\n\tconstructor(editor: IActiveCodeEditor, providers: LanguageFeatureRegistry<DocumentHighlightProvider>, linkedHighlighters: () => Iterable<WordHighlighter | null>, contextKeyService: IContextKeyService) {\n\t\tthis.editor = editor;\n\t\tthis.providers = providers;\n\t\tthis.linkedHighlighters = linkedHighlighters;\n\t\tthis._hasWordHighlights = ctxHasWordHighlights.bindTo(contextKeyService);\n\t\tthis._ignorePositionChangeEvent = false;\n\t\tthis.occurrencesHighlight = this.editor.getOption(EditorOption.occurrencesHighlight);\n\t\tthis.model = this.editor.getModel();\n\t\tthis.toUnhook.add(editor.onDidChangeCursorPosition((e: ICursorPositionChangedEvent) => {\n\n\t\t\tif (this._ignorePositionChangeEvent) {\n\t\t\t\t// We are changing the position => ignore this event\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.occurrencesHighlight) {\n\t\t\t\t// Early exit if nothing needs to be done!\n\t\t\t\t// Leave some form of early exit check here if you wish to continue being a cursor position change listener ;)\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._onPositionChanged(e);\n\t\t}));\n\t\tthis.toUnhook.add(editor.onDidChangeModelContent((e) => {\n\t\t\tthis._stopAll();\n\t\t}));\n\t\tthis.toUnhook.add(editor.onDidChangeConfiguration((e) => {\n\t\t\tconst newValue = this.editor.getOption(EditorOption.occurrencesHighlight);\n\t\t\tif (this.occurrencesHighlight !== newValue) {\n\t\t\t\tthis.occurrencesHighlight = newValue;\n\t\t\t\tthis._stopAll();\n\t\t\t}\n\t\t}));\n\n\t\tthis.decorations = this.editor.createDecorationsCollection();\n\t\tthis.workerRequestTokenId = 0;\n\t\tthis.workerRequest = null;\n\t\tthis.workerRequestCompleted = false;\n\n\t\tthis.lastCursorPositionChangeTime = 0;\n\t\tthis.renderDecorationsTimer = -1;\n\t}\n\n\tpublic hasDecorations(): boolean {\n\t\treturn (this.decorations.length > 0);\n\t}\n\n\tpublic restore(): void {\n\t\tif (!this.occurrencesHighlight) {\n\t\t\treturn;\n\t\t}\n\t\tthis._run();\n\t}\n\n\tpublic stop(): void {\n\t\tif (!this.occurrencesHighlight) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stopAll();\n\t}\n\n\tprivate _getSortedHighlights(): Range[] {\n\t\treturn (\n\t\t\tthis.decorations.getRanges()\n\t\t\t\t.sort(Range.compareRangesUsingStarts)\n\t\t);\n\t}\n\n\tpublic moveNext() {\n\t\tconst highlights = this._getSortedHighlights();\n\t\tconst index = highlights.findIndex((range) => range.containsPosition(this.editor.getPosition()));\n\t\tconst newIndex = ((index + 1) % highlights.length);\n\t\tconst dest = highlights[newIndex];\n\t\ttry {\n\t\t\tthis._ignorePositionChangeEvent = true;\n\t\t\tthis.editor.setPosition(dest.getStartPosition());\n\t\t\tthis.editor.revealRangeInCenterIfOutsideViewport(dest);\n\t\t\tconst word = this._getWord();\n\t\t\tif (word) {\n\t\t\t\tconst lineContent = this.editor.getModel().getLineContent(dest.startLineNumber);\n\t\t\t\talert(`${lineContent}, ${newIndex + 1} of ${highlights.length} for '${word.word}'`);\n\t\t\t}\n\t\t} finally {\n\t\t\tthis._ignorePositionChangeEvent = false;\n\t\t}\n\t}\n\n\tpublic moveBack() {\n\t\tconst highlights = this._getSortedHighlights();\n\t\tconst index = highlights.findIndex((range) => range.containsPosition(this.editor.getPosition()));\n\t\tconst newIndex = ((index - 1 + highlights.length) % highlights.length);\n\t\tconst dest = highlights[newIndex];\n\t\ttry {\n\t\t\tthis._ignorePositionChangeEvent = true;\n\t\t\tthis.editor.setPosition(dest.getStartPosition());\n\t\t\tthis.editor.revealRangeInCenterIfOutsideViewport(dest);\n\t\t\tconst word = this._getWord();\n\t\t\tif (word) {\n\t\t\t\tconst lineContent = this.editor.getModel().getLineContent(dest.startLineNumber);\n\t\t\t\talert(`${lineContent}, ${newIndex + 1} of ${highlights.length} for '${word.word}'`);\n\t\t\t}\n\t\t} finally {\n\t\t\tthis._ignorePositionChangeEvent = false;\n\t\t}\n\t}\n\n\tprivate _removeDecorations(): void {\n\t\tif (this.decorations.length > 0) {\n\t\t\t// remove decorations\n\t\t\tthis.decorations.clear();\n\t\t\tthis._hasWordHighlights.set(false);\n\t\t}\n\t}\n\n\tprivate _stopAll(): void {\n\t\t// Remove any existing decorations\n\t\tthis._removeDecorations();\n\n\t\t// Cancel any renderDecorationsTimer\n\t\tif (this.renderDecorationsTimer !== -1) {\n\t\t\tclearTimeout(this.renderDecorationsTimer);\n\t\t\tthis.renderDecorationsTimer = -1;\n\t\t}\n\n\t\t// Cancel any worker request\n\t\tif (this.workerRequest !== null) {\n\t\t\tthis.workerRequest.cancel();\n\t\t\tthis.workerRequest = null;\n\t\t}\n\n\t\t// Invalidate any worker request callback\n\t\tif (!this.workerRequestCompleted) {\n\t\t\tthis.workerRequestTokenId++;\n\t\t\tthis.workerRequestCompleted = true;\n\t\t}\n\t}\n\n\tprivate _onPositionChanged(e: ICursorPositionChangedEvent): void {\n\n\t\t// disabled\n\t\tif (!this.occurrencesHighlight) {\n\t\t\tthis._stopAll();\n\t\t\treturn;\n\t\t}\n\n\t\t// ignore typing & other\n\t\tif (e.reason !== CursorChangeReason.Explicit) {\n\t\t\tthis._stopAll();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._run();\n\t}\n\n\tprivate _getWord(): IWordAtPosition | null {\n\t\tconst editorSelection = this.editor.getSelection();\n\t\tconst lineNumber = editorSelection.startLineNumber;\n\t\tconst startColumn = editorSelection.startColumn;\n\n\t\treturn this.model.getWordAtPosition({\n\t\t\tlineNumber: lineNumber,\n\t\t\tcolumn: startColumn\n\t\t});\n\t}\n\n\tprivate _run(): void {\n\t\tconst editorSelection = this.editor.getSelection();\n\n\t\t// ignore multiline selection\n\t\tif (editorSelection.startLineNumber !== editorSelection.endLineNumber) {\n\t\t\tthis._stopAll();\n\t\t\treturn;\n\t\t}\n\n\t\tconst startColumn = editorSelection.startColumn;\n\t\tconst endColumn = editorSelection.endColumn;\n\n\t\tconst word = this._getWord();\n\n\t\t// The selection must be inside a word or surround one word at most\n\t\tif (!word || word.startColumn > startColumn || word.endColumn < endColumn) {\n\t\t\tthis._stopAll();\n\t\t\treturn;\n\t\t}\n\n\t\t// All the effort below is trying to achieve this:\n\t\t// - when cursor is moved to a word, trigger immediately a findOccurrences request\n\t\t// - 250ms later after the last cursor move event, render the occurrences\n\t\t// - no flickering!\n\n\t\tconst workerRequestIsValid = (this.workerRequest && this.workerRequest.isValid(this.model, editorSelection, this.decorations));\n\n\t\t// There are 4 cases:\n\t\t// a) old workerRequest is valid & completed, renderDecorationsTimer fired\n\t\t// b) old workerRequest is valid & completed, renderDecorationsTimer not fired\n\t\t// c) old workerRequest is valid, but not completed\n\t\t// d) old workerRequest is not valid\n\n\t\t// For a) no action is needed\n\t\t// For c), member 'lastCursorPositionChangeTime' will be used when installing the timer so no action is needed\n\n\t\tthis.lastCursorPositionChangeTime = (new Date()).getTime();\n\n\t\tif (workerRequestIsValid) {\n\t\t\tif (this.workerRequestCompleted && this.renderDecorationsTimer !== -1) {\n\t\t\t\t// case b)\n\t\t\t\t// Delay the firing of renderDecorationsTimer by an extra 250 ms\n\t\t\t\tclearTimeout(this.renderDecorationsTimer);\n\t\t\t\tthis.renderDecorationsTimer = -1;\n\t\t\t\tthis._beginRenderDecorations();\n\t\t\t}\n\t\t} else {\n\t\t\t// case d)\n\t\t\t// Stop all previous actions and start fresh\n\t\t\tthis._stopAll();\n\n\t\t\tconst myRequestId = ++this.workerRequestTokenId;\n\t\t\tthis.workerRequestCompleted = false;\n\n\t\t\tthis.workerRequest = computeOccurencesAtPosition(this.providers, this.model, this.editor.getSelection(), this.editor.getOption(EditorOption.wordSeparators));\n\n\t\t\tthis.workerRequest.result.then(data => {\n\t\t\t\tif (myRequestId === this.workerRequestTokenId) {\n\t\t\t\t\tthis.workerRequestCompleted = true;\n\t\t\t\t\tthis.workerRequestValue = data || [];\n\t\t\t\t\tthis._beginRenderDecorations();\n\t\t\t\t}\n\t\t\t}, onUnexpectedError);\n\t\t}\n\t}\n\n\tprivate _beginRenderDecorations(): void {\n\t\tconst currentTime = (new Date()).getTime();\n\t\tconst minimumRenderTime = this.lastCursorPositionChangeTime + 250;\n\n\t\tif (currentTime >= minimumRenderTime) {\n\t\t\t// Synchronous\n\t\t\tthis.renderDecorationsTimer = -1;\n\t\t\tthis.renderDecorations();\n\t\t} else {\n\t\t\t// Asynchronous\n\t\t\tthis.renderDecorationsTimer = setTimeout(() => {\n\t\t\t\tthis.renderDecorations();\n\t\t\t}, (minimumRenderTime - currentTime));\n\t\t}\n\t}\n\n\tprivate renderDecorations(): void {\n\t\tthis.renderDecorationsTimer = -1;\n\t\tconst decorations: IModelDeltaDecoration[] = [];\n\t\tfor (const info of this.workerRequestValue) {\n\t\t\tif (info.range) {\n\t\t\t\tdecorations.push({\n\t\t\t\t\trange: info.range,\n\t\t\t\t\toptions: getHighlightDecorationOptions(info.kind)\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.decorations.set(decorations);\n\t\tthis._hasWordHighlights.set(this.hasDecorations());\n\n\t\t// update decorators of friends\n\t\tfor (const other of this.linkedHighlighters()) {\n\t\t\tif (other?.editor.getModel() === this.editor.getModel()) {\n\t\t\t\tother._stopAll();\n\t\t\t\tother.decorations.set(decorations);\n\t\t\t\tother._hasWordHighlights.set(other.hasDecorations());\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._stopAll();\n\t\tthis.toUnhook.dispose();\n\t}\n}\n\nexport class WordHighlighterContribution extends Disposable implements IEditorContribution {\n\n\tpublic static readonly ID = 'editor.contrib.wordHighlighter';\n\n\tpublic static get(editor: ICodeEditor): WordHighlighterContribution | null {\n\t\treturn editor.getContribution<WordHighlighterContribution>(WordHighlighterContribution.ID);\n\t}\n\n\tprivate wordHighlighter: WordHighlighter | null;\n\tprivate linkedContributions: Set<WordHighlighterContribution>;\n\n\tconstructor(editor: ICodeEditor, @IContextKeyService contextKeyService: IContextKeyService, @ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService) {\n\t\tsuper();\n\t\tthis.wordHighlighter = null;\n\t\tthis.linkedContributions = new Set();\n\t\tconst createWordHighlighterIfPossible = () => {\n\t\t\tif (editor.hasModel() && !editor.getModel().isTooLargeForTokenization()) {\n\t\t\t\tthis.wordHighlighter = new WordHighlighter(editor, languageFeaturesService.documentHighlightProvider, () => Iterable.map(this.linkedContributions, c => c.wordHighlighter), contextKeyService);\n\t\t\t}\n\t\t};\n\t\tthis._register(editor.onDidChangeModel((e) => {\n\t\t\tif (this.wordHighlighter) {\n\t\t\t\tthis.wordHighlighter.dispose();\n\t\t\t\tthis.wordHighlighter = null;\n\t\t\t}\n\t\t\tcreateWordHighlighterIfPossible();\n\t\t}));\n\t\tcreateWordHighlighterIfPossible();\n\t}\n\n\tpublic saveViewState(): boolean {\n\t\tif (this.wordHighlighter && this.wordHighlighter.hasDecorations()) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic moveNext() {\n\t\tthis.wordHighlighter?.moveNext();\n\t}\n\n\tpublic moveBack() {\n\t\tthis.wordHighlighter?.moveBack();\n\t}\n\n\tpublic restoreViewState(state: boolean | undefined): void {\n\t\tif (this.wordHighlighter && state) {\n\t\t\tthis.wordHighlighter.restore();\n\t\t}\n\t}\n\n\tpublic stopHighlighting() {\n\t\tthis.wordHighlighter?.stop();\n\t}\n\n\tpublic linkWordHighlighters(editor: ICodeEditor): IDisposable {\n\t\tconst other = WordHighlighterContribution.get(editor);\n\t\tif (!other) {\n\t\t\treturn Disposable.None;\n\t\t}\n\t\tthis.linkedContributions.add(other);\n\t\tother.linkedContributions.add(this);\n\t\treturn toDisposable(() => {\n\t\t\tthis.linkedContributions.delete(other);\n\t\t\tother.linkedContributions.delete(this);\n\t\t});\n\t}\n\n\tpublic override dispose(): void {\n\t\tif (this.wordHighlighter) {\n\t\t\tthis.wordHighlighter.dispose();\n\t\t\tthis.wordHighlighter = null;\n\t\t}\n\t\tsuper.dispose();\n\t}\n}\n\n\nclass WordHighlightNavigationAction extends EditorAction {\n\n\tprivate readonly _isNext: boolean;\n\n\tconstructor(next: boolean, opts: IActionOptions) {\n\t\tsuper(opts);\n\t\tthis._isNext = next;\n\t}\n\n\tpublic run(accessor: ServicesAccessor, editor: ICodeEditor): void {\n\t\tconst controller = WordHighlighterContribution.get(editor);\n\t\tif (!controller) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._isNext) {\n\t\t\tcontroller.moveNext();\n\t\t} else {\n\t\t\tcontroller.moveBack();\n\t\t}\n\t}\n}\n\nclass NextWordHighlightAction extends WordHighlightNavigationAction {\n\tconstructor() {\n\t\tsuper(true, {\n\t\t\tid: 'editor.action.wordHighlight.next',\n\t\t\tlabel: nls.localize('wordHighlight.next.label', \"Go to Next Symbol Highlight\"),\n\t\t\talias: 'Go to Next Symbol Highlight',\n\t\t\tprecondition: ctxHasWordHighlights,\n\t\t\tkbOpts: {\n\t\t\t\tkbExpr: EditorContextKeys.editorTextFocus,\n\t\t\t\tprimary: KeyCode.F7,\n\t\t\t\tweight: KeybindingWeight.EditorContrib\n\t\t\t}\n\t\t});\n\t}\n}\n\nclass PrevWordHighlightAction extends WordHighlightNavigationAction {\n\tconstructor() {\n\t\tsuper(false, {\n\t\t\tid: 'editor.action.wordHighlight.prev',\n\t\t\tlabel: nls.localize('wordHighlight.previous.label', \"Go to Previous Symbol Highlight\"),\n\t\t\talias: 'Go to Previous Symbol Highlight',\n\t\t\tprecondition: ctxHasWordHighlights,\n\t\t\tkbOpts: {\n\t\t\t\tkbExpr: EditorContextKeys.editorTextFocus,\n\t\t\t\tprimary: KeyMod.Shift | KeyCode.F7,\n\t\t\t\tweight: KeybindingWeight.EditorContrib\n\t\t\t}\n\t\t});\n\t}\n}\n\nclass TriggerWordHighlightAction extends EditorAction {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.action.wordHighlight.trigger',\n\t\t\tlabel: nls.localize('wordHighlight.trigger.label', \"Trigger Symbol Highlight\"),\n\t\t\talias: 'Trigger Symbol Highlight',\n\t\t\tprecondition: ctxHasWordHighlights.toNegated(),\n\t\t\tkbOpts: {\n\t\t\t\tkbExpr: EditorContextKeys.editorTextFocus,\n\t\t\t\tprimary: 0,\n\t\t\t\tweight: KeybindingWeight.EditorContrib\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic run(accessor: ServicesAccessor, editor: ICodeEditor, args: any): void {\n\t\tconst controller = WordHighlighterContribution.get(editor);\n\t\tif (!controller) {\n\t\t\treturn;\n\t\t}\n\n\t\tcontroller.restoreViewState(true);\n\t}\n}\n\nregisterEditorContribution(WordHighlighterContribution.ID, WordHighlighterContribution, EditorContributionInstantiation.Eager); // eager because it uses `saveViewState`/`restoreViewState`\nregisterEditorAction(NextWordHighlightAction);\nregisterEditorAction(PrevWordHighlightAction);\nregisterEditorAction(TriggerWordHighlightAction);\n"]}