{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/contrib/codelens/browser/codelensWidget.ts"],"names":[],"mappings":"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","file":"codelensWidget.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from 'vs/base/browser/dom';\nimport { renderLabelWithIcons } from 'vs/base/browser/ui/iconLabel/iconLabels';\nimport { Constants } from 'vs/base/common/uint';\nimport 'vs/css!./codelensWidget';\nimport { ContentWidgetPositionPreference, IActiveCodeEditor, IContentWidget, IContentWidgetPosition, IViewZone, IViewZoneChangeAccessor } from 'vs/editor/browser/editorBrowser';\nimport { Range } from 'vs/editor/common/core/range';\nimport { IModelDecorationsChangeAccessor, IModelDeltaDecoration, ITextModel } from 'vs/editor/common/model';\nimport { ModelDecorationOptions } from 'vs/editor/common/model/textModel';\nimport { CodeLens, Command } from 'vs/editor/common/languages';\nimport { CodeLensItem } from 'vs/editor/contrib/codelens/browser/codelens';\n\nclass CodeLensViewZone implements IViewZone {\n\n\treadonly suppressMouseDown: boolean;\n\treadonly domNode: HTMLElement;\n\n\tafterLineNumber: number;\n\t/**\n\t * We want that this view zone, which reserves space for a code lens appears\n\t * as close as possible to the next line, so we use a very large value here.\n\t */\n\treadonly afterColumn = Constants.MAX_SAFE_SMALL_INTEGER;\n\theightInPx: number;\n\n\tprivate _lastHeight?: number;\n\tprivate readonly _onHeight: () => void;\n\n\tconstructor(afterLineNumber: number, heightInPx: number, onHeight: () => void) {\n\t\tthis.afterLineNumber = afterLineNumber;\n\t\tthis.heightInPx = heightInPx;\n\n\t\tthis._onHeight = onHeight;\n\t\tthis.suppressMouseDown = true;\n\t\tthis.domNode = document.createElement('div');\n\t}\n\n\tonComputedHeight(height: number): void {\n\t\tif (this._lastHeight === undefined) {\n\t\t\tthis._lastHeight = height;\n\t\t} else if (this._lastHeight !== height) {\n\t\t\tthis._lastHeight = height;\n\t\t\tthis._onHeight();\n\t\t}\n\t}\n\n\tisVisible(): boolean {\n\t\treturn this._lastHeight !== 0\n\t\t\t&& this.domNode.hasAttribute('monaco-visible-view-zone');\n\t}\n}\n\nclass CodeLensContentWidget implements IContentWidget {\n\n\tprivate static _idPool: number = 0;\n\n\t// Editor.IContentWidget.allowEditorOverflow\n\treadonly allowEditorOverflow: boolean = false;\n\treadonly suppressMouseDown: boolean = true;\n\n\tprivate readonly _id: string;\n\tprivate readonly _domNode: HTMLElement;\n\tprivate readonly _editor: IActiveCodeEditor;\n\tprivate readonly _commands = new Map<string, Command>();\n\n\tprivate _widgetPosition?: IContentWidgetPosition;\n\tprivate _isEmpty: boolean = true;\n\n\tconstructor(\n\t\teditor: IActiveCodeEditor,\n\t\tline: number,\n\t) {\n\t\tthis._editor = editor;\n\t\tthis._id = `codelens.widget-${(CodeLensContentWidget._idPool++)}`;\n\n\t\tthis.updatePosition(line);\n\n\t\tthis._domNode = document.createElement('span');\n\t\tthis._domNode.className = `codelens-decoration`;\n\t}\n\n\twithCommands(lenses: Array<CodeLens | undefined | null>, animate: boolean): void {\n\t\tthis._commands.clear();\n\n\t\tconst children: HTMLElement[] = [];\n\t\tlet hasSymbol = false;\n\t\tfor (let i = 0; i < lenses.length; i++) {\n\t\t\tconst lens = lenses[i];\n\t\t\tif (!lens) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\thasSymbol = true;\n\t\t\tif (lens.command) {\n\t\t\t\tconst title = renderLabelWithIcons(lens.command.title.trim());\n\t\t\t\tif (lens.command.id) {\n\t\t\t\t\tchildren.push(dom.$('a', { id: String(i), title: lens.command.tooltip, role: 'button' }, ...title));\n\t\t\t\t\tthis._commands.set(String(i), lens.command);\n\t\t\t\t} else {\n\t\t\t\t\tchildren.push(dom.$('span', { title: lens.command.tooltip }, ...title));\n\t\t\t\t}\n\t\t\t\tif (i + 1 < lenses.length) {\n\t\t\t\t\tchildren.push(dom.$('span', undefined, '\\u00a0|\\u00a0'));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!hasSymbol) {\n\t\t\t// symbols but no commands\n\t\t\tdom.reset(this._domNode, dom.$('span', undefined, 'no commands'));\n\n\t\t} else {\n\t\t\t// symbols and commands\n\t\t\tdom.reset(this._domNode, ...children);\n\t\t\tif (this._isEmpty && animate) {\n\t\t\t\tthis._domNode.classList.add('fadein');\n\t\t\t}\n\t\t\tthis._isEmpty = false;\n\t\t}\n\t}\n\n\tgetCommand(link: HTMLLinkElement): Command | undefined {\n\t\treturn link.parentElement === this._domNode\n\t\t\t? this._commands.get(link.id)\n\t\t\t: undefined;\n\t}\n\n\tgetId(): string {\n\t\treturn this._id;\n\t}\n\n\tgetDomNode(): HTMLElement {\n\t\treturn this._domNode;\n\t}\n\n\tupdatePosition(line: number): void {\n\t\tconst column = this._editor.getModel().getLineFirstNonWhitespaceColumn(line);\n\t\tthis._widgetPosition = {\n\t\t\tposition: { lineNumber: line, column: column },\n\t\t\tpreference: [ContentWidgetPositionPreference.ABOVE]\n\t\t};\n\t}\n\n\tgetPosition(): IContentWidgetPosition | null {\n\t\treturn this._widgetPosition || null;\n\t}\n}\n\nexport interface IDecorationIdCallback {\n\t(decorationId: string): void;\n}\n\nexport class CodeLensHelper {\n\n\tprivate readonly _removeDecorations: string[];\n\tprivate readonly _addDecorations: IModelDeltaDecoration[];\n\tprivate readonly _addDecorationsCallbacks: IDecorationIdCallback[];\n\n\tconstructor() {\n\t\tthis._removeDecorations = [];\n\t\tthis._addDecorations = [];\n\t\tthis._addDecorationsCallbacks = [];\n\t}\n\n\taddDecoration(decoration: IModelDeltaDecoration, callback: IDecorationIdCallback): void {\n\t\tthis._addDecorations.push(decoration);\n\t\tthis._addDecorationsCallbacks.push(callback);\n\t}\n\n\tremoveDecoration(decorationId: string): void {\n\t\tthis._removeDecorations.push(decorationId);\n\t}\n\n\tcommit(changeAccessor: IModelDecorationsChangeAccessor): void {\n\t\tconst resultingDecorations = changeAccessor.deltaDecorations(this._removeDecorations, this._addDecorations);\n\t\tfor (let i = 0, len = resultingDecorations.length; i < len; i++) {\n\t\t\tthis._addDecorationsCallbacks[i](resultingDecorations[i]);\n\t\t}\n\t}\n}\n\nconst codeLensDecorationOptions = ModelDecorationOptions.register({\n\tcollapseOnReplaceEdit: true,\n\tdescription: 'codelens'\n});\n\nexport class CodeLensWidget {\n\n\tprivate readonly _editor: IActiveCodeEditor;\n\tprivate readonly _viewZone: CodeLensViewZone;\n\tprivate readonly _viewZoneId: string;\n\n\tprivate _contentWidget?: CodeLensContentWidget;\n\tprivate _decorationIds: string[];\n\tprivate _data: CodeLensItem[];\n\tprivate _isDisposed: boolean = false;\n\n\tconstructor(\n\t\tdata: CodeLensItem[],\n\t\teditor: IActiveCodeEditor,\n\t\thelper: CodeLensHelper,\n\t\tviewZoneChangeAccessor: IViewZoneChangeAccessor,\n\t\theightInPx: number,\n\t\tupdateCallback: () => void\n\t) {\n\t\tthis._editor = editor;\n\t\tthis._data = data;\n\n\t\t// create combined range, track all ranges with decorations,\n\t\t// check if there is already something to render\n\t\tthis._decorationIds = [];\n\t\tlet range: Range | undefined;\n\t\tconst lenses: CodeLens[] = [];\n\n\t\tthis._data.forEach((codeLensData, i) => {\n\n\t\t\tif (codeLensData.symbol.command) {\n\t\t\t\tlenses.push(codeLensData.symbol);\n\t\t\t}\n\n\t\t\thelper.addDecoration({\n\t\t\t\trange: codeLensData.symbol.range,\n\t\t\t\toptions: codeLensDecorationOptions\n\t\t\t}, id => this._decorationIds[i] = id);\n\n\t\t\t// the range contains all lenses on this line\n\t\t\tif (!range) {\n\t\t\t\trange = Range.lift(codeLensData.symbol.range);\n\t\t\t} else {\n\t\t\t\trange = Range.plusRange(range, codeLensData.symbol.range);\n\t\t\t}\n\t\t});\n\n\t\tthis._viewZone = new CodeLensViewZone(range!.startLineNumber - 1, heightInPx, updateCallback);\n\t\tthis._viewZoneId = viewZoneChangeAccessor.addZone(this._viewZone);\n\n\t\tif (lenses.length > 0) {\n\t\t\tthis._createContentWidgetIfNecessary();\n\t\t\tthis._contentWidget!.withCommands(lenses, false);\n\t\t}\n\t}\n\n\tprivate _createContentWidgetIfNecessary(): void {\n\t\tif (!this._contentWidget) {\n\t\t\tthis._contentWidget = new CodeLensContentWidget(this._editor, this._viewZone.afterLineNumber + 1);\n\t\t\tthis._editor.addContentWidget(this._contentWidget);\n\t\t} else {\n\t\t\tthis._editor.layoutContentWidget(this._contentWidget);\n\t\t}\n\t}\n\n\tdispose(helper: CodeLensHelper, viewZoneChangeAccessor?: IViewZoneChangeAccessor): void {\n\t\tthis._decorationIds.forEach(helper.removeDecoration, helper);\n\t\tthis._decorationIds = [];\n\t\tviewZoneChangeAccessor?.removeZone(this._viewZoneId);\n\t\tif (this._contentWidget) {\n\t\t\tthis._editor.removeContentWidget(this._contentWidget);\n\t\t\tthis._contentWidget = undefined;\n\t\t}\n\t\tthis._isDisposed = true;\n\t}\n\n\tisDisposed(): boolean {\n\t\treturn this._isDisposed;\n\t}\n\n\tisValid(): boolean {\n\t\treturn this._decorationIds.some((id, i) => {\n\t\t\tconst range = this._editor.getModel().getDecorationRange(id);\n\t\t\tconst symbol = this._data[i].symbol;\n\t\t\treturn !!(range && Range.isEmpty(symbol.range) === range.isEmpty());\n\t\t});\n\t}\n\n\tupdateCodeLensSymbols(data: CodeLensItem[], helper: CodeLensHelper): void {\n\t\tthis._decorationIds.forEach(helper.removeDecoration, helper);\n\t\tthis._decorationIds = [];\n\t\tthis._data = data;\n\t\tthis._data.forEach((codeLensData, i) => {\n\t\t\thelper.addDecoration({\n\t\t\t\trange: codeLensData.symbol.range,\n\t\t\t\toptions: codeLensDecorationOptions\n\t\t\t}, id => this._decorationIds[i] = id);\n\t\t});\n\t}\n\n\tupdateHeight(height: number, viewZoneChangeAccessor: IViewZoneChangeAccessor): void {\n\t\tthis._viewZone.heightInPx = height;\n\t\tviewZoneChangeAccessor.layoutZone(this._viewZoneId);\n\t\tif (this._contentWidget) {\n\t\t\tthis._editor.layoutContentWidget(this._contentWidget);\n\t\t}\n\t}\n\n\tcomputeIfNecessary(model: ITextModel): CodeLensItem[] | null {\n\t\tif (!this._viewZone.isVisible()) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Read editor current state\n\t\tfor (let i = 0; i < this._decorationIds.length; i++) {\n\t\t\tconst range = model.getDecorationRange(this._decorationIds[i]);\n\t\t\tif (range) {\n\t\t\t\tthis._data[i].symbol.range = range;\n\t\t\t}\n\t\t}\n\t\treturn this._data;\n\t}\n\n\tupdateCommands(symbols: Array<CodeLens | undefined | null>): void {\n\n\t\tthis._createContentWidgetIfNecessary();\n\t\tthis._contentWidget!.withCommands(symbols, true);\n\n\t\tfor (let i = 0; i < this._data.length; i++) {\n\t\t\tconst resolved = symbols[i];\n\t\t\tif (resolved) {\n\t\t\t\tconst { symbol } = this._data[i];\n\t\t\t\tsymbol.command = resolved.command || symbol.command;\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCommand(link: HTMLLinkElement): Command | undefined {\n\t\treturn this._contentWidget?.getCommand(link);\n\t}\n\n\tgetLineNumber(): number {\n\t\tconst range = this._editor.getModel().getDecorationRange(this._decorationIds[0]);\n\t\tif (range) {\n\t\t\treturn range.startLineNumber;\n\t\t}\n\t\treturn -1;\n\t}\n\n\tupdate(viewZoneChangeAccessor: IViewZoneChangeAccessor): void {\n\t\tif (this.isValid()) {\n\t\t\tconst range = this._editor.getModel().getDecorationRange(this._decorationIds[0]);\n\t\t\tif (range) {\n\t\t\t\tthis._viewZone.afterLineNumber = range.startLineNumber - 1;\n\t\t\t\tviewZoneChangeAccessor.layoutZone(this._viewZoneId);\n\n\t\t\t\tif (this._contentWidget) {\n\t\t\t\t\tthis._contentWidget.updatePosition(range.startLineNumber);\n\t\t\t\t\tthis._editor.layoutContentWidget(this._contentWidget);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetItems(): CodeLensItem[] {\n\t\treturn this._data;\n\t}\n}\n"]}