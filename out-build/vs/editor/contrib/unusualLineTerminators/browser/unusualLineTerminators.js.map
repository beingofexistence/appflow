{"version":3,"sources":["vs/editor/contrib/unusualLineTerminators/browser/unusualLineTerminators.ts"],"names":[],"mappings":"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","file":"unusualLineTerminators.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { basename } from 'vs/base/common/resources';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { EditorContributionInstantiation, registerEditorContribution } from 'vs/editor/browser/editorExtensions';\nimport { ICodeEditorService } from 'vs/editor/browser/services/codeEditorService';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { IEditorContribution } from 'vs/editor/common/editorCommon';\nimport { ITextModel } from 'vs/editor/common/model';\nimport * as nls from 'vs/nls';\nimport { IConfirmationResult, IDialogService } from 'vs/platform/dialogs/common/dialogs';\n\nconst ignoreUnusualLineTerminators = 'ignoreUnusualLineTerminators';\n\nfunction writeIgnoreState(codeEditorService: ICodeEditorService, model: ITextModel, state: boolean): void {\n\tcodeEditorService.setModelProperty(model.uri, ignoreUnusualLineTerminators, state);\n}\n\nfunction readIgnoreState(codeEditorService: ICodeEditorService, model: ITextModel): boolean | undefined {\n\treturn codeEditorService.getModelProperty(model.uri, ignoreUnusualLineTerminators);\n}\n\nexport class UnusualLineTerminatorsDetector extends Disposable implements IEditorContribution {\n\n\tpublic static readonly ID = 'editor.contrib.unusualLineTerminatorsDetector';\n\n\tprivate _config: 'auto' | 'off' | 'prompt';\n\tprivate _isPresentingDialog: boolean = false;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IDialogService private readonly _dialogService: IDialogService,\n\t\t@ICodeEditorService private readonly _codeEditorService: ICodeEditorService\n\t) {\n\t\tsuper();\n\n\t\tthis._config = this._editor.getOption(EditorOption.unusualLineTerminators);\n\t\tthis._register(this._editor.onDidChangeConfiguration((e) => {\n\t\t\tif (e.hasChanged(EditorOption.unusualLineTerminators)) {\n\t\t\t\tthis._config = this._editor.getOption(EditorOption.unusualLineTerminators);\n\t\t\t\tthis._checkForUnusualLineTerminators();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._editor.onDidChangeModel(() => {\n\t\t\tthis._checkForUnusualLineTerminators();\n\t\t}));\n\n\t\tthis._register(this._editor.onDidChangeModelContent((e) => {\n\t\t\tif (e.isUndoing) {\n\t\t\t\t// skip checking in case of undoing\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._checkForUnusualLineTerminators();\n\t\t}));\n\n\t\tthis._checkForUnusualLineTerminators();\n\t}\n\n\tprivate async _checkForUnusualLineTerminators(): Promise<void> {\n\t\tif (this._config === 'off') {\n\t\t\treturn;\n\t\t}\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tconst model = this._editor.getModel();\n\t\tif (!model.mightContainUnusualLineTerminators()) {\n\t\t\treturn;\n\t\t}\n\t\tconst ignoreState = readIgnoreState(this._codeEditorService, model);\n\t\tif (ignoreState === true) {\n\t\t\t// this model should be ignored\n\t\t\treturn;\n\t\t}\n\t\tif (this._editor.getOption(EditorOption.readOnly)) {\n\t\t\t// read only editor => sorry!\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._config === 'auto') {\n\t\t\t// just do it!\n\t\t\tmodel.removeUnusualLineTerminators(this._editor.getSelections());\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._isPresentingDialog) {\n\t\t\t// we're currently showing the dialog, which is async.\n\t\t\t// avoid spamming the user\n\t\t\treturn;\n\t\t}\n\n\t\tlet result: IConfirmationResult;\n\t\ttry {\n\t\t\tthis._isPresentingDialog = true;\n\t\t\tresult = await this._dialogService.confirm({\n\t\t\t\ttitle: nls.localize('unusualLineTerminators.title', \"Unusual Line Terminators\"),\n\t\t\t\tmessage: nls.localize('unusualLineTerminators.message', \"Detected unusual line terminators\"),\n\t\t\t\tdetail: nls.localize('unusualLineTerminators.detail', \"The file '{0}' contains one or more unusual line terminator characters, like Line Separator (LS) or Paragraph Separator (PS).\\n\\nIt is recommended to remove them from the file. This can be configured via `editor.unusualLineTerminators`.\", basename(model.uri)),\n\t\t\t\tprimaryButton: nls.localize({ key: 'unusualLineTerminators.fix', comment: ['&& denotes a mnemonic'] }, \"&&Remove Unusual Line Terminators\"),\n\t\t\t\tcancelButton: nls.localize('unusualLineTerminators.ignore', \"Ignore\")\n\t\t\t});\n\t\t} finally {\n\t\t\tthis._isPresentingDialog = false;\n\t\t}\n\n\t\tif (!result.confirmed) {\n\t\t\t// this model should be ignored\n\t\t\twriteIgnoreState(this._codeEditorService, model, true);\n\t\t\treturn;\n\t\t}\n\n\t\tmodel.removeUnusualLineTerminators(this._editor.getSelections());\n\t}\n}\n\nregisterEditorContribution(UnusualLineTerminatorsDetector.ID, UnusualLineTerminatorsDetector, EditorContributionInstantiation.AfterFirstRender);\n"]}