{"version":3,"sources":["vs/editor/contrib/dropOrPasteInto/browser/defaultProviders.ts"],"names":[],"mappings":"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","file":"defaultProviders.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { coalesce } from 'vs/base/common/arrays';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { IReadonlyVSDataTransfer, UriList } from 'vs/base/common/dataTransfer';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { Mimes } from 'vs/base/common/mime';\nimport { Schemas } from 'vs/base/common/network';\nimport { relativePath } from 'vs/base/common/resources';\nimport { URI } from 'vs/base/common/uri';\nimport { IPosition } from 'vs/editor/common/core/position';\nimport { IRange } from 'vs/editor/common/core/range';\nimport { DocumentOnDropEdit, DocumentOnDropEditProvider, DocumentPasteEdit, DocumentPasteEditProvider } from 'vs/editor/common/languages';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { ILanguageFeaturesService } from 'vs/editor/common/services/languageFeatures';\nimport { localize } from 'vs/nls';\nimport { IWorkspaceContextService } from 'vs/platform/workspace/common/workspace';\n\nconst builtInLabel = localize('builtIn', 'Built-in');\n\nabstract class SimplePasteAndDropProvider implements DocumentOnDropEditProvider, DocumentPasteEditProvider {\n\n\tabstract readonly id: string;\n\tabstract readonly dropMimeTypes: readonly string[] | undefined;\n\tabstract readonly pasteMimeTypes: readonly string[];\n\n\tasync provideDocumentPasteEdits(_model: ITextModel, _ranges: readonly IRange[], dataTransfer: IReadonlyVSDataTransfer, token: CancellationToken): Promise<DocumentPasteEdit | undefined> {\n\t\tconst edit = await this.getEdit(dataTransfer, token);\n\t\treturn edit ? { insertText: edit.insertText, label: edit.label, detail: edit.detail, handledMimeType: edit.handledMimeType, yieldTo: edit.yieldTo } : undefined;\n\t}\n\n\tasync provideDocumentOnDropEdits(_model: ITextModel, _position: IPosition, dataTransfer: IReadonlyVSDataTransfer, token: CancellationToken): Promise<DocumentOnDropEdit | undefined> {\n\t\tconst edit = await this.getEdit(dataTransfer, token);\n\t\treturn edit ? { insertText: edit.insertText, label: edit.label, handledMimeType: edit.handledMimeType, yieldTo: edit.yieldTo } : undefined;\n\t}\n\n\tprotected abstract getEdit(dataTransfer: IReadonlyVSDataTransfer, token: CancellationToken): Promise<DocumentPasteEdit | undefined>;\n}\n\nclass DefaultTextProvider extends SimplePasteAndDropProvider {\n\n\treadonly id = 'text';\n\treadonly dropMimeTypes = [Mimes.text];\n\treadonly pasteMimeTypes = [Mimes.text];\n\n\tprotected async getEdit(dataTransfer: IReadonlyVSDataTransfer, _token: CancellationToken): Promise<DocumentPasteEdit | undefined> {\n\t\tconst textEntry = dataTransfer.get(Mimes.text);\n\t\tif (!textEntry) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Suppress if there's also a uriList entry.\n\t\t// Typically the uri-list contains the same text as the text entry so showing both is confusing.\n\t\tif (dataTransfer.has(Mimes.uriList)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst insertText = await textEntry.asString();\n\t\treturn {\n\t\t\thandledMimeType: Mimes.text,\n\t\t\tlabel: localize('text.label', \"Insert Plain Text\"),\n\t\t\tdetail: builtInLabel,\n\t\t\tinsertText\n\t\t};\n\t}\n}\n\nclass PathProvider extends SimplePasteAndDropProvider {\n\n\treadonly id = 'uri';\n\treadonly dropMimeTypes = [Mimes.uriList];\n\treadonly pasteMimeTypes = [Mimes.uriList];\n\n\tprotected async getEdit(dataTransfer: IReadonlyVSDataTransfer, token: CancellationToken): Promise<DocumentPasteEdit | undefined> {\n\t\tconst entries = await extractUriList(dataTransfer);\n\t\tif (!entries.length || token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet uriCount = 0;\n\t\tconst insertText = entries\n\t\t\t.map(({ uri, originalText }) => {\n\t\t\t\tif (uri.scheme === Schemas.file) {\n\t\t\t\t\treturn uri.fsPath;\n\t\t\t\t} else {\n\t\t\t\t\turiCount++;\n\t\t\t\t\treturn originalText;\n\t\t\t\t}\n\t\t\t})\n\t\t\t.join(' ');\n\n\t\tlet label: string;\n\t\tif (uriCount > 0) {\n\t\t\t// Dropping at least one generic uri (such as https) so use most generic label\n\t\t\tlabel = entries.length > 1\n\t\t\t\t? localize('defaultDropProvider.uriList.uris', \"Insert Uris\")\n\t\t\t\t: localize('defaultDropProvider.uriList.uri', \"Insert Uri\");\n\t\t} else {\n\t\t\t// All the paths are file paths\n\t\t\tlabel = entries.length > 1\n\t\t\t\t? localize('defaultDropProvider.uriList.paths', \"Insert Paths\")\n\t\t\t\t: localize('defaultDropProvider.uriList.path', \"Insert Path\");\n\t\t}\n\n\t\treturn {\n\t\t\thandledMimeType: Mimes.uriList,\n\t\t\tinsertText,\n\t\t\tlabel,\n\t\t\tdetail: builtInLabel,\n\t\t};\n\t}\n}\n\nclass RelativePathProvider extends SimplePasteAndDropProvider {\n\n\treadonly id = 'relativePath';\n\treadonly dropMimeTypes = [Mimes.uriList];\n\treadonly pasteMimeTypes = [Mimes.uriList];\n\n\tconstructor(\n\t\t@IWorkspaceContextService private readonly _workspaceContextService: IWorkspaceContextService\n\t) {\n\t\tsuper();\n\t}\n\n\tprotected async getEdit(dataTransfer: IReadonlyVSDataTransfer, token: CancellationToken): Promise<DocumentPasteEdit | undefined> {\n\t\tconst entries = await extractUriList(dataTransfer);\n\t\tif (!entries.length || token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst relativeUris = coalesce(entries.map(({ uri }) => {\n\t\t\tconst root = this._workspaceContextService.getWorkspaceFolder(uri);\n\t\t\treturn root ? relativePath(root.uri, uri) : undefined;\n\t\t}));\n\n\t\tif (!relativeUris.length) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn {\n\t\t\thandledMimeType: Mimes.uriList,\n\t\t\tinsertText: relativeUris.join(' '),\n\t\t\tlabel: entries.length > 1\n\t\t\t\t? localize('defaultDropProvider.uriList.relativePaths', \"Insert Relative Paths\")\n\t\t\t\t: localize('defaultDropProvider.uriList.relativePath', \"Insert Relative Path\"),\n\t\t\tdetail: builtInLabel,\n\t\t};\n\t}\n}\n\nasync function extractUriList(dataTransfer: IReadonlyVSDataTransfer): Promise<{ readonly uri: URI; readonly originalText: string }[]> {\n\tconst urlListEntry = dataTransfer.get(Mimes.uriList);\n\tif (!urlListEntry) {\n\t\treturn [];\n\t}\n\n\tconst strUriList = await urlListEntry.asString();\n\tconst entries: { readonly uri: URI; readonly originalText: string }[] = [];\n\tfor (const entry of UriList.parse(strUriList)) {\n\t\ttry {\n\t\t\tentries.push({ uri: URI.parse(entry), originalText: entry });\n\t\t} catch {\n\t\t\t// noop\n\t\t}\n\t}\n\treturn entries;\n}\n\nexport class DefaultDropProvidersFeature extends Disposable {\n\tconstructor(\n\t\t@ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService,\n\t\t@IWorkspaceContextService workspaceContextService: IWorkspaceContextService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(languageFeaturesService.documentOnDropEditProvider.register('*', new DefaultTextProvider()));\n\t\tthis._register(languageFeaturesService.documentOnDropEditProvider.register('*', new PathProvider()));\n\t\tthis._register(languageFeaturesService.documentOnDropEditProvider.register('*', new RelativePathProvider(workspaceContextService)));\n\t}\n}\n\nexport class DefaultPasteProvidersFeature extends Disposable {\n\tconstructor(\n\t\t@ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService,\n\t\t@IWorkspaceContextService workspaceContextService: IWorkspaceContextService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(languageFeaturesService.documentPasteEditProvider.register('*', new DefaultTextProvider()));\n\t\tthis._register(languageFeaturesService.documentPasteEditProvider.register('*', new PathProvider()));\n\t\tthis._register(languageFeaturesService.documentPasteEditProvider.register('*', new RelativePathProvider(workspaceContextService)));\n\t}\n}\n"]}