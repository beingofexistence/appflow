{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/contrib/inlineCompletions/browser/inlineCompletionsSource.ts"],"names":[],"mappings":"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","file":"inlineCompletionsSource.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { matchesSubString } from 'vs/base/common/filters';\nimport { Disposable, IDisposable, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { IObservable, IReader, ITransaction, derived, disposableObservableValue, transaction } from 'vs/base/common/observable';\nimport { Position } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\nimport { InlineCompletionContext, InlineCompletionTriggerKind } from 'vs/editor/common/languages';\nimport { ILanguageConfigurationService } from 'vs/editor/common/languages/languageConfigurationRegistry';\nimport { EndOfLinePreference, ITextModel } from 'vs/editor/common/model';\nimport { IFeatureDebounceInformation } from 'vs/editor/common/services/languageFeatureDebounce';\nimport { ILanguageFeaturesService } from 'vs/editor/common/services/languageFeatures';\nimport { InlineCompletionItem, InlineCompletionProviderResult, provideInlineCompletions } from 'vs/editor/contrib/inlineCompletions/browser/provideInlineCompletions';\nimport { SingleTextEdit } from 'vs/editor/contrib/inlineCompletions/browser/singleTextEdit';\n\nexport class InlineCompletionsSource extends Disposable {\n\tprivate readonly _updateOperation = this._register(new MutableDisposable<UpdateOperation>());\n\tpublic readonly inlineCompletions = disposableObservableValue<UpToDateInlineCompletions | undefined>('inlineCompletions', undefined);\n\tpublic readonly suggestWidgetInlineCompletions = disposableObservableValue<UpToDateInlineCompletions | undefined>('suggestWidgetInlineCompletions', undefined);\n\n\tconstructor(\n\t\tprivate readonly textModel: ITextModel,\n\t\tprivate readonly versionId: IObservable<number>,\n\t\tprivate readonly _debounceValue: IFeatureDebounceInformation,\n\t\t@ILanguageFeaturesService private readonly languageFeaturesService: ILanguageFeaturesService,\n\t\t@ILanguageConfigurationService private readonly languageConfigurationService: ILanguageConfigurationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(this.textModel.onDidChangeContent(() => {\n\t\t\tthis._updateOperation.clear();\n\t\t}));\n\t}\n\n\tpublic fetch(position: Position, context: InlineCompletionContext, activeInlineCompletion: InlineCompletionWithUpdatedRange | undefined): Promise<boolean> {\n\t\tconst request = new UpdateRequest(position, context, this.textModel.getVersionId());\n\n\t\tconst target = context.selectedSuggestionInfo ? this.suggestWidgetInlineCompletions : this.inlineCompletions;\n\n\t\tif (this._updateOperation.value?.request.satisfies(request)) {\n\t\t\treturn this._updateOperation.value.promise;\n\t\t} else if (target.get()?.request.satisfies(request)) {\n\t\t\treturn Promise.resolve(true);\n\t\t}\n\n\t\tconst updateOngoing = !!this._updateOperation.value;\n\t\tthis._updateOperation.clear();\n\n\t\tconst source = new CancellationTokenSource();\n\n\t\tconst promise = (async () => {\n\t\t\tconst shouldDebounce = updateOngoing || context.triggerKind === InlineCompletionTriggerKind.Automatic;\n\t\t\tif (shouldDebounce) {\n\t\t\t\t// This debounces the operation\n\t\t\t\tawait wait(this._debounceValue.get(this.textModel));\n\t\t\t}\n\n\t\t\tif (source.token.isCancellationRequested || this.textModel.getVersionId() !== request.versionId) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst startTime = new Date();\n\t\t\tconst updatedCompletions = await provideInlineCompletions(\n\t\t\t\tthis.languageFeaturesService.inlineCompletionsProvider,\n\t\t\t\tposition,\n\t\t\t\tthis.textModel,\n\t\t\t\tcontext,\n\t\t\t\tsource.token,\n\t\t\t\tthis.languageConfigurationService\n\t\t\t);\n\n\t\t\tif (source.token.isCancellationRequested || this.textModel.getVersionId() !== request.versionId) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst endTime = new Date();\n\t\t\tthis._debounceValue.update(this.textModel, endTime.getTime() - startTime.getTime());\n\n\t\t\tconst completions = new UpToDateInlineCompletions(updatedCompletions, request, this.textModel, this.versionId);\n\t\t\tif (activeInlineCompletion) {\n\t\t\t\tconst asInlineCompletion = activeInlineCompletion.toInlineCompletion(undefined);\n\t\t\t\tif (activeInlineCompletion.canBeReused(this.textModel, position) && !updatedCompletions.has(asInlineCompletion)) {\n\t\t\t\t\tcompletions.prepend(activeInlineCompletion.inlineCompletion, asInlineCompletion.range, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._updateOperation.clear();\n\t\t\ttransaction(tx => {\n\t\t\t\t/** @description Update completions with provider result */\n\t\t\t\ttarget.set(completions, tx);\n\t\t\t});\n\n\t\t\treturn true;\n\t\t})();\n\n\t\tconst updateOperation = new UpdateOperation(request, source, promise);\n\t\tthis._updateOperation.value = updateOperation;\n\n\t\treturn promise;\n\t}\n\n\tpublic clear(tx: ITransaction): void {\n\t\tthis._updateOperation.clear();\n\t\tthis.inlineCompletions.set(undefined, tx);\n\t\tthis.suggestWidgetInlineCompletions.set(undefined, tx);\n\t}\n\n\tpublic clearSuggestWidgetInlineCompletions(tx: ITransaction): void {\n\t\tif (this._updateOperation.value?.request.context.selectedSuggestionInfo) {\n\t\t\tthis._updateOperation.clear();\n\t\t}\n\t\tthis.suggestWidgetInlineCompletions.set(undefined, tx);\n\t}\n\n\tpublic cancelUpdate(): void {\n\t\tthis._updateOperation.clear();\n\t}\n}\n\nfunction wait(ms: number, cancellationToken?: CancellationToken): Promise<void> {\n\treturn new Promise(resolve => {\n\t\tlet d: IDisposable | undefined = undefined;\n\t\tconst handle = setTimeout(() => {\n\t\t\tif (d) { d.dispose(); }\n\t\t\tresolve();\n\t\t}, ms);\n\t\tif (cancellationToken) {\n\t\t\td = cancellationToken.onCancellationRequested(() => {\n\t\t\t\tclearTimeout(handle);\n\t\t\t\tif (d) { d.dispose(); }\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\t});\n}\n\nclass UpdateRequest {\n\tconstructor(\n\t\tpublic readonly position: Position,\n\t\tpublic readonly context: InlineCompletionContext,\n\t\tpublic readonly versionId: number,\n\t) {\n\t}\n\n\tpublic satisfies(other: UpdateRequest): boolean {\n\t\treturn this.position.equals(other.position)\n\t\t\t&& equals(this.context.selectedSuggestionInfo, other.context.selectedSuggestionInfo, (v1, v2) => v1.equals(v2))\n\t\t\t&& (other.context.triggerKind === InlineCompletionTriggerKind.Automatic\n\t\t\t\t|| this.context.triggerKind === InlineCompletionTriggerKind.Explicit)\n\t\t\t&& this.versionId === other.versionId;\n\t}\n}\n\nfunction equals<T>(v1: T | undefined, v2: T | undefined, equals: (v1: T, v2: T) => boolean): boolean {\n\tif (!v1 || !v2) {\n\t\treturn v1 === v2;\n\t}\n\treturn equals(v1, v2);\n}\n\nclass UpdateOperation implements IDisposable {\n\tconstructor(\n\t\tpublic readonly request: UpdateRequest,\n\t\tpublic readonly cancellationTokenSource: CancellationTokenSource,\n\t\tpublic readonly promise: Promise<boolean>,\n\t) {\n\t}\n\n\tdispose() {\n\t\tthis.cancellationTokenSource.cancel();\n\t}\n}\n\nexport class UpToDateInlineCompletions implements IDisposable {\n\tprivate readonly _inlineCompletions: InlineCompletionWithUpdatedRange[];\n\tpublic get inlineCompletions(): ReadonlyArray<InlineCompletionWithUpdatedRange> { return this._inlineCompletions; }\n\n\tprivate _refCount = 1;\n\tprivate readonly _prependedInlineCompletionItems: InlineCompletionItem[] = [];\n\n\tprivate _rangeVersionIdValue = 0;\n\tprivate readonly _rangeVersionId = derived(this, reader => {\n\t\tthis.versionId.read(reader);\n\t\tlet changed = false;\n\t\tfor (const i of this._inlineCompletions) {\n\t\t\tchanged = changed || i._updateRange(this.textModel);\n\t\t}\n\t\tif (changed) {\n\t\t\tthis._rangeVersionIdValue++;\n\t\t}\n\t\treturn this._rangeVersionIdValue;\n\t});\n\n\tconstructor(\n\t\tprivate readonly inlineCompletionProviderResult: InlineCompletionProviderResult,\n\t\tpublic readonly request: UpdateRequest,\n\t\tprivate readonly textModel: ITextModel,\n\t\tprivate readonly versionId: IObservable<number>,\n\t) {\n\t\tconst ids = textModel.deltaDecorations([], inlineCompletionProviderResult.completions.map(i => ({\n\t\t\trange: i.range,\n\t\t\toptions: {\n\t\t\t\tdescription: 'inline-completion-tracking-range'\n\t\t\t},\n\t\t})));\n\n\t\tthis._inlineCompletions = inlineCompletionProviderResult.completions.map(\n\t\t\t(i, index) => new InlineCompletionWithUpdatedRange(i, ids[index], this._rangeVersionId)\n\t\t);\n\t}\n\n\tpublic clone(): this {\n\t\tthis._refCount++;\n\t\treturn this;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._refCount--;\n\t\tif (this._refCount === 0) {\n\t\t\tsetTimeout(() => {\n\t\t\t\t// To fix https://github.com/microsoft/vscode/issues/188348\n\t\t\t\tif (!this.textModel.isDisposed()) {\n\t\t\t\t\t// This is just cleanup. It's ok if it happens with a delay.\n\t\t\t\t\tthis.textModel.deltaDecorations(this._inlineCompletions.map(i => i.decorationId), []);\n\t\t\t\t}\n\t\t\t}, 0);\n\t\t\tthis.inlineCompletionProviderResult.dispose();\n\t\t\tfor (const i of this._prependedInlineCompletionItems) {\n\t\t\t\ti.source.removeRef();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic prepend(inlineCompletion: InlineCompletionItem, range: Range, addRefToSource: boolean): void {\n\t\tif (addRefToSource) {\n\t\t\tinlineCompletion.source.addRef();\n\t\t}\n\n\t\tconst id = this.textModel.deltaDecorations([], [{\n\t\t\trange,\n\t\t\toptions: {\n\t\t\t\tdescription: 'inline-completion-tracking-range'\n\t\t\t},\n\t\t}])[0];\n\t\tthis._inlineCompletions.unshift(new InlineCompletionWithUpdatedRange(inlineCompletion, id, this._rangeVersionId, range));\n\t\tthis._prependedInlineCompletionItems.push(inlineCompletion);\n\t}\n}\n\nexport class InlineCompletionWithUpdatedRange {\n\tpublic readonly semanticId = JSON.stringify([\n\t\tthis.inlineCompletion.filterText,\n\t\tthis.inlineCompletion.insertText,\n\t\tthis.inlineCompletion.range.getStartPosition().toString()\n\t]);\n\tprivate _updatedRange: Range;\n\tprivate _isValid = true;\n\n\tpublic get forwardStable() {\n\t\treturn this.inlineCompletion.source.inlineCompletions.enableForwardStability ?? false;\n\t}\n\n\tconstructor(\n\t\tpublic readonly inlineCompletion: InlineCompletionItem,\n\t\tpublic readonly decorationId: string,\n\t\tprivate readonly rangeVersion: IObservable<number>,\n\t\tinitialRange?: Range,\n\t) {\n\t\tthis._updatedRange = initialRange ?? inlineCompletion.range;\n\t}\n\n\tpublic toInlineCompletion(reader: IReader | undefined): InlineCompletionItem {\n\t\treturn this.inlineCompletion.withRange(this._getUpdatedRange(reader));\n\t}\n\n\tpublic toSingleTextEdit(reader: IReader | undefined): SingleTextEdit {\n\t\treturn new SingleTextEdit(this._getUpdatedRange(reader), this.inlineCompletion.insertText);\n\t}\n\n\tpublic isVisible(model: ITextModel, cursorPosition: Position, reader: IReader | undefined): boolean {\n\t\tconst minimizedReplacement = this._toFilterTextReplacement(reader).removeCommonPrefix(model);\n\n\t\tif (\n\t\t\t!this._isValid\n\t\t\t|| !this.inlineCompletion.range.getStartPosition().equals(this._getUpdatedRange(reader).getStartPosition())\n\t\t\t|| cursorPosition.lineNumber !== minimizedReplacement.range.startLineNumber\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst originalValue = model.getValueInRange(minimizedReplacement.range, EndOfLinePreference.LF).toLowerCase();\n\t\tconst filterText = minimizedReplacement.text.toLowerCase();\n\n\t\tconst cursorPosIndex = Math.max(0, cursorPosition.column - minimizedReplacement.range.startColumn);\n\n\t\tlet filterTextBefore = filterText.substring(0, cursorPosIndex);\n\t\tlet filterTextAfter = filterText.substring(cursorPosIndex);\n\n\t\tlet originalValueBefore = originalValue.substring(0, cursorPosIndex);\n\t\tlet originalValueAfter = originalValue.substring(cursorPosIndex);\n\n\t\tconst originalValueIndent = model.getLineIndentColumn(minimizedReplacement.range.startLineNumber);\n\t\tif (minimizedReplacement.range.startColumn <= originalValueIndent) {\n\t\t\t// Remove indentation\n\t\t\toriginalValueBefore = originalValueBefore.trimStart();\n\t\t\tif (originalValueBefore.length === 0) {\n\t\t\t\toriginalValueAfter = originalValueAfter.trimStart();\n\t\t\t}\n\t\t\tfilterTextBefore = filterTextBefore.trimStart();\n\t\t\tif (filterTextBefore.length === 0) {\n\t\t\t\tfilterTextAfter = filterTextAfter.trimStart();\n\t\t\t}\n\t\t}\n\n\t\treturn filterTextBefore.startsWith(originalValueBefore)\n\t\t\t&& !!matchesSubString(originalValueAfter, filterTextAfter);\n\t}\n\n\tpublic canBeReused(model: ITextModel, position: Position): boolean {\n\t\tconst result = this._isValid\n\t\t\t&& this._getUpdatedRange(undefined).containsPosition(position)\n\t\t\t&& this.isVisible(model, position, undefined)\n\t\t\t&& !this._isSmallerThanOriginal(undefined);\n\t\treturn result;\n\t}\n\n\tprivate _toFilterTextReplacement(reader: IReader | undefined): SingleTextEdit {\n\t\treturn new SingleTextEdit(this._getUpdatedRange(reader), this.inlineCompletion.filterText);\n\t}\n\n\tprivate _isSmallerThanOriginal(reader: IReader | undefined): boolean {\n\t\treturn length(this._getUpdatedRange(reader)).isBefore(length(this.inlineCompletion.range));\n\t}\n\n\tprivate _getUpdatedRange(reader: IReader | undefined): Range {\n\t\tthis.rangeVersion.read(reader); // This makes sure all the ranges are updated.\n\t\treturn this._updatedRange;\n\t}\n\n\tpublic _updateRange(textModel: ITextModel): boolean {\n\t\tconst range = textModel.getDecorationRange(this.decorationId);\n\t\tif (!range) {\n\t\t\t// A setValue call might flush all decorations.\n\t\t\tthis._isValid = false;\n\t\t\treturn true;\n\t\t}\n\t\tif (!this._updatedRange.equalsRange(range)) {\n\t\t\tthis._updatedRange = range;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nfunction length(range: Range): Position {\n\tif (range.startLineNumber === range.endLineNumber) {\n\t\treturn new Position(1, 1 + range.endColumn - range.startColumn);\n\t} else {\n\t\treturn new Position(1 + range.endLineNumber - range.startLineNumber, range.endColumn);\n\t}\n}\n"]}