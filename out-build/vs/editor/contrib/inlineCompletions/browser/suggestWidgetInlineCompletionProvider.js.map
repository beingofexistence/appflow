{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/contrib/inlineCompletions/browser/suggestWidgetInlineCompletionProvider.ts"],"names":[],"mappings":"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","file":"suggestWidgetInlineCompletionProvider.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { Position } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\nimport { CompletionItemInsertTextRule, CompletionItemKind, SelectedSuggestionInfo } from 'vs/editor/common/languages';\nimport { SnippetParser } from 'vs/editor/contrib/snippet/browser/snippetParser';\nimport { SnippetSession } from 'vs/editor/contrib/snippet/browser/snippetSession';\nimport { CompletionItem } from 'vs/editor/contrib/suggest/browser/suggest';\nimport { SuggestController } from 'vs/editor/contrib/suggest/browser/suggestController';\nimport { IObservable, ITransaction, observableValue, transaction } from 'vs/base/common/observable';\nimport { SingleTextEdit } from 'vs/editor/contrib/inlineCompletions/browser/singleTextEdit';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { compareBy, numberComparator } from 'vs/base/common/arrays';\nimport { findFirstMaxBy } from 'vs/base/common/arraysFind';\n\nexport class SuggestWidgetAdaptor extends Disposable {\n\tprivate isSuggestWidgetVisible: boolean = false;\n\tprivate isShiftKeyPressed = false;\n\tprivate _isActive = false;\n\tprivate _currentSuggestItemInfo: SuggestItemInfo | undefined = undefined;\n\n\tprivate readonly _selectedItem = observableValue(this, undefined as SuggestItemInfo | undefined);\n\n\tpublic get selectedItem(): IObservable<SuggestItemInfo | undefined> {\n\t\treturn this._selectedItem;\n\t}\n\n\tconstructor(\n\t\tprivate readonly editor: ICodeEditor,\n\t\tprivate readonly suggestControllerPreselector: () => SingleTextEdit | undefined,\n\t\tprivate readonly checkModelVersion: (tx: ITransaction) => void,\n\t\tprivate readonly onWillAccept: (item: SuggestItemInfo) => void,\n\t) {\n\t\tsuper();\n\n\t\t// See the command acceptAlternativeSelectedSuggestion that is bound to shift+tab\n\t\tthis._register(editor.onKeyDown(e => {\n\t\t\tif (e.shiftKey && !this.isShiftKeyPressed) {\n\t\t\t\tthis.isShiftKeyPressed = true;\n\t\t\t\tthis.update(this._isActive);\n\t\t\t}\n\t\t}));\n\t\tthis._register(editor.onKeyUp(e => {\n\t\t\tif (e.shiftKey && this.isShiftKeyPressed) {\n\t\t\t\tthis.isShiftKeyPressed = false;\n\t\t\t\tthis.update(this._isActive);\n\t\t\t}\n\t\t}));\n\n\t\tconst suggestController = SuggestController.get(this.editor);\n\t\tif (suggestController) {\n\t\t\tthis._register(suggestController.registerSelector({\n\t\t\t\tpriority: 100,\n\t\t\t\tselect: (model, pos, suggestItems) => {\n\t\t\t\t\ttransaction(tx => this.checkModelVersion(tx));\n\n\t\t\t\t\tconst textModel = this.editor.getModel();\n\t\t\t\t\tif (!textModel) {\n\t\t\t\t\t\t// Should not happen\n\t\t\t\t\t\treturn -1;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst itemToPreselect = this.suggestControllerPreselector()?.removeCommonPrefix(textModel);\n\t\t\t\t\tif (!itemToPreselect) {\n\t\t\t\t\t\treturn -1;\n\t\t\t\t\t}\n\t\t\t\t\tconst position = Position.lift(pos);\n\n\t\t\t\t\tconst candidates = suggestItems\n\t\t\t\t\t\t.map((suggestItem, index) => {\n\t\t\t\t\t\t\tconst suggestItemInfo = SuggestItemInfo.fromSuggestion(suggestController, textModel, position, suggestItem, this.isShiftKeyPressed);\n\t\t\t\t\t\t\tconst suggestItemTextEdit = suggestItemInfo.toSingleTextEdit().removeCommonPrefix(textModel);\n\t\t\t\t\t\t\tconst valid = itemToPreselect.augments(suggestItemTextEdit);\n\t\t\t\t\t\t\treturn { index, valid, prefixLength: suggestItemTextEdit.text.length, suggestItem };\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.filter(item => item && item.valid && item.prefixLength > 0);\n\n\t\t\t\t\tconst result = findFirstMaxBy(\n\t\t\t\t\t\tcandidates,\n\t\t\t\t\t\tcompareBy(s => s!.prefixLength, numberComparator)\n\t\t\t\t\t);\n\t\t\t\t\treturn result ? result.index : - 1;\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tlet isBoundToSuggestWidget = false;\n\t\t\tconst bindToSuggestWidget = () => {\n\t\t\t\tif (isBoundToSuggestWidget) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tisBoundToSuggestWidget = true;\n\n\t\t\t\tthis._register(suggestController.widget.value.onDidShow(() => {\n\t\t\t\t\tthis.isSuggestWidgetVisible = true;\n\t\t\t\t\tthis.update(true);\n\t\t\t\t}));\n\t\t\t\tthis._register(suggestController.widget.value.onDidHide(() => {\n\t\t\t\t\tthis.isSuggestWidgetVisible = false;\n\t\t\t\t\tthis.update(false);\n\t\t\t\t}));\n\t\t\t\tthis._register(suggestController.widget.value.onDidFocus(() => {\n\t\t\t\t\tthis.isSuggestWidgetVisible = true;\n\t\t\t\t\tthis.update(true);\n\t\t\t\t}));\n\t\t\t};\n\n\t\t\tthis._register(Event.once(suggestController.model.onDidTrigger)(e => {\n\t\t\t\tbindToSuggestWidget();\n\t\t\t}));\n\n\t\t\tthis._register(suggestController.onWillInsertSuggestItem(e => {\n\t\t\t\tconst position = this.editor.getPosition();\n\t\t\t\tconst model = this.editor.getModel();\n\t\t\t\tif (!position || !model) { return undefined; }\n\n\t\t\t\tconst suggestItemInfo = SuggestItemInfo.fromSuggestion(\n\t\t\t\t\tsuggestController,\n\t\t\t\t\tmodel,\n\t\t\t\t\tposition,\n\t\t\t\t\te.item,\n\t\t\t\t\tthis.isShiftKeyPressed\n\t\t\t\t);\n\n\t\t\t\tthis.onWillAccept(suggestItemInfo);\n\t\t\t}));\n\t\t}\n\t\tthis.update(this._isActive);\n\t}\n\n\tprivate update(newActive: boolean): void {\n\t\tconst newInlineCompletion = this.getSuggestItemInfo();\n\n\t\tif (this._isActive !== newActive || !suggestItemInfoEquals(this._currentSuggestItemInfo, newInlineCompletion)) {\n\t\t\tthis._isActive = newActive;\n\t\t\tthis._currentSuggestItemInfo = newInlineCompletion;\n\n\t\t\ttransaction(tx => {\n\t\t\t\t/** @description Update state from suggest widget */\n\t\t\t\tthis.checkModelVersion(tx);\n\t\t\t\tthis._selectedItem.set(this._isActive ? this._currentSuggestItemInfo : undefined, tx);\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate getSuggestItemInfo(): SuggestItemInfo | undefined {\n\t\tconst suggestController = SuggestController.get(this.editor);\n\t\tif (!suggestController || !this.isSuggestWidgetVisible) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst focusedItem = suggestController.widget.value.getFocusedItem();\n\t\tconst position = this.editor.getPosition();\n\t\tconst model = this.editor.getModel();\n\n\t\tif (!focusedItem || !position || !model) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn SuggestItemInfo.fromSuggestion(\n\t\t\tsuggestController,\n\t\t\tmodel,\n\t\t\tposition,\n\t\t\tfocusedItem.item,\n\t\t\tthis.isShiftKeyPressed\n\t\t);\n\t}\n\n\tpublic stopForceRenderingAbove(): void {\n\t\tconst suggestController = SuggestController.get(this.editor);\n\t\tsuggestController?.stopForceRenderingAbove();\n\t}\n\n\tpublic forceRenderingAbove(): void {\n\t\tconst suggestController = SuggestController.get(this.editor);\n\t\tsuggestController?.forceRenderingAbove();\n\t}\n}\n\nexport class SuggestItemInfo {\n\tpublic static fromSuggestion(suggestController: SuggestController, model: ITextModel, position: Position, item: CompletionItem, toggleMode: boolean): SuggestItemInfo {\n\t\tlet { insertText } = item.completion;\n\t\tlet isSnippetText = false;\n\t\tif (item.completion.insertTextRules! & CompletionItemInsertTextRule.InsertAsSnippet) {\n\t\t\tconst snippet = new SnippetParser().parse(insertText);\n\n\t\t\tif (snippet.children.length < 100) {\n\t\t\t\t// Adjust whitespace is expensive.\n\t\t\t\tSnippetSession.adjustWhitespace(model, position, true, snippet);\n\t\t\t}\n\n\t\t\tinsertText = snippet.toString();\n\t\t\tisSnippetText = true;\n\t\t}\n\n\t\tconst info = suggestController.getOverwriteInfo(item, toggleMode);\n\n\t\treturn new SuggestItemInfo(\n\t\t\tRange.fromPositions(\n\t\t\t\tposition.delta(0, -info.overwriteBefore),\n\t\t\t\tposition.delta(0, Math.max(info.overwriteAfter, 0))\n\t\t\t),\n\t\t\tinsertText,\n\t\t\titem.completion.kind,\n\t\t\tisSnippetText,\n\t\t);\n\t}\n\n\tprivate constructor(\n\t\tpublic readonly range: Range,\n\t\tpublic readonly insertText: string,\n\t\tpublic readonly completionItemKind: CompletionItemKind,\n\t\tpublic readonly isSnippetText: boolean,\n\t) { }\n\n\tpublic equals(other: SuggestItemInfo): boolean {\n\t\treturn this.range.equalsRange(other.range)\n\t\t\t&& this.insertText === other.insertText\n\t\t\t&& this.completionItemKind === other.completionItemKind\n\t\t\t&& this.isSnippetText === other.isSnippetText;\n\t}\n\n\tpublic toSelectedSuggestionInfo(): SelectedSuggestionInfo {\n\t\treturn new SelectedSuggestionInfo(this.range, this.insertText, this.completionItemKind, this.isSnippetText);\n\t}\n\n\tpublic toSingleTextEdit(): SingleTextEdit {\n\t\treturn new SingleTextEdit(this.range, this.insertText);\n\t}\n}\n\nfunction suggestItemInfoEquals(a: SuggestItemInfo | undefined, b: SuggestItemInfo | undefined): boolean {\n\tif (a === b) {\n\t\treturn true;\n\t}\n\tif (!a || !b) {\n\t\treturn false;\n\t}\n\treturn a.equals(b);\n}\n"]}