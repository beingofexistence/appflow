{"version":3,"sources":["vs/editor/contrib/inPlaceReplace/browser/inPlaceReplace.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;;;;IAoBhG,IAAM,wBAAwB,GAA9B,MAAM,wBAAwB;;iBAEN,OAAE,GAAG,yCAAH,AAA4C,CAAC;QAEtE,MAAM,CAAC,GAAG,CAAC,MAAmB;YAC7B,OAAO,MAAM,CAAC,eAAe,CAA2B,0BAAwB,CAAC,EAAE,CAAC,CAAC;QACtF,CAAC;iBAEuB,MAAC,GAAY,eAAG,CAAoB,QAAQ,CAAC;YACpE,WAAW,EAAE,kBAAkB;YAC/B,SAAS,EAAE,qBAAqB;SAChC,CAHwB,AAGvB,CAAC;QAQH,YACC,MAAmB,EACG,mBAAwB;YAE9C,IAAI,CAAC,CAAC,GAAQ,MAAM,CAAC;YACrB,IAAI,CAAC,CAAC,GAAqB,mBAAmB,CAAC;YAC/C,IAAI,CAAC,CAAC,GAAa,IAAI,CAAC,CAAC,CAAM,2BAA2B,EAAE,CAAC;QAC9D,CAAC;QAEM,OAAO;QACd,CAAC;QAEM,GAAG,CAAC,MAAc,EAAE,EAAW;YAErC,6BAA6B;YAC7B,IAAI,CAAC,CAAC,EAAe,MAAM,EAAE,CAAC;YAE9B,MAAM,eAAe,GAAG,IAAI,CAAC,CAAC,CAAM,YAAY,EAAE,CAAC;YACnD,MAAM,KAAK,GAAG,IAAI,CAAC,CAAC,CAAM,QAAQ,EAAE,CAAC;YACrC,IAAI,CAAC,KAAK,IAAI,CAAC,eAAe,EAAE;gBAC/B,OAAO,SAAS,CAAC;aACjB;YACD,IAAI,SAAS,GAAG,eAAe,CAAC;YAChC,IAAI,SAAS,CAAC,eAAe,KAAK,SAAS,CAAC,aAAa,EAAE;gBAC1D,mCAAmC;gBACnC,OAAO,SAAS,CAAC;aACjB;YAED,MAAM,KAAK,GAAG,IAAI,iBAAG,CAAS,IAAI,CAAC,CAAC,EAAO,wEAAwD,CAAC,CAAC;YACrG,MAAM,QAAQ,GAAG,KAAK,CAAC,GAAG,CAAC;YAC3B,IAAI,CAAC,IAAI,CAAC,CAAC,CAAmB,mBAAmB,CAAC,QAAQ,CAAC,EAAE;gBAC5D,OAAO,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;aAClC;YAED,IAAI,CAAC,CAAC,GAAgB,IAAA,WAAG,EAAqB,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAmB,gBAAgB,CAAC,QAAQ,EAAE,SAAU,EAAE,EAAE,CAAC,CAAC,CAAC;YAE5H,OAAO,IAAI,CAAC,CAAC,CAAc,IAAI,CAAC,MAAM,CAAC,EAAE;gBAExC,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,KAAK,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE;oBAC9C,mBAAmB;oBACnB,OAAO;iBACP;gBAED,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAM,EAAE;oBACjC,oBAAoB;oBACpB,OAAO;iBACP;gBAED,YAAY;gBACZ,MAAM,SAAS,GAAG,WAAG,CAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;gBAC3C,IAAI,cAAc,GAAG,MAAM,CAAC,KAAK,CAAC;gBAClC,MAAM,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,SAAU,CAAC,SAAS,GAAG,SAAU,CAAC,WAAW,CAAC,CAAC;gBAEnF,YAAY;gBACZ,cAAc,GAAG;oBAChB,eAAe,EAAE,cAAc,CAAC,eAAe;oBAC/C,WAAW,EAAE,cAAc,CAAC,WAAW;oBACvC,aAAa,EAAE,cAAc,CAAC,aAAa;oBAC3C,SAAS,EAAE,cAAc,CAAC,WAAW,GAAG,MAAM,CAAC,KAAK,CAAC,MAAM;iBAC3D,CAAC;gBACF,IAAI,IAAI,GAAG,CAAC,EAAE;oBACb,SAAS,GAAG,IAAI,eAAG,CAAO,SAAU,CAAC,eAAe,EAAE,SAAU,CAAC,WAAW,EAAE,SAAU,CAAC,aAAa,EAAE,SAAU,CAAC,SAAS,GAAG,IAAI,GAAG,CAAC,CAAC,CAAC;iBACzI;gBAED,kBAAkB;gBAClB,MAAM,OAAO,GAAG,IAAI,2BAAG,CAAmB,SAAS,EAAE,SAAU,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC;gBAE/E,IAAI,CAAC,CAAC,CAAM,YAAY,EAAE,CAAC;gBAC3B,IAAI,CAAC,CAAC,CAAM,cAAc,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;gBAC5C,IAAI,CAAC,CAAC,CAAM,YAAY,EAAE,CAAC;gBAE3B,iBAAiB;gBACjB,IAAI,CAAC,CAAC,CAAW,GAAG,CAAC,CAAC;wBACrB,KAAK,EAAE,cAAc;wBACrB,OAAO,EAAE,0BAAwB,CAAC,CAAC;qBACnC,CAAC,CAAC,CAAC;gBAEJ,gCAAgC;gBAChC,IAAI,CAAC,CAAC,EAAkB,MAAM,EAAE,CAAC;gBACjC,IAAI,CAAC,CAAC,GAAmB,IAAA,WAAG,EAAK,GAAG,CAAC,CAAC;gBACtC,IAAI,CAAC,CAAC,CAAiB,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC,CAAW,KAAK,EAAE,CAAC,CAAC,KAAK,CAAC,WAAE,CAAgB,CAAC;YAEtF,CAAC,CAAC,CAAC,KAAK,CAAC,WAAE,CAAgB,CAAC;QAC7B,CAAC;;IAtGI,wBAAwB;QAqB3B,WAAA,kBAAG,CAAA;OArBA,wBAAwB,CAuG7B;IAED,MAAM,gBAAiB,SAAQ,sBAAG;QAEjC;YACC,KAAK,CAAC;gBACL,EAAE,EAAE,iCAAiC;gBACrC,KAAK,EAAE,GAAG,CAAC,QAAQ,CAAC,CAAqC,EAAE,IAA6B,CAAC;gBACzF,KAAK,EAAE,6BAA6B;gBACpC,YAAY,EAAE,qCAAiB,CAAC,QAAQ;gBACxC,MAAM,EAAE;oBACP,MAAM,EAAE,qCAAiB,CAAC,eAAe;oBACzC,OAAO,EAAE,mDAA6B,yBAAgB;oBACtD,MAAM,0CAAgC;iBACtC;aACD,CAAC,CAAC;QACJ,CAAC;QAEM,GAAG,CAAC,QAA0B,EAAE,MAAmB;YACzD,MAAM,UAAU,GAAG,wBAAwB,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YACxD,IAAI,CAAC,UAAU,EAAE;gBAChB,OAAO,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;aAClC;YACD,OAAO,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;QACvC,CAAC;KACD;IAED,MAAM,kBAAmB,SAAQ,sBAAG;QAEnC;YACC,KAAK,CAAC;gBACL,EAAE,EAAE,mCAAmC;gBACvC,KAAK,EAAE,GAAG,CAAC,QAAQ,CAAC,CAAiC,EAAE,IAAyB,CAAC;gBACjF,KAAK,EAAE,yBAAyB;gBAChC,YAAY,EAAE,qCAAiB,CAAC,QAAQ;gBACxC,MAAM,EAAE;oBACP,MAAM,EAAE,qCAAiB,CAAC,eAAe;oBACzC,OAAO,EAAE,mDAA6B,0BAAiB;oBACvD,MAAM,0CAAgC;iBACtC;aACD,CAAC,CAAC;QACJ,CAAC;QAEM,GAAG,CAAC,QAA0B,EAAE,MAAmB;YACzD,MAAM,UAAU,GAAG,wBAAwB,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YACxD,IAAI,CAAC,UAAU,EAAE;gBAChB,OAAO,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;aAClC;YACD,OAAO,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;QACtC,CAAC;KACD;IAED,IAAA,sBAAG,EAAwB,wBAAwB,CAAC,EAAE,EAAE,wBAAwB,+CAAuC,CAAC;IACxH,IAAA,sBAAG,EAAkB,gBAAgB,CAAC,CAAC;IACvC,IAAA,sBAAG,EAAkB,kBAAkB,CAAC,CAAC","file":"inPlaceReplace.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancelablePromise, createCancelablePromise, timeout } from 'vs/base/common/async';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { KeyCode, KeyMod } from 'vs/base/common/keyCodes';\nimport { CodeEditorStateFlag, EditorState } from 'vs/editor/contrib/editorState/browser/editorState';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { EditorAction, EditorContributionInstantiation, registerEditorAction, registerEditorContribution, ServicesAccessor } from 'vs/editor/browser/editorExtensions';\nimport { Range } from 'vs/editor/common/core/range';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { IEditorContribution, IEditorDecorationsCollection } from 'vs/editor/common/editorCommon';\nimport { EditorContextKeys } from 'vs/editor/common/editorContextKeys';\nimport { ModelDecorationOptions } from 'vs/editor/common/model/textModel';\nimport { IInplaceReplaceSupportResult } from 'vs/editor/common/languages';\nimport { IEditorWorkerService } from 'vs/editor/common/services/editorWorker';\nimport * as nls from 'vs/nls';\nimport { KeybindingWeight } from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport { InPlaceReplaceCommand } from './inPlaceReplaceCommand';\nimport 'vs/css!./inPlaceReplace';\n\nclass InPlaceReplaceController implements IEditorContribution {\n\n\tpublic static readonly ID = 'editor.contrib.inPlaceReplaceController';\n\n\tstatic get(editor: ICodeEditor): InPlaceReplaceController | null {\n\t\treturn editor.getContribution<InPlaceReplaceController>(InPlaceReplaceController.ID);\n\t}\n\n\tprivate static readonly DECORATION = ModelDecorationOptions.register({\n\t\tdescription: 'in-place-replace',\n\t\tclassName: 'valueSetReplacement'\n\t});\n\n\tprivate readonly editor: ICodeEditor;\n\tprivate readonly editorWorkerService: IEditorWorkerService;\n\tprivate readonly decorations: IEditorDecorationsCollection;\n\tprivate currentRequest?: CancelablePromise<IInplaceReplaceSupportResult | null>;\n\tprivate decorationRemover?: CancelablePromise<void>;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@IEditorWorkerService editorWorkerService: IEditorWorkerService\n\t) {\n\t\tthis.editor = editor;\n\t\tthis.editorWorkerService = editorWorkerService;\n\t\tthis.decorations = this.editor.createDecorationsCollection();\n\t}\n\n\tpublic dispose(): void {\n\t}\n\n\tpublic run(source: string, up: boolean): Promise<void> | undefined {\n\n\t\t// cancel any pending request\n\t\tthis.currentRequest?.cancel();\n\n\t\tconst editorSelection = this.editor.getSelection();\n\t\tconst model = this.editor.getModel();\n\t\tif (!model || !editorSelection) {\n\t\t\treturn undefined;\n\t\t}\n\t\tlet selection = editorSelection;\n\t\tif (selection.startLineNumber !== selection.endLineNumber) {\n\t\t\t// Can't accept multiline selection\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst state = new EditorState(this.editor, CodeEditorStateFlag.Value | CodeEditorStateFlag.Position);\n\t\tconst modelURI = model.uri;\n\t\tif (!this.editorWorkerService.canNavigateValueSet(modelURI)) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tthis.currentRequest = createCancelablePromise(token => this.editorWorkerService.navigateValueSet(modelURI, selection!, up));\n\n\t\treturn this.currentRequest.then(result => {\n\n\t\t\tif (!result || !result.range || !result.value) {\n\t\t\t\t// No proper result\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!state.validate(this.editor)) {\n\t\t\t\t// state has changed\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Selection\n\t\t\tconst editRange = Range.lift(result.range);\n\t\t\tlet highlightRange = result.range;\n\t\t\tconst diff = result.value.length - (selection!.endColumn - selection!.startColumn);\n\n\t\t\t// highlight\n\t\t\thighlightRange = {\n\t\t\t\tstartLineNumber: highlightRange.startLineNumber,\n\t\t\t\tstartColumn: highlightRange.startColumn,\n\t\t\t\tendLineNumber: highlightRange.endLineNumber,\n\t\t\t\tendColumn: highlightRange.startColumn + result.value.length\n\t\t\t};\n\t\t\tif (diff > 1) {\n\t\t\t\tselection = new Selection(selection!.startLineNumber, selection!.startColumn, selection!.endLineNumber, selection!.endColumn + diff - 1);\n\t\t\t}\n\n\t\t\t// Insert new text\n\t\t\tconst command = new InPlaceReplaceCommand(editRange, selection!, result.value);\n\n\t\t\tthis.editor.pushUndoStop();\n\t\t\tthis.editor.executeCommand(source, command);\n\t\t\tthis.editor.pushUndoStop();\n\n\t\t\t// add decoration\n\t\t\tthis.decorations.set([{\n\t\t\t\trange: highlightRange,\n\t\t\t\toptions: InPlaceReplaceController.DECORATION\n\t\t\t}]);\n\n\t\t\t// remove decoration after delay\n\t\t\tthis.decorationRemover?.cancel();\n\t\t\tthis.decorationRemover = timeout(350);\n\t\t\tthis.decorationRemover.then(() => this.decorations.clear()).catch(onUnexpectedError);\n\n\t\t}).catch(onUnexpectedError);\n\t}\n}\n\nclass InPlaceReplaceUp extends EditorAction {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.action.inPlaceReplace.up',\n\t\t\tlabel: nls.localize('InPlaceReplaceAction.previous.label', \"Replace with Previous Value\"),\n\t\t\talias: 'Replace with Previous Value',\n\t\t\tprecondition: EditorContextKeys.writable,\n\t\t\tkbOpts: {\n\t\t\t\tkbExpr: EditorContextKeys.editorTextFocus,\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.Comma,\n\t\t\t\tweight: KeybindingWeight.EditorContrib\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic run(accessor: ServicesAccessor, editor: ICodeEditor): Promise<void> | undefined {\n\t\tconst controller = InPlaceReplaceController.get(editor);\n\t\tif (!controller) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\t\treturn controller.run(this.id, false);\n\t}\n}\n\nclass InPlaceReplaceDown extends EditorAction {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.action.inPlaceReplace.down',\n\t\t\tlabel: nls.localize('InPlaceReplaceAction.next.label', \"Replace with Next Value\"),\n\t\t\talias: 'Replace with Next Value',\n\t\t\tprecondition: EditorContextKeys.writable,\n\t\t\tkbOpts: {\n\t\t\t\tkbExpr: EditorContextKeys.editorTextFocus,\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.Period,\n\t\t\t\tweight: KeybindingWeight.EditorContrib\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic run(accessor: ServicesAccessor, editor: ICodeEditor): Promise<void> | undefined {\n\t\tconst controller = InPlaceReplaceController.get(editor);\n\t\tif (!controller) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\t\treturn controller.run(this.id, true);\n\t}\n}\n\nregisterEditorContribution(InPlaceReplaceController.ID, InPlaceReplaceController, EditorContributionInstantiation.Lazy);\nregisterEditorAction(InPlaceReplaceUp);\nregisterEditorAction(InPlaceReplaceDown);\n"]}