{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/browser/widget/diffEditor/lineAlignment.ts"],"names":[],"mappings":"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","file":"lineAlignment.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { $ } from 'vs/base/browser/dom';\nimport { ArrayQueue } from 'vs/base/common/arrays';\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport { Codicon } from 'vs/base/common/codicons';\nimport { Disposable, DisposableStore, toDisposable } from 'vs/base/common/lifecycle';\nimport { IObservable, autorun, autorunWithStore, derived, observableFromEvent, observableValue } from 'vs/base/common/observable';\nimport { ThemeIcon } from 'vs/base/common/themables';\nimport { assertIsDefined } from 'vs/base/common/types';\nimport { applyFontInfo } from 'vs/editor/browser/config/domFontInfo';\nimport { IViewZone } from 'vs/editor/browser/editorBrowser';\nimport { StableEditorScrollState } from 'vs/editor/browser/stableEditorScroll';\nimport { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';\nimport { diffDeleteDecoration, diffRemoveIcon } from 'vs/editor/browser/widget/diffEditor/decorations';\nimport { DiffEditorEditors } from 'vs/editor/browser/widget/diffEditor/diffEditorEditors';\nimport { DiffEditorViewModel, DiffMapping } from 'vs/editor/browser/widget/diffEditor/diffEditorViewModel';\nimport { DiffEditorWidget } from 'vs/editor/browser/widget/diffEditor/diffEditorWidget';\nimport { InlineDiffDeletedCodeMargin } from 'vs/editor/browser/widget/diffEditor/inlineDiffDeletedCodeMargin';\nimport { LineSource, RenderOptions, renderLines } from 'vs/editor/browser/widget/diffEditor/renderLines';\nimport { animatedObservable, joinCombine } from 'vs/editor/browser/widget/diffEditor/utils';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { LineRange } from 'vs/editor/common/core/lineRange';\nimport { Position } from 'vs/editor/common/core/position';\nimport { DetailedLineRangeMapping } from 'vs/editor/common/diff/rangeMapping';\nimport { ScrollType } from 'vs/editor/common/editorCommon';\nimport { BackgroundTokenizationState } from 'vs/editor/common/tokenizationTextModelPart';\nimport { InlineDecoration, InlineDecorationType } from 'vs/editor/common/viewModel';\nimport { IClipboardService } from 'vs/platform/clipboard/common/clipboardService';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { DiffEditorOptions } from './diffEditorOptions';\n\n/**\n * Ensures both editors have the same height by aligning unchanged lines.\n * In inline view mode, inserts viewzones to show deleted code from the original text model in the modified code editor.\n * Synchronizes scrolling.\n */\nexport class ViewZoneManager extends Disposable {\n\tprivate readonly _originalTopPadding = observableValue(this, 0);\n\tprivate readonly _originalScrollTop: IObservable<number>;\n\tprivate readonly _originalScrollOffset = observableValue<number, boolean>(this, 0);\n\tprivate readonly _originalScrollOffsetAnimated = animatedObservable(this._originalScrollOffset, this._store);\n\n\tprivate readonly _modifiedTopPadding = observableValue(this, 0);\n\tprivate readonly _modifiedScrollTop: IObservable<number>;\n\tprivate readonly _modifiedScrollOffset = observableValue<number, boolean>(this, 0);\n\tprivate readonly _modifiedScrollOffsetAnimated = animatedObservable(this._modifiedScrollOffset, this._store);\n\n\tconstructor(\n\t\tprivate readonly _editors: DiffEditorEditors,\n\t\tprivate readonly _diffModel: IObservable<DiffEditorViewModel | undefined>,\n\t\tprivate readonly _options: DiffEditorOptions,\n\t\tprivate readonly _diffEditorWidget: DiffEditorWidget,\n\t\tprivate readonly _canIgnoreViewZoneUpdateEvent: () => boolean,\n\t\t@IClipboardService private readonly _clipboardService: IClipboardService,\n\t\t@IContextMenuService private readonly _contextMenuService: IContextMenuService,\n\t) {\n\t\tsuper();\n\n\t\tlet isChangingViewZones = false;\n\t\tconst state = observableValue('state', 0);\n\n\t\tconst updateImmediately = this._register(new RunOnceScheduler(() => {\n\t\t\tstate.set(state.get() + 1, undefined);\n\t\t}, 0));\n\n\t\tthis._register(this._editors.original.onDidChangeViewZones((_args) => { if (!isChangingViewZones && !this._canIgnoreViewZoneUpdateEvent()) { updateImmediately.schedule(); } }));\n\t\tthis._register(this._editors.modified.onDidChangeViewZones((_args) => { if (!isChangingViewZones && !this._canIgnoreViewZoneUpdateEvent()) { updateImmediately.schedule(); } }));\n\t\tthis._register(this._editors.original.onDidChangeConfiguration((args) => {\n\t\t\tif (args.hasChanged(EditorOption.wrappingInfo) || args.hasChanged(EditorOption.lineHeight)) { updateImmediately.schedule(); }\n\t\t}));\n\t\tthis._register(this._editors.modified.onDidChangeConfiguration((args) => {\n\t\t\tif (args.hasChanged(EditorOption.wrappingInfo) || args.hasChanged(EditorOption.lineHeight)) { updateImmediately.schedule(); }\n\t\t}));\n\n\t\tconst originalModelTokenizationCompleted = this._diffModel.map(m =>\n\t\t\tm ? observableFromEvent(m.model.original.onDidChangeTokens, () => m.model.original.tokenization.backgroundTokenizationState === BackgroundTokenizationState.Completed) : undefined\n\t\t).map((m, reader) => m?.read(reader));\n\n\t\tconst alignmentViewZoneIdsOrig = new Set<string>();\n\t\tconst alignmentViewZoneIdsMod = new Set<string>();\n\n\t\tconst alignments = derived<ILineRangeAlignment[] | null>((reader) => {\n\t\t\t/** @description alignments */\n\t\t\tconst diffModel = this._diffModel.read(reader);\n\t\t\tconst diff = diffModel?.diff.read(reader);\n\t\t\tif (!diffModel || !diff) { return null; }\n\t\t\tstate.read(reader);\n\t\t\tconst renderSideBySide = this._options.renderSideBySide.read(reader);\n\t\t\tconst innerHunkAlignment = renderSideBySide;\n\t\t\treturn computeRangeAlignment(\n\t\t\t\tthis._editors.original,\n\t\t\t\tthis._editors.modified,\n\t\t\t\tdiff.mappings,\n\t\t\t\talignmentViewZoneIdsOrig,\n\t\t\t\talignmentViewZoneIdsMod,\n\t\t\t\tinnerHunkAlignment\n\t\t\t);\n\t\t});\n\n\t\tconst alignmentsSyncedMovedText = derived<ILineRangeAlignment[] | null>((reader) => {\n\t\t\t/** @description alignments */\n\t\t\tconst syncedMovedText = this._diffModel.read(reader)?.movedTextToCompare.read(reader);\n\t\t\tif (!syncedMovedText) { return null; }\n\t\t\tstate.read(reader);\n\t\t\tconst mappings = syncedMovedText.changes.map(c => new DiffMapping(c));\n\t\t\t// TODO dont include alignments outside syncedMovedText\n\t\t\treturn computeRangeAlignment(\n\t\t\t\tthis._editors.original,\n\t\t\t\tthis._editors.modified,\n\t\t\t\tmappings,\n\t\t\t\talignmentViewZoneIdsOrig,\n\t\t\t\talignmentViewZoneIdsMod,\n\t\t\t\ttrue\n\t\t\t);\n\t\t});\n\n\t\tfunction createFakeLinesDiv(): HTMLElement {\n\t\t\tconst r = document.createElement('div');\n\t\t\tr.className = 'diagonal-fill';\n\t\t\treturn r;\n\t\t}\n\n\t\tconst alignmentViewZonesDisposables = this._register(new DisposableStore());\n\t\tconst alignmentViewZones = derived<{ orig: IViewZoneWithZoneId[]; mod: IViewZoneWithZoneId[] }>((reader) => {\n\t\t\t/** @description alignment viewzones */\n\t\t\talignmentViewZonesDisposables.clear();\n\n\t\t\tconst alignmentsVal = alignments.read(reader) || [];\n\n\t\t\tconst origViewZones: IViewZoneWithZoneId[] = [];\n\t\t\tconst modViewZones: IViewZoneWithZoneId[] = [];\n\n\t\t\tconst modifiedTopPaddingVal = this._modifiedTopPadding.read(reader);\n\t\t\tif (modifiedTopPaddingVal > 0) {\n\t\t\t\tmodViewZones.push({\n\t\t\t\t\tafterLineNumber: 0,\n\t\t\t\t\tdomNode: document.createElement('div'),\n\t\t\t\t\theightInPx: modifiedTopPaddingVal,\n\t\t\t\t\tshowInHiddenAreas: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst originalTopPaddingVal = this._originalTopPadding.read(reader);\n\t\t\tif (originalTopPaddingVal > 0) {\n\t\t\t\torigViewZones.push({\n\t\t\t\t\tafterLineNumber: 0,\n\t\t\t\t\tdomNode: document.createElement('div'),\n\t\t\t\t\theightInPx: originalTopPaddingVal,\n\t\t\t\t\tshowInHiddenAreas: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst renderSideBySide = this._options.renderSideBySide.read(reader);\n\n\t\t\tconst deletedCodeLineBreaksComputer = !renderSideBySide ? this._editors.modified._getViewModel()?.createLineBreaksComputer() : undefined;\n\t\t\tif (deletedCodeLineBreaksComputer) {\n\t\t\t\tfor (const a of alignmentsVal) {\n\t\t\t\t\tif (a.diff) {\n\t\t\t\t\t\tfor (let i = a.originalRange.startLineNumber; i < a.originalRange.endLineNumberExclusive; i++) {\n\t\t\t\t\t\t\tdeletedCodeLineBreaksComputer?.addRequest(this._editors.original.getModel()!.getLineContent(i), null, null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst lineBreakData = deletedCodeLineBreaksComputer?.finalize() ?? [];\n\t\t\tlet lineBreakDataIdx = 0;\n\n\t\t\tconst modLineHeight = this._editors.modified.getOption(EditorOption.lineHeight);\n\n\t\t\tconst syncedMovedText = this._diffModel.read(reader)?.movedTextToCompare.read(reader);\n\n\t\t\tconst mightContainNonBasicASCII = this._editors.original.getModel()?.mightContainNonBasicASCII() ?? false;\n\t\t\tconst mightContainRTL = this._editors.original.getModel()?.mightContainRTL() ?? false;\n\t\t\tconst renderOptions = RenderOptions.fromEditor(this._editors.modified);\n\n\t\t\tfor (const a of alignmentsVal) {\n\t\t\t\tif (a.diff && !renderSideBySide) {\n\t\t\t\t\tif (!a.originalRange.isEmpty) {\n\t\t\t\t\t\toriginalModelTokenizationCompleted.read(reader); // Update view-zones once tokenization completes\n\n\t\t\t\t\t\tconst deletedCodeDomNode = document.createElement('div');\n\t\t\t\t\t\tdeletedCodeDomNode.classList.add('view-lines', 'line-delete', 'monaco-mouse-cursor-text');\n\t\t\t\t\t\tconst source = new LineSource(\n\t\t\t\t\t\t\ta.originalRange.mapToLineArray(l => this._editors.original.getModel()!.tokenization.getLineTokens(l)),\n\t\t\t\t\t\t\ta.originalRange.mapToLineArray(_ => lineBreakData[lineBreakDataIdx++]),\n\t\t\t\t\t\t\tmightContainNonBasicASCII,\n\t\t\t\t\t\t\tmightContainRTL,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst decorations: InlineDecoration[] = [];\n\t\t\t\t\t\tfor (const i of a.diff.innerChanges || []) {\n\t\t\t\t\t\t\tdecorations.push(new InlineDecoration(\n\t\t\t\t\t\t\t\ti.originalRange.delta(-(a.diff.original.startLineNumber - 1)),\n\t\t\t\t\t\t\t\tdiffDeleteDecoration.className!,\n\t\t\t\t\t\t\t\tInlineDecorationType.Regular\n\t\t\t\t\t\t\t));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst result = renderLines(source, renderOptions, decorations, deletedCodeDomNode);\n\n\t\t\t\t\t\tconst marginDomNode = document.createElement('div');\n\t\t\t\t\t\tmarginDomNode.className = 'inline-deleted-margin-view-zone';\n\t\t\t\t\t\tapplyFontInfo(marginDomNode, renderOptions.fontInfo);\n\n\t\t\t\t\t\tif (this._options.renderIndicators.read(reader)) {\n\t\t\t\t\t\t\tfor (let i = 0; i < result.heightInLines; i++) {\n\t\t\t\t\t\t\t\tconst marginElement = document.createElement('div');\n\t\t\t\t\t\t\t\tmarginElement.className = `delete-sign ${ThemeIcon.asClassName(diffRemoveIcon)}`;\n\t\t\t\t\t\t\t\tmarginElement.setAttribute('style', `position:absolute;top:${i * modLineHeight}px;width:${renderOptions.lineDecorationsWidth}px;height:${modLineHeight}px;right:0;`);\n\t\t\t\t\t\t\t\tmarginDomNode.appendChild(marginElement);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet zoneId: string | undefined = undefined;\n\t\t\t\t\t\talignmentViewZonesDisposables.add(\n\t\t\t\t\t\t\tnew InlineDiffDeletedCodeMargin(\n\t\t\t\t\t\t\t\t() => assertIsDefined(zoneId),\n\t\t\t\t\t\t\t\tmarginDomNode,\n\t\t\t\t\t\t\t\tthis._editors.modified,\n\t\t\t\t\t\t\t\ta.diff,\n\t\t\t\t\t\t\t\tthis._diffEditorWidget,\n\t\t\t\t\t\t\t\tresult.viewLineCounts,\n\t\t\t\t\t\t\t\tthis._editors.original.getModel()!,\n\t\t\t\t\t\t\t\tthis._contextMenuService,\n\t\t\t\t\t\t\t\tthis._clipboardService,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tfor (let i = 0; i < result.viewLineCounts.length; i++) {\n\t\t\t\t\t\t\tconst count = result.viewLineCounts[i];\n\t\t\t\t\t\t\t// Account for wrapped lines in the (collapsed) original editor (which doesn't wrap lines).\n\t\t\t\t\t\t\tif (count > 1) {\n\t\t\t\t\t\t\t\torigViewZones.push({\n\t\t\t\t\t\t\t\t\tafterLineNumber: a.originalRange.startLineNumber + i,\n\t\t\t\t\t\t\t\t\tdomNode: createFakeLinesDiv(),\n\t\t\t\t\t\t\t\t\theightInPx: (count - 1) * modLineHeight,\n\t\t\t\t\t\t\t\t\tshowInHiddenAreas: true,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmodViewZones.push({\n\t\t\t\t\t\t\tafterLineNumber: a.modifiedRange.startLineNumber - 1,\n\t\t\t\t\t\t\tdomNode: deletedCodeDomNode,\n\t\t\t\t\t\t\theightInPx: result.heightInLines * modLineHeight,\n\t\t\t\t\t\t\tminWidthInPx: result.minWidthInPx,\n\t\t\t\t\t\t\tmarginDomNode,\n\t\t\t\t\t\t\tsetZoneId(id) { zoneId = id; },\n\t\t\t\t\t\t\tshowInHiddenAreas: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst marginDomNode = document.createElement('div');\n\t\t\t\t\tmarginDomNode.className = 'gutter-delete';\n\n\t\t\t\t\torigViewZones.push({\n\t\t\t\t\t\tafterLineNumber: a.originalRange.endLineNumberExclusive - 1,\n\t\t\t\t\t\tdomNode: createFakeLinesDiv(),\n\t\t\t\t\t\theightInPx: a.modifiedHeightInPx,\n\t\t\t\t\t\tmarginDomNode,\n\t\t\t\t\t\tshowInHiddenAreas: true,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst delta = a.modifiedHeightInPx - a.originalHeightInPx;\n\t\t\t\t\tif (delta > 0) {\n\t\t\t\t\t\tif (syncedMovedText?.lineRangeMapping.original.delta(-1).deltaLength(2).contains(a.originalRange.endLineNumberExclusive - 1)) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\torigViewZones.push({\n\t\t\t\t\t\t\tafterLineNumber: a.originalRange.endLineNumberExclusive - 1,\n\t\t\t\t\t\t\tdomNode: createFakeLinesDiv(),\n\t\t\t\t\t\t\theightInPx: delta,\n\t\t\t\t\t\t\tshowInHiddenAreas: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (syncedMovedText?.lineRangeMapping.modified.delta(-1).deltaLength(2).contains(a.modifiedRange.endLineNumberExclusive - 1)) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfunction createViewZoneMarginArrow(): HTMLElement {\n\t\t\t\t\t\t\tconst arrow = document.createElement('div');\n\t\t\t\t\t\t\tarrow.className = 'arrow-revert-change ' + ThemeIcon.asClassName(Codicon.arrowRight);\n\t\t\t\t\t\t\treturn $('div', {}, arrow);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet marginDomNode: HTMLElement | undefined = undefined;\n\t\t\t\t\t\tif (a.diff && a.diff.modified.isEmpty && this._options.shouldRenderRevertArrows.read(reader)) {\n\t\t\t\t\t\t\tmarginDomNode = createViewZoneMarginArrow();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmodViewZones.push({\n\t\t\t\t\t\t\tafterLineNumber: a.modifiedRange.endLineNumberExclusive - 1,\n\t\t\t\t\t\t\tdomNode: createFakeLinesDiv(),\n\t\t\t\t\t\t\theightInPx: -delta,\n\t\t\t\t\t\t\tmarginDomNode,\n\t\t\t\t\t\t\tshowInHiddenAreas: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const a of alignmentsSyncedMovedText.read(reader) ?? []) {\n\t\t\t\tif (!syncedMovedText?.lineRangeMapping.original.intersect(a.originalRange)\n\t\t\t\t\t|| !syncedMovedText?.lineRangeMapping.modified.intersect(a.modifiedRange)) {\n\t\t\t\t\t// ignore unrelated alignments outside the synced moved text\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst delta = a.modifiedHeightInPx - a.originalHeightInPx;\n\t\t\t\tif (delta > 0) {\n\t\t\t\t\torigViewZones.push({\n\t\t\t\t\t\tafterLineNumber: a.originalRange.endLineNumberExclusive - 1,\n\t\t\t\t\t\tdomNode: createFakeLinesDiv(),\n\t\t\t\t\t\theightInPx: delta,\n\t\t\t\t\t\tshowInHiddenAreas: true,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tmodViewZones.push({\n\t\t\t\t\t\tafterLineNumber: a.modifiedRange.endLineNumberExclusive - 1,\n\t\t\t\t\t\tdomNode: createFakeLinesDiv(),\n\t\t\t\t\t\theightInPx: -delta,\n\t\t\t\t\t\tshowInHiddenAreas: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn { orig: origViewZones, mod: modViewZones };\n\t\t});\n\n\t\tthis._register(autorunWithStore((reader) => {\n\t\t\t/** @description alignment viewzones */\n\t\t\tconst scrollState = StableEditorScrollState.capture(this._editors.modified);\n\n\t\t\tconst alignmentViewZones_ = alignmentViewZones.read(reader);\n\t\t\tisChangingViewZones = true;\n\t\t\tthis._editors.original.changeViewZones((aOrig) => {\n\t\t\t\tfor (const id of alignmentViewZoneIdsOrig) { aOrig.removeZone(id); }\n\t\t\t\talignmentViewZoneIdsOrig.clear();\n\t\t\t\tfor (const z of alignmentViewZones_.orig) {\n\t\t\t\t\tconst id = aOrig.addZone(z);\n\t\t\t\t\tif (z.setZoneId) {\n\t\t\t\t\t\tz.setZoneId(id);\n\t\t\t\t\t}\n\t\t\t\t\talignmentViewZoneIdsOrig.add(id);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis._editors.modified.changeViewZones(aMod => {\n\t\t\t\tfor (const id of alignmentViewZoneIdsMod) { aMod.removeZone(id); }\n\t\t\t\talignmentViewZoneIdsMod.clear();\n\t\t\t\tfor (const z of alignmentViewZones_.mod) {\n\t\t\t\t\tconst id = aMod.addZone(z);\n\t\t\t\t\tif (z.setZoneId) {\n\t\t\t\t\t\tz.setZoneId(id);\n\t\t\t\t\t}\n\t\t\t\t\talignmentViewZoneIdsMod.add(id);\n\t\t\t\t}\n\t\t\t});\n\t\t\tisChangingViewZones = false;\n\n\t\t\tscrollState.restore(this._editors.modified);\n\t\t}));\n\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis._editors.original.changeViewZones((a) => {\n\t\t\t\tfor (const id of alignmentViewZoneIdsOrig) { a.removeZone(id); }\n\t\t\t\talignmentViewZoneIdsOrig.clear();\n\t\t\t});\n\t\t\tthis._editors.modified.changeViewZones((a) => {\n\t\t\t\tfor (const id of alignmentViewZoneIdsMod) { a.removeZone(id); }\n\t\t\t\talignmentViewZoneIdsMod.clear();\n\t\t\t});\n\t\t}));\n\n\t\tlet ignoreChange = false;\n\t\tthis._register(this._editors.original.onDidScrollChange(e => {\n\t\t\tif (e.scrollLeftChanged && !ignoreChange) {\n\t\t\t\tignoreChange = true;\n\t\t\t\tthis._editors.modified.setScrollLeft(e.scrollLeft);\n\t\t\t\tignoreChange = false;\n\t\t\t}\n\t\t}));\n\t\tthis._register(this._editors.modified.onDidScrollChange(e => {\n\t\t\tif (e.scrollLeftChanged && !ignoreChange) {\n\t\t\t\tignoreChange = true;\n\t\t\t\tthis._editors.original.setScrollLeft(e.scrollLeft);\n\t\t\t\tignoreChange = false;\n\t\t\t}\n\t\t}));\n\n\t\tthis._originalScrollTop = observableFromEvent(this._editors.original.onDidScrollChange, () => this._editors.original.getScrollTop());\n\t\tthis._modifiedScrollTop = observableFromEvent(this._editors.modified.onDidScrollChange, () => this._editors.modified.getScrollTop());\n\n\t\t// origExtraHeight + origOffset - origScrollTop = modExtraHeight + modOffset - modScrollTop\n\n\t\t// origScrollTop = origExtraHeight + origOffset - modExtraHeight - modOffset + modScrollTop\n\t\t// modScrollTop = modExtraHeight + modOffset - origExtraHeight - origOffset + origScrollTop\n\n\t\t// origOffset - modOffset = heightOfLines(1..Y) - heightOfLines(1..X)\n\t\t// origScrollTop >= 0, modScrollTop >= 0\n\n\t\tthis._register(autorun(reader => {\n\t\t\t/** @description update scroll modified */\n\t\t\tconst newScrollTopModified = this._originalScrollTop.read(reader)\n\t\t\t\t- (this._originalScrollOffsetAnimated.get() - this._modifiedScrollOffsetAnimated.read(reader))\n\t\t\t\t- (this._originalTopPadding.get() - this._modifiedTopPadding.read(reader));\n\t\t\tif (newScrollTopModified !== this._editors.modified.getScrollTop()) {\n\t\t\t\tthis._editors.modified.setScrollTop(newScrollTopModified, ScrollType.Immediate);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(autorun(reader => {\n\t\t\t/** @description update scroll original */\n\t\t\tconst newScrollTopOriginal = this._modifiedScrollTop.read(reader)\n\t\t\t\t- (this._modifiedScrollOffsetAnimated.get() - this._originalScrollOffsetAnimated.read(reader))\n\t\t\t\t- (this._modifiedTopPadding.get() - this._originalTopPadding.read(reader));\n\t\t\tif (newScrollTopOriginal !== this._editors.original.getScrollTop()) {\n\t\t\t\tthis._editors.original.setScrollTop(newScrollTopOriginal, ScrollType.Immediate);\n\t\t\t}\n\t\t}));\n\n\n\t\tthis._register(autorun(reader => {\n\t\t\t/** @description update editor top offsets */\n\t\t\tconst m = this._diffModel.read(reader)?.movedTextToCompare.read(reader);\n\n\t\t\tlet deltaOrigToMod = 0;\n\t\t\tif (m) {\n\t\t\t\tconst trueTopOriginal = this._editors.original.getTopForLineNumber(m.lineRangeMapping.original.startLineNumber, true) - this._originalTopPadding.get();\n\t\t\t\tconst trueTopModified = this._editors.modified.getTopForLineNumber(m.lineRangeMapping.modified.startLineNumber, true) - this._modifiedTopPadding.get();\n\t\t\t\tdeltaOrigToMod = trueTopModified - trueTopOriginal;\n\t\t\t}\n\n\t\t\tif (deltaOrigToMod > 0) {\n\t\t\t\tthis._modifiedTopPadding.set(0, undefined);\n\t\t\t\tthis._originalTopPadding.set(deltaOrigToMod, undefined);\n\t\t\t} else if (deltaOrigToMod < 0) {\n\t\t\t\tthis._modifiedTopPadding.set(-deltaOrigToMod, undefined);\n\t\t\t\tthis._originalTopPadding.set(0, undefined);\n\t\t\t} else {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis._modifiedTopPadding.set(0, undefined);\n\t\t\t\t\tthis._originalTopPadding.set(0, undefined);\n\t\t\t\t}, 400);\n\t\t\t}\n\n\t\t\tif (this._editors.modified.hasTextFocus()) {\n\t\t\t\tthis._originalScrollOffset.set(this._modifiedScrollOffset.get() - deltaOrigToMod, undefined, true);\n\t\t\t} else {\n\t\t\t\tthis._modifiedScrollOffset.set(this._originalScrollOffset.get() + deltaOrigToMod, undefined, true);\n\t\t\t}\n\t\t}));\n\t}\n}\n\ninterface IViewZoneWithZoneId extends IViewZone {\n\t// Tells a view zone its id.\n\tsetZoneId?(zoneId: string): void;\n}\n\ninterface ILineRangeAlignment {\n\toriginalRange: LineRange;\n\tmodifiedRange: LineRange;\n\n\t// accounts for foreign viewzones and line wrapping\n\toriginalHeightInPx: number;\n\tmodifiedHeightInPx: number;\n\n\t/**\n\t * If this range alignment is a direct result of a diff, then this is the diff's line mapping.\n\t * Only used for inline-view.\n\t */\n\tdiff?: DetailedLineRangeMapping;\n}\n\nfunction computeRangeAlignment(\n\toriginalEditor: CodeEditorWidget,\n\tmodifiedEditor: CodeEditorWidget,\n\tdiffs: readonly DiffMapping[],\n\toriginalEditorAlignmentViewZones: ReadonlySet<string>,\n\tmodifiedEditorAlignmentViewZones: ReadonlySet<string>,\n\tinnerHunkAlignment: boolean,\n): ILineRangeAlignment[] {\n\tconst originalLineHeightOverrides = new ArrayQueue(getAdditionalLineHeights(originalEditor, originalEditorAlignmentViewZones));\n\tconst modifiedLineHeightOverrides = new ArrayQueue(getAdditionalLineHeights(modifiedEditor, modifiedEditorAlignmentViewZones));\n\n\tconst origLineHeight = originalEditor.getOption(EditorOption.lineHeight);\n\tconst modLineHeight = modifiedEditor.getOption(EditorOption.lineHeight);\n\n\tconst result: ILineRangeAlignment[] = [];\n\n\tlet lastOriginalLineNumber = 0;\n\tlet lastModifiedLineNumber = 0;\n\n\tfunction handleAlignmentsOutsideOfDiffs(untilOriginalLineNumberExclusive: number, untilModifiedLineNumberExclusive: number) {\n\t\twhile (true) {\n\t\t\tlet origNext = originalLineHeightOverrides.peek();\n\t\t\tlet modNext = modifiedLineHeightOverrides.peek();\n\t\t\tif (origNext && origNext.lineNumber >= untilOriginalLineNumberExclusive) {\n\t\t\t\torigNext = undefined;\n\t\t\t}\n\t\t\tif (modNext && modNext.lineNumber >= untilModifiedLineNumberExclusive) {\n\t\t\t\tmodNext = undefined;\n\t\t\t}\n\t\t\tif (!origNext && !modNext) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst distOrig = origNext ? origNext.lineNumber - lastOriginalLineNumber : Number.MAX_VALUE;\n\t\t\tconst distNext = modNext ? modNext.lineNumber - lastModifiedLineNumber : Number.MAX_VALUE;\n\n\t\t\tif (distOrig < distNext) {\n\t\t\t\toriginalLineHeightOverrides.dequeue();\n\t\t\t\tmodNext = {\n\t\t\t\t\tlineNumber: origNext!.lineNumber - lastOriginalLineNumber + lastModifiedLineNumber,\n\t\t\t\t\theightInPx: 0,\n\t\t\t\t};\n\t\t\t} else if (distOrig > distNext) {\n\t\t\t\tmodifiedLineHeightOverrides.dequeue();\n\t\t\t\torigNext = {\n\t\t\t\t\tlineNumber: modNext!.lineNumber - lastModifiedLineNumber + lastOriginalLineNumber,\n\t\t\t\t\theightInPx: 0,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\toriginalLineHeightOverrides.dequeue();\n\t\t\t\tmodifiedLineHeightOverrides.dequeue();\n\t\t\t}\n\n\t\t\tresult.push({\n\t\t\t\toriginalRange: LineRange.ofLength(origNext!.lineNumber, 1),\n\t\t\t\tmodifiedRange: LineRange.ofLength(modNext!.lineNumber, 1),\n\t\t\t\toriginalHeightInPx: origLineHeight + origNext!.heightInPx,\n\t\t\t\tmodifiedHeightInPx: modLineHeight + modNext!.heightInPx,\n\t\t\t\tdiff: undefined,\n\t\t\t});\n\t\t}\n\t}\n\n\tfor (const m of diffs) {\n\t\tconst c = m.lineRangeMapping;\n\t\thandleAlignmentsOutsideOfDiffs(c.original.startLineNumber, c.modified.startLineNumber);\n\n\t\tlet first = true;\n\t\tlet lastModLineNumber = c.modified.startLineNumber;\n\t\tlet lastOrigLineNumber = c.original.startLineNumber;\n\n\t\tfunction emitAlignment(origLineNumberExclusive: number, modLineNumberExclusive: number) {\n\t\t\tif (origLineNumberExclusive < lastOrigLineNumber || modLineNumberExclusive < lastModLineNumber) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (first) {\n\t\t\t\tfirst = false;\n\t\t\t} else if (origLineNumberExclusive === lastOrigLineNumber || modLineNumberExclusive === lastModLineNumber) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst originalRange = new LineRange(lastOrigLineNumber, origLineNumberExclusive);\n\t\t\tconst modifiedRange = new LineRange(lastModLineNumber, modLineNumberExclusive);\n\t\t\tif (originalRange.isEmpty && modifiedRange.isEmpty) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst originalAdditionalHeight = originalLineHeightOverrides\n\t\t\t\t.takeWhile(v => v.lineNumber < origLineNumberExclusive)\n\t\t\t\t?.reduce((p, c) => p + c.heightInPx, 0) ?? 0;\n\t\t\tconst modifiedAdditionalHeight = modifiedLineHeightOverrides\n\t\t\t\t.takeWhile(v => v.lineNumber < modLineNumberExclusive)\n\t\t\t\t?.reduce((p, c) => p + c.heightInPx, 0) ?? 0;\n\n\t\t\tresult.push({\n\t\t\t\toriginalRange,\n\t\t\t\tmodifiedRange,\n\t\t\t\toriginalHeightInPx: originalRange.length * origLineHeight + originalAdditionalHeight,\n\t\t\t\tmodifiedHeightInPx: modifiedRange.length * modLineHeight + modifiedAdditionalHeight,\n\t\t\t\tdiff: m.lineRangeMapping,\n\t\t\t});\n\n\t\t\tlastOrigLineNumber = origLineNumberExclusive;\n\t\t\tlastModLineNumber = modLineNumberExclusive;\n\t\t}\n\n\t\tif (innerHunkAlignment) {\n\t\t\tfor (const i of c.innerChanges || []) {\n\t\t\t\tif (i.originalRange.startColumn > 1 && i.modifiedRange.startColumn > 1) {\n\t\t\t\t\t// There is some unmodified text on this line before the diff\n\t\t\t\t\temitAlignment(i.originalRange.startLineNumber, i.modifiedRange.startLineNumber);\n\t\t\t\t}\n\t\t\t\tif (i.originalRange.endColumn < originalEditor.getModel()!.getLineMaxColumn(i.originalRange.endLineNumber)) {\n\t\t\t\t\t// // There is some unmodified text on this line after the diff\n\t\t\t\t\temitAlignment(i.originalRange.endLineNumber, i.modifiedRange.endLineNumber);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\temitAlignment(c.original.endLineNumberExclusive, c.modified.endLineNumberExclusive);\n\n\t\tlastOriginalLineNumber = c.original.endLineNumberExclusive;\n\t\tlastModifiedLineNumber = c.modified.endLineNumberExclusive;\n\t}\n\thandleAlignmentsOutsideOfDiffs(Number.MAX_VALUE, Number.MAX_VALUE);\n\n\treturn result;\n}\n\ninterface AdditionalLineHeightInfo {\n\tlineNumber: number;\n\theightInPx: number;\n}\n\nfunction getAdditionalLineHeights(editor: CodeEditorWidget, viewZonesToIgnore: ReadonlySet<string>): readonly AdditionalLineHeightInfo[] {\n\tconst viewZoneHeights: { lineNumber: number; heightInPx: number }[] = [];\n\tconst wrappingZoneHeights: { lineNumber: number; heightInPx: number }[] = [];\n\n\tconst hasWrapping = editor.getOption(EditorOption.wrappingInfo).wrappingColumn !== -1;\n\tconst coordinatesConverter = editor._getViewModel()!.coordinatesConverter;\n\tconst editorLineHeight = editor.getOption(EditorOption.lineHeight);\n\tif (hasWrapping) {\n\t\tfor (let i = 1; i <= editor.getModel()!.getLineCount(); i++) {\n\t\t\tconst lineCount = coordinatesConverter.getModelLineViewLineCount(i);\n\t\t\tif (lineCount > 1) {\n\t\t\t\twrappingZoneHeights.push({ lineNumber: i, heightInPx: editorLineHeight * (lineCount - 1) });\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (const w of editor.getWhitespaces()) {\n\t\tif (viewZonesToIgnore.has(w.id)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst modelLineNumber = w.afterLineNumber === 0 ? 0 : coordinatesConverter.convertViewPositionToModelPosition(\n\t\t\tnew Position(w.afterLineNumber, 1)\n\t\t).lineNumber;\n\t\tviewZoneHeights.push({ lineNumber: modelLineNumber, heightInPx: w.height });\n\t}\n\n\tconst result = joinCombine(\n\t\tviewZoneHeights,\n\t\twrappingZoneHeights,\n\t\tv => v.lineNumber,\n\t\t(v1, v2) => ({ lineNumber: v1.lineNumber, heightInPx: v1.heightInPx + v2.heightInPx })\n\t);\n\n\treturn result;\n}\n"]}