{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/browser/widget/diffEditor/utils.ts"],"names":[],"mappings":"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","file":"utils.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IDimension } from 'vs/base/browser/dom';\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { isHotReloadEnabled, registerHotReloadHandler } from 'vs/base/common/hotReload';\nimport { Disposable, DisposableStore, IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { IObservable, IReader, ISettableObservable, autorun, autorunHandleChanges, autorunOpts, observableFromEvent, observableSignalFromEvent, observableValue, transaction } from 'vs/base/common/observable';\nimport { ElementSizeObserver } from 'vs/editor/browser/config/elementSizeObserver';\nimport { ICodeEditor, IOverlayWidget, IViewZone } from 'vs/editor/browser/editorBrowser';\nimport { IModelDeltaDecoration } from 'vs/editor/common/model';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\n\nexport function joinCombine<T>(arr1: readonly T[], arr2: readonly T[], keySelector: (val: T) => number, combine: (v1: T, v2: T) => T): readonly T[] {\n\tif (arr1.length === 0) {\n\t\treturn arr2;\n\t}\n\tif (arr2.length === 0) {\n\t\treturn arr1;\n\t}\n\n\tconst result: T[] = [];\n\tlet i = 0;\n\tlet j = 0;\n\twhile (i < arr1.length && j < arr2.length) {\n\t\tconst val1 = arr1[i];\n\t\tconst val2 = arr2[j];\n\t\tconst key1 = keySelector(val1);\n\t\tconst key2 = keySelector(val2);\n\n\t\tif (key1 < key2) {\n\t\t\tresult.push(val1);\n\t\t\ti++;\n\t\t} else if (key1 > key2) {\n\t\t\tresult.push(val2);\n\t\t\tj++;\n\t\t} else {\n\t\t\tresult.push(combine(val1, val2));\n\t\t\ti++;\n\t\t\tj++;\n\t\t}\n\t}\n\twhile (i < arr1.length) {\n\t\tresult.push(arr1[i]);\n\t\ti++;\n\t}\n\twhile (j < arr2.length) {\n\t\tresult.push(arr2[j]);\n\t\tj++;\n\t}\n\treturn result;\n}\n\n// TODO make utility\nexport function applyObservableDecorations(editor: ICodeEditor, decorations: IObservable<IModelDeltaDecoration[]>): IDisposable {\n\tconst d = new DisposableStore();\n\tconst decorationsCollection = editor.createDecorationsCollection();\n\td.add(autorunOpts({ debugName: () => `Apply decorations from ${decorations.debugName}` }, reader => {\n\t\tconst d = decorations.read(reader);\n\t\tdecorationsCollection.set(d);\n\t}));\n\td.add({\n\t\tdispose: () => {\n\t\t\tdecorationsCollection.clear();\n\t\t}\n\t});\n\treturn d;\n}\n\nexport function appendRemoveOnDispose(parent: HTMLElement, child: HTMLElement) {\n\tparent.appendChild(child);\n\treturn toDisposable(() => {\n\t\tparent.removeChild(child);\n\t});\n}\n\nexport function observableConfigValue<T>(key: string, defaultValue: T, configurationService: IConfigurationService): IObservable<T> {\n\treturn observableFromEvent(\n\t\t(handleChange) => configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(key)) {\n\t\t\t\thandleChange(e);\n\t\t\t}\n\t\t}),\n\t\t() => configurationService.getValue<T>(key) ?? defaultValue,\n\t);\n}\n\nexport class ObservableElementSizeObserver extends Disposable {\n\tprivate readonly elementSizeObserver: ElementSizeObserver;\n\n\tprivate readonly _width: ISettableObservable<number>;\n\tpublic get width(): ISettableObservable<number> { return this._width; }\n\n\tprivate readonly _height: ISettableObservable<number>;\n\tpublic get height(): ISettableObservable<number> { return this._height; }\n\n\tconstructor(element: HTMLElement | null, dimension: IDimension | undefined) {\n\t\tsuper();\n\n\t\tthis.elementSizeObserver = this._register(new ElementSizeObserver(element, dimension));\n\t\tthis._width = observableValue(this, this.elementSizeObserver.getWidth());\n\t\tthis._height = observableValue(this, this.elementSizeObserver.getHeight());\n\n\t\tthis._register(this.elementSizeObserver.onDidChange(e => transaction(tx => {\n\t\t\t/** @description Set width/height from elementSizeObserver */\n\t\t\tthis._width.set(this.elementSizeObserver.getWidth(), tx);\n\t\t\tthis._height.set(this.elementSizeObserver.getHeight(), tx);\n\t\t})));\n\t}\n\n\tpublic observe(dimension?: IDimension): void {\n\t\tthis.elementSizeObserver.observe(dimension);\n\t}\n\n\tpublic setAutomaticLayout(automaticLayout: boolean): void {\n\t\tif (automaticLayout) {\n\t\t\tthis.elementSizeObserver.startObserving();\n\t\t} else {\n\t\t\tthis.elementSizeObserver.stopObserving();\n\t\t}\n\t}\n}\n\nexport function animatedObservable(base: IObservable<number, boolean>, store: DisposableStore): IObservable<number> {\n\tlet targetVal = base.get();\n\tlet startVal = targetVal;\n\tlet curVal = targetVal;\n\tconst result = observableValue('animatedValue', targetVal);\n\n\tlet animationStartMs: number = -1;\n\tconst durationMs = 300;\n\tlet animationFrame: number | undefined = undefined;\n\n\tstore.add(autorunHandleChanges({\n\t\tcreateEmptyChangeSummary: () => ({ animate: false }),\n\t\thandleChange: (ctx, s) => {\n\t\t\tif (ctx.didChange(base)) {\n\t\t\t\ts.animate = s.animate || ctx.change;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t}, (reader, s) => {\n\t\t/** @description update value */\n\t\tif (animationFrame !== undefined) {\n\t\t\tcancelAnimationFrame(animationFrame);\n\t\t\tanimationFrame = undefined;\n\t\t}\n\n\t\tstartVal = curVal;\n\t\ttargetVal = base.read(reader);\n\t\tanimationStartMs = Date.now() - (s.animate ? 0 : durationMs);\n\n\t\tupdate();\n\t}));\n\n\tfunction update() {\n\t\tconst passedMs = Date.now() - animationStartMs;\n\t\tcurVal = Math.floor(easeOutExpo(passedMs, startVal, targetVal - startVal, durationMs));\n\n\t\tif (passedMs < durationMs) {\n\t\t\tanimationFrame = requestAnimationFrame(update);\n\t\t} else {\n\t\t\tcurVal = targetVal;\n\t\t}\n\n\t\tresult.set(curVal, undefined);\n\t}\n\n\treturn result;\n}\n\nfunction easeOutExpo(t: number, b: number, c: number, d: number): number {\n\treturn t === d ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\n}\n\nexport function deepMerge<T extends {}>(source1: T, source2: Partial<T>): T {\n\tconst result = {} as T;\n\tfor (const key in source1) {\n\t\tresult[key] = source1[key];\n\t}\n\tfor (const key in source2) {\n\t\tconst source2Value = source2[key];\n\t\tif (typeof result[key] === 'object' && source2Value && typeof source2Value === 'object') {\n\t\t\tresult[key] = deepMerge<any>(result[key], source2Value);\n\t\t} else {\n\t\t\tresult[key] = source2Value as any;\n\t\t}\n\t}\n\treturn result;\n}\n\nexport abstract class ViewZoneOverlayWidget extends Disposable {\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\tviewZone: PlaceholderViewZone,\n\t\thtmlElement: HTMLElement,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(new ManagedOverlayWidget(editor, htmlElement));\n\t\tthis._register(applyStyle(htmlElement, {\n\t\t\theight: viewZone.actualHeight,\n\t\t\ttop: viewZone.actualTop,\n\t\t}));\n\t}\n}\n\nexport interface IObservableViewZone extends IViewZone {\n\tonChange?: IObservable<unknown>;\n}\n\nexport class PlaceholderViewZone implements IObservableViewZone {\n\tpublic readonly domNode = document.createElement('div');\n\n\tprivate readonly _actualTop = observableValue<number | undefined>(this, undefined);\n\tprivate readonly _actualHeight = observableValue<number | undefined>(this, undefined);\n\n\tpublic readonly actualTop: IObservable<number | undefined> = this._actualTop;\n\tpublic readonly actualHeight: IObservable<number | undefined> = this._actualHeight;\n\n\tpublic readonly showInHiddenAreas = true;\n\n\tpublic get afterLineNumber(): number { return this._afterLineNumber.get(); }\n\n\tpublic readonly onChange?: IObservable<unknown> = this._afterLineNumber;\n\n\tconstructor(\n\t\tprivate readonly _afterLineNumber: IObservable<number>,\n\t\tpublic readonly heightInPx: number,\n\t) {\n\t}\n\n\tonDomNodeTop = (top: number) => {\n\t\tthis._actualTop.set(top, undefined);\n\t};\n\n\tonComputedHeight = (height: number) => {\n\t\tthis._actualHeight.set(height, undefined);\n\t};\n}\n\n\nexport class ManagedOverlayWidget implements IDisposable {\n\tprivate static _counter = 0;\n\tprivate readonly _overlayWidgetId = `managedOverlayWidget-${ManagedOverlayWidget._counter++}`;\n\n\tprivate readonly _overlayWidget: IOverlayWidget = {\n\t\tgetId: () => this._overlayWidgetId,\n\t\tgetDomNode: () => this._domElement,\n\t\tgetPosition: () => null\n\t};\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\tprivate readonly _domElement: HTMLElement,\n\t) {\n\t\tthis._editor.addOverlayWidget(this._overlayWidget);\n\t}\n\n\tdispose(): void {\n\t\tthis._editor.removeOverlayWidget(this._overlayWidget);\n\t}\n}\n\nexport interface CSSStyle {\n\theight: number | string;\n\twidth: number | string;\n\ttop: number | string;\n\tvisibility: 'visible' | 'hidden' | 'collapse';\n\tdisplay: 'block' | 'inline' | 'inline-block' | 'flex' | 'none';\n\tpaddingLeft: number | string;\n\tpaddingRight: number | string;\n}\n\nexport function applyStyle(domNode: HTMLElement, style: Partial<{ [TKey in keyof CSSStyle]: CSSStyle[TKey] | IObservable<CSSStyle[TKey] | undefined> | undefined }>) {\n\treturn autorun(reader => {\n\t\t/** @description applyStyle */\n\t\tfor (let [key, val] of Object.entries(style)) {\n\t\t\tif (val && typeof val === 'object' && 'read' in val) {\n\t\t\t\tval = val.read(reader) as any;\n\t\t\t}\n\t\t\tif (typeof val === 'number') {\n\t\t\t\tval = `${val}px`;\n\t\t\t}\n\t\t\tkey = key.replace(/[A-Z]/g, m => '-' + m.toLowerCase());\n\t\t\tdomNode.style[key as any] = val as any;\n\t\t}\n\t});\n}\n\nexport function readHotReloadableExport<T>(value: T, reader: IReader | undefined): T {\n\tobserveHotReloadableExports([value], reader);\n\treturn value;\n}\n\nexport function observeHotReloadableExports(values: any[], reader: IReader | undefined): void {\n\tif (isHotReloadEnabled()) {\n\t\tconst o = observableSignalFromEvent(\n\t\t\t'reload',\n\t\t\tevent => registerHotReloadHandler(oldExports => {\n\t\t\t\tif (![...Object.values(oldExports)].some(v => values.includes(v))) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn (_newExports) => {\n\t\t\t\t\tevent(undefined);\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\t\t\t})\n\t\t);\n\t\to.read(reader);\n\t}\n}\n\nexport function applyViewZones(editor: ICodeEditor, viewZones: IObservable<IObservableViewZone[]>, setIsUpdating?: (isUpdatingViewZones: boolean) => void): IDisposable {\n\tconst store = new DisposableStore();\n\tconst lastViewZoneIds: string[] = [];\n\n\tstore.add(autorun(reader => {\n\t\t/** @description applyViewZones */\n\t\tconst curViewZones = viewZones.read(reader);\n\n\t\tconst viewZonIdsPerViewZone = new Map<IObservableViewZone, string>();\n\t\tconst viewZoneIdPerOnChangeObservable = new Map<IObservable<unknown>, string>();\n\n\t\tif (setIsUpdating) { setIsUpdating(true); }\n\t\teditor.changeViewZones(a => {\n\t\t\tfor (const id of lastViewZoneIds) { a.removeZone(id); }\n\t\t\tlastViewZoneIds.length = 0;\n\n\t\t\tfor (const z of curViewZones) {\n\t\t\t\tconst id = a.addZone(z);\n\t\t\t\tlastViewZoneIds.push(id);\n\t\t\t\tviewZonIdsPerViewZone.set(z, id);\n\t\t\t}\n\t\t});\n\t\tif (setIsUpdating) { setIsUpdating(false); }\n\n\t\tstore.add(autorunHandleChanges({\n\t\t\tcreateEmptyChangeSummary() {\n\t\t\t\treturn [] as string[];\n\t\t\t},\n\t\t\thandleChange(context, changeSummary) {\n\t\t\t\tconst id = viewZoneIdPerOnChangeObservable.get(context.changedObservable);\n\t\t\t\tif (id !== undefined) { changeSummary.push(id); }\n\t\t\t\treturn true;\n\t\t\t},\n\t\t}, (reader, changeSummary) => {\n\t\t\t/** @description layoutZone on change */\n\t\t\tfor (const vz of curViewZones) {\n\t\t\t\tif (vz.onChange) {\n\t\t\t\t\tviewZoneIdPerOnChangeObservable.set(vz.onChange, viewZonIdsPerViewZone.get(vz)!);\n\t\t\t\t\tvz.onChange.read(reader);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (setIsUpdating) { setIsUpdating(true); }\n\t\t\teditor.changeViewZones(a => { for (const id of changeSummary) { a.layoutZone(id); } });\n\t\t\tif (setIsUpdating) { setIsUpdating(false); }\n\t\t}));\n\t}));\n\n\tstore.add({\n\t\tdispose() {\n\t\t\tif (setIsUpdating) { setIsUpdating(true); }\n\t\t\teditor.changeViewZones(a => { for (const id of lastViewZoneIds) { a.removeZone(id); } });\n\t\t\tif (setIsUpdating) { setIsUpdating(false); }\n\t\t}\n\t});\n\n\treturn store;\n}\n\nexport class DisposableCancellationTokenSource extends CancellationTokenSource {\n\tpublic override dispose() {\n\t\tsuper.dispose(true);\n\t}\n}\n"]}