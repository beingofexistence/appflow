{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/browser/editorDom.ts"],"names":[],"mappings":"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","file":"editorDom.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from 'vs/base/browser/dom';\nimport { GlobalPointerMoveMonitor } from 'vs/base/browser/globalPointerMoveMonitor';\nimport { StandardMouseEvent } from 'vs/base/browser/mouseEvent';\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { asCssVariable } from 'vs/platform/theme/common/colorRegistry';\nimport { ThemeColor } from 'vs/base/common/themables';\n\n/**\n * Coordinates relative to the whole document (e.g. mouse event's pageX and pageY)\n */\nexport class PageCoordinates {\n\t_pageCoordinatesBrand: void = undefined;\n\n\tconstructor(\n\t\tpublic readonly x: number,\n\t\tpublic readonly y: number\n\t) { }\n\n\tpublic toClientCoordinates(): ClientCoordinates {\n\t\treturn new ClientCoordinates(this.x - window.scrollX, this.y - window.scrollY);\n\t}\n}\n\n/**\n * Coordinates within the application's client area (i.e. origin is document's scroll position).\n *\n * For example, clicking in the top-left corner of the client area will\n * always result in a mouse event with a client.x value of 0, regardless\n * of whether the page is scrolled horizontally.\n */\nexport class ClientCoordinates {\n\t_clientCoordinatesBrand: void = undefined;\n\n\tconstructor(\n\t\tpublic readonly clientX: number,\n\t\tpublic readonly clientY: number\n\t) { }\n\n\tpublic toPageCoordinates(): PageCoordinates {\n\t\treturn new PageCoordinates(this.clientX + window.scrollX, this.clientY + window.scrollY);\n\t}\n}\n\n/**\n * The position of the editor in the page.\n */\nexport class EditorPagePosition {\n\t_editorPagePositionBrand: void = undefined;\n\n\tconstructor(\n\t\tpublic readonly x: number,\n\t\tpublic readonly y: number,\n\t\tpublic readonly width: number,\n\t\tpublic readonly height: number\n\t) { }\n}\n\n/**\n * Coordinates relative to the the (top;left) of the editor that can be used safely with other internal editor metrics.\n * **NOTE**: This position is obtained by taking page coordinates and transforming them relative to the\n * editor's (top;left) position in a way in which scale transformations are taken into account.\n * **NOTE**: These coordinates could be negative if the mouse position is outside the editor.\n */\nexport class CoordinatesRelativeToEditor {\n\t_positionRelativeToEditorBrand: void = undefined;\n\n\tconstructor(\n\t\tpublic readonly x: number,\n\t\tpublic readonly y: number\n\t) { }\n}\n\nexport function createEditorPagePosition(editorViewDomNode: HTMLElement): EditorPagePosition {\n\tconst editorPos = dom.getDomNodePagePosition(editorViewDomNode);\n\treturn new EditorPagePosition(editorPos.left, editorPos.top, editorPos.width, editorPos.height);\n}\n\nexport function createCoordinatesRelativeToEditor(editorViewDomNode: HTMLElement, editorPagePosition: EditorPagePosition, pos: PageCoordinates) {\n\t// The editor's page position is read from the DOM using getBoundingClientRect().\n\t//\n\t// getBoundingClientRect() returns the actual dimensions, while offsetWidth and offsetHeight\n\t// reflect the unscaled size. We can use this difference to detect a transform:scale()\n\t// and we will apply the transformation in inverse to get mouse coordinates that make sense inside the editor.\n\t//\n\t// This could be expanded to cover rotation as well maybe by walking the DOM up from `editorViewDomNode`\n\t// and computing the effective transformation matrix using getComputedStyle(element).transform.\n\t//\n\tconst scaleX = editorPagePosition.width / editorViewDomNode.offsetWidth;\n\tconst scaleY = editorPagePosition.height / editorViewDomNode.offsetHeight;\n\n\t// Adjust mouse offsets if editor appears to be scaled via transforms\n\tconst relativeX = (pos.x - editorPagePosition.x) / scaleX;\n\tconst relativeY = (pos.y - editorPagePosition.y) / scaleY;\n\treturn new CoordinatesRelativeToEditor(relativeX, relativeY);\n}\n\nexport class EditorMouseEvent extends StandardMouseEvent {\n\t_editorMouseEventBrand: void = undefined;\n\n\t/**\n\t * If the event is a result of using `setPointerCapture`, the `event.target`\n\t * does not necessarily reflect the position in the editor.\n\t */\n\tpublic readonly isFromPointerCapture: boolean;\n\n\t/**\n\t * Coordinates relative to the whole document.\n\t */\n\tpublic readonly pos: PageCoordinates;\n\n\t/**\n\t * Editor's coordinates relative to the whole document.\n\t */\n\tpublic readonly editorPos: EditorPagePosition;\n\n\t/**\n\t * Coordinates relative to the (top;left) of the editor.\n\t * *NOTE*: These coordinates are preferred because they take into account transformations applied to the editor.\n\t * *NOTE*: These coordinates could be negative if the mouse position is outside the editor.\n\t */\n\tpublic readonly relativePos: CoordinatesRelativeToEditor;\n\n\tconstructor(e: MouseEvent, isFromPointerCapture: boolean, editorViewDomNode: HTMLElement) {\n\t\tsuper(e);\n\t\tthis.isFromPointerCapture = isFromPointerCapture;\n\t\tthis.pos = new PageCoordinates(this.posx, this.posy);\n\t\tthis.editorPos = createEditorPagePosition(editorViewDomNode);\n\t\tthis.relativePos = createCoordinatesRelativeToEditor(editorViewDomNode, this.editorPos, this.pos);\n\t}\n}\n\nexport class EditorMouseEventFactory {\n\n\tprivate readonly _editorViewDomNode: HTMLElement;\n\n\tconstructor(editorViewDomNode: HTMLElement) {\n\t\tthis._editorViewDomNode = editorViewDomNode;\n\t}\n\n\tprivate _create(e: MouseEvent): EditorMouseEvent {\n\t\treturn new EditorMouseEvent(e, false, this._editorViewDomNode);\n\t}\n\n\tpublic onContextMenu(target: HTMLElement, callback: (e: EditorMouseEvent) => void): IDisposable {\n\t\treturn dom.addDisposableListener(target, 'contextmenu', (e: MouseEvent) => {\n\t\t\tcallback(this._create(e));\n\t\t});\n\t}\n\n\tpublic onMouseUp(target: HTMLElement, callback: (e: EditorMouseEvent) => void): IDisposable {\n\t\treturn dom.addDisposableListener(target, 'mouseup', (e: MouseEvent) => {\n\t\t\tcallback(this._create(e));\n\t\t});\n\t}\n\n\tpublic onMouseDown(target: HTMLElement, callback: (e: EditorMouseEvent) => void): IDisposable {\n\t\treturn dom.addDisposableListener(target, dom.EventType.MOUSE_DOWN, (e: MouseEvent) => {\n\t\t\tcallback(this._create(e));\n\t\t});\n\t}\n\n\tpublic onPointerDown(target: HTMLElement, callback: (e: EditorMouseEvent, pointerId: number) => void): IDisposable {\n\t\treturn dom.addDisposableListener(target, dom.EventType.POINTER_DOWN, (e: PointerEvent) => {\n\t\t\tcallback(this._create(e), e.pointerId);\n\t\t});\n\t}\n\n\tpublic onMouseLeave(target: HTMLElement, callback: (e: EditorMouseEvent) => void): IDisposable {\n\t\treturn dom.addDisposableListener(target, dom.EventType.MOUSE_LEAVE, (e: MouseEvent) => {\n\t\t\tcallback(this._create(e));\n\t\t});\n\t}\n\n\tpublic onMouseMove(target: HTMLElement, callback: (e: EditorMouseEvent) => void): IDisposable {\n\t\treturn dom.addDisposableListener(target, 'mousemove', (e) => callback(this._create(e)));\n\t}\n}\n\nexport class EditorPointerEventFactory {\n\n\tprivate readonly _editorViewDomNode: HTMLElement;\n\n\tconstructor(editorViewDomNode: HTMLElement) {\n\t\tthis._editorViewDomNode = editorViewDomNode;\n\t}\n\n\tprivate _create(e: MouseEvent): EditorMouseEvent {\n\t\treturn new EditorMouseEvent(e, false, this._editorViewDomNode);\n\t}\n\n\tpublic onPointerUp(target: HTMLElement, callback: (e: EditorMouseEvent) => void): IDisposable {\n\t\treturn dom.addDisposableListener(target, 'pointerup', (e: MouseEvent) => {\n\t\t\tcallback(this._create(e));\n\t\t});\n\t}\n\n\tpublic onPointerDown(target: HTMLElement, callback: (e: EditorMouseEvent, pointerId: number) => void): IDisposable {\n\t\treturn dom.addDisposableListener(target, dom.EventType.POINTER_DOWN, (e: PointerEvent) => {\n\t\t\tcallback(this._create(e), e.pointerId);\n\t\t});\n\t}\n\n\tpublic onPointerLeave(target: HTMLElement, callback: (e: EditorMouseEvent) => void): IDisposable {\n\t\treturn dom.addDisposableListener(target, dom.EventType.POINTER_LEAVE, (e: MouseEvent) => {\n\t\t\tcallback(this._create(e));\n\t\t});\n\t}\n\n\tpublic onPointerMove(target: HTMLElement, callback: (e: EditorMouseEvent) => void): IDisposable {\n\t\treturn dom.addDisposableListener(target, 'pointermove', (e) => callback(this._create(e)));\n\t}\n}\n\nexport class GlobalEditorPointerMoveMonitor extends Disposable {\n\n\tprivate readonly _editorViewDomNode: HTMLElement;\n\tprivate readonly _globalPointerMoveMonitor: GlobalPointerMoveMonitor;\n\tprivate _keydownListener: IDisposable | null;\n\n\tconstructor(editorViewDomNode: HTMLElement) {\n\t\tsuper();\n\t\tthis._editorViewDomNode = editorViewDomNode;\n\t\tthis._globalPointerMoveMonitor = this._register(new GlobalPointerMoveMonitor());\n\t\tthis._keydownListener = null;\n\t}\n\n\tpublic startMonitoring(\n\t\tinitialElement: Element,\n\t\tpointerId: number,\n\t\tinitialButtons: number,\n\t\tpointerMoveCallback: (e: EditorMouseEvent) => void,\n\t\tonStopCallback: (browserEvent?: PointerEvent | KeyboardEvent) => void\n\t): void {\n\n\t\t// Add a <<capture>> keydown event listener that will cancel the monitoring\n\t\t// if something other than a modifier key is pressed\n\t\tthis._keydownListener = dom.addStandardDisposableListener(<any>initialElement.ownerDocument, 'keydown', (e) => {\n\t\t\tconst chord = e.toKeyCodeChord();\n\t\t\tif (chord.isModifierKey()) {\n\t\t\t\t// Allow modifier keys\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._globalPointerMoveMonitor.stopMonitoring(true, e.browserEvent);\n\t\t}, true);\n\n\t\tthis._globalPointerMoveMonitor.startMonitoring(\n\t\t\tinitialElement,\n\t\t\tpointerId,\n\t\t\tinitialButtons,\n\t\t\t(e) => {\n\t\t\t\tpointerMoveCallback(new EditorMouseEvent(e, true, this._editorViewDomNode));\n\t\t\t},\n\t\t\t(e) => {\n\t\t\t\tthis._keydownListener!.dispose();\n\t\t\t\tonStopCallback(e);\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic stopMonitoring(): void {\n\t\tthis._globalPointerMoveMonitor.stopMonitoring(true);\n\t}\n}\n\n\n/**\n * A helper to create dynamic css rules, bound to a class name.\n * Rules are reused.\n * Reference counting and delayed garbage collection ensure that no rules leak.\n*/\nexport class DynamicCssRules {\n\tprivate static _idPool = 0;\n\tprivate readonly _instanceId = ++DynamicCssRules._idPool;\n\tprivate _counter = 0;\n\tprivate readonly _rules = new Map<string, RefCountedCssRule>();\n\n\t// We delay garbage collection so that hanging rules can be reused.\n\tprivate readonly _garbageCollectionScheduler = new RunOnceScheduler(() => this.garbageCollect(), 1000);\n\n\tconstructor(private readonly _editor: ICodeEditor) {\n\t}\n\n\tpublic createClassNameRef(options: CssProperties): ClassNameReference {\n\t\tconst rule = this.getOrCreateRule(options);\n\t\trule.increaseRefCount();\n\n\t\treturn {\n\t\t\tclassName: rule.className,\n\t\t\tdispose: () => {\n\t\t\t\trule.decreaseRefCount();\n\t\t\t\tthis._garbageCollectionScheduler.schedule();\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate getOrCreateRule(properties: CssProperties): RefCountedCssRule {\n\t\tconst key = this.computeUniqueKey(properties);\n\t\tlet existingRule = this._rules.get(key);\n\t\tif (!existingRule) {\n\t\t\tconst counter = this._counter++;\n\t\t\texistingRule = new RefCountedCssRule(key, `dyn-rule-${this._instanceId}-${counter}`,\n\t\t\t\tdom.isInShadowDOM(this._editor.getContainerDomNode())\n\t\t\t\t\t? this._editor.getContainerDomNode()\n\t\t\t\t\t: undefined,\n\t\t\t\tproperties\n\t\t\t);\n\t\t\tthis._rules.set(key, existingRule);\n\t\t}\n\t\treturn existingRule;\n\t}\n\n\tprivate computeUniqueKey(properties: CssProperties): string {\n\t\treturn JSON.stringify(properties);\n\t}\n\n\tprivate garbageCollect() {\n\t\tfor (const rule of this._rules.values()) {\n\t\t\tif (!rule.hasReferences()) {\n\t\t\t\tthis._rules.delete(rule.key);\n\t\t\t\trule.dispose();\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport interface ClassNameReference extends IDisposable {\n\tclassName: string;\n}\n\nexport interface CssProperties {\n\tborder?: string;\n\tborderColor?: string | ThemeColor;\n\tborderRadius?: string;\n\tfontStyle?: string;\n\tfontWeight?: string;\n\tfontSize?: string;\n\tfontFamily?: string;\n\tunicodeBidi?: string;\n\ttextDecoration?: string;\n\tcolor?: string | ThemeColor;\n\tbackgroundColor?: string | ThemeColor;\n\topacity?: string;\n\tverticalAlign?: string;\n\tcursor?: string;\n\tmargin?: string;\n\tpadding?: string;\n\twidth?: string;\n\theight?: string;\n\tdisplay?: string;\n}\n\nclass RefCountedCssRule {\n\tprivate _referenceCount: number = 0;\n\tprivate _styleElement: HTMLStyleElement;\n\n\tconstructor(\n\t\tpublic readonly key: string,\n\t\tpublic readonly className: string,\n\t\t_containerElement: HTMLElement | undefined,\n\t\tpublic readonly properties: CssProperties,\n\t) {\n\t\tthis._styleElement = dom.createStyleSheet(\n\t\t\t_containerElement\n\t\t);\n\n\t\tthis._styleElement.textContent = this.getCssText(this.className, this.properties);\n\t}\n\n\tprivate getCssText(className: string, properties: CssProperties): string {\n\t\tlet str = `.${className} {`;\n\t\tfor (const prop in properties) {\n\t\t\tconst value = (properties as any)[prop] as string | ThemeColor;\n\t\t\tlet cssValue;\n\t\t\tif (typeof value === 'object') {\n\t\t\t\tcssValue = asCssVariable(value.id);\n\t\t\t} else {\n\t\t\t\tcssValue = value;\n\t\t\t}\n\n\t\t\tconst cssPropName = camelToDashes(prop);\n\t\t\tstr += `\\n\\t${cssPropName}: ${cssValue};`;\n\t\t}\n\t\tstr += `\\n}`;\n\t\treturn str;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._styleElement.remove();\n\t}\n\n\tpublic increaseRefCount(): void {\n\t\tthis._referenceCount++;\n\t}\n\n\tpublic decreaseRefCount(): void {\n\t\tthis._referenceCount--;\n\t}\n\n\tpublic hasReferences(): boolean {\n\t\treturn this._referenceCount > 0;\n\t}\n}\n\nfunction camelToDashes(str: string): string {\n\treturn str.replace(/(^[A-Z])/, ([first]) => first.toLowerCase())\n\t\t.replace(/([A-Z])/g, ([letter]) => `-${letter.toLowerCase()}`);\n}\n"]}