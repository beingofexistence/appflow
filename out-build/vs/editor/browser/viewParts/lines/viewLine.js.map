{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/browser/viewParts/lines/viewLine.ts"],"names":[],"mappings":"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","file":"viewLine.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as browser from 'vs/base/browser/browser';\nimport { FastDomNode, createFastDomNode } from 'vs/base/browser/fastDomNode';\nimport * as platform from 'vs/base/common/platform';\nimport { IVisibleLine } from 'vs/editor/browser/view/viewLayer';\nimport { RangeUtil } from 'vs/editor/browser/viewParts/lines/rangeUtil';\nimport { StringBuilder } from 'vs/editor/common/core/stringBuilder';\nimport { IEditorConfiguration } from 'vs/editor/common/config/editorConfiguration';\nimport { FloatHorizontalRange, VisibleRanges } from 'vs/editor/browser/view/renderingContext';\nimport { LineDecoration } from 'vs/editor/common/viewLayout/lineDecorations';\nimport { CharacterMapping, ForeignElementType, RenderLineInput, renderViewLine, LineRange, DomPosition } from 'vs/editor/common/viewLayout/viewLineRenderer';\nimport { ViewportData } from 'vs/editor/common/viewLayout/viewLinesViewportData';\nimport { InlineDecorationType } from 'vs/editor/common/viewModel';\nimport { ColorScheme, isHighContrast } from 'vs/platform/theme/common/theme';\nimport { EditorOption, EditorFontLigatures } from 'vs/editor/common/config/editorOptions';\nimport { DomReadingContext } from 'vs/editor/browser/viewParts/lines/domReadingContext';\n\nconst canUseFastRenderedViewLine = (function () {\n\tif (platform.isNative) {\n\t\t// In VSCode we know very well when the zoom level changes\n\t\treturn true;\n\t}\n\n\tif (platform.isLinux || browser.isFirefox || browser.isSafari) {\n\t\t// On Linux, it appears that zooming affects char widths (in pixels), which is unexpected.\n\t\t// --\n\t\t// Even though we read character widths correctly, having read them at a specific zoom level\n\t\t// does not mean they are the same at the current zoom level.\n\t\t// --\n\t\t// This could be improved if we ever figure out how to get an event when browsers zoom,\n\t\t// but until then we have to stick with reading client rects.\n\t\t// --\n\t\t// The same has been observed with Firefox on Windows7\n\t\t// --\n\t\t// The same has been oversved with Safari\n\t\treturn false;\n\t}\n\n\treturn true;\n})();\n\nlet monospaceAssumptionsAreValid = true;\n\nexport class ViewLineOptions {\n\tpublic readonly themeType: ColorScheme;\n\tpublic readonly renderWhitespace: 'none' | 'boundary' | 'selection' | 'trailing' | 'all';\n\tpublic readonly renderControlCharacters: boolean;\n\tpublic readonly spaceWidth: number;\n\tpublic readonly middotWidth: number;\n\tpublic readonly wsmiddotWidth: number;\n\tpublic readonly useMonospaceOptimizations: boolean;\n\tpublic readonly canUseHalfwidthRightwardsArrow: boolean;\n\tpublic readonly lineHeight: number;\n\tpublic readonly stopRenderingLineAfter: number;\n\tpublic readonly fontLigatures: string;\n\n\tconstructor(config: IEditorConfiguration, themeType: ColorScheme) {\n\t\tthis.themeType = themeType;\n\t\tconst options = config.options;\n\t\tconst fontInfo = options.get(EditorOption.fontInfo);\n\t\tconst experimentalWhitespaceRendering = options.get(EditorOption.experimentalWhitespaceRendering);\n\t\tif (experimentalWhitespaceRendering === 'off') {\n\t\t\tthis.renderWhitespace = options.get(EditorOption.renderWhitespace);\n\t\t} else {\n\t\t\t// whitespace is rendered in a different layer\n\t\t\tthis.renderWhitespace = 'none';\n\t\t}\n\t\tthis.renderControlCharacters = options.get(EditorOption.renderControlCharacters);\n\t\tthis.spaceWidth = fontInfo.spaceWidth;\n\t\tthis.middotWidth = fontInfo.middotWidth;\n\t\tthis.wsmiddotWidth = fontInfo.wsmiddotWidth;\n\t\tthis.useMonospaceOptimizations = (\n\t\t\tfontInfo.isMonospace\n\t\t\t&& !options.get(EditorOption.disableMonospaceOptimizations)\n\t\t);\n\t\tthis.canUseHalfwidthRightwardsArrow = fontInfo.canUseHalfwidthRightwardsArrow;\n\t\tthis.lineHeight = options.get(EditorOption.lineHeight);\n\t\tthis.stopRenderingLineAfter = options.get(EditorOption.stopRenderingLineAfter);\n\t\tthis.fontLigatures = options.get(EditorOption.fontLigatures);\n\t}\n\n\tpublic equals(other: ViewLineOptions): boolean {\n\t\treturn (\n\t\t\tthis.themeType === other.themeType\n\t\t\t&& this.renderWhitespace === other.renderWhitespace\n\t\t\t&& this.renderControlCharacters === other.renderControlCharacters\n\t\t\t&& this.spaceWidth === other.spaceWidth\n\t\t\t&& this.middotWidth === other.middotWidth\n\t\t\t&& this.wsmiddotWidth === other.wsmiddotWidth\n\t\t\t&& this.useMonospaceOptimizations === other.useMonospaceOptimizations\n\t\t\t&& this.canUseHalfwidthRightwardsArrow === other.canUseHalfwidthRightwardsArrow\n\t\t\t&& this.lineHeight === other.lineHeight\n\t\t\t&& this.stopRenderingLineAfter === other.stopRenderingLineAfter\n\t\t\t&& this.fontLigatures === other.fontLigatures\n\t\t);\n\t}\n}\n\nexport class ViewLine implements IVisibleLine {\n\n\tpublic static readonly CLASS_NAME = 'view-line';\n\n\tprivate _options: ViewLineOptions;\n\tprivate _isMaybeInvalid: boolean;\n\tprivate _renderedViewLine: IRenderedViewLine | null;\n\n\tconstructor(options: ViewLineOptions) {\n\t\tthis._options = options;\n\t\tthis._isMaybeInvalid = true;\n\t\tthis._renderedViewLine = null;\n\t}\n\n\t// --- begin IVisibleLineData\n\n\tpublic getDomNode(): HTMLElement | null {\n\t\tif (this._renderedViewLine && this._renderedViewLine.domNode) {\n\t\t\treturn this._renderedViewLine.domNode.domNode;\n\t\t}\n\t\treturn null;\n\t}\n\tpublic setDomNode(domNode: HTMLElement): void {\n\t\tif (this._renderedViewLine) {\n\t\t\tthis._renderedViewLine.domNode = createFastDomNode(domNode);\n\t\t} else {\n\t\t\tthrow new Error('I have no rendered view line to set the dom node to...');\n\t\t}\n\t}\n\n\tpublic onContentChanged(): void {\n\t\tthis._isMaybeInvalid = true;\n\t}\n\tpublic onTokensChanged(): void {\n\t\tthis._isMaybeInvalid = true;\n\t}\n\tpublic onDecorationsChanged(): void {\n\t\tthis._isMaybeInvalid = true;\n\t}\n\tpublic onOptionsChanged(newOptions: ViewLineOptions): void {\n\t\tthis._isMaybeInvalid = true;\n\t\tthis._options = newOptions;\n\t}\n\tpublic onSelectionChanged(): boolean {\n\t\tif (isHighContrast(this._options.themeType) || this._options.renderWhitespace === 'selection') {\n\t\t\tthis._isMaybeInvalid = true;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic renderLine(lineNumber: number, deltaTop: number, viewportData: ViewportData, sb: StringBuilder): boolean {\n\t\tif (this._isMaybeInvalid === false) {\n\t\t\t// it appears that nothing relevant has changed\n\t\t\treturn false;\n\t\t}\n\n\t\tthis._isMaybeInvalid = false;\n\n\t\tconst lineData = viewportData.getViewLineRenderingData(lineNumber);\n\t\tconst options = this._options;\n\t\tconst actualInlineDecorations = LineDecoration.filter(lineData.inlineDecorations, lineNumber, lineData.minColumn, lineData.maxColumn);\n\n\t\t// Only send selection information when needed for rendering whitespace\n\t\tlet selectionsOnLine: LineRange[] | null = null;\n\t\tif (isHighContrast(options.themeType) || this._options.renderWhitespace === 'selection') {\n\t\t\tconst selections = viewportData.selections;\n\t\t\tfor (const selection of selections) {\n\n\t\t\t\tif (selection.endLineNumber < lineNumber || selection.startLineNumber > lineNumber) {\n\t\t\t\t\t// Selection does not intersect line\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst startColumn = (selection.startLineNumber === lineNumber ? selection.startColumn : lineData.minColumn);\n\t\t\t\tconst endColumn = (selection.endLineNumber === lineNumber ? selection.endColumn : lineData.maxColumn);\n\n\t\t\t\tif (startColumn < endColumn) {\n\t\t\t\t\tif (isHighContrast(options.themeType)) {\n\t\t\t\t\t\tactualInlineDecorations.push(new LineDecoration(startColumn, endColumn, 'inline-selected-text', InlineDecorationType.Regular));\n\t\t\t\t\t}\n\t\t\t\t\tif (this._options.renderWhitespace === 'selection') {\n\t\t\t\t\t\tif (!selectionsOnLine) {\n\t\t\t\t\t\t\tselectionsOnLine = [];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tselectionsOnLine.push(new LineRange(startColumn - 1, endColumn - 1));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst renderLineInput = new RenderLineInput(\n\t\t\toptions.useMonospaceOptimizations,\n\t\t\toptions.canUseHalfwidthRightwardsArrow,\n\t\t\tlineData.content,\n\t\t\tlineData.continuesWithWrappedLine,\n\t\t\tlineData.isBasicASCII,\n\t\t\tlineData.containsRTL,\n\t\t\tlineData.minColumn - 1,\n\t\t\tlineData.tokens,\n\t\t\tactualInlineDecorations,\n\t\t\tlineData.tabSize,\n\t\t\tlineData.startVisibleColumn,\n\t\t\toptions.spaceWidth,\n\t\t\toptions.middotWidth,\n\t\t\toptions.wsmiddotWidth,\n\t\t\toptions.stopRenderingLineAfter,\n\t\t\toptions.renderWhitespace,\n\t\t\toptions.renderControlCharacters,\n\t\t\toptions.fontLigatures !== EditorFontLigatures.OFF,\n\t\t\tselectionsOnLine\n\t\t);\n\n\t\tif (this._renderedViewLine && this._renderedViewLine.input.equals(renderLineInput)) {\n\t\t\t// no need to do anything, we have the same render input\n\t\t\treturn false;\n\t\t}\n\n\t\tsb.appendString('<div style=\"top:');\n\t\tsb.appendString(String(deltaTop));\n\t\tsb.appendString('px;height:');\n\t\tsb.appendString(String(this._options.lineHeight));\n\t\tsb.appendString('px;\" class=\"');\n\t\tsb.appendString(ViewLine.CLASS_NAME);\n\t\tsb.appendString('\">');\n\n\t\tconst output = renderViewLine(renderLineInput, sb);\n\n\t\tsb.appendString('</div>');\n\n\t\tlet renderedViewLine: IRenderedViewLine | null = null;\n\t\tif (monospaceAssumptionsAreValid && canUseFastRenderedViewLine && lineData.isBasicASCII && options.useMonospaceOptimizations && output.containsForeignElements === ForeignElementType.None) {\n\t\t\trenderedViewLine = new FastRenderedViewLine(\n\t\t\t\tthis._renderedViewLine ? this._renderedViewLine.domNode : null,\n\t\t\t\trenderLineInput,\n\t\t\t\toutput.characterMapping\n\t\t\t);\n\t\t}\n\n\t\tif (!renderedViewLine) {\n\t\t\trenderedViewLine = createRenderedLine(\n\t\t\t\tthis._renderedViewLine ? this._renderedViewLine.domNode : null,\n\t\t\t\trenderLineInput,\n\t\t\t\toutput.characterMapping,\n\t\t\t\toutput.containsRTL,\n\t\t\t\toutput.containsForeignElements\n\t\t\t);\n\t\t}\n\n\t\tthis._renderedViewLine = renderedViewLine;\n\n\t\treturn true;\n\t}\n\n\tpublic layoutLine(lineNumber: number, deltaTop: number): void {\n\t\tif (this._renderedViewLine && this._renderedViewLine.domNode) {\n\t\t\tthis._renderedViewLine.domNode.setTop(deltaTop);\n\t\t\tthis._renderedViewLine.domNode.setHeight(this._options.lineHeight);\n\t\t}\n\t}\n\n\t// --- end IVisibleLineData\n\n\tpublic getWidth(context: DomReadingContext | null): number {\n\t\tif (!this._renderedViewLine) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn this._renderedViewLine.getWidth(context);\n\t}\n\n\tpublic getWidthIsFast(): boolean {\n\t\tif (!this._renderedViewLine) {\n\t\t\treturn true;\n\t\t}\n\t\treturn this._renderedViewLine.getWidthIsFast();\n\t}\n\n\tpublic needsMonospaceFontCheck(): boolean {\n\t\tif (!this._renderedViewLine) {\n\t\t\treturn false;\n\t\t}\n\t\treturn (this._renderedViewLine instanceof FastRenderedViewLine);\n\t}\n\n\tpublic monospaceAssumptionsAreValid(): boolean {\n\t\tif (!this._renderedViewLine) {\n\t\t\treturn monospaceAssumptionsAreValid;\n\t\t}\n\t\tif (this._renderedViewLine instanceof FastRenderedViewLine) {\n\t\t\treturn this._renderedViewLine.monospaceAssumptionsAreValid();\n\t\t}\n\t\treturn monospaceAssumptionsAreValid;\n\t}\n\n\tpublic onMonospaceAssumptionsInvalidated(): void {\n\t\tif (this._renderedViewLine && this._renderedViewLine instanceof FastRenderedViewLine) {\n\t\t\tthis._renderedViewLine = this._renderedViewLine.toSlowRenderedLine();\n\t\t}\n\t}\n\n\tpublic getVisibleRangesForRange(lineNumber: number, startColumn: number, endColumn: number, context: DomReadingContext): VisibleRanges | null {\n\t\tif (!this._renderedViewLine) {\n\t\t\treturn null;\n\t\t}\n\n\t\tstartColumn = Math.min(this._renderedViewLine.input.lineContent.length + 1, Math.max(1, startColumn));\n\t\tendColumn = Math.min(this._renderedViewLine.input.lineContent.length + 1, Math.max(1, endColumn));\n\n\t\tconst stopRenderingLineAfter = this._renderedViewLine.input.stopRenderingLineAfter;\n\n\t\tif (stopRenderingLineAfter !== -1 && startColumn > stopRenderingLineAfter + 1 && endColumn > stopRenderingLineAfter + 1) {\n\t\t\t// This range is obviously not visible\n\t\t\treturn new VisibleRanges(true, [new FloatHorizontalRange(this.getWidth(context), 0)]);\n\t\t}\n\n\t\tif (stopRenderingLineAfter !== -1 && startColumn > stopRenderingLineAfter + 1) {\n\t\t\tstartColumn = stopRenderingLineAfter + 1;\n\t\t}\n\n\t\tif (stopRenderingLineAfter !== -1 && endColumn > stopRenderingLineAfter + 1) {\n\t\t\tendColumn = stopRenderingLineAfter + 1;\n\t\t}\n\n\t\tconst horizontalRanges = this._renderedViewLine.getVisibleRangesForRange(lineNumber, startColumn, endColumn, context);\n\t\tif (horizontalRanges && horizontalRanges.length > 0) {\n\t\t\treturn new VisibleRanges(false, horizontalRanges);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tpublic getColumnOfNodeOffset(spanNode: HTMLElement, offset: number): number {\n\t\tif (!this._renderedViewLine) {\n\t\t\treturn 1;\n\t\t}\n\t\treturn this._renderedViewLine.getColumnOfNodeOffset(spanNode, offset);\n\t}\n}\n\ninterface IRenderedViewLine {\n\tdomNode: FastDomNode<HTMLElement> | null;\n\treadonly input: RenderLineInput;\n\tgetWidth(context: DomReadingContext | null): number;\n\tgetWidthIsFast(): boolean;\n\tgetVisibleRangesForRange(lineNumber: number, startColumn: number, endColumn: number, context: DomReadingContext): FloatHorizontalRange[] | null;\n\tgetColumnOfNodeOffset(spanNode: HTMLElement, offset: number): number;\n}\n\nconst enum Constants {\n\t/**\n\t * It seems that rounding errors occur with long lines, so the purely multiplication based\n\t * method is only viable for short lines. For longer lines, we look up the real position of\n\t * every 300th character and use multiplication based on that.\n\t *\n\t * See https://github.com/microsoft/vscode/issues/33178\n\t */\n\tMaxMonospaceDistance = 300\n}\n\n/**\n * A rendered line which is guaranteed to contain only regular ASCII and is rendered with a monospace font.\n */\nclass FastRenderedViewLine implements IRenderedViewLine {\n\n\tpublic domNode: FastDomNode<HTMLElement> | null;\n\tpublic readonly input: RenderLineInput;\n\n\tprivate readonly _characterMapping: CharacterMapping;\n\tprivate readonly _charWidth: number;\n\tprivate readonly _keyColumnPixelOffsetCache: Float32Array | null;\n\tprivate _cachedWidth: number = -1;\n\n\tconstructor(domNode: FastDomNode<HTMLElement> | null, renderLineInput: RenderLineInput, characterMapping: CharacterMapping) {\n\t\tthis.domNode = domNode;\n\t\tthis.input = renderLineInput;\n\t\tconst keyColumnCount = Math.floor(renderLineInput.lineContent.length / Constants.MaxMonospaceDistance);\n\t\tif (keyColumnCount > 0) {\n\t\t\tthis._keyColumnPixelOffsetCache = new Float32Array(keyColumnCount);\n\t\t\tfor (let i = 0; i < keyColumnCount; i++) {\n\t\t\t\tthis._keyColumnPixelOffsetCache[i] = -1;\n\t\t\t}\n\t\t} else {\n\t\t\tthis._keyColumnPixelOffsetCache = null;\n\t\t}\n\n\t\tthis._characterMapping = characterMapping;\n\t\tthis._charWidth = renderLineInput.spaceWidth;\n\t}\n\n\tpublic getWidth(context: DomReadingContext | null): number {\n\t\tif (!this.domNode || this.input.lineContent.length < Constants.MaxMonospaceDistance) {\n\t\t\tconst horizontalOffset = this._characterMapping.getHorizontalOffset(this._characterMapping.length);\n\t\t\treturn Math.round(this._charWidth * horizontalOffset);\n\t\t}\n\t\tif (this._cachedWidth === -1) {\n\t\t\tthis._cachedWidth = this._getReadingTarget(this.domNode).offsetWidth;\n\t\t\tcontext?.markDidDomLayout();\n\t\t}\n\t\treturn this._cachedWidth;\n\t}\n\n\tpublic getWidthIsFast(): boolean {\n\t\treturn (this.input.lineContent.length < Constants.MaxMonospaceDistance) || this._cachedWidth !== -1;\n\t}\n\n\tpublic monospaceAssumptionsAreValid(): boolean {\n\t\tif (!this.domNode) {\n\t\t\treturn monospaceAssumptionsAreValid;\n\t\t}\n\t\tif (this.input.lineContent.length < Constants.MaxMonospaceDistance) {\n\t\t\tconst expectedWidth = this.getWidth(null);\n\t\t\tconst actualWidth = (<HTMLSpanElement>this.domNode.domNode.firstChild).offsetWidth;\n\t\t\tif (Math.abs(expectedWidth - actualWidth) >= 2) {\n\t\t\t\t// more than 2px off\n\t\t\t\tconsole.warn(`monospace assumptions have been violated, therefore disabling monospace optimizations!`);\n\t\t\t\tmonospaceAssumptionsAreValid = false;\n\t\t\t}\n\t\t}\n\t\treturn monospaceAssumptionsAreValid;\n\t}\n\n\tpublic toSlowRenderedLine(): RenderedViewLine {\n\t\treturn createRenderedLine(this.domNode, this.input, this._characterMapping, false, ForeignElementType.None);\n\t}\n\n\tpublic getVisibleRangesForRange(lineNumber: number, startColumn: number, endColumn: number, context: DomReadingContext): FloatHorizontalRange[] | null {\n\t\tconst startPosition = this._getColumnPixelOffset(lineNumber, startColumn, context);\n\t\tconst endPosition = this._getColumnPixelOffset(lineNumber, endColumn, context);\n\t\treturn [new FloatHorizontalRange(startPosition, endPosition - startPosition)];\n\t}\n\n\tprivate _getColumnPixelOffset(lineNumber: number, column: number, context: DomReadingContext): number {\n\t\tif (column <= Constants.MaxMonospaceDistance) {\n\t\t\tconst horizontalOffset = this._characterMapping.getHorizontalOffset(column);\n\t\t\treturn this._charWidth * horizontalOffset;\n\t\t}\n\n\t\tconst keyColumnOrdinal = Math.floor((column - 1) / Constants.MaxMonospaceDistance) - 1;\n\t\tconst keyColumn = (keyColumnOrdinal + 1) * Constants.MaxMonospaceDistance + 1;\n\t\tlet keyColumnPixelOffset = -1;\n\t\tif (this._keyColumnPixelOffsetCache) {\n\t\t\tkeyColumnPixelOffset = this._keyColumnPixelOffsetCache[keyColumnOrdinal];\n\t\t\tif (keyColumnPixelOffset === -1) {\n\t\t\t\tkeyColumnPixelOffset = this._actualReadPixelOffset(lineNumber, keyColumn, context);\n\t\t\t\tthis._keyColumnPixelOffsetCache[keyColumnOrdinal] = keyColumnPixelOffset;\n\t\t\t}\n\t\t}\n\n\t\tif (keyColumnPixelOffset === -1) {\n\t\t\t// Could not read actual key column pixel offset\n\t\t\tconst horizontalOffset = this._characterMapping.getHorizontalOffset(column);\n\t\t\treturn this._charWidth * horizontalOffset;\n\t\t}\n\n\t\tconst keyColumnHorizontalOffset = this._characterMapping.getHorizontalOffset(keyColumn);\n\t\tconst horizontalOffset = this._characterMapping.getHorizontalOffset(column);\n\t\treturn keyColumnPixelOffset + this._charWidth * (horizontalOffset - keyColumnHorizontalOffset);\n\t}\n\n\tprivate _getReadingTarget(myDomNode: FastDomNode<HTMLElement>): HTMLElement {\n\t\treturn <HTMLSpanElement>myDomNode.domNode.firstChild;\n\t}\n\n\tprivate _actualReadPixelOffset(lineNumber: number, column: number, context: DomReadingContext): number {\n\t\tif (!this.domNode) {\n\t\t\treturn -1;\n\t\t}\n\t\tconst domPosition = this._characterMapping.getDomPosition(column);\n\t\tconst r = RangeUtil.readHorizontalRanges(this._getReadingTarget(this.domNode), domPosition.partIndex, domPosition.charIndex, domPosition.partIndex, domPosition.charIndex, context);\n\t\tif (!r || r.length === 0) {\n\t\t\treturn -1;\n\t\t}\n\t\treturn r[0].left;\n\t}\n\n\tpublic getColumnOfNodeOffset(spanNode: HTMLElement, offset: number): number {\n\t\treturn getColumnOfNodeOffset(this._characterMapping, spanNode, offset);\n\t}\n}\n\n/**\n * Every time we render a line, we save what we have rendered in an instance of this class.\n */\nclass RenderedViewLine implements IRenderedViewLine {\n\n\tpublic domNode: FastDomNode<HTMLElement> | null;\n\tpublic readonly input: RenderLineInput;\n\n\tprotected readonly _characterMapping: CharacterMapping;\n\tprivate readonly _isWhitespaceOnly: boolean;\n\tprivate readonly _containsForeignElements: ForeignElementType;\n\tprivate _cachedWidth: number;\n\n\t/**\n\t * This is a map that is used only when the line is guaranteed to have no RTL text.\n\t */\n\tprivate readonly _pixelOffsetCache: Float32Array | null;\n\n\tconstructor(domNode: FastDomNode<HTMLElement> | null, renderLineInput: RenderLineInput, characterMapping: CharacterMapping, containsRTL: boolean, containsForeignElements: ForeignElementType) {\n\t\tthis.domNode = domNode;\n\t\tthis.input = renderLineInput;\n\t\tthis._characterMapping = characterMapping;\n\t\tthis._isWhitespaceOnly = /^\\s*$/.test(renderLineInput.lineContent);\n\t\tthis._containsForeignElements = containsForeignElements;\n\t\tthis._cachedWidth = -1;\n\n\t\tthis._pixelOffsetCache = null;\n\t\tif (!containsRTL || this._characterMapping.length === 0 /* the line is empty */) {\n\t\t\tthis._pixelOffsetCache = new Float32Array(Math.max(2, this._characterMapping.length + 1));\n\t\t\tfor (let column = 0, len = this._characterMapping.length; column <= len; column++) {\n\t\t\t\tthis._pixelOffsetCache[column] = -1;\n\t\t\t}\n\t\t}\n\t}\n\n\t// --- Reading from the DOM methods\n\n\tprotected _getReadingTarget(myDomNode: FastDomNode<HTMLElement>): HTMLElement {\n\t\treturn <HTMLSpanElement>myDomNode.domNode.firstChild;\n\t}\n\n\t/**\n\t * Width of the line in pixels\n\t */\n\tpublic getWidth(context: DomReadingContext | null): number {\n\t\tif (!this.domNode) {\n\t\t\treturn 0;\n\t\t}\n\t\tif (this._cachedWidth === -1) {\n\t\t\tthis._cachedWidth = this._getReadingTarget(this.domNode).offsetWidth;\n\t\t\tcontext?.markDidDomLayout();\n\t\t}\n\t\treturn this._cachedWidth;\n\t}\n\n\tpublic getWidthIsFast(): boolean {\n\t\tif (this._cachedWidth === -1) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Visible ranges for a model range\n\t */\n\tpublic getVisibleRangesForRange(lineNumber: number, startColumn: number, endColumn: number, context: DomReadingContext): FloatHorizontalRange[] | null {\n\t\tif (!this.domNode) {\n\t\t\treturn null;\n\t\t}\n\t\tif (this._pixelOffsetCache !== null) {\n\t\t\t// the text is LTR\n\t\t\tconst startOffset = this._readPixelOffset(this.domNode, lineNumber, startColumn, context);\n\t\t\tif (startOffset === -1) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst endOffset = this._readPixelOffset(this.domNode, lineNumber, endColumn, context);\n\t\t\tif (endOffset === -1) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn [new FloatHorizontalRange(startOffset, endOffset - startOffset)];\n\t\t}\n\n\t\treturn this._readVisibleRangesForRange(this.domNode, lineNumber, startColumn, endColumn, context);\n\t}\n\n\tprotected _readVisibleRangesForRange(domNode: FastDomNode<HTMLElement>, lineNumber: number, startColumn: number, endColumn: number, context: DomReadingContext): FloatHorizontalRange[] | null {\n\t\tif (startColumn === endColumn) {\n\t\t\tconst pixelOffset = this._readPixelOffset(domNode, lineNumber, startColumn, context);\n\t\t\tif (pixelOffset === -1) {\n\t\t\t\treturn null;\n\t\t\t} else {\n\t\t\t\treturn [new FloatHorizontalRange(pixelOffset, 0)];\n\t\t\t}\n\t\t} else {\n\t\t\treturn this._readRawVisibleRangesForRange(domNode, startColumn, endColumn, context);\n\t\t}\n\t}\n\n\tprotected _readPixelOffset(domNode: FastDomNode<HTMLElement>, lineNumber: number, column: number, context: DomReadingContext): number {\n\t\tif (this._characterMapping.length === 0) {\n\t\t\t// This line has no content\n\t\t\tif (this._containsForeignElements === ForeignElementType.None) {\n\t\t\t\t// We can assume the line is really empty\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif (this._containsForeignElements === ForeignElementType.After) {\n\t\t\t\t// We have foreign elements after the (empty) line\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif (this._containsForeignElements === ForeignElementType.Before) {\n\t\t\t\t// We have foreign elements before the (empty) line\n\t\t\t\treturn this.getWidth(context);\n\t\t\t}\n\t\t\t// We have foreign elements before & after the (empty) line\n\t\t\tconst readingTarget = this._getReadingTarget(domNode);\n\t\t\tif (readingTarget.firstChild) {\n\t\t\t\tcontext.markDidDomLayout();\n\t\t\t\treturn (<HTMLSpanElement>readingTarget.firstChild).offsetWidth;\n\t\t\t} else {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\n\t\tif (this._pixelOffsetCache !== null) {\n\t\t\t// the text is LTR\n\n\t\t\tconst cachedPixelOffset = this._pixelOffsetCache[column];\n\t\t\tif (cachedPixelOffset !== -1) {\n\t\t\t\treturn cachedPixelOffset;\n\t\t\t}\n\n\t\t\tconst result = this._actualReadPixelOffset(domNode, lineNumber, column, context);\n\t\t\tthis._pixelOffsetCache[column] = result;\n\t\t\treturn result;\n\t\t}\n\n\t\treturn this._actualReadPixelOffset(domNode, lineNumber, column, context);\n\t}\n\n\tprivate _actualReadPixelOffset(domNode: FastDomNode<HTMLElement>, lineNumber: number, column: number, context: DomReadingContext): number {\n\t\tif (this._characterMapping.length === 0) {\n\t\t\t// This line has no content\n\t\t\tconst r = RangeUtil.readHorizontalRanges(this._getReadingTarget(domNode), 0, 0, 0, 0, context);\n\t\t\tif (!r || r.length === 0) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\treturn r[0].left;\n\t\t}\n\n\t\tif (column === this._characterMapping.length && this._isWhitespaceOnly && this._containsForeignElements === ForeignElementType.None) {\n\t\t\t// This branch helps in the case of whitespace only lines which have a width set\n\t\t\treturn this.getWidth(context);\n\t\t}\n\n\t\tconst domPosition = this._characterMapping.getDomPosition(column);\n\n\t\tconst r = RangeUtil.readHorizontalRanges(this._getReadingTarget(domNode), domPosition.partIndex, domPosition.charIndex, domPosition.partIndex, domPosition.charIndex, context);\n\t\tif (!r || r.length === 0) {\n\t\t\treturn -1;\n\t\t}\n\t\tconst result = r[0].left;\n\t\tif (this.input.isBasicASCII) {\n\t\t\tconst horizontalOffset = this._characterMapping.getHorizontalOffset(column);\n\t\t\tconst expectedResult = Math.round(this.input.spaceWidth * horizontalOffset);\n\t\t\tif (Math.abs(expectedResult - result) <= 1) {\n\t\t\t\treturn expectedResult;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate _readRawVisibleRangesForRange(domNode: FastDomNode<HTMLElement>, startColumn: number, endColumn: number, context: DomReadingContext): FloatHorizontalRange[] | null {\n\n\t\tif (startColumn === 1 && endColumn === this._characterMapping.length) {\n\t\t\t// This branch helps IE with bidi text & gives a performance boost to other browsers when reading visible ranges for an entire line\n\n\t\t\treturn [new FloatHorizontalRange(0, this.getWidth(context))];\n\t\t}\n\n\t\tconst startDomPosition = this._characterMapping.getDomPosition(startColumn);\n\t\tconst endDomPosition = this._characterMapping.getDomPosition(endColumn);\n\n\t\treturn RangeUtil.readHorizontalRanges(this._getReadingTarget(domNode), startDomPosition.partIndex, startDomPosition.charIndex, endDomPosition.partIndex, endDomPosition.charIndex, context);\n\t}\n\n\t/**\n\t * Returns the column for the text found at a specific offset inside a rendered dom node\n\t */\n\tpublic getColumnOfNodeOffset(spanNode: HTMLElement, offset: number): number {\n\t\treturn getColumnOfNodeOffset(this._characterMapping, spanNode, offset);\n\t}\n}\n\nclass WebKitRenderedViewLine extends RenderedViewLine {\n\tprotected override _readVisibleRangesForRange(domNode: FastDomNode<HTMLElement>, lineNumber: number, startColumn: number, endColumn: number, context: DomReadingContext): FloatHorizontalRange[] | null {\n\t\tconst output = super._readVisibleRangesForRange(domNode, lineNumber, startColumn, endColumn, context);\n\n\t\tif (!output || output.length === 0 || startColumn === endColumn || (startColumn === 1 && endColumn === this._characterMapping.length)) {\n\t\t\treturn output;\n\t\t}\n\n\t\t// WebKit is buggy and returns an expanded range (to contain words in some cases)\n\t\t// The last client rect is enlarged (I think)\n\t\tif (!this.input.containsRTL) {\n\t\t\t// This is an attempt to patch things up\n\t\t\t// Find position of last column\n\t\t\tconst endPixelOffset = this._readPixelOffset(domNode, lineNumber, endColumn, context);\n\t\t\tif (endPixelOffset !== -1) {\n\t\t\t\tconst lastRange = output[output.length - 1];\n\t\t\t\tif (lastRange.left < endPixelOffset) {\n\t\t\t\t\t// Trim down the width of the last visible range to not go after the last column's position\n\t\t\t\t\tlastRange.width = endPixelOffset - lastRange.left;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn output;\n\t}\n}\n\nconst createRenderedLine: (domNode: FastDomNode<HTMLElement> | null, renderLineInput: RenderLineInput, characterMapping: CharacterMapping, containsRTL: boolean, containsForeignElements: ForeignElementType) => RenderedViewLine = (function () {\n\tif (browser.isWebKit) {\n\t\treturn createWebKitRenderedLine;\n\t}\n\treturn createNormalRenderedLine;\n})();\n\nfunction createWebKitRenderedLine(domNode: FastDomNode<HTMLElement> | null, renderLineInput: RenderLineInput, characterMapping: CharacterMapping, containsRTL: boolean, containsForeignElements: ForeignElementType): RenderedViewLine {\n\treturn new WebKitRenderedViewLine(domNode, renderLineInput, characterMapping, containsRTL, containsForeignElements);\n}\n\nfunction createNormalRenderedLine(domNode: FastDomNode<HTMLElement> | null, renderLineInput: RenderLineInput, characterMapping: CharacterMapping, containsRTL: boolean, containsForeignElements: ForeignElementType): RenderedViewLine {\n\treturn new RenderedViewLine(domNode, renderLineInput, characterMapping, containsRTL, containsForeignElements);\n}\n\nexport function getColumnOfNodeOffset(characterMapping: CharacterMapping, spanNode: HTMLElement, offset: number): number {\n\tconst spanNodeTextContentLength = spanNode.textContent!.length;\n\n\tlet spanIndex = -1;\n\twhile (spanNode) {\n\t\tspanNode = <HTMLElement>spanNode.previousSibling;\n\t\tspanIndex++;\n\t}\n\n\treturn characterMapping.getColumn(new DomPosition(spanIndex, offset), spanNodeTextContentLength);\n}\n"]}