{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/test/browser/controller/imeRecorder.ts"],"names":[],"mappings":"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","file":"imeRecorder.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { TextAreaWrapper } from 'vs/editor/browser/controller/textAreaInput';\nimport { DisposableStore, toDisposable } from 'vs/base/common/lifecycle';\nimport { IRecorded, IRecordedCompositionEvent, IRecordedEvent, IRecordedInputEvent, IRecordedKeyboardEvent, IRecordedTextareaState } from 'vs/editor/test/browser/controller/imeRecordedTypes';\nimport * as browser from 'vs/base/browser/browser';\nimport * as platform from 'vs/base/common/platform';\n\n(() => {\n\n\tconst startButton = <HTMLButtonElement>document.getElementById('startRecording')!;\n\tconst endButton = <HTMLButtonElement>document.getElementById('endRecording')!;\n\n\tlet inputarea: HTMLTextAreaElement;\n\tconst disposables = new DisposableStore();\n\tlet originTimeStamp = 0;\n\tlet recorded: IRecorded = {\n\t\tenv: null!,\n\t\tinitial: null!,\n\t\tevents: [],\n\t\tfinal: null!\n\t};\n\n\tconst readTextareaState = (): IRecordedTextareaState => {\n\t\treturn {\n\t\t\tselectionDirection: inputarea.selectionDirection,\n\t\t\tselectionEnd: inputarea.selectionEnd,\n\t\t\tselectionStart: inputarea.selectionStart,\n\t\t\tvalue: inputarea.value,\n\t\t};\n\t};\n\n\tstartButton.onclick = () => {\n\t\tdisposables.clear();\n\t\tstartTest();\n\t\toriginTimeStamp = 0;\n\t\trecorded = {\n\t\t\tenv: {\n\t\t\t\tOS: platform.OS,\n\t\t\t\tbrowser: {\n\t\t\t\t\tisAndroid: browser.isAndroid,\n\t\t\t\t\tisFirefox: browser.isFirefox,\n\t\t\t\t\tisChrome: browser.isChrome,\n\t\t\t\t\tisSafari: browser.isSafari\n\t\t\t\t}\n\t\t\t},\n\t\t\tinitial: readTextareaState(),\n\t\t\tevents: [],\n\t\t\tfinal: null!\n\t\t};\n\t};\n\tendButton.onclick = () => {\n\t\trecorded.final = readTextareaState();\n\t\tconsole.log(printRecordedData());\n\t};\n\n\tfunction printRecordedData() {\n\t\tconst lines = [];\n\t\tlines.push(`const recorded: IRecorded = {`);\n\t\tlines.push(`\\tenv: ${JSON.stringify(recorded.env)}, `);\n\t\tlines.push(`\\tinitial: ${printState(recorded.initial)}, `);\n\t\tlines.push(`\\tevents: [\\n\\t\\t${recorded.events.map(ev => printEvent(ev)).join(',\\n\\t\\t')}\\n\\t],`);\n\t\tlines.push(`\\tfinal: ${printState(recorded.final)},`);\n\t\tlines.push(`}`);\n\n\t\treturn lines.join('\\n');\n\n\t\tfunction printString(str: string) {\n\t\t\treturn str.replace(/\\\\/g, '\\\\\\\\').replace(/'/g, '\\\\\\'');\n\t\t}\n\t\tfunction printState(state: IRecordedTextareaState) {\n\t\t\treturn `{ value: '${printString(state.value)}', selectionStart: ${state.selectionStart}, selectionEnd: ${state.selectionEnd}, selectionDirection: '${state.selectionDirection}' }`;\n\t\t}\n\t\tfunction printEvent(ev: IRecordedEvent) {\n\t\t\tif (ev.type === 'keydown' || ev.type === 'keypress' || ev.type === 'keyup') {\n\t\t\t\treturn `{ timeStamp: ${ev.timeStamp.toFixed(2)}, state: ${printState(ev.state)}, type: '${ev.type}', altKey: ${ev.altKey}, charCode: ${ev.charCode}, code: '${ev.code}', ctrlKey: ${ev.ctrlKey}, isComposing: ${ev.isComposing}, key: '${ev.key}', keyCode: ${ev.keyCode}, location: ${ev.location}, metaKey: ${ev.metaKey}, repeat: ${ev.repeat}, shiftKey: ${ev.shiftKey} }`;\n\t\t\t}\n\t\t\tif (ev.type === 'compositionstart' || ev.type === 'compositionupdate' || ev.type === 'compositionend') {\n\t\t\t\treturn `{ timeStamp: ${ev.timeStamp.toFixed(2)}, state: ${printState(ev.state)}, type: '${ev.type}', data: '${printString(ev.data)}' }`;\n\t\t\t}\n\t\t\tif (ev.type === 'beforeinput' || ev.type === 'input') {\n\t\t\t\treturn `{ timeStamp: ${ev.timeStamp.toFixed(2)}, state: ${printState(ev.state)}, type: '${ev.type}', data: ${ev.data === null ? 'null' : `'${printString(ev.data)}'`}, inputType: '${ev.inputType}', isComposing: ${ev.isComposing} }`;\n\t\t\t}\n\t\t\treturn JSON.stringify(ev);\n\t\t}\n\t}\n\n\tfunction startTest() {\n\t\tinputarea = document.createElement('textarea');\n\t\tdocument.body.appendChild(inputarea);\n\t\tinputarea.focus();\n\t\tdisposables.add(toDisposable(() => {\n\t\t\tinputarea.remove();\n\t\t}));\n\t\tconst wrapper = disposables.add(new TextAreaWrapper(inputarea));\n\n\t\twrapper.setValue('', `aaaa`);\n\t\twrapper.setSelectionRange('', 2, 2);\n\n\t\tconst recordEvent = (e: IRecordedEvent) => {\n\t\t\trecorded.events.push(e);\n\t\t};\n\n\t\tconst recordKeyboardEvent = (e: KeyboardEvent): void => {\n\t\t\tif (e.type !== 'keydown' && e.type !== 'keypress' && e.type !== 'keyup') {\n\t\t\t\tthrow new Error(`Not supported!`);\n\t\t\t}\n\t\t\tif (originTimeStamp === 0) {\n\t\t\t\toriginTimeStamp = e.timeStamp;\n\t\t\t}\n\t\t\tconst ev: IRecordedKeyboardEvent = {\n\t\t\t\ttimeStamp: e.timeStamp - originTimeStamp,\n\t\t\t\tstate: readTextareaState(),\n\t\t\t\ttype: e.type,\n\t\t\t\taltKey: e.altKey,\n\t\t\t\tcharCode: e.charCode,\n\t\t\t\tcode: e.code,\n\t\t\t\tctrlKey: e.ctrlKey,\n\t\t\t\tisComposing: e.isComposing,\n\t\t\t\tkey: e.key,\n\t\t\t\tkeyCode: e.keyCode,\n\t\t\t\tlocation: e.location,\n\t\t\t\tmetaKey: e.metaKey,\n\t\t\t\trepeat: e.repeat,\n\t\t\t\tshiftKey: e.shiftKey\n\t\t\t};\n\t\t\trecordEvent(ev);\n\t\t};\n\n\t\tconst recordCompositionEvent = (e: CompositionEvent): void => {\n\t\t\tif (e.type !== 'compositionstart' && e.type !== 'compositionupdate' && e.type !== 'compositionend') {\n\t\t\t\tthrow new Error(`Not supported!`);\n\t\t\t}\n\t\t\tif (originTimeStamp === 0) {\n\t\t\t\toriginTimeStamp = e.timeStamp;\n\t\t\t}\n\t\t\tconst ev: IRecordedCompositionEvent = {\n\t\t\t\ttimeStamp: e.timeStamp - originTimeStamp,\n\t\t\t\tstate: readTextareaState(),\n\t\t\t\ttype: e.type,\n\t\t\t\tdata: e.data,\n\t\t\t};\n\t\t\trecordEvent(ev);\n\t\t};\n\n\t\tconst recordInputEvent = (e: InputEvent): void => {\n\t\t\tif (e.type !== 'beforeinput' && e.type !== 'input') {\n\t\t\t\tthrow new Error(`Not supported!`);\n\t\t\t}\n\t\t\tif (originTimeStamp === 0) {\n\t\t\t\toriginTimeStamp = e.timeStamp;\n\t\t\t}\n\t\t\tconst ev: IRecordedInputEvent = {\n\t\t\t\ttimeStamp: e.timeStamp - originTimeStamp,\n\t\t\t\tstate: readTextareaState(),\n\t\t\t\ttype: e.type,\n\t\t\t\tdata: e.data,\n\t\t\t\tinputType: e.inputType,\n\t\t\t\tisComposing: e.isComposing,\n\t\t\t};\n\t\t\trecordEvent(ev);\n\t\t};\n\n\t\twrapper.onKeyDown(recordKeyboardEvent);\n\t\twrapper.onKeyPress(recordKeyboardEvent);\n\t\twrapper.onKeyUp(recordKeyboardEvent);\n\t\twrapper.onCompositionStart(recordCompositionEvent);\n\t\twrapper.onCompositionUpdate(recordCompositionEvent);\n\t\twrapper.onCompositionEnd(recordCompositionEvent);\n\t\twrapper.onBeforeInput(recordInputEvent);\n\t\twrapper.onInput(recordInputEvent);\n\t}\n\n})();\n"]}