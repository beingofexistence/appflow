{"version":3,"sources":["file:///workspace/appflow/src/vs/base/common/worker/simpleWorker.ts"],"names":[],"mappings":"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","file":"simpleWorker.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { transformErrorForSerialization } from 'vs/base/common/errors';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\nimport { getAllMethodNames } from 'vs/base/common/objects';\nimport { isWeb } from 'vs/base/common/platform';\nimport * as strings from 'vs/base/common/strings';\n\nconst INITIALIZE = '$initialize';\n\nexport interface IWorker extends IDisposable {\n\tgetId(): number;\n\tpostMessage(message: Message, transfer: ArrayBuffer[]): void;\n}\n\nexport interface IWorkerCallback {\n\t(message: Message): void;\n}\n\nexport interface IWorkerFactory {\n\tcreate(moduleId: string, callback: IWorkerCallback, onErrorCallback: (err: any) => void): IWorker;\n}\n\nlet webWorkerWarningLogged = false;\nexport function logOnceWebWorkerWarning(err: any): void {\n\tif (!isWeb) {\n\t\t// running tests\n\t\treturn;\n\t}\n\tif (!webWorkerWarningLogged) {\n\t\twebWorkerWarningLogged = true;\n\t\tconsole.warn('Could not create web worker(s). Falling back to loading web worker code in main thread, which might cause UI freezes. Please see https://github.com/microsoft/monaco-editor#faq');\n\t}\n\tconsole.warn(err.message);\n}\n\nconst enum MessageType {\n\tRequest,\n\tReply,\n\tSubscribeEvent,\n\tEvent,\n\tUnsubscribeEvent\n}\nclass RequestMessage {\n\tpublic readonly type = MessageType.Request;\n\tconstructor(\n\t\tpublic readonly vsWorker: number,\n\t\tpublic readonly req: string,\n\t\tpublic readonly method: string,\n\t\tpublic readonly args: any[]\n\t) { }\n}\nclass ReplyMessage {\n\tpublic readonly type = MessageType.Reply;\n\tconstructor(\n\t\tpublic readonly vsWorker: number,\n\t\tpublic readonly seq: string,\n\t\tpublic readonly res: any,\n\t\tpublic readonly err: any\n\t) { }\n}\nclass SubscribeEventMessage {\n\tpublic readonly type = MessageType.SubscribeEvent;\n\tconstructor(\n\t\tpublic readonly vsWorker: number,\n\t\tpublic readonly req: string,\n\t\tpublic readonly eventName: string,\n\t\tpublic readonly arg: any\n\t) { }\n}\nclass EventMessage {\n\tpublic readonly type = MessageType.Event;\n\tconstructor(\n\t\tpublic readonly vsWorker: number,\n\t\tpublic readonly req: string,\n\t\tpublic readonly event: any\n\t) { }\n}\nclass UnsubscribeEventMessage {\n\tpublic readonly type = MessageType.UnsubscribeEvent;\n\tconstructor(\n\t\tpublic readonly vsWorker: number,\n\t\tpublic readonly req: string\n\t) { }\n}\ntype Message = RequestMessage | ReplyMessage | SubscribeEventMessage | EventMessage | UnsubscribeEventMessage;\n\ninterface IMessageReply {\n\tresolve: (value?: any) => void;\n\treject: (error?: any) => void;\n}\n\ninterface IMessageHandler {\n\tsendMessage(msg: any, transfer?: ArrayBuffer[]): void;\n\thandleMessage(method: string, args: any[]): Promise<any>;\n\thandleEvent(eventName: string, arg: any): Event<any>;\n}\n\nclass SimpleWorkerProtocol {\n\n\tprivate _workerId: number;\n\tprivate _lastSentReq: number;\n\tprivate _pendingReplies: { [req: string]: IMessageReply };\n\tprivate _pendingEmitters: Map<string, Emitter<any>>;\n\tprivate _pendingEvents: Map<string, IDisposable>;\n\tprivate _handler: IMessageHandler;\n\n\tconstructor(handler: IMessageHandler) {\n\t\tthis._workerId = -1;\n\t\tthis._handler = handler;\n\t\tthis._lastSentReq = 0;\n\t\tthis._pendingReplies = Object.create(null);\n\t\tthis._pendingEmitters = new Map<string, Emitter<any>>();\n\t\tthis._pendingEvents = new Map<string, IDisposable>();\n\t}\n\n\tpublic setWorkerId(workerId: number): void {\n\t\tthis._workerId = workerId;\n\t}\n\n\tpublic sendMessage(method: string, args: any[]): Promise<any> {\n\t\tconst req = String(++this._lastSentReq);\n\t\treturn new Promise<any>((resolve, reject) => {\n\t\t\tthis._pendingReplies[req] = {\n\t\t\t\tresolve: resolve,\n\t\t\t\treject: reject\n\t\t\t};\n\t\t\tthis._send(new RequestMessage(this._workerId, req, method, args));\n\t\t});\n\t}\n\n\tpublic listen(eventName: string, arg: any): Event<any> {\n\t\tlet req: string | null = null;\n\t\tconst emitter = new Emitter<any>({\n\t\t\tonWillAddFirstListener: () => {\n\t\t\t\treq = String(++this._lastSentReq);\n\t\t\t\tthis._pendingEmitters.set(req, emitter);\n\t\t\t\tthis._send(new SubscribeEventMessage(this._workerId, req, eventName, arg));\n\t\t\t},\n\t\t\tonDidRemoveLastListener: () => {\n\t\t\t\tthis._pendingEmitters.delete(req!);\n\t\t\t\tthis._send(new UnsubscribeEventMessage(this._workerId, req!));\n\t\t\t\treq = null;\n\t\t\t}\n\t\t});\n\t\treturn emitter.event;\n\t}\n\n\tpublic handleMessage(message: Message): void {\n\t\tif (!message || !message.vsWorker) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._workerId !== -1 && message.vsWorker !== this._workerId) {\n\t\t\treturn;\n\t\t}\n\t\tthis._handleMessage(message);\n\t}\n\n\tprivate _handleMessage(msg: Message): void {\n\t\tswitch (msg.type) {\n\t\t\tcase MessageType.Reply:\n\t\t\t\treturn this._handleReplyMessage(msg);\n\t\t\tcase MessageType.Request:\n\t\t\t\treturn this._handleRequestMessage(msg);\n\t\t\tcase MessageType.SubscribeEvent:\n\t\t\t\treturn this._handleSubscribeEventMessage(msg);\n\t\t\tcase MessageType.Event:\n\t\t\t\treturn this._handleEventMessage(msg);\n\t\t\tcase MessageType.UnsubscribeEvent:\n\t\t\t\treturn this._handleUnsubscribeEventMessage(msg);\n\t\t}\n\t}\n\n\tprivate _handleReplyMessage(replyMessage: ReplyMessage): void {\n\t\tif (!this._pendingReplies[replyMessage.seq]) {\n\t\t\tconsole.warn('Got reply to unknown seq');\n\t\t\treturn;\n\t\t}\n\n\t\tconst reply = this._pendingReplies[replyMessage.seq];\n\t\tdelete this._pendingReplies[replyMessage.seq];\n\n\t\tif (replyMessage.err) {\n\t\t\tlet err = replyMessage.err;\n\t\t\tif (replyMessage.err.$isError) {\n\t\t\t\terr = new Error();\n\t\t\t\terr.name = replyMessage.err.name;\n\t\t\t\terr.message = replyMessage.err.message;\n\t\t\t\terr.stack = replyMessage.err.stack;\n\t\t\t}\n\t\t\treply.reject(err);\n\t\t\treturn;\n\t\t}\n\n\t\treply.resolve(replyMessage.res);\n\t}\n\n\tprivate _handleRequestMessage(requestMessage: RequestMessage): void {\n\t\tconst req = requestMessage.req;\n\t\tconst result = this._handler.handleMessage(requestMessage.method, requestMessage.args);\n\t\tresult.then((r) => {\n\t\t\tthis._send(new ReplyMessage(this._workerId, req, r, undefined));\n\t\t}, (e) => {\n\t\t\tif (e.detail instanceof Error) {\n\t\t\t\t// Loading errors have a detail property that points to the actual error\n\t\t\t\te.detail = transformErrorForSerialization(e.detail);\n\t\t\t}\n\t\t\tthis._send(new ReplyMessage(this._workerId, req, undefined, transformErrorForSerialization(e)));\n\t\t});\n\t}\n\n\tprivate _handleSubscribeEventMessage(msg: SubscribeEventMessage): void {\n\t\tconst req = msg.req;\n\t\tconst disposable = this._handler.handleEvent(msg.eventName, msg.arg)((event) => {\n\t\t\tthis._send(new EventMessage(this._workerId, req, event));\n\t\t});\n\t\tthis._pendingEvents.set(req, disposable);\n\t}\n\n\tprivate _handleEventMessage(msg: EventMessage): void {\n\t\tif (!this._pendingEmitters.has(msg.req)) {\n\t\t\tconsole.warn('Got event for unknown req');\n\t\t\treturn;\n\t\t}\n\t\tthis._pendingEmitters.get(msg.req)!.fire(msg.event);\n\t}\n\n\tprivate _handleUnsubscribeEventMessage(msg: UnsubscribeEventMessage): void {\n\t\tif (!this._pendingEvents.has(msg.req)) {\n\t\t\tconsole.warn('Got unsubscribe for unknown req');\n\t\t\treturn;\n\t\t}\n\t\tthis._pendingEvents.get(msg.req)!.dispose();\n\t\tthis._pendingEvents.delete(msg.req);\n\t}\n\n\tprivate _send(msg: Message): void {\n\t\tconst transfer: ArrayBuffer[] = [];\n\t\tif (msg.type === MessageType.Request) {\n\t\t\tfor (let i = 0; i < msg.args.length; i++) {\n\t\t\t\tif (msg.args[i] instanceof ArrayBuffer) {\n\t\t\t\t\ttransfer.push(msg.args[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (msg.type === MessageType.Reply) {\n\t\t\tif (msg.res instanceof ArrayBuffer) {\n\t\t\t\ttransfer.push(msg.res);\n\t\t\t}\n\t\t}\n\t\tthis._handler.sendMessage(msg, transfer);\n\t}\n}\n\nexport interface IWorkerClient<W> {\n\tgetProxyObject(): Promise<W>;\n\tdispose(): void;\n}\n\n/**\n * Main thread side\n */\nexport class SimpleWorkerClient<W extends object, H extends object> extends Disposable implements IWorkerClient<W> {\n\n\tprivate readonly _worker: IWorker;\n\tprivate readonly _onModuleLoaded: Promise<string[]>;\n\tprivate readonly _protocol: SimpleWorkerProtocol;\n\tprivate readonly _lazyProxy: Promise<W>;\n\n\tconstructor(workerFactory: IWorkerFactory, moduleId: string, host: H) {\n\t\tsuper();\n\n\t\tlet lazyProxyReject: ((err: any) => void) | null = null;\n\n\t\tthis._worker = this._register(workerFactory.create(\n\t\t\t'vs/base/common/worker/simpleWorker',\n\t\t\t(msg: Message) => {\n\t\t\t\tthis._protocol.handleMessage(msg);\n\t\t\t},\n\t\t\t(err: any) => {\n\t\t\t\t// in Firefox, web workers fail lazily :(\n\t\t\t\t// we will reject the proxy\n\t\t\t\tlazyProxyReject?.(err);\n\t\t\t}\n\t\t));\n\n\t\tthis._protocol = new SimpleWorkerProtocol({\n\t\t\tsendMessage: (msg: any, transfer: ArrayBuffer[]): void => {\n\t\t\t\tthis._worker.postMessage(msg, transfer);\n\t\t\t},\n\t\t\thandleMessage: (method: string, args: any[]): Promise<any> => {\n\t\t\t\tif (typeof (host as any)[method] !== 'function') {\n\t\t\t\t\treturn Promise.reject(new Error('Missing method ' + method + ' on main thread host.'));\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\treturn Promise.resolve((host as any)[method].apply(host, args));\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn Promise.reject(e);\n\t\t\t\t}\n\t\t\t},\n\t\t\thandleEvent: (eventName: string, arg: any): Event<any> => {\n\t\t\t\tif (propertyIsDynamicEvent(eventName)) {\n\t\t\t\t\tconst event = (host as any)[eventName].call(host, arg);\n\t\t\t\t\tif (typeof event !== 'function') {\n\t\t\t\t\t\tthrow new Error(`Missing dynamic event ${eventName} on main thread host.`);\n\t\t\t\t\t}\n\t\t\t\t\treturn event;\n\t\t\t\t}\n\t\t\t\tif (propertyIsEvent(eventName)) {\n\t\t\t\t\tconst event = (host as any)[eventName];\n\t\t\t\t\tif (typeof event !== 'function') {\n\t\t\t\t\t\tthrow new Error(`Missing event ${eventName} on main thread host.`);\n\t\t\t\t\t}\n\t\t\t\t\treturn event;\n\t\t\t\t}\n\t\t\t\tthrow new Error(`Malformed event name ${eventName}`);\n\t\t\t}\n\t\t});\n\t\tthis._protocol.setWorkerId(this._worker.getId());\n\n\t\t// Gather loader configuration\n\t\tlet loaderConfiguration: any = null;\n\n\t\tconst globalRequire: { getConfig?(): object } | undefined = (globalThis as any).require;\n\t\tif (typeof globalRequire !== 'undefined' && typeof globalRequire.getConfig === 'function') {\n\t\t\t// Get the configuration from the Monaco AMD Loader\n\t\t\tloaderConfiguration = globalRequire.getConfig();\n\t\t} else if (typeof (globalThis as any).requirejs !== 'undefined') {\n\t\t\t// Get the configuration from requirejs\n\t\t\tloaderConfiguration = (globalThis as any).requirejs.s.contexts._.config;\n\t\t}\n\n\t\tconst hostMethods = getAllMethodNames(host);\n\n\t\t// Send initialize message\n\t\tthis._onModuleLoaded = this._protocol.sendMessage(INITIALIZE, [\n\t\t\tthis._worker.getId(),\n\t\t\tJSON.parse(JSON.stringify(loaderConfiguration)),\n\t\t\tmoduleId,\n\t\t\thostMethods,\n\t\t]);\n\n\t\t// Create proxy to loaded code\n\t\tconst proxyMethodRequest = (method: string, args: any[]): Promise<any> => {\n\t\t\treturn this._request(method, args);\n\t\t};\n\t\tconst proxyListen = (eventName: string, arg: any): Event<any> => {\n\t\t\treturn this._protocol.listen(eventName, arg);\n\t\t};\n\n\t\tthis._lazyProxy = new Promise<W>((resolve, reject) => {\n\t\t\tlazyProxyReject = reject;\n\t\t\tthis._onModuleLoaded.then((availableMethods: string[]) => {\n\t\t\t\tresolve(createProxyObject<W>(availableMethods, proxyMethodRequest, proxyListen));\n\t\t\t}, (e) => {\n\t\t\t\treject(e);\n\t\t\t\tthis._onError('Worker failed to load ' + moduleId, e);\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic getProxyObject(): Promise<W> {\n\t\treturn this._lazyProxy;\n\t}\n\n\tprivate _request(method: string, args: any[]): Promise<any> {\n\t\treturn new Promise<any>((resolve, reject) => {\n\t\t\tthis._onModuleLoaded.then(() => {\n\t\t\t\tthis._protocol.sendMessage(method, args).then(resolve, reject);\n\t\t\t}, reject);\n\t\t});\n\t}\n\n\tprivate _onError(message: string, error?: any): void {\n\t\tconsole.error(message);\n\t\tconsole.info(error);\n\t}\n}\n\nfunction propertyIsEvent(name: string): boolean {\n\t// Assume a property is an event if it has a form of \"onSomething\"\n\treturn name[0] === 'o' && name[1] === 'n' && strings.isUpperAsciiLetter(name.charCodeAt(2));\n}\n\nfunction propertyIsDynamicEvent(name: string): boolean {\n\t// Assume a property is a dynamic event (a method that returns an event) if it has a form of \"onDynamicSomething\"\n\treturn /^onDynamic/.test(name) && strings.isUpperAsciiLetter(name.charCodeAt(9));\n}\n\nfunction createProxyObject<T extends object>(\n\tmethodNames: string[],\n\tinvoke: (method: string, args: unknown[]) => unknown,\n\tproxyListen: (eventName: string, arg: any) => Event<any>\n): T {\n\tconst createProxyMethod = (method: string): () => unknown => {\n\t\treturn function () {\n\t\t\tconst args = Array.prototype.slice.call(arguments, 0);\n\t\t\treturn invoke(method, args);\n\t\t};\n\t};\n\tconst createProxyDynamicEvent = (eventName: string): (arg: any) => Event<any> => {\n\t\treturn function (arg) {\n\t\t\treturn proxyListen(eventName, arg);\n\t\t};\n\t};\n\n\tconst result = {} as T;\n\tfor (const methodName of methodNames) {\n\t\tif (propertyIsDynamicEvent(methodName)) {\n\t\t\t(<any>result)[methodName] = createProxyDynamicEvent(methodName);\n\t\t\tcontinue;\n\t\t}\n\t\tif (propertyIsEvent(methodName)) {\n\t\t\t(<any>result)[methodName] = proxyListen(methodName, undefined);\n\t\t\tcontinue;\n\t\t}\n\t\t(<any>result)[methodName] = createProxyMethod(methodName);\n\t}\n\treturn result;\n}\n\nexport interface IRequestHandler {\n\t_requestHandlerBrand: any;\n\t[prop: string]: any;\n}\n\nexport interface IRequestHandlerFactory<H> {\n\t(host: H): IRequestHandler;\n}\n\n/**\n * Worker side\n */\nexport class SimpleWorkerServer<H extends object> {\n\n\tprivate _requestHandlerFactory: IRequestHandlerFactory<H> | null;\n\tprivate _requestHandler: IRequestHandler | null;\n\tprivate _protocol: SimpleWorkerProtocol;\n\n\tconstructor(postMessage: (msg: Message, transfer?: ArrayBuffer[]) => void, requestHandlerFactory: IRequestHandlerFactory<H> | null) {\n\t\tthis._requestHandlerFactory = requestHandlerFactory;\n\t\tthis._requestHandler = null;\n\t\tthis._protocol = new SimpleWorkerProtocol({\n\t\t\tsendMessage: (msg: any, transfer: ArrayBuffer[]): void => {\n\t\t\t\tpostMessage(msg, transfer);\n\t\t\t},\n\t\t\thandleMessage: (method: string, args: any[]): Promise<any> => this._handleMessage(method, args),\n\t\t\thandleEvent: (eventName: string, arg: any): Event<any> => this._handleEvent(eventName, arg)\n\t\t});\n\t}\n\n\tpublic onmessage(msg: any): void {\n\t\tthis._protocol.handleMessage(msg);\n\t}\n\n\tprivate _handleMessage(method: string, args: any[]): Promise<any> {\n\t\tif (method === INITIALIZE) {\n\t\t\treturn this.initialize(<number>args[0], <any>args[1], <string>args[2], <string[]>args[3]);\n\t\t}\n\n\t\tif (!this._requestHandler || typeof this._requestHandler[method] !== 'function') {\n\t\t\treturn Promise.reject(new Error('Missing requestHandler or method: ' + method));\n\t\t}\n\n\t\ttry {\n\t\t\treturn Promise.resolve(this._requestHandler[method].apply(this._requestHandler, args));\n\t\t} catch (e) {\n\t\t\treturn Promise.reject(e);\n\t\t}\n\t}\n\n\tprivate _handleEvent(eventName: string, arg: any): Event<any> {\n\t\tif (!this._requestHandler) {\n\t\t\tthrow new Error(`Missing requestHandler`);\n\t\t}\n\t\tif (propertyIsDynamicEvent(eventName)) {\n\t\t\tconst event = (this._requestHandler as any)[eventName].call(this._requestHandler, arg);\n\t\t\tif (typeof event !== 'function') {\n\t\t\t\tthrow new Error(`Missing dynamic event ${eventName} on request handler.`);\n\t\t\t}\n\t\t\treturn event;\n\t\t}\n\t\tif (propertyIsEvent(eventName)) {\n\t\t\tconst event = (this._requestHandler as any)[eventName];\n\t\t\tif (typeof event !== 'function') {\n\t\t\t\tthrow new Error(`Missing event ${eventName} on request handler.`);\n\t\t\t}\n\t\t\treturn event;\n\t\t}\n\t\tthrow new Error(`Malformed event name ${eventName}`);\n\t}\n\n\tprivate initialize(workerId: number, loaderConfig: any, moduleId: string, hostMethods: string[]): Promise<string[]> {\n\t\tthis._protocol.setWorkerId(workerId);\n\n\t\tconst proxyMethodRequest = (method: string, args: any[]): Promise<any> => {\n\t\t\treturn this._protocol.sendMessage(method, args);\n\t\t};\n\t\tconst proxyListen = (eventName: string, arg: any): Event<any> => {\n\t\t\treturn this._protocol.listen(eventName, arg);\n\t\t};\n\n\t\tconst hostProxy = createProxyObject<H>(hostMethods, proxyMethodRequest, proxyListen);\n\n\t\tif (this._requestHandlerFactory) {\n\t\t\t// static request handler\n\t\t\tthis._requestHandler = this._requestHandlerFactory(hostProxy);\n\t\t\treturn Promise.resolve(getAllMethodNames(this._requestHandler));\n\t\t}\n\n\t\tif (loaderConfig) {\n\t\t\t// Remove 'baseUrl', handling it is beyond scope for now\n\t\t\tif (typeof loaderConfig.baseUrl !== 'undefined') {\n\t\t\t\tdelete loaderConfig['baseUrl'];\n\t\t\t}\n\t\t\tif (typeof loaderConfig.paths !== 'undefined') {\n\t\t\t\tif (typeof loaderConfig.paths.vs !== 'undefined') {\n\t\t\t\t\tdelete loaderConfig.paths['vs'];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (typeof loaderConfig.trustedTypesPolicy !== undefined) {\n\t\t\t\t// don't use, it has been destroyed during serialize\n\t\t\t\tdelete loaderConfig['trustedTypesPolicy'];\n\t\t\t}\n\n\t\t\t// Since this is in a web worker, enable catching errors\n\t\t\tloaderConfig.catchError = true;\n\t\t\tglobalThis.require.config(loaderConfig);\n\t\t}\n\n\t\treturn new Promise<string[]>((resolve, reject) => {\n\t\t\t// Use the global require to be sure to get the global config\n\n\t\t\t// ESM-comment-begin\n\t\t\tconst req = (globalThis.require || require);\n\t\t\t// ESM-comment-end\n\t\t\t// ESM-uncomment-begin\n\t\t\t// const req = globalThis.require;\n\t\t\t// ESM-uncomment-end\n\n\t\t\treq([moduleId], (module: { create: IRequestHandlerFactory<H> }) => {\n\t\t\t\tthis._requestHandler = module.create(hostProxy);\n\n\t\t\t\tif (!this._requestHandler) {\n\t\t\t\t\treject(new Error(`No RequestHandler!`));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tresolve(getAllMethodNames(this._requestHandler));\n\t\t\t}, reject);\n\t\t});\n\t}\n}\n\n/**\n * Called on the worker side\n * @skipMangle\n */\nexport function create(postMessage: (msg: Message, transfer?: ArrayBuffer[]) => void): SimpleWorkerServer<any> {\n\treturn new SimpleWorkerServer(postMessage, null);\n}\n"]}