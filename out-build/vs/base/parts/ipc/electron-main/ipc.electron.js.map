{"version":3,"sources":["file:///workspace/appflow/src/vs/base/parts/ipc/electron-main/ipc.electron.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;IAehG,SAAS,0BAA0B,CAAC,QAAgB,EAAE,SAAiB;QACtE,MAAM,SAAS,GAAG,aAAK,CAAC,oBAAoB,CAAY,aAAG,EAAe,SAAS,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,EAAE,CAAC,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC;QAC/H,MAAM,mBAAmB,GAAG,aAAK,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,KAAK,QAAQ,CAAC,CAAC;QAEjG,OAAO,aAAK,CAAC,GAAG,CAAC,mBAAmB,EAAE,CAAC,EAAE,OAAO,EAAE,EAAE,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC,YAAG,CAAM,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;IACpG,CAAC;IAED;;OAEG;IACH,MAAa,GAAO,SAAQ,SAAG;iBAEN,MAAC,GAAS,IAAI,GAAG,EAAuB,CAAC;QAEzD,MAAM,CAAC,CAAC;YACf,MAAM,OAAO,GAAG,aAAK,CAAC,oBAAoB,CAAc,aAAG,EAAe,cAAc,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC;YAElH,OAAO,aAAK,CAAC,GAAG,CAAC,OAAO,EAAE,WAAW,CAAC,EAAE;gBACvC,MAAM,EAAE,GAAG,WAAW,CAAC,EAAE,CAAC;gBAC1B,MAAM,MAAM,GAAG,GAAG,CAAI,CAAC,CAAO,GAAG,CAAC,EAAE,CAAC,CAAC;gBAEtC,MAAM,EAAE,OAAO,EAAE,CAAC;gBAElB,MAAM,oBAAoB,GAAG,IAAI,WAAG,EAAY,CAAC;gBACjD,GAAG,CAAI,CAAC,CAAO,GAAG,CAAC,EAAE,EAAE,IAAA,eAAG,EAAU,GAAG,EAAE,CAAC,oBAAoB,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;gBAExE,MAAM,SAAS,GAAG,0BAA0B,CAAC,EAAE,EAAE,gBAAgB,CAAoB,CAAC;gBACtF,MAAM,qBAAqB,GAAG,aAAK,CAAC,GAAG,CAAC,aAAK,CAAC,MAAM,CAAC,0BAA0B,CAAC,EAAE,EAAE,mBAAmB,CAAC,CAAC,EAAE,oBAAoB,CAAC,KAAK,CAAC,CAAC;gBACvI,MAAM,QAAQ,GAAG,IAAI,kBAAgB,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;gBAE9D,OAAO,EAAE,QAAQ,EAAE,qBAAqB,EAAE,CAAC;YAC5C,CAAC,CAAC,CAAC;QACJ,CAAC;QAED;YACC,KAAK,CAAC,GAAG,CAAI,CAAC,EAAsB,CAAC,CAAC;QACvC,CAAC;;IA1BF,kBA2BC","file":"ipc.electron.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { WebContents } from 'electron';\nimport { validatedIpcMain } from 'vs/base/parts/ipc/electron-main/ipcMain';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { ClientConnectionEvent, IPCServer } from 'vs/base/parts/ipc/common/ipc';\nimport { Protocol as ElectronProtocol } from 'vs/base/parts/ipc/common/ipc.electron';\n\ninterface IIPCEvent {\n\tevent: { sender: WebContents };\n\tmessage: Buffer | null;\n}\n\nfunction createScopedOnMessageEvent(senderId: number, eventName: string): Event<VSBuffer | null> {\n\tconst onMessage = Event.fromNodeEventEmitter<IIPCEvent>(validatedIpcMain, eventName, (event, message) => ({ event, message }));\n\tconst onMessageFromSender = Event.filter(onMessage, ({ event }) => event.sender.id === senderId);\n\n\treturn Event.map(onMessageFromSender, ({ message }) => message ? VSBuffer.wrap(message) : message);\n}\n\n/**\n * An implementation of `IPCServer` on top of Electron `ipcMain` API.\n */\nexport class Server extends IPCServer {\n\n\tprivate static readonly Clients = new Map<number, IDisposable>();\n\n\tprivate static getOnDidClientConnect(): Event<ClientConnectionEvent> {\n\t\tconst onHello = Event.fromNodeEventEmitter<WebContents>(validatedIpcMain, 'vscode:hello', ({ sender }) => sender);\n\n\t\treturn Event.map(onHello, webContents => {\n\t\t\tconst id = webContents.id;\n\t\t\tconst client = Server.Clients.get(id);\n\n\t\t\tclient?.dispose();\n\n\t\t\tconst onDidClientReconnect = new Emitter<void>();\n\t\t\tServer.Clients.set(id, toDisposable(() => onDidClientReconnect.fire()));\n\n\t\t\tconst onMessage = createScopedOnMessageEvent(id, 'vscode:message') as Event<VSBuffer>;\n\t\t\tconst onDidClientDisconnect = Event.any(Event.signal(createScopedOnMessageEvent(id, 'vscode:disconnect')), onDidClientReconnect.event);\n\t\t\tconst protocol = new ElectronProtocol(webContents, onMessage);\n\n\t\t\treturn { protocol, onDidClientDisconnect };\n\t\t});\n\t}\n\n\tconstructor() {\n\t\tsuper(Server.getOnDidClientConnect());\n\t}\n}\n"]}